"use strict";var J4=Object.create;var Jm=Object.defineProperty;var K4=Object.getOwnPropertyDescriptor;var X4=Object.getOwnPropertyNames;var Y4=Object.getPrototypeOf,Z4=Object.prototype.hasOwnProperty;var G=(r,e)=>()=>(r&&(e=r(r=0)),e);var H=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),wr=(r,e)=>{for(var t in e)Jm(r,t,{get:e[t],enumerable:!0})},Qx=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of X4(e))!Z4.call(r,a)&&a!==t&&Jm(r,a,{get:()=>e[a],enumerable:!(n=K4(e,a))||n.enumerable});return r};var ln=(r,e,t)=>(t=r!=null?J4(Y4(r)):{},Qx(e||!r||!r.__esModule?Jm(t,"default",{value:r,enumerable:!0}):t,r)),e5=r=>Qx(Jm({},"__esModule",{value:!0}),r);var ca=H((Xce,Yx)=>{var t5=require("path").relative;Yx.exports=o5;var r5=process.cwd();function Kx(r,e){for(var t=r.split(/[ ,]+/),n=String(e).toLowerCase(),a=0;a<t.length;a++){var s=t[a];if(s&&(s==="*"||s.toLowerCase()===n))return!0}return!1}function n5(r,e,t){var n=Object.getOwnPropertyDescriptor(r,e),a=n.value;return n.get=function(){return a},n.writable&&(n.set=function(o){return a=o}),delete n.value,delete n.writable,Object.defineProperty(r,e,n),n}function a5(r){for(var e="",t=0;t<r;t++)e+=", arg"+t;return e.substr(2)}function s5(r){var e=this.name+": "+this.namespace;this.message&&(e+=" deprecated "+this.message);for(var t=0;t<r.length;t++)e+=`
    at `+r[t].toString();return e}function o5(r){if(!r)throw new TypeError("argument namespace is required");var e=Xm(),t=Wc(e[1]),n=t[0];function a(s){Km.call(a,s)}return a._file=n,a._ignored=c5(r),a._namespace=r,a._traced=l5(r),a._warned=Object.create(null),a.function=m5,a.property=h5,a}function i5(r,e){var t=typeof r.listenerCount!="function"?r.listeners(e).length:r.listenerCount(e);return t>0}function c5(r){if(process.noDeprecation)return!0;var e=process.env.NO_DEPRECATION||"";return Kx(e,r)}function l5(r){if(process.traceDeprecation)return!0;var e=process.env.TRACE_DEPRECATION||"";return Kx(e,r)}function Km(r,e){var t=i5(process,"deprecation");if(!(!t&&this._ignored)){var n,a,s,o,i=0,u=!1,c=Xm(),p=this._file;for(e?(o=e,s=Wc(c[1]),s.name=o.name,p=s[0]):(i=2,o=Wc(c[i]),s=o);i<c.length;i++)if(n=Wc(c[i]),a=n[0],a===p)u=!0;else if(a===this._file)p=this._file;else if(u)break;var m=n?o.join(":")+"__"+n.join(":"):void 0;if(!(m!==void 0&&m in this._warned)){this._warned[m]=!0;var f=r;if(f||(f=s===o||!s.name?Jx(o):Jx(s)),t){var g=Xx(this._namespace,f,c.slice(i));process.emit("deprecation",g);return}var y=process.stderr.isTTY?p5:u5,C=y.call(this,f,n,c.slice(i));process.stderr.write(C+`
`,"utf8")}}}function Wc(r){var e=r.getFileName()||"<anonymous>",t=r.getLineNumber(),n=r.getColumnNumber();r.isEval()&&(e=r.getEvalOrigin()+", "+e);var a=[e,t,n];return a.callSite=r,a.name=r.getFunctionName(),a}function Jx(r){var e=r.callSite,t=r.name;t||(t="<anonymous@"+wb(r)+">");var n=e.getThis(),a=n&&e.getTypeName();return a==="Object"&&(a=void 0),a==="Function"&&(a=n.name||a),a&&e.getMethodName()?a+"."+t:t}function u5(r,e,t){var n=new Date().toUTCString(),a=n+" "+this._namespace+" deprecated "+r;if(this._traced){for(var s=0;s<t.length;s++)a+=`
    at `+t[s].toString();return a}return e&&(a+=" at "+wb(e)),a}function p5(r,e,t){var n="\x1B[36;1m"+this._namespace+"\x1B[22;39m \x1B[33;1mdeprecated\x1B[22;39m \x1B[0m"+r+"\x1B[39m";if(this._traced){for(var a=0;a<t.length;a++)n+=`
    \x1B[36mat `+t[a].toString()+"\x1B[39m";return n}return e&&(n+=" \x1B[36m"+wb(e)+"\x1B[39m"),n}function wb(r){return t5(r5,r[0])+":"+r[1]+":"+r[2]}function Xm(){var r=Error.stackTraceLimit,e={},t=Error.prepareStackTrace;Error.prepareStackTrace=d5,Error.stackTraceLimit=Math.max(10,r),Error.captureStackTrace(e);var n=e.stack.slice(1);return Error.prepareStackTrace=t,Error.stackTraceLimit=r,n}function d5(r,e){return e}function m5(r,e){if(typeof r!="function")throw new TypeError("argument fn must be a function");var t=a5(r.length),n=Xm(),a=Wc(n[1]);a.name=r.name;var s=new Function("fn","log","deprecate","message","site",`"use strict"
return function (`+t+`) {log.call(deprecate, message, site)
return fn.apply(this, arguments)
}`)(r,Km,this,e,a);return s}function h5(r,e,t){if(!r||typeof r!="object"&&typeof r!="function")throw new TypeError("argument obj must be object");var n=Object.getOwnPropertyDescriptor(r,e);if(!n)throw new TypeError("must call property on owner object");if(!n.configurable)throw new TypeError("property must be configurable");var a=this,s=Xm(),o=Wc(s[1]);o.name=e,"value"in n&&(n=n5(r,e,t));var i=n.get,u=n.set;typeof i=="function"&&(n.get=function(){return Km.call(a,t,o),i.apply(this,arguments)}),typeof u=="function"&&(n.set=function(){return Km.call(a,t,o),u.apply(this,arguments)}),Object.defineProperty(r,e,n)}function Xx(r,e,t){var n=new Error,a;return Object.defineProperty(n,"constructor",{value:Xx}),Object.defineProperty(n,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(n,"name",{enumerable:!1,configurable:!0,value:"DeprecationError",writable:!0}),Object.defineProperty(n,"namespace",{configurable:!0,enumerable:!1,value:r,writable:!0}),Object.defineProperty(n,"stack",{configurable:!0,enumerable:!1,get:function(){return a!==void 0?a:a=s5.call(this,t)},set:function(o){a=o}}),n}});var Qc=H((Yce,Ym)=>{"use strict";Ym.exports=b5;Ym.exports.format=Zx;Ym.exports.parse=eT;var f5=/\B(?=(\d{3})+(?!\d))/g,g5=/(?:\.0*|(\.[^0]+)0+)$/,bo={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},y5=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function b5(r,e){return typeof r=="string"?eT(r):typeof r=="number"?Zx(r,e):null}function Zx(r,e){if(!Number.isFinite(r))return null;var t=Math.abs(r),n=e&&e.thousandsSeparator||"",a=e&&e.unitSeparator||"",s=e&&e.decimalPlaces!==void 0?e.decimalPlaces:2,o=!!(e&&e.fixedDecimals),i=e&&e.unit||"";(!i||!bo[i.toLowerCase()])&&(t>=bo.pb?i="PB":t>=bo.tb?i="TB":t>=bo.gb?i="GB":t>=bo.mb?i="MB":t>=bo.kb?i="KB":i="B");var u=r/bo[i.toLowerCase()],c=u.toFixed(s);return o||(c=c.replace(g5,"$1")),n&&(c=c.split(".").map(function(p,m){return m===0?p.replace(f5,n):p}).join(".")),c+a+i}function eT(r){if(typeof r=="number"&&!isNaN(r))return r;if(typeof r!="string")return null;var e=y5.exec(r),t,n="b";return e?(t=parseFloat(e[1]),n=e[4].toLowerCase()):(t=parseInt(r,10),n="b"),isNaN(t)?null:Math.floor(bo[n]*t)}});var Ku=H(Ib=>{"use strict";var tT=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,v5=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,rT=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,E5=/\\([\u000b\u0020-\u00ff])/g,C5=/([\\"])/g,nT=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;Ib.format=A5;Ib.parse=S5;function A5(r){if(!r||typeof r!="object")throw new TypeError("argument obj is required");var e=r.parameters,t=r.type;if(!t||!nT.test(t))throw new TypeError("invalid type");var n=t;if(e&&typeof e=="object")for(var a,s=Object.keys(e).sort(),o=0;o<s.length;o++){if(a=s[o],!rT.test(a))throw new TypeError("invalid parameter name");n+="; "+a+"="+w5(e[a])}return n}function S5(r){if(!r)throw new TypeError("argument string is required");var e=typeof r=="object"?R5(r):r;if(typeof e!="string")throw new TypeError("argument string is required to be a string");var t=e.indexOf(";"),n=t!==-1?e.slice(0,t).trim():e.trim();if(!nT.test(n))throw new TypeError("invalid media type");var a=new I5(n.toLowerCase());if(t!==-1){var s,o,i;for(tT.lastIndex=t;o=tT.exec(e);){if(o.index!==t)throw new TypeError("invalid parameter format");t+=o[0].length,s=o[1].toLowerCase(),i=o[2],i.charCodeAt(0)===34&&(i=i.slice(1,-1),i.indexOf("\\")!==-1&&(i=i.replace(E5,"$1"))),a.parameters[s]=i}if(t!==e.length)throw new TypeError("invalid parameter format")}return a}function R5(r){var e;if(typeof r.getHeader=="function"?e=r.getHeader("content-type"):typeof r.headers=="object"&&(e=r.headers&&r.headers["content-type"]),typeof e!="string")throw new TypeError("content-type header is missing from object");return e}function w5(r){var e=String(r);if(rT.test(e))return e;if(e.length>0&&!v5.test(e))throw new TypeError("invalid parameter value");return'"'+e.replace(C5,"\\$1")+'"'}function I5(r){this.parameters=Object.create(null),this.type=r}});var fi=H((ele,aT)=>{"use strict";aT.exports=Object.setPrototypeOf||({__proto__:[]}instanceof Array?x5:T5);function x5(r,e){return r.__proto__=e,r}function T5(r,e){for(var t in e)Object.prototype.hasOwnProperty.call(r,t)||(r[t]=e[t]);return r}});var sT=H((tle,O5)=>{O5.exports={"100":"Continue","101":"Switching Protocols","102":"Processing","103":"Early Hints","200":"OK","201":"Created","202":"Accepted","203":"Non-Authoritative Information","204":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","208":"Already Reported","226":"IM Used","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Temporary Redirect","308":"Permanent Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Timeout","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Payload Too Large","414":"URI Too Long","415":"Unsupported Media Type","416":"Range Not Satisfiable","417":"Expectation Failed","418":"I'm a Teapot","421":"Misdirected Request","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","425":"Too Early","426":"Upgrade Required","428":"Precondition Required","429":"Too Many Requests","431":"Request Header Fields Too Large","451":"Unavailable For Legal Reasons","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Timeout","505":"HTTP Version Not Supported","506":"Variant Also Negotiates","507":"Insufficient Storage","508":"Loop Detected","509":"Bandwidth Limit Exceeded","510":"Not Extended","511":"Network Authentication Required"}});var cT=H((rle,iT)=>{"use strict";var xb=sT();iT.exports=_a;_a.message=xb;_a.code=N5(xb);_a.codes=_5(xb);_a.redirect={300:!0,301:!0,302:!0,303:!0,305:!0,307:!0,308:!0};_a.empty={204:!0,205:!0,304:!0};_a.retry={502:!0,503:!0,504:!0};function N5(r){var e={};return Object.keys(r).forEach(function(n){var a=r[n],s=Number(n);e[a.toLowerCase()]=s}),e}function _5(r){return Object.keys(r).map(function(t){return Number(t)})}function P5(r){var e=r.toLowerCase();if(!Object.prototype.hasOwnProperty.call(_a.code,e))throw new Error('invalid status message: "'+r+'"');return _a.code[e]}function oT(r){if(!Object.prototype.hasOwnProperty.call(_a.message,r))throw new Error("invalid status code: "+r);return _a.message[r]}function _a(r){if(typeof r=="number")return oT(r);if(typeof r!="string")throw new TypeError("code must be a number or string");var e=parseInt(r,10);return isNaN(e)?P5(r):oT(e)}});var lT=H((nle,Tb)=>{typeof Object.create=="function"?Tb.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Tb.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}});var Ya=H((ale,Nb)=>{try{if(Ob=require("util"),typeof Ob.inherits!="function")throw"";Nb.exports=Ob.inherits}catch{Nb.exports=lT()}var Ob});var Zm=H((sle,uT)=>{"use strict";uT.exports=$5;function $5(r){return r.split(" ").map(function(e){return e.slice(0,1).toUpperCase()+e.slice(1)}).join("").replace(/[^ _0-9a-z]/gi,"")}});var th=H((ole,gi)=>{"use strict";var L5=ca()("http-errors"),pT=fi(),Jc=cT(),_b=Ya(),j5=Zm();gi.exports=eh;gi.exports.HttpError=k5();gi.exports.isHttpError=M5(gi.exports.HttpError);B5(gi.exports,Jc.codes,gi.exports.HttpError);function dT(r){return+(String(r).charAt(0)+"00")}function eh(){for(var r,e,t=500,n={},a=0;a<arguments.length;a++){var s=arguments[a],o=typeof s;if(o==="object"&&s instanceof Error)r=s,t=r.status||r.statusCode||t;else if(o==="number"&&a===0)t=s;else if(o==="string")e=s;else if(o==="object")n=s;else throw new TypeError("argument #"+(a+1)+" unsupported type "+o)}typeof t=="number"&&(t<400||t>=600)&&L5("non-error status code; use only 4xx or 5xx status codes"),(typeof t!="number"||!Jc.message[t]&&(t<400||t>=600))&&(t=500);var i=eh[t]||eh[dT(t)];r||(r=i?new i(e):new Error(e||Jc.message[t]),Error.captureStackTrace(r,eh)),(!i||!(r instanceof i)||r.status!==t)&&(r.expose=t<500,r.status=r.statusCode=t);for(var u in n)u!=="status"&&u!=="statusCode"&&(r[u]=n[u]);return r}function k5(){function r(){throw new TypeError("cannot construct abstract class")}return _b(r,Error),r}function D5(r,e,t){var n=hT(e);function a(s){var o=s??Jc.message[t],i=new Error(o);return Error.captureStackTrace(i,a),pT(i,a.prototype),Object.defineProperty(i,"message",{enumerable:!0,configurable:!0,value:o,writable:!0}),Object.defineProperty(i,"name",{enumerable:!1,configurable:!0,value:n,writable:!0}),i}return _b(a,r),mT(a,n),a.prototype.status=t,a.prototype.statusCode=t,a.prototype.expose=!0,a}function M5(r){return function(t){return!t||typeof t!="object"?!1:t instanceof r?!0:t instanceof Error&&typeof t.expose=="boolean"&&typeof t.statusCode=="number"&&t.status===t.statusCode}}function U5(r,e,t){var n=hT(e);function a(s){var o=s??Jc.message[t],i=new Error(o);return Error.captureStackTrace(i,a),pT(i,a.prototype),Object.defineProperty(i,"message",{enumerable:!0,configurable:!0,value:o,writable:!0}),Object.defineProperty(i,"name",{enumerable:!1,configurable:!0,value:n,writable:!0}),i}return _b(a,r),mT(a,n),a.prototype.status=t,a.prototype.statusCode=t,a.prototype.expose=!1,a}function mT(r,e){var t=Object.getOwnPropertyDescriptor(r,"name");t&&t.configurable&&(t.value=e,Object.defineProperty(r,"name",t))}function B5(r,e,t){e.forEach(function(a){var s,o=j5(Jc.message[a]);switch(dT(a)){case 400:s=D5(t,o,a);break;case 500:s=U5(t,o,a);break}s&&(r[a]=s,r[o]=s)})}function hT(r){return r.slice(-5)==="Error"?r:r+"Error"}});var gT=H((ile,fT)=>{var Xu=1e3,Yu=Xu*60,Zu=Yu*60,ep=Zu*24,F5=ep*365.25;fT.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return q5(r);if(t==="number"&&isNaN(r)===!1)return e.long?V5(r):G5(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function q5(r){if(r=String(r),!(r.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*F5;case"days":case"day":case"d":return t*ep;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Zu;case"minutes":case"minute":case"mins":case"min":case"m":return t*Yu;case"seconds":case"second":case"secs":case"sec":case"s":return t*Xu;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function G5(r){return r>=ep?Math.round(r/ep)+"d":r>=Zu?Math.round(r/Zu)+"h":r>=Yu?Math.round(r/Yu)+"m":r>=Xu?Math.round(r/Xu)+"s":r+"ms"}function V5(r){return rh(r,ep,"day")||rh(r,Zu,"hour")||rh(r,Yu,"minute")||rh(r,Xu,"second")||r+" ms"}function rh(r,e,t){if(!(r<e))return r<e*1.5?Math.floor(r/e)+" "+t:Math.ceil(r/e)+" "+t+"s"}});var Lb=H((Wt,yT)=>{Wt=yT.exports=$b.debug=$b.default=$b;Wt.coerce=J5;Wt.disable=W5;Wt.enable=H5;Wt.enabled=Q5;Wt.humanize=gT();Wt.names=[];Wt.skips=[];Wt.formatters={};var Pb;function z5(r){var e=0,t;for(t in r)e=(e<<5)-e+r.charCodeAt(t),e|=0;return Wt.colors[Math.abs(e)%Wt.colors.length]}function $b(r){function e(){if(e.enabled){var t=e,n=+new Date,a=n-(Pb||n);t.diff=a,t.prev=Pb,t.curr=n,Pb=n;for(var s=new Array(arguments.length),o=0;o<s.length;o++)s[o]=arguments[o];s[0]=Wt.coerce(s[0]),typeof s[0]!="string"&&s.unshift("%O");var i=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(c,p){if(c==="%%")return c;i++;var m=Wt.formatters[p];if(typeof m=="function"){var f=s[i];c=m.call(t,f),s.splice(i,1),i--}return c}),Wt.formatArgs.call(t,s);var u=e.log||Wt.log||console.log.bind(console);u.apply(t,s)}}return e.namespace=r,e.enabled=Wt.enabled(r),e.useColors=Wt.useColors(),e.color=z5(r),typeof Wt.init=="function"&&Wt.init(e),e}function H5(r){Wt.save(r),Wt.names=[],Wt.skips=[];for(var e=(typeof r=="string"?r:"").split(/[\s,]+/),t=e.length,n=0;n<t;n++)e[n]&&(r=e[n].replace(/\*/g,".*?"),r[0]==="-"?Wt.skips.push(new RegExp("^"+r.substr(1)+"$")):Wt.names.push(new RegExp("^"+r+"$")))}function W5(){Wt.enable("")}function Q5(r){var e,t;for(e=0,t=Wt.skips.length;e<t;e++)if(Wt.skips[e].test(r))return!1;for(e=0,t=Wt.names.length;e<t;e++)if(Wt.names[e].test(r))return!0;return!1}function J5(r){return r instanceof Error?r.stack||r.message:r}});var ET=H((An,vT)=>{An=vT.exports=Lb();An.log=Y5;An.formatArgs=X5;An.save=Z5;An.load=bT;An.useColors=K5;An.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:eG();An.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function K5(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}An.formatters.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function X5(r){var e=this.useColors;if(r[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+r[0]+(e?"%c ":" ")+"+"+An.humanize(this.diff),!!e){var t="color: "+this.color;r.splice(1,0,t,"color: inherit");var n=0,a=0;r[0].replace(/%[a-zA-Z%]/g,function(s){s!=="%%"&&(n++,s==="%c"&&(a=n))}),r.splice(a,0,t)}}function Y5(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function Z5(r){try{r==null?An.storage.removeItem("debug"):An.storage.debug=r}catch{}}function bT(){var r;try{r=An.storage.debug}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}An.enable(bT());function eG(){try{return window.localStorage}catch{}}});var RT=H((Kr,ST)=>{var CT=require("tty"),tp=require("util");Kr=ST.exports=Lb();Kr.init=iG;Kr.log=aG;Kr.formatArgs=nG;Kr.save=sG;Kr.load=AT;Kr.useColors=rG;Kr.colors=[6,2,3,4,5,1];Kr.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(a,s){return s.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});var Kc=parseInt(process.env.DEBUG_FD,10)||2;Kc!==1&&Kc!==2&&tp.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var tG=Kc===1?process.stdout:Kc===2?process.stderr:oG(Kc);function rG(){return"colors"in Kr.inspectOpts?!!Kr.inspectOpts.colors:CT.isatty(Kc)}Kr.formatters.o=function(r){return this.inspectOpts.colors=this.useColors,tp.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};Kr.formatters.O=function(r){return this.inspectOpts.colors=this.useColors,tp.inspect(r,this.inspectOpts)};function nG(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,a="  \x1B[3"+n+";1m"+e+" \x1B[0m";r[0]=a+r[0].split(`
`).join(`
`+a),r.push("\x1B[3"+n+"m+"+Kr.humanize(this.diff)+"\x1B[0m")}else r[0]=new Date().toUTCString()+" "+e+" "+r[0]}function aG(){return tG.write(tp.format.apply(tp,arguments)+`
`)}function sG(r){r==null?delete process.env.DEBUG:process.env.DEBUG=r}function AT(){return process.env.DEBUG}function oG(r){var e,t=process.binding("tty_wrap");switch(t.guessHandleType(r)){case"TTY":e=new CT.WriteStream(r),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(r,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var a=require("net");e=new a.Socket({fd:r,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=r,e._isStdio=!0,e}function iG(r){r.inspectOpts={};for(var e=Object.keys(Kr.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=Kr.inspectOpts[e[t]]}Kr.enable(AT())});var rp=H((cle,jb)=>{typeof process<"u"&&process.type==="renderer"?jb.exports=ET():jb.exports=RT()});var kb=H((lle,IT)=>{"use strict";var cG=require("events").EventEmitter,lG=require("fs").ReadStream,wT=require("stream"),yi=require("zlib");IT.exports=uG;function uG(r,e){return gG(r)?pG(r):yG(r)?mG(r):hG(r)&&r.destroy(),fG(r)&&e&&(r.removeAllListeners("error"),r.addListener("error",bG)),r}function pG(r){r.destroy(),typeof r.close=="function"&&r.on("open",EG)}function dG(r){if(r._hadError===!0){var e=r._binding===null?"_binding":"_handle";r[e]={close:function(){this[e]=null}}}r.close()}function mG(r){typeof r.destroy=="function"?r._binding?(r.destroy(),r._processing?(r._needDrain=!0,r.once("drain",vG)):r._binding.clear()):r._destroy&&r._destroy!==wT.Transform.prototype._destroy?r.destroy():r._destroy&&typeof r.close=="function"?(r.destroyed=!0,r.close()):r.destroy():typeof r.close=="function"&&dG(r)}function hG(r){return r instanceof wT&&typeof r.destroy=="function"}function fG(r){return r instanceof cG}function gG(r){return r instanceof lG}function yG(r){return r instanceof yi.Gzip||r instanceof yi.Gunzip||r instanceof yi.Deflate||r instanceof yi.DeflateRaw||r instanceof yi.Inflate||r instanceof yi.InflateRaw||r instanceof yi.Unzip}function bG(){}function vG(){this._binding.clear()}function EG(){typeof this.fd=="number"&&this.close()}});var xT=H((ule,CG)=>{CG.exports={"100":"Continue","101":"Switching Protocols","102":"Processing","103":"Early Hints","200":"OK","201":"Created","202":"Accepted","203":"Non-Authoritative Information","204":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","208":"Already Reported","226":"IM Used","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Temporary Redirect","308":"Permanent Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Timeout","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Payload Too Large","414":"URI Too Long","415":"Unsupported Media Type","416":"Range Not Satisfiable","417":"Expectation Failed","418":"I'm a Teapot","421":"Misdirected Request","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","425":"Too Early","426":"Upgrade Required","428":"Precondition Required","429":"Too Many Requests","431":"Request Header Fields Too Large","451":"Unavailable For Legal Reasons","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Timeout","505":"HTTP Version Not Supported","506":"Variant Also Negotiates","507":"Insufficient Storage","508":"Loop Detected","509":"Bandwidth Limit Exceeded","510":"Not Extended","511":"Network Authentication Required"}});var NT=H((ple,OT)=>{"use strict";var Db=xT();OT.exports=Pa;Pa.message=Db;Pa.code=AG(Db);Pa.codes=SG(Db);Pa.redirect={300:!0,301:!0,302:!0,303:!0,305:!0,307:!0,308:!0};Pa.empty={204:!0,205:!0,304:!0};Pa.retry={502:!0,503:!0,504:!0};function AG(r){var e={};return Object.keys(r).forEach(function(n){var a=r[n],s=Number(n);e[a.toLowerCase()]=s}),e}function SG(r){return Object.keys(r).map(function(t){return Number(t)})}function RG(r){var e=r.toLowerCase();if(!Object.prototype.hasOwnProperty.call(Pa.code,e))throw new Error('invalid status message: "'+r+'"');return Pa.code[e]}function TT(r){if(!Object.prototype.hasOwnProperty.call(Pa.message,r))throw new Error("invalid status code: "+r);return Pa.message[r]}function Pa(r){if(typeof r=="number")return TT(r);if(typeof r!="string")throw new TypeError("code must be a number or string");var e=parseInt(r,10);return isNaN(e)?RG(r):TT(e)}});var jT=H((dle,bi)=>{"use strict";var wG=ca()("http-errors"),_T=fi(),Xc=NT(),Mb=Ya(),IG=Zm();bi.exports=nh;bi.exports.HttpError=xG();bi.exports.isHttpError=OG(bi.exports.HttpError);_G(bi.exports,Xc.codes,bi.exports.HttpError);function PT(r){return+(String(r).charAt(0)+"00")}function nh(){for(var r,e,t=500,n={},a=0;a<arguments.length;a++){var s=arguments[a],o=typeof s;if(o==="object"&&s instanceof Error)r=s,t=r.status||r.statusCode||t;else if(o==="number"&&a===0)t=s;else if(o==="string")e=s;else if(o==="object")n=s;else throw new TypeError("argument #"+(a+1)+" unsupported type "+o)}typeof t=="number"&&(t<400||t>=600)&&wG("non-error status code; use only 4xx or 5xx status codes"),(typeof t!="number"||!Xc.message[t]&&(t<400||t>=600))&&(t=500);var i=nh[t]||nh[PT(t)];r||(r=i?new i(e):new Error(e||Xc.message[t]),Error.captureStackTrace(r,nh)),(!i||!(r instanceof i)||r.status!==t)&&(r.expose=t<500,r.status=r.statusCode=t);for(var u in n)u!=="status"&&u!=="statusCode"&&(r[u]=n[u]);return r}function xG(){function r(){throw new TypeError("cannot construct abstract class")}return Mb(r,Error),r}function TG(r,e,t){var n=LT(e);function a(s){var o=s??Xc.message[t],i=new Error(o);return Error.captureStackTrace(i,a),_T(i,a.prototype),Object.defineProperty(i,"message",{enumerable:!0,configurable:!0,value:o,writable:!0}),Object.defineProperty(i,"name",{enumerable:!1,configurable:!0,value:n,writable:!0}),i}return Mb(a,r),$T(a,n),a.prototype.status=t,a.prototype.statusCode=t,a.prototype.expose=!0,a}function OG(r){return function(t){return!t||typeof t!="object"?!1:t instanceof r?!0:t instanceof Error&&typeof t.expose=="boolean"&&typeof t.statusCode=="number"&&t.status===t.statusCode}}function NG(r,e,t){var n=LT(e);function a(s){var o=s??Xc.message[t],i=new Error(o);return Error.captureStackTrace(i,a),_T(i,a.prototype),Object.defineProperty(i,"message",{enumerable:!0,configurable:!0,value:o,writable:!0}),Object.defineProperty(i,"name",{enumerable:!1,configurable:!0,value:n,writable:!0}),i}return Mb(a,r),$T(a,n),a.prototype.status=t,a.prototype.statusCode=t,a.prototype.expose=!1,a}function $T(r,e){var t=Object.getOwnPropertyDescriptor(r,"name");t&&t.configurable&&(t.value=e,Object.defineProperty(r,"name",t))}function _G(r,e,t){e.forEach(function(a){var s,o=IG(Xc.message[a]);switch(PT(a)){case 400:s=TG(t,o,a);break;case 500:s=NG(t,o,a);break}s&&(r[a]=s,r[o]=s)})}function LT(r){return r.slice(-5)==="Error"?r:r+"Error"}});var vi=H((mle,kT)=>{"use strict";var ah=require("buffer"),Yc=ah.Buffer,la={},ua;for(ua in ah)ah.hasOwnProperty(ua)&&(ua==="SlowBuffer"||ua==="Buffer"||(la[ua]=ah[ua]));var Zc=la.Buffer={};for(ua in Yc)Yc.hasOwnProperty(ua)&&(ua==="allocUnsafe"||ua==="allocUnsafeSlow"||(Zc[ua]=Yc[ua]));la.Buffer.prototype=Yc.prototype;(!Zc.from||Zc.from===Uint8Array.from)&&(Zc.from=function(r,e,t){if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type '+typeof r);if(r&&typeof r.length>"u")throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);return Yc(r,e,t)});Zc.alloc||(Zc.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError('The "size" argument must be of type number. Received type '+typeof r);if(r<0||r>=2*(1<<30))throw new RangeError('The value "'+r+'" is invalid for option "size"');var n=Yc(r);return!e||e.length===0?n.fill(0):typeof t=="string"?n.fill(e,t):n.fill(e),n});if(!la.kStringMaxLength)try{la.kStringMaxLength=process.binding("buffer").kStringMaxLength}catch{}la.constants||(la.constants={MAX_LENGTH:la.kMaxLength},la.kStringMaxLength&&(la.constants.MAX_STRING_LENGTH=la.kStringMaxLength));kT.exports=la});var MT=H(Fb=>{"use strict";var DT="\uFEFF";Fb.PrependBOM=Ub;function Ub(r,e){this.encoder=r,this.addBOM=!0}Ub.prototype.write=function(r){return this.addBOM&&(r=DT+r,this.addBOM=!1),this.encoder.write(r)};Ub.prototype.end=function(){return this.encoder.end()};Fb.StripBOM=Bb;function Bb(r,e){this.decoder=r,this.pass=!1,this.options=e||{}}Bb.prototype.write=function(r){var e=this.decoder.write(r);return this.pass||!e||(e[0]===DT&&(e=e.slice(1),typeof this.options.stripBOM=="function"&&this.options.stripBOM()),this.pass=!0),e};Bb.prototype.end=function(){return this.decoder.end()}});var FT=H((fle,BT)=>{"use strict";var np=vi().Buffer;BT.exports={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:qb};function qb(r,e){this.enc=r.encodingName,this.bomAware=r.bomAware,this.enc==="base64"?this.encoder=Vb:this.enc==="cesu8"&&(this.enc="utf8",this.encoder=zb,np.from("eda0bdedb2a9","hex").toString()!=="\u{1F4A9}"&&(this.decoder=Hb,this.defaultCharUnicode=e.defaultCharUnicode))}qb.prototype.encoder=Gb;qb.prototype.decoder=UT;var sh=require("string_decoder").StringDecoder;sh.prototype.end||(sh.prototype.end=function(){});function UT(r,e){sh.call(this,e.enc)}UT.prototype=sh.prototype;function Gb(r,e){this.enc=e.enc}Gb.prototype.write=function(r){return np.from(r,this.enc)};Gb.prototype.end=function(){};function Vb(r,e){this.prevStr=""}Vb.prototype.write=function(r){r=this.prevStr+r;var e=r.length-r.length%4;return this.prevStr=r.slice(e),r=r.slice(0,e),np.from(r,"base64")};Vb.prototype.end=function(){return np.from(this.prevStr,"base64")};function zb(r,e){}zb.prototype.write=function(r){for(var e=np.alloc(r.length*3),t=0,n=0;n<r.length;n++){var a=r.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=192+(a>>>6),e[t++]=128+(a&63)):(e[t++]=224+(a>>>12),e[t++]=128+(a>>>6&63),e[t++]=128+(a&63))}return e.slice(0,t)};zb.prototype.end=function(){};function Hb(r,e){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=e.defaultCharUnicode}Hb.prototype.write=function(r){for(var e=this.acc,t=this.contBytes,n=this.accBytes,a="",s=0;s<r.length;s++){var o=r[s];(o&192)!==128?(t>0&&(a+=this.defaultCharUnicode,t=0),o<128?a+=String.fromCharCode(o):o<224?(e=o&31,t=1,n=1):o<240?(e=o&15,t=2,n=1):a+=this.defaultCharUnicode):t>0?(e=e<<6|o&63,t--,n++,t===0&&(n===2&&e<128&&e>0?a+=this.defaultCharUnicode:n===3&&e<2048?a+=this.defaultCharUnicode:a+=String.fromCharCode(e))):a+=this.defaultCharUnicode}return this.acc=e,this.contBytes=t,this.accBytes=n,a};Hb.prototype.end=function(){var r=0;return this.contBytes>0&&(r+=this.defaultCharUnicode),r}});var GT=H(Yb=>{"use strict";var oh=vi().Buffer;Yb.utf16be=ih;function ih(){}ih.prototype.encoder=Wb;ih.prototype.decoder=Qb;ih.prototype.bomAware=!0;function Wb(){}Wb.prototype.write=function(r){for(var e=oh.from(r,"ucs2"),t=0;t<e.length;t+=2){var n=e[t];e[t]=e[t+1],e[t+1]=n}return e};Wb.prototype.end=function(){};function Qb(){this.overflowByte=-1}Qb.prototype.write=function(r){if(r.length==0)return"";var e=oh.alloc(r.length+1),t=0,n=0;for(this.overflowByte!==-1&&(e[0]=r[0],e[1]=this.overflowByte,t=1,n=2);t<r.length-1;t+=2,n+=2)e[n]=r[t+1],e[n+1]=r[t];return this.overflowByte=t==r.length-1?r[r.length-1]:-1,e.slice(0,n).toString("ucs2")};Qb.prototype.end=function(){};Yb.utf16=Jb;function Jb(r,e){this.iconv=e}Jb.prototype.encoder=Kb;Jb.prototype.decoder=Xb;function Kb(r,e){r=r||{},r.addBOM===void 0&&(r.addBOM=!0),this.encoder=e.iconv.getEncoder("utf-16le",r)}Kb.prototype.write=function(r){return this.encoder.write(r)};Kb.prototype.end=function(){return this.encoder.end()};function Xb(r,e){this.decoder=null,this.initialBytes=[],this.initialBytesLen=0,this.options=r||{},this.iconv=e.iconv}Xb.prototype.write=function(r){if(!this.decoder){if(this.initialBytes.push(r),this.initialBytesLen+=r.length,this.initialBytesLen<16)return"";var r=oh.concat(this.initialBytes),e=qT(r,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(e,this.options),this.initialBytes.length=this.initialBytesLen=0}return this.decoder.write(r)};Xb.prototype.end=function(){if(!this.decoder){var r=oh.concat(this.initialBytes),e=qT(r,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(e,this.options);var t=this.decoder.write(r),n=this.decoder.end();return n?t+n:t}return this.decoder.end()};function qT(r,e){var t=e||"utf-16le";if(r.length>=2)if(r[0]==254&&r[1]==255)t="utf-16be";else if(r[0]==255&&r[1]==254)t="utf-16le";else{for(var n=0,a=0,s=Math.min(r.length-r.length%2,64),o=0;o<s;o+=2)r[o]===0&&r[o+1]!==0&&a++,r[o]!==0&&r[o+1]===0&&n++;a>n?t="utf-16be":a<n&&(t="utf-16le")}return t}});var zT=H(uh=>{"use strict";var Za=vi().Buffer;uh.utf7=ch;uh.unicode11utf7="utf7";function ch(r,e){this.iconv=e}ch.prototype.encoder=ev;ch.prototype.decoder=tv;ch.prototype.bomAware=!0;var PG=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;function ev(r,e){this.iconv=e.iconv}ev.prototype.write=function(r){return Za.from(r.replace(PG,function(e){return"+"+(e==="+"?"":this.iconv.encode(e,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))};ev.prototype.end=function(){};function tv(r,e){this.iconv=e.iconv,this.inBase64=!1,this.base64Accum=""}var $G=/[A-Za-z0-9\/+]/,rv=[];for(ap=0;ap<256;ap++)rv[ap]=$G.test(String.fromCharCode(ap));var ap,LG=43,Ei=45,Zb=38;tv.prototype.write=function(r){for(var e="",t=0,n=this.inBase64,a=this.base64Accum,s=0;s<r.length;s++)if(!n)r[s]==LG&&(e+=this.iconv.decode(r.slice(t,s),"ascii"),t=s+1,n=!0);else if(!rv[r[s]]){if(s==t&&r[s]==Ei)e+="+";else{var o=a+r.slice(t,s).toString();e+=this.iconv.decode(Za.from(o,"base64"),"utf16-be")}r[s]!=Ei&&s--,t=s+1,n=!1,a=""}if(!n)e+=this.iconv.decode(r.slice(t),"ascii");else{var o=a+r.slice(t).toString(),i=o.length-o.length%8;a=o.slice(i),o=o.slice(0,i),e+=this.iconv.decode(Za.from(o,"base64"),"utf16-be")}return this.inBase64=n,this.base64Accum=a,e};tv.prototype.end=function(){var r="";return this.inBase64&&this.base64Accum.length>0&&(r=this.iconv.decode(Za.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",r};uh.utf7imap=lh;function lh(r,e){this.iconv=e}lh.prototype.encoder=nv;lh.prototype.decoder=av;lh.prototype.bomAware=!0;function nv(r,e){this.iconv=e.iconv,this.inBase64=!1,this.base64Accum=Za.alloc(6),this.base64AccumIdx=0}nv.prototype.write=function(r){for(var e=this.inBase64,t=this.base64Accum,n=this.base64AccumIdx,a=Za.alloc(r.length*5+10),s=0,o=0;o<r.length;o++){var i=r.charCodeAt(o);32<=i&&i<=126?(e&&(n>0&&(s+=a.write(t.slice(0,n).toString("base64").replace(/\//g,",").replace(/=+$/,""),s),n=0),a[s++]=Ei,e=!1),e||(a[s++]=i,i===Zb&&(a[s++]=Ei))):(e||(a[s++]=Zb,e=!0),e&&(t[n++]=i>>8,t[n++]=i&255,n==t.length&&(s+=a.write(t.toString("base64").replace(/\//g,","),s),n=0)))}return this.inBase64=e,this.base64AccumIdx=n,a.slice(0,s)};nv.prototype.end=function(){var r=Za.alloc(10),e=0;return this.inBase64&&(this.base64AccumIdx>0&&(e+=r.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),e),this.base64AccumIdx=0),r[e++]=Ei,this.inBase64=!1),r.slice(0,e)};function av(r,e){this.iconv=e.iconv,this.inBase64=!1,this.base64Accum=""}var VT=rv.slice();VT[44]=!0;av.prototype.write=function(r){for(var e="",t=0,n=this.inBase64,a=this.base64Accum,s=0;s<r.length;s++)if(!n)r[s]==Zb&&(e+=this.iconv.decode(r.slice(t,s),"ascii"),t=s+1,n=!0);else if(!VT[r[s]]){if(s==t&&r[s]==Ei)e+="&";else{var o=a+r.slice(t,s).toString().replace(/,/g,"/");e+=this.iconv.decode(Za.from(o,"base64"),"utf16-be")}r[s]!=Ei&&s--,t=s+1,n=!1,a=""}if(!n)e+=this.iconv.decode(r.slice(t),"ascii");else{var o=a+r.slice(t).toString().replace(/,/g,"/"),i=o.length-o.length%8;a=o.slice(i),o=o.slice(0,i),e+=this.iconv.decode(Za.from(o,"base64"),"utf16-be")}return this.inBase64=n,this.base64Accum=a,e};av.prototype.end=function(){var r="";return this.inBase64&&this.base64Accum.length>0&&(r=this.iconv.decode(Za.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",r}});var WT=H(HT=>{"use strict";var ph=vi().Buffer;HT._sbcs=sv;function sv(r,e){if(!r)throw new Error("SBCS codec is called without the data.");if(!r.chars||r.chars.length!==128&&r.chars.length!==256)throw new Error("Encoding '"+r.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(r.chars.length===128){for(var t="",n=0;n<128;n++)t+=String.fromCharCode(n);r.chars=t+r.chars}this.decodeBuf=ph.from(r.chars,"ucs2");for(var a=ph.alloc(65536,e.defaultCharSingleByte.charCodeAt(0)),n=0;n<r.chars.length;n++)a[r.chars.charCodeAt(n)]=n;this.encodeBuf=a}sv.prototype.encoder=ov;sv.prototype.decoder=iv;function ov(r,e){this.encodeBuf=e.encodeBuf}ov.prototype.write=function(r){for(var e=ph.alloc(r.length),t=0;t<r.length;t++)e[t]=this.encodeBuf[r.charCodeAt(t)];return e};ov.prototype.end=function(){};function iv(r,e){this.decodeBuf=e.decodeBuf}iv.prototype.write=function(r){for(var e=this.decodeBuf,t=ph.alloc(r.length*2),n=0,a=0,s=0;s<r.length;s++)n=r[s]*2,a=s*2,t[a]=e[n],t[a+1]=e[n+1];return t.toString("ucs2")};iv.prototype.end=function(){}});var JT=H((vle,QT)=>{"use strict";QT.exports={10029:"maccenteuro",maccenteuro:{type:"_sbcs",chars:"\xC4\u0100\u0101\xC9\u0104\xD6\xDC\xE1\u0105\u010C\xE4\u010D\u0106\u0107\xE9\u0179\u017A\u010E\xED\u010F\u0112\u0113\u0116\xF3\u0117\xF4\xF6\xF5\xFA\u011A\u011B\xFC\u2020\xB0\u0118\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\u0119\xA8\u2260\u0123\u012E\u012F\u012A\u2264\u2265\u012B\u0136\u2202\u2211\u0142\u013B\u013C\u013D\u013E\u0139\u013A\u0145\u0146\u0143\xAC\u221A\u0144\u0147\u2206\xAB\xBB\u2026\xA0\u0148\u0150\xD5\u0151\u014C\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\u014D\u0154\u0155\u0158\u2039\u203A\u0159\u0156\u0157\u0160\u201A\u201E\u0161\u015A\u015B\xC1\u0164\u0165\xCD\u017D\u017E\u016A\xD3\xD4\u016B\u016E\xDA\u016F\u0170\u0171\u0172\u0173\xDD\xFD\u0137\u017B\u0141\u017C\u0122\u02C7"},808:"cp808",ibm808:"cp808",cp808:{type:"_sbcs",chars:"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F\u0401\u0451\u0404\u0454\u0407\u0457\u040E\u045E\xB0\u2219\xB7\u221A\u2116\u20AC\u25A0\xA0"},mik:{type:"_sbcs",chars:"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F\u2514\u2534\u252C\u251C\u2500\u253C\u2563\u2551\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2510\u2591\u2592\u2593\u2502\u2524\u2116\xA7\u2557\u255D\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0"},ascii8bit:"ascii",usascii:"ascii",ansix34:"ascii",ansix341968:"ascii",ansix341986:"ascii",csascii:"ascii",cp367:"ascii",ibm367:"ascii",isoir6:"ascii",iso646us:"ascii",iso646irv:"ascii",us:"ascii",latin1:"iso88591",latin2:"iso88592",latin3:"iso88593",latin4:"iso88594",latin5:"iso88599",latin6:"iso885910",latin7:"iso885913",latin8:"iso885914",latin9:"iso885915",latin10:"iso885916",csisolatin1:"iso88591",csisolatin2:"iso88592",csisolatin3:"iso88593",csisolatin4:"iso88594",csisolatincyrillic:"iso88595",csisolatinarabic:"iso88596",csisolatingreek:"iso88597",csisolatinhebrew:"iso88598",csisolatin5:"iso88599",csisolatin6:"iso885910",l1:"iso88591",l2:"iso88592",l3:"iso88593",l4:"iso88594",l5:"iso88599",l6:"iso885910",l7:"iso885913",l8:"iso885914",l9:"iso885915",l10:"iso885916",isoir14:"iso646jp",isoir57:"iso646cn",isoir100:"iso88591",isoir101:"iso88592",isoir109:"iso88593",isoir110:"iso88594",isoir144:"iso88595",isoir127:"iso88596",isoir126:"iso88597",isoir138:"iso88598",isoir148:"iso88599",isoir157:"iso885910",isoir166:"tis620",isoir179:"iso885913",isoir199:"iso885914",isoir203:"iso885915",isoir226:"iso885916",cp819:"iso88591",ibm819:"iso88591",cyrillic:"iso88595",arabic:"iso88596",arabic8:"iso88596",ecma114:"iso88596",asmo708:"iso88596",greek:"iso88597",greek8:"iso88597",ecma118:"iso88597",elot928:"iso88597",hebrew:"iso88598",hebrew8:"iso88598",turkish:"iso88599",turkish8:"iso88599",thai:"iso885911",thai8:"iso885911",celtic:"iso885914",celtic8:"iso885914",isoceltic:"iso885914",tis6200:"tis620",tis62025291:"tis620",tis62025330:"tis620",1e4:"macroman",10006:"macgreek",10007:"maccyrillic",10079:"maciceland",10081:"macturkish",cspc8codepage437:"cp437",cspc775baltic:"cp775",cspc850multilingual:"cp850",cspcp852:"cp852",cspc862latinhebrew:"cp862",cpgr:"cp869",msee:"cp1250",mscyrl:"cp1251",msansi:"cp1252",msgreek:"cp1253",msturk:"cp1254",mshebr:"cp1255",msarab:"cp1256",winbaltrim:"cp1257",cp20866:"koi8r",20866:"koi8r",ibm878:"koi8r",cskoi8r:"koi8r",cp21866:"koi8u",21866:"koi8u",ibm1168:"koi8u",strk10482002:"rk1048",tcvn5712:"tcvn",tcvn57121:"tcvn",gb198880:"iso646cn",cn:"iso646cn",csiso14jisc6220ro:"iso646jp",jisc62201969ro:"iso646jp",jp:"iso646jp",cshproman8:"hproman8",r8:"hproman8",roman8:"hproman8",xroman8:"hproman8",ibm1051:"hproman8",mac:"macintosh",csmacintosh:"macintosh"}});var XT=H((Ele,KT)=>{"use strict";KT.exports={437:"cp437",737:"cp737",775:"cp775",850:"cp850",852:"cp852",855:"cp855",856:"cp856",857:"cp857",858:"cp858",860:"cp860",861:"cp861",862:"cp862",863:"cp863",864:"cp864",865:"cp865",866:"cp866",869:"cp869",874:"windows874",922:"cp922",1046:"cp1046",1124:"cp1124",1125:"cp1125",1129:"cp1129",1133:"cp1133",1161:"cp1161",1162:"cp1162",1163:"cp1163",1250:"windows1250",1251:"windows1251",1252:"windows1252",1253:"windows1253",1254:"windows1254",1255:"windows1255",1256:"windows1256",1257:"windows1257",1258:"windows1258",28591:"iso88591",28592:"iso88592",28593:"iso88593",28594:"iso88594",28595:"iso88595",28596:"iso88596",28597:"iso88597",28598:"iso88598",28599:"iso88599",28600:"iso885910",28601:"iso885911",28603:"iso885913",28604:"iso885914",28605:"iso885915",28606:"iso885916",windows874:{type:"_sbcs",chars:"\u20AC\uFFFD\uFFFD\uFFFD\uFFFD\u2026\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\xA0\u0E01\u0E02\u0E03\u0E04\u0E05\u0E06\u0E07\u0E08\u0E09\u0E0A\u0E0B\u0E0C\u0E0D\u0E0E\u0E0F\u0E10\u0E11\u0E12\u0E13\u0E14\u0E15\u0E16\u0E17\u0E18\u0E19\u0E1A\u0E1B\u0E1C\u0E1D\u0E1E\u0E1F\u0E20\u0E21\u0E22\u0E23\u0E24\u0E25\u0E26\u0E27\u0E28\u0E29\u0E2A\u0E2B\u0E2C\u0E2D\u0E2E\u0E2F\u0E30\u0E31\u0E32\u0E33\u0E34\u0E35\u0E36\u0E37\u0E38\u0E39\u0E3A\uFFFD\uFFFD\uFFFD\uFFFD\u0E3F\u0E40\u0E41\u0E42\u0E43\u0E44\u0E45\u0E46\u0E47\u0E48\u0E49\u0E4A\u0E4B\u0E4C\u0E4D\u0E4E\u0E4F\u0E50\u0E51\u0E52\u0E53\u0E54\u0E55\u0E56\u0E57\u0E58\u0E59\u0E5A\u0E5B\uFFFD\uFFFD\uFFFD\uFFFD"},win874:"windows874",cp874:"windows874",windows1250:{type:"_sbcs",chars:"\u20AC\uFFFD\u201A\uFFFD\u201E\u2026\u2020\u2021\uFFFD\u2030\u0160\u2039\u015A\u0164\u017D\u0179\uFFFD\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0161\u203A\u015B\u0165\u017E\u017A\xA0\u02C7\u02D8\u0141\xA4\u0104\xA6\xA7\xA8\xA9\u015E\xAB\xAC\xAD\xAE\u017B\xB0\xB1\u02DB\u0142\xB4\xB5\xB6\xB7\xB8\u0105\u015F\xBB\u013D\u02DD\u013E\u017C\u0154\xC1\xC2\u0102\xC4\u0139\u0106\xC7\u010C\xC9\u0118\xCB\u011A\xCD\xCE\u010E\u0110\u0143\u0147\xD3\xD4\u0150\xD6\xD7\u0158\u016E\xDA\u0170\xDC\xDD\u0162\xDF\u0155\xE1\xE2\u0103\xE4\u013A\u0107\xE7\u010D\xE9\u0119\xEB\u011B\xED\xEE\u010F\u0111\u0144\u0148\xF3\xF4\u0151\xF6\xF7\u0159\u016F\xFA\u0171\xFC\xFD\u0163\u02D9"},win1250:"windows1250",cp1250:"windows1250",windows1251:{type:"_sbcs",chars:"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\xA0\u040E\u045E\u0408\xA4\u0490\xA6\xA7\u0401\xA9\u0404\xAB\xAC\xAD\xAE\u0407\xB0\xB1\u0406\u0456\u0491\xB5\xB6\xB7\u0451\u2116\u0454\xBB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"},win1251:"windows1251",cp1251:"windows1251",windows1252:{type:"_sbcs",chars:"\u20AC\uFFFD\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\u0160\u2039\u0152\uFFFD\u017D\uFFFD\uFFFD\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u02DC\u2122\u0161\u203A\u0153\uFFFD\u017E\u0178\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xBA\xBB\xBC\xBD\xBE\xBF\xC0\xC1\xC2\xC3\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\xD0\xD1\xD2\xD3\xD4\xD5\xD6\xD7\xD8\xD9\xDA\xDB\xDC\xDD\xDE\xDF\xE0\xE1\xE2\xE3\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\xF0\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xF8\xF9\xFA\xFB\xFC\xFD\xFE\xFF"},win1252:"windows1252",cp1252:"windows1252",windows1253:{type:"_sbcs",chars:"\u20AC\uFFFD\u201A\u0192\u201E\u2026\u2020\u2021\uFFFD\u2030\uFFFD\u2039\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\uFFFD\u203A\uFFFD\uFFFD\uFFFD\uFFFD\xA0\u0385\u0386\xA3\xA4\xA5\xA6\xA7\xA8\xA9\uFFFD\xAB\xAC\xAD\xAE\u2015\xB0\xB1\xB2\xB3\u0384\xB5\xB6\xB7\u0388\u0389\u038A\xBB\u038C\xBD\u038E\u038F\u0390\u0391\u0392\u0393\u0394\u0395\u0396\u0397\u0398\u0399\u039A\u039B\u039C\u039D\u039E\u039F\u03A0\u03A1\uFFFD\u03A3\u03A4\u03A5\u03A6\u03A7\u03A8\u03A9\u03AA\u03AB\u03AC\u03AD\u03AE\u03AF\u03B0\u03B1\u03B2\u03B3\u03B4\u03B5\u03B6\u03B7\u03B8\u03B9\u03BA\u03BB\u03BC\u03BD\u03BE\u03BF\u03C0\u03C1\u03C2\u03C3\u03C4\u03C5\u03C6\u03C7\u03C8\u03C9\u03CA\u03CB\u03CC\u03CD\u03CE\uFFFD"},win1253:"windows1253",cp1253:"windows1253",windows1254:{type:"_sbcs",chars:"\u20AC\uFFFD\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\u0160\u2039\u0152\uFFFD\uFFFD\uFFFD\uFFFD\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u02DC\u2122\u0161\u203A\u0153\uFFFD\uFFFD\u0178\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xBA\xBB\xBC\xBD\xBE\xBF\xC0\xC1\xC2\xC3\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\u011E\xD1\xD2\xD3\xD4\xD5\xD6\xD7\xD8\xD9\xDA\xDB\xDC\u0130\u015E\xDF\xE0\xE1\xE2\xE3\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\u011F\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xF8\xF9\xFA\xFB\xFC\u0131\u015F\xFF"},win1254:"windows1254",cp1254:"windows1254",windows1255:{type:"_sbcs",chars:"\u20AC\uFFFD\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\uFFFD\u2039\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u02DC\u2122\uFFFD\u203A\uFFFD\uFFFD\uFFFD\uFFFD\xA0\xA1\xA2\xA3\u20AA\xA5\xA6\xA7\xA8\xA9\xD7\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xF7\xBB\xBC\xBD\xBE\xBF\u05B0\u05B1\u05B2\u05B3\u05B4\u05B5\u05B6\u05B7\u05B8\u05B9\u05BA\u05BB\u05BC\u05BD\u05BE\u05BF\u05C0\u05C1\u05C2\u05C3\u05F0\u05F1\u05F2\u05F3\u05F4\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u05D0\u05D1\u05D2\u05D3\u05D4\u05D5\u05D6\u05D7\u05D8\u05D9\u05DA\u05DB\u05DC\u05DD\u05DE\u05DF\u05E0\u05E1\u05E2\u05E3\u05E4\u05E5\u05E6\u05E7\u05E8\u05E9\u05EA\uFFFD\uFFFD\u200E\u200F\uFFFD"},win1255:"windows1255",cp1255:"windows1255",windows1256:{type:"_sbcs",chars:"\u20AC\u067E\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\u0679\u2039\u0152\u0686\u0698\u0688\u06AF\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u06A9\u2122\u0691\u203A\u0153\u200C\u200D\u06BA\xA0\u060C\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\u06BE\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\u061B\xBB\xBC\xBD\xBE\u061F\u06C1\u0621\u0622\u0623\u0624\u0625\u0626\u0627\u0628\u0629\u062A\u062B\u062C\u062D\u062E\u062F\u0630\u0631\u0632\u0633\u0634\u0635\u0636\xD7\u0637\u0638\u0639\u063A\u0640\u0641\u0642\u0643\xE0\u0644\xE2\u0645\u0646\u0647\u0648\xE7\xE8\xE9\xEA\xEB\u0649\u064A\xEE\xEF\u064B\u064C\u064D\u064E\xF4\u064F\u0650\xF7\u0651\xF9\u0652\xFB\xFC\u200E\u200F\u06D2"},win1256:"windows1256",cp1256:"windows1256",windows1257:{type:"_sbcs",chars:"\u20AC\uFFFD\u201A\uFFFD\u201E\u2026\u2020\u2021\uFFFD\u2030\uFFFD\u2039\uFFFD\xA8\u02C7\xB8\uFFFD\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\uFFFD\u203A\uFFFD\xAF\u02DB\uFFFD\xA0\uFFFD\xA2\xA3\xA4\uFFFD\xA6\xA7\xD8\xA9\u0156\xAB\xAC\xAD\xAE\xC6\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xF8\xB9\u0157\xBB\xBC\xBD\xBE\xE6\u0104\u012E\u0100\u0106\xC4\xC5\u0118\u0112\u010C\xC9\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\xD3\u014C\xD5\xD6\xD7\u0172\u0141\u015A\u016A\xDC\u017B\u017D\xDF\u0105\u012F\u0101\u0107\xE4\xE5\u0119\u0113\u010D\xE9\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\xF3\u014D\xF5\xF6\xF7\u0173\u0142\u015B\u016B\xFC\u017C\u017E\u02D9"},win1257:"windows1257",cp1257:"windows1257",windows1258:{type:"_sbcs",chars:"\u20AC\uFFFD\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\uFFFD\u2039\u0152\uFFFD\uFFFD\uFFFD\uFFFD\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u02DC\u2122\uFFFD\u203A\u0153\uFFFD\uFFFD\u0178\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xBA\xBB\xBC\xBD\xBE\xBF\xC0\xC1\xC2\u0102\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\u0300\xCD\xCE\xCF\u0110\xD1\u0309\xD3\xD4\u01A0\xD6\xD7\xD8\xD9\xDA\xDB\xDC\u01AF\u0303\xDF\xE0\xE1\xE2\u0103\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\u0301\xED\xEE\xEF\u0111\xF1\u0323\xF3\xF4\u01A1\xF6\xF7\xF8\xF9\xFA\xFB\xFC\u01B0\u20AB\xFF"},win1258:"windows1258",cp1258:"windows1258",iso88591:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xBA\xBB\xBC\xBD\xBE\xBF\xC0\xC1\xC2\xC3\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\xD0\xD1\xD2\xD3\xD4\xD5\xD6\xD7\xD8\xD9\xDA\xDB\xDC\xDD\xDE\xDF\xE0\xE1\xE2\xE3\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\xF0\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xF8\xF9\xFA\xFB\xFC\xFD\xFE\xFF"},cp28591:"iso88591",iso88592:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0104\u02D8\u0141\xA4\u013D\u015A\xA7\xA8\u0160\u015E\u0164\u0179\xAD\u017D\u017B\xB0\u0105\u02DB\u0142\xB4\u013E\u015B\u02C7\xB8\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\xC1\xC2\u0102\xC4\u0139\u0106\xC7\u010C\xC9\u0118\xCB\u011A\xCD\xCE\u010E\u0110\u0143\u0147\xD3\xD4\u0150\xD6\xD7\u0158\u016E\xDA\u0170\xDC\xDD\u0162\xDF\u0155\xE1\xE2\u0103\xE4\u013A\u0107\xE7\u010D\xE9\u0119\xEB\u011B\xED\xEE\u010F\u0111\u0144\u0148\xF3\xF4\u0151\xF6\xF7\u0159\u016F\xFA\u0171\xFC\xFD\u0163\u02D9"},cp28592:"iso88592",iso88593:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0126\u02D8\xA3\xA4\uFFFD\u0124\xA7\xA8\u0130\u015E\u011E\u0134\xAD\uFFFD\u017B\xB0\u0127\xB2\xB3\xB4\xB5\u0125\xB7\xB8\u0131\u015F\u011F\u0135\xBD\uFFFD\u017C\xC0\xC1\xC2\uFFFD\xC4\u010A\u0108\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\uFFFD\xD1\xD2\xD3\xD4\u0120\xD6\xD7\u011C\xD9\xDA\xDB\xDC\u016C\u015C\xDF\xE0\xE1\xE2\uFFFD\xE4\u010B\u0109\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\uFFFD\xF1\xF2\xF3\xF4\u0121\xF6\xF7\u011D\xF9\xFA\xFB\xFC\u016D\u015D\u02D9"},cp28593:"iso88593",iso88594:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0104\u0138\u0156\xA4\u0128\u013B\xA7\xA8\u0160\u0112\u0122\u0166\xAD\u017D\xAF\xB0\u0105\u02DB\u0157\xB4\u0129\u013C\u02C7\xB8\u0161\u0113\u0123\u0167\u014A\u017E\u014B\u0100\xC1\xC2\xC3\xC4\xC5\xC6\u012E\u010C\xC9\u0118\xCB\u0116\xCD\xCE\u012A\u0110\u0145\u014C\u0136\xD4\xD5\xD6\xD7\xD8\u0172\xDA\xDB\xDC\u0168\u016A\xDF\u0101\xE1\xE2\xE3\xE4\xE5\xE6\u012F\u010D\xE9\u0119\xEB\u0117\xED\xEE\u012B\u0111\u0146\u014D\u0137\xF4\xF5\xF6\xF7\xF8\u0173\xFA\xFB\xFC\u0169\u016B\u02D9"},cp28594:"iso88594",iso88595:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0401\u0402\u0403\u0404\u0405\u0406\u0407\u0408\u0409\u040A\u040B\u040C\xAD\u040E\u040F\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F\u2116\u0451\u0452\u0453\u0454\u0455\u0456\u0457\u0458\u0459\u045A\u045B\u045C\xA7\u045E\u045F"},cp28595:"iso88595",iso88596:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\uFFFD\uFFFD\uFFFD\xA4\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u060C\xAD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u061B\uFFFD\uFFFD\uFFFD\u061F\uFFFD\u0621\u0622\u0623\u0624\u0625\u0626\u0627\u0628\u0629\u062A\u062B\u062C\u062D\u062E\u062F\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063A\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u0640\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u0649\u064A\u064B\u064C\u064D\u064E\u064F\u0650\u0651\u0652\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD"},cp28596:"iso88596",iso88597:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u2018\u2019\xA3\u20AC\u20AF\xA6\xA7\xA8\xA9\u037A\xAB\xAC\xAD\uFFFD\u2015\xB0\xB1\xB2\xB3\u0384\u0385\u0386\xB7\u0388\u0389\u038A\xBB\u038C\xBD\u038E\u038F\u0390\u0391\u0392\u0393\u0394\u0395\u0396\u0397\u0398\u0399\u039A\u039B\u039C\u039D\u039E\u039F\u03A0\u03A1\uFFFD\u03A3\u03A4\u03A5\u03A6\u03A7\u03A8\u03A9\u03AA\u03AB\u03AC\u03AD\u03AE\u03AF\u03B0\u03B1\u03B2\u03B3\u03B4\u03B5\u03B6\u03B7\u03B8\u03B9\u03BA\u03BB\u03BC\u03BD\u03BE\u03BF\u03C0\u03C1\u03C2\u03C3\u03C4\u03C5\u03C6\u03C7\u03C8\u03C9\u03CA\u03CB\u03CC\u03CD\u03CE\uFFFD"},cp28597:"iso88597",iso88598:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\uFFFD\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xD7\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xF7\xBB\xBC\xBD\xBE\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u2017\u05D0\u05D1\u05D2\u05D3\u05D4\u05D5\u05D6\u05D7\u05D8\u05D9\u05DA\u05DB\u05DC\u05DD\u05DE\u05DF\u05E0\u05E1\u05E2\u05E3\u05E4\u05E5\u05E6\u05E7\u05E8\u05E9\u05EA\uFFFD\uFFFD\u200E\u200F\uFFFD"},cp28598:"iso88598",iso88599:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xBA\xBB\xBC\xBD\xBE\xBF\xC0\xC1\xC2\xC3\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\u011E\xD1\xD2\xD3\xD4\xD5\xD6\xD7\xD8\xD9\xDA\xDB\xDC\u0130\u015E\xDF\xE0\xE1\xE2\xE3\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\u011F\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xF8\xF9\xFA\xFB\xFC\u0131\u015F\xFF"},cp28599:"iso88599",iso885910:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0104\u0112\u0122\u012A\u0128\u0136\xA7\u013B\u0110\u0160\u0166\u017D\xAD\u016A\u014A\xB0\u0105\u0113\u0123\u012B\u0129\u0137\xB7\u013C\u0111\u0161\u0167\u017E\u2015\u016B\u014B\u0100\xC1\xC2\xC3\xC4\xC5\xC6\u012E\u010C\xC9\u0118\xCB\u0116\xCD\xCE\xCF\xD0\u0145\u014C\xD3\xD4\xD5\xD6\u0168\xD8\u0172\xDA\xDB\xDC\xDD\xDE\xDF\u0101\xE1\xE2\xE3\xE4\xE5\xE6\u012F\u010D\xE9\u0119\xEB\u0117\xED\xEE\xEF\xF0\u0146\u014D\xF3\xF4\xF5\xF6\u0169\xF8\u0173\xFA\xFB\xFC\xFD\xFE\u0138"},cp28600:"iso885910",iso885911:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0E01\u0E02\u0E03\u0E04\u0E05\u0E06\u0E07\u0E08\u0E09\u0E0A\u0E0B\u0E0C\u0E0D\u0E0E\u0E0F\u0E10\u0E11\u0E12\u0E13\u0E14\u0E15\u0E16\u0E17\u0E18\u0E19\u0E1A\u0E1B\u0E1C\u0E1D\u0E1E\u0E1F\u0E20\u0E21\u0E22\u0E23\u0E24\u0E25\u0E26\u0E27\u0E28\u0E29\u0E2A\u0E2B\u0E2C\u0E2D\u0E2E\u0E2F\u0E30\u0E31\u0E32\u0E33\u0E34\u0E35\u0E36\u0E37\u0E38\u0E39\u0E3A\uFFFD\uFFFD\uFFFD\uFFFD\u0E3F\u0E40\u0E41\u0E42\u0E43\u0E44\u0E45\u0E46\u0E47\u0E48\u0E49\u0E4A\u0E4B\u0E4C\u0E4D\u0E4E\u0E4F\u0E50\u0E51\u0E52\u0E53\u0E54\u0E55\u0E56\u0E57\u0E58\u0E59\u0E5A\u0E5B\uFFFD\uFFFD\uFFFD\uFFFD"},cp28601:"iso885911",iso885913:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u201D\xA2\xA3\xA4\u201E\xA6\xA7\xD8\xA9\u0156\xAB\xAC\xAD\xAE\xC6\xB0\xB1\xB2\xB3\u201C\xB5\xB6\xB7\xF8\xB9\u0157\xBB\xBC\xBD\xBE\xE6\u0104\u012E\u0100\u0106\xC4\xC5\u0118\u0112\u010C\xC9\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\xD3\u014C\xD5\xD6\xD7\u0172\u0141\u015A\u016A\xDC\u017B\u017D\xDF\u0105\u012F\u0101\u0107\xE4\xE5\u0119\u0113\u010D\xE9\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\xF3\u014D\xF5\xF6\xF7\u0173\u0142\u015B\u016B\xFC\u017C\u017E\u2019"},cp28603:"iso885913",iso885914:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u1E02\u1E03\xA3\u010A\u010B\u1E0A\xA7\u1E80\xA9\u1E82\u1E0B\u1EF2\xAD\xAE\u0178\u1E1E\u1E1F\u0120\u0121\u1E40\u1E41\xB6\u1E56\u1E81\u1E57\u1E83\u1E60\u1EF3\u1E84\u1E85\u1E61\xC0\xC1\xC2\xC3\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\u0174\xD1\xD2\xD3\xD4\xD5\xD6\u1E6A\xD8\xD9\xDA\xDB\xDC\xDD\u0176\xDF\xE0\xE1\xE2\xE3\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\u0175\xF1\xF2\xF3\xF4\xF5\xF6\u1E6B\xF8\xF9\xFA\xFB\xFC\xFD\u0177\xFF"},cp28604:"iso885914",iso885915:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\xA1\xA2\xA3\u20AC\xA5\u0160\xA7\u0161\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\u017D\xB5\xB6\xB7\u017E\xB9\xBA\xBB\u0152\u0153\u0178\xBF\xC0\xC1\xC2\xC3\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\xD0\xD1\xD2\xD3\xD4\xD5\xD6\xD7\xD8\xD9\xDA\xDB\xDC\xDD\xDE\xDF\xE0\xE1\xE2\xE3\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\xF0\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xF8\xF9\xFA\xFB\xFC\xFD\xFE\xFF"},cp28605:"iso885915",iso885916:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0104\u0105\u0141\u20AC\u201E\u0160\xA7\u0161\xA9\u0218\xAB\u0179\xAD\u017A\u017B\xB0\xB1\u010C\u0142\u017D\u201D\xB6\xB7\u017E\u010D\u0219\xBB\u0152\u0153\u0178\u017C\xC0\xC1\xC2\u0102\xC4\u0106\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\u0110\u0143\xD2\xD3\xD4\u0150\xD6\u015A\u0170\xD9\xDA\xDB\xDC\u0118\u021A\xDF\xE0\xE1\xE2\u0103\xE4\u0107\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\u0111\u0144\xF2\xF3\xF4\u0151\xF6\u015B\u0171\xF9\xFA\xFB\xFC\u0119\u021B\xFF"},cp28606:"iso885916",cp437:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0"},ibm437:"cp437",csibm437:"cp437",cp737:{type:"_sbcs",chars:"\u0391\u0392\u0393\u0394\u0395\u0396\u0397\u0398\u0399\u039A\u039B\u039C\u039D\u039E\u039F\u03A0\u03A1\u03A3\u03A4\u03A5\u03A6\u03A7\u03A8\u03A9\u03B1\u03B2\u03B3\u03B4\u03B5\u03B6\u03B7\u03B8\u03B9\u03BA\u03BB\u03BC\u03BD\u03BE\u03BF\u03C0\u03C1\u03C3\u03C2\u03C4\u03C5\u03C6\u03C7\u03C8\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03C9\u03AC\u03AD\u03AE\u03CA\u03AF\u03CC\u03CD\u03CB\u03CE\u0386\u0388\u0389\u038A\u038C\u038E\u038F\xB1\u2265\u2264\u03AA\u03AB\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0"},ibm737:"cp737",csibm737:"cp737",cp775:{type:"_sbcs",chars:"\u0106\xFC\xE9\u0101\xE4\u0123\xE5\u0107\u0142\u0113\u0156\u0157\u012B\u0179\xC4\xC5\xC9\xE6\xC6\u014D\xF6\u0122\xA2\u015A\u015B\xD6\xDC\xF8\xA3\xD8\xD7\xA4\u0100\u012A\xF3\u017B\u017C\u017A\u201D\xA6\xA9\xAE\xAC\xBD\xBC\u0141\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u0104\u010C\u0118\u0116\u2563\u2551\u2557\u255D\u012E\u0160\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u0172\u016A\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u017D\u0105\u010D\u0119\u0117\u012F\u0161\u0173\u016B\u017E\u2518\u250C\u2588\u2584\u258C\u2590\u2580\xD3\xDF\u014C\u0143\xF5\xD5\xB5\u0144\u0136\u0137\u013B\u013C\u0146\u0112\u0145\u2019\xAD\xB1\u201C\xBE\xB6\xA7\xF7\u201E\xB0\u2219\xB7\xB9\xB3\xB2\u25A0\xA0"},ibm775:"cp775",csibm775:"cp775",cp850:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xF8\xA3\xD8\xD7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\xAE\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\xC1\xC2\xC0\xA9\u2563\u2551\u2557\u255D\xA2\xA5\u2510\u2514\u2534\u252C\u251C\u2500\u253C\xE3\xC3\u255A\u2554\u2569\u2566\u2560\u2550\u256C\xA4\xF0\xD0\xCA\xCB\xC8\u0131\xCD\xCE\xCF\u2518\u250C\u2588\u2584\xA6\xCC\u2580\xD3\xDF\xD4\xD2\xF5\xD5\xB5\xFE\xDE\xDA\xDB\xD9\xFD\xDD\xAF\xB4\xAD\xB1\u2017\xBE\xB6\xA7\xF7\xB8\xB0\xA8\xB7\xB9\xB3\xB2\u25A0\xA0"},ibm850:"cp850",csibm850:"cp850",cp852:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xE4\u016F\u0107\xE7\u0142\xEB\u0150\u0151\xEE\u0179\xC4\u0106\xC9\u0139\u013A\xF4\xF6\u013D\u013E\u015A\u015B\xD6\xDC\u0164\u0165\u0141\xD7\u010D\xE1\xED\xF3\xFA\u0104\u0105\u017D\u017E\u0118\u0119\xAC\u017A\u010C\u015F\xAB\xBB\u2591\u2592\u2593\u2502\u2524\xC1\xC2\u011A\u015E\u2563\u2551\u2557\u255D\u017B\u017C\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u0102\u0103\u255A\u2554\u2569\u2566\u2560\u2550\u256C\xA4\u0111\u0110\u010E\xCB\u010F\u0147\xCD\xCE\u011B\u2518\u250C\u2588\u2584\u0162\u016E\u2580\xD3\xDF\xD4\u0143\u0144\u0148\u0160\u0161\u0154\xDA\u0155\u0170\xFD\xDD\u0163\xB4\xAD\u02DD\u02DB\u02C7\u02D8\xA7\xF7\xB8\xB0\xA8\u02D9\u0171\u0158\u0159\u25A0\xA0"},ibm852:"cp852",csibm852:"cp852",cp855:{type:"_sbcs",chars:"\u0452\u0402\u0453\u0403\u0451\u0401\u0454\u0404\u0455\u0405\u0456\u0406\u0457\u0407\u0458\u0408\u0459\u0409\u045A\u040A\u045B\u040B\u045C\u040C\u045E\u040E\u045F\u040F\u044E\u042E\u044A\u042A\u0430\u0410\u0431\u0411\u0446\u0426\u0434\u0414\u0435\u0415\u0444\u0424\u0433\u0413\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u0445\u0425\u0438\u0418\u2563\u2551\u2557\u255D\u0439\u0419\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u043A\u041A\u255A\u2554\u2569\u2566\u2560\u2550\u256C\xA4\u043B\u041B\u043C\u041C\u043D\u041D\u043E\u041E\u043F\u2518\u250C\u2588\u2584\u041F\u044F\u2580\u042F\u0440\u0420\u0441\u0421\u0442\u0422\u0443\u0423\u0436\u0416\u0432\u0412\u044C\u042C\u2116\xAD\u044B\u042B\u0437\u0417\u0448\u0428\u044D\u042D\u0449\u0429\u0447\u0427\xA7\u25A0\xA0"},ibm855:"cp855",csibm855:"cp855",cp856:{type:"_sbcs",chars:"\u05D0\u05D1\u05D2\u05D3\u05D4\u05D5\u05D6\u05D7\u05D8\u05D9\u05DA\u05DB\u05DC\u05DD\u05DE\u05DF\u05E0\u05E1\u05E2\u05E3\u05E4\u05E5\u05E6\u05E7\u05E8\u05E9\u05EA\uFFFD\xA3\uFFFD\xD7\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\xAE\xAC\xBD\xBC\uFFFD\xAB\xBB\u2591\u2592\u2593\u2502\u2524\uFFFD\uFFFD\uFFFD\xA9\u2563\u2551\u2557\u255D\xA2\xA5\u2510\u2514\u2534\u252C\u251C\u2500\u253C\uFFFD\uFFFD\u255A\u2554\u2569\u2566\u2560\u2550\u256C\xA4\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u2518\u250C\u2588\u2584\xA6\uFFFD\u2580\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\xB5\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\xAF\xB4\xAD\xB1\u2017\xBE\xB6\xA7\xF7\xB8\xB0\xA8\xB7\xB9\xB3\xB2\u25A0\xA0"},ibm856:"cp856",csibm856:"cp856",cp857:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\u0131\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\u0130\xD6\xDC\xF8\xA3\xD8\u015E\u015F\xE1\xED\xF3\xFA\xF1\xD1\u011E\u011F\xBF\xAE\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\xC1\xC2\xC0\xA9\u2563\u2551\u2557\u255D\xA2\xA5\u2510\u2514\u2534\u252C\u251C\u2500\u253C\xE3\xC3\u255A\u2554\u2569\u2566\u2560\u2550\u256C\xA4\xBA\xAA\xCA\xCB\xC8\uFFFD\xCD\xCE\xCF\u2518\u250C\u2588\u2584\xA6\xCC\u2580\xD3\xDF\xD4\xD2\xF5\xD5\xB5\uFFFD\xD7\xDA\xDB\xD9\xEC\xFF\xAF\xB4\xAD\xB1\uFFFD\xBE\xB6\xA7\xF7\xB8\xB0\xA8\xB7\xB9\xB3\xB2\u25A0\xA0"},ibm857:"cp857",csibm857:"cp857",cp858:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xF8\xA3\xD8\xD7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\xAE\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\xC1\xC2\xC0\xA9\u2563\u2551\u2557\u255D\xA2\xA5\u2510\u2514\u2534\u252C\u251C\u2500\u253C\xE3\xC3\u255A\u2554\u2569\u2566\u2560\u2550\u256C\xA4\xF0\xD0\xCA\xCB\xC8\u20AC\xCD\xCE\xCF\u2518\u250C\u2588\u2584\xA6\xCC\u2580\xD3\xDF\xD4\xD2\xF5\xD5\xB5\xFE\xDE\xDA\xDB\xD9\xFD\xDD\xAF\xB4\xAD\xB1\u2017\xBE\xB6\xA7\xF7\xB8\xB0\xA8\xB7\xB9\xB3\xB2\u25A0\xA0"},ibm858:"cp858",csibm858:"cp858",cp860:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xE3\xE0\xC1\xE7\xEA\xCA\xE8\xCD\xD4\xEC\xC3\xC2\xC9\xC0\xC8\xF4\xF5\xF2\xDA\xF9\xCC\xD5\xDC\xA2\xA3\xD9\u20A7\xD3\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\xD2\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0"},ibm860:"cp860",csibm860:"cp860",cp861:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xD0\xF0\xDE\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xFE\xFB\xDD\xFD\xD6\xDC\xF8\xA3\xD8\u20A7\u0192\xE1\xED\xF3\xFA\xC1\xCD\xD3\xDA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0"},ibm861:"cp861",csibm861:"cp861",cp862:{type:"_sbcs",chars:"\u05D0\u05D1\u05D2\u05D3\u05D4\u05D5\u05D6\u05D7\u05D8\u05D9\u05DA\u05DB\u05DC\u05DD\u05DE\u05DF\u05E0\u05E1\u05E2\u05E3\u05E4\u05E5\u05E6\u05E7\u05E8\u05E9\u05EA\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0"},ibm862:"cp862",csibm862:"cp862",cp863:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xC2\xE0\xB6\xE7\xEA\xEB\xE8\xEF\xEE\u2017\xC0\xA7\xC9\xC8\xCA\xF4\xCB\xCF\xFB\xF9\xA4\xD4\xDC\xA2\xA3\xD9\xDB\u0192\xA6\xB4\xF3\xFA\xA8\xB8\xB3\xAF\xCE\u2310\xAC\xBD\xBC\xBE\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0"},ibm863:"cp863",csibm863:"cp863",cp864:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$\u066A&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~\x7F\xB0\xB7\u2219\u221A\u2592\u2500\u2502\u253C\u2524\u252C\u251C\u2534\u2510\u250C\u2514\u2518\u03B2\u221E\u03C6\xB1\xBD\xBC\u2248\xAB\xBB\uFEF7\uFEF8\uFFFD\uFFFD\uFEFB\uFEFC\uFFFD\xA0\xAD\uFE82\xA3\xA4\uFE84\uFFFD\uFFFD\uFE8E\uFE8F\uFE95\uFE99\u060C\uFE9D\uFEA1\uFEA5\u0660\u0661\u0662\u0663\u0664\u0665\u0666\u0667\u0668\u0669\uFED1\u061B\uFEB1\uFEB5\uFEB9\u061F\xA2\uFE80\uFE81\uFE83\uFE85\uFECA\uFE8B\uFE8D\uFE91\uFE93\uFE97\uFE9B\uFE9F\uFEA3\uFEA7\uFEA9\uFEAB\uFEAD\uFEAF\uFEB3\uFEB7\uFEBB\uFEBF\uFEC1\uFEC5\uFECB\uFECF\xA6\xAC\xF7\xD7\uFEC9\u0640\uFED3\uFED7\uFEDB\uFEDF\uFEE3\uFEE7\uFEEB\uFEED\uFEEF\uFEF3\uFEBD\uFECC\uFECE\uFECD\uFEE1\uFE7D\u0651\uFEE5\uFEE9\uFEEC\uFEF0\uFEF2\uFED0\uFED5\uFEF5\uFEF6\uFEDD\uFED9\uFEF1\u25A0\uFFFD`},ibm864:"cp864",csibm864:"cp864",cp865:{type:"_sbcs",chars:"\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xF8\xA3\xD8\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xA4\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0"},ibm865:"cp865",csibm865:"cp865",cp866:{type:"_sbcs",chars:"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F\u0401\u0451\u0404\u0454\u0407\u0457\u040E\u045E\xB0\u2219\xB7\u221A\u2116\xA4\u25A0\xA0"},ibm866:"cp866",csibm866:"cp866",cp869:{type:"_sbcs",chars:"\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u0386\uFFFD\xB7\xAC\xA6\u2018\u2019\u0388\u2015\u0389\u038A\u03AA\u038C\uFFFD\uFFFD\u038E\u03AB\xA9\u038F\xB2\xB3\u03AC\xA3\u03AD\u03AE\u03AF\u03CA\u0390\u03CC\u03CD\u0391\u0392\u0393\u0394\u0395\u0396\u0397\xBD\u0398\u0399\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u039A\u039B\u039C\u039D\u2563\u2551\u2557\u255D\u039E\u039F\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u03A0\u03A1\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u03A3\u03A4\u03A5\u03A6\u03A7\u03A8\u03A9\u03B1\u03B2\u03B3\u2518\u250C\u2588\u2584\u03B4\u03B5\u2580\u03B6\u03B7\u03B8\u03B9\u03BA\u03BB\u03BC\u03BD\u03BE\u03BF\u03C0\u03C1\u03C3\u03C2\u03C4\u0384\xAD\xB1\u03C5\u03C6\u03C7\xA7\u03C8\u0385\xB0\xA8\u03C9\u03CB\u03B0\u03CE\u25A0\xA0"},ibm869:"cp869",csibm869:"cp869",cp922:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\u203E\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xBA\xBB\xBC\xBD\xBE\xBF\xC0\xC1\xC2\xC3\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\u0160\xD1\xD2\xD3\xD4\xD5\xD6\xD7\xD8\xD9\xDA\xDB\xDC\xDD\u017D\xDF\xE0\xE1\xE2\xE3\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\u0161\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xF8\xF9\xFA\xFB\xFC\xFD\u017E\xFF"},ibm922:"cp922",csibm922:"cp922",cp1046:{type:"_sbcs",chars:"\uFE88\xD7\xF7\uF8F6\uF8F5\uF8F4\uF8F7\uFE71\x88\u25A0\u2502\u2500\u2510\u250C\u2514\u2518\uFE79\uFE7B\uFE7D\uFE7F\uFE77\uFE8A\uFEF0\uFEF3\uFEF2\uFECE\uFECF\uFED0\uFEF6\uFEF8\uFEFA\uFEFC\xA0\uF8FA\uF8F9\uF8F8\xA4\uF8FB\uFE8B\uFE91\uFE97\uFE9B\uFE9F\uFEA3\u060C\xAD\uFEA7\uFEB3\u0660\u0661\u0662\u0663\u0664\u0665\u0666\u0667\u0668\u0669\uFEB7\u061B\uFEBB\uFEBF\uFECA\u061F\uFECB\u0621\u0622\u0623\u0624\u0625\u0626\u0627\u0628\u0629\u062A\u062B\u062C\u062D\u062E\u062F\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\uFEC7\u0639\u063A\uFECC\uFE82\uFE84\uFE8E\uFED3\u0640\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u0649\u064A\u064B\u064C\u064D\u064E\u064F\u0650\u0651\u0652\uFED7\uFEDB\uFEDF\uF8FC\uFEF5\uFEF7\uFEF9\uFEFB\uFEE3\uFEE7\uFEEC\uFEE9\uFFFD"},ibm1046:"cp1046",csibm1046:"cp1046",cp1124:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0401\u0402\u0490\u0404\u0405\u0406\u0407\u0408\u0409\u040A\u040B\u040C\xAD\u040E\u040F\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F\u2116\u0451\u0452\u0491\u0454\u0455\u0456\u0457\u0458\u0459\u045A\u045B\u045C\xA7\u045E\u045F"},ibm1124:"cp1124",csibm1124:"cp1124",cp1125:{type:"_sbcs",chars:"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F\u0401\u0451\u0490\u0491\u0404\u0454\u0406\u0456\u0407\u0457\xB7\u221A\u2116\xA4\u25A0\xA0"},ibm1125:"cp1125",csibm1125:"cp1125",cp1129:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\u0153\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\u0178\xB5\xB6\xB7\u0152\xB9\xBA\xBB\xBC\xBD\xBE\xBF\xC0\xC1\xC2\u0102\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\u0300\xCD\xCE\xCF\u0110\xD1\u0309\xD3\xD4\u01A0\xD6\xD7\xD8\xD9\xDA\xDB\xDC\u01AF\u0303\xDF\xE0\xE1\xE2\u0103\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\u0301\xED\xEE\xEF\u0111\xF1\u0323\xF3\xF4\u01A1\xF6\xF7\xF8\xF9\xFA\xFB\xFC\u01B0\u20AB\xFF"},ibm1129:"cp1129",csibm1129:"cp1129",cp1133:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0E81\u0E82\u0E84\u0E87\u0E88\u0EAA\u0E8A\u0E8D\u0E94\u0E95\u0E96\u0E97\u0E99\u0E9A\u0E9B\u0E9C\u0E9D\u0E9E\u0E9F\u0EA1\u0EA2\u0EA3\u0EA5\u0EA7\u0EAB\u0EAD\u0EAE\uFFFD\uFFFD\uFFFD\u0EAF\u0EB0\u0EB2\u0EB3\u0EB4\u0EB5\u0EB6\u0EB7\u0EB8\u0EB9\u0EBC\u0EB1\u0EBB\u0EBD\uFFFD\uFFFD\uFFFD\u0EC0\u0EC1\u0EC2\u0EC3\u0EC4\u0EC8\u0EC9\u0ECA\u0ECB\u0ECC\u0ECD\u0EC6\uFFFD\u0EDC\u0EDD\u20AD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u0ED0\u0ED1\u0ED2\u0ED3\u0ED4\u0ED5\u0ED6\u0ED7\u0ED8\u0ED9\uFFFD\uFFFD\xA2\xAC\xA6\uFFFD"},ibm1133:"cp1133",csibm1133:"cp1133",cp1161:{type:"_sbcs",chars:"\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u0E48\u0E01\u0E02\u0E03\u0E04\u0E05\u0E06\u0E07\u0E08\u0E09\u0E0A\u0E0B\u0E0C\u0E0D\u0E0E\u0E0F\u0E10\u0E11\u0E12\u0E13\u0E14\u0E15\u0E16\u0E17\u0E18\u0E19\u0E1A\u0E1B\u0E1C\u0E1D\u0E1E\u0E1F\u0E20\u0E21\u0E22\u0E23\u0E24\u0E25\u0E26\u0E27\u0E28\u0E29\u0E2A\u0E2B\u0E2C\u0E2D\u0E2E\u0E2F\u0E30\u0E31\u0E32\u0E33\u0E34\u0E35\u0E36\u0E37\u0E38\u0E39\u0E3A\u0E49\u0E4A\u0E4B\u20AC\u0E3F\u0E40\u0E41\u0E42\u0E43\u0E44\u0E45\u0E46\u0E47\u0E48\u0E49\u0E4A\u0E4B\u0E4C\u0E4D\u0E4E\u0E4F\u0E50\u0E51\u0E52\u0E53\u0E54\u0E55\u0E56\u0E57\u0E58\u0E59\u0E5A\u0E5B\xA2\xAC\xA6\xA0"},ibm1161:"cp1161",csibm1161:"cp1161",cp1162:{type:"_sbcs",chars:"\u20AC\x81\x82\x83\x84\u2026\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\u2018\u2019\u201C\u201D\u2022\u2013\u2014\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\u0E01\u0E02\u0E03\u0E04\u0E05\u0E06\u0E07\u0E08\u0E09\u0E0A\u0E0B\u0E0C\u0E0D\u0E0E\u0E0F\u0E10\u0E11\u0E12\u0E13\u0E14\u0E15\u0E16\u0E17\u0E18\u0E19\u0E1A\u0E1B\u0E1C\u0E1D\u0E1E\u0E1F\u0E20\u0E21\u0E22\u0E23\u0E24\u0E25\u0E26\u0E27\u0E28\u0E29\u0E2A\u0E2B\u0E2C\u0E2D\u0E2E\u0E2F\u0E30\u0E31\u0E32\u0E33\u0E34\u0E35\u0E36\u0E37\u0E38\u0E39\u0E3A\uFFFD\uFFFD\uFFFD\uFFFD\u0E3F\u0E40\u0E41\u0E42\u0E43\u0E44\u0E45\u0E46\u0E47\u0E48\u0E49\u0E4A\u0E4B\u0E4C\u0E4D\u0E4E\u0E4F\u0E50\u0E51\u0E52\u0E53\u0E54\u0E55\u0E56\u0E57\u0E58\u0E59\u0E5A\u0E5B\uFFFD\uFFFD\uFFFD\uFFFD"},ibm1162:"cp1162",csibm1162:"cp1162",cp1163:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\xA1\xA2\xA3\u20AC\xA5\xA6\xA7\u0153\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\u0178\xB5\xB6\xB7\u0152\xB9\xBA\xBB\xBC\xBD\xBE\xBF\xC0\xC1\xC2\u0102\xC4\xC5\xC6\xC7\xC8\xC9\xCA\xCB\u0300\xCD\xCE\xCF\u0110\xD1\u0309\xD3\xD4\u01A0\xD6\xD7\xD8\xD9\xDA\xDB\xDC\u01AF\u0303\xDF\xE0\xE1\xE2\u0103\xE4\xE5\xE6\xE7\xE8\xE9\xEA\xEB\u0301\xED\xEE\xEF\u0111\xF1\u0323\xF3\xF4\u01A1\xF6\xF7\xF8\xF9\xFA\xFB\xFC\u01B0\u20AB\xFF"},ibm1163:"cp1163",csibm1163:"cp1163",maccroatian:{type:"_sbcs",chars:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\u0160\u2122\xB4\xA8\u2260\u017D\xD8\u221E\xB1\u2264\u2265\u2206\xB5\u2202\u2211\u220F\u0161\u222B\xAA\xBA\u2126\u017E\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u0106\xAB\u010C\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u0110\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\uFFFD\xA9\u2044\xA4\u2039\u203A\xC6\xBB\u2013\xB7\u201A\u201E\u2030\xC2\u0107\xC1\u010D\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u0111\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u03C0\xCB\u02DA\xB8\xCA\xE6\u02C7"},maccyrillic:{type:"_sbcs",chars:"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u2020\xB0\xA2\xA3\xA7\u2022\xB6\u0406\xAE\xA9\u2122\u0402\u0452\u2260\u0403\u0453\u221E\xB1\u2264\u2265\u0456\xB5\u2202\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040A\u045A\u0458\u0405\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\u040B\u045B\u040C\u045C\u0455\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u201E\u040E\u045E\u040F\u045F\u2116\u0401\u0451\u044F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\xA4"},macgreek:{type:"_sbcs",chars:"\xC4\xB9\xB2\xC9\xB3\xD6\xDC\u0385\xE0\xE2\xE4\u0384\xA8\xE7\xE9\xE8\xEA\xEB\xA3\u2122\xEE\xEF\u2022\xBD\u2030\xF4\xF6\xA6\xAD\xF9\xFB\xFC\u2020\u0393\u0394\u0398\u039B\u039E\u03A0\xDF\xAE\xA9\u03A3\u03AA\xA7\u2260\xB0\u0387\u0391\xB1\u2264\u2265\xA5\u0392\u0395\u0396\u0397\u0399\u039A\u039C\u03A6\u03AB\u03A8\u03A9\u03AC\u039D\xAC\u039F\u03A1\u2248\u03A4\xAB\xBB\u2026\xA0\u03A5\u03A7\u0386\u0388\u0153\u2013\u2015\u201C\u201D\u2018\u2019\xF7\u0389\u038A\u038C\u038E\u03AD\u03AE\u03AF\u03CC\u038F\u03CD\u03B1\u03B2\u03C8\u03B4\u03B5\u03C6\u03B3\u03B7\u03B9\u03BE\u03BA\u03BB\u03BC\u03BD\u03BF\u03C0\u03CE\u03C1\u03C3\u03C4\u03B8\u03C9\u03C2\u03C7\u03C5\u03B6\u03CA\u03CB\u0390\u03B0\uFFFD"},maciceland:{type:"_sbcs",chars:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\xDD\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u2126\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\xA4\xD0\xF0\xDE\xFE\xFD\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uFFFD\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"},macroman:{type:"_sbcs",chars:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u2126\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\xA4\u2039\u203A\uFB01\uFB02\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uFFFD\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"},macromania:{type:"_sbcs",chars:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\u0102\u015E\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u2126\u0103\u015F\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\xA4\u2039\u203A\u0162\u0163\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uFFFD\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"},macthai:{type:"_sbcs",chars:"\xAB\xBB\u2026\uF88C\uF88F\uF892\uF895\uF898\uF88B\uF88E\uF891\uF894\uF897\u201C\u201D\uF899\uFFFD\u2022\uF884\uF889\uF885\uF886\uF887\uF888\uF88A\uF88D\uF890\uF893\uF896\u2018\u2019\uFFFD\xA0\u0E01\u0E02\u0E03\u0E04\u0E05\u0E06\u0E07\u0E08\u0E09\u0E0A\u0E0B\u0E0C\u0E0D\u0E0E\u0E0F\u0E10\u0E11\u0E12\u0E13\u0E14\u0E15\u0E16\u0E17\u0E18\u0E19\u0E1A\u0E1B\u0E1C\u0E1D\u0E1E\u0E1F\u0E20\u0E21\u0E22\u0E23\u0E24\u0E25\u0E26\u0E27\u0E28\u0E29\u0E2A\u0E2B\u0E2C\u0E2D\u0E2E\u0E2F\u0E30\u0E31\u0E32\u0E33\u0E34\u0E35\u0E36\u0E37\u0E38\u0E39\u0E3A\uFEFF\u200B\u2013\u2014\u0E3F\u0E40\u0E41\u0E42\u0E43\u0E44\u0E45\u0E46\u0E47\u0E48\u0E49\u0E4A\u0E4B\u0E4C\u0E4D\u2122\u0E4F\u0E50\u0E51\u0E52\u0E53\u0E54\u0E55\u0E56\u0E57\u0E58\u0E59\xAE\xA9\uFFFD\uFFFD\uFFFD\uFFFD"},macturkish:{type:"_sbcs",chars:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u2126\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u011E\u011F\u0130\u0131\u015E\u015F\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uFFFD\xD2\xDA\xDB\xD9\uFFFD\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"},macukraine:{type:"_sbcs",chars:"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u2020\xB0\u0490\xA3\xA7\u2022\xB6\u0406\xAE\xA9\u2122\u0402\u0452\u2260\u0403\u0453\u221E\xB1\u2264\u2265\u0456\xB5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040A\u045A\u0458\u0405\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\u040B\u045B\u040C\u045C\u0455\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u201E\u040E\u045E\u040F\u045F\u2116\u0401\u0451\u044F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\xA4"},koi8r:{type:"_sbcs",chars:"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\xA0\u2321\xB0\xB2\xB7\xF7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\xA9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"},koi8u:{type:"_sbcs",chars:"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\xA0\u2321\xB0\xB2\xB7\xF7\u2550\u2551\u2552\u0451\u0454\u2554\u0456\u0457\u2557\u2558\u2559\u255A\u255B\u0491\u255D\u255E\u255F\u2560\u2561\u0401\u0404\u2563\u0406\u0407\u2566\u2567\u2568\u2569\u256A\u0490\u256C\xA9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"},koi8ru:{type:"_sbcs",chars:"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\xA0\u2321\xB0\xB2\xB7\xF7\u2550\u2551\u2552\u0451\u0454\u2554\u0456\u0457\u2557\u2558\u2559\u255A\u255B\u0491\u045E\u255E\u255F\u2560\u2561\u0401\u0404\u2563\u0406\u0407\u2566\u2567\u2568\u2569\u256A\u0490\u040E\xA9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"},koi8t:{type:"_sbcs",chars:"\u049B\u0493\u201A\u0492\u201E\u2026\u2020\u2021\uFFFD\u2030\u04B3\u2039\u04B2\u04B7\u04B6\uFFFD\u049A\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\uFFFD\u203A\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u04EF\u04EE\u0451\xA4\u04E3\xA6\xA7\uFFFD\uFFFD\uFFFD\xAB\xAC\xAD\xAE\uFFFD\xB0\xB1\xB2\u0401\uFFFD\u04E2\xB6\xB7\uFFFD\u2116\uFFFD\xBB\uFFFD\uFFFD\uFFFD\xA9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"},armscii8:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\uFFFD\u0587\u0589)(\xBB\xAB\u2014.\u055D,-\u058A\u2026\u055C\u055B\u055E\u0531\u0561\u0532\u0562\u0533\u0563\u0534\u0564\u0535\u0565\u0536\u0566\u0537\u0567\u0538\u0568\u0539\u0569\u053A\u056A\u053B\u056B\u053C\u056C\u053D\u056D\u053E\u056E\u053F\u056F\u0540\u0570\u0541\u0571\u0542\u0572\u0543\u0573\u0544\u0574\u0545\u0575\u0546\u0576\u0547\u0577\u0548\u0578\u0549\u0579\u054A\u057A\u054B\u057B\u054C\u057C\u054D\u057D\u054E\u057E\u054F\u057F\u0550\u0580\u0551\u0581\u0552\u0582\u0553\u0583\u0554\u0584\u0555\u0585\u0556\u0586\u055A\uFFFD"},rk1048:{type:"_sbcs",chars:"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u049A\u04BA\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u049B\u04BB\u045F\xA0\u04B0\u04B1\u04D8\xA4\u04E8\xA6\xA7\u0401\xA9\u0492\xAB\xAC\xAD\xAE\u04AE\xB0\xB1\u0406\u0456\u04E9\xB5\xB6\xB7\u0451\u2116\u0493\xBB\u04D9\u04A2\u04A3\u04AF\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"},tcvn:{type:"_sbcs",chars:`\0\xDA\u1EE4\u1EEA\u1EEC\u1EEE\x07\b	
\v\f\r\u1EE8\u1EF0\u1EF2\u1EF6\u1EF8\xDD\u1EF4\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~\x7F\xC0\u1EA2\xC3\xC1\u1EA0\u1EB6\u1EAC\xC8\u1EBA\u1EBC\xC9\u1EB8\u1EC6\xCC\u1EC8\u0128\xCD\u1ECA\xD2\u1ECE\xD5\xD3\u1ECC\u1ED8\u1EDC\u1EDE\u1EE0\u1EDA\u1EE2\xD9\u1EE6\u0168\xA0\u0102\xC2\xCA\xD4\u01A0\u01AF\u0110\u0103\xE2\xEA\xF4\u01A1\u01B0\u0111\u1EB0\u0300\u0309\u0303\u0301\u0323\xE0\u1EA3\xE3\xE1\u1EA1\u1EB2\u1EB1\u1EB3\u1EB5\u1EAF\u1EB4\u1EAE\u1EA6\u1EA8\u1EAA\u1EA4\u1EC0\u1EB7\u1EA7\u1EA9\u1EAB\u1EA5\u1EAD\xE8\u1EC2\u1EBB\u1EBD\xE9\u1EB9\u1EC1\u1EC3\u1EC5\u1EBF\u1EC7\xEC\u1EC9\u1EC4\u1EBE\u1ED2\u0129\xED\u1ECB\xF2\u1ED4\u1ECF\xF5\xF3\u1ECD\u1ED3\u1ED5\u1ED7\u1ED1\u1ED9\u1EDD\u1EDF\u1EE1\u1EDB\u1EE3\xF9\u1ED6\u1EE7\u0169\xFA\u1EE5\u1EEB\u1EED\u1EEF\u1EE9\u1EF1\u1EF3\u1EF7\u1EF9\xFD\u1EF5\u1ED0`},georgianacademy:{type:"_sbcs",chars:"\x80\x81\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\u0160\u2039\u0152\x8D\x8E\x8F\x90\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u02DC\u2122\u0161\u203A\u0153\x9D\x9E\u0178\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xBA\xBB\xBC\xBD\xBE\xBF\u10D0\u10D1\u10D2\u10D3\u10D4\u10D5\u10D6\u10D7\u10D8\u10D9\u10DA\u10DB\u10DC\u10DD\u10DE\u10DF\u10E0\u10E1\u10E2\u10E3\u10E4\u10E5\u10E6\u10E7\u10E8\u10E9\u10EA\u10EB\u10EC\u10ED\u10EE\u10EF\u10F0\u10F1\u10F2\u10F3\u10F4\u10F5\u10F6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\xF0\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xF8\xF9\xFA\xFB\xFC\xFD\xFE\xFF"},georgianps:{type:"_sbcs",chars:"\x80\x81\u201A\u0192\u201E\u2026\u2020\u2021\u02C6\u2030\u0160\u2039\u0152\x8D\x8E\x8F\x90\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u02DC\u2122\u0161\u203A\u0153\x9D\x9E\u0178\xA0\xA1\xA2\xA3\xA4\xA5\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xB0\xB1\xB2\xB3\xB4\xB5\xB6\xB7\xB8\xB9\xBA\xBB\xBC\xBD\xBE\xBF\u10D0\u10D1\u10D2\u10D3\u10D4\u10D5\u10D6\u10F1\u10D7\u10D8\u10D9\u10DA\u10DB\u10DC\u10F2\u10DD\u10DE\u10DF\u10E0\u10E1\u10E2\u10F3\u10E3\u10E4\u10E5\u10E6\u10E7\u10E8\u10E9\u10EA\u10EB\u10EC\u10ED\u10EE\u10F4\u10EF\u10F0\u10F5\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\xF0\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xF8\xF9\xFA\xFB\xFC\xFD\xFE\xFF"},pt154:{type:"_sbcs",chars:"\u0496\u0492\u04EE\u0493\u201E\u2026\u04B6\u04AE\u04B2\u04AF\u04A0\u04E2\u04A2\u049A\u04BA\u04B8\u0497\u2018\u2019\u201C\u201D\u2022\u2013\u2014\u04B3\u04B7\u04A1\u04E3\u04A3\u049B\u04BB\u04B9\xA0\u040E\u045E\u0408\u04E8\u0498\u04B0\xA7\u0401\xA9\u04D8\xAB\xAC\u04EF\xAE\u049C\xB0\u04B1\u0406\u0456\u0499\u04E9\xB6\xB7\u0451\u2116\u04D9\xBB\u0458\u04AA\u04AB\u049D\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"},viscii:{type:"_sbcs",chars:`\0\u1EB2\u1EB4\u1EAA\x07\b	
\v\f\r\u1EF6\u1EF8\x1B\u1EF4 !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~\x7F\u1EA0\u1EAE\u1EB0\u1EB6\u1EA4\u1EA6\u1EA8\u1EAC\u1EBC\u1EB8\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EE2\u1EDA\u1EDC\u1EDE\u1ECA\u1ECE\u1ECC\u1EC8\u1EE6\u0168\u1EE4\u1EF2\xD5\u1EAF\u1EB1\u1EB7\u1EA5\u1EA7\u1EA9\u1EAD\u1EBD\u1EB9\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1ED1\u1ED3\u1ED5\u1ED7\u1EE0\u01A0\u1ED9\u1EDD\u1EDF\u1ECB\u1EF0\u1EE8\u1EEA\u1EEC\u01A1\u1EDB\u01AF\xC0\xC1\xC2\xC3\u1EA2\u0102\u1EB3\u1EB5\xC8\xC9\xCA\u1EBA\xCC\xCD\u0128\u1EF3\u0110\u1EE9\xD2\xD3\xD4\u1EA1\u1EF7\u1EEB\u1EED\xD9\xDA\u1EF9\u1EF5\xDD\u1EE1\u01B0\xE0\xE1\xE2\xE3\u1EA3\u0103\u1EEF\u1EAB\xE8\xE9\xEA\u1EBB\xEC\xED\u0129\u1EC9\u0111\u1EF1\xF2\xF3\xF4\xF5\u1ECF\u1ECD\u1EE5\xF9\xFA\u0169\u1EE7\xFD\u1EE3\u1EEE`},iso646cn:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#\xA5%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}\u203E\x7F\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD`},iso646jp:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\xA5]^_\`abcdefghijklmnopqrstuvwxyz{|}\u203E\x7F\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD`},hproman8:{type:"_sbcs",chars:"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\xC0\xC2\xC8\xCA\xCB\xCE\xCF\xB4\u02CB\u02C6\xA8\u02DC\xD9\xDB\u20A4\xAF\xDD\xFD\xB0\xC7\xE7\xD1\xF1\xA1\xBF\xA4\xA3\xA5\xA7\u0192\xA2\xE2\xEA\xF4\xFB\xE1\xE9\xF3\xFA\xE0\xE8\xF2\xF9\xE4\xEB\xF6\xFC\xC5\xEE\xD8\xC6\xE5\xED\xF8\xE6\xC4\xEC\xD6\xDC\xC9\xEF\xDF\xD4\xC1\xC3\xE3\xD0\xF0\xCD\xCC\xD3\xD2\xD5\xF5\u0160\u0161\xDA\u0178\xFF\xDE\xFE\xB7\xB5\xB6\xBE\u2014\xBC\xBD\xAA\xBA\xAB\u25A0\xBB\xB1\uFFFD"},macintosh:{type:"_sbcs",chars:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u2126\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\xA4\u2039\u203A\uFB01\uFB02\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uFFFD\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"},ascii:{type:"_sbcs",chars:"\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD"},tis620:{type:"_sbcs",chars:"\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u0E01\u0E02\u0E03\u0E04\u0E05\u0E06\u0E07\u0E08\u0E09\u0E0A\u0E0B\u0E0C\u0E0D\u0E0E\u0E0F\u0E10\u0E11\u0E12\u0E13\u0E14\u0E15\u0E16\u0E17\u0E18\u0E19\u0E1A\u0E1B\u0E1C\u0E1D\u0E1E\u0E1F\u0E20\u0E21\u0E22\u0E23\u0E24\u0E25\u0E26\u0E27\u0E28\u0E29\u0E2A\u0E2B\u0E2C\u0E2D\u0E2E\u0E2F\u0E30\u0E31\u0E32\u0E33\u0E34\u0E35\u0E36\u0E37\u0E38\u0E39\u0E3A\uFFFD\uFFFD\uFFFD\uFFFD\u0E3F\u0E40\u0E41\u0E42\u0E43\u0E44\u0E45\u0E46\u0E47\u0E48\u0E49\u0E4A\u0E4B\u0E4C\u0E4D\u0E4E\u0E4F\u0E50\u0E51\u0E52\u0E53\u0E54\u0E55\u0E56\u0E57\u0E58\u0E59\u0E5A\u0E5B\uFFFD\uFFFD\uFFFD\uFFFD"}}});var eO=H(ZT=>{"use strict";var tl=vi().Buffer;ZT._dbcs=_s;var Pn=-1,YT=-2,pa=-10,es=-1e3,el=new Array(256),sp=-1;for(dh=0;dh<256;dh++)el[dh]=Pn;var dh;function _s(r,e){if(this.encodingName=r.encodingName,!r)throw new Error("DBCS codec is called without the data.");if(!r.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var t=r.table();this.decodeTables=[],this.decodeTables[0]=el.slice(0),this.decodeTableSeq=[];for(var n=0;n<t.length;n++)this._addDecodeChunk(t[n]);this.defaultCharUnicode=e.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var a={};if(r.encodeSkipVals)for(var n=0;n<r.encodeSkipVals.length;n++){var s=r.encodeSkipVals[n];if(typeof s=="number")a[s]=!0;else for(var o=s.from;o<=s.to;o++)a[o]=!0}if(this._fillEncodeTable(0,0,a),r.encodeAdd)for(var i in r.encodeAdd)Object.prototype.hasOwnProperty.call(r.encodeAdd,i)&&this._setEncodeChar(i.charCodeAt(0),r.encodeAdd[i]);if(this.defCharSB=this.encodeTable[0][e.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===Pn&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===Pn&&(this.defCharSB=63),typeof r.gb18030=="function"){this.gb18030=r.gb18030();for(var u=this.decodeTables.length,c=this.decodeTables[u]=el.slice(0),p=this.decodeTables.length,m=this.decodeTables[p]=el.slice(0),n=129;n<=254;n++)for(var f=es-this.decodeTables[0][n],g=this.decodeTables[f],o=48;o<=57;o++)g[o]=es-u;for(var n=129;n<=254;n++)c[n]=es-p;for(var n=48;n<=57;n++)m[n]=YT}}_s.prototype.encoder=mh;_s.prototype.decoder=cv;_s.prototype._getDecodeTrieNode=function(r){for(var e=[];r>0;r>>=8)e.push(r&255);e.length==0&&e.push(0);for(var t=this.decodeTables[0],n=e.length-1;n>0;n--){var a=t[e[n]];if(a==Pn)t[e[n]]=es-this.decodeTables.length,this.decodeTables.push(t=el.slice(0));else if(a<=es)t=this.decodeTables[es-a];else throw new Error("Overwrite byte in "+this.encodingName+", addr: "+r.toString(16))}return t};_s.prototype._addDecodeChunk=function(r){var e=parseInt(r[0],16),t=this._getDecodeTrieNode(e);e=e&255;for(var n=1;n<r.length;n++){var a=r[n];if(typeof a=="string")for(var s=0;s<a.length;){var o=a.charCodeAt(s++);if(55296<=o&&o<56320){var i=a.charCodeAt(s++);if(56320<=i&&i<57344)t[e++]=65536+(o-55296)*1024+(i-56320);else throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+r[0])}else if(4080<o&&o<=4095){for(var u=4095-o+2,c=[],p=0;p<u;p++)c.push(a.charCodeAt(s++));t[e++]=pa-this.decodeTableSeq.length,this.decodeTableSeq.push(c)}else t[e++]=o}else if(typeof a=="number")for(var m=t[e-1]+1,s=0;s<a;s++)t[e++]=m++;else throw new Error("Incorrect type '"+typeof a+"' given in "+this.encodingName+" at chunk "+r[0])}if(e>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+r[0]+": too long"+e)};_s.prototype._getEncodeBucket=function(r){var e=r>>8;return this.encodeTable[e]===void 0&&(this.encodeTable[e]=el.slice(0)),this.encodeTable[e]};_s.prototype._setEncodeChar=function(r,e){var t=this._getEncodeBucket(r),n=r&255;t[n]<=pa?this.encodeTableSeq[pa-t[n]][sp]=e:t[n]==Pn&&(t[n]=e)};_s.prototype._setEncodeSequence=function(r,e){var t=r[0],n=this._getEncodeBucket(t),a=t&255,s;n[a]<=pa?s=this.encodeTableSeq[pa-n[a]]:(s={},n[a]!==Pn&&(s[sp]=n[a]),n[a]=pa-this.encodeTableSeq.length,this.encodeTableSeq.push(s));for(var o=1;o<r.length-1;o++){var i=s[t];typeof i=="object"?s=i:(s=s[t]={},i!==void 0&&(s[sp]=i))}t=r[r.length-1],s[t]=e};_s.prototype._fillEncodeTable=function(r,e,t){for(var n=this.decodeTables[r],a=0;a<256;a++){var s=n[a],o=e+a;t[o]||(s>=0?this._setEncodeChar(s,o):s<=es?this._fillEncodeTable(es-s,o<<8,t):s<=pa&&this._setEncodeSequence(this.decodeTableSeq[pa-s],o))}};function mh(r,e){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=e.encodeTable,this.encodeTableSeq=e.encodeTableSeq,this.defaultCharSingleByte=e.defCharSB,this.gb18030=e.gb18030}mh.prototype.write=function(r){for(var e=tl.alloc(r.length*(this.gb18030?4:3)),t=this.leadSurrogate,n=this.seqObj,a=-1,s=0,o=0;;){if(a===-1){if(s==r.length)break;var i=r.charCodeAt(s++)}else{var i=a;a=-1}if(55296<=i&&i<57344)if(i<56320)if(t===-1){t=i;continue}else t=i,i=Pn;else t!==-1?(i=65536+(t-55296)*1024+(i-56320),t=-1):i=Pn;else t!==-1&&(a=i,i=Pn,t=-1);var u=Pn;if(n!==void 0&&i!=Pn){var c=n[i];if(typeof c=="object"){n=c;continue}else typeof c=="number"?u=c:c==null&&(c=n[sp],c!==void 0&&(u=c,a=i));n=void 0}else if(i>=0){var p=this.encodeTable[i>>8];if(p!==void 0&&(u=p[i&255]),u<=pa){n=this.encodeTableSeq[pa-u];continue}if(u==Pn&&this.gb18030){var m=lv(this.gb18030.uChars,i);if(m!=-1){var u=this.gb18030.gbChars[m]+(i-this.gb18030.uChars[m]);e[o++]=129+Math.floor(u/12600),u=u%12600,e[o++]=48+Math.floor(u/1260),u=u%1260,e[o++]=129+Math.floor(u/10),u=u%10,e[o++]=48+u;continue}}}u===Pn&&(u=this.defaultCharSingleByte),u<256?e[o++]=u:u<65536?(e[o++]=u>>8,e[o++]=u&255):(e[o++]=u>>16,e[o++]=u>>8&255,e[o++]=u&255)}return this.seqObj=n,this.leadSurrogate=t,e.slice(0,o)};mh.prototype.end=function(){if(!(this.leadSurrogate===-1&&this.seqObj===void 0)){var r=tl.alloc(10),e=0;if(this.seqObj){var t=this.seqObj[sp];t!==void 0&&(t<256?r[e++]=t:(r[e++]=t>>8,r[e++]=t&255)),this.seqObj=void 0}return this.leadSurrogate!==-1&&(r[e++]=this.defaultCharSingleByte,this.leadSurrogate=-1),r.slice(0,e)}};mh.prototype.findIdx=lv;function cv(r,e){this.nodeIdx=0,this.prevBuf=tl.alloc(0),this.decodeTables=e.decodeTables,this.decodeTableSeq=e.decodeTableSeq,this.defaultCharUnicode=e.defaultCharUnicode,this.gb18030=e.gb18030}cv.prototype.write=function(r){var e=tl.alloc(r.length*2),t=this.nodeIdx,n=this.prevBuf,a=this.prevBuf.length,s=-this.prevBuf.length,o;a>0&&(n=tl.concat([n,r.slice(0,10)]));for(var i=0,u=0;i<r.length;i++){var c=i>=0?r[i]:n[i+a],o=this.decodeTables[t][c];if(!(o>=0))if(o===Pn)i=s,o=this.defaultCharUnicode.charCodeAt(0);else if(o===YT){var p=s>=0?r.slice(s,i+1):n.slice(s+a,i+1+a),m=(p[0]-129)*12600+(p[1]-48)*1260+(p[2]-129)*10+(p[3]-48),f=lv(this.gb18030.gbChars,m);o=this.gb18030.uChars[f]+m-this.gb18030.gbChars[f]}else if(o<=es){t=es-o;continue}else if(o<=pa){for(var g=this.decodeTableSeq[pa-o],y=0;y<g.length-1;y++)o=g[y],e[u++]=o&255,e[u++]=o>>8;o=g[g.length-1]}else throw new Error("iconv-lite internal error: invalid decoding table value "+o+" at "+t+"/"+c);if(o>65535){o-=65536;var C=55296+Math.floor(o/1024);e[u++]=C&255,e[u++]=C>>8,o=56320+o%1024}e[u++]=o&255,e[u++]=o>>8,t=0,s=i+1}return this.nodeIdx=t,this.prevBuf=s>=0?r.slice(s):n.slice(s+a),e.slice(0,u).toString("ucs2")};cv.prototype.end=function(){for(var r="";this.prevBuf.length>0;){r+=this.defaultCharUnicode;var e=this.prevBuf.slice(1);this.prevBuf=tl.alloc(0),this.nodeIdx=0,e.length>0&&(r+=this.write(e))}return this.nodeIdx=0,r};function lv(r,e){if(r[0]>e)return-1;for(var t=0,n=r.length;t<n-1;){var a=t+Math.floor((n-t+1)/2);r[a]<=e?t=a:n=a}return t}});var tO=H((Ale,jG)=>{jG.exports=[["0","\0",128],["a1","\uFF61",62],["8140","\u3000\u3001\u3002\uFF0C\uFF0E\u30FB\uFF1A\uFF1B\uFF1F\uFF01\u309B\u309C\xB4\uFF40\xA8\uFF3E\uFFE3\uFF3F\u30FD\u30FE\u309D\u309E\u3003\u4EDD\u3005\u3006\u3007\u30FC\u2015\u2010\uFF0F\uFF3C\uFF5E\u2225\uFF5C\u2026\u2025\u2018\u2019\u201C\u201D\uFF08\uFF09\u3014\u3015\uFF3B\uFF3D\uFF5B\uFF5D\u3008",9,"\uFF0B\uFF0D\xB1\xD7"],["8180","\xF7\uFF1D\u2260\uFF1C\uFF1E\u2266\u2267\u221E\u2234\u2642\u2640\xB0\u2032\u2033\u2103\uFFE5\uFF04\uFFE0\uFFE1\uFF05\uFF03\uFF06\uFF0A\uFF20\xA7\u2606\u2605\u25CB\u25CF\u25CE\u25C7\u25C6\u25A1\u25A0\u25B3\u25B2\u25BD\u25BC\u203B\u3012\u2192\u2190\u2191\u2193\u3013"],["81b8","\u2208\u220B\u2286\u2287\u2282\u2283\u222A\u2229"],["81c8","\u2227\u2228\uFFE2\u21D2\u21D4\u2200\u2203"],["81da","\u2220\u22A5\u2312\u2202\u2207\u2261\u2252\u226A\u226B\u221A\u223D\u221D\u2235\u222B\u222C"],["81f0","\u212B\u2030\u266F\u266D\u266A\u2020\u2021\xB6"],["81fc","\u25EF"],["824f","\uFF10",9],["8260","\uFF21",25],["8281","\uFF41",25],["829f","\u3041",82],["8340","\u30A1",62],["8380","\u30E0",22],["839f","\u0391",16,"\u03A3",6],["83bf","\u03B1",16,"\u03C3",6],["8440","\u0410",5,"\u0401\u0416",25],["8470","\u0430",5,"\u0451\u0436",7],["8480","\u043E",17],["849f","\u2500\u2502\u250C\u2510\u2518\u2514\u251C\u252C\u2524\u2534\u253C\u2501\u2503\u250F\u2513\u251B\u2517\u2523\u2533\u252B\u253B\u254B\u2520\u252F\u2528\u2537\u253F\u251D\u2530\u2525\u2538\u2542"],["8740","\u2460",19,"\u2160",9],["875f","\u3349\u3314\u3322\u334D\u3318\u3327\u3303\u3336\u3351\u3357\u330D\u3326\u3323\u332B\u334A\u333B\u339C\u339D\u339E\u338E\u338F\u33C4\u33A1"],["877e","\u337B"],["8780","\u301D\u301F\u2116\u33CD\u2121\u32A4",4,"\u3231\u3232\u3239\u337E\u337D\u337C\u2252\u2261\u222B\u222E\u2211\u221A\u22A5\u2220\u221F\u22BF\u2235\u2229\u222A"],["889f","\u4E9C\u5516\u5A03\u963F\u54C0\u611B\u6328\u59F6\u9022\u8475\u831C\u7A50\u60AA\u63E1\u6E25\u65ED\u8466\u82A6\u9BF5\u6893\u5727\u65A1\u6271\u5B9B\u59D0\u867B\u98F4\u7D62\u7DBE\u9B8E\u6216\u7C9F\u88B7\u5B89\u5EB5\u6309\u6697\u6848\u95C7\u978D\u674F\u4EE5\u4F0A\u4F4D\u4F9D\u5049\u56F2\u5937\u59D4\u5A01\u5C09\u60DF\u610F\u6170\u6613\u6905\u70BA\u754F\u7570\u79FB\u7DAD\u7DEF\u80C3\u840E\u8863\u8B02\u9055\u907A\u533B\u4E95\u4EA5\u57DF\u80B2\u90C1\u78EF\u4E00\u58F1\u6EA2\u9038\u7A32\u8328\u828B\u9C2F\u5141\u5370\u54BD\u54E1\u56E0\u59FB\u5F15\u98F2\u6DEB\u80E4\u852D"],["8940","\u9662\u9670\u96A0\u97FB\u540B\u53F3\u5B87\u70CF\u7FBD\u8FC2\u96E8\u536F\u9D5C\u7ABA\u4E11\u7893\u81FC\u6E26\u5618\u5504\u6B1D\u851A\u9C3B\u59E5\u53A9\u6D66\u74DC\u958F\u5642\u4E91\u904B\u96F2\u834F\u990C\u53E1\u55B6\u5B30\u5F71\u6620\u66F3\u6804\u6C38\u6CF3\u6D29\u745B\u76C8\u7A4E\u9834\u82F1\u885B\u8A60\u92ED\u6DB2\u75AB\u76CA\u99C5\u60A6\u8B01\u8D8A\u95B2\u698E\u53AD\u5186"],["8980","\u5712\u5830\u5944\u5BB4\u5EF6\u6028\u63A9\u63F4\u6CBF\u6F14\u708E\u7114\u7159\u71D5\u733F\u7E01\u8276\u82D1\u8597\u9060\u925B\u9D1B\u5869\u65BC\u6C5A\u7525\u51F9\u592E\u5965\u5F80\u5FDC\u62BC\u65FA\u6A2A\u6B27\u6BB4\u738B\u7FC1\u8956\u9D2C\u9D0E\u9EC4\u5CA1\u6C96\u837B\u5104\u5C4B\u61B6\u81C6\u6876\u7261\u4E59\u4FFA\u5378\u6069\u6E29\u7A4F\u97F3\u4E0B\u5316\u4EEE\u4F55\u4F3D\u4FA1\u4F73\u52A0\u53EF\u5609\u590F\u5AC1\u5BB6\u5BE1\u79D1\u6687\u679C\u67B6\u6B4C\u6CB3\u706B\u73C2\u798D\u79BE\u7A3C\u7B87\u82B1\u82DB\u8304\u8377\u83EF\u83D3\u8766\u8AB2\u5629\u8CA8\u8FE6\u904E\u971E\u868A\u4FC4\u5CE8\u6211\u7259\u753B\u81E5\u82BD\u86FE\u8CC0\u96C5\u9913\u99D5\u4ECB\u4F1A\u89E3\u56DE\u584A\u58CA\u5EFB\u5FEB\u602A\u6094\u6062\u61D0\u6212\u62D0\u6539"],["8a40","\u9B41\u6666\u68B0\u6D77\u7070\u754C\u7686\u7D75\u82A5\u87F9\u958B\u968E\u8C9D\u51F1\u52BE\u5916\u54B3\u5BB3\u5D16\u6168\u6982\u6DAF\u788D\u84CB\u8857\u8A72\u93A7\u9AB8\u6D6C\u99A8\u86D9\u57A3\u67FF\u86CE\u920E\u5283\u5687\u5404\u5ED3\u62E1\u64B9\u683C\u6838\u6BBB\u7372\u78BA\u7A6B\u899A\u89D2\u8D6B\u8F03\u90ED\u95A3\u9694\u9769\u5B66\u5CB3\u697D\u984D\u984E\u639B\u7B20\u6A2B"],["8a80","\u6A7F\u68B6\u9C0D\u6F5F\u5272\u559D\u6070\u62EC\u6D3B\u6E07\u6ED1\u845B\u8910\u8F44\u4E14\u9C39\u53F6\u691B\u6A3A\u9784\u682A\u515C\u7AC3\u84B2\u91DC\u938C\u565B\u9D28\u6822\u8305\u8431\u7CA5\u5208\u82C5\u74E6\u4E7E\u4F83\u51A0\u5BD2\u520A\u52D8\u52E7\u5DFB\u559A\u582A\u59E6\u5B8C\u5B98\u5BDB\u5E72\u5E79\u60A3\u611F\u6163\u61BE\u63DB\u6562\u67D1\u6853\u68FA\u6B3E\u6B53\u6C57\u6F22\u6F97\u6F45\u74B0\u7518\u76E3\u770B\u7AFF\u7BA1\u7C21\u7DE9\u7F36\u7FF0\u809D\u8266\u839E\u89B3\u8ACC\u8CAB\u9084\u9451\u9593\u9591\u95A2\u9665\u97D3\u9928\u8218\u4E38\u542B\u5CB8\u5DCC\u73A9\u764C\u773C\u5CA9\u7FEB\u8D0B\u96C1\u9811\u9854\u9858\u4F01\u4F0E\u5371\u559C\u5668\u57FA\u5947\u5B09\u5BC4\u5C90\u5E0C\u5E7E\u5FCC\u63EE\u673A\u65D7\u65E2\u671F\u68CB\u68C4"],["8b40","\u6A5F\u5E30\u6BC5\u6C17\u6C7D\u757F\u7948\u5B63\u7A00\u7D00\u5FBD\u898F\u8A18\u8CB4\u8D77\u8ECC\u8F1D\u98E2\u9A0E\u9B3C\u4E80\u507D\u5100\u5993\u5B9C\u622F\u6280\u64EC\u6B3A\u72A0\u7591\u7947\u7FA9\u87FB\u8ABC\u8B70\u63AC\u83CA\u97A0\u5409\u5403\u55AB\u6854\u6A58\u8A70\u7827\u6775\u9ECD\u5374\u5BA2\u811A\u8650\u9006\u4E18\u4E45\u4EC7\u4F11\u53CA\u5438\u5BAE\u5F13\u6025\u6551"],["8b80","\u673D\u6C42\u6C72\u6CE3\u7078\u7403\u7A76\u7AAE\u7B08\u7D1A\u7CFE\u7D66\u65E7\u725B\u53BB\u5C45\u5DE8\u62D2\u62E0\u6319\u6E20\u865A\u8A31\u8DDD\u92F8\u6F01\u79A6\u9B5A\u4EA8\u4EAB\u4EAC\u4F9B\u4FA0\u50D1\u5147\u7AF6\u5171\u51F6\u5354\u5321\u537F\u53EB\u55AC\u5883\u5CE1\u5F37\u5F4A\u602F\u6050\u606D\u631F\u6559\u6A4B\u6CC1\u72C2\u72ED\u77EF\u80F8\u8105\u8208\u854E\u90F7\u93E1\u97FF\u9957\u9A5A\u4EF0\u51DD\u5C2D\u6681\u696D\u5C40\u66F2\u6975\u7389\u6850\u7C81\u50C5\u52E4\u5747\u5DFE\u9326\u65A4\u6B23\u6B3D\u7434\u7981\u79BD\u7B4B\u7DCA\u82B9\u83CC\u887F\u895F\u8B39\u8FD1\u91D1\u541F\u9280\u4E5D\u5036\u53E5\u533A\u72D7\u7396\u77E9\u82E6\u8EAF\u99C6\u99C8\u99D2\u5177\u611A\u865E\u55B0\u7A7A\u5076\u5BD3\u9047\u9685\u4E32\u6ADB\u91E7\u5C51\u5C48"],["8c40","\u6398\u7A9F\u6C93\u9774\u8F61\u7AAA\u718A\u9688\u7C82\u6817\u7E70\u6851\u936C\u52F2\u541B\u85AB\u8A13\u7FA4\u8ECD\u90E1\u5366\u8888\u7941\u4FC2\u50BE\u5211\u5144\u5553\u572D\u73EA\u578B\u5951\u5F62\u5F84\u6075\u6176\u6167\u61A9\u63B2\u643A\u656C\u666F\u6842\u6E13\u7566\u7A3D\u7CFB\u7D4C\u7D99\u7E4B\u7F6B\u830E\u834A\u86CD\u8A08\u8A63\u8B66\u8EFD\u981A\u9D8F\u82B8\u8FCE\u9BE8"],["8c80","\u5287\u621F\u6483\u6FC0\u9699\u6841\u5091\u6B20\u6C7A\u6F54\u7A74\u7D50\u8840\u8A23\u6708\u4EF6\u5039\u5026\u5065\u517C\u5238\u5263\u55A7\u570F\u5805\u5ACC\u5EFA\u61B2\u61F8\u62F3\u6372\u691C\u6A29\u727D\u72AC\u732E\u7814\u786F\u7D79\u770C\u80A9\u898B\u8B19\u8CE2\u8ED2\u9063\u9375\u967A\u9855\u9A13\u9E78\u5143\u539F\u53B3\u5E7B\u5F26\u6E1B\u6E90\u7384\u73FE\u7D43\u8237\u8A00\u8AFA\u9650\u4E4E\u500B\u53E4\u547C\u56FA\u59D1\u5B64\u5DF1\u5EAB\u5F27\u6238\u6545\u67AF\u6E56\u72D0\u7CCA\u88B4\u80A1\u80E1\u83F0\u864E\u8A87\u8DE8\u9237\u96C7\u9867\u9F13\u4E94\u4E92\u4F0D\u5348\u5449\u543E\u5A2F\u5F8C\u5FA1\u609F\u68A7\u6A8E\u745A\u7881\u8A9E\u8AA4\u8B77\u9190\u4E5E\u9BC9\u4EA4\u4F7C\u4FAF\u5019\u5016\u5149\u516C\u529F\u52B9\u52FE\u539A\u53E3\u5411"],["8d40","\u540E\u5589\u5751\u57A2\u597D\u5B54\u5B5D\u5B8F\u5DE5\u5DE7\u5DF7\u5E78\u5E83\u5E9A\u5EB7\u5F18\u6052\u614C\u6297\u62D8\u63A7\u653B\u6602\u6643\u66F4\u676D\u6821\u6897\u69CB\u6C5F\u6D2A\u6D69\u6E2F\u6E9D\u7532\u7687\u786C\u7A3F\u7CE0\u7D05\u7D18\u7D5E\u7DB1\u8015\u8003\u80AF\u80B1\u8154\u818F\u822A\u8352\u884C\u8861\u8B1B\u8CA2\u8CFC\u90CA\u9175\u9271\u783F\u92FC\u95A4\u964D"],["8d80","\u9805\u9999\u9AD8\u9D3B\u525B\u52AB\u53F7\u5408\u58D5\u62F7\u6FE0\u8C6A\u8F5F\u9EB9\u514B\u523B\u544A\u56FD\u7A40\u9177\u9D60\u9ED2\u7344\u6F09\u8170\u7511\u5FFD\u60DA\u9AA8\u72DB\u8FBC\u6B64\u9803\u4ECA\u56F0\u5764\u58BE\u5A5A\u6068\u61C7\u660F\u6606\u6839\u68B1\u6DF7\u75D5\u7D3A\u826E\u9B42\u4E9B\u4F50\u53C9\u5506\u5D6F\u5DE6\u5DEE\u67FB\u6C99\u7473\u7802\u8A50\u9396\u88DF\u5750\u5EA7\u632B\u50B5\u50AC\u518D\u6700\u54C9\u585E\u59BB\u5BB0\u5F69\u624D\u63A1\u683D\u6B73\u6E08\u707D\u91C7\u7280\u7815\u7826\u796D\u658E\u7D30\u83DC\u88C1\u8F09\u969B\u5264\u5728\u6750\u7F6A\u8CA1\u51B4\u5742\u962A\u583A\u698A\u80B4\u54B2\u5D0E\u57FC\u7895\u9DFA\u4F5C\u524A\u548B\u643E\u6628\u6714\u67F5\u7A84\u7B56\u7D22\u932F\u685C\u9BAD\u7B39\u5319\u518A\u5237"],["8e40","\u5BDF\u62F6\u64AE\u64E6\u672D\u6BBA\u85A9\u96D1\u7690\u9BD6\u634C\u9306\u9BAB\u76BF\u6652\u4E09\u5098\u53C2\u5C71\u60E8\u6492\u6563\u685F\u71E6\u73CA\u7523\u7B97\u7E82\u8695\u8B83\u8CDB\u9178\u9910\u65AC\u66AB\u6B8B\u4ED5\u4ED4\u4F3A\u4F7F\u523A\u53F8\u53F2\u55E3\u56DB\u58EB\u59CB\u59C9\u59FF\u5B50\u5C4D\u5E02\u5E2B\u5FD7\u601D\u6307\u652F\u5B5C\u65AF\u65BD\u65E8\u679D\u6B62"],["8e80","\u6B7B\u6C0F\u7345\u7949\u79C1\u7CF8\u7D19\u7D2B\u80A2\u8102\u81F3\u8996\u8A5E\u8A69\u8A66\u8A8C\u8AEE\u8CC7\u8CDC\u96CC\u98FC\u6B6F\u4E8B\u4F3C\u4F8D\u5150\u5B57\u5BFA\u6148\u6301\u6642\u6B21\u6ECB\u6CBB\u723E\u74BD\u75D4\u78C1\u793A\u800C\u8033\u81EA\u8494\u8F9E\u6C50\u9E7F\u5F0F\u8B58\u9D2B\u7AFA\u8EF8\u5B8D\u96EB\u4E03\u53F1\u57F7\u5931\u5AC9\u5BA4\u6089\u6E7F\u6F06\u75BE\u8CEA\u5B9F\u8500\u7BE0\u5072\u67F4\u829D\u5C61\u854A\u7E1E\u820E\u5199\u5C04\u6368\u8D66\u659C\u716E\u793E\u7D17\u8005\u8B1D\u8ECA\u906E\u86C7\u90AA\u501F\u52FA\u5C3A\u6753\u707C\u7235\u914C\u91C8\u932B\u82E5\u5BC2\u5F31\u60F9\u4E3B\u53D6\u5B88\u624B\u6731\u6B8A\u72E9\u73E0\u7A2E\u816B\u8DA3\u9152\u9996\u5112\u53D7\u546A\u5BFF\u6388\u6A39\u7DAC\u9700\u56DA\u53CE\u5468"],["8f40","\u5B97\u5C31\u5DDE\u4FEE\u6101\u62FE\u6D32\u79C0\u79CB\u7D42\u7E4D\u7FD2\u81ED\u821F\u8490\u8846\u8972\u8B90\u8E74\u8F2F\u9031\u914B\u916C\u96C6\u919C\u4EC0\u4F4F\u5145\u5341\u5F93\u620E\u67D4\u6C41\u6E0B\u7363\u7E26\u91CD\u9283\u53D4\u5919\u5BBF\u6DD1\u795D\u7E2E\u7C9B\u587E\u719F\u51FA\u8853\u8FF0\u4FCA\u5CFB\u6625\u77AC\u7AE3\u821C\u99FF\u51C6\u5FAA\u65EC\u696F\u6B89\u6DF3"],["8f80","\u6E96\u6F64\u76FE\u7D14\u5DE1\u9075\u9187\u9806\u51E6\u521D\u6240\u6691\u66D9\u6E1A\u5EB6\u7DD2\u7F72\u66F8\u85AF\u85F7\u8AF8\u52A9\u53D9\u5973\u5E8F\u5F90\u6055\u92E4\u9664\u50B7\u511F\u52DD\u5320\u5347\u53EC\u54E8\u5546\u5531\u5617\u5968\u59BE\u5A3C\u5BB5\u5C06\u5C0F\u5C11\u5C1A\u5E84\u5E8A\u5EE0\u5F70\u627F\u6284\u62DB\u638C\u6377\u6607\u660C\u662D\u6676\u677E\u68A2\u6A1F\u6A35\u6CBC\u6D88\u6E09\u6E58\u713C\u7126\u7167\u75C7\u7701\u785D\u7901\u7965\u79F0\u7AE0\u7B11\u7CA7\u7D39\u8096\u83D6\u848B\u8549\u885D\u88F3\u8A1F\u8A3C\u8A54\u8A73\u8C61\u8CDE\u91A4\u9266\u937E\u9418\u969C\u9798\u4E0A\u4E08\u4E1E\u4E57\u5197\u5270\u57CE\u5834\u58CC\u5B22\u5E38\u60C5\u64FE\u6761\u6756\u6D44\u72B6\u7573\u7A63\u84B8\u8B72\u91B8\u9320\u5631\u57F4\u98FE"],["9040","\u62ED\u690D\u6B96\u71ED\u7E54\u8077\u8272\u89E6\u98DF\u8755\u8FB1\u5C3B\u4F38\u4FE1\u4FB5\u5507\u5A20\u5BDD\u5BE9\u5FC3\u614E\u632F\u65B0\u664B\u68EE\u699B\u6D78\u6DF1\u7533\u75B9\u771F\u795E\u79E6\u7D33\u81E3\u82AF\u85AA\u89AA\u8A3A\u8EAB\u8F9B\u9032\u91DD\u9707\u4EBA\u4EC1\u5203\u5875\u58EC\u5C0B\u751A\u5C3D\u814E\u8A0A\u8FC5\u9663\u976D\u7B25\u8ACF\u9808\u9162\u56F3\u53A8"],["9080","\u9017\u5439\u5782\u5E25\u63A8\u6C34\u708A\u7761\u7C8B\u7FE0\u8870\u9042\u9154\u9310\u9318\u968F\u745E\u9AC4\u5D07\u5D69\u6570\u67A2\u8DA8\u96DB\u636E\u6749\u6919\u83C5\u9817\u96C0\u88FE\u6F84\u647A\u5BF8\u4E16\u702C\u755D\u662F\u51C4\u5236\u52E2\u59D3\u5F81\u6027\u6210\u653F\u6574\u661F\u6674\u68F2\u6816\u6B63\u6E05\u7272\u751F\u76DB\u7CBE\u8056\u58F0\u88FD\u897F\u8AA0\u8A93\u8ACB\u901D\u9192\u9752\u9759\u6589\u7A0E\u8106\u96BB\u5E2D\u60DC\u621A\u65A5\u6614\u6790\u77F3\u7A4D\u7C4D\u7E3E\u810A\u8CAC\u8D64\u8DE1\u8E5F\u78A9\u5207\u62D9\u63A5\u6442\u6298\u8A2D\u7A83\u7BC0\u8AAC\u96EA\u7D76\u820C\u8749\u4ED9\u5148\u5343\u5360\u5BA3\u5C02\u5C16\u5DDD\u6226\u6247\u64B0\u6813\u6834\u6CC9\u6D45\u6D17\u67D3\u6F5C\u714E\u717D\u65CB\u7A7F\u7BAD\u7DDA"],["9140","\u7E4A\u7FA8\u817A\u821B\u8239\u85A6\u8A6E\u8CCE\u8DF5\u9078\u9077\u92AD\u9291\u9583\u9BAE\u524D\u5584\u6F38\u7136\u5168\u7985\u7E55\u81B3\u7CCE\u564C\u5851\u5CA8\u63AA\u66FE\u66FD\u695A\u72D9\u758F\u758E\u790E\u7956\u79DF\u7C97\u7D20\u7D44\u8607\u8A34\u963B\u9061\u9F20\u50E7\u5275\u53CC\u53E2\u5009\u55AA\u58EE\u594F\u723D\u5B8B\u5C64\u531D\u60E3\u60F3\u635C\u6383\u633F\u63BB"],["9180","\u64CD\u65E9\u66F9\u5DE3\u69CD\u69FD\u6F15\u71E5\u4E89\u75E9\u76F8\u7A93\u7CDF\u7DCF\u7D9C\u8061\u8349\u8358\u846C\u84BC\u85FB\u88C5\u8D70\u9001\u906D\u9397\u971C\u9A12\u50CF\u5897\u618E\u81D3\u8535\u8D08\u9020\u4FC3\u5074\u5247\u5373\u606F\u6349\u675F\u6E2C\u8DB3\u901F\u4FD7\u5C5E\u8CCA\u65CF\u7D9A\u5352\u8896\u5176\u63C3\u5B58\u5B6B\u5C0A\u640D\u6751\u905C\u4ED6\u591A\u592A\u6C70\u8A51\u553E\u5815\u59A5\u60F0\u6253\u67C1\u8235\u6955\u9640\u99C4\u9A28\u4F53\u5806\u5BFE\u8010\u5CB1\u5E2F\u5F85\u6020\u614B\u6234\u66FF\u6CF0\u6EDE\u80CE\u817F\u82D4\u888B\u8CB8\u9000\u902E\u968A\u9EDB\u9BDB\u4EE3\u53F0\u5927\u7B2C\u918D\u984C\u9DF9\u6EDD\u7027\u5353\u5544\u5B85\u6258\u629E\u62D3\u6CA2\u6FEF\u7422\u8A17\u9438\u6FC1\u8AFE\u8338\u51E7\u86F8\u53EA"],["9240","\u53E9\u4F46\u9054\u8FB0\u596A\u8131\u5DFD\u7AEA\u8FBF\u68DA\u8C37\u72F8\u9C48\u6A3D\u8AB0\u4E39\u5358\u5606\u5766\u62C5\u63A2\u65E6\u6B4E\u6DE1\u6E5B\u70AD\u77ED\u7AEF\u7BAA\u7DBB\u803D\u80C6\u86CB\u8A95\u935B\u56E3\u58C7\u5F3E\u65AD\u6696\u6A80\u6BB5\u7537\u8AC7\u5024\u77E5\u5730\u5F1B\u6065\u667A\u6C60\u75F4\u7A1A\u7F6E\u81F4\u8718\u9045\u99B3\u7BC9\u755C\u7AF9\u7B51\u84C4"],["9280","\u9010\u79E9\u7A92\u8336\u5AE1\u7740\u4E2D\u4EF2\u5B99\u5FE0\u62BD\u663C\u67F1\u6CE8\u866B\u8877\u8A3B\u914E\u92F3\u99D0\u6A17\u7026\u732A\u82E7\u8457\u8CAF\u4E01\u5146\u51CB\u558B\u5BF5\u5E16\u5E33\u5E81\u5F14\u5F35\u5F6B\u5FB4\u61F2\u6311\u66A2\u671D\u6F6E\u7252\u753A\u773A\u8074\u8139\u8178\u8776\u8ABF\u8ADC\u8D85\u8DF3\u929A\u9577\u9802\u9CE5\u52C5\u6357\u76F4\u6715\u6C88\u73CD\u8CC3\u93AE\u9673\u6D25\u589C\u690E\u69CC\u8FFD\u939A\u75DB\u901A\u585A\u6802\u63B4\u69FB\u4F43\u6F2C\u67D8\u8FBB\u8526\u7DB4\u9354\u693F\u6F70\u576A\u58F7\u5B2C\u7D2C\u722A\u540A\u91E3\u9DB4\u4EAD\u4F4E\u505C\u5075\u5243\u8C9E\u5448\u5824\u5B9A\u5E1D\u5E95\u5EAD\u5EF7\u5F1F\u608C\u62B5\u633A\u63D0\u68AF\u6C40\u7887\u798E\u7A0B\u7DE0\u8247\u8A02\u8AE6\u8E44\u9013"],["9340","\u90B8\u912D\u91D8\u9F0E\u6CE5\u6458\u64E2\u6575\u6EF4\u7684\u7B1B\u9069\u93D1\u6EBA\u54F2\u5FB9\u64A4\u8F4D\u8FED\u9244\u5178\u586B\u5929\u5C55\u5E97\u6DFB\u7E8F\u751C\u8CBC\u8EE2\u985B\u70B9\u4F1D\u6BBF\u6FB1\u7530\u96FB\u514E\u5410\u5835\u5857\u59AC\u5C60\u5F92\u6597\u675C\u6E21\u767B\u83DF\u8CED\u9014\u90FD\u934D\u7825\u783A\u52AA\u5EA6\u571F\u5974\u6012\u5012\u515A\u51AC"],["9380","\u51CD\u5200\u5510\u5854\u5858\u5957\u5B95\u5CF6\u5D8B\u60BC\u6295\u642D\u6771\u6843\u68BC\u68DF\u76D7\u6DD8\u6E6F\u6D9B\u706F\u71C8\u5F53\u75D8\u7977\u7B49\u7B54\u7B52\u7CD6\u7D71\u5230\u8463\u8569\u85E4\u8A0E\u8B04\u8C46\u8E0F\u9003\u900F\u9419\u9676\u982D\u9A30\u95D8\u50CD\u52D5\u540C\u5802\u5C0E\u61A7\u649E\u6D1E\u77B3\u7AE5\u80F4\u8404\u9053\u9285\u5CE0\u9D07\u533F\u5F97\u5FB3\u6D9C\u7279\u7763\u79BF\u7BE4\u6BD2\u72EC\u8AAD\u6803\u6A61\u51F8\u7A81\u6934\u5C4A\u9CF6\u82EB\u5BC5\u9149\u701E\u5678\u5C6F\u60C7\u6566\u6C8C\u8C5A\u9041\u9813\u5451\u66C7\u920D\u5948\u90A3\u5185\u4E4D\u51EA\u8599\u8B0E\u7058\u637A\u934B\u6962\u99B4\u7E04\u7577\u5357\u6960\u8EDF\u96E3\u6C5D\u4E8C\u5C3C\u5F10\u8FE9\u5302\u8CD1\u8089\u8679\u5EFF\u65E5\u4E73\u5165"],["9440","\u5982\u5C3F\u97EE\u4EFB\u598A\u5FCD\u8A8D\u6FE1\u79B0\u7962\u5BE7\u8471\u732B\u71B1\u5E74\u5FF5\u637B\u649A\u71C3\u7C98\u4E43\u5EFC\u4E4B\u57DC\u56A2\u60A9\u6FC3\u7D0D\u80FD\u8133\u81BF\u8FB2\u8997\u86A4\u5DF4\u628A\u64AD\u8987\u6777\u6CE2\u6D3E\u7436\u7834\u5A46\u7F75\u82AD\u99AC\u4FF3\u5EC3\u62DD\u6392\u6557\u676F\u76C3\u724C\u80CC\u80BA\u8F29\u914D\u500D\u57F9\u5A92\u6885"],["9480","\u6973\u7164\u72FD\u8CB7\u58F2\u8CE0\u966A\u9019\u877F\u79E4\u77E7\u8429\u4F2F\u5265\u535A\u62CD\u67CF\u6CCA\u767D\u7B94\u7C95\u8236\u8584\u8FEB\u66DD\u6F20\u7206\u7E1B\u83AB\u99C1\u9EA6\u51FD\u7BB1\u7872\u7BB8\u8087\u7B48\u6AE8\u5E61\u808C\u7551\u7560\u516B\u9262\u6E8C\u767A\u9197\u9AEA\u4F10\u7F70\u629C\u7B4F\u95A5\u9CE9\u567A\u5859\u86E4\u96BC\u4F34\u5224\u534A\u53CD\u53DB\u5E06\u642C\u6591\u677F\u6C3E\u6C4E\u7248\u72AF\u73ED\u7554\u7E41\u822C\u85E9\u8CA9\u7BC4\u91C6\u7169\u9812\u98EF\u633D\u6669\u756A\u76E4\u78D0\u8543\u86EE\u532A\u5351\u5426\u5983\u5E87\u5F7C\u60B2\u6249\u6279\u62AB\u6590\u6BD4\u6CCC\u75B2\u76AE\u7891\u79D8\u7DCB\u7F77\u80A5\u88AB\u8AB9\u8CBB\u907F\u975E\u98DB\u6A0B\u7C38\u5099\u5C3E\u5FAE\u6787\u6BD8\u7435\u7709\u7F8E"],["9540","\u9F3B\u67CA\u7A17\u5339\u758B\u9AED\u5F66\u819D\u83F1\u8098\u5F3C\u5FC5\u7562\u7B46\u903C\u6867\u59EB\u5A9B\u7D10\u767E\u8B2C\u4FF5\u5F6A\u6A19\u6C37\u6F02\u74E2\u7968\u8868\u8A55\u8C79\u5EDF\u63CF\u75C5\u79D2\u82D7\u9328\u92F2\u849C\u86ED\u9C2D\u54C1\u5F6C\u658C\u6D5C\u7015\u8CA7\u8CD3\u983B\u654F\u74F6\u4E0D\u4ED8\u57E0\u592B\u5A66\u5BCC\u51A8\u5E03\u5E9C\u6016\u6276\u6577"],["9580","\u65A7\u666E\u6D6E\u7236\u7B26\u8150\u819A\u8299\u8B5C\u8CA0\u8CE6\u8D74\u961C\u9644\u4FAE\u64AB\u6B66\u821E\u8461\u856A\u90E8\u5C01\u6953\u98A8\u847A\u8557\u4F0F\u526F\u5FA9\u5E45\u670D\u798F\u8179\u8907\u8986\u6DF5\u5F17\u6255\u6CB8\u4ECF\u7269\u9B92\u5206\u543B\u5674\u58B3\u61A4\u626E\u711A\u596E\u7C89\u7CDE\u7D1B\u96F0\u6587\u805E\u4E19\u4F75\u5175\u5840\u5E63\u5E73\u5F0A\u67C4\u4E26\u853D\u9589\u965B\u7C73\u9801\u50FB\u58C1\u7656\u78A7\u5225\u77A5\u8511\u7B86\u504F\u5909\u7247\u7BC7\u7DE8\u8FBA\u8FD4\u904D\u4FBF\u52C9\u5A29\u5F01\u97AD\u4FDD\u8217\u92EA\u5703\u6355\u6B69\u752B\u88DC\u8F14\u7A42\u52DF\u5893\u6155\u620A\u66AE\u6BCD\u7C3F\u83E9\u5023\u4FF8\u5305\u5446\u5831\u5949\u5B9D\u5CF0\u5CEF\u5D29\u5E96\u62B1\u6367\u653E\u65B9\u670B"],["9640","\u6CD5\u6CE1\u70F9\u7832\u7E2B\u80DE\u82B3\u840C\u84EC\u8702\u8912\u8A2A\u8C4A\u90A6\u92D2\u98FD\u9CF3\u9D6C\u4E4F\u4EA1\u508D\u5256\u574A\u59A8\u5E3D\u5FD8\u5FD9\u623F\u66B4\u671B\u67D0\u68D2\u5192\u7D21\u80AA\u81A8\u8B00\u8C8C\u8CBF\u927E\u9632\u5420\u982C\u5317\u50D5\u535C\u58A8\u64B2\u6734\u7267\u7766\u7A46\u91E6\u52C3\u6CA1\u6B86\u5800\u5E4C\u5954\u672C\u7FFB\u51E1\u76C6"],["9680","\u6469\u78E8\u9B54\u9EBB\u57CB\u59B9\u6627\u679A\u6BCE\u54E9\u69D9\u5E55\u819C\u6795\u9BAA\u67FE\u9C52\u685D\u4EA6\u4FE3\u53C8\u62B9\u672B\u6CAB\u8FC4\u4FAD\u7E6D\u9EBF\u4E07\u6162\u6E80\u6F2B\u8513\u5473\u672A\u9B45\u5DF3\u7B95\u5CAC\u5BC6\u871C\u6E4A\u84D1\u7A14\u8108\u5999\u7C8D\u6C11\u7720\u52D9\u5922\u7121\u725F\u77DB\u9727\u9D61\u690B\u5A7F\u5A18\u51A5\u540D\u547D\u660E\u76DF\u8FF7\u9298\u9CF4\u59EA\u725D\u6EC5\u514D\u68C9\u7DBF\u7DEC\u9762\u9EBA\u6478\u6A21\u8302\u5984\u5B5F\u6BDB\u731B\u76F2\u7DB2\u8017\u8499\u5132\u6728\u9ED9\u76EE\u6762\u52FF\u9905\u5C24\u623B\u7C7E\u8CB0\u554F\u60B6\u7D0B\u9580\u5301\u4E5F\u51B6\u591C\u723A\u8036\u91CE\u5F25\u77E2\u5384\u5F79\u7D04\u85AC\u8A33\u8E8D\u9756\u67F3\u85AE\u9453\u6109\u6108\u6CB9\u7652"],["9740","\u8AED\u8F38\u552F\u4F51\u512A\u52C7\u53CB\u5BA5\u5E7D\u60A0\u6182\u63D6\u6709\u67DA\u6E67\u6D8C\u7336\u7337\u7531\u7950\u88D5\u8A98\u904A\u9091\u90F5\u96C4\u878D\u5915\u4E88\u4F59\u4E0E\u8A89\u8F3F\u9810\u50AD\u5E7C\u5996\u5BB9\u5EB8\u63DA\u63FA\u64C1\u66DC\u694A\u69D8\u6D0B\u6EB6\u7194\u7528\u7AAF\u7F8A\u8000\u8449\u84C9\u8981\u8B21\u8E0A\u9065\u967D\u990A\u617E\u6291\u6B32"],["9780","\u6C83\u6D74\u7FCC\u7FFC\u6DC0\u7F85\u87BA\u88F8\u6765\u83B1\u983C\u96F7\u6D1B\u7D61\u843D\u916A\u4E71\u5375\u5D50\u6B04\u6FEB\u85CD\u862D\u89A7\u5229\u540F\u5C65\u674E\u68A8\u7406\u7483\u75E2\u88CF\u88E1\u91CC\u96E2\u9678\u5F8B\u7387\u7ACB\u844E\u63A0\u7565\u5289\u6D41\u6E9C\u7409\u7559\u786B\u7C92\u9686\u7ADC\u9F8D\u4FB6\u616E\u65C5\u865C\u4E86\u4EAE\u50DA\u4E21\u51CC\u5BEE\u6599\u6881\u6DBC\u731F\u7642\u77AD\u7A1C\u7CE7\u826F\u8AD2\u907C\u91CF\u9675\u9818\u529B\u7DD1\u502B\u5398\u6797\u6DCB\u71D0\u7433\u81E8\u8F2A\u96A3\u9C57\u9E9F\u7460\u5841\u6D99\u7D2F\u985E\u4EE4\u4F36\u4F8B\u51B7\u52B1\u5DBA\u601C\u73B2\u793C\u82D3\u9234\u96B7\u96F6\u970A\u9E97\u9F62\u66A6\u6B74\u5217\u52A3\u70C8\u88C2\u5EC9\u604B\u6190\u6F23\u7149\u7C3E\u7DF4\u806F"],["9840","\u84EE\u9023\u932C\u5442\u9B6F\u6AD3\u7089\u8CC2\u8DEF\u9732\u52B4\u5A41\u5ECA\u5F04\u6717\u697C\u6994\u6D6A\u6F0F\u7262\u72FC\u7BED\u8001\u807E\u874B\u90CE\u516D\u9E93\u7984\u808B\u9332\u8AD6\u502D\u548C\u8A71\u6B6A\u8CC4\u8107\u60D1\u67A0\u9DF2\u4E99\u4E98\u9C10\u8A6B\u85C1\u8568\u6900\u6E7E\u7897\u8155"],["989f","\u5F0C\u4E10\u4E15\u4E2A\u4E31\u4E36\u4E3C\u4E3F\u4E42\u4E56\u4E58\u4E82\u4E85\u8C6B\u4E8A\u8212\u5F0D\u4E8E\u4E9E\u4E9F\u4EA0\u4EA2\u4EB0\u4EB3\u4EB6\u4ECE\u4ECD\u4EC4\u4EC6\u4EC2\u4ED7\u4EDE\u4EED\u4EDF\u4EF7\u4F09\u4F5A\u4F30\u4F5B\u4F5D\u4F57\u4F47\u4F76\u4F88\u4F8F\u4F98\u4F7B\u4F69\u4F70\u4F91\u4F6F\u4F86\u4F96\u5118\u4FD4\u4FDF\u4FCE\u4FD8\u4FDB\u4FD1\u4FDA\u4FD0\u4FE4\u4FE5\u501A\u5028\u5014\u502A\u5025\u5005\u4F1C\u4FF6\u5021\u5029\u502C\u4FFE\u4FEF\u5011\u5006\u5043\u5047\u6703\u5055\u5050\u5048\u505A\u5056\u506C\u5078\u5080\u509A\u5085\u50B4\u50B2"],["9940","\u50C9\u50CA\u50B3\u50C2\u50D6\u50DE\u50E5\u50ED\u50E3\u50EE\u50F9\u50F5\u5109\u5101\u5102\u5116\u5115\u5114\u511A\u5121\u513A\u5137\u513C\u513B\u513F\u5140\u5152\u514C\u5154\u5162\u7AF8\u5169\u516A\u516E\u5180\u5182\u56D8\u518C\u5189\u518F\u5191\u5193\u5195\u5196\u51A4\u51A6\u51A2\u51A9\u51AA\u51AB\u51B3\u51B1\u51B2\u51B0\u51B5\u51BD\u51C5\u51C9\u51DB\u51E0\u8655\u51E9\u51ED"],["9980","\u51F0\u51F5\u51FE\u5204\u520B\u5214\u520E\u5227\u522A\u522E\u5233\u5239\u524F\u5244\u524B\u524C\u525E\u5254\u526A\u5274\u5269\u5273\u527F\u527D\u528D\u5294\u5292\u5271\u5288\u5291\u8FA8\u8FA7\u52AC\u52AD\u52BC\u52B5\u52C1\u52CD\u52D7\u52DE\u52E3\u52E6\u98ED\u52E0\u52F3\u52F5\u52F8\u52F9\u5306\u5308\u7538\u530D\u5310\u530F\u5315\u531A\u5323\u532F\u5331\u5333\u5338\u5340\u5346\u5345\u4E17\u5349\u534D\u51D6\u535E\u5369\u536E\u5918\u537B\u5377\u5382\u5396\u53A0\u53A6\u53A5\u53AE\u53B0\u53B6\u53C3\u7C12\u96D9\u53DF\u66FC\u71EE\u53EE\u53E8\u53ED\u53FA\u5401\u543D\u5440\u542C\u542D\u543C\u542E\u5436\u5429\u541D\u544E\u548F\u5475\u548E\u545F\u5471\u5477\u5470\u5492\u547B\u5480\u5476\u5484\u5490\u5486\u54C7\u54A2\u54B8\u54A5\u54AC\u54C4\u54C8\u54A8"],["9a40","\u54AB\u54C2\u54A4\u54BE\u54BC\u54D8\u54E5\u54E6\u550F\u5514\u54FD\u54EE\u54ED\u54FA\u54E2\u5539\u5540\u5563\u554C\u552E\u555C\u5545\u5556\u5557\u5538\u5533\u555D\u5599\u5580\u54AF\u558A\u559F\u557B\u557E\u5598\u559E\u55AE\u557C\u5583\u55A9\u5587\u55A8\u55DA\u55C5\u55DF\u55C4\u55DC\u55E4\u55D4\u5614\u55F7\u5616\u55FE\u55FD\u561B\u55F9\u564E\u5650\u71DF\u5634\u5636\u5632\u5638"],["9a80","\u566B\u5664\u562F\u566C\u566A\u5686\u5680\u568A\u56A0\u5694\u568F\u56A5\u56AE\u56B6\u56B4\u56C2\u56BC\u56C1\u56C3\u56C0\u56C8\u56CE\u56D1\u56D3\u56D7\u56EE\u56F9\u5700\u56FF\u5704\u5709\u5708\u570B\u570D\u5713\u5718\u5716\u55C7\u571C\u5726\u5737\u5738\u574E\u573B\u5740\u574F\u5769\u57C0\u5788\u5761\u577F\u5789\u5793\u57A0\u57B3\u57A4\u57AA\u57B0\u57C3\u57C6\u57D4\u57D2\u57D3\u580A\u57D6\u57E3\u580B\u5819\u581D\u5872\u5821\u5862\u584B\u5870\u6BC0\u5852\u583D\u5879\u5885\u58B9\u589F\u58AB\u58BA\u58DE\u58BB\u58B8\u58AE\u58C5\u58D3\u58D1\u58D7\u58D9\u58D8\u58E5\u58DC\u58E4\u58DF\u58EF\u58FA\u58F9\u58FB\u58FC\u58FD\u5902\u590A\u5910\u591B\u68A6\u5925\u592C\u592D\u5932\u5938\u593E\u7AD2\u5955\u5950\u594E\u595A\u5958\u5962\u5960\u5967\u596C\u5969"],["9b40","\u5978\u5981\u599D\u4F5E\u4FAB\u59A3\u59B2\u59C6\u59E8\u59DC\u598D\u59D9\u59DA\u5A25\u5A1F\u5A11\u5A1C\u5A09\u5A1A\u5A40\u5A6C\u5A49\u5A35\u5A36\u5A62\u5A6A\u5A9A\u5ABC\u5ABE\u5ACB\u5AC2\u5ABD\u5AE3\u5AD7\u5AE6\u5AE9\u5AD6\u5AFA\u5AFB\u5B0C\u5B0B\u5B16\u5B32\u5AD0\u5B2A\u5B36\u5B3E\u5B43\u5B45\u5B40\u5B51\u5B55\u5B5A\u5B5B\u5B65\u5B69\u5B70\u5B73\u5B75\u5B78\u6588\u5B7A\u5B80"],["9b80","\u5B83\u5BA6\u5BB8\u5BC3\u5BC7\u5BC9\u5BD4\u5BD0\u5BE4\u5BE6\u5BE2\u5BDE\u5BE5\u5BEB\u5BF0\u5BF6\u5BF3\u5C05\u5C07\u5C08\u5C0D\u5C13\u5C20\u5C22\u5C28\u5C38\u5C39\u5C41\u5C46\u5C4E\u5C53\u5C50\u5C4F\u5B71\u5C6C\u5C6E\u4E62\u5C76\u5C79\u5C8C\u5C91\u5C94\u599B\u5CAB\u5CBB\u5CB6\u5CBC\u5CB7\u5CC5\u5CBE\u5CC7\u5CD9\u5CE9\u5CFD\u5CFA\u5CED\u5D8C\u5CEA\u5D0B\u5D15\u5D17\u5D5C\u5D1F\u5D1B\u5D11\u5D14\u5D22\u5D1A\u5D19\u5D18\u5D4C\u5D52\u5D4E\u5D4B\u5D6C\u5D73\u5D76\u5D87\u5D84\u5D82\u5DA2\u5D9D\u5DAC\u5DAE\u5DBD\u5D90\u5DB7\u5DBC\u5DC9\u5DCD\u5DD3\u5DD2\u5DD6\u5DDB\u5DEB\u5DF2\u5DF5\u5E0B\u5E1A\u5E19\u5E11\u5E1B\u5E36\u5E37\u5E44\u5E43\u5E40\u5E4E\u5E57\u5E54\u5E5F\u5E62\u5E64\u5E47\u5E75\u5E76\u5E7A\u9EBC\u5E7F\u5EA0\u5EC1\u5EC2\u5EC8\u5ED0\u5ECF"],["9c40","\u5ED6\u5EE3\u5EDD\u5EDA\u5EDB\u5EE2\u5EE1\u5EE8\u5EE9\u5EEC\u5EF1\u5EF3\u5EF0\u5EF4\u5EF8\u5EFE\u5F03\u5F09\u5F5D\u5F5C\u5F0B\u5F11\u5F16\u5F29\u5F2D\u5F38\u5F41\u5F48\u5F4C\u5F4E\u5F2F\u5F51\u5F56\u5F57\u5F59\u5F61\u5F6D\u5F73\u5F77\u5F83\u5F82\u5F7F\u5F8A\u5F88\u5F91\u5F87\u5F9E\u5F99\u5F98\u5FA0\u5FA8\u5FAD\u5FBC\u5FD6\u5FFB\u5FE4\u5FF8\u5FF1\u5FDD\u60B3\u5FFF\u6021\u6060"],["9c80","\u6019\u6010\u6029\u600E\u6031\u601B\u6015\u602B\u6026\u600F\u603A\u605A\u6041\u606A\u6077\u605F\u604A\u6046\u604D\u6063\u6043\u6064\u6042\u606C\u606B\u6059\u6081\u608D\u60E7\u6083\u609A\u6084\u609B\u6096\u6097\u6092\u60A7\u608B\u60E1\u60B8\u60E0\u60D3\u60B4\u5FF0\u60BD\u60C6\u60B5\u60D8\u614D\u6115\u6106\u60F6\u60F7\u6100\u60F4\u60FA\u6103\u6121\u60FB\u60F1\u610D\u610E\u6147\u613E\u6128\u6127\u614A\u613F\u613C\u612C\u6134\u613D\u6142\u6144\u6173\u6177\u6158\u6159\u615A\u616B\u6174\u616F\u6165\u6171\u615F\u615D\u6153\u6175\u6199\u6196\u6187\u61AC\u6194\u619A\u618A\u6191\u61AB\u61AE\u61CC\u61CA\u61C9\u61F7\u61C8\u61C3\u61C6\u61BA\u61CB\u7F79\u61CD\u61E6\u61E3\u61F6\u61FA\u61F4\u61FF\u61FD\u61FC\u61FE\u6200\u6208\u6209\u620D\u620C\u6214\u621B"],["9d40","\u621E\u6221\u622A\u622E\u6230\u6232\u6233\u6241\u624E\u625E\u6263\u625B\u6260\u6268\u627C\u6282\u6289\u627E\u6292\u6293\u6296\u62D4\u6283\u6294\u62D7\u62D1\u62BB\u62CF\u62FF\u62C6\u64D4\u62C8\u62DC\u62CC\u62CA\u62C2\u62C7\u629B\u62C9\u630C\u62EE\u62F1\u6327\u6302\u6308\u62EF\u62F5\u6350\u633E\u634D\u641C\u634F\u6396\u638E\u6380\u63AB\u6376\u63A3\u638F\u6389\u639F\u63B5\u636B"],["9d80","\u6369\u63BE\u63E9\u63C0\u63C6\u63E3\u63C9\u63D2\u63F6\u63C4\u6416\u6434\u6406\u6413\u6426\u6436\u651D\u6417\u6428\u640F\u6467\u646F\u6476\u644E\u652A\u6495\u6493\u64A5\u64A9\u6488\u64BC\u64DA\u64D2\u64C5\u64C7\u64BB\u64D8\u64C2\u64F1\u64E7\u8209\u64E0\u64E1\u62AC\u64E3\u64EF\u652C\u64F6\u64F4\u64F2\u64FA\u6500\u64FD\u6518\u651C\u6505\u6524\u6523\u652B\u6534\u6535\u6537\u6536\u6538\u754B\u6548\u6556\u6555\u654D\u6558\u655E\u655D\u6572\u6578\u6582\u6583\u8B8A\u659B\u659F\u65AB\u65B7\u65C3\u65C6\u65C1\u65C4\u65CC\u65D2\u65DB\u65D9\u65E0\u65E1\u65F1\u6772\u660A\u6603\u65FB\u6773\u6635\u6636\u6634\u661C\u664F\u6644\u6649\u6641\u665E\u665D\u6664\u6667\u6668\u665F\u6662\u6670\u6683\u6688\u668E\u6689\u6684\u6698\u669D\u66C1\u66B9\u66C9\u66BE\u66BC"],["9e40","\u66C4\u66B8\u66D6\u66DA\u66E0\u663F\u66E6\u66E9\u66F0\u66F5\u66F7\u670F\u6716\u671E\u6726\u6727\u9738\u672E\u673F\u6736\u6741\u6738\u6737\u6746\u675E\u6760\u6759\u6763\u6764\u6789\u6770\u67A9\u677C\u676A\u678C\u678B\u67A6\u67A1\u6785\u67B7\u67EF\u67B4\u67EC\u67B3\u67E9\u67B8\u67E4\u67DE\u67DD\u67E2\u67EE\u67B9\u67CE\u67C6\u67E7\u6A9C\u681E\u6846\u6829\u6840\u684D\u6832\u684E"],["9e80","\u68B3\u682B\u6859\u6863\u6877\u687F\u689F\u688F\u68AD\u6894\u689D\u689B\u6883\u6AAE\u68B9\u6874\u68B5\u68A0\u68BA\u690F\u688D\u687E\u6901\u68CA\u6908\u68D8\u6922\u6926\u68E1\u690C\u68CD\u68D4\u68E7\u68D5\u6936\u6912\u6904\u68D7\u68E3\u6925\u68F9\u68E0\u68EF\u6928\u692A\u691A\u6923\u6921\u68C6\u6979\u6977\u695C\u6978\u696B\u6954\u697E\u696E\u6939\u6974\u693D\u6959\u6930\u6961\u695E\u695D\u6981\u696A\u69B2\u69AE\u69D0\u69BF\u69C1\u69D3\u69BE\u69CE\u5BE8\u69CA\u69DD\u69BB\u69C3\u69A7\u6A2E\u6991\u69A0\u699C\u6995\u69B4\u69DE\u69E8\u6A02\u6A1B\u69FF\u6B0A\u69F9\u69F2\u69E7\u6A05\u69B1\u6A1E\u69ED\u6A14\u69EB\u6A0A\u6A12\u6AC1\u6A23\u6A13\u6A44\u6A0C\u6A72\u6A36\u6A78\u6A47\u6A62\u6A59\u6A66\u6A48\u6A38\u6A22\u6A90\u6A8D\u6AA0\u6A84\u6AA2\u6AA3"],["9f40","\u6A97\u8617\u6ABB\u6AC3\u6AC2\u6AB8\u6AB3\u6AAC\u6ADE\u6AD1\u6ADF\u6AAA\u6ADA\u6AEA\u6AFB\u6B05\u8616\u6AFA\u6B12\u6B16\u9B31\u6B1F\u6B38\u6B37\u76DC\u6B39\u98EE\u6B47\u6B43\u6B49\u6B50\u6B59\u6B54\u6B5B\u6B5F\u6B61\u6B78\u6B79\u6B7F\u6B80\u6B84\u6B83\u6B8D\u6B98\u6B95\u6B9E\u6BA4\u6BAA\u6BAB\u6BAF\u6BB2\u6BB1\u6BB3\u6BB7\u6BBC\u6BC6\u6BCB\u6BD3\u6BDF\u6BEC\u6BEB\u6BF3\u6BEF"],["9f80","\u9EBE\u6C08\u6C13\u6C14\u6C1B\u6C24\u6C23\u6C5E\u6C55\u6C62\u6C6A\u6C82\u6C8D\u6C9A\u6C81\u6C9B\u6C7E\u6C68\u6C73\u6C92\u6C90\u6CC4\u6CF1\u6CD3\u6CBD\u6CD7\u6CC5\u6CDD\u6CAE\u6CB1\u6CBE\u6CBA\u6CDB\u6CEF\u6CD9\u6CEA\u6D1F\u884D\u6D36\u6D2B\u6D3D\u6D38\u6D19\u6D35\u6D33\u6D12\u6D0C\u6D63\u6D93\u6D64\u6D5A\u6D79\u6D59\u6D8E\u6D95\u6FE4\u6D85\u6DF9\u6E15\u6E0A\u6DB5\u6DC7\u6DE6\u6DB8\u6DC6\u6DEC\u6DDE\u6DCC\u6DE8\u6DD2\u6DC5\u6DFA\u6DD9\u6DE4\u6DD5\u6DEA\u6DEE\u6E2D\u6E6E\u6E2E\u6E19\u6E72\u6E5F\u6E3E\u6E23\u6E6B\u6E2B\u6E76\u6E4D\u6E1F\u6E43\u6E3A\u6E4E\u6E24\u6EFF\u6E1D\u6E38\u6E82\u6EAA\u6E98\u6EC9\u6EB7\u6ED3\u6EBD\u6EAF\u6EC4\u6EB2\u6ED4\u6ED5\u6E8F\u6EA5\u6EC2\u6E9F\u6F41\u6F11\u704C\u6EEC\u6EF8\u6EFE\u6F3F\u6EF2\u6F31\u6EEF\u6F32\u6ECC"],["e040","\u6F3E\u6F13\u6EF7\u6F86\u6F7A\u6F78\u6F81\u6F80\u6F6F\u6F5B\u6FF3\u6F6D\u6F82\u6F7C\u6F58\u6F8E\u6F91\u6FC2\u6F66\u6FB3\u6FA3\u6FA1\u6FA4\u6FB9\u6FC6\u6FAA\u6FDF\u6FD5\u6FEC\u6FD4\u6FD8\u6FF1\u6FEE\u6FDB\u7009\u700B\u6FFA\u7011\u7001\u700F\u6FFE\u701B\u701A\u6F74\u701D\u7018\u701F\u7030\u703E\u7032\u7051\u7063\u7099\u7092\u70AF\u70F1\u70AC\u70B8\u70B3\u70AE\u70DF\u70CB\u70DD"],["e080","\u70D9\u7109\u70FD\u711C\u7119\u7165\u7155\u7188\u7166\u7162\u714C\u7156\u716C\u718F\u71FB\u7184\u7195\u71A8\u71AC\u71D7\u71B9\u71BE\u71D2\u71C9\u71D4\u71CE\u71E0\u71EC\u71E7\u71F5\u71FC\u71F9\u71FF\u720D\u7210\u721B\u7228\u722D\u722C\u7230\u7232\u723B\u723C\u723F\u7240\u7246\u724B\u7258\u7274\u727E\u7282\u7281\u7287\u7292\u7296\u72A2\u72A7\u72B9\u72B2\u72C3\u72C6\u72C4\u72CE\u72D2\u72E2\u72E0\u72E1\u72F9\u72F7\u500F\u7317\u730A\u731C\u7316\u731D\u7334\u732F\u7329\u7325\u733E\u734E\u734F\u9ED8\u7357\u736A\u7368\u7370\u7378\u7375\u737B\u737A\u73C8\u73B3\u73CE\u73BB\u73C0\u73E5\u73EE\u73DE\u74A2\u7405\u746F\u7425\u73F8\u7432\u743A\u7455\u743F\u745F\u7459\u7441\u745C\u7469\u7470\u7463\u746A\u7476\u747E\u748B\u749E\u74A7\u74CA\u74CF\u74D4\u73F1"],["e140","\u74E0\u74E3\u74E7\u74E9\u74EE\u74F2\u74F0\u74F1\u74F8\u74F7\u7504\u7503\u7505\u750C\u750E\u750D\u7515\u7513\u751E\u7526\u752C\u753C\u7544\u754D\u754A\u7549\u755B\u7546\u755A\u7569\u7564\u7567\u756B\u756D\u7578\u7576\u7586\u7587\u7574\u758A\u7589\u7582\u7594\u759A\u759D\u75A5\u75A3\u75C2\u75B3\u75C3\u75B5\u75BD\u75B8\u75BC\u75B1\u75CD\u75CA\u75D2\u75D9\u75E3\u75DE\u75FE\u75FF"],["e180","\u75FC\u7601\u75F0\u75FA\u75F2\u75F3\u760B\u760D\u7609\u761F\u7627\u7620\u7621\u7622\u7624\u7634\u7630\u763B\u7647\u7648\u7646\u765C\u7658\u7661\u7662\u7668\u7669\u766A\u7667\u766C\u7670\u7672\u7676\u7678\u767C\u7680\u7683\u7688\u768B\u768E\u7696\u7693\u7699\u769A\u76B0\u76B4\u76B8\u76B9\u76BA\u76C2\u76CD\u76D6\u76D2\u76DE\u76E1\u76E5\u76E7\u76EA\u862F\u76FB\u7708\u7707\u7704\u7729\u7724\u771E\u7725\u7726\u771B\u7737\u7738\u7747\u775A\u7768\u776B\u775B\u7765\u777F\u777E\u7779\u778E\u778B\u7791\u77A0\u779E\u77B0\u77B6\u77B9\u77BF\u77BC\u77BD\u77BB\u77C7\u77CD\u77D7\u77DA\u77DC\u77E3\u77EE\u77FC\u780C\u7812\u7926\u7820\u792A\u7845\u788E\u7874\u7886\u787C\u789A\u788C\u78A3\u78B5\u78AA\u78AF\u78D1\u78C6\u78CB\u78D4\u78BE\u78BC\u78C5\u78CA\u78EC"],["e240","\u78E7\u78DA\u78FD\u78F4\u7907\u7912\u7911\u7919\u792C\u792B\u7940\u7960\u7957\u795F\u795A\u7955\u7953\u797A\u797F\u798A\u799D\u79A7\u9F4B\u79AA\u79AE\u79B3\u79B9\u79BA\u79C9\u79D5\u79E7\u79EC\u79E1\u79E3\u7A08\u7A0D\u7A18\u7A19\u7A20\u7A1F\u7980\u7A31\u7A3B\u7A3E\u7A37\u7A43\u7A57\u7A49\u7A61\u7A62\u7A69\u9F9D\u7A70\u7A79\u7A7D\u7A88\u7A97\u7A95\u7A98\u7A96\u7AA9\u7AC8\u7AB0"],["e280","\u7AB6\u7AC5\u7AC4\u7ABF\u9083\u7AC7\u7ACA\u7ACD\u7ACF\u7AD5\u7AD3\u7AD9\u7ADA\u7ADD\u7AE1\u7AE2\u7AE6\u7AED\u7AF0\u7B02\u7B0F\u7B0A\u7B06\u7B33\u7B18\u7B19\u7B1E\u7B35\u7B28\u7B36\u7B50\u7B7A\u7B04\u7B4D\u7B0B\u7B4C\u7B45\u7B75\u7B65\u7B74\u7B67\u7B70\u7B71\u7B6C\u7B6E\u7B9D\u7B98\u7B9F\u7B8D\u7B9C\u7B9A\u7B8B\u7B92\u7B8F\u7B5D\u7B99\u7BCB\u7BC1\u7BCC\u7BCF\u7BB4\u7BC6\u7BDD\u7BE9\u7C11\u7C14\u7BE6\u7BE5\u7C60\u7C00\u7C07\u7C13\u7BF3\u7BF7\u7C17\u7C0D\u7BF6\u7C23\u7C27\u7C2A\u7C1F\u7C37\u7C2B\u7C3D\u7C4C\u7C43\u7C54\u7C4F\u7C40\u7C50\u7C58\u7C5F\u7C64\u7C56\u7C65\u7C6C\u7C75\u7C83\u7C90\u7CA4\u7CAD\u7CA2\u7CAB\u7CA1\u7CA8\u7CB3\u7CB2\u7CB1\u7CAE\u7CB9\u7CBD\u7CC0\u7CC5\u7CC2\u7CD8\u7CD2\u7CDC\u7CE2\u9B3B\u7CEF\u7CF2\u7CF4\u7CF6\u7CFA\u7D06"],["e340","\u7D02\u7D1C\u7D15\u7D0A\u7D45\u7D4B\u7D2E\u7D32\u7D3F\u7D35\u7D46\u7D73\u7D56\u7D4E\u7D72\u7D68\u7D6E\u7D4F\u7D63\u7D93\u7D89\u7D5B\u7D8F\u7D7D\u7D9B\u7DBA\u7DAE\u7DA3\u7DB5\u7DC7\u7DBD\u7DAB\u7E3D\u7DA2\u7DAF\u7DDC\u7DB8\u7D9F\u7DB0\u7DD8\u7DDD\u7DE4\u7DDE\u7DFB\u7DF2\u7DE1\u7E05\u7E0A\u7E23\u7E21\u7E12\u7E31\u7E1F\u7E09\u7E0B\u7E22\u7E46\u7E66\u7E3B\u7E35\u7E39\u7E43\u7E37"],["e380","\u7E32\u7E3A\u7E67\u7E5D\u7E56\u7E5E\u7E59\u7E5A\u7E79\u7E6A\u7E69\u7E7C\u7E7B\u7E83\u7DD5\u7E7D\u8FAE\u7E7F\u7E88\u7E89\u7E8C\u7E92\u7E90\u7E93\u7E94\u7E96\u7E8E\u7E9B\u7E9C\u7F38\u7F3A\u7F45\u7F4C\u7F4D\u7F4E\u7F50\u7F51\u7F55\u7F54\u7F58\u7F5F\u7F60\u7F68\u7F69\u7F67\u7F78\u7F82\u7F86\u7F83\u7F88\u7F87\u7F8C\u7F94\u7F9E\u7F9D\u7F9A\u7FA3\u7FAF\u7FB2\u7FB9\u7FAE\u7FB6\u7FB8\u8B71\u7FC5\u7FC6\u7FCA\u7FD5\u7FD4\u7FE1\u7FE6\u7FE9\u7FF3\u7FF9\u98DC\u8006\u8004\u800B\u8012\u8018\u8019\u801C\u8021\u8028\u803F\u803B\u804A\u8046\u8052\u8058\u805A\u805F\u8062\u8068\u8073\u8072\u8070\u8076\u8079\u807D\u807F\u8084\u8086\u8085\u809B\u8093\u809A\u80AD\u5190\u80AC\u80DB\u80E5\u80D9\u80DD\u80C4\u80DA\u80D6\u8109\u80EF\u80F1\u811B\u8129\u8123\u812F\u814B"],["e440","\u968B\u8146\u813E\u8153\u8151\u80FC\u8171\u816E\u8165\u8166\u8174\u8183\u8188\u818A\u8180\u8182\u81A0\u8195\u81A4\u81A3\u815F\u8193\u81A9\u81B0\u81B5\u81BE\u81B8\u81BD\u81C0\u81C2\u81BA\u81C9\u81CD\u81D1\u81D9\u81D8\u81C8\u81DA\u81DF\u81E0\u81E7\u81FA\u81FB\u81FE\u8201\u8202\u8205\u8207\u820A\u820D\u8210\u8216\u8229\u822B\u8238\u8233\u8240\u8259\u8258\u825D\u825A\u825F\u8264"],["e480","\u8262\u8268\u826A\u826B\u822E\u8271\u8277\u8278\u827E\u828D\u8292\u82AB\u829F\u82BB\u82AC\u82E1\u82E3\u82DF\u82D2\u82F4\u82F3\u82FA\u8393\u8303\u82FB\u82F9\u82DE\u8306\u82DC\u8309\u82D9\u8335\u8334\u8316\u8332\u8331\u8340\u8339\u8350\u8345\u832F\u832B\u8317\u8318\u8385\u839A\u83AA\u839F\u83A2\u8396\u8323\u838E\u8387\u838A\u837C\u83B5\u8373\u8375\u83A0\u8389\u83A8\u83F4\u8413\u83EB\u83CE\u83FD\u8403\u83D8\u840B\u83C1\u83F7\u8407\u83E0\u83F2\u840D\u8422\u8420\u83BD\u8438\u8506\u83FB\u846D\u842A\u843C\u855A\u8484\u8477\u846B\u84AD\u846E\u8482\u8469\u8446\u842C\u846F\u8479\u8435\u84CA\u8462\u84B9\u84BF\u849F\u84D9\u84CD\u84BB\u84DA\u84D0\u84C1\u84C6\u84D6\u84A1\u8521\u84FF\u84F4\u8517\u8518\u852C\u851F\u8515\u8514\u84FC\u8540\u8563\u8558\u8548"],["e540","\u8541\u8602\u854B\u8555\u8580\u85A4\u8588\u8591\u858A\u85A8\u856D\u8594\u859B\u85EA\u8587\u859C\u8577\u857E\u8590\u85C9\u85BA\u85CF\u85B9\u85D0\u85D5\u85DD\u85E5\u85DC\u85F9\u860A\u8613\u860B\u85FE\u85FA\u8606\u8622\u861A\u8630\u863F\u864D\u4E55\u8654\u865F\u8667\u8671\u8693\u86A3\u86A9\u86AA\u868B\u868C\u86B6\u86AF\u86C4\u86C6\u86B0\u86C9\u8823\u86AB\u86D4\u86DE\u86E9\u86EC"],["e580","\u86DF\u86DB\u86EF\u8712\u8706\u8708\u8700\u8703\u86FB\u8711\u8709\u870D\u86F9\u870A\u8734\u873F\u8737\u873B\u8725\u8729\u871A\u8760\u875F\u8778\u874C\u874E\u8774\u8757\u8768\u876E\u8759\u8753\u8763\u876A\u8805\u87A2\u879F\u8782\u87AF\u87CB\u87BD\u87C0\u87D0\u96D6\u87AB\u87C4\u87B3\u87C7\u87C6\u87BB\u87EF\u87F2\u87E0\u880F\u880D\u87FE\u87F6\u87F7\u880E\u87D2\u8811\u8816\u8815\u8822\u8821\u8831\u8836\u8839\u8827\u883B\u8844\u8842\u8852\u8859\u885E\u8862\u886B\u8881\u887E\u889E\u8875\u887D\u88B5\u8872\u8882\u8897\u8892\u88AE\u8899\u88A2\u888D\u88A4\u88B0\u88BF\u88B1\u88C3\u88C4\u88D4\u88D8\u88D9\u88DD\u88F9\u8902\u88FC\u88F4\u88E8\u88F2\u8904\u890C\u890A\u8913\u8943\u891E\u8925\u892A\u892B\u8941\u8944\u893B\u8936\u8938\u894C\u891D\u8960\u895E"],["e640","\u8966\u8964\u896D\u896A\u896F\u8974\u8977\u897E\u8983\u8988\u898A\u8993\u8998\u89A1\u89A9\u89A6\u89AC\u89AF\u89B2\u89BA\u89BD\u89BF\u89C0\u89DA\u89DC\u89DD\u89E7\u89F4\u89F8\u8A03\u8A16\u8A10\u8A0C\u8A1B\u8A1D\u8A25\u8A36\u8A41\u8A5B\u8A52\u8A46\u8A48\u8A7C\u8A6D\u8A6C\u8A62\u8A85\u8A82\u8A84\u8AA8\u8AA1\u8A91\u8AA5\u8AA6\u8A9A\u8AA3\u8AC4\u8ACD\u8AC2\u8ADA\u8AEB\u8AF3\u8AE7"],["e680","\u8AE4\u8AF1\u8B14\u8AE0\u8AE2\u8AF7\u8ADE\u8ADB\u8B0C\u8B07\u8B1A\u8AE1\u8B16\u8B10\u8B17\u8B20\u8B33\u97AB\u8B26\u8B2B\u8B3E\u8B28\u8B41\u8B4C\u8B4F\u8B4E\u8B49\u8B56\u8B5B\u8B5A\u8B6B\u8B5F\u8B6C\u8B6F\u8B74\u8B7D\u8B80\u8B8C\u8B8E\u8B92\u8B93\u8B96\u8B99\u8B9A\u8C3A\u8C41\u8C3F\u8C48\u8C4C\u8C4E\u8C50\u8C55\u8C62\u8C6C\u8C78\u8C7A\u8C82\u8C89\u8C85\u8C8A\u8C8D\u8C8E\u8C94\u8C7C\u8C98\u621D\u8CAD\u8CAA\u8CBD\u8CB2\u8CB3\u8CAE\u8CB6\u8CC8\u8CC1\u8CE4\u8CE3\u8CDA\u8CFD\u8CFA\u8CFB\u8D04\u8D05\u8D0A\u8D07\u8D0F\u8D0D\u8D10\u9F4E\u8D13\u8CCD\u8D14\u8D16\u8D67\u8D6D\u8D71\u8D73\u8D81\u8D99\u8DC2\u8DBE\u8DBA\u8DCF\u8DDA\u8DD6\u8DCC\u8DDB\u8DCB\u8DEA\u8DEB\u8DDF\u8DE3\u8DFC\u8E08\u8E09\u8DFF\u8E1D\u8E1E\u8E10\u8E1F\u8E42\u8E35\u8E30\u8E34\u8E4A"],["e740","\u8E47\u8E49\u8E4C\u8E50\u8E48\u8E59\u8E64\u8E60\u8E2A\u8E63\u8E55\u8E76\u8E72\u8E7C\u8E81\u8E87\u8E85\u8E84\u8E8B\u8E8A\u8E93\u8E91\u8E94\u8E99\u8EAA\u8EA1\u8EAC\u8EB0\u8EC6\u8EB1\u8EBE\u8EC5\u8EC8\u8ECB\u8EDB\u8EE3\u8EFC\u8EFB\u8EEB\u8EFE\u8F0A\u8F05\u8F15\u8F12\u8F19\u8F13\u8F1C\u8F1F\u8F1B\u8F0C\u8F26\u8F33\u8F3B\u8F39\u8F45\u8F42\u8F3E\u8F4C\u8F49\u8F46\u8F4E\u8F57\u8F5C"],["e780","\u8F62\u8F63\u8F64\u8F9C\u8F9F\u8FA3\u8FAD\u8FAF\u8FB7\u8FDA\u8FE5\u8FE2\u8FEA\u8FEF\u9087\u8FF4\u9005\u8FF9\u8FFA\u9011\u9015\u9021\u900D\u901E\u9016\u900B\u9027\u9036\u9035\u9039\u8FF8\u904F\u9050\u9051\u9052\u900E\u9049\u903E\u9056\u9058\u905E\u9068\u906F\u9076\u96A8\u9072\u9082\u907D\u9081\u9080\u908A\u9089\u908F\u90A8\u90AF\u90B1\u90B5\u90E2\u90E4\u6248\u90DB\u9102\u9112\u9119\u9132\u9130\u914A\u9156\u9158\u9163\u9165\u9169\u9173\u9172\u918B\u9189\u9182\u91A2\u91AB\u91AF\u91AA\u91B5\u91B4\u91BA\u91C0\u91C1\u91C9\u91CB\u91D0\u91D6\u91DF\u91E1\u91DB\u91FC\u91F5\u91F6\u921E\u91FF\u9214\u922C\u9215\u9211\u925E\u9257\u9245\u9249\u9264\u9248\u9295\u923F\u924B\u9250\u929C\u9296\u9293\u929B\u925A\u92CF\u92B9\u92B7\u92E9\u930F\u92FA\u9344\u932E"],["e840","\u9319\u9322\u931A\u9323\u933A\u9335\u933B\u935C\u9360\u937C\u936E\u9356\u93B0\u93AC\u93AD\u9394\u93B9\u93D6\u93D7\u93E8\u93E5\u93D8\u93C3\u93DD\u93D0\u93C8\u93E4\u941A\u9414\u9413\u9403\u9407\u9410\u9436\u942B\u9435\u9421\u943A\u9441\u9452\u9444\u945B\u9460\u9462\u945E\u946A\u9229\u9470\u9475\u9477\u947D\u945A\u947C\u947E\u9481\u947F\u9582\u9587\u958A\u9594\u9596\u9598\u9599"],["e880","\u95A0\u95A8\u95A7\u95AD\u95BC\u95BB\u95B9\u95BE\u95CA\u6FF6\u95C3\u95CD\u95CC\u95D5\u95D4\u95D6\u95DC\u95E1\u95E5\u95E2\u9621\u9628\u962E\u962F\u9642\u964C\u964F\u964B\u9677\u965C\u965E\u965D\u965F\u9666\u9672\u966C\u968D\u9698\u9695\u9697\u96AA\u96A7\u96B1\u96B2\u96B0\u96B4\u96B6\u96B8\u96B9\u96CE\u96CB\u96C9\u96CD\u894D\u96DC\u970D\u96D5\u96F9\u9704\u9706\u9708\u9713\u970E\u9711\u970F\u9716\u9719\u9724\u972A\u9730\u9739\u973D\u973E\u9744\u9746\u9748\u9742\u9749\u975C\u9760\u9764\u9766\u9768\u52D2\u976B\u9771\u9779\u9785\u977C\u9781\u977A\u9786\u978B\u978F\u9790\u979C\u97A8\u97A6\u97A3\u97B3\u97B4\u97C3\u97C6\u97C8\u97CB\u97DC\u97ED\u9F4F\u97F2\u7ADF\u97F6\u97F5\u980F\u980C\u9838\u9824\u9821\u9837\u983D\u9846\u984F\u984B\u986B\u986F\u9870"],["e940","\u9871\u9874\u9873\u98AA\u98AF\u98B1\u98B6\u98C4\u98C3\u98C6\u98E9\u98EB\u9903\u9909\u9912\u9914\u9918\u9921\u991D\u991E\u9924\u9920\u992C\u992E\u993D\u993E\u9942\u9949\u9945\u9950\u994B\u9951\u9952\u994C\u9955\u9997\u9998\u99A5\u99AD\u99AE\u99BC\u99DF\u99DB\u99DD\u99D8\u99D1\u99ED\u99EE\u99F1\u99F2\u99FB\u99F8\u9A01\u9A0F\u9A05\u99E2\u9A19\u9A2B\u9A37\u9A45\u9A42\u9A40\u9A43"],["e980","\u9A3E\u9A55\u9A4D\u9A5B\u9A57\u9A5F\u9A62\u9A65\u9A64\u9A69\u9A6B\u9A6A\u9AAD\u9AB0\u9ABC\u9AC0\u9ACF\u9AD1\u9AD3\u9AD4\u9ADE\u9ADF\u9AE2\u9AE3\u9AE6\u9AEF\u9AEB\u9AEE\u9AF4\u9AF1\u9AF7\u9AFB\u9B06\u9B18\u9B1A\u9B1F\u9B22\u9B23\u9B25\u9B27\u9B28\u9B29\u9B2A\u9B2E\u9B2F\u9B32\u9B44\u9B43\u9B4F\u9B4D\u9B4E\u9B51\u9B58\u9B74\u9B93\u9B83\u9B91\u9B96\u9B97\u9B9F\u9BA0\u9BA8\u9BB4\u9BC0\u9BCA\u9BB9\u9BC6\u9BCF\u9BD1\u9BD2\u9BE3\u9BE2\u9BE4\u9BD4\u9BE1\u9C3A\u9BF2\u9BF1\u9BF0\u9C15\u9C14\u9C09\u9C13\u9C0C\u9C06\u9C08\u9C12\u9C0A\u9C04\u9C2E\u9C1B\u9C25\u9C24\u9C21\u9C30\u9C47\u9C32\u9C46\u9C3E\u9C5A\u9C60\u9C67\u9C76\u9C78\u9CE7\u9CEC\u9CF0\u9D09\u9D08\u9CEB\u9D03\u9D06\u9D2A\u9D26\u9DAF\u9D23\u9D1F\u9D44\u9D15\u9D12\u9D41\u9D3F\u9D3E\u9D46\u9D48"],["ea40","\u9D5D\u9D5E\u9D64\u9D51\u9D50\u9D59\u9D72\u9D89\u9D87\u9DAB\u9D6F\u9D7A\u9D9A\u9DA4\u9DA9\u9DB2\u9DC4\u9DC1\u9DBB\u9DB8\u9DBA\u9DC6\u9DCF\u9DC2\u9DD9\u9DD3\u9DF8\u9DE6\u9DED\u9DEF\u9DFD\u9E1A\u9E1B\u9E1E\u9E75\u9E79\u9E7D\u9E81\u9E88\u9E8B\u9E8C\u9E92\u9E95\u9E91\u9E9D\u9EA5\u9EA9\u9EB8\u9EAA\u9EAD\u9761\u9ECC\u9ECE\u9ECF\u9ED0\u9ED4\u9EDC\u9EDE\u9EDD\u9EE0\u9EE5\u9EE8\u9EEF"],["ea80","\u9EF4\u9EF6\u9EF7\u9EF9\u9EFB\u9EFC\u9EFD\u9F07\u9F08\u76B7\u9F15\u9F21\u9F2C\u9F3E\u9F4A\u9F52\u9F54\u9F63\u9F5F\u9F60\u9F61\u9F66\u9F67\u9F6C\u9F6A\u9F77\u9F72\u9F76\u9F95\u9F9C\u9FA0\u582F\u69C7\u9059\u7464\u51DC\u7199"],["ed40","\u7E8A\u891C\u9348\u9288\u84DC\u4FC9\u70BB\u6631\u68C8\u92F9\u66FB\u5F45\u4E28\u4EE1\u4EFC\u4F00\u4F03\u4F39\u4F56\u4F92\u4F8A\u4F9A\u4F94\u4FCD\u5040\u5022\u4FFF\u501E\u5046\u5070\u5042\u5094\u50F4\u50D8\u514A\u5164\u519D\u51BE\u51EC\u5215\u529C\u52A6\u52C0\u52DB\u5300\u5307\u5324\u5372\u5393\u53B2\u53DD\uFA0E\u549C\u548A\u54A9\u54FF\u5586\u5759\u5765\u57AC\u57C8\u57C7\uFA0F"],["ed80","\uFA10\u589E\u58B2\u590B\u5953\u595B\u595D\u5963\u59A4\u59BA\u5B56\u5BC0\u752F\u5BD8\u5BEC\u5C1E\u5CA6\u5CBA\u5CF5\u5D27\u5D53\uFA11\u5D42\u5D6D\u5DB8\u5DB9\u5DD0\u5F21\u5F34\u5F67\u5FB7\u5FDE\u605D\u6085\u608A\u60DE\u60D5\u6120\u60F2\u6111\u6137\u6130\u6198\u6213\u62A6\u63F5\u6460\u649D\u64CE\u654E\u6600\u6615\u663B\u6609\u662E\u661E\u6624\u6665\u6657\u6659\uFA12\u6673\u6699\u66A0\u66B2\u66BF\u66FA\u670E\uF929\u6766\u67BB\u6852\u67C0\u6801\u6844\u68CF\uFA13\u6968\uFA14\u6998\u69E2\u6A30\u6A6B\u6A46\u6A73\u6A7E\u6AE2\u6AE4\u6BD6\u6C3F\u6C5C\u6C86\u6C6F\u6CDA\u6D04\u6D87\u6D6F\u6D96\u6DAC\u6DCF\u6DF8\u6DF2\u6DFC\u6E39\u6E5C\u6E27\u6E3C\u6EBF\u6F88\u6FB5\u6FF5\u7005\u7007\u7028\u7085\u70AB\u710F\u7104\u715C\u7146\u7147\uFA15\u71C1\u71FE\u72B1"],["ee40","\u72BE\u7324\uFA16\u7377\u73BD\u73C9\u73D6\u73E3\u73D2\u7407\u73F5\u7426\u742A\u7429\u742E\u7462\u7489\u749F\u7501\u756F\u7682\u769C\u769E\u769B\u76A6\uFA17\u7746\u52AF\u7821\u784E\u7864\u787A\u7930\uFA18\uFA19\uFA1A\u7994\uFA1B\u799B\u7AD1\u7AE7\uFA1C\u7AEB\u7B9E\uFA1D\u7D48\u7D5C\u7DB7\u7DA0\u7DD6\u7E52\u7F47\u7FA1\uFA1E\u8301\u8362\u837F\u83C7\u83F6\u8448\u84B4\u8553\u8559"],["ee80","\u856B\uFA1F\u85B0\uFA20\uFA21\u8807\u88F5\u8A12\u8A37\u8A79\u8AA7\u8ABE\u8ADF\uFA22\u8AF6\u8B53\u8B7F\u8CF0\u8CF4\u8D12\u8D76\uFA23\u8ECF\uFA24\uFA25\u9067\u90DE\uFA26\u9115\u9127\u91DA\u91D7\u91DE\u91ED\u91EE\u91E4\u91E5\u9206\u9210\u920A\u923A\u9240\u923C\u924E\u9259\u9251\u9239\u9267\u92A7\u9277\u9278\u92E7\u92D7\u92D9\u92D0\uFA27\u92D5\u92E0\u92D3\u9325\u9321\u92FB\uFA28\u931E\u92FF\u931D\u9302\u9370\u9357\u93A4\u93C6\u93DE\u93F8\u9431\u9445\u9448\u9592\uF9DC\uFA29\u969D\u96AF\u9733\u973B\u9743\u974D\u974F\u9751\u9755\u9857\u9865\uFA2A\uFA2B\u9927\uFA2C\u999E\u9A4E\u9AD9\u9ADC\u9B75\u9B72\u9B8F\u9BB1\u9BBB\u9C00\u9D70\u9D6B\uFA2D\u9E19\u9ED1"],["eeef","\u2170",9,"\uFFE2\uFFE4\uFF07\uFF02"],["f040","\uE000",62],["f080","\uE03F",124],["f140","\uE0BC",62],["f180","\uE0FB",124],["f240","\uE178",62],["f280","\uE1B7",124],["f340","\uE234",62],["f380","\uE273",124],["f440","\uE2F0",62],["f480","\uE32F",124],["f540","\uE3AC",62],["f580","\uE3EB",124],["f640","\uE468",62],["f680","\uE4A7",124],["f740","\uE524",62],["f780","\uE563",124],["f840","\uE5E0",62],["f880","\uE61F",124],["f940","\uE69C"],["fa40","\u2170",9,"\u2160",9,"\uFFE2\uFFE4\uFF07\uFF02\u3231\u2116\u2121\u2235\u7E8A\u891C\u9348\u9288\u84DC\u4FC9\u70BB\u6631\u68C8\u92F9\u66FB\u5F45\u4E28\u4EE1\u4EFC\u4F00\u4F03\u4F39\u4F56\u4F92\u4F8A\u4F9A\u4F94\u4FCD\u5040\u5022\u4FFF\u501E\u5046\u5070\u5042\u5094\u50F4\u50D8\u514A"],["fa80","\u5164\u519D\u51BE\u51EC\u5215\u529C\u52A6\u52C0\u52DB\u5300\u5307\u5324\u5372\u5393\u53B2\u53DD\uFA0E\u549C\u548A\u54A9\u54FF\u5586\u5759\u5765\u57AC\u57C8\u57C7\uFA0F\uFA10\u589E\u58B2\u590B\u5953\u595B\u595D\u5963\u59A4\u59BA\u5B56\u5BC0\u752F\u5BD8\u5BEC\u5C1E\u5CA6\u5CBA\u5CF5\u5D27\u5D53\uFA11\u5D42\u5D6D\u5DB8\u5DB9\u5DD0\u5F21\u5F34\u5F67\u5FB7\u5FDE\u605D\u6085\u608A\u60DE\u60D5\u6120\u60F2\u6111\u6137\u6130\u6198\u6213\u62A6\u63F5\u6460\u649D\u64CE\u654E\u6600\u6615\u663B\u6609\u662E\u661E\u6624\u6665\u6657\u6659\uFA12\u6673\u6699\u66A0\u66B2\u66BF\u66FA\u670E\uF929\u6766\u67BB\u6852\u67C0\u6801\u6844\u68CF\uFA13\u6968\uFA14\u6998\u69E2\u6A30\u6A6B\u6A46\u6A73\u6A7E\u6AE2\u6AE4\u6BD6\u6C3F\u6C5C\u6C86\u6C6F\u6CDA\u6D04\u6D87\u6D6F"],["fb40","\u6D96\u6DAC\u6DCF\u6DF8\u6DF2\u6DFC\u6E39\u6E5C\u6E27\u6E3C\u6EBF\u6F88\u6FB5\u6FF5\u7005\u7007\u7028\u7085\u70AB\u710F\u7104\u715C\u7146\u7147\uFA15\u71C1\u71FE\u72B1\u72BE\u7324\uFA16\u7377\u73BD\u73C9\u73D6\u73E3\u73D2\u7407\u73F5\u7426\u742A\u7429\u742E\u7462\u7489\u749F\u7501\u756F\u7682\u769C\u769E\u769B\u76A6\uFA17\u7746\u52AF\u7821\u784E\u7864\u787A\u7930\uFA18\uFA19"],["fb80","\uFA1A\u7994\uFA1B\u799B\u7AD1\u7AE7\uFA1C\u7AEB\u7B9E\uFA1D\u7D48\u7D5C\u7DB7\u7DA0\u7DD6\u7E52\u7F47\u7FA1\uFA1E\u8301\u8362\u837F\u83C7\u83F6\u8448\u84B4\u8553\u8559\u856B\uFA1F\u85B0\uFA20\uFA21\u8807\u88F5\u8A12\u8A37\u8A79\u8AA7\u8ABE\u8ADF\uFA22\u8AF6\u8B53\u8B7F\u8CF0\u8CF4\u8D12\u8D76\uFA23\u8ECF\uFA24\uFA25\u9067\u90DE\uFA26\u9115\u9127\u91DA\u91D7\u91DE\u91ED\u91EE\u91E4\u91E5\u9206\u9210\u920A\u923A\u9240\u923C\u924E\u9259\u9251\u9239\u9267\u92A7\u9277\u9278\u92E7\u92D7\u92D9\u92D0\uFA27\u92D5\u92E0\u92D3\u9325\u9321\u92FB\uFA28\u931E\u92FF\u931D\u9302\u9370\u9357\u93A4\u93C6\u93DE\u93F8\u9431\u9445\u9448\u9592\uF9DC\uFA29\u969D\u96AF\u9733\u973B\u9743\u974D\u974F\u9751\u9755\u9857\u9865\uFA2A\uFA2B\u9927\uFA2C\u999E\u9A4E\u9AD9"],["fc40","\u9ADC\u9B75\u9B72\u9B8F\u9BB1\u9BBB\u9C00\u9D70\u9D6B\uFA2D\u9E19\u9ED1"]]});var rO=H((Sle,kG)=>{kG.exports=[["0","\0",127],["8ea1","\uFF61",62],["a1a1","\u3000\u3001\u3002\uFF0C\uFF0E\u30FB\uFF1A\uFF1B\uFF1F\uFF01\u309B\u309C\xB4\uFF40\xA8\uFF3E\uFFE3\uFF3F\u30FD\u30FE\u309D\u309E\u3003\u4EDD\u3005\u3006\u3007\u30FC\u2015\u2010\uFF0F\uFF3C\uFF5E\u2225\uFF5C\u2026\u2025\u2018\u2019\u201C\u201D\uFF08\uFF09\u3014\u3015\uFF3B\uFF3D\uFF5B\uFF5D\u3008",9,"\uFF0B\uFF0D\xB1\xD7\xF7\uFF1D\u2260\uFF1C\uFF1E\u2266\u2267\u221E\u2234\u2642\u2640\xB0\u2032\u2033\u2103\uFFE5\uFF04\uFFE0\uFFE1\uFF05\uFF03\uFF06\uFF0A\uFF20\xA7\u2606\u2605\u25CB\u25CF\u25CE\u25C7"],["a2a1","\u25C6\u25A1\u25A0\u25B3\u25B2\u25BD\u25BC\u203B\u3012\u2192\u2190\u2191\u2193\u3013"],["a2ba","\u2208\u220B\u2286\u2287\u2282\u2283\u222A\u2229"],["a2ca","\u2227\u2228\uFFE2\u21D2\u21D4\u2200\u2203"],["a2dc","\u2220\u22A5\u2312\u2202\u2207\u2261\u2252\u226A\u226B\u221A\u223D\u221D\u2235\u222B\u222C"],["a2f2","\u212B\u2030\u266F\u266D\u266A\u2020\u2021\xB6"],["a2fe","\u25EF"],["a3b0","\uFF10",9],["a3c1","\uFF21",25],["a3e1","\uFF41",25],["a4a1","\u3041",82],["a5a1","\u30A1",85],["a6a1","\u0391",16,"\u03A3",6],["a6c1","\u03B1",16,"\u03C3",6],["a7a1","\u0410",5,"\u0401\u0416",25],["a7d1","\u0430",5,"\u0451\u0436",25],["a8a1","\u2500\u2502\u250C\u2510\u2518\u2514\u251C\u252C\u2524\u2534\u253C\u2501\u2503\u250F\u2513\u251B\u2517\u2523\u2533\u252B\u253B\u254B\u2520\u252F\u2528\u2537\u253F\u251D\u2530\u2525\u2538\u2542"],["ada1","\u2460",19,"\u2160",9],["adc0","\u3349\u3314\u3322\u334D\u3318\u3327\u3303\u3336\u3351\u3357\u330D\u3326\u3323\u332B\u334A\u333B\u339C\u339D\u339E\u338E\u338F\u33C4\u33A1"],["addf","\u337B\u301D\u301F\u2116\u33CD\u2121\u32A4",4,"\u3231\u3232\u3239\u337E\u337D\u337C\u2252\u2261\u222B\u222E\u2211\u221A\u22A5\u2220\u221F\u22BF\u2235\u2229\u222A"],["b0a1","\u4E9C\u5516\u5A03\u963F\u54C0\u611B\u6328\u59F6\u9022\u8475\u831C\u7A50\u60AA\u63E1\u6E25\u65ED\u8466\u82A6\u9BF5\u6893\u5727\u65A1\u6271\u5B9B\u59D0\u867B\u98F4\u7D62\u7DBE\u9B8E\u6216\u7C9F\u88B7\u5B89\u5EB5\u6309\u6697\u6848\u95C7\u978D\u674F\u4EE5\u4F0A\u4F4D\u4F9D\u5049\u56F2\u5937\u59D4\u5A01\u5C09\u60DF\u610F\u6170\u6613\u6905\u70BA\u754F\u7570\u79FB\u7DAD\u7DEF\u80C3\u840E\u8863\u8B02\u9055\u907A\u533B\u4E95\u4EA5\u57DF\u80B2\u90C1\u78EF\u4E00\u58F1\u6EA2\u9038\u7A32\u8328\u828B\u9C2F\u5141\u5370\u54BD\u54E1\u56E0\u59FB\u5F15\u98F2\u6DEB\u80E4\u852D"],["b1a1","\u9662\u9670\u96A0\u97FB\u540B\u53F3\u5B87\u70CF\u7FBD\u8FC2\u96E8\u536F\u9D5C\u7ABA\u4E11\u7893\u81FC\u6E26\u5618\u5504\u6B1D\u851A\u9C3B\u59E5\u53A9\u6D66\u74DC\u958F\u5642\u4E91\u904B\u96F2\u834F\u990C\u53E1\u55B6\u5B30\u5F71\u6620\u66F3\u6804\u6C38\u6CF3\u6D29\u745B\u76C8\u7A4E\u9834\u82F1\u885B\u8A60\u92ED\u6DB2\u75AB\u76CA\u99C5\u60A6\u8B01\u8D8A\u95B2\u698E\u53AD\u5186\u5712\u5830\u5944\u5BB4\u5EF6\u6028\u63A9\u63F4\u6CBF\u6F14\u708E\u7114\u7159\u71D5\u733F\u7E01\u8276\u82D1\u8597\u9060\u925B\u9D1B\u5869\u65BC\u6C5A\u7525\u51F9\u592E\u5965\u5F80\u5FDC"],["b2a1","\u62BC\u65FA\u6A2A\u6B27\u6BB4\u738B\u7FC1\u8956\u9D2C\u9D0E\u9EC4\u5CA1\u6C96\u837B\u5104\u5C4B\u61B6\u81C6\u6876\u7261\u4E59\u4FFA\u5378\u6069\u6E29\u7A4F\u97F3\u4E0B\u5316\u4EEE\u4F55\u4F3D\u4FA1\u4F73\u52A0\u53EF\u5609\u590F\u5AC1\u5BB6\u5BE1\u79D1\u6687\u679C\u67B6\u6B4C\u6CB3\u706B\u73C2\u798D\u79BE\u7A3C\u7B87\u82B1\u82DB\u8304\u8377\u83EF\u83D3\u8766\u8AB2\u5629\u8CA8\u8FE6\u904E\u971E\u868A\u4FC4\u5CE8\u6211\u7259\u753B\u81E5\u82BD\u86FE\u8CC0\u96C5\u9913\u99D5\u4ECB\u4F1A\u89E3\u56DE\u584A\u58CA\u5EFB\u5FEB\u602A\u6094\u6062\u61D0\u6212\u62D0\u6539"],["b3a1","\u9B41\u6666\u68B0\u6D77\u7070\u754C\u7686\u7D75\u82A5\u87F9\u958B\u968E\u8C9D\u51F1\u52BE\u5916\u54B3\u5BB3\u5D16\u6168\u6982\u6DAF\u788D\u84CB\u8857\u8A72\u93A7\u9AB8\u6D6C\u99A8\u86D9\u57A3\u67FF\u86CE\u920E\u5283\u5687\u5404\u5ED3\u62E1\u64B9\u683C\u6838\u6BBB\u7372\u78BA\u7A6B\u899A\u89D2\u8D6B\u8F03\u90ED\u95A3\u9694\u9769\u5B66\u5CB3\u697D\u984D\u984E\u639B\u7B20\u6A2B\u6A7F\u68B6\u9C0D\u6F5F\u5272\u559D\u6070\u62EC\u6D3B\u6E07\u6ED1\u845B\u8910\u8F44\u4E14\u9C39\u53F6\u691B\u6A3A\u9784\u682A\u515C\u7AC3\u84B2\u91DC\u938C\u565B\u9D28\u6822\u8305\u8431"],["b4a1","\u7CA5\u5208\u82C5\u74E6\u4E7E\u4F83\u51A0\u5BD2\u520A\u52D8\u52E7\u5DFB\u559A\u582A\u59E6\u5B8C\u5B98\u5BDB\u5E72\u5E79\u60A3\u611F\u6163\u61BE\u63DB\u6562\u67D1\u6853\u68FA\u6B3E\u6B53\u6C57\u6F22\u6F97\u6F45\u74B0\u7518\u76E3\u770B\u7AFF\u7BA1\u7C21\u7DE9\u7F36\u7FF0\u809D\u8266\u839E\u89B3\u8ACC\u8CAB\u9084\u9451\u9593\u9591\u95A2\u9665\u97D3\u9928\u8218\u4E38\u542B\u5CB8\u5DCC\u73A9\u764C\u773C\u5CA9\u7FEB\u8D0B\u96C1\u9811\u9854\u9858\u4F01\u4F0E\u5371\u559C\u5668\u57FA\u5947\u5B09\u5BC4\u5C90\u5E0C\u5E7E\u5FCC\u63EE\u673A\u65D7\u65E2\u671F\u68CB\u68C4"],["b5a1","\u6A5F\u5E30\u6BC5\u6C17\u6C7D\u757F\u7948\u5B63\u7A00\u7D00\u5FBD\u898F\u8A18\u8CB4\u8D77\u8ECC\u8F1D\u98E2\u9A0E\u9B3C\u4E80\u507D\u5100\u5993\u5B9C\u622F\u6280\u64EC\u6B3A\u72A0\u7591\u7947\u7FA9\u87FB\u8ABC\u8B70\u63AC\u83CA\u97A0\u5409\u5403\u55AB\u6854\u6A58\u8A70\u7827\u6775\u9ECD\u5374\u5BA2\u811A\u8650\u9006\u4E18\u4E45\u4EC7\u4F11\u53CA\u5438\u5BAE\u5F13\u6025\u6551\u673D\u6C42\u6C72\u6CE3\u7078\u7403\u7A76\u7AAE\u7B08\u7D1A\u7CFE\u7D66\u65E7\u725B\u53BB\u5C45\u5DE8\u62D2\u62E0\u6319\u6E20\u865A\u8A31\u8DDD\u92F8\u6F01\u79A6\u9B5A\u4EA8\u4EAB\u4EAC"],["b6a1","\u4F9B\u4FA0\u50D1\u5147\u7AF6\u5171\u51F6\u5354\u5321\u537F\u53EB\u55AC\u5883\u5CE1\u5F37\u5F4A\u602F\u6050\u606D\u631F\u6559\u6A4B\u6CC1\u72C2\u72ED\u77EF\u80F8\u8105\u8208\u854E\u90F7\u93E1\u97FF\u9957\u9A5A\u4EF0\u51DD\u5C2D\u6681\u696D\u5C40\u66F2\u6975\u7389\u6850\u7C81\u50C5\u52E4\u5747\u5DFE\u9326\u65A4\u6B23\u6B3D\u7434\u7981\u79BD\u7B4B\u7DCA\u82B9\u83CC\u887F\u895F\u8B39\u8FD1\u91D1\u541F\u9280\u4E5D\u5036\u53E5\u533A\u72D7\u7396\u77E9\u82E6\u8EAF\u99C6\u99C8\u99D2\u5177\u611A\u865E\u55B0\u7A7A\u5076\u5BD3\u9047\u9685\u4E32\u6ADB\u91E7\u5C51\u5C48"],["b7a1","\u6398\u7A9F\u6C93\u9774\u8F61\u7AAA\u718A\u9688\u7C82\u6817\u7E70\u6851\u936C\u52F2\u541B\u85AB\u8A13\u7FA4\u8ECD\u90E1\u5366\u8888\u7941\u4FC2\u50BE\u5211\u5144\u5553\u572D\u73EA\u578B\u5951\u5F62\u5F84\u6075\u6176\u6167\u61A9\u63B2\u643A\u656C\u666F\u6842\u6E13\u7566\u7A3D\u7CFB\u7D4C\u7D99\u7E4B\u7F6B\u830E\u834A\u86CD\u8A08\u8A63\u8B66\u8EFD\u981A\u9D8F\u82B8\u8FCE\u9BE8\u5287\u621F\u6483\u6FC0\u9699\u6841\u5091\u6B20\u6C7A\u6F54\u7A74\u7D50\u8840\u8A23\u6708\u4EF6\u5039\u5026\u5065\u517C\u5238\u5263\u55A7\u570F\u5805\u5ACC\u5EFA\u61B2\u61F8\u62F3\u6372"],["b8a1","\u691C\u6A29\u727D\u72AC\u732E\u7814\u786F\u7D79\u770C\u80A9\u898B\u8B19\u8CE2\u8ED2\u9063\u9375\u967A\u9855\u9A13\u9E78\u5143\u539F\u53B3\u5E7B\u5F26\u6E1B\u6E90\u7384\u73FE\u7D43\u8237\u8A00\u8AFA\u9650\u4E4E\u500B\u53E4\u547C\u56FA\u59D1\u5B64\u5DF1\u5EAB\u5F27\u6238\u6545\u67AF\u6E56\u72D0\u7CCA\u88B4\u80A1\u80E1\u83F0\u864E\u8A87\u8DE8\u9237\u96C7\u9867\u9F13\u4E94\u4E92\u4F0D\u5348\u5449\u543E\u5A2F\u5F8C\u5FA1\u609F\u68A7\u6A8E\u745A\u7881\u8A9E\u8AA4\u8B77\u9190\u4E5E\u9BC9\u4EA4\u4F7C\u4FAF\u5019\u5016\u5149\u516C\u529F\u52B9\u52FE\u539A\u53E3\u5411"],["b9a1","\u540E\u5589\u5751\u57A2\u597D\u5B54\u5B5D\u5B8F\u5DE5\u5DE7\u5DF7\u5E78\u5E83\u5E9A\u5EB7\u5F18\u6052\u614C\u6297\u62D8\u63A7\u653B\u6602\u6643\u66F4\u676D\u6821\u6897\u69CB\u6C5F\u6D2A\u6D69\u6E2F\u6E9D\u7532\u7687\u786C\u7A3F\u7CE0\u7D05\u7D18\u7D5E\u7DB1\u8015\u8003\u80AF\u80B1\u8154\u818F\u822A\u8352\u884C\u8861\u8B1B\u8CA2\u8CFC\u90CA\u9175\u9271\u783F\u92FC\u95A4\u964D\u9805\u9999\u9AD8\u9D3B\u525B\u52AB\u53F7\u5408\u58D5\u62F7\u6FE0\u8C6A\u8F5F\u9EB9\u514B\u523B\u544A\u56FD\u7A40\u9177\u9D60\u9ED2\u7344\u6F09\u8170\u7511\u5FFD\u60DA\u9AA8\u72DB\u8FBC"],["baa1","\u6B64\u9803\u4ECA\u56F0\u5764\u58BE\u5A5A\u6068\u61C7\u660F\u6606\u6839\u68B1\u6DF7\u75D5\u7D3A\u826E\u9B42\u4E9B\u4F50\u53C9\u5506\u5D6F\u5DE6\u5DEE\u67FB\u6C99\u7473\u7802\u8A50\u9396\u88DF\u5750\u5EA7\u632B\u50B5\u50AC\u518D\u6700\u54C9\u585E\u59BB\u5BB0\u5F69\u624D\u63A1\u683D\u6B73\u6E08\u707D\u91C7\u7280\u7815\u7826\u796D\u658E\u7D30\u83DC\u88C1\u8F09\u969B\u5264\u5728\u6750\u7F6A\u8CA1\u51B4\u5742\u962A\u583A\u698A\u80B4\u54B2\u5D0E\u57FC\u7895\u9DFA\u4F5C\u524A\u548B\u643E\u6628\u6714\u67F5\u7A84\u7B56\u7D22\u932F\u685C\u9BAD\u7B39\u5319\u518A\u5237"],["bba1","\u5BDF\u62F6\u64AE\u64E6\u672D\u6BBA\u85A9\u96D1\u7690\u9BD6\u634C\u9306\u9BAB\u76BF\u6652\u4E09\u5098\u53C2\u5C71\u60E8\u6492\u6563\u685F\u71E6\u73CA\u7523\u7B97\u7E82\u8695\u8B83\u8CDB\u9178\u9910\u65AC\u66AB\u6B8B\u4ED5\u4ED4\u4F3A\u4F7F\u523A\u53F8\u53F2\u55E3\u56DB\u58EB\u59CB\u59C9\u59FF\u5B50\u5C4D\u5E02\u5E2B\u5FD7\u601D\u6307\u652F\u5B5C\u65AF\u65BD\u65E8\u679D\u6B62\u6B7B\u6C0F\u7345\u7949\u79C1\u7CF8\u7D19\u7D2B\u80A2\u8102\u81F3\u8996\u8A5E\u8A69\u8A66\u8A8C\u8AEE\u8CC7\u8CDC\u96CC\u98FC\u6B6F\u4E8B\u4F3C\u4F8D\u5150\u5B57\u5BFA\u6148\u6301\u6642"],["bca1","\u6B21\u6ECB\u6CBB\u723E\u74BD\u75D4\u78C1\u793A\u800C\u8033\u81EA\u8494\u8F9E\u6C50\u9E7F\u5F0F\u8B58\u9D2B\u7AFA\u8EF8\u5B8D\u96EB\u4E03\u53F1\u57F7\u5931\u5AC9\u5BA4\u6089\u6E7F\u6F06\u75BE\u8CEA\u5B9F\u8500\u7BE0\u5072\u67F4\u829D\u5C61\u854A\u7E1E\u820E\u5199\u5C04\u6368\u8D66\u659C\u716E\u793E\u7D17\u8005\u8B1D\u8ECA\u906E\u86C7\u90AA\u501F\u52FA\u5C3A\u6753\u707C\u7235\u914C\u91C8\u932B\u82E5\u5BC2\u5F31\u60F9\u4E3B\u53D6\u5B88\u624B\u6731\u6B8A\u72E9\u73E0\u7A2E\u816B\u8DA3\u9152\u9996\u5112\u53D7\u546A\u5BFF\u6388\u6A39\u7DAC\u9700\u56DA\u53CE\u5468"],["bda1","\u5B97\u5C31\u5DDE\u4FEE\u6101\u62FE\u6D32\u79C0\u79CB\u7D42\u7E4D\u7FD2\u81ED\u821F\u8490\u8846\u8972\u8B90\u8E74\u8F2F\u9031\u914B\u916C\u96C6\u919C\u4EC0\u4F4F\u5145\u5341\u5F93\u620E\u67D4\u6C41\u6E0B\u7363\u7E26\u91CD\u9283\u53D4\u5919\u5BBF\u6DD1\u795D\u7E2E\u7C9B\u587E\u719F\u51FA\u8853\u8FF0\u4FCA\u5CFB\u6625\u77AC\u7AE3\u821C\u99FF\u51C6\u5FAA\u65EC\u696F\u6B89\u6DF3\u6E96\u6F64\u76FE\u7D14\u5DE1\u9075\u9187\u9806\u51E6\u521D\u6240\u6691\u66D9\u6E1A\u5EB6\u7DD2\u7F72\u66F8\u85AF\u85F7\u8AF8\u52A9\u53D9\u5973\u5E8F\u5F90\u6055\u92E4\u9664\u50B7\u511F"],["bea1","\u52DD\u5320\u5347\u53EC\u54E8\u5546\u5531\u5617\u5968\u59BE\u5A3C\u5BB5\u5C06\u5C0F\u5C11\u5C1A\u5E84\u5E8A\u5EE0\u5F70\u627F\u6284\u62DB\u638C\u6377\u6607\u660C\u662D\u6676\u677E\u68A2\u6A1F\u6A35\u6CBC\u6D88\u6E09\u6E58\u713C\u7126\u7167\u75C7\u7701\u785D\u7901\u7965\u79F0\u7AE0\u7B11\u7CA7\u7D39\u8096\u83D6\u848B\u8549\u885D\u88F3\u8A1F\u8A3C\u8A54\u8A73\u8C61\u8CDE\u91A4\u9266\u937E\u9418\u969C\u9798\u4E0A\u4E08\u4E1E\u4E57\u5197\u5270\u57CE\u5834\u58CC\u5B22\u5E38\u60C5\u64FE\u6761\u6756\u6D44\u72B6\u7573\u7A63\u84B8\u8B72\u91B8\u9320\u5631\u57F4\u98FE"],["bfa1","\u62ED\u690D\u6B96\u71ED\u7E54\u8077\u8272\u89E6\u98DF\u8755\u8FB1\u5C3B\u4F38\u4FE1\u4FB5\u5507\u5A20\u5BDD\u5BE9\u5FC3\u614E\u632F\u65B0\u664B\u68EE\u699B\u6D78\u6DF1\u7533\u75B9\u771F\u795E\u79E6\u7D33\u81E3\u82AF\u85AA\u89AA\u8A3A\u8EAB\u8F9B\u9032\u91DD\u9707\u4EBA\u4EC1\u5203\u5875\u58EC\u5C0B\u751A\u5C3D\u814E\u8A0A\u8FC5\u9663\u976D\u7B25\u8ACF\u9808\u9162\u56F3\u53A8\u9017\u5439\u5782\u5E25\u63A8\u6C34\u708A\u7761\u7C8B\u7FE0\u8870\u9042\u9154\u9310\u9318\u968F\u745E\u9AC4\u5D07\u5D69\u6570\u67A2\u8DA8\u96DB\u636E\u6749\u6919\u83C5\u9817\u96C0\u88FE"],["c0a1","\u6F84\u647A\u5BF8\u4E16\u702C\u755D\u662F\u51C4\u5236\u52E2\u59D3\u5F81\u6027\u6210\u653F\u6574\u661F\u6674\u68F2\u6816\u6B63\u6E05\u7272\u751F\u76DB\u7CBE\u8056\u58F0\u88FD\u897F\u8AA0\u8A93\u8ACB\u901D\u9192\u9752\u9759\u6589\u7A0E\u8106\u96BB\u5E2D\u60DC\u621A\u65A5\u6614\u6790\u77F3\u7A4D\u7C4D\u7E3E\u810A\u8CAC\u8D64\u8DE1\u8E5F\u78A9\u5207\u62D9\u63A5\u6442\u6298\u8A2D\u7A83\u7BC0\u8AAC\u96EA\u7D76\u820C\u8749\u4ED9\u5148\u5343\u5360\u5BA3\u5C02\u5C16\u5DDD\u6226\u6247\u64B0\u6813\u6834\u6CC9\u6D45\u6D17\u67D3\u6F5C\u714E\u717D\u65CB\u7A7F\u7BAD\u7DDA"],["c1a1","\u7E4A\u7FA8\u817A\u821B\u8239\u85A6\u8A6E\u8CCE\u8DF5\u9078\u9077\u92AD\u9291\u9583\u9BAE\u524D\u5584\u6F38\u7136\u5168\u7985\u7E55\u81B3\u7CCE\u564C\u5851\u5CA8\u63AA\u66FE\u66FD\u695A\u72D9\u758F\u758E\u790E\u7956\u79DF\u7C97\u7D20\u7D44\u8607\u8A34\u963B\u9061\u9F20\u50E7\u5275\u53CC\u53E2\u5009\u55AA\u58EE\u594F\u723D\u5B8B\u5C64\u531D\u60E3\u60F3\u635C\u6383\u633F\u63BB\u64CD\u65E9\u66F9\u5DE3\u69CD\u69FD\u6F15\u71E5\u4E89\u75E9\u76F8\u7A93\u7CDF\u7DCF\u7D9C\u8061\u8349\u8358\u846C\u84BC\u85FB\u88C5\u8D70\u9001\u906D\u9397\u971C\u9A12\u50CF\u5897\u618E"],["c2a1","\u81D3\u8535\u8D08\u9020\u4FC3\u5074\u5247\u5373\u606F\u6349\u675F\u6E2C\u8DB3\u901F\u4FD7\u5C5E\u8CCA\u65CF\u7D9A\u5352\u8896\u5176\u63C3\u5B58\u5B6B\u5C0A\u640D\u6751\u905C\u4ED6\u591A\u592A\u6C70\u8A51\u553E\u5815\u59A5\u60F0\u6253\u67C1\u8235\u6955\u9640\u99C4\u9A28\u4F53\u5806\u5BFE\u8010\u5CB1\u5E2F\u5F85\u6020\u614B\u6234\u66FF\u6CF0\u6EDE\u80CE\u817F\u82D4\u888B\u8CB8\u9000\u902E\u968A\u9EDB\u9BDB\u4EE3\u53F0\u5927\u7B2C\u918D\u984C\u9DF9\u6EDD\u7027\u5353\u5544\u5B85\u6258\u629E\u62D3\u6CA2\u6FEF\u7422\u8A17\u9438\u6FC1\u8AFE\u8338\u51E7\u86F8\u53EA"],["c3a1","\u53E9\u4F46\u9054\u8FB0\u596A\u8131\u5DFD\u7AEA\u8FBF\u68DA\u8C37\u72F8\u9C48\u6A3D\u8AB0\u4E39\u5358\u5606\u5766\u62C5\u63A2\u65E6\u6B4E\u6DE1\u6E5B\u70AD\u77ED\u7AEF\u7BAA\u7DBB\u803D\u80C6\u86CB\u8A95\u935B\u56E3\u58C7\u5F3E\u65AD\u6696\u6A80\u6BB5\u7537\u8AC7\u5024\u77E5\u5730\u5F1B\u6065\u667A\u6C60\u75F4\u7A1A\u7F6E\u81F4\u8718\u9045\u99B3\u7BC9\u755C\u7AF9\u7B51\u84C4\u9010\u79E9\u7A92\u8336\u5AE1\u7740\u4E2D\u4EF2\u5B99\u5FE0\u62BD\u663C\u67F1\u6CE8\u866B\u8877\u8A3B\u914E\u92F3\u99D0\u6A17\u7026\u732A\u82E7\u8457\u8CAF\u4E01\u5146\u51CB\u558B\u5BF5"],["c4a1","\u5E16\u5E33\u5E81\u5F14\u5F35\u5F6B\u5FB4\u61F2\u6311\u66A2\u671D\u6F6E\u7252\u753A\u773A\u8074\u8139\u8178\u8776\u8ABF\u8ADC\u8D85\u8DF3\u929A\u9577\u9802\u9CE5\u52C5\u6357\u76F4\u6715\u6C88\u73CD\u8CC3\u93AE\u9673\u6D25\u589C\u690E\u69CC\u8FFD\u939A\u75DB\u901A\u585A\u6802\u63B4\u69FB\u4F43\u6F2C\u67D8\u8FBB\u8526\u7DB4\u9354\u693F\u6F70\u576A\u58F7\u5B2C\u7D2C\u722A\u540A\u91E3\u9DB4\u4EAD\u4F4E\u505C\u5075\u5243\u8C9E\u5448\u5824\u5B9A\u5E1D\u5E95\u5EAD\u5EF7\u5F1F\u608C\u62B5\u633A\u63D0\u68AF\u6C40\u7887\u798E\u7A0B\u7DE0\u8247\u8A02\u8AE6\u8E44\u9013"],["c5a1","\u90B8\u912D\u91D8\u9F0E\u6CE5\u6458\u64E2\u6575\u6EF4\u7684\u7B1B\u9069\u93D1\u6EBA\u54F2\u5FB9\u64A4\u8F4D\u8FED\u9244\u5178\u586B\u5929\u5C55\u5E97\u6DFB\u7E8F\u751C\u8CBC\u8EE2\u985B\u70B9\u4F1D\u6BBF\u6FB1\u7530\u96FB\u514E\u5410\u5835\u5857\u59AC\u5C60\u5F92\u6597\u675C\u6E21\u767B\u83DF\u8CED\u9014\u90FD\u934D\u7825\u783A\u52AA\u5EA6\u571F\u5974\u6012\u5012\u515A\u51AC\u51CD\u5200\u5510\u5854\u5858\u5957\u5B95\u5CF6\u5D8B\u60BC\u6295\u642D\u6771\u6843\u68BC\u68DF\u76D7\u6DD8\u6E6F\u6D9B\u706F\u71C8\u5F53\u75D8\u7977\u7B49\u7B54\u7B52\u7CD6\u7D71\u5230"],["c6a1","\u8463\u8569\u85E4\u8A0E\u8B04\u8C46\u8E0F\u9003\u900F\u9419\u9676\u982D\u9A30\u95D8\u50CD\u52D5\u540C\u5802\u5C0E\u61A7\u649E\u6D1E\u77B3\u7AE5\u80F4\u8404\u9053\u9285\u5CE0\u9D07\u533F\u5F97\u5FB3\u6D9C\u7279\u7763\u79BF\u7BE4\u6BD2\u72EC\u8AAD\u6803\u6A61\u51F8\u7A81\u6934\u5C4A\u9CF6\u82EB\u5BC5\u9149\u701E\u5678\u5C6F\u60C7\u6566\u6C8C\u8C5A\u9041\u9813\u5451\u66C7\u920D\u5948\u90A3\u5185\u4E4D\u51EA\u8599\u8B0E\u7058\u637A\u934B\u6962\u99B4\u7E04\u7577\u5357\u6960\u8EDF\u96E3\u6C5D\u4E8C\u5C3C\u5F10\u8FE9\u5302\u8CD1\u8089\u8679\u5EFF\u65E5\u4E73\u5165"],["c7a1","\u5982\u5C3F\u97EE\u4EFB\u598A\u5FCD\u8A8D\u6FE1\u79B0\u7962\u5BE7\u8471\u732B\u71B1\u5E74\u5FF5\u637B\u649A\u71C3\u7C98\u4E43\u5EFC\u4E4B\u57DC\u56A2\u60A9\u6FC3\u7D0D\u80FD\u8133\u81BF\u8FB2\u8997\u86A4\u5DF4\u628A\u64AD\u8987\u6777\u6CE2\u6D3E\u7436\u7834\u5A46\u7F75\u82AD\u99AC\u4FF3\u5EC3\u62DD\u6392\u6557\u676F\u76C3\u724C\u80CC\u80BA\u8F29\u914D\u500D\u57F9\u5A92\u6885\u6973\u7164\u72FD\u8CB7\u58F2\u8CE0\u966A\u9019\u877F\u79E4\u77E7\u8429\u4F2F\u5265\u535A\u62CD\u67CF\u6CCA\u767D\u7B94\u7C95\u8236\u8584\u8FEB\u66DD\u6F20\u7206\u7E1B\u83AB\u99C1\u9EA6"],["c8a1","\u51FD\u7BB1\u7872\u7BB8\u8087\u7B48\u6AE8\u5E61\u808C\u7551\u7560\u516B\u9262\u6E8C\u767A\u9197\u9AEA\u4F10\u7F70\u629C\u7B4F\u95A5\u9CE9\u567A\u5859\u86E4\u96BC\u4F34\u5224\u534A\u53CD\u53DB\u5E06\u642C\u6591\u677F\u6C3E\u6C4E\u7248\u72AF\u73ED\u7554\u7E41\u822C\u85E9\u8CA9\u7BC4\u91C6\u7169\u9812\u98EF\u633D\u6669\u756A\u76E4\u78D0\u8543\u86EE\u532A\u5351\u5426\u5983\u5E87\u5F7C\u60B2\u6249\u6279\u62AB\u6590\u6BD4\u6CCC\u75B2\u76AE\u7891\u79D8\u7DCB\u7F77\u80A5\u88AB\u8AB9\u8CBB\u907F\u975E\u98DB\u6A0B\u7C38\u5099\u5C3E\u5FAE\u6787\u6BD8\u7435\u7709\u7F8E"],["c9a1","\u9F3B\u67CA\u7A17\u5339\u758B\u9AED\u5F66\u819D\u83F1\u8098\u5F3C\u5FC5\u7562\u7B46\u903C\u6867\u59EB\u5A9B\u7D10\u767E\u8B2C\u4FF5\u5F6A\u6A19\u6C37\u6F02\u74E2\u7968\u8868\u8A55\u8C79\u5EDF\u63CF\u75C5\u79D2\u82D7\u9328\u92F2\u849C\u86ED\u9C2D\u54C1\u5F6C\u658C\u6D5C\u7015\u8CA7\u8CD3\u983B\u654F\u74F6\u4E0D\u4ED8\u57E0\u592B\u5A66\u5BCC\u51A8\u5E03\u5E9C\u6016\u6276\u6577\u65A7\u666E\u6D6E\u7236\u7B26\u8150\u819A\u8299\u8B5C\u8CA0\u8CE6\u8D74\u961C\u9644\u4FAE\u64AB\u6B66\u821E\u8461\u856A\u90E8\u5C01\u6953\u98A8\u847A\u8557\u4F0F\u526F\u5FA9\u5E45\u670D"],["caa1","\u798F\u8179\u8907\u8986\u6DF5\u5F17\u6255\u6CB8\u4ECF\u7269\u9B92\u5206\u543B\u5674\u58B3\u61A4\u626E\u711A\u596E\u7C89\u7CDE\u7D1B\u96F0\u6587\u805E\u4E19\u4F75\u5175\u5840\u5E63\u5E73\u5F0A\u67C4\u4E26\u853D\u9589\u965B\u7C73\u9801\u50FB\u58C1\u7656\u78A7\u5225\u77A5\u8511\u7B86\u504F\u5909\u7247\u7BC7\u7DE8\u8FBA\u8FD4\u904D\u4FBF\u52C9\u5A29\u5F01\u97AD\u4FDD\u8217\u92EA\u5703\u6355\u6B69\u752B\u88DC\u8F14\u7A42\u52DF\u5893\u6155\u620A\u66AE\u6BCD\u7C3F\u83E9\u5023\u4FF8\u5305\u5446\u5831\u5949\u5B9D\u5CF0\u5CEF\u5D29\u5E96\u62B1\u6367\u653E\u65B9\u670B"],["cba1","\u6CD5\u6CE1\u70F9\u7832\u7E2B\u80DE\u82B3\u840C\u84EC\u8702\u8912\u8A2A\u8C4A\u90A6\u92D2\u98FD\u9CF3\u9D6C\u4E4F\u4EA1\u508D\u5256\u574A\u59A8\u5E3D\u5FD8\u5FD9\u623F\u66B4\u671B\u67D0\u68D2\u5192\u7D21\u80AA\u81A8\u8B00\u8C8C\u8CBF\u927E\u9632\u5420\u982C\u5317\u50D5\u535C\u58A8\u64B2\u6734\u7267\u7766\u7A46\u91E6\u52C3\u6CA1\u6B86\u5800\u5E4C\u5954\u672C\u7FFB\u51E1\u76C6\u6469\u78E8\u9B54\u9EBB\u57CB\u59B9\u6627\u679A\u6BCE\u54E9\u69D9\u5E55\u819C\u6795\u9BAA\u67FE\u9C52\u685D\u4EA6\u4FE3\u53C8\u62B9\u672B\u6CAB\u8FC4\u4FAD\u7E6D\u9EBF\u4E07\u6162\u6E80"],["cca1","\u6F2B\u8513\u5473\u672A\u9B45\u5DF3\u7B95\u5CAC\u5BC6\u871C\u6E4A\u84D1\u7A14\u8108\u5999\u7C8D\u6C11\u7720\u52D9\u5922\u7121\u725F\u77DB\u9727\u9D61\u690B\u5A7F\u5A18\u51A5\u540D\u547D\u660E\u76DF\u8FF7\u9298\u9CF4\u59EA\u725D\u6EC5\u514D\u68C9\u7DBF\u7DEC\u9762\u9EBA\u6478\u6A21\u8302\u5984\u5B5F\u6BDB\u731B\u76F2\u7DB2\u8017\u8499\u5132\u6728\u9ED9\u76EE\u6762\u52FF\u9905\u5C24\u623B\u7C7E\u8CB0\u554F\u60B6\u7D0B\u9580\u5301\u4E5F\u51B6\u591C\u723A\u8036\u91CE\u5F25\u77E2\u5384\u5F79\u7D04\u85AC\u8A33\u8E8D\u9756\u67F3\u85AE\u9453\u6109\u6108\u6CB9\u7652"],["cda1","\u8AED\u8F38\u552F\u4F51\u512A\u52C7\u53CB\u5BA5\u5E7D\u60A0\u6182\u63D6\u6709\u67DA\u6E67\u6D8C\u7336\u7337\u7531\u7950\u88D5\u8A98\u904A\u9091\u90F5\u96C4\u878D\u5915\u4E88\u4F59\u4E0E\u8A89\u8F3F\u9810\u50AD\u5E7C\u5996\u5BB9\u5EB8\u63DA\u63FA\u64C1\u66DC\u694A\u69D8\u6D0B\u6EB6\u7194\u7528\u7AAF\u7F8A\u8000\u8449\u84C9\u8981\u8B21\u8E0A\u9065\u967D\u990A\u617E\u6291\u6B32\u6C83\u6D74\u7FCC\u7FFC\u6DC0\u7F85\u87BA\u88F8\u6765\u83B1\u983C\u96F7\u6D1B\u7D61\u843D\u916A\u4E71\u5375\u5D50\u6B04\u6FEB\u85CD\u862D\u89A7\u5229\u540F\u5C65\u674E\u68A8\u7406\u7483"],["cea1","\u75E2\u88CF\u88E1\u91CC\u96E2\u9678\u5F8B\u7387\u7ACB\u844E\u63A0\u7565\u5289\u6D41\u6E9C\u7409\u7559\u786B\u7C92\u9686\u7ADC\u9F8D\u4FB6\u616E\u65C5\u865C\u4E86\u4EAE\u50DA\u4E21\u51CC\u5BEE\u6599\u6881\u6DBC\u731F\u7642\u77AD\u7A1C\u7CE7\u826F\u8AD2\u907C\u91CF\u9675\u9818\u529B\u7DD1\u502B\u5398\u6797\u6DCB\u71D0\u7433\u81E8\u8F2A\u96A3\u9C57\u9E9F\u7460\u5841\u6D99\u7D2F\u985E\u4EE4\u4F36\u4F8B\u51B7\u52B1\u5DBA\u601C\u73B2\u793C\u82D3\u9234\u96B7\u96F6\u970A\u9E97\u9F62\u66A6\u6B74\u5217\u52A3\u70C8\u88C2\u5EC9\u604B\u6190\u6F23\u7149\u7C3E\u7DF4\u806F"],["cfa1","\u84EE\u9023\u932C\u5442\u9B6F\u6AD3\u7089\u8CC2\u8DEF\u9732\u52B4\u5A41\u5ECA\u5F04\u6717\u697C\u6994\u6D6A\u6F0F\u7262\u72FC\u7BED\u8001\u807E\u874B\u90CE\u516D\u9E93\u7984\u808B\u9332\u8AD6\u502D\u548C\u8A71\u6B6A\u8CC4\u8107\u60D1\u67A0\u9DF2\u4E99\u4E98\u9C10\u8A6B\u85C1\u8568\u6900\u6E7E\u7897\u8155"],["d0a1","\u5F0C\u4E10\u4E15\u4E2A\u4E31\u4E36\u4E3C\u4E3F\u4E42\u4E56\u4E58\u4E82\u4E85\u8C6B\u4E8A\u8212\u5F0D\u4E8E\u4E9E\u4E9F\u4EA0\u4EA2\u4EB0\u4EB3\u4EB6\u4ECE\u4ECD\u4EC4\u4EC6\u4EC2\u4ED7\u4EDE\u4EED\u4EDF\u4EF7\u4F09\u4F5A\u4F30\u4F5B\u4F5D\u4F57\u4F47\u4F76\u4F88\u4F8F\u4F98\u4F7B\u4F69\u4F70\u4F91\u4F6F\u4F86\u4F96\u5118\u4FD4\u4FDF\u4FCE\u4FD8\u4FDB\u4FD1\u4FDA\u4FD0\u4FE4\u4FE5\u501A\u5028\u5014\u502A\u5025\u5005\u4F1C\u4FF6\u5021\u5029\u502C\u4FFE\u4FEF\u5011\u5006\u5043\u5047\u6703\u5055\u5050\u5048\u505A\u5056\u506C\u5078\u5080\u509A\u5085\u50B4\u50B2"],["d1a1","\u50C9\u50CA\u50B3\u50C2\u50D6\u50DE\u50E5\u50ED\u50E3\u50EE\u50F9\u50F5\u5109\u5101\u5102\u5116\u5115\u5114\u511A\u5121\u513A\u5137\u513C\u513B\u513F\u5140\u5152\u514C\u5154\u5162\u7AF8\u5169\u516A\u516E\u5180\u5182\u56D8\u518C\u5189\u518F\u5191\u5193\u5195\u5196\u51A4\u51A6\u51A2\u51A9\u51AA\u51AB\u51B3\u51B1\u51B2\u51B0\u51B5\u51BD\u51C5\u51C9\u51DB\u51E0\u8655\u51E9\u51ED\u51F0\u51F5\u51FE\u5204\u520B\u5214\u520E\u5227\u522A\u522E\u5233\u5239\u524F\u5244\u524B\u524C\u525E\u5254\u526A\u5274\u5269\u5273\u527F\u527D\u528D\u5294\u5292\u5271\u5288\u5291\u8FA8"],["d2a1","\u8FA7\u52AC\u52AD\u52BC\u52B5\u52C1\u52CD\u52D7\u52DE\u52E3\u52E6\u98ED\u52E0\u52F3\u52F5\u52F8\u52F9\u5306\u5308\u7538\u530D\u5310\u530F\u5315\u531A\u5323\u532F\u5331\u5333\u5338\u5340\u5346\u5345\u4E17\u5349\u534D\u51D6\u535E\u5369\u536E\u5918\u537B\u5377\u5382\u5396\u53A0\u53A6\u53A5\u53AE\u53B0\u53B6\u53C3\u7C12\u96D9\u53DF\u66FC\u71EE\u53EE\u53E8\u53ED\u53FA\u5401\u543D\u5440\u542C\u542D\u543C\u542E\u5436\u5429\u541D\u544E\u548F\u5475\u548E\u545F\u5471\u5477\u5470\u5492\u547B\u5480\u5476\u5484\u5490\u5486\u54C7\u54A2\u54B8\u54A5\u54AC\u54C4\u54C8\u54A8"],["d3a1","\u54AB\u54C2\u54A4\u54BE\u54BC\u54D8\u54E5\u54E6\u550F\u5514\u54FD\u54EE\u54ED\u54FA\u54E2\u5539\u5540\u5563\u554C\u552E\u555C\u5545\u5556\u5557\u5538\u5533\u555D\u5599\u5580\u54AF\u558A\u559F\u557B\u557E\u5598\u559E\u55AE\u557C\u5583\u55A9\u5587\u55A8\u55DA\u55C5\u55DF\u55C4\u55DC\u55E4\u55D4\u5614\u55F7\u5616\u55FE\u55FD\u561B\u55F9\u564E\u5650\u71DF\u5634\u5636\u5632\u5638\u566B\u5664\u562F\u566C\u566A\u5686\u5680\u568A\u56A0\u5694\u568F\u56A5\u56AE\u56B6\u56B4\u56C2\u56BC\u56C1\u56C3\u56C0\u56C8\u56CE\u56D1\u56D3\u56D7\u56EE\u56F9\u5700\u56FF\u5704\u5709"],["d4a1","\u5708\u570B\u570D\u5713\u5718\u5716\u55C7\u571C\u5726\u5737\u5738\u574E\u573B\u5740\u574F\u5769\u57C0\u5788\u5761\u577F\u5789\u5793\u57A0\u57B3\u57A4\u57AA\u57B0\u57C3\u57C6\u57D4\u57D2\u57D3\u580A\u57D6\u57E3\u580B\u5819\u581D\u5872\u5821\u5862\u584B\u5870\u6BC0\u5852\u583D\u5879\u5885\u58B9\u589F\u58AB\u58BA\u58DE\u58BB\u58B8\u58AE\u58C5\u58D3\u58D1\u58D7\u58D9\u58D8\u58E5\u58DC\u58E4\u58DF\u58EF\u58FA\u58F9\u58FB\u58FC\u58FD\u5902\u590A\u5910\u591B\u68A6\u5925\u592C\u592D\u5932\u5938\u593E\u7AD2\u5955\u5950\u594E\u595A\u5958\u5962\u5960\u5967\u596C\u5969"],["d5a1","\u5978\u5981\u599D\u4F5E\u4FAB\u59A3\u59B2\u59C6\u59E8\u59DC\u598D\u59D9\u59DA\u5A25\u5A1F\u5A11\u5A1C\u5A09\u5A1A\u5A40\u5A6C\u5A49\u5A35\u5A36\u5A62\u5A6A\u5A9A\u5ABC\u5ABE\u5ACB\u5AC2\u5ABD\u5AE3\u5AD7\u5AE6\u5AE9\u5AD6\u5AFA\u5AFB\u5B0C\u5B0B\u5B16\u5B32\u5AD0\u5B2A\u5B36\u5B3E\u5B43\u5B45\u5B40\u5B51\u5B55\u5B5A\u5B5B\u5B65\u5B69\u5B70\u5B73\u5B75\u5B78\u6588\u5B7A\u5B80\u5B83\u5BA6\u5BB8\u5BC3\u5BC7\u5BC9\u5BD4\u5BD0\u5BE4\u5BE6\u5BE2\u5BDE\u5BE5\u5BEB\u5BF0\u5BF6\u5BF3\u5C05\u5C07\u5C08\u5C0D\u5C13\u5C20\u5C22\u5C28\u5C38\u5C39\u5C41\u5C46\u5C4E\u5C53"],["d6a1","\u5C50\u5C4F\u5B71\u5C6C\u5C6E\u4E62\u5C76\u5C79\u5C8C\u5C91\u5C94\u599B\u5CAB\u5CBB\u5CB6\u5CBC\u5CB7\u5CC5\u5CBE\u5CC7\u5CD9\u5CE9\u5CFD\u5CFA\u5CED\u5D8C\u5CEA\u5D0B\u5D15\u5D17\u5D5C\u5D1F\u5D1B\u5D11\u5D14\u5D22\u5D1A\u5D19\u5D18\u5D4C\u5D52\u5D4E\u5D4B\u5D6C\u5D73\u5D76\u5D87\u5D84\u5D82\u5DA2\u5D9D\u5DAC\u5DAE\u5DBD\u5D90\u5DB7\u5DBC\u5DC9\u5DCD\u5DD3\u5DD2\u5DD6\u5DDB\u5DEB\u5DF2\u5DF5\u5E0B\u5E1A\u5E19\u5E11\u5E1B\u5E36\u5E37\u5E44\u5E43\u5E40\u5E4E\u5E57\u5E54\u5E5F\u5E62\u5E64\u5E47\u5E75\u5E76\u5E7A\u9EBC\u5E7F\u5EA0\u5EC1\u5EC2\u5EC8\u5ED0\u5ECF"],["d7a1","\u5ED6\u5EE3\u5EDD\u5EDA\u5EDB\u5EE2\u5EE1\u5EE8\u5EE9\u5EEC\u5EF1\u5EF3\u5EF0\u5EF4\u5EF8\u5EFE\u5F03\u5F09\u5F5D\u5F5C\u5F0B\u5F11\u5F16\u5F29\u5F2D\u5F38\u5F41\u5F48\u5F4C\u5F4E\u5F2F\u5F51\u5F56\u5F57\u5F59\u5F61\u5F6D\u5F73\u5F77\u5F83\u5F82\u5F7F\u5F8A\u5F88\u5F91\u5F87\u5F9E\u5F99\u5F98\u5FA0\u5FA8\u5FAD\u5FBC\u5FD6\u5FFB\u5FE4\u5FF8\u5FF1\u5FDD\u60B3\u5FFF\u6021\u6060\u6019\u6010\u6029\u600E\u6031\u601B\u6015\u602B\u6026\u600F\u603A\u605A\u6041\u606A\u6077\u605F\u604A\u6046\u604D\u6063\u6043\u6064\u6042\u606C\u606B\u6059\u6081\u608D\u60E7\u6083\u609A"],["d8a1","\u6084\u609B\u6096\u6097\u6092\u60A7\u608B\u60E1\u60B8\u60E0\u60D3\u60B4\u5FF0\u60BD\u60C6\u60B5\u60D8\u614D\u6115\u6106\u60F6\u60F7\u6100\u60F4\u60FA\u6103\u6121\u60FB\u60F1\u610D\u610E\u6147\u613E\u6128\u6127\u614A\u613F\u613C\u612C\u6134\u613D\u6142\u6144\u6173\u6177\u6158\u6159\u615A\u616B\u6174\u616F\u6165\u6171\u615F\u615D\u6153\u6175\u6199\u6196\u6187\u61AC\u6194\u619A\u618A\u6191\u61AB\u61AE\u61CC\u61CA\u61C9\u61F7\u61C8\u61C3\u61C6\u61BA\u61CB\u7F79\u61CD\u61E6\u61E3\u61F6\u61FA\u61F4\u61FF\u61FD\u61FC\u61FE\u6200\u6208\u6209\u620D\u620C\u6214\u621B"],["d9a1","\u621E\u6221\u622A\u622E\u6230\u6232\u6233\u6241\u624E\u625E\u6263\u625B\u6260\u6268\u627C\u6282\u6289\u627E\u6292\u6293\u6296\u62D4\u6283\u6294\u62D7\u62D1\u62BB\u62CF\u62FF\u62C6\u64D4\u62C8\u62DC\u62CC\u62CA\u62C2\u62C7\u629B\u62C9\u630C\u62EE\u62F1\u6327\u6302\u6308\u62EF\u62F5\u6350\u633E\u634D\u641C\u634F\u6396\u638E\u6380\u63AB\u6376\u63A3\u638F\u6389\u639F\u63B5\u636B\u6369\u63BE\u63E9\u63C0\u63C6\u63E3\u63C9\u63D2\u63F6\u63C4\u6416\u6434\u6406\u6413\u6426\u6436\u651D\u6417\u6428\u640F\u6467\u646F\u6476\u644E\u652A\u6495\u6493\u64A5\u64A9\u6488\u64BC"],["daa1","\u64DA\u64D2\u64C5\u64C7\u64BB\u64D8\u64C2\u64F1\u64E7\u8209\u64E0\u64E1\u62AC\u64E3\u64EF\u652C\u64F6\u64F4\u64F2\u64FA\u6500\u64FD\u6518\u651C\u6505\u6524\u6523\u652B\u6534\u6535\u6537\u6536\u6538\u754B\u6548\u6556\u6555\u654D\u6558\u655E\u655D\u6572\u6578\u6582\u6583\u8B8A\u659B\u659F\u65AB\u65B7\u65C3\u65C6\u65C1\u65C4\u65CC\u65D2\u65DB\u65D9\u65E0\u65E1\u65F1\u6772\u660A\u6603\u65FB\u6773\u6635\u6636\u6634\u661C\u664F\u6644\u6649\u6641\u665E\u665D\u6664\u6667\u6668\u665F\u6662\u6670\u6683\u6688\u668E\u6689\u6684\u6698\u669D\u66C1\u66B9\u66C9\u66BE\u66BC"],["dba1","\u66C4\u66B8\u66D6\u66DA\u66E0\u663F\u66E6\u66E9\u66F0\u66F5\u66F7\u670F\u6716\u671E\u6726\u6727\u9738\u672E\u673F\u6736\u6741\u6738\u6737\u6746\u675E\u6760\u6759\u6763\u6764\u6789\u6770\u67A9\u677C\u676A\u678C\u678B\u67A6\u67A1\u6785\u67B7\u67EF\u67B4\u67EC\u67B3\u67E9\u67B8\u67E4\u67DE\u67DD\u67E2\u67EE\u67B9\u67CE\u67C6\u67E7\u6A9C\u681E\u6846\u6829\u6840\u684D\u6832\u684E\u68B3\u682B\u6859\u6863\u6877\u687F\u689F\u688F\u68AD\u6894\u689D\u689B\u6883\u6AAE\u68B9\u6874\u68B5\u68A0\u68BA\u690F\u688D\u687E\u6901\u68CA\u6908\u68D8\u6922\u6926\u68E1\u690C\u68CD"],["dca1","\u68D4\u68E7\u68D5\u6936\u6912\u6904\u68D7\u68E3\u6925\u68F9\u68E0\u68EF\u6928\u692A\u691A\u6923\u6921\u68C6\u6979\u6977\u695C\u6978\u696B\u6954\u697E\u696E\u6939\u6974\u693D\u6959\u6930\u6961\u695E\u695D\u6981\u696A\u69B2\u69AE\u69D0\u69BF\u69C1\u69D3\u69BE\u69CE\u5BE8\u69CA\u69DD\u69BB\u69C3\u69A7\u6A2E\u6991\u69A0\u699C\u6995\u69B4\u69DE\u69E8\u6A02\u6A1B\u69FF\u6B0A\u69F9\u69F2\u69E7\u6A05\u69B1\u6A1E\u69ED\u6A14\u69EB\u6A0A\u6A12\u6AC1\u6A23\u6A13\u6A44\u6A0C\u6A72\u6A36\u6A78\u6A47\u6A62\u6A59\u6A66\u6A48\u6A38\u6A22\u6A90\u6A8D\u6AA0\u6A84\u6AA2\u6AA3"],["dda1","\u6A97\u8617\u6ABB\u6AC3\u6AC2\u6AB8\u6AB3\u6AAC\u6ADE\u6AD1\u6ADF\u6AAA\u6ADA\u6AEA\u6AFB\u6B05\u8616\u6AFA\u6B12\u6B16\u9B31\u6B1F\u6B38\u6B37\u76DC\u6B39\u98EE\u6B47\u6B43\u6B49\u6B50\u6B59\u6B54\u6B5B\u6B5F\u6B61\u6B78\u6B79\u6B7F\u6B80\u6B84\u6B83\u6B8D\u6B98\u6B95\u6B9E\u6BA4\u6BAA\u6BAB\u6BAF\u6BB2\u6BB1\u6BB3\u6BB7\u6BBC\u6BC6\u6BCB\u6BD3\u6BDF\u6BEC\u6BEB\u6BF3\u6BEF\u9EBE\u6C08\u6C13\u6C14\u6C1B\u6C24\u6C23\u6C5E\u6C55\u6C62\u6C6A\u6C82\u6C8D\u6C9A\u6C81\u6C9B\u6C7E\u6C68\u6C73\u6C92\u6C90\u6CC4\u6CF1\u6CD3\u6CBD\u6CD7\u6CC5\u6CDD\u6CAE\u6CB1\u6CBE"],["dea1","\u6CBA\u6CDB\u6CEF\u6CD9\u6CEA\u6D1F\u884D\u6D36\u6D2B\u6D3D\u6D38\u6D19\u6D35\u6D33\u6D12\u6D0C\u6D63\u6D93\u6D64\u6D5A\u6D79\u6D59\u6D8E\u6D95\u6FE4\u6D85\u6DF9\u6E15\u6E0A\u6DB5\u6DC7\u6DE6\u6DB8\u6DC6\u6DEC\u6DDE\u6DCC\u6DE8\u6DD2\u6DC5\u6DFA\u6DD9\u6DE4\u6DD5\u6DEA\u6DEE\u6E2D\u6E6E\u6E2E\u6E19\u6E72\u6E5F\u6E3E\u6E23\u6E6B\u6E2B\u6E76\u6E4D\u6E1F\u6E43\u6E3A\u6E4E\u6E24\u6EFF\u6E1D\u6E38\u6E82\u6EAA\u6E98\u6EC9\u6EB7\u6ED3\u6EBD\u6EAF\u6EC4\u6EB2\u6ED4\u6ED5\u6E8F\u6EA5\u6EC2\u6E9F\u6F41\u6F11\u704C\u6EEC\u6EF8\u6EFE\u6F3F\u6EF2\u6F31\u6EEF\u6F32\u6ECC"],["dfa1","\u6F3E\u6F13\u6EF7\u6F86\u6F7A\u6F78\u6F81\u6F80\u6F6F\u6F5B\u6FF3\u6F6D\u6F82\u6F7C\u6F58\u6F8E\u6F91\u6FC2\u6F66\u6FB3\u6FA3\u6FA1\u6FA4\u6FB9\u6FC6\u6FAA\u6FDF\u6FD5\u6FEC\u6FD4\u6FD8\u6FF1\u6FEE\u6FDB\u7009\u700B\u6FFA\u7011\u7001\u700F\u6FFE\u701B\u701A\u6F74\u701D\u7018\u701F\u7030\u703E\u7032\u7051\u7063\u7099\u7092\u70AF\u70F1\u70AC\u70B8\u70B3\u70AE\u70DF\u70CB\u70DD\u70D9\u7109\u70FD\u711C\u7119\u7165\u7155\u7188\u7166\u7162\u714C\u7156\u716C\u718F\u71FB\u7184\u7195\u71A8\u71AC\u71D7\u71B9\u71BE\u71D2\u71C9\u71D4\u71CE\u71E0\u71EC\u71E7\u71F5\u71FC"],["e0a1","\u71F9\u71FF\u720D\u7210\u721B\u7228\u722D\u722C\u7230\u7232\u723B\u723C\u723F\u7240\u7246\u724B\u7258\u7274\u727E\u7282\u7281\u7287\u7292\u7296\u72A2\u72A7\u72B9\u72B2\u72C3\u72C6\u72C4\u72CE\u72D2\u72E2\u72E0\u72E1\u72F9\u72F7\u500F\u7317\u730A\u731C\u7316\u731D\u7334\u732F\u7329\u7325\u733E\u734E\u734F\u9ED8\u7357\u736A\u7368\u7370\u7378\u7375\u737B\u737A\u73C8\u73B3\u73CE\u73BB\u73C0\u73E5\u73EE\u73DE\u74A2\u7405\u746F\u7425\u73F8\u7432\u743A\u7455\u743F\u745F\u7459\u7441\u745C\u7469\u7470\u7463\u746A\u7476\u747E\u748B\u749E\u74A7\u74CA\u74CF\u74D4\u73F1"],["e1a1","\u74E0\u74E3\u74E7\u74E9\u74EE\u74F2\u74F0\u74F1\u74F8\u74F7\u7504\u7503\u7505\u750C\u750E\u750D\u7515\u7513\u751E\u7526\u752C\u753C\u7544\u754D\u754A\u7549\u755B\u7546\u755A\u7569\u7564\u7567\u756B\u756D\u7578\u7576\u7586\u7587\u7574\u758A\u7589\u7582\u7594\u759A\u759D\u75A5\u75A3\u75C2\u75B3\u75C3\u75B5\u75BD\u75B8\u75BC\u75B1\u75CD\u75CA\u75D2\u75D9\u75E3\u75DE\u75FE\u75FF\u75FC\u7601\u75F0\u75FA\u75F2\u75F3\u760B\u760D\u7609\u761F\u7627\u7620\u7621\u7622\u7624\u7634\u7630\u763B\u7647\u7648\u7646\u765C\u7658\u7661\u7662\u7668\u7669\u766A\u7667\u766C\u7670"],["e2a1","\u7672\u7676\u7678\u767C\u7680\u7683\u7688\u768B\u768E\u7696\u7693\u7699\u769A\u76B0\u76B4\u76B8\u76B9\u76BA\u76C2\u76CD\u76D6\u76D2\u76DE\u76E1\u76E5\u76E7\u76EA\u862F\u76FB\u7708\u7707\u7704\u7729\u7724\u771E\u7725\u7726\u771B\u7737\u7738\u7747\u775A\u7768\u776B\u775B\u7765\u777F\u777E\u7779\u778E\u778B\u7791\u77A0\u779E\u77B0\u77B6\u77B9\u77BF\u77BC\u77BD\u77BB\u77C7\u77CD\u77D7\u77DA\u77DC\u77E3\u77EE\u77FC\u780C\u7812\u7926\u7820\u792A\u7845\u788E\u7874\u7886\u787C\u789A\u788C\u78A3\u78B5\u78AA\u78AF\u78D1\u78C6\u78CB\u78D4\u78BE\u78BC\u78C5\u78CA\u78EC"],["e3a1","\u78E7\u78DA\u78FD\u78F4\u7907\u7912\u7911\u7919\u792C\u792B\u7940\u7960\u7957\u795F\u795A\u7955\u7953\u797A\u797F\u798A\u799D\u79A7\u9F4B\u79AA\u79AE\u79B3\u79B9\u79BA\u79C9\u79D5\u79E7\u79EC\u79E1\u79E3\u7A08\u7A0D\u7A18\u7A19\u7A20\u7A1F\u7980\u7A31\u7A3B\u7A3E\u7A37\u7A43\u7A57\u7A49\u7A61\u7A62\u7A69\u9F9D\u7A70\u7A79\u7A7D\u7A88\u7A97\u7A95\u7A98\u7A96\u7AA9\u7AC8\u7AB0\u7AB6\u7AC5\u7AC4\u7ABF\u9083\u7AC7\u7ACA\u7ACD\u7ACF\u7AD5\u7AD3\u7AD9\u7ADA\u7ADD\u7AE1\u7AE2\u7AE6\u7AED\u7AF0\u7B02\u7B0F\u7B0A\u7B06\u7B33\u7B18\u7B19\u7B1E\u7B35\u7B28\u7B36\u7B50"],["e4a1","\u7B7A\u7B04\u7B4D\u7B0B\u7B4C\u7B45\u7B75\u7B65\u7B74\u7B67\u7B70\u7B71\u7B6C\u7B6E\u7B9D\u7B98\u7B9F\u7B8D\u7B9C\u7B9A\u7B8B\u7B92\u7B8F\u7B5D\u7B99\u7BCB\u7BC1\u7BCC\u7BCF\u7BB4\u7BC6\u7BDD\u7BE9\u7C11\u7C14\u7BE6\u7BE5\u7C60\u7C00\u7C07\u7C13\u7BF3\u7BF7\u7C17\u7C0D\u7BF6\u7C23\u7C27\u7C2A\u7C1F\u7C37\u7C2B\u7C3D\u7C4C\u7C43\u7C54\u7C4F\u7C40\u7C50\u7C58\u7C5F\u7C64\u7C56\u7C65\u7C6C\u7C75\u7C83\u7C90\u7CA4\u7CAD\u7CA2\u7CAB\u7CA1\u7CA8\u7CB3\u7CB2\u7CB1\u7CAE\u7CB9\u7CBD\u7CC0\u7CC5\u7CC2\u7CD8\u7CD2\u7CDC\u7CE2\u9B3B\u7CEF\u7CF2\u7CF4\u7CF6\u7CFA\u7D06"],["e5a1","\u7D02\u7D1C\u7D15\u7D0A\u7D45\u7D4B\u7D2E\u7D32\u7D3F\u7D35\u7D46\u7D73\u7D56\u7D4E\u7D72\u7D68\u7D6E\u7D4F\u7D63\u7D93\u7D89\u7D5B\u7D8F\u7D7D\u7D9B\u7DBA\u7DAE\u7DA3\u7DB5\u7DC7\u7DBD\u7DAB\u7E3D\u7DA2\u7DAF\u7DDC\u7DB8\u7D9F\u7DB0\u7DD8\u7DDD\u7DE4\u7DDE\u7DFB\u7DF2\u7DE1\u7E05\u7E0A\u7E23\u7E21\u7E12\u7E31\u7E1F\u7E09\u7E0B\u7E22\u7E46\u7E66\u7E3B\u7E35\u7E39\u7E43\u7E37\u7E32\u7E3A\u7E67\u7E5D\u7E56\u7E5E\u7E59\u7E5A\u7E79\u7E6A\u7E69\u7E7C\u7E7B\u7E83\u7DD5\u7E7D\u8FAE\u7E7F\u7E88\u7E89\u7E8C\u7E92\u7E90\u7E93\u7E94\u7E96\u7E8E\u7E9B\u7E9C\u7F38\u7F3A"],["e6a1","\u7F45\u7F4C\u7F4D\u7F4E\u7F50\u7F51\u7F55\u7F54\u7F58\u7F5F\u7F60\u7F68\u7F69\u7F67\u7F78\u7F82\u7F86\u7F83\u7F88\u7F87\u7F8C\u7F94\u7F9E\u7F9D\u7F9A\u7FA3\u7FAF\u7FB2\u7FB9\u7FAE\u7FB6\u7FB8\u8B71\u7FC5\u7FC6\u7FCA\u7FD5\u7FD4\u7FE1\u7FE6\u7FE9\u7FF3\u7FF9\u98DC\u8006\u8004\u800B\u8012\u8018\u8019\u801C\u8021\u8028\u803F\u803B\u804A\u8046\u8052\u8058\u805A\u805F\u8062\u8068\u8073\u8072\u8070\u8076\u8079\u807D\u807F\u8084\u8086\u8085\u809B\u8093\u809A\u80AD\u5190\u80AC\u80DB\u80E5\u80D9\u80DD\u80C4\u80DA\u80D6\u8109\u80EF\u80F1\u811B\u8129\u8123\u812F\u814B"],["e7a1","\u968B\u8146\u813E\u8153\u8151\u80FC\u8171\u816E\u8165\u8166\u8174\u8183\u8188\u818A\u8180\u8182\u81A0\u8195\u81A4\u81A3\u815F\u8193\u81A9\u81B0\u81B5\u81BE\u81B8\u81BD\u81C0\u81C2\u81BA\u81C9\u81CD\u81D1\u81D9\u81D8\u81C8\u81DA\u81DF\u81E0\u81E7\u81FA\u81FB\u81FE\u8201\u8202\u8205\u8207\u820A\u820D\u8210\u8216\u8229\u822B\u8238\u8233\u8240\u8259\u8258\u825D\u825A\u825F\u8264\u8262\u8268\u826A\u826B\u822E\u8271\u8277\u8278\u827E\u828D\u8292\u82AB\u829F\u82BB\u82AC\u82E1\u82E3\u82DF\u82D2\u82F4\u82F3\u82FA\u8393\u8303\u82FB\u82F9\u82DE\u8306\u82DC\u8309\u82D9"],["e8a1","\u8335\u8334\u8316\u8332\u8331\u8340\u8339\u8350\u8345\u832F\u832B\u8317\u8318\u8385\u839A\u83AA\u839F\u83A2\u8396\u8323\u838E\u8387\u838A\u837C\u83B5\u8373\u8375\u83A0\u8389\u83A8\u83F4\u8413\u83EB\u83CE\u83FD\u8403\u83D8\u840B\u83C1\u83F7\u8407\u83E0\u83F2\u840D\u8422\u8420\u83BD\u8438\u8506\u83FB\u846D\u842A\u843C\u855A\u8484\u8477\u846B\u84AD\u846E\u8482\u8469\u8446\u842C\u846F\u8479\u8435\u84CA\u8462\u84B9\u84BF\u849F\u84D9\u84CD\u84BB\u84DA\u84D0\u84C1\u84C6\u84D6\u84A1\u8521\u84FF\u84F4\u8517\u8518\u852C\u851F\u8515\u8514\u84FC\u8540\u8563\u8558\u8548"],["e9a1","\u8541\u8602\u854B\u8555\u8580\u85A4\u8588\u8591\u858A\u85A8\u856D\u8594\u859B\u85EA\u8587\u859C\u8577\u857E\u8590\u85C9\u85BA\u85CF\u85B9\u85D0\u85D5\u85DD\u85E5\u85DC\u85F9\u860A\u8613\u860B\u85FE\u85FA\u8606\u8622\u861A\u8630\u863F\u864D\u4E55\u8654\u865F\u8667\u8671\u8693\u86A3\u86A9\u86AA\u868B\u868C\u86B6\u86AF\u86C4\u86C6\u86B0\u86C9\u8823\u86AB\u86D4\u86DE\u86E9\u86EC\u86DF\u86DB\u86EF\u8712\u8706\u8708\u8700\u8703\u86FB\u8711\u8709\u870D\u86F9\u870A\u8734\u873F\u8737\u873B\u8725\u8729\u871A\u8760\u875F\u8778\u874C\u874E\u8774\u8757\u8768\u876E\u8759"],["eaa1","\u8753\u8763\u876A\u8805\u87A2\u879F\u8782\u87AF\u87CB\u87BD\u87C0\u87D0\u96D6\u87AB\u87C4\u87B3\u87C7\u87C6\u87BB\u87EF\u87F2\u87E0\u880F\u880D\u87FE\u87F6\u87F7\u880E\u87D2\u8811\u8816\u8815\u8822\u8821\u8831\u8836\u8839\u8827\u883B\u8844\u8842\u8852\u8859\u885E\u8862\u886B\u8881\u887E\u889E\u8875\u887D\u88B5\u8872\u8882\u8897\u8892\u88AE\u8899\u88A2\u888D\u88A4\u88B0\u88BF\u88B1\u88C3\u88C4\u88D4\u88D8\u88D9\u88DD\u88F9\u8902\u88FC\u88F4\u88E8\u88F2\u8904\u890C\u890A\u8913\u8943\u891E\u8925\u892A\u892B\u8941\u8944\u893B\u8936\u8938\u894C\u891D\u8960\u895E"],["eba1","\u8966\u8964\u896D\u896A\u896F\u8974\u8977\u897E\u8983\u8988\u898A\u8993\u8998\u89A1\u89A9\u89A6\u89AC\u89AF\u89B2\u89BA\u89BD\u89BF\u89C0\u89DA\u89DC\u89DD\u89E7\u89F4\u89F8\u8A03\u8A16\u8A10\u8A0C\u8A1B\u8A1D\u8A25\u8A36\u8A41\u8A5B\u8A52\u8A46\u8A48\u8A7C\u8A6D\u8A6C\u8A62\u8A85\u8A82\u8A84\u8AA8\u8AA1\u8A91\u8AA5\u8AA6\u8A9A\u8AA3\u8AC4\u8ACD\u8AC2\u8ADA\u8AEB\u8AF3\u8AE7\u8AE4\u8AF1\u8B14\u8AE0\u8AE2\u8AF7\u8ADE\u8ADB\u8B0C\u8B07\u8B1A\u8AE1\u8B16\u8B10\u8B17\u8B20\u8B33\u97AB\u8B26\u8B2B\u8B3E\u8B28\u8B41\u8B4C\u8B4F\u8B4E\u8B49\u8B56\u8B5B\u8B5A\u8B6B"],["eca1","\u8B5F\u8B6C\u8B6F\u8B74\u8B7D\u8B80\u8B8C\u8B8E\u8B92\u8B93\u8B96\u8B99\u8B9A\u8C3A\u8C41\u8C3F\u8C48\u8C4C\u8C4E\u8C50\u8C55\u8C62\u8C6C\u8C78\u8C7A\u8C82\u8C89\u8C85\u8C8A\u8C8D\u8C8E\u8C94\u8C7C\u8C98\u621D\u8CAD\u8CAA\u8CBD\u8CB2\u8CB3\u8CAE\u8CB6\u8CC8\u8CC1\u8CE4\u8CE3\u8CDA\u8CFD\u8CFA\u8CFB\u8D04\u8D05\u8D0A\u8D07\u8D0F\u8D0D\u8D10\u9F4E\u8D13\u8CCD\u8D14\u8D16\u8D67\u8D6D\u8D71\u8D73\u8D81\u8D99\u8DC2\u8DBE\u8DBA\u8DCF\u8DDA\u8DD6\u8DCC\u8DDB\u8DCB\u8DEA\u8DEB\u8DDF\u8DE3\u8DFC\u8E08\u8E09\u8DFF\u8E1D\u8E1E\u8E10\u8E1F\u8E42\u8E35\u8E30\u8E34\u8E4A"],["eda1","\u8E47\u8E49\u8E4C\u8E50\u8E48\u8E59\u8E64\u8E60\u8E2A\u8E63\u8E55\u8E76\u8E72\u8E7C\u8E81\u8E87\u8E85\u8E84\u8E8B\u8E8A\u8E93\u8E91\u8E94\u8E99\u8EAA\u8EA1\u8EAC\u8EB0\u8EC6\u8EB1\u8EBE\u8EC5\u8EC8\u8ECB\u8EDB\u8EE3\u8EFC\u8EFB\u8EEB\u8EFE\u8F0A\u8F05\u8F15\u8F12\u8F19\u8F13\u8F1C\u8F1F\u8F1B\u8F0C\u8F26\u8F33\u8F3B\u8F39\u8F45\u8F42\u8F3E\u8F4C\u8F49\u8F46\u8F4E\u8F57\u8F5C\u8F62\u8F63\u8F64\u8F9C\u8F9F\u8FA3\u8FAD\u8FAF\u8FB7\u8FDA\u8FE5\u8FE2\u8FEA\u8FEF\u9087\u8FF4\u9005\u8FF9\u8FFA\u9011\u9015\u9021\u900D\u901E\u9016\u900B\u9027\u9036\u9035\u9039\u8FF8"],["eea1","\u904F\u9050\u9051\u9052\u900E\u9049\u903E\u9056\u9058\u905E\u9068\u906F\u9076\u96A8\u9072\u9082\u907D\u9081\u9080\u908A\u9089\u908F\u90A8\u90AF\u90B1\u90B5\u90E2\u90E4\u6248\u90DB\u9102\u9112\u9119\u9132\u9130\u914A\u9156\u9158\u9163\u9165\u9169\u9173\u9172\u918B\u9189\u9182\u91A2\u91AB\u91AF\u91AA\u91B5\u91B4\u91BA\u91C0\u91C1\u91C9\u91CB\u91D0\u91D6\u91DF\u91E1\u91DB\u91FC\u91F5\u91F6\u921E\u91FF\u9214\u922C\u9215\u9211\u925E\u9257\u9245\u9249\u9264\u9248\u9295\u923F\u924B\u9250\u929C\u9296\u9293\u929B\u925A\u92CF\u92B9\u92B7\u92E9\u930F\u92FA\u9344\u932E"],["efa1","\u9319\u9322\u931A\u9323\u933A\u9335\u933B\u935C\u9360\u937C\u936E\u9356\u93B0\u93AC\u93AD\u9394\u93B9\u93D6\u93D7\u93E8\u93E5\u93D8\u93C3\u93DD\u93D0\u93C8\u93E4\u941A\u9414\u9413\u9403\u9407\u9410\u9436\u942B\u9435\u9421\u943A\u9441\u9452\u9444\u945B\u9460\u9462\u945E\u946A\u9229\u9470\u9475\u9477\u947D\u945A\u947C\u947E\u9481\u947F\u9582\u9587\u958A\u9594\u9596\u9598\u9599\u95A0\u95A8\u95A7\u95AD\u95BC\u95BB\u95B9\u95BE\u95CA\u6FF6\u95C3\u95CD\u95CC\u95D5\u95D4\u95D6\u95DC\u95E1\u95E5\u95E2\u9621\u9628\u962E\u962F\u9642\u964C\u964F\u964B\u9677\u965C\u965E"],["f0a1","\u965D\u965F\u9666\u9672\u966C\u968D\u9698\u9695\u9697\u96AA\u96A7\u96B1\u96B2\u96B0\u96B4\u96B6\u96B8\u96B9\u96CE\u96CB\u96C9\u96CD\u894D\u96DC\u970D\u96D5\u96F9\u9704\u9706\u9708\u9713\u970E\u9711\u970F\u9716\u9719\u9724\u972A\u9730\u9739\u973D\u973E\u9744\u9746\u9748\u9742\u9749\u975C\u9760\u9764\u9766\u9768\u52D2\u976B\u9771\u9779\u9785\u977C\u9781\u977A\u9786\u978B\u978F\u9790\u979C\u97A8\u97A6\u97A3\u97B3\u97B4\u97C3\u97C6\u97C8\u97CB\u97DC\u97ED\u9F4F\u97F2\u7ADF\u97F6\u97F5\u980F\u980C\u9838\u9824\u9821\u9837\u983D\u9846\u984F\u984B\u986B\u986F\u9870"],["f1a1","\u9871\u9874\u9873\u98AA\u98AF\u98B1\u98B6\u98C4\u98C3\u98C6\u98E9\u98EB\u9903\u9909\u9912\u9914\u9918\u9921\u991D\u991E\u9924\u9920\u992C\u992E\u993D\u993E\u9942\u9949\u9945\u9950\u994B\u9951\u9952\u994C\u9955\u9997\u9998\u99A5\u99AD\u99AE\u99BC\u99DF\u99DB\u99DD\u99D8\u99D1\u99ED\u99EE\u99F1\u99F2\u99FB\u99F8\u9A01\u9A0F\u9A05\u99E2\u9A19\u9A2B\u9A37\u9A45\u9A42\u9A40\u9A43\u9A3E\u9A55\u9A4D\u9A5B\u9A57\u9A5F\u9A62\u9A65\u9A64\u9A69\u9A6B\u9A6A\u9AAD\u9AB0\u9ABC\u9AC0\u9ACF\u9AD1\u9AD3\u9AD4\u9ADE\u9ADF\u9AE2\u9AE3\u9AE6\u9AEF\u9AEB\u9AEE\u9AF4\u9AF1\u9AF7"],["f2a1","\u9AFB\u9B06\u9B18\u9B1A\u9B1F\u9B22\u9B23\u9B25\u9B27\u9B28\u9B29\u9B2A\u9B2E\u9B2F\u9B32\u9B44\u9B43\u9B4F\u9B4D\u9B4E\u9B51\u9B58\u9B74\u9B93\u9B83\u9B91\u9B96\u9B97\u9B9F\u9BA0\u9BA8\u9BB4\u9BC0\u9BCA\u9BB9\u9BC6\u9BCF\u9BD1\u9BD2\u9BE3\u9BE2\u9BE4\u9BD4\u9BE1\u9C3A\u9BF2\u9BF1\u9BF0\u9C15\u9C14\u9C09\u9C13\u9C0C\u9C06\u9C08\u9C12\u9C0A\u9C04\u9C2E\u9C1B\u9C25\u9C24\u9C21\u9C30\u9C47\u9C32\u9C46\u9C3E\u9C5A\u9C60\u9C67\u9C76\u9C78\u9CE7\u9CEC\u9CF0\u9D09\u9D08\u9CEB\u9D03\u9D06\u9D2A\u9D26\u9DAF\u9D23\u9D1F\u9D44\u9D15\u9D12\u9D41\u9D3F\u9D3E\u9D46\u9D48"],["f3a1","\u9D5D\u9D5E\u9D64\u9D51\u9D50\u9D59\u9D72\u9D89\u9D87\u9DAB\u9D6F\u9D7A\u9D9A\u9DA4\u9DA9\u9DB2\u9DC4\u9DC1\u9DBB\u9DB8\u9DBA\u9DC6\u9DCF\u9DC2\u9DD9\u9DD3\u9DF8\u9DE6\u9DED\u9DEF\u9DFD\u9E1A\u9E1B\u9E1E\u9E75\u9E79\u9E7D\u9E81\u9E88\u9E8B\u9E8C\u9E92\u9E95\u9E91\u9E9D\u9EA5\u9EA9\u9EB8\u9EAA\u9EAD\u9761\u9ECC\u9ECE\u9ECF\u9ED0\u9ED4\u9EDC\u9EDE\u9EDD\u9EE0\u9EE5\u9EE8\u9EEF\u9EF4\u9EF6\u9EF7\u9EF9\u9EFB\u9EFC\u9EFD\u9F07\u9F08\u76B7\u9F15\u9F21\u9F2C\u9F3E\u9F4A\u9F52\u9F54\u9F63\u9F5F\u9F60\u9F61\u9F66\u9F67\u9F6C\u9F6A\u9F77\u9F72\u9F76\u9F95\u9F9C\u9FA0"],["f4a1","\u582F\u69C7\u9059\u7464\u51DC\u7199"],["f9a1","\u7E8A\u891C\u9348\u9288\u84DC\u4FC9\u70BB\u6631\u68C8\u92F9\u66FB\u5F45\u4E28\u4EE1\u4EFC\u4F00\u4F03\u4F39\u4F56\u4F92\u4F8A\u4F9A\u4F94\u4FCD\u5040\u5022\u4FFF\u501E\u5046\u5070\u5042\u5094\u50F4\u50D8\u514A\u5164\u519D\u51BE\u51EC\u5215\u529C\u52A6\u52C0\u52DB\u5300\u5307\u5324\u5372\u5393\u53B2\u53DD\uFA0E\u549C\u548A\u54A9\u54FF\u5586\u5759\u5765\u57AC\u57C8\u57C7\uFA0F\uFA10\u589E\u58B2\u590B\u5953\u595B\u595D\u5963\u59A4\u59BA\u5B56\u5BC0\u752F\u5BD8\u5BEC\u5C1E\u5CA6\u5CBA\u5CF5\u5D27\u5D53\uFA11\u5D42\u5D6D\u5DB8\u5DB9\u5DD0\u5F21\u5F34\u5F67\u5FB7"],["faa1","\u5FDE\u605D\u6085\u608A\u60DE\u60D5\u6120\u60F2\u6111\u6137\u6130\u6198\u6213\u62A6\u63F5\u6460\u649D\u64CE\u654E\u6600\u6615\u663B\u6609\u662E\u661E\u6624\u6665\u6657\u6659\uFA12\u6673\u6699\u66A0\u66B2\u66BF\u66FA\u670E\uF929\u6766\u67BB\u6852\u67C0\u6801\u6844\u68CF\uFA13\u6968\uFA14\u6998\u69E2\u6A30\u6A6B\u6A46\u6A73\u6A7E\u6AE2\u6AE4\u6BD6\u6C3F\u6C5C\u6C86\u6C6F\u6CDA\u6D04\u6D87\u6D6F\u6D96\u6DAC\u6DCF\u6DF8\u6DF2\u6DFC\u6E39\u6E5C\u6E27\u6E3C\u6EBF\u6F88\u6FB5\u6FF5\u7005\u7007\u7028\u7085\u70AB\u710F\u7104\u715C\u7146\u7147\uFA15\u71C1\u71FE\u72B1"],["fba1","\u72BE\u7324\uFA16\u7377\u73BD\u73C9\u73D6\u73E3\u73D2\u7407\u73F5\u7426\u742A\u7429\u742E\u7462\u7489\u749F\u7501\u756F\u7682\u769C\u769E\u769B\u76A6\uFA17\u7746\u52AF\u7821\u784E\u7864\u787A\u7930\uFA18\uFA19\uFA1A\u7994\uFA1B\u799B\u7AD1\u7AE7\uFA1C\u7AEB\u7B9E\uFA1D\u7D48\u7D5C\u7DB7\u7DA0\u7DD6\u7E52\u7F47\u7FA1\uFA1E\u8301\u8362\u837F\u83C7\u83F6\u8448\u84B4\u8553\u8559\u856B\uFA1F\u85B0\uFA20\uFA21\u8807\u88F5\u8A12\u8A37\u8A79\u8AA7\u8ABE\u8ADF\uFA22\u8AF6\u8B53\u8B7F\u8CF0\u8CF4\u8D12\u8D76\uFA23\u8ECF\uFA24\uFA25\u9067\u90DE\uFA26\u9115\u9127\u91DA"],["fca1","\u91D7\u91DE\u91ED\u91EE\u91E4\u91E5\u9206\u9210\u920A\u923A\u9240\u923C\u924E\u9259\u9251\u9239\u9267\u92A7\u9277\u9278\u92E7\u92D7\u92D9\u92D0\uFA27\u92D5\u92E0\u92D3\u9325\u9321\u92FB\uFA28\u931E\u92FF\u931D\u9302\u9370\u9357\u93A4\u93C6\u93DE\u93F8\u9431\u9445\u9448\u9592\uF9DC\uFA29\u969D\u96AF\u9733\u973B\u9743\u974D\u974F\u9751\u9755\u9857\u9865\uFA2A\uFA2B\u9927\uFA2C\u999E\u9A4E\u9AD9\u9ADC\u9B75\u9B72\u9B8F\u9BB1\u9BBB\u9C00\u9D70\u9D6B\uFA2D\u9E19\u9ED1"],["fcf1","\u2170",9,"\uFFE2\uFFE4\uFF07\uFF02"],["8fa2af","\u02D8\u02C7\xB8\u02D9\u02DD\xAF\u02DB\u02DA\uFF5E\u0384\u0385"],["8fa2c2","\xA1\xA6\xBF"],["8fa2eb","\xBA\xAA\xA9\xAE\u2122\xA4\u2116"],["8fa6e1","\u0386\u0388\u0389\u038A\u03AA"],["8fa6e7","\u038C"],["8fa6e9","\u038E\u03AB"],["8fa6ec","\u038F"],["8fa6f1","\u03AC\u03AD\u03AE\u03AF\u03CA\u0390\u03CC\u03C2\u03CD\u03CB\u03B0\u03CE"],["8fa7c2","\u0402",10,"\u040E\u040F"],["8fa7f2","\u0452",10,"\u045E\u045F"],["8fa9a1","\xC6\u0110"],["8fa9a4","\u0126"],["8fa9a6","\u0132"],["8fa9a8","\u0141\u013F"],["8fa9ab","\u014A\xD8\u0152"],["8fa9af","\u0166\xDE"],["8fa9c1","\xE6\u0111\xF0\u0127\u0131\u0133\u0138\u0142\u0140\u0149\u014B\xF8\u0153\xDF\u0167\xFE"],["8faaa1","\xC1\xC0\xC4\xC2\u0102\u01CD\u0100\u0104\xC5\xC3\u0106\u0108\u010C\xC7\u010A\u010E\xC9\xC8\xCB\xCA\u011A\u0116\u0112\u0118"],["8faaba","\u011C\u011E\u0122\u0120\u0124\xCD\xCC\xCF\xCE\u01CF\u0130\u012A\u012E\u0128\u0134\u0136\u0139\u013D\u013B\u0143\u0147\u0145\xD1\xD3\xD2\xD6\xD4\u01D1\u0150\u014C\xD5\u0154\u0158\u0156\u015A\u015C\u0160\u015E\u0164\u0162\xDA\xD9\xDC\xDB\u016C\u01D3\u0170\u016A\u0172\u016E\u0168\u01D7\u01DB\u01D9\u01D5\u0174\xDD\u0178\u0176\u0179\u017D\u017B"],["8faba1","\xE1\xE0\xE4\xE2\u0103\u01CE\u0101\u0105\xE5\xE3\u0107\u0109\u010D\xE7\u010B\u010F\xE9\xE8\xEB\xEA\u011B\u0117\u0113\u0119\u01F5\u011D\u011F"],["8fabbd","\u0121\u0125\xED\xEC\xEF\xEE\u01D0"],["8fabc5","\u012B\u012F\u0129\u0135\u0137\u013A\u013E\u013C\u0144\u0148\u0146\xF1\xF3\xF2\xF6\xF4\u01D2\u0151\u014D\xF5\u0155\u0159\u0157\u015B\u015D\u0161\u015F\u0165\u0163\xFA\xF9\xFC\xFB\u016D\u01D4\u0171\u016B\u0173\u016F\u0169\u01D8\u01DC\u01DA\u01D6\u0175\xFD\xFF\u0177\u017A\u017E\u017C"],["8fb0a1","\u4E02\u4E04\u4E05\u4E0C\u4E12\u4E1F\u4E23\u4E24\u4E28\u4E2B\u4E2E\u4E2F\u4E30\u4E35\u4E40\u4E41\u4E44\u4E47\u4E51\u4E5A\u4E5C\u4E63\u4E68\u4E69\u4E74\u4E75\u4E79\u4E7F\u4E8D\u4E96\u4E97\u4E9D\u4EAF\u4EB9\u4EC3\u4ED0\u4EDA\u4EDB\u4EE0\u4EE1\u4EE2\u4EE8\u4EEF\u4EF1\u4EF3\u4EF5\u4EFD\u4EFE\u4EFF\u4F00\u4F02\u4F03\u4F08\u4F0B\u4F0C\u4F12\u4F15\u4F16\u4F17\u4F19\u4F2E\u4F31\u4F60\u4F33\u4F35\u4F37\u4F39\u4F3B\u4F3E\u4F40\u4F42\u4F48\u4F49\u4F4B\u4F4C\u4F52\u4F54\u4F56\u4F58\u4F5F\u4F63\u4F6A\u4F6C\u4F6E\u4F71\u4F77\u4F78\u4F79\u4F7A\u4F7D\u4F7E\u4F81\u4F82\u4F84"],["8fb1a1","\u4F85\u4F89\u4F8A\u4F8C\u4F8E\u4F90\u4F92\u4F93\u4F94\u4F97\u4F99\u4F9A\u4F9E\u4F9F\u4FB2\u4FB7\u4FB9\u4FBB\u4FBC\u4FBD\u4FBE\u4FC0\u4FC1\u4FC5\u4FC6\u4FC8\u4FC9\u4FCB\u4FCC\u4FCD\u4FCF\u4FD2\u4FDC\u4FE0\u4FE2\u4FF0\u4FF2\u4FFC\u4FFD\u4FFF\u5000\u5001\u5004\u5007\u500A\u500C\u500E\u5010\u5013\u5017\u5018\u501B\u501C\u501D\u501E\u5022\u5027\u502E\u5030\u5032\u5033\u5035\u5040\u5041\u5042\u5045\u5046\u504A\u504C\u504E\u5051\u5052\u5053\u5057\u5059\u505F\u5060\u5062\u5063\u5066\u5067\u506A\u506D\u5070\u5071\u503B\u5081\u5083\u5084\u5086\u508A\u508E\u508F\u5090"],["8fb2a1","\u5092\u5093\u5094\u5096\u509B\u509C\u509E",4,"\u50AA\u50AF\u50B0\u50B9\u50BA\u50BD\u50C0\u50C3\u50C4\u50C7\u50CC\u50CE\u50D0\u50D3\u50D4\u50D8\u50DC\u50DD\u50DF\u50E2\u50E4\u50E6\u50E8\u50E9\u50EF\u50F1\u50F6\u50FA\u50FE\u5103\u5106\u5107\u5108\u510B\u510C\u510D\u510E\u50F2\u5110\u5117\u5119\u511B\u511C\u511D\u511E\u5123\u5127\u5128\u512C\u512D\u512F\u5131\u5133\u5134\u5135\u5138\u5139\u5142\u514A\u514F\u5153\u5155\u5157\u5158\u515F\u5164\u5166\u517E\u5183\u5184\u518B\u518E\u5198\u519D\u51A1\u51A3\u51AD\u51B8\u51BA\u51BC\u51BE\u51BF\u51C2"],["8fb3a1","\u51C8\u51CF\u51D1\u51D2\u51D3\u51D5\u51D8\u51DE\u51E2\u51E5\u51EE\u51F2\u51F3\u51F4\u51F7\u5201\u5202\u5205\u5212\u5213\u5215\u5216\u5218\u5222\u5228\u5231\u5232\u5235\u523C\u5245\u5249\u5255\u5257\u5258\u525A\u525C\u525F\u5260\u5261\u5266\u526E\u5277\u5278\u5279\u5280\u5282\u5285\u528A\u528C\u5293\u5295\u5296\u5297\u5298\u529A\u529C\u52A4\u52A5\u52A6\u52A7\u52AF\u52B0\u52B6\u52B7\u52B8\u52BA\u52BB\u52BD\u52C0\u52C4\u52C6\u52C8\u52CC\u52CF\u52D1\u52D4\u52D6\u52DB\u52DC\u52E1\u52E5\u52E8\u52E9\u52EA\u52EC\u52F0\u52F1\u52F4\u52F6\u52F7\u5300\u5303\u530A\u530B"],["8fb4a1","\u530C\u5311\u5313\u5318\u531B\u531C\u531E\u531F\u5325\u5327\u5328\u5329\u532B\u532C\u532D\u5330\u5332\u5335\u533C\u533D\u533E\u5342\u534C\u534B\u5359\u535B\u5361\u5363\u5365\u536C\u536D\u5372\u5379\u537E\u5383\u5387\u5388\u538E\u5393\u5394\u5399\u539D\u53A1\u53A4\u53AA\u53AB\u53AF\u53B2\u53B4\u53B5\u53B7\u53B8\u53BA\u53BD\u53C0\u53C5\u53CF\u53D2\u53D3\u53D5\u53DA\u53DD\u53DE\u53E0\u53E6\u53E7\u53F5\u5402\u5413\u541A\u5421\u5427\u5428\u542A\u542F\u5431\u5434\u5435\u5443\u5444\u5447\u544D\u544F\u545E\u5462\u5464\u5466\u5467\u5469\u546B\u546D\u546E\u5474\u547F"],["8fb5a1","\u5481\u5483\u5485\u5488\u5489\u548D\u5491\u5495\u5496\u549C\u549F\u54A1\u54A6\u54A7\u54A9\u54AA\u54AD\u54AE\u54B1\u54B7\u54B9\u54BA\u54BB\u54BF\u54C6\u54CA\u54CD\u54CE\u54E0\u54EA\u54EC\u54EF\u54F6\u54FC\u54FE\u54FF\u5500\u5501\u5505\u5508\u5509\u550C\u550D\u550E\u5515\u552A\u552B\u5532\u5535\u5536\u553B\u553C\u553D\u5541\u5547\u5549\u554A\u554D\u5550\u5551\u5558\u555A\u555B\u555E\u5560\u5561\u5564\u5566\u557F\u5581\u5582\u5586\u5588\u558E\u558F\u5591\u5592\u5593\u5594\u5597\u55A3\u55A4\u55AD\u55B2\u55BF\u55C1\u55C3\u55C6\u55C9\u55CB\u55CC\u55CE\u55D1\u55D2"],["8fb6a1","\u55D3\u55D7\u55D8\u55DB\u55DE\u55E2\u55E9\u55F6\u55FF\u5605\u5608\u560A\u560D",5,"\u5619\u562C\u5630\u5633\u5635\u5637\u5639\u563B\u563C\u563D\u563F\u5640\u5641\u5643\u5644\u5646\u5649\u564B\u564D\u564F\u5654\u565E\u5660\u5661\u5662\u5663\u5666\u5669\u566D\u566F\u5671\u5672\u5675\u5684\u5685\u5688\u568B\u568C\u5695\u5699\u569A\u569D\u569E\u569F\u56A6\u56A7\u56A8\u56A9\u56AB\u56AC\u56AD\u56B1\u56B3\u56B7\u56BE\u56C5\u56C9\u56CA\u56CB\u56CF\u56D0\u56CC\u56CD\u56D9\u56DC\u56DD\u56DF\u56E1\u56E4",4,"\u56F1\u56EB\u56ED"],["8fb7a1","\u56F6\u56F7\u5701\u5702\u5707\u570A\u570C\u5711\u5715\u571A\u571B\u571D\u5720\u5722\u5723\u5724\u5725\u5729\u572A\u572C\u572E\u572F\u5733\u5734\u573D\u573E\u573F\u5745\u5746\u574C\u574D\u5752\u5762\u5765\u5767\u5768\u576B\u576D",4,"\u5773\u5774\u5775\u5777\u5779\u577A\u577B\u577C\u577E\u5781\u5783\u578C\u5794\u5797\u5799\u579A\u579C\u579D\u579E\u579F\u57A1\u5795\u57A7\u57A8\u57A9\u57AC\u57B8\u57BD\u57C7\u57C8\u57CC\u57CF\u57D5\u57DD\u57DE\u57E4\u57E6\u57E7\u57E9\u57ED\u57F0\u57F5\u57F6\u57F8\u57FD\u57FE\u57FF\u5803\u5804\u5808\u5809\u57E1"],["8fb8a1","\u580C\u580D\u581B\u581E\u581F\u5820\u5826\u5827\u582D\u5832\u5839\u583F\u5849\u584C\u584D\u584F\u5850\u5855\u585F\u5861\u5864\u5867\u5868\u5878\u587C\u587F\u5880\u5881\u5887\u5888\u5889\u588A\u588C\u588D\u588F\u5890\u5894\u5896\u589D\u58A0\u58A1\u58A2\u58A6\u58A9\u58B1\u58B2\u58C4\u58BC\u58C2\u58C8\u58CD\u58CE\u58D0\u58D2\u58D4\u58D6\u58DA\u58DD\u58E1\u58E2\u58E9\u58F3\u5905\u5906\u590B\u590C\u5912\u5913\u5914\u8641\u591D\u5921\u5923\u5924\u5928\u592F\u5930\u5933\u5935\u5936\u593F\u5943\u5946\u5952\u5953\u5959\u595B\u595D\u595E\u595F\u5961\u5963\u596B\u596D"],["8fb9a1","\u596F\u5972\u5975\u5976\u5979\u597B\u597C\u598B\u598C\u598E\u5992\u5995\u5997\u599F\u59A4\u59A7\u59AD\u59AE\u59AF\u59B0\u59B3\u59B7\u59BA\u59BC\u59C1\u59C3\u59C4\u59C8\u59CA\u59CD\u59D2\u59DD\u59DE\u59DF\u59E3\u59E4\u59E7\u59EE\u59EF\u59F1\u59F2\u59F4\u59F7\u5A00\u5A04\u5A0C\u5A0D\u5A0E\u5A12\u5A13\u5A1E\u5A23\u5A24\u5A27\u5A28\u5A2A\u5A2D\u5A30\u5A44\u5A45\u5A47\u5A48\u5A4C\u5A50\u5A55\u5A5E\u5A63\u5A65\u5A67\u5A6D\u5A77\u5A7A\u5A7B\u5A7E\u5A8B\u5A90\u5A93\u5A96\u5A99\u5A9C\u5A9E\u5A9F\u5AA0\u5AA2\u5AA7\u5AAC\u5AB1\u5AB2\u5AB3\u5AB5\u5AB8\u5ABA\u5ABB\u5ABF"],["8fbaa1","\u5AC4\u5AC6\u5AC8\u5ACF\u5ADA\u5ADC\u5AE0\u5AE5\u5AEA\u5AEE\u5AF5\u5AF6\u5AFD\u5B00\u5B01\u5B08\u5B17\u5B34\u5B19\u5B1B\u5B1D\u5B21\u5B25\u5B2D\u5B38\u5B41\u5B4B\u5B4C\u5B52\u5B56\u5B5E\u5B68\u5B6E\u5B6F\u5B7C\u5B7D\u5B7E\u5B7F\u5B81\u5B84\u5B86\u5B8A\u5B8E\u5B90\u5B91\u5B93\u5B94\u5B96\u5BA8\u5BA9\u5BAC\u5BAD\u5BAF\u5BB1\u5BB2\u5BB7\u5BBA\u5BBC\u5BC0\u5BC1\u5BCD\u5BCF\u5BD6",4,"\u5BE0\u5BEF\u5BF1\u5BF4\u5BFD\u5C0C\u5C17\u5C1E\u5C1F\u5C23\u5C26\u5C29\u5C2B\u5C2C\u5C2E\u5C30\u5C32\u5C35\u5C36\u5C59\u5C5A\u5C5C\u5C62\u5C63\u5C67\u5C68\u5C69"],["8fbba1","\u5C6D\u5C70\u5C74\u5C75\u5C7A\u5C7B\u5C7C\u5C7D\u5C87\u5C88\u5C8A\u5C8F\u5C92\u5C9D\u5C9F\u5CA0\u5CA2\u5CA3\u5CA6\u5CAA\u5CB2\u5CB4\u5CB5\u5CBA\u5CC9\u5CCB\u5CD2\u5CDD\u5CD7\u5CEE\u5CF1\u5CF2\u5CF4\u5D01\u5D06\u5D0D\u5D12\u5D2B\u5D23\u5D24\u5D26\u5D27\u5D31\u5D34\u5D39\u5D3D\u5D3F\u5D42\u5D43\u5D46\u5D48\u5D55\u5D51\u5D59\u5D4A\u5D5F\u5D60\u5D61\u5D62\u5D64\u5D6A\u5D6D\u5D70\u5D79\u5D7A\u5D7E\u5D7F\u5D81\u5D83\u5D88\u5D8A\u5D92\u5D93\u5D94\u5D95\u5D99\u5D9B\u5D9F\u5DA0\u5DA7\u5DAB\u5DB0\u5DB4\u5DB8\u5DB9\u5DC3\u5DC7\u5DCB\u5DD0\u5DCE\u5DD8\u5DD9\u5DE0\u5DE4"],["8fbca1","\u5DE9\u5DF8\u5DF9\u5E00\u5E07\u5E0D\u5E12\u5E14\u5E15\u5E18\u5E1F\u5E20\u5E2E\u5E28\u5E32\u5E35\u5E3E\u5E4B\u5E50\u5E49\u5E51\u5E56\u5E58\u5E5B\u5E5C\u5E5E\u5E68\u5E6A",4,"\u5E70\u5E80\u5E8B\u5E8E\u5EA2\u5EA4\u5EA5\u5EA8\u5EAA\u5EAC\u5EB1\u5EB3\u5EBD\u5EBE\u5EBF\u5EC6\u5ECC\u5ECB\u5ECE\u5ED1\u5ED2\u5ED4\u5ED5\u5EDC\u5EDE\u5EE5\u5EEB\u5F02\u5F06\u5F07\u5F08\u5F0E\u5F19\u5F1C\u5F1D\u5F21\u5F22\u5F23\u5F24\u5F28\u5F2B\u5F2C\u5F2E\u5F30\u5F34\u5F36\u5F3B\u5F3D\u5F3F\u5F40\u5F44\u5F45\u5F47\u5F4D\u5F50\u5F54\u5F58\u5F5B\u5F60\u5F63\u5F64\u5F67"],["8fbda1","\u5F6F\u5F72\u5F74\u5F75\u5F78\u5F7A\u5F7D\u5F7E\u5F89\u5F8D\u5F8F\u5F96\u5F9C\u5F9D\u5FA2\u5FA7\u5FAB\u5FA4\u5FAC\u5FAF\u5FB0\u5FB1\u5FB8\u5FC4\u5FC7\u5FC8\u5FC9\u5FCB\u5FD0",4,"\u5FDE\u5FE1\u5FE2\u5FE8\u5FE9\u5FEA\u5FEC\u5FED\u5FEE\u5FEF\u5FF2\u5FF3\u5FF6\u5FFA\u5FFC\u6007\u600A\u600D\u6013\u6014\u6017\u6018\u601A\u601F\u6024\u602D\u6033\u6035\u6040\u6047\u6048\u6049\u604C\u6051\u6054\u6056\u6057\u605D\u6061\u6067\u6071\u607E\u607F\u6082\u6086\u6088\u608A\u608E\u6091\u6093\u6095\u6098\u609D\u609E\u60A2\u60A4\u60A5\u60A8\u60B0\u60B1\u60B7"],["8fbea1","\u60BB\u60BE\u60C2\u60C4\u60C8\u60C9\u60CA\u60CB\u60CE\u60CF\u60D4\u60D5\u60D9\u60DB\u60DD\u60DE\u60E2\u60E5\u60F2\u60F5\u60F8\u60FC\u60FD\u6102\u6107\u610A\u610C\u6110",4,"\u6116\u6117\u6119\u611C\u611E\u6122\u612A\u612B\u6130\u6131\u6135\u6136\u6137\u6139\u6141\u6145\u6146\u6149\u615E\u6160\u616C\u6172\u6178\u617B\u617C\u617F\u6180\u6181\u6183\u6184\u618B\u618D\u6192\u6193\u6197\u6198\u619C\u619D\u619F\u61A0\u61A5\u61A8\u61AA\u61AD\u61B8\u61B9\u61BC\u61C0\u61C1\u61C2\u61CE\u61CF\u61D5\u61DC\u61DD\u61DE\u61DF\u61E1\u61E2\u61E7\u61E9\u61E5"],["8fbfa1","\u61EC\u61ED\u61EF\u6201\u6203\u6204\u6207\u6213\u6215\u621C\u6220\u6222\u6223\u6227\u6229\u622B\u6239\u623D\u6242\u6243\u6244\u6246\u624C\u6250\u6251\u6252\u6254\u6256\u625A\u625C\u6264\u626D\u626F\u6273\u627A\u627D\u628D\u628E\u628F\u6290\u62A6\u62A8\u62B3\u62B6\u62B7\u62BA\u62BE\u62BF\u62C4\u62CE\u62D5\u62D6\u62DA\u62EA\u62F2\u62F4\u62FC\u62FD\u6303\u6304\u630A\u630B\u630D\u6310\u6313\u6316\u6318\u6329\u632A\u632D\u6335\u6336\u6339\u633C\u6341\u6342\u6343\u6344\u6346\u634A\u634B\u634E\u6352\u6353\u6354\u6358\u635B\u6365\u6366\u636C\u636D\u6371\u6374\u6375"],["8fc0a1","\u6378\u637C\u637D\u637F\u6382\u6384\u6387\u638A\u6390\u6394\u6395\u6399\u639A\u639E\u63A4\u63A6\u63AD\u63AE\u63AF\u63BD\u63C1\u63C5\u63C8\u63CE\u63D1\u63D3\u63D4\u63D5\u63DC\u63E0\u63E5\u63EA\u63EC\u63F2\u63F3\u63F5\u63F8\u63F9\u6409\u640A\u6410\u6412\u6414\u6418\u641E\u6420\u6422\u6424\u6425\u6429\u642A\u642F\u6430\u6435\u643D\u643F\u644B\u644F\u6451\u6452\u6453\u6454\u645A\u645B\u645C\u645D\u645F\u6460\u6461\u6463\u646D\u6473\u6474\u647B\u647D\u6485\u6487\u648F\u6490\u6491\u6498\u6499\u649B\u649D\u649F\u64A1\u64A3\u64A6\u64A8\u64AC\u64B3\u64BD\u64BE\u64BF"],["8fc1a1","\u64C4\u64C9\u64CA\u64CB\u64CC\u64CE\u64D0\u64D1\u64D5\u64D7\u64E4\u64E5\u64E9\u64EA\u64ED\u64F0\u64F5\u64F7\u64FB\u64FF\u6501\u6504\u6508\u6509\u650A\u650F\u6513\u6514\u6516\u6519\u651B\u651E\u651F\u6522\u6526\u6529\u652E\u6531\u653A\u653C\u653D\u6543\u6547\u6549\u6550\u6552\u6554\u655F\u6560\u6567\u656B\u657A\u657D\u6581\u6585\u658A\u6592\u6595\u6598\u659D\u65A0\u65A3\u65A6\u65AE\u65B2\u65B3\u65B4\u65BF\u65C2\u65C8\u65C9\u65CE\u65D0\u65D4\u65D6\u65D8\u65DF\u65F0\u65F2\u65F4\u65F5\u65F9\u65FE\u65FF\u6600\u6604\u6608\u6609\u660D\u6611\u6612\u6615\u6616\u661D"],["8fc2a1","\u661E\u6621\u6622\u6623\u6624\u6626\u6629\u662A\u662B\u662C\u662E\u6630\u6631\u6633\u6639\u6637\u6640\u6645\u6646\u664A\u664C\u6651\u664E\u6657\u6658\u6659\u665B\u665C\u6660\u6661\u66FB\u666A\u666B\u666C\u667E\u6673\u6675\u667F\u6677\u6678\u6679\u667B\u6680\u667C\u668B\u668C\u668D\u6690\u6692\u6699\u669A\u669B\u669C\u669F\u66A0\u66A4\u66AD\u66B1\u66B2\u66B5\u66BB\u66BF\u66C0\u66C2\u66C3\u66C8\u66CC\u66CE\u66CF\u66D4\u66DB\u66DF\u66E8\u66EB\u66EC\u66EE\u66FA\u6705\u6707\u670E\u6713\u6719\u671C\u6720\u6722\u6733\u673E\u6745\u6747\u6748\u674C\u6754\u6755\u675D"],["8fc3a1","\u6766\u676C\u676E\u6774\u6776\u677B\u6781\u6784\u678E\u678F\u6791\u6793\u6796\u6798\u6799\u679B\u67B0\u67B1\u67B2\u67B5\u67BB\u67BC\u67BD\u67F9\u67C0\u67C2\u67C3\u67C5\u67C8\u67C9\u67D2\u67D7\u67D9\u67DC\u67E1\u67E6\u67F0\u67F2\u67F6\u67F7\u6852\u6814\u6819\u681D\u681F\u6828\u6827\u682C\u682D\u682F\u6830\u6831\u6833\u683B\u683F\u6844\u6845\u684A\u684C\u6855\u6857\u6858\u685B\u686B\u686E",4,"\u6875\u6879\u687A\u687B\u687C\u6882\u6884\u6886\u6888\u6896\u6898\u689A\u689C\u68A1\u68A3\u68A5\u68A9\u68AA\u68AE\u68B2\u68BB\u68C5\u68C8\u68CC\u68CF"],["8fc4a1","\u68D0\u68D1\u68D3\u68D6\u68D9\u68DC\u68DD\u68E5\u68E8\u68EA\u68EB\u68EC\u68ED\u68F0\u68F1\u68F5\u68F6\u68FB\u68FC\u68FD\u6906\u6909\u690A\u6910\u6911\u6913\u6916\u6917\u6931\u6933\u6935\u6938\u693B\u6942\u6945\u6949\u694E\u6957\u695B\u6963\u6964\u6965\u6966\u6968\u6969\u696C\u6970\u6971\u6972\u697A\u697B\u697F\u6980\u698D\u6992\u6996\u6998\u69A1\u69A5\u69A6\u69A8\u69AB\u69AD\u69AF\u69B7\u69B8\u69BA\u69BC\u69C5\u69C8\u69D1\u69D6\u69D7\u69E2\u69E5\u69EE\u69EF\u69F1\u69F3\u69F5\u69FE\u6A00\u6A01\u6A03\u6A0F\u6A11\u6A15\u6A1A\u6A1D\u6A20\u6A24\u6A28\u6A30\u6A32"],["8fc5a1","\u6A34\u6A37\u6A3B\u6A3E\u6A3F\u6A45\u6A46\u6A49\u6A4A\u6A4E\u6A50\u6A51\u6A52\u6A55\u6A56\u6A5B\u6A64\u6A67\u6A6A\u6A71\u6A73\u6A7E\u6A81\u6A83\u6A86\u6A87\u6A89\u6A8B\u6A91\u6A9B\u6A9D\u6A9E\u6A9F\u6AA5\u6AAB\u6AAF\u6AB0\u6AB1\u6AB4\u6ABD\u6ABE\u6ABF\u6AC6\u6AC9\u6AC8\u6ACC\u6AD0\u6AD4\u6AD5\u6AD6\u6ADC\u6ADD\u6AE4\u6AE7\u6AEC\u6AF0\u6AF1\u6AF2\u6AFC\u6AFD\u6B02\u6B03\u6B06\u6B07\u6B09\u6B0F\u6B10\u6B11\u6B17\u6B1B\u6B1E\u6B24\u6B28\u6B2B\u6B2C\u6B2F\u6B35\u6B36\u6B3B\u6B3F\u6B46\u6B4A\u6B4D\u6B52\u6B56\u6B58\u6B5D\u6B60\u6B67\u6B6B\u6B6E\u6B70\u6B75\u6B7D"],["8fc6a1","\u6B7E\u6B82\u6B85\u6B97\u6B9B\u6B9F\u6BA0\u6BA2\u6BA3\u6BA8\u6BA9\u6BAC\u6BAD\u6BAE\u6BB0\u6BB8\u6BB9\u6BBD\u6BBE\u6BC3\u6BC4\u6BC9\u6BCC\u6BD6\u6BDA\u6BE1\u6BE3\u6BE6\u6BE7\u6BEE\u6BF1\u6BF7\u6BF9\u6BFF\u6C02\u6C04\u6C05\u6C09\u6C0D\u6C0E\u6C10\u6C12\u6C19\u6C1F\u6C26\u6C27\u6C28\u6C2C\u6C2E\u6C33\u6C35\u6C36\u6C3A\u6C3B\u6C3F\u6C4A\u6C4B\u6C4D\u6C4F\u6C52\u6C54\u6C59\u6C5B\u6C5C\u6C6B\u6C6D\u6C6F\u6C74\u6C76\u6C78\u6C79\u6C7B\u6C85\u6C86\u6C87\u6C89\u6C94\u6C95\u6C97\u6C98\u6C9C\u6C9F\u6CB0\u6CB2\u6CB4\u6CC2\u6CC6\u6CCD\u6CCF\u6CD0\u6CD1\u6CD2\u6CD4\u6CD6"],["8fc7a1","\u6CDA\u6CDC\u6CE0\u6CE7\u6CE9\u6CEB\u6CEC\u6CEE\u6CF2\u6CF4\u6D04\u6D07\u6D0A\u6D0E\u6D0F\u6D11\u6D13\u6D1A\u6D26\u6D27\u6D28\u6C67\u6D2E\u6D2F\u6D31\u6D39\u6D3C\u6D3F\u6D57\u6D5E\u6D5F\u6D61\u6D65\u6D67\u6D6F\u6D70\u6D7C\u6D82\u6D87\u6D91\u6D92\u6D94\u6D96\u6D97\u6D98\u6DAA\u6DAC\u6DB4\u6DB7\u6DB9\u6DBD\u6DBF\u6DC4\u6DC8\u6DCA\u6DCE\u6DCF\u6DD6\u6DDB\u6DDD\u6DDF\u6DE0\u6DE2\u6DE5\u6DE9\u6DEF\u6DF0\u6DF4\u6DF6\u6DFC\u6E00\u6E04\u6E1E\u6E22\u6E27\u6E32\u6E36\u6E39\u6E3B\u6E3C\u6E44\u6E45\u6E48\u6E49\u6E4B\u6E4F\u6E51\u6E52\u6E53\u6E54\u6E57\u6E5C\u6E5D\u6E5E"],["8fc8a1","\u6E62\u6E63\u6E68\u6E73\u6E7B\u6E7D\u6E8D\u6E93\u6E99\u6EA0\u6EA7\u6EAD\u6EAE\u6EB1\u6EB3\u6EBB\u6EBF\u6EC0\u6EC1\u6EC3\u6EC7\u6EC8\u6ECA\u6ECD\u6ECE\u6ECF\u6EEB\u6EED\u6EEE\u6EF9\u6EFB\u6EFD\u6F04\u6F08\u6F0A\u6F0C\u6F0D\u6F16\u6F18\u6F1A\u6F1B\u6F26\u6F29\u6F2A\u6F2F\u6F30\u6F33\u6F36\u6F3B\u6F3C\u6F2D\u6F4F\u6F51\u6F52\u6F53\u6F57\u6F59\u6F5A\u6F5D\u6F5E\u6F61\u6F62\u6F68\u6F6C\u6F7D\u6F7E\u6F83\u6F87\u6F88\u6F8B\u6F8C\u6F8D\u6F90\u6F92\u6F93\u6F94\u6F96\u6F9A\u6F9F\u6FA0\u6FA5\u6FA6\u6FA7\u6FA8\u6FAE\u6FAF\u6FB0\u6FB5\u6FB6\u6FBC\u6FC5\u6FC7\u6FC8\u6FCA"],["8fc9a1","\u6FDA\u6FDE\u6FE8\u6FE9\u6FF0\u6FF5\u6FF9\u6FFC\u6FFD\u7000\u7005\u7006\u7007\u700D\u7017\u7020\u7023\u702F\u7034\u7037\u7039\u703C\u7043\u7044\u7048\u7049\u704A\u704B\u7054\u7055\u705D\u705E\u704E\u7064\u7065\u706C\u706E\u7075\u7076\u707E\u7081\u7085\u7086\u7094",4,"\u709B\u70A4\u70AB\u70B0\u70B1\u70B4\u70B7\u70CA\u70D1\u70D3\u70D4\u70D5\u70D6\u70D8\u70DC\u70E4\u70FA\u7103",4,"\u710B\u710C\u710F\u711E\u7120\u712B\u712D\u712F\u7130\u7131\u7138\u7141\u7145\u7146\u7147\u714A\u714B\u7150\u7152\u7157\u715A\u715C\u715E\u7160"],["8fcaa1","\u7168\u7179\u7180\u7185\u7187\u718C\u7192\u719A\u719B\u71A0\u71A2\u71AF\u71B0\u71B2\u71B3\u71BA\u71BF\u71C0\u71C1\u71C4\u71CB\u71CC\u71D3\u71D6\u71D9\u71DA\u71DC\u71F8\u71FE\u7200\u7207\u7208\u7209\u7213\u7217\u721A\u721D\u721F\u7224\u722B\u722F\u7234\u7238\u7239\u7241\u7242\u7243\u7245\u724E\u724F\u7250\u7253\u7255\u7256\u725A\u725C\u725E\u7260\u7263\u7268\u726B\u726E\u726F\u7271\u7277\u7278\u727B\u727C\u727F\u7284\u7289\u728D\u728E\u7293\u729B\u72A8\u72AD\u72AE\u72B1\u72B4\u72BE\u72C1\u72C7\u72C9\u72CC\u72D5\u72D6\u72D8\u72DF\u72E5\u72F3\u72F4\u72FA\u72FB"],["8fcba1","\u72FE\u7302\u7304\u7305\u7307\u730B\u730D\u7312\u7313\u7318\u7319\u731E\u7322\u7324\u7327\u7328\u732C\u7331\u7332\u7335\u733A\u733B\u733D\u7343\u734D\u7350\u7352\u7356\u7358\u735D\u735E\u735F\u7360\u7366\u7367\u7369\u736B\u736C\u736E\u736F\u7371\u7377\u7379\u737C\u7380\u7381\u7383\u7385\u7386\u738E\u7390\u7393\u7395\u7397\u7398\u739C\u739E\u739F\u73A0\u73A2\u73A5\u73A6\u73AA\u73AB\u73AD\u73B5\u73B7\u73B9\u73BC\u73BD\u73BF\u73C5\u73C6\u73C9\u73CB\u73CC\u73CF\u73D2\u73D3\u73D6\u73D9\u73DD\u73E1\u73E3\u73E6\u73E7\u73E9\u73F4\u73F5\u73F7\u73F9\u73FA\u73FB\u73FD"],["8fcca1","\u73FF\u7400\u7401\u7404\u7407\u740A\u7411\u741A\u741B\u7424\u7426\u7428",9,"\u7439\u7440\u7443\u7444\u7446\u7447\u744B\u744D\u7451\u7452\u7457\u745D\u7462\u7466\u7467\u7468\u746B\u746D\u746E\u7471\u7472\u7480\u7481\u7485\u7486\u7487\u7489\u748F\u7490\u7491\u7492\u7498\u7499\u749A\u749C\u749F\u74A0\u74A1\u74A3\u74A6\u74A8\u74A9\u74AA\u74AB\u74AE\u74AF\u74B1\u74B2\u74B5\u74B9\u74BB\u74BF\u74C8\u74C9\u74CC\u74D0\u74D3\u74D8\u74DA\u74DB\u74DE\u74DF\u74E4\u74E8\u74EA\u74EB\u74EF\u74F4\u74FA\u74FB\u74FC\u74FF\u7506"],["8fcda1","\u7512\u7516\u7517\u7520\u7521\u7524\u7527\u7529\u752A\u752F\u7536\u7539\u753D\u753E\u753F\u7540\u7543\u7547\u7548\u754E\u7550\u7552\u7557\u755E\u755F\u7561\u756F\u7571\u7579",5,"\u7581\u7585\u7590\u7592\u7593\u7595\u7599\u759C\u75A2\u75A4\u75B4\u75BA\u75BF\u75C0\u75C1\u75C4\u75C6\u75CC\u75CE\u75CF\u75D7\u75DC\u75DF\u75E0\u75E1\u75E4\u75E7\u75EC\u75EE\u75EF\u75F1\u75F9\u7600\u7602\u7603\u7604\u7607\u7608\u760A\u760C\u760F\u7612\u7613\u7615\u7616\u7619\u761B\u761C\u761D\u761E\u7623\u7625\u7626\u7629\u762D\u7632\u7633\u7635\u7638\u7639"],["8fcea1","\u763A\u763C\u764A\u7640\u7641\u7643\u7644\u7645\u7649\u764B\u7655\u7659\u765F\u7664\u7665\u766D\u766E\u766F\u7671\u7674\u7681\u7685\u768C\u768D\u7695\u769B\u769C\u769D\u769F\u76A0\u76A2",6,"\u76AA\u76AD\u76BD\u76C1\u76C5\u76C9\u76CB\u76CC\u76CE\u76D4\u76D9\u76E0\u76E6\u76E8\u76EC\u76F0\u76F1\u76F6\u76F9\u76FC\u7700\u7706\u770A\u770E\u7712\u7714\u7715\u7717\u7719\u771A\u771C\u7722\u7728\u772D\u772E\u772F\u7734\u7735\u7736\u7739\u773D\u773E\u7742\u7745\u7746\u774A\u774D\u774E\u774F\u7752\u7756\u7757\u775C\u775E\u775F\u7760\u7762"],["8fcfa1","\u7764\u7767\u776A\u776C\u7770\u7772\u7773\u7774\u777A\u777D\u7780\u7784\u778C\u778D\u7794\u7795\u7796\u779A\u779F\u77A2\u77A7\u77AA\u77AE\u77AF\u77B1\u77B5\u77BE\u77C3\u77C9\u77D1\u77D2\u77D5\u77D9\u77DE\u77DF\u77E0\u77E4\u77E6\u77EA\u77EC\u77F0\u77F1\u77F4\u77F8\u77FB\u7805\u7806\u7809\u780D\u780E\u7811\u781D\u7821\u7822\u7823\u782D\u782E\u7830\u7835\u7837\u7843\u7844\u7847\u7848\u784C\u784E\u7852\u785C\u785E\u7860\u7861\u7863\u7864\u7868\u786A\u786E\u787A\u787E\u788A\u788F\u7894\u7898\u78A1\u789D\u789E\u789F\u78A4\u78A8\u78AC\u78AD\u78B0\u78B1\u78B2\u78B3"],["8fd0a1","\u78BB\u78BD\u78BF\u78C7\u78C8\u78C9\u78CC\u78CE\u78D2\u78D3\u78D5\u78D6\u78E4\u78DB\u78DF\u78E0\u78E1\u78E6\u78EA\u78F2\u78F3\u7900\u78F6\u78F7\u78FA\u78FB\u78FF\u7906\u790C\u7910\u791A\u791C\u791E\u791F\u7920\u7925\u7927\u7929\u792D\u7931\u7934\u7935\u793B\u793D\u793F\u7944\u7945\u7946\u794A\u794B\u794F\u7951\u7954\u7958\u795B\u795C\u7967\u7969\u796B\u7972\u7979\u797B\u797C\u797E\u798B\u798C\u7991\u7993\u7994\u7995\u7996\u7998\u799B\u799C\u79A1\u79A8\u79A9\u79AB\u79AF\u79B1\u79B4\u79B8\u79BB\u79C2\u79C4\u79C7\u79C8\u79CA\u79CF\u79D4\u79D6\u79DA\u79DD\u79DE"],["8fd1a1","\u79E0\u79E2\u79E5\u79EA\u79EB\u79ED\u79F1\u79F8\u79FC\u7A02\u7A03\u7A07\u7A09\u7A0A\u7A0C\u7A11\u7A15\u7A1B\u7A1E\u7A21\u7A27\u7A2B\u7A2D\u7A2F\u7A30\u7A34\u7A35\u7A38\u7A39\u7A3A\u7A44\u7A45\u7A47\u7A48\u7A4C\u7A55\u7A56\u7A59\u7A5C\u7A5D\u7A5F\u7A60\u7A65\u7A67\u7A6A\u7A6D\u7A75\u7A78\u7A7E\u7A80\u7A82\u7A85\u7A86\u7A8A\u7A8B\u7A90\u7A91\u7A94\u7A9E\u7AA0\u7AA3\u7AAC\u7AB3\u7AB5\u7AB9\u7ABB\u7ABC\u7AC6\u7AC9\u7ACC\u7ACE\u7AD1\u7ADB\u7AE8\u7AE9\u7AEB\u7AEC\u7AF1\u7AF4\u7AFB\u7AFD\u7AFE\u7B07\u7B14\u7B1F\u7B23\u7B27\u7B29\u7B2A\u7B2B\u7B2D\u7B2E\u7B2F\u7B30"],["8fd2a1","\u7B31\u7B34\u7B3D\u7B3F\u7B40\u7B41\u7B47\u7B4E\u7B55\u7B60\u7B64\u7B66\u7B69\u7B6A\u7B6D\u7B6F\u7B72\u7B73\u7B77\u7B84\u7B89\u7B8E\u7B90\u7B91\u7B96\u7B9B\u7B9E\u7BA0\u7BA5\u7BAC\u7BAF\u7BB0\u7BB2\u7BB5\u7BB6\u7BBA\u7BBB\u7BBC\u7BBD\u7BC2\u7BC5\u7BC8\u7BCA\u7BD4\u7BD6\u7BD7\u7BD9\u7BDA\u7BDB\u7BE8\u7BEA\u7BF2\u7BF4\u7BF5\u7BF8\u7BF9\u7BFA\u7BFC\u7BFE\u7C01\u7C02\u7C03\u7C04\u7C06\u7C09\u7C0B\u7C0C\u7C0E\u7C0F\u7C19\u7C1B\u7C20\u7C25\u7C26\u7C28\u7C2C\u7C31\u7C33\u7C34\u7C36\u7C39\u7C3A\u7C46\u7C4A\u7C55\u7C51\u7C52\u7C53\u7C59",5],["8fd3a1","\u7C61\u7C63\u7C67\u7C69\u7C6D\u7C6E\u7C70\u7C72\u7C79\u7C7C\u7C7D\u7C86\u7C87\u7C8F\u7C94\u7C9E\u7CA0\u7CA6\u7CB0\u7CB6\u7CB7\u7CBA\u7CBB\u7CBC\u7CBF\u7CC4\u7CC7\u7CC8\u7CC9\u7CCD\u7CCF\u7CD3\u7CD4\u7CD5\u7CD7\u7CD9\u7CDA\u7CDD\u7CE6\u7CE9\u7CEB\u7CF5\u7D03\u7D07\u7D08\u7D09\u7D0F\u7D11\u7D12\u7D13\u7D16\u7D1D\u7D1E\u7D23\u7D26\u7D2A\u7D2D\u7D31\u7D3C\u7D3D\u7D3E\u7D40\u7D41\u7D47\u7D48\u7D4D\u7D51\u7D53\u7D57\u7D59\u7D5A\u7D5C\u7D5D\u7D65\u7D67\u7D6A\u7D70\u7D78\u7D7A\u7D7B\u7D7F\u7D81\u7D82\u7D83\u7D85\u7D86\u7D88\u7D8B\u7D8C\u7D8D\u7D91\u7D96\u7D97\u7D9D"],["8fd4a1","\u7D9E\u7DA6\u7DA7\u7DAA\u7DB3\u7DB6\u7DB7\u7DB9\u7DC2",4,"\u7DCC\u7DCD\u7DCE\u7DD7\u7DD9\u7E00\u7DE2\u7DE5\u7DE6\u7DEA\u7DEB\u7DED\u7DF1\u7DF5\u7DF6\u7DF9\u7DFA\u7E08\u7E10\u7E11\u7E15\u7E17\u7E1C\u7E1D\u7E20\u7E27\u7E28\u7E2C\u7E2D\u7E2F\u7E33\u7E36\u7E3F\u7E44\u7E45\u7E47\u7E4E\u7E50\u7E52\u7E58\u7E5F\u7E61\u7E62\u7E65\u7E6B\u7E6E\u7E6F\u7E73\u7E78\u7E7E\u7E81\u7E86\u7E87\u7E8A\u7E8D\u7E91\u7E95\u7E98\u7E9A\u7E9D\u7E9E\u7F3C\u7F3B\u7F3D\u7F3E\u7F3F\u7F43\u7F44\u7F47\u7F4F\u7F52\u7F53\u7F5B\u7F5C\u7F5D\u7F61\u7F63\u7F64\u7F65\u7F66\u7F6D"],["8fd5a1","\u7F71\u7F7D\u7F7E\u7F7F\u7F80\u7F8B\u7F8D\u7F8F\u7F90\u7F91\u7F96\u7F97\u7F9C\u7FA1\u7FA2\u7FA6\u7FAA\u7FAD\u7FB4\u7FBC\u7FBF\u7FC0\u7FC3\u7FC8\u7FCE\u7FCF\u7FDB\u7FDF\u7FE3\u7FE5\u7FE8\u7FEC\u7FEE\u7FEF\u7FF2\u7FFA\u7FFD\u7FFE\u7FFF\u8007\u8008\u800A\u800D\u800E\u800F\u8011\u8013\u8014\u8016\u801D\u801E\u801F\u8020\u8024\u8026\u802C\u802E\u8030\u8034\u8035\u8037\u8039\u803A\u803C\u803E\u8040\u8044\u8060\u8064\u8066\u806D\u8071\u8075\u8081\u8088\u808E\u809C\u809E\u80A6\u80A7\u80AB\u80B8\u80B9\u80C8\u80CD\u80CF\u80D2\u80D4\u80D5\u80D7\u80D8\u80E0\u80ED\u80EE"],["8fd6a1","\u80F0\u80F2\u80F3\u80F6\u80F9\u80FA\u80FE\u8103\u810B\u8116\u8117\u8118\u811C\u811E\u8120\u8124\u8127\u812C\u8130\u8135\u813A\u813C\u8145\u8147\u814A\u814C\u8152\u8157\u8160\u8161\u8167\u8168\u8169\u816D\u816F\u8177\u8181\u8190\u8184\u8185\u8186\u818B\u818E\u8196\u8198\u819B\u819E\u81A2\u81AE\u81B2\u81B4\u81BB\u81CB\u81C3\u81C5\u81CA\u81CE\u81CF\u81D5\u81D7\u81DB\u81DD\u81DE\u81E1\u81E4\u81EB\u81EC\u81F0\u81F1\u81F2\u81F5\u81F6\u81F8\u81F9\u81FD\u81FF\u8200\u8203\u820F\u8213\u8214\u8219\u821A\u821D\u8221\u8222\u8228\u8232\u8234\u823A\u8243\u8244\u8245\u8246"],["8fd7a1","\u824B\u824E\u824F\u8251\u8256\u825C\u8260\u8263\u8267\u826D\u8274\u827B\u827D\u827F\u8280\u8281\u8283\u8284\u8287\u8289\u828A\u828E\u8291\u8294\u8296\u8298\u829A\u829B\u82A0\u82A1\u82A3\u82A4\u82A7\u82A8\u82A9\u82AA\u82AE\u82B0\u82B2\u82B4\u82B7\u82BA\u82BC\u82BE\u82BF\u82C6\u82D0\u82D5\u82DA\u82E0\u82E2\u82E4\u82E8\u82EA\u82ED\u82EF\u82F6\u82F7\u82FD\u82FE\u8300\u8301\u8307\u8308\u830A\u830B\u8354\u831B\u831D\u831E\u831F\u8321\u8322\u832C\u832D\u832E\u8330\u8333\u8337\u833A\u833C\u833D\u8342\u8343\u8344\u8347\u834D\u834E\u8351\u8355\u8356\u8357\u8370\u8378"],["8fd8a1","\u837D\u837F\u8380\u8382\u8384\u8386\u838D\u8392\u8394\u8395\u8398\u8399\u839B\u839C\u839D\u83A6\u83A7\u83A9\u83AC\u83BE\u83BF\u83C0\u83C7\u83C9\u83CF\u83D0\u83D1\u83D4\u83DD\u8353\u83E8\u83EA\u83F6\u83F8\u83F9\u83FC\u8401\u8406\u840A\u840F\u8411\u8415\u8419\u83AD\u842F\u8439\u8445\u8447\u8448\u844A\u844D\u844F\u8451\u8452\u8456\u8458\u8459\u845A\u845C\u8460\u8464\u8465\u8467\u846A\u8470\u8473\u8474\u8476\u8478\u847C\u847D\u8481\u8485\u8492\u8493\u8495\u849E\u84A6\u84A8\u84A9\u84AA\u84AF\u84B1\u84B4\u84BA\u84BD\u84BE\u84C0\u84C2\u84C7\u84C8\u84CC\u84CF\u84D3"],["8fd9a1","\u84DC\u84E7\u84EA\u84EF\u84F0\u84F1\u84F2\u84F7\u8532\u84FA\u84FB\u84FD\u8502\u8503\u8507\u850C\u850E\u8510\u851C\u851E\u8522\u8523\u8524\u8525\u8527\u852A\u852B\u852F\u8533\u8534\u8536\u853F\u8546\u854F",4,"\u8556\u8559\u855C",6,"\u8564\u856B\u856F\u8579\u857A\u857B\u857D\u857F\u8581\u8585\u8586\u8589\u858B\u858C\u858F\u8593\u8598\u859D\u859F\u85A0\u85A2\u85A5\u85A7\u85B4\u85B6\u85B7\u85B8\u85BC\u85BD\u85BE\u85BF\u85C2\u85C7\u85CA\u85CB\u85CE\u85AD\u85D8\u85DA\u85DF\u85E0\u85E6\u85E8\u85ED\u85F3\u85F6\u85FC"],["8fdaa1","\u85FF\u8600\u8604\u8605\u860D\u860E\u8610\u8611\u8612\u8618\u8619\u861B\u861E\u8621\u8627\u8629\u8636\u8638\u863A\u863C\u863D\u8640\u8642\u8646\u8652\u8653\u8656\u8657\u8658\u8659\u865D\u8660",4,"\u8669\u866C\u866F\u8675\u8676\u8677\u867A\u868D\u8691\u8696\u8698\u869A\u869C\u86A1\u86A6\u86A7\u86A8\u86AD\u86B1\u86B3\u86B4\u86B5\u86B7\u86B8\u86B9\u86BF\u86C0\u86C1\u86C3\u86C5\u86D1\u86D2\u86D5\u86D7\u86DA\u86DC\u86E0\u86E3\u86E5\u86E7\u8688\u86FA\u86FC\u86FD\u8704\u8705\u8707\u870B\u870E\u870F\u8710\u8713\u8714\u8719\u871E\u871F\u8721\u8723"],["8fdba1","\u8728\u872E\u872F\u8731\u8732\u8739\u873A\u873C\u873D\u873E\u8740\u8743\u8745\u874D\u8758\u875D\u8761\u8764\u8765\u876F\u8771\u8772\u877B\u8783",6,"\u878B\u878C\u8790\u8793\u8795\u8797\u8798\u8799\u879E\u87A0\u87A3\u87A7\u87AC\u87AD\u87AE\u87B1\u87B5\u87BE\u87BF\u87C1\u87C8\u87C9\u87CA\u87CE\u87D5\u87D6\u87D9\u87DA\u87DC\u87DF\u87E2\u87E3\u87E4\u87EA\u87EB\u87ED\u87F1\u87F3\u87F8\u87FA\u87FF\u8801\u8803\u8806\u8809\u880A\u880B\u8810\u8819\u8812\u8813\u8814\u8818\u881A\u881B\u881C\u881E\u881F\u8828\u882D\u882E\u8830\u8832\u8835"],["8fdca1","\u883A\u883C\u8841\u8843\u8845\u8848\u8849\u884A\u884B\u884E\u8851\u8855\u8856\u8858\u885A\u885C\u885F\u8860\u8864\u8869\u8871\u8879\u887B\u8880\u8898\u889A\u889B\u889C\u889F\u88A0\u88A8\u88AA\u88BA\u88BD\u88BE\u88C0\u88CA",4,"\u88D1\u88D2\u88D3\u88DB\u88DE\u88E7\u88EF\u88F0\u88F1\u88F5\u88F7\u8901\u8906\u890D\u890E\u890F\u8915\u8916\u8918\u8919\u891A\u891C\u8920\u8926\u8927\u8928\u8930\u8931\u8932\u8935\u8939\u893A\u893E\u8940\u8942\u8945\u8946\u8949\u894F\u8952\u8957\u895A\u895B\u895C\u8961\u8962\u8963\u896B\u896E\u8970\u8973\u8975\u897A"],["8fdda1","\u897B\u897C\u897D\u8989\u898D\u8990\u8994\u8995\u899B\u899C\u899F\u89A0\u89A5\u89B0\u89B4\u89B5\u89B6\u89B7\u89BC\u89D4",4,"\u89E5\u89E9\u89EB\u89ED\u89F1\u89F3\u89F6\u89F9\u89FD\u89FF\u8A04\u8A05\u8A07\u8A0F\u8A11\u8A12\u8A14\u8A15\u8A1E\u8A20\u8A22\u8A24\u8A26\u8A2B\u8A2C\u8A2F\u8A35\u8A37\u8A3D\u8A3E\u8A40\u8A43\u8A45\u8A47\u8A49\u8A4D\u8A4E\u8A53\u8A56\u8A57\u8A58\u8A5C\u8A5D\u8A61\u8A65\u8A67\u8A75\u8A76\u8A77\u8A79\u8A7A\u8A7B\u8A7E\u8A7F\u8A80\u8A83\u8A86\u8A8B\u8A8F\u8A90\u8A92\u8A96\u8A97\u8A99\u8A9F\u8AA7\u8AA9\u8AAE\u8AAF\u8AB3"],["8fdea1","\u8AB6\u8AB7\u8ABB\u8ABE\u8AC3\u8AC6\u8AC8\u8AC9\u8ACA\u8AD1\u8AD3\u8AD4\u8AD5\u8AD7\u8ADD\u8ADF\u8AEC\u8AF0\u8AF4\u8AF5\u8AF6\u8AFC\u8AFF\u8B05\u8B06\u8B0B\u8B11\u8B1C\u8B1E\u8B1F\u8B0A\u8B2D\u8B30\u8B37\u8B3C\u8B42",4,"\u8B48\u8B52\u8B53\u8B54\u8B59\u8B4D\u8B5E\u8B63\u8B6D\u8B76\u8B78\u8B79\u8B7C\u8B7E\u8B81\u8B84\u8B85\u8B8B\u8B8D\u8B8F\u8B94\u8B95\u8B9C\u8B9E\u8B9F\u8C38\u8C39\u8C3D\u8C3E\u8C45\u8C47\u8C49\u8C4B\u8C4F\u8C51\u8C53\u8C54\u8C57\u8C58\u8C5B\u8C5D\u8C59\u8C63\u8C64\u8C66\u8C68\u8C69\u8C6D\u8C73\u8C75\u8C76\u8C7B\u8C7E\u8C86"],["8fdfa1","\u8C87\u8C8B\u8C90\u8C92\u8C93\u8C99\u8C9B\u8C9C\u8CA4\u8CB9\u8CBA\u8CC5\u8CC6\u8CC9\u8CCB\u8CCF\u8CD6\u8CD5\u8CD9\u8CDD\u8CE1\u8CE8\u8CEC\u8CEF\u8CF0\u8CF2\u8CF5\u8CF7\u8CF8\u8CFE\u8CFF\u8D01\u8D03\u8D09\u8D12\u8D17\u8D1B\u8D65\u8D69\u8D6C\u8D6E\u8D7F\u8D82\u8D84\u8D88\u8D8D\u8D90\u8D91\u8D95\u8D9E\u8D9F\u8DA0\u8DA6\u8DAB\u8DAC\u8DAF\u8DB2\u8DB5\u8DB7\u8DB9\u8DBB\u8DC0\u8DC5\u8DC6\u8DC7\u8DC8\u8DCA\u8DCE\u8DD1\u8DD4\u8DD5\u8DD7\u8DD9\u8DE4\u8DE5\u8DE7\u8DEC\u8DF0\u8DBC\u8DF1\u8DF2\u8DF4\u8DFD\u8E01\u8E04\u8E05\u8E06\u8E0B\u8E11\u8E14\u8E16\u8E20\u8E21\u8E22"],["8fe0a1","\u8E23\u8E26\u8E27\u8E31\u8E33\u8E36\u8E37\u8E38\u8E39\u8E3D\u8E40\u8E41\u8E4B\u8E4D\u8E4E\u8E4F\u8E54\u8E5B\u8E5C\u8E5D\u8E5E\u8E61\u8E62\u8E69\u8E6C\u8E6D\u8E6F\u8E70\u8E71\u8E79\u8E7A\u8E7B\u8E82\u8E83\u8E89\u8E90\u8E92\u8E95\u8E9A\u8E9B\u8E9D\u8E9E\u8EA2\u8EA7\u8EA9\u8EAD\u8EAE\u8EB3\u8EB5\u8EBA\u8EBB\u8EC0\u8EC1\u8EC3\u8EC4\u8EC7\u8ECF\u8ED1\u8ED4\u8EDC\u8EE8\u8EEE\u8EF0\u8EF1\u8EF7\u8EF9\u8EFA\u8EED\u8F00\u8F02\u8F07\u8F08\u8F0F\u8F10\u8F16\u8F17\u8F18\u8F1E\u8F20\u8F21\u8F23\u8F25\u8F27\u8F28\u8F2C\u8F2D\u8F2E\u8F34\u8F35\u8F36\u8F37\u8F3A\u8F40\u8F41"],["8fe1a1","\u8F43\u8F47\u8F4F\u8F51",4,"\u8F58\u8F5D\u8F5E\u8F65\u8F9D\u8FA0\u8FA1\u8FA4\u8FA5\u8FA6\u8FB5\u8FB6\u8FB8\u8FBE\u8FC0\u8FC1\u8FC6\u8FCA\u8FCB\u8FCD\u8FD0\u8FD2\u8FD3\u8FD5\u8FE0\u8FE3\u8FE4\u8FE8\u8FEE\u8FF1\u8FF5\u8FF6\u8FFB\u8FFE\u9002\u9004\u9008\u900C\u9018\u901B\u9028\u9029\u902F\u902A\u902C\u902D\u9033\u9034\u9037\u903F\u9043\u9044\u904C\u905B\u905D\u9062\u9066\u9067\u906C\u9070\u9074\u9079\u9085\u9088\u908B\u908C\u908E\u9090\u9095\u9097\u9098\u9099\u909B\u90A0\u90A1\u90A2\u90A5\u90B0\u90B2\u90B3\u90B4\u90B6\u90BD\u90CC\u90BE\u90C3"],["8fe2a1","\u90C4\u90C5\u90C7\u90C8\u90D5\u90D7\u90D8\u90D9\u90DC\u90DD\u90DF\u90E5\u90D2\u90F6\u90EB\u90EF\u90F0\u90F4\u90FE\u90FF\u9100\u9104\u9105\u9106\u9108\u910D\u9110\u9114\u9116\u9117\u9118\u911A\u911C\u911E\u9120\u9125\u9122\u9123\u9127\u9129\u912E\u912F\u9131\u9134\u9136\u9137\u9139\u913A\u913C\u913D\u9143\u9147\u9148\u914F\u9153\u9157\u9159\u915A\u915B\u9161\u9164\u9167\u916D\u9174\u9179\u917A\u917B\u9181\u9183\u9185\u9186\u918A\u918E\u9191\u9193\u9194\u9195\u9198\u919E\u91A1\u91A6\u91A8\u91AC\u91AD\u91AE\u91B0\u91B1\u91B2\u91B3\u91B6\u91BB\u91BC\u91BD\u91BF"],["8fe3a1","\u91C2\u91C3\u91C5\u91D3\u91D4\u91D7\u91D9\u91DA\u91DE\u91E4\u91E5\u91E9\u91EA\u91EC",5,"\u91F7\u91F9\u91FB\u91FD\u9200\u9201\u9204\u9205\u9206\u9207\u9209\u920A\u920C\u9210\u9212\u9213\u9216\u9218\u921C\u921D\u9223\u9224\u9225\u9226\u9228\u922E\u922F\u9230\u9233\u9235\u9236\u9238\u9239\u923A\u923C\u923E\u9240\u9242\u9243\u9246\u9247\u924A\u924D\u924E\u924F\u9251\u9258\u9259\u925C\u925D\u9260\u9261\u9265\u9267\u9268\u9269\u926E\u926F\u9270\u9275",4,"\u927B\u927C\u927D\u927F\u9288\u9289\u928A\u928D\u928E\u9292\u9297"],["8fe4a1","\u9299\u929F\u92A0\u92A4\u92A5\u92A7\u92A8\u92AB\u92AF\u92B2\u92B6\u92B8\u92BA\u92BB\u92BC\u92BD\u92BF",4,"\u92C5\u92C6\u92C7\u92C8\u92CB\u92CC\u92CD\u92CE\u92D0\u92D3\u92D5\u92D7\u92D8\u92D9\u92DC\u92DD\u92DF\u92E0\u92E1\u92E3\u92E5\u92E7\u92E8\u92EC\u92EE\u92F0\u92F9\u92FB\u92FF\u9300\u9302\u9308\u930D\u9311\u9314\u9315\u931C\u931D\u931E\u931F\u9321\u9324\u9325\u9327\u9329\u932A\u9333\u9334\u9336\u9337\u9347\u9348\u9349\u9350\u9351\u9352\u9355\u9357\u9358\u935A\u935E\u9364\u9365\u9367\u9369\u936A\u936D\u936F\u9370\u9371\u9373\u9374\u9376"],["8fe5a1","\u937A\u937D\u937F\u9380\u9381\u9382\u9388\u938A\u938B\u938D\u938F\u9392\u9395\u9398\u939B\u939E\u93A1\u93A3\u93A4\u93A6\u93A8\u93AB\u93B4\u93B5\u93B6\u93BA\u93A9\u93C1\u93C4\u93C5\u93C6\u93C7\u93C9",4,"\u93D3\u93D9\u93DC\u93DE\u93DF\u93E2\u93E6\u93E7\u93F9\u93F7\u93F8\u93FA\u93FB\u93FD\u9401\u9402\u9404\u9408\u9409\u940D\u940E\u940F\u9415\u9416\u9417\u941F\u942E\u942F\u9431\u9432\u9433\u9434\u943B\u943F\u943D\u9443\u9445\u9448\u944A\u944C\u9455\u9459\u945C\u945F\u9461\u9463\u9468\u946B\u946D\u946E\u946F\u9471\u9472\u9484\u9483\u9578\u9579"],["8fe6a1","\u957E\u9584\u9588\u958C\u958D\u958E\u959D\u959E\u959F\u95A1\u95A6\u95A9\u95AB\u95AC\u95B4\u95B6\u95BA\u95BD\u95BF\u95C6\u95C8\u95C9\u95CB\u95D0\u95D1\u95D2\u95D3\u95D9\u95DA\u95DD\u95DE\u95DF\u95E0\u95E4\u95E6\u961D\u961E\u9622\u9624\u9625\u9626\u962C\u9631\u9633\u9637\u9638\u9639\u963A\u963C\u963D\u9641\u9652\u9654\u9656\u9657\u9658\u9661\u966E\u9674\u967B\u967C\u967E\u967F\u9681\u9682\u9683\u9684\u9689\u9691\u9696\u969A\u969D\u969F\u96A4\u96A5\u96A6\u96A9\u96AE\u96AF\u96B3\u96BA\u96CA\u96D2\u5DB2\u96D8\u96DA\u96DD\u96DE\u96DF\u96E9\u96EF\u96F1\u96FA\u9702"],["8fe7a1","\u9703\u9705\u9709\u971A\u971B\u971D\u9721\u9722\u9723\u9728\u9731\u9733\u9741\u9743\u974A\u974E\u974F\u9755\u9757\u9758\u975A\u975B\u9763\u9767\u976A\u976E\u9773\u9776\u9777\u9778\u977B\u977D\u977F\u9780\u9789\u9795\u9796\u9797\u9799\u979A\u979E\u979F\u97A2\u97AC\u97AE\u97B1\u97B2\u97B5\u97B6\u97B8\u97B9\u97BA\u97BC\u97BE\u97BF\u97C1\u97C4\u97C5\u97C7\u97C9\u97CA\u97CC\u97CD\u97CE\u97D0\u97D1\u97D4\u97D7\u97D8\u97D9\u97DD\u97DE\u97E0\u97DB\u97E1\u97E4\u97EF\u97F1\u97F4\u97F7\u97F8\u97FA\u9807\u980A\u9819\u980D\u980E\u9814\u9816\u981C\u981E\u9820\u9823\u9826"],["8fe8a1","\u982B\u982E\u982F\u9830\u9832\u9833\u9835\u9825\u983E\u9844\u9847\u984A\u9851\u9852\u9853\u9856\u9857\u9859\u985A\u9862\u9863\u9865\u9866\u986A\u986C\u98AB\u98AD\u98AE\u98B0\u98B4\u98B7\u98B8\u98BA\u98BB\u98BF\u98C2\u98C5\u98C8\u98CC\u98E1\u98E3\u98E5\u98E6\u98E7\u98EA\u98F3\u98F6\u9902\u9907\u9908\u9911\u9915\u9916\u9917\u991A\u991B\u991C\u991F\u9922\u9926\u9927\u992B\u9931",4,"\u9939\u993A\u993B\u993C\u9940\u9941\u9946\u9947\u9948\u994D\u994E\u9954\u9958\u9959\u995B\u995C\u995E\u995F\u9960\u999B\u999D\u999F\u99A6\u99B0\u99B1\u99B2\u99B5"],["8fe9a1","\u99B9\u99BA\u99BD\u99BF\u99C3\u99C9\u99D3\u99D4\u99D9\u99DA\u99DC\u99DE\u99E7\u99EA\u99EB\u99EC\u99F0\u99F4\u99F5\u99F9\u99FD\u99FE\u9A02\u9A03\u9A04\u9A0B\u9A0C\u9A10\u9A11\u9A16\u9A1E\u9A20\u9A22\u9A23\u9A24\u9A27\u9A2D\u9A2E\u9A33\u9A35\u9A36\u9A38\u9A47\u9A41\u9A44\u9A4A\u9A4B\u9A4C\u9A4E\u9A51\u9A54\u9A56\u9A5D\u9AAA\u9AAC\u9AAE\u9AAF\u9AB2\u9AB4\u9AB5\u9AB6\u9AB9\u9ABB\u9ABE\u9ABF\u9AC1\u9AC3\u9AC6\u9AC8\u9ACE\u9AD0\u9AD2\u9AD5\u9AD6\u9AD7\u9ADB\u9ADC\u9AE0\u9AE4\u9AE5\u9AE7\u9AE9\u9AEC\u9AF2\u9AF3\u9AF5\u9AF9\u9AFA\u9AFD\u9AFF",4],["8feaa1","\u9B04\u9B05\u9B08\u9B09\u9B0B\u9B0C\u9B0D\u9B0E\u9B10\u9B12\u9B16\u9B19\u9B1B\u9B1C\u9B20\u9B26\u9B2B\u9B2D\u9B33\u9B34\u9B35\u9B37\u9B39\u9B3A\u9B3D\u9B48\u9B4B\u9B4C\u9B55\u9B56\u9B57\u9B5B\u9B5E\u9B61\u9B63\u9B65\u9B66\u9B68\u9B6A",4,"\u9B73\u9B75\u9B77\u9B78\u9B79\u9B7F\u9B80\u9B84\u9B85\u9B86\u9B87\u9B89\u9B8A\u9B8B\u9B8D\u9B8F\u9B90\u9B94\u9B9A\u9B9D\u9B9E\u9BA6\u9BA7\u9BA9\u9BAC\u9BB0\u9BB1\u9BB2\u9BB7\u9BB8\u9BBB\u9BBC\u9BBE\u9BBF\u9BC1\u9BC7\u9BC8\u9BCE\u9BD0\u9BD7\u9BD8\u9BDD\u9BDF\u9BE5\u9BE7\u9BEA\u9BEB\u9BEF\u9BF3\u9BF7\u9BF8"],["8feba1","\u9BF9\u9BFA\u9BFD\u9BFF\u9C00\u9C02\u9C0B\u9C0F\u9C11\u9C16\u9C18\u9C19\u9C1A\u9C1C\u9C1E\u9C22\u9C23\u9C26",4,"\u9C31\u9C35\u9C36\u9C37\u9C3D\u9C41\u9C43\u9C44\u9C45\u9C49\u9C4A\u9C4E\u9C4F\u9C50\u9C53\u9C54\u9C56\u9C58\u9C5B\u9C5D\u9C5E\u9C5F\u9C63\u9C69\u9C6A\u9C5C\u9C6B\u9C68\u9C6E\u9C70\u9C72\u9C75\u9C77\u9C7B\u9CE6\u9CF2\u9CF7\u9CF9\u9D0B\u9D02\u9D11\u9D17\u9D18\u9D1C\u9D1D\u9D1E\u9D2F\u9D30\u9D32\u9D33\u9D34\u9D3A\u9D3C\u9D45\u9D3D\u9D42\u9D43\u9D47\u9D4A\u9D53\u9D54\u9D5F\u9D63\u9D62\u9D65\u9D69\u9D6A\u9D6B\u9D70\u9D76\u9D77\u9D7B"],["8feca1","\u9D7C\u9D7E\u9D83\u9D84\u9D86\u9D8A\u9D8D\u9D8E\u9D92\u9D93\u9D95\u9D96\u9D97\u9D98\u9DA1\u9DAA\u9DAC\u9DAE\u9DB1\u9DB5\u9DB9\u9DBC\u9DBF\u9DC3\u9DC7\u9DC9\u9DCA\u9DD4\u9DD5\u9DD6\u9DD7\u9DDA\u9DDE\u9DDF\u9DE0\u9DE5\u9DE7\u9DE9\u9DEB\u9DEE\u9DF0\u9DF3\u9DF4\u9DFE\u9E0A\u9E02\u9E07\u9E0E\u9E10\u9E11\u9E12\u9E15\u9E16\u9E19\u9E1C\u9E1D\u9E7A\u9E7B\u9E7C\u9E80\u9E82\u9E83\u9E84\u9E85\u9E87\u9E8E\u9E8F\u9E96\u9E98\u9E9B\u9E9E\u9EA4\u9EA8\u9EAC\u9EAE\u9EAF\u9EB0\u9EB3\u9EB4\u9EB5\u9EC6\u9EC8\u9ECB\u9ED5\u9EDF\u9EE4\u9EE7\u9EEC\u9EED\u9EEE\u9EF0\u9EF1\u9EF2\u9EF5"],["8feda1","\u9EF8\u9EFF\u9F02\u9F03\u9F09\u9F0F\u9F10\u9F11\u9F12\u9F14\u9F16\u9F17\u9F19\u9F1A\u9F1B\u9F1F\u9F22\u9F26\u9F2A\u9F2B\u9F2F\u9F31\u9F32\u9F34\u9F37\u9F39\u9F3A\u9F3C\u9F3D\u9F3F\u9F41\u9F43",4,"\u9F53\u9F55\u9F56\u9F57\u9F58\u9F5A\u9F5D\u9F5E\u9F68\u9F69\u9F6D",4,"\u9F73\u9F75\u9F7A\u9F7D\u9F8F\u9F90\u9F91\u9F92\u9F94\u9F96\u9F97\u9F9E\u9FA1\u9FA2\u9FA3\u9FA5"]]});var hh=H((Rle,DG)=>{DG.exports=[["0","\0",127,"\u20AC"],["8140","\u4E02\u4E04\u4E05\u4E06\u4E0F\u4E12\u4E17\u4E1F\u4E20\u4E21\u4E23\u4E26\u4E29\u4E2E\u4E2F\u4E31\u4E33\u4E35\u4E37\u4E3C\u4E40\u4E41\u4E42\u4E44\u4E46\u4E4A\u4E51\u4E55\u4E57\u4E5A\u4E5B\u4E62\u4E63\u4E64\u4E65\u4E67\u4E68\u4E6A",5,"\u4E72\u4E74",9,"\u4E7F",6,"\u4E87\u4E8A"],["8180","\u4E90\u4E96\u4E97\u4E99\u4E9C\u4E9D\u4E9E\u4EA3\u4EAA\u4EAF\u4EB0\u4EB1\u4EB4\u4EB6\u4EB7\u4EB8\u4EB9\u4EBC\u4EBD\u4EBE\u4EC8\u4ECC\u4ECF\u4ED0\u4ED2\u4EDA\u4EDB\u4EDC\u4EE0\u4EE2\u4EE6\u4EE7\u4EE9\u4EED\u4EEE\u4EEF\u4EF1\u4EF4\u4EF8\u4EF9\u4EFA\u4EFC\u4EFE\u4F00\u4F02",6,"\u4F0B\u4F0C\u4F12",4,"\u4F1C\u4F1D\u4F21\u4F23\u4F28\u4F29\u4F2C\u4F2D\u4F2E\u4F31\u4F33\u4F35\u4F37\u4F39\u4F3B\u4F3E",4,"\u4F44\u4F45\u4F47",5,"\u4F52\u4F54\u4F56\u4F61\u4F62\u4F66\u4F68\u4F6A\u4F6B\u4F6D\u4F6E\u4F71\u4F72\u4F75\u4F77\u4F78\u4F79\u4F7A\u4F7D\u4F80\u4F81\u4F82\u4F85\u4F86\u4F87\u4F8A\u4F8C\u4F8E\u4F90\u4F92\u4F93\u4F95\u4F96\u4F98\u4F99\u4F9A\u4F9C\u4F9E\u4F9F\u4FA1\u4FA2"],["8240","\u4FA4\u4FAB\u4FAD\u4FB0",4,"\u4FB6",8,"\u4FC0\u4FC1\u4FC2\u4FC6\u4FC7\u4FC8\u4FC9\u4FCB\u4FCC\u4FCD\u4FD2",4,"\u4FD9\u4FDB\u4FE0\u4FE2\u4FE4\u4FE5\u4FE7\u4FEB\u4FEC\u4FF0\u4FF2\u4FF4\u4FF5\u4FF6\u4FF7\u4FF9\u4FFB\u4FFC\u4FFD\u4FFF",11],["8280","\u500B\u500E\u5010\u5011\u5013\u5015\u5016\u5017\u501B\u501D\u501E\u5020\u5022\u5023\u5024\u5027\u502B\u502F",10,"\u503B\u503D\u503F\u5040\u5041\u5042\u5044\u5045\u5046\u5049\u504A\u504B\u504D\u5050",4,"\u5056\u5057\u5058\u5059\u505B\u505D",7,"\u5066",5,"\u506D",8,"\u5078\u5079\u507A\u507C\u507D\u5081\u5082\u5083\u5084\u5086\u5087\u5089\u508A\u508B\u508C\u508E",20,"\u50A4\u50A6\u50AA\u50AB\u50AD",4,"\u50B3",6,"\u50BC"],["8340","\u50BD",17,"\u50D0",5,"\u50D7\u50D8\u50D9\u50DB",10,"\u50E8\u50E9\u50EA\u50EB\u50EF\u50F0\u50F1\u50F2\u50F4\u50F6",4,"\u50FC",9,"\u5108"],["8380","\u5109\u510A\u510C",5,"\u5113",13,"\u5122",28,"\u5142\u5147\u514A\u514C\u514E\u514F\u5150\u5152\u5153\u5157\u5158\u5159\u515B\u515D",4,"\u5163\u5164\u5166\u5167\u5169\u516A\u516F\u5172\u517A\u517E\u517F\u5183\u5184\u5186\u5187\u518A\u518B\u518E\u518F\u5190\u5191\u5193\u5194\u5198\u519A\u519D\u519E\u519F\u51A1\u51A3\u51A6",4,"\u51AD\u51AE\u51B4\u51B8\u51B9\u51BA\u51BE\u51BF\u51C1\u51C2\u51C3\u51C5\u51C8\u51CA\u51CD\u51CE\u51D0\u51D2",5],["8440","\u51D8\u51D9\u51DA\u51DC\u51DE\u51DF\u51E2\u51E3\u51E5",5,"\u51EC\u51EE\u51F1\u51F2\u51F4\u51F7\u51FE\u5204\u5205\u5209\u520B\u520C\u520F\u5210\u5213\u5214\u5215\u521C\u521E\u521F\u5221\u5222\u5223\u5225\u5226\u5227\u522A\u522C\u522F\u5231\u5232\u5234\u5235\u523C\u523E\u5244",5,"\u524B\u524E\u524F\u5252\u5253\u5255\u5257\u5258"],["8480","\u5259\u525A\u525B\u525D\u525F\u5260\u5262\u5263\u5264\u5266\u5268\u526B\u526C\u526D\u526E\u5270\u5271\u5273",9,"\u527E\u5280\u5283",4,"\u5289",6,"\u5291\u5292\u5294",6,"\u529C\u52A4\u52A5\u52A6\u52A7\u52AE\u52AF\u52B0\u52B4",9,"\u52C0\u52C1\u52C2\u52C4\u52C5\u52C6\u52C8\u52CA\u52CC\u52CD\u52CE\u52CF\u52D1\u52D3\u52D4\u52D5\u52D7\u52D9",5,"\u52E0\u52E1\u52E2\u52E3\u52E5",10,"\u52F1",7,"\u52FB\u52FC\u52FD\u5301\u5302\u5303\u5304\u5307\u5309\u530A\u530B\u530C\u530E"],["8540","\u5311\u5312\u5313\u5314\u5318\u531B\u531C\u531E\u531F\u5322\u5324\u5325\u5327\u5328\u5329\u532B\u532C\u532D\u532F",9,"\u533C\u533D\u5340\u5342\u5344\u5346\u534B\u534C\u534D\u5350\u5354\u5358\u5359\u535B\u535D\u5365\u5368\u536A\u536C\u536D\u5372\u5376\u5379\u537B\u537C\u537D\u537E\u5380\u5381\u5383\u5387\u5388\u538A\u538E\u538F"],["8580","\u5390",4,"\u5396\u5397\u5399\u539B\u539C\u539E\u53A0\u53A1\u53A4\u53A7\u53AA\u53AB\u53AC\u53AD\u53AF",6,"\u53B7\u53B8\u53B9\u53BA\u53BC\u53BD\u53BE\u53C0\u53C3",4,"\u53CE\u53CF\u53D0\u53D2\u53D3\u53D5\u53DA\u53DC\u53DD\u53DE\u53E1\u53E2\u53E7\u53F4\u53FA\u53FE\u53FF\u5400\u5402\u5405\u5407\u540B\u5414\u5418\u5419\u541A\u541C\u5422\u5424\u5425\u542A\u5430\u5433\u5436\u5437\u543A\u543D\u543F\u5441\u5442\u5444\u5445\u5447\u5449\u544C\u544D\u544E\u544F\u5451\u545A\u545D",4,"\u5463\u5465\u5467\u5469",7,"\u5474\u5479\u547A\u547E\u547F\u5481\u5483\u5485\u5487\u5488\u5489\u548A\u548D\u5491\u5493\u5497\u5498\u549C\u549E\u549F\u54A0\u54A1"],["8640","\u54A2\u54A5\u54AE\u54B0\u54B2\u54B5\u54B6\u54B7\u54B9\u54BA\u54BC\u54BE\u54C3\u54C5\u54CA\u54CB\u54D6\u54D8\u54DB\u54E0",4,"\u54EB\u54EC\u54EF\u54F0\u54F1\u54F4",5,"\u54FB\u54FE\u5500\u5502\u5503\u5504\u5505\u5508\u550A",4,"\u5512\u5513\u5515",5,"\u551C\u551D\u551E\u551F\u5521\u5525\u5526"],["8680","\u5528\u5529\u552B\u552D\u5532\u5534\u5535\u5536\u5538\u5539\u553A\u553B\u553D\u5540\u5542\u5545\u5547\u5548\u554B",4,"\u5551\u5552\u5553\u5554\u5557",4,"\u555D\u555E\u555F\u5560\u5562\u5563\u5568\u5569\u556B\u556F",5,"\u5579\u557A\u557D\u557F\u5585\u5586\u558C\u558D\u558E\u5590\u5592\u5593\u5595\u5596\u5597\u559A\u559B\u559E\u55A0",6,"\u55A8",8,"\u55B2\u55B4\u55B6\u55B8\u55BA\u55BC\u55BF",4,"\u55C6\u55C7\u55C8\u55CA\u55CB\u55CE\u55CF\u55D0\u55D5\u55D7",4,"\u55DE\u55E0\u55E2\u55E7\u55E9\u55ED\u55EE\u55F0\u55F1\u55F4\u55F6\u55F8",4,"\u55FF\u5602\u5603\u5604\u5605"],["8740","\u5606\u5607\u560A\u560B\u560D\u5610",7,"\u5619\u561A\u561C\u561D\u5620\u5621\u5622\u5625\u5626\u5628\u5629\u562A\u562B\u562E\u562F\u5630\u5633\u5635\u5637\u5638\u563A\u563C\u563D\u563E\u5640",11,"\u564F",4,"\u5655\u5656\u565A\u565B\u565D",4],["8780","\u5663\u5665\u5666\u5667\u566D\u566E\u566F\u5670\u5672\u5673\u5674\u5675\u5677\u5678\u5679\u567A\u567D",7,"\u5687",6,"\u5690\u5691\u5692\u5694",14,"\u56A4",10,"\u56B0",6,"\u56B8\u56B9\u56BA\u56BB\u56BD",12,"\u56CB",8,"\u56D5\u56D6\u56D8\u56D9\u56DC\u56E3\u56E5",5,"\u56EC\u56EE\u56EF\u56F2\u56F3\u56F6\u56F7\u56F8\u56FB\u56FC\u5700\u5701\u5702\u5705\u5707\u570B",6],["8840","\u5712",9,"\u571D\u571E\u5720\u5721\u5722\u5724\u5725\u5726\u5727\u572B\u5731\u5732\u5734",4,"\u573C\u573D\u573F\u5741\u5743\u5744\u5745\u5746\u5748\u5749\u574B\u5752",4,"\u5758\u5759\u5762\u5763\u5765\u5767\u576C\u576E\u5770\u5771\u5772\u5774\u5775\u5778\u5779\u577A\u577D\u577E\u577F\u5780"],["8880","\u5781\u5787\u5788\u5789\u578A\u578D",4,"\u5794",6,"\u579C\u579D\u579E\u579F\u57A5\u57A8\u57AA\u57AC\u57AF\u57B0\u57B1\u57B3\u57B5\u57B6\u57B7\u57B9",8,"\u57C4",6,"\u57CC\u57CD\u57D0\u57D1\u57D3\u57D6\u57D7\u57DB\u57DC\u57DE\u57E1\u57E2\u57E3\u57E5",7,"\u57EE\u57F0\u57F1\u57F2\u57F3\u57F5\u57F6\u57F7\u57FB\u57FC\u57FE\u57FF\u5801\u5803\u5804\u5805\u5808\u5809\u580A\u580C\u580E\u580F\u5810\u5812\u5813\u5814\u5816\u5817\u5818\u581A\u581B\u581C\u581D\u581F\u5822\u5823\u5825",4,"\u582B",4,"\u5831\u5832\u5833\u5834\u5836",7],["8940","\u583E",5,"\u5845",6,"\u584E\u584F\u5850\u5852\u5853\u5855\u5856\u5857\u5859",4,"\u585F",5,"\u5866",4,"\u586D",16,"\u587F\u5882\u5884\u5886\u5887\u5888\u588A\u588B\u588C"],["8980","\u588D",4,"\u5894",4,"\u589B\u589C\u589D\u58A0",7,"\u58AA",17,"\u58BD\u58BE\u58BF\u58C0\u58C2\u58C3\u58C4\u58C6",10,"\u58D2\u58D3\u58D4\u58D6",13,"\u58E5",5,"\u58ED\u58EF\u58F1\u58F2\u58F4\u58F5\u58F7\u58F8\u58FA",7,"\u5903\u5905\u5906\u5908",4,"\u590E\u5910\u5911\u5912\u5913\u5917\u5918\u591B\u591D\u591E\u5920\u5921\u5922\u5923\u5926\u5928\u592C\u5930\u5932\u5933\u5935\u5936\u593B"],["8a40","\u593D\u593E\u593F\u5940\u5943\u5945\u5946\u594A\u594C\u594D\u5950\u5952\u5953\u5959\u595B",4,"\u5961\u5963\u5964\u5966",12,"\u5975\u5977\u597A\u597B\u597C\u597E\u597F\u5980\u5985\u5989\u598B\u598C\u598E\u598F\u5990\u5991\u5994\u5995\u5998\u599A\u599B\u599C\u599D\u599F\u59A0\u59A1\u59A2\u59A6"],["8a80","\u59A7\u59AC\u59AD\u59B0\u59B1\u59B3",5,"\u59BA\u59BC\u59BD\u59BF",6,"\u59C7\u59C8\u59C9\u59CC\u59CD\u59CE\u59CF\u59D5\u59D6\u59D9\u59DB\u59DE",4,"\u59E4\u59E6\u59E7\u59E9\u59EA\u59EB\u59ED",11,"\u59FA\u59FC\u59FD\u59FE\u5A00\u5A02\u5A0A\u5A0B\u5A0D\u5A0E\u5A0F\u5A10\u5A12\u5A14\u5A15\u5A16\u5A17\u5A19\u5A1A\u5A1B\u5A1D\u5A1E\u5A21\u5A22\u5A24\u5A26\u5A27\u5A28\u5A2A",6,"\u5A33\u5A35\u5A37",4,"\u5A3D\u5A3E\u5A3F\u5A41",4,"\u5A47\u5A48\u5A4B",9,"\u5A56\u5A57\u5A58\u5A59\u5A5B",5],["8b40","\u5A61\u5A63\u5A64\u5A65\u5A66\u5A68\u5A69\u5A6B",8,"\u5A78\u5A79\u5A7B\u5A7C\u5A7D\u5A7E\u5A80",17,"\u5A93",6,"\u5A9C",13,"\u5AAB\u5AAC"],["8b80","\u5AAD",4,"\u5AB4\u5AB6\u5AB7\u5AB9",4,"\u5ABF\u5AC0\u5AC3",5,"\u5ACA\u5ACB\u5ACD",4,"\u5AD3\u5AD5\u5AD7\u5AD9\u5ADA\u5ADB\u5ADD\u5ADE\u5ADF\u5AE2\u5AE4\u5AE5\u5AE7\u5AE8\u5AEA\u5AEC",4,"\u5AF2",22,"\u5B0A",11,"\u5B18",25,"\u5B33\u5B35\u5B36\u5B38",7,"\u5B41",6],["8c40","\u5B48",7,"\u5B52\u5B56\u5B5E\u5B60\u5B61\u5B67\u5B68\u5B6B\u5B6D\u5B6E\u5B6F\u5B72\u5B74\u5B76\u5B77\u5B78\u5B79\u5B7B\u5B7C\u5B7E\u5B7F\u5B82\u5B86\u5B8A\u5B8D\u5B8E\u5B90\u5B91\u5B92\u5B94\u5B96\u5B9F\u5BA7\u5BA8\u5BA9\u5BAC\u5BAD\u5BAE\u5BAF\u5BB1\u5BB2\u5BB7\u5BBA\u5BBB\u5BBC\u5BC0\u5BC1\u5BC3\u5BC8\u5BC9\u5BCA\u5BCB\u5BCD\u5BCE\u5BCF"],["8c80","\u5BD1\u5BD4",8,"\u5BE0\u5BE2\u5BE3\u5BE6\u5BE7\u5BE9",4,"\u5BEF\u5BF1",6,"\u5BFD\u5BFE\u5C00\u5C02\u5C03\u5C05\u5C07\u5C08\u5C0B\u5C0C\u5C0D\u5C0E\u5C10\u5C12\u5C13\u5C17\u5C19\u5C1B\u5C1E\u5C1F\u5C20\u5C21\u5C23\u5C26\u5C28\u5C29\u5C2A\u5C2B\u5C2D\u5C2E\u5C2F\u5C30\u5C32\u5C33\u5C35\u5C36\u5C37\u5C43\u5C44\u5C46\u5C47\u5C4C\u5C4D\u5C52\u5C53\u5C54\u5C56\u5C57\u5C58\u5C5A\u5C5B\u5C5C\u5C5D\u5C5F\u5C62\u5C64\u5C67",6,"\u5C70\u5C72",6,"\u5C7B\u5C7C\u5C7D\u5C7E\u5C80\u5C83",4,"\u5C89\u5C8A\u5C8B\u5C8E\u5C8F\u5C92\u5C93\u5C95\u5C9D",4,"\u5CA4",4],["8d40","\u5CAA\u5CAE\u5CAF\u5CB0\u5CB2\u5CB4\u5CB6\u5CB9\u5CBA\u5CBB\u5CBC\u5CBE\u5CC0\u5CC2\u5CC3\u5CC5",5,"\u5CCC",5,"\u5CD3",5,"\u5CDA",6,"\u5CE2\u5CE3\u5CE7\u5CE9\u5CEB\u5CEC\u5CEE\u5CEF\u5CF1",9,"\u5CFC",4],["8d80","\u5D01\u5D04\u5D05\u5D08",5,"\u5D0F",4,"\u5D15\u5D17\u5D18\u5D19\u5D1A\u5D1C\u5D1D\u5D1F",4,"\u5D25\u5D28\u5D2A\u5D2B\u5D2C\u5D2F",4,"\u5D35",7,"\u5D3F",7,"\u5D48\u5D49\u5D4D",10,"\u5D59\u5D5A\u5D5C\u5D5E",10,"\u5D6A\u5D6D\u5D6E\u5D70\u5D71\u5D72\u5D73\u5D75",12,"\u5D83",21,"\u5D9A\u5D9B\u5D9C\u5D9E\u5D9F\u5DA0"],["8e40","\u5DA1",21,"\u5DB8",12,"\u5DC6",6,"\u5DCE",12,"\u5DDC\u5DDF\u5DE0\u5DE3\u5DE4\u5DEA\u5DEC\u5DED"],["8e80","\u5DF0\u5DF5\u5DF6\u5DF8",4,"\u5DFF\u5E00\u5E04\u5E07\u5E09\u5E0A\u5E0B\u5E0D\u5E0E\u5E12\u5E13\u5E17\u5E1E",7,"\u5E28",4,"\u5E2F\u5E30\u5E32",4,"\u5E39\u5E3A\u5E3E\u5E3F\u5E40\u5E41\u5E43\u5E46",5,"\u5E4D",6,"\u5E56",4,"\u5E5C\u5E5D\u5E5F\u5E60\u5E63",14,"\u5E75\u5E77\u5E79\u5E7E\u5E81\u5E82\u5E83\u5E85\u5E88\u5E89\u5E8C\u5E8D\u5E8E\u5E92\u5E98\u5E9B\u5E9D\u5EA1\u5EA2\u5EA3\u5EA4\u5EA8",4,"\u5EAE",4,"\u5EB4\u5EBA\u5EBB\u5EBC\u5EBD\u5EBF",6],["8f40","\u5EC6\u5EC7\u5EC8\u5ECB",5,"\u5ED4\u5ED5\u5ED7\u5ED8\u5ED9\u5EDA\u5EDC",11,"\u5EE9\u5EEB",8,"\u5EF5\u5EF8\u5EF9\u5EFB\u5EFC\u5EFD\u5F05\u5F06\u5F07\u5F09\u5F0C\u5F0D\u5F0E\u5F10\u5F12\u5F14\u5F16\u5F19\u5F1A\u5F1C\u5F1D\u5F1E\u5F21\u5F22\u5F23\u5F24"],["8f80","\u5F28\u5F2B\u5F2C\u5F2E\u5F30\u5F32",6,"\u5F3B\u5F3D\u5F3E\u5F3F\u5F41",14,"\u5F51\u5F54\u5F59\u5F5A\u5F5B\u5F5C\u5F5E\u5F5F\u5F60\u5F63\u5F65\u5F67\u5F68\u5F6B\u5F6E\u5F6F\u5F72\u5F74\u5F75\u5F76\u5F78\u5F7A\u5F7D\u5F7E\u5F7F\u5F83\u5F86\u5F8D\u5F8E\u5F8F\u5F91\u5F93\u5F94\u5F96\u5F9A\u5F9B\u5F9D\u5F9E\u5F9F\u5FA0\u5FA2",5,"\u5FA9\u5FAB\u5FAC\u5FAF",5,"\u5FB6\u5FB8\u5FB9\u5FBA\u5FBB\u5FBE",4,"\u5FC7\u5FC8\u5FCA\u5FCB\u5FCE\u5FD3\u5FD4\u5FD5\u5FDA\u5FDB\u5FDC\u5FDE\u5FDF\u5FE2\u5FE3\u5FE5\u5FE6\u5FE8\u5FE9\u5FEC\u5FEF\u5FF0\u5FF2\u5FF3\u5FF4\u5FF6\u5FF7\u5FF9\u5FFA\u5FFC\u6007"],["9040","\u6008\u6009\u600B\u600C\u6010\u6011\u6013\u6017\u6018\u601A\u601E\u601F\u6022\u6023\u6024\u602C\u602D\u602E\u6030",4,"\u6036",4,"\u603D\u603E\u6040\u6044",6,"\u604C\u604E\u604F\u6051\u6053\u6054\u6056\u6057\u6058\u605B\u605C\u605E\u605F\u6060\u6061\u6065\u6066\u606E\u6071\u6072\u6074\u6075\u6077\u607E\u6080"],["9080","\u6081\u6082\u6085\u6086\u6087\u6088\u608A\u608B\u608E\u608F\u6090\u6091\u6093\u6095\u6097\u6098\u6099\u609C\u609E\u60A1\u60A2\u60A4\u60A5\u60A7\u60A9\u60AA\u60AE\u60B0\u60B3\u60B5\u60B6\u60B7\u60B9\u60BA\u60BD",7,"\u60C7\u60C8\u60C9\u60CC",4,"\u60D2\u60D3\u60D4\u60D6\u60D7\u60D9\u60DB\u60DE\u60E1",4,"\u60EA\u60F1\u60F2\u60F5\u60F7\u60F8\u60FB",4,"\u6102\u6103\u6104\u6105\u6107\u610A\u610B\u610C\u6110",4,"\u6116\u6117\u6118\u6119\u611B\u611C\u611D\u611E\u6121\u6122\u6125\u6128\u6129\u612A\u612C",18,"\u6140",6],["9140","\u6147\u6149\u614B\u614D\u614F\u6150\u6152\u6153\u6154\u6156",6,"\u615E\u615F\u6160\u6161\u6163\u6164\u6165\u6166\u6169",6,"\u6171\u6172\u6173\u6174\u6176\u6178",18,"\u618C\u618D\u618F",4,"\u6195"],["9180","\u6196",6,"\u619E",8,"\u61AA\u61AB\u61AD",9,"\u61B8",5,"\u61BF\u61C0\u61C1\u61C3",4,"\u61C9\u61CC",4,"\u61D3\u61D5",16,"\u61E7",13,"\u61F6",8,"\u6200",5,"\u6207\u6209\u6213\u6214\u6219\u621C\u621D\u621E\u6220\u6223\u6226\u6227\u6228\u6229\u622B\u622D\u622F\u6230\u6231\u6232\u6235\u6236\u6238",4,"\u6242\u6244\u6245\u6246\u624A"],["9240","\u624F\u6250\u6255\u6256\u6257\u6259\u625A\u625C",6,"\u6264\u6265\u6268\u6271\u6272\u6274\u6275\u6277\u6278\u627A\u627B\u627D\u6281\u6282\u6283\u6285\u6286\u6287\u6288\u628B",5,"\u6294\u6299\u629C\u629D\u629E\u62A3\u62A6\u62A7\u62A9\u62AA\u62AD\u62AE\u62AF\u62B0\u62B2\u62B3\u62B4\u62B6\u62B7\u62B8\u62BA\u62BE\u62C0\u62C1"],["9280","\u62C3\u62CB\u62CF\u62D1\u62D5\u62DD\u62DE\u62E0\u62E1\u62E4\u62EA\u62EB\u62F0\u62F2\u62F5\u62F8\u62F9\u62FA\u62FB\u6300\u6303\u6304\u6305\u6306\u630A\u630B\u630C\u630D\u630F\u6310\u6312\u6313\u6314\u6315\u6317\u6318\u6319\u631C\u6326\u6327\u6329\u632C\u632D\u632E\u6330\u6331\u6333",5,"\u633B\u633C\u633E\u633F\u6340\u6341\u6344\u6347\u6348\u634A\u6351\u6352\u6353\u6354\u6356",7,"\u6360\u6364\u6365\u6366\u6368\u636A\u636B\u636C\u636F\u6370\u6372\u6373\u6374\u6375\u6378\u6379\u637C\u637D\u637E\u637F\u6381\u6383\u6384\u6385\u6386\u638B\u638D\u6391\u6393\u6394\u6395\u6397\u6399",6,"\u63A1\u63A4\u63A6\u63AB\u63AF\u63B1\u63B2\u63B5\u63B6\u63B9\u63BB\u63BD\u63BF\u63C0"],["9340","\u63C1\u63C2\u63C3\u63C5\u63C7\u63C8\u63CA\u63CB\u63CC\u63D1\u63D3\u63D4\u63D5\u63D7",6,"\u63DF\u63E2\u63E4",4,"\u63EB\u63EC\u63EE\u63EF\u63F0\u63F1\u63F3\u63F5\u63F7\u63F9\u63FA\u63FB\u63FC\u63FE\u6403\u6404\u6406",4,"\u640D\u640E\u6411\u6412\u6415",5,"\u641D\u641F\u6422\u6423\u6424"],["9380","\u6425\u6427\u6428\u6429\u642B\u642E",5,"\u6435",4,"\u643B\u643C\u643E\u6440\u6442\u6443\u6449\u644B",6,"\u6453\u6455\u6456\u6457\u6459",4,"\u645F",7,"\u6468\u646A\u646B\u646C\u646E",9,"\u647B",6,"\u6483\u6486\u6488",8,"\u6493\u6494\u6497\u6498\u649A\u649B\u649C\u649D\u649F",4,"\u64A5\u64A6\u64A7\u64A8\u64AA\u64AB\u64AF\u64B1\u64B2\u64B3\u64B4\u64B6\u64B9\u64BB\u64BD\u64BE\u64BF\u64C1\u64C3\u64C4\u64C6",6,"\u64CF\u64D1\u64D3\u64D4\u64D5\u64D6\u64D9\u64DA"],["9440","\u64DB\u64DC\u64DD\u64DF\u64E0\u64E1\u64E3\u64E5\u64E7",24,"\u6501",7,"\u650A",7,"\u6513",4,"\u6519",8],["9480","\u6522\u6523\u6524\u6526",4,"\u652C\u652D\u6530\u6531\u6532\u6533\u6537\u653A\u653C\u653D\u6540",4,"\u6546\u6547\u654A\u654B\u654D\u654E\u6550\u6552\u6553\u6554\u6557\u6558\u655A\u655C\u655F\u6560\u6561\u6564\u6565\u6567\u6568\u6569\u656A\u656D\u656E\u656F\u6571\u6573\u6575\u6576\u6578",14,"\u6588\u6589\u658A\u658D\u658E\u658F\u6592\u6594\u6595\u6596\u6598\u659A\u659D\u659E\u65A0\u65A2\u65A3\u65A6\u65A8\u65AA\u65AC\u65AE\u65B1",7,"\u65BA\u65BB\u65BE\u65BF\u65C0\u65C2\u65C7\u65C8\u65C9\u65CA\u65CD\u65D0\u65D1\u65D3\u65D4\u65D5\u65D8",7,"\u65E1\u65E3\u65E4\u65EA\u65EB"],["9540","\u65F2\u65F3\u65F4\u65F5\u65F8\u65F9\u65FB",4,"\u6601\u6604\u6605\u6607\u6608\u6609\u660B\u660D\u6610\u6611\u6612\u6616\u6617\u6618\u661A\u661B\u661C\u661E\u6621\u6622\u6623\u6624\u6626\u6629\u662A\u662B\u662C\u662E\u6630\u6632\u6633\u6637",4,"\u663D\u663F\u6640\u6642\u6644",6,"\u664D\u664E\u6650\u6651\u6658"],["9580","\u6659\u665B\u665C\u665D\u665E\u6660\u6662\u6663\u6665\u6667\u6669",4,"\u6671\u6672\u6673\u6675\u6678\u6679\u667B\u667C\u667D\u667F\u6680\u6681\u6683\u6685\u6686\u6688\u6689\u668A\u668B\u668D\u668E\u668F\u6690\u6692\u6693\u6694\u6695\u6698",4,"\u669E",8,"\u66A9",4,"\u66AF",4,"\u66B5\u66B6\u66B7\u66B8\u66BA\u66BB\u66BC\u66BD\u66BF",25,"\u66DA\u66DE",7,"\u66E7\u66E8\u66EA",5,"\u66F1\u66F5\u66F6\u66F8\u66FA\u66FB\u66FD\u6701\u6702\u6703"],["9640","\u6704\u6705\u6706\u6707\u670C\u670E\u670F\u6711\u6712\u6713\u6716\u6718\u6719\u671A\u671C\u671E\u6720",5,"\u6727\u6729\u672E\u6730\u6732\u6733\u6736\u6737\u6738\u6739\u673B\u673C\u673E\u673F\u6741\u6744\u6745\u6747\u674A\u674B\u674D\u6752\u6754\u6755\u6757",4,"\u675D\u6762\u6763\u6764\u6766\u6767\u676B\u676C\u676E\u6771\u6774\u6776"],["9680","\u6778\u6779\u677A\u677B\u677D\u6780\u6782\u6783\u6785\u6786\u6788\u678A\u678C\u678D\u678E\u678F\u6791\u6792\u6793\u6794\u6796\u6799\u679B\u679F\u67A0\u67A1\u67A4\u67A6\u67A9\u67AC\u67AE\u67B1\u67B2\u67B4\u67B9",7,"\u67C2\u67C5",9,"\u67D5\u67D6\u67D7\u67DB\u67DF\u67E1\u67E3\u67E4\u67E6\u67E7\u67E8\u67EA\u67EB\u67ED\u67EE\u67F2\u67F5",7,"\u67FE\u6801\u6802\u6803\u6804\u6806\u680D\u6810\u6812\u6814\u6815\u6818",4,"\u681E\u681F\u6820\u6822",6,"\u682B",6,"\u6834\u6835\u6836\u683A\u683B\u683F\u6847\u684B\u684D\u684F\u6852\u6856",5],["9740","\u685C\u685D\u685E\u685F\u686A\u686C",7,"\u6875\u6878",8,"\u6882\u6884\u6887",7,"\u6890\u6891\u6892\u6894\u6895\u6896\u6898",9,"\u68A3\u68A4\u68A5\u68A9\u68AA\u68AB\u68AC\u68AE\u68B1\u68B2\u68B4\u68B6\u68B7\u68B8"],["9780","\u68B9",6,"\u68C1\u68C3",5,"\u68CA\u68CC\u68CE\u68CF\u68D0\u68D1\u68D3\u68D4\u68D6\u68D7\u68D9\u68DB",4,"\u68E1\u68E2\u68E4",9,"\u68EF\u68F2\u68F3\u68F4\u68F6\u68F7\u68F8\u68FB\u68FD\u68FE\u68FF\u6900\u6902\u6903\u6904\u6906",4,"\u690C\u690F\u6911\u6913",11,"\u6921\u6922\u6923\u6925",7,"\u692E\u692F\u6931\u6932\u6933\u6935\u6936\u6937\u6938\u693A\u693B\u693C\u693E\u6940\u6941\u6943",16,"\u6955\u6956\u6958\u6959\u695B\u695C\u695F"],["9840","\u6961\u6962\u6964\u6965\u6967\u6968\u6969\u696A\u696C\u696D\u696F\u6970\u6972",4,"\u697A\u697B\u697D\u697E\u697F\u6981\u6983\u6985\u698A\u698B\u698C\u698E",5,"\u6996\u6997\u6999\u699A\u699D",9,"\u69A9\u69AA\u69AC\u69AE\u69AF\u69B0\u69B2\u69B3\u69B5\u69B6\u69B8\u69B9\u69BA\u69BC\u69BD"],["9880","\u69BE\u69BF\u69C0\u69C2",7,"\u69CB\u69CD\u69CF\u69D1\u69D2\u69D3\u69D5",5,"\u69DC\u69DD\u69DE\u69E1",11,"\u69EE\u69EF\u69F0\u69F1\u69F3",9,"\u69FE\u6A00",9,"\u6A0B",11,"\u6A19",5,"\u6A20\u6A22",5,"\u6A29\u6A2B\u6A2C\u6A2D\u6A2E\u6A30\u6A32\u6A33\u6A34\u6A36",6,"\u6A3F",4,"\u6A45\u6A46\u6A48",7,"\u6A51",6,"\u6A5A"],["9940","\u6A5C",4,"\u6A62\u6A63\u6A64\u6A66",10,"\u6A72",6,"\u6A7A\u6A7B\u6A7D\u6A7E\u6A7F\u6A81\u6A82\u6A83\u6A85",8,"\u6A8F\u6A92",4,"\u6A98",7,"\u6AA1",5],["9980","\u6AA7\u6AA8\u6AAA\u6AAD",114,"\u6B25\u6B26\u6B28",6],["9a40","\u6B2F\u6B30\u6B31\u6B33\u6B34\u6B35\u6B36\u6B38\u6B3B\u6B3C\u6B3D\u6B3F\u6B40\u6B41\u6B42\u6B44\u6B45\u6B48\u6B4A\u6B4B\u6B4D",11,"\u6B5A",7,"\u6B68\u6B69\u6B6B",13,"\u6B7A\u6B7D\u6B7E\u6B7F\u6B80\u6B85\u6B88"],["9a80","\u6B8C\u6B8E\u6B8F\u6B90\u6B91\u6B94\u6B95\u6B97\u6B98\u6B99\u6B9C",4,"\u6BA2",7,"\u6BAB",7,"\u6BB6\u6BB8",6,"\u6BC0\u6BC3\u6BC4\u6BC6",4,"\u6BCC\u6BCE\u6BD0\u6BD1\u6BD8\u6BDA\u6BDC",4,"\u6BE2",7,"\u6BEC\u6BED\u6BEE\u6BF0\u6BF1\u6BF2\u6BF4\u6BF6\u6BF7\u6BF8\u6BFA\u6BFB\u6BFC\u6BFE",6,"\u6C08",4,"\u6C0E\u6C12\u6C17\u6C1C\u6C1D\u6C1E\u6C20\u6C23\u6C25\u6C2B\u6C2C\u6C2D\u6C31\u6C33\u6C36\u6C37\u6C39\u6C3A\u6C3B\u6C3C\u6C3E\u6C3F\u6C43\u6C44\u6C45\u6C48\u6C4B",4,"\u6C51\u6C52\u6C53\u6C56\u6C58"],["9b40","\u6C59\u6C5A\u6C62\u6C63\u6C65\u6C66\u6C67\u6C6B",4,"\u6C71\u6C73\u6C75\u6C77\u6C78\u6C7A\u6C7B\u6C7C\u6C7F\u6C80\u6C84\u6C87\u6C8A\u6C8B\u6C8D\u6C8E\u6C91\u6C92\u6C95\u6C96\u6C97\u6C98\u6C9A\u6C9C\u6C9D\u6C9E\u6CA0\u6CA2\u6CA8\u6CAC\u6CAF\u6CB0\u6CB4\u6CB5\u6CB6\u6CB7\u6CBA\u6CC0\u6CC1\u6CC2\u6CC3\u6CC6\u6CC7\u6CC8\u6CCB\u6CCD\u6CCE\u6CCF\u6CD1\u6CD2\u6CD8"],["9b80","\u6CD9\u6CDA\u6CDC\u6CDD\u6CDF\u6CE4\u6CE6\u6CE7\u6CE9\u6CEC\u6CED\u6CF2\u6CF4\u6CF9\u6CFF\u6D00\u6D02\u6D03\u6D05\u6D06\u6D08\u6D09\u6D0A\u6D0D\u6D0F\u6D10\u6D11\u6D13\u6D14\u6D15\u6D16\u6D18\u6D1C\u6D1D\u6D1F",5,"\u6D26\u6D28\u6D29\u6D2C\u6D2D\u6D2F\u6D30\u6D34\u6D36\u6D37\u6D38\u6D3A\u6D3F\u6D40\u6D42\u6D44\u6D49\u6D4C\u6D50\u6D55\u6D56\u6D57\u6D58\u6D5B\u6D5D\u6D5F\u6D61\u6D62\u6D64\u6D65\u6D67\u6D68\u6D6B\u6D6C\u6D6D\u6D70\u6D71\u6D72\u6D73\u6D75\u6D76\u6D79\u6D7A\u6D7B\u6D7D",4,"\u6D83\u6D84\u6D86\u6D87\u6D8A\u6D8B\u6D8D\u6D8F\u6D90\u6D92\u6D96",4,"\u6D9C\u6DA2\u6DA5\u6DAC\u6DAD\u6DB0\u6DB1\u6DB3\u6DB4\u6DB6\u6DB7\u6DB9",5,"\u6DC1\u6DC2\u6DC3\u6DC8\u6DC9\u6DCA"],["9c40","\u6DCD\u6DCE\u6DCF\u6DD0\u6DD2\u6DD3\u6DD4\u6DD5\u6DD7\u6DDA\u6DDB\u6DDC\u6DDF\u6DE2\u6DE3\u6DE5\u6DE7\u6DE8\u6DE9\u6DEA\u6DED\u6DEF\u6DF0\u6DF2\u6DF4\u6DF5\u6DF6\u6DF8\u6DFA\u6DFD",7,"\u6E06\u6E07\u6E08\u6E09\u6E0B\u6E0F\u6E12\u6E13\u6E15\u6E18\u6E19\u6E1B\u6E1C\u6E1E\u6E1F\u6E22\u6E26\u6E27\u6E28\u6E2A\u6E2C\u6E2E\u6E30\u6E31\u6E33\u6E35"],["9c80","\u6E36\u6E37\u6E39\u6E3B",7,"\u6E45",7,"\u6E4F\u6E50\u6E51\u6E52\u6E55\u6E57\u6E59\u6E5A\u6E5C\u6E5D\u6E5E\u6E60",10,"\u6E6C\u6E6D\u6E6F",14,"\u6E80\u6E81\u6E82\u6E84\u6E87\u6E88\u6E8A",4,"\u6E91",6,"\u6E99\u6E9A\u6E9B\u6E9D\u6E9E\u6EA0\u6EA1\u6EA3\u6EA4\u6EA6\u6EA8\u6EA9\u6EAB\u6EAC\u6EAD\u6EAE\u6EB0\u6EB3\u6EB5\u6EB8\u6EB9\u6EBC\u6EBE\u6EBF\u6EC0\u6EC3\u6EC4\u6EC5\u6EC6\u6EC8\u6EC9\u6ECA\u6ECC\u6ECD\u6ECE\u6ED0\u6ED2\u6ED6\u6ED8\u6ED9\u6EDB\u6EDC\u6EDD\u6EE3\u6EE7\u6EEA",5],["9d40","\u6EF0\u6EF1\u6EF2\u6EF3\u6EF5\u6EF6\u6EF7\u6EF8\u6EFA",7,"\u6F03\u6F04\u6F05\u6F07\u6F08\u6F0A",4,"\u6F10\u6F11\u6F12\u6F16",9,"\u6F21\u6F22\u6F23\u6F25\u6F26\u6F27\u6F28\u6F2C\u6F2E\u6F30\u6F32\u6F34\u6F35\u6F37",6,"\u6F3F\u6F40\u6F41\u6F42"],["9d80","\u6F43\u6F44\u6F45\u6F48\u6F49\u6F4A\u6F4C\u6F4E",9,"\u6F59\u6F5A\u6F5B\u6F5D\u6F5F\u6F60\u6F61\u6F63\u6F64\u6F65\u6F67",5,"\u6F6F\u6F70\u6F71\u6F73\u6F75\u6F76\u6F77\u6F79\u6F7B\u6F7D",6,"\u6F85\u6F86\u6F87\u6F8A\u6F8B\u6F8F",12,"\u6F9D\u6F9E\u6F9F\u6FA0\u6FA2",4,"\u6FA8",10,"\u6FB4\u6FB5\u6FB7\u6FB8\u6FBA",5,"\u6FC1\u6FC3",5,"\u6FCA",6,"\u6FD3",10,"\u6FDF\u6FE2\u6FE3\u6FE4\u6FE5"],["9e40","\u6FE6",7,"\u6FF0",32,"\u7012",7,"\u701C",6,"\u7024",6],["9e80","\u702B",9,"\u7036\u7037\u7038\u703A",17,"\u704D\u704E\u7050",13,"\u705F",11,"\u706E\u7071\u7072\u7073\u7074\u7077\u7079\u707A\u707B\u707D\u7081\u7082\u7083\u7084\u7086\u7087\u7088\u708B\u708C\u708D\u708F\u7090\u7091\u7093\u7097\u7098\u709A\u709B\u709E",12,"\u70B0\u70B2\u70B4\u70B5\u70B6\u70BA\u70BE\u70BF\u70C4\u70C5\u70C6\u70C7\u70C9\u70CB",12,"\u70DA"],["9f40","\u70DC\u70DD\u70DE\u70E0\u70E1\u70E2\u70E3\u70E5\u70EA\u70EE\u70F0",6,"\u70F8\u70FA\u70FB\u70FC\u70FE",10,"\u710B",4,"\u7111\u7112\u7114\u7117\u711B",10,"\u7127",7,"\u7132\u7133\u7134"],["9f80","\u7135\u7137",13,"\u7146\u7147\u7148\u7149\u714B\u714D\u714F",12,"\u715D\u715F",4,"\u7165\u7169",4,"\u716F\u7170\u7171\u7174\u7175\u7176\u7177\u7179\u717B\u717C\u717E",5,"\u7185",4,"\u718B\u718C\u718D\u718E\u7190\u7191\u7192\u7193\u7195\u7196\u7197\u719A",4,"\u71A1",6,"\u71A9\u71AA\u71AB\u71AD",5,"\u71B4\u71B6\u71B7\u71B8\u71BA",8,"\u71C4",9,"\u71CF",4],["a040","\u71D6",9,"\u71E1\u71E2\u71E3\u71E4\u71E6\u71E8",5,"\u71EF",9,"\u71FA",11,"\u7207",19],["a080","\u721B\u721C\u721E",9,"\u7229\u722B\u722D\u722E\u722F\u7232\u7233\u7234\u723A\u723C\u723E\u7240",6,"\u7249\u724A\u724B\u724E\u724F\u7250\u7251\u7253\u7254\u7255\u7257\u7258\u725A\u725C\u725E\u7260\u7263\u7264\u7265\u7268\u726A\u726B\u726C\u726D\u7270\u7271\u7273\u7274\u7276\u7277\u7278\u727B\u727C\u727D\u7282\u7283\u7285",4,"\u728C\u728E\u7290\u7291\u7293",11,"\u72A0",11,"\u72AE\u72B1\u72B2\u72B3\u72B5\u72BA",6,"\u72C5\u72C6\u72C7\u72C9\u72CA\u72CB\u72CC\u72CF\u72D1\u72D3\u72D4\u72D5\u72D6\u72D8\u72DA\u72DB"],["a1a1","\u3000\u3001\u3002\xB7\u02C9\u02C7\xA8\u3003\u3005\u2014\uFF5E\u2016\u2026\u2018\u2019\u201C\u201D\u3014\u3015\u3008",7,"\u3016\u3017\u3010\u3011\xB1\xD7\xF7\u2236\u2227\u2228\u2211\u220F\u222A\u2229\u2208\u2237\u221A\u22A5\u2225\u2220\u2312\u2299\u222B\u222E\u2261\u224C\u2248\u223D\u221D\u2260\u226E\u226F\u2264\u2265\u221E\u2235\u2234\u2642\u2640\xB0\u2032\u2033\u2103\uFF04\xA4\uFFE0\uFFE1\u2030\xA7\u2116\u2606\u2605\u25CB\u25CF\u25CE\u25C7\u25C6\u25A1\u25A0\u25B3\u25B2\u203B\u2192\u2190\u2191\u2193\u3013"],["a2a1","\u2170",9],["a2b1","\u2488",19,"\u2474",19,"\u2460",9],["a2e5","\u3220",9],["a2f1","\u2160",11],["a3a1","\uFF01\uFF02\uFF03\uFFE5\uFF05",88,"\uFFE3"],["a4a1","\u3041",82],["a5a1","\u30A1",85],["a6a1","\u0391",16,"\u03A3",6],["a6c1","\u03B1",16,"\u03C3",6],["a6e0","\uFE35\uFE36\uFE39\uFE3A\uFE3F\uFE40\uFE3D\uFE3E\uFE41\uFE42\uFE43\uFE44"],["a6ee","\uFE3B\uFE3C\uFE37\uFE38\uFE31"],["a6f4","\uFE33\uFE34"],["a7a1","\u0410",5,"\u0401\u0416",25],["a7d1","\u0430",5,"\u0451\u0436",25],["a840","\u02CA\u02CB\u02D9\u2013\u2015\u2025\u2035\u2105\u2109\u2196\u2197\u2198\u2199\u2215\u221F\u2223\u2252\u2266\u2267\u22BF\u2550",35,"\u2581",6],["a880","\u2588",7,"\u2593\u2594\u2595\u25BC\u25BD\u25E2\u25E3\u25E4\u25E5\u2609\u2295\u3012\u301D\u301E"],["a8a1","\u0101\xE1\u01CE\xE0\u0113\xE9\u011B\xE8\u012B\xED\u01D0\xEC\u014D\xF3\u01D2\xF2\u016B\xFA\u01D4\xF9\u01D6\u01D8\u01DA\u01DC\xFC\xEA\u0251"],["a8bd","\u0144\u0148"],["a8c0","\u0261"],["a8c5","\u3105",36],["a940","\u3021",8,"\u32A3\u338E\u338F\u339C\u339D\u339E\u33A1\u33C4\u33CE\u33D1\u33D2\u33D5\uFE30\uFFE2\uFFE4"],["a959","\u2121\u3231"],["a95c","\u2010"],["a960","\u30FC\u309B\u309C\u30FD\u30FE\u3006\u309D\u309E\uFE49",9,"\uFE54\uFE55\uFE56\uFE57\uFE59",8],["a980","\uFE62",4,"\uFE68\uFE69\uFE6A\uFE6B"],["a996","\u3007"],["a9a4","\u2500",75],["aa40","\u72DC\u72DD\u72DF\u72E2",5,"\u72EA\u72EB\u72F5\u72F6\u72F9\u72FD\u72FE\u72FF\u7300\u7302\u7304",5,"\u730B\u730C\u730D\u730F\u7310\u7311\u7312\u7314\u7318\u7319\u731A\u731F\u7320\u7323\u7324\u7326\u7327\u7328\u732D\u732F\u7330\u7332\u7333\u7335\u7336\u733A\u733B\u733C\u733D\u7340",8],["aa80","\u7349\u734A\u734B\u734C\u734E\u734F\u7351\u7353\u7354\u7355\u7356\u7358",7,"\u7361",10,"\u736E\u7370\u7371"],["ab40","\u7372",11,"\u737F",4,"\u7385\u7386\u7388\u738A\u738C\u738D\u738F\u7390\u7392\u7393\u7394\u7395\u7397\u7398\u7399\u739A\u739C\u739D\u739E\u73A0\u73A1\u73A3",5,"\u73AA\u73AC\u73AD\u73B1\u73B4\u73B5\u73B6\u73B8\u73B9\u73BC\u73BD\u73BE\u73BF\u73C1\u73C3",4],["ab80","\u73CB\u73CC\u73CE\u73D2",6,"\u73DA\u73DB\u73DC\u73DD\u73DF\u73E1\u73E2\u73E3\u73E4\u73E6\u73E8\u73EA\u73EB\u73EC\u73EE\u73EF\u73F0\u73F1\u73F3",4],["ac40","\u73F8",10,"\u7404\u7407\u7408\u740B\u740C\u740D\u740E\u7411",8,"\u741C",5,"\u7423\u7424\u7427\u7429\u742B\u742D\u742F\u7431\u7432\u7437",4,"\u743D\u743E\u743F\u7440\u7442",11],["ac80","\u744E",6,"\u7456\u7458\u745D\u7460",12,"\u746E\u746F\u7471",4,"\u7478\u7479\u747A"],["ad40","\u747B\u747C\u747D\u747F\u7482\u7484\u7485\u7486\u7488\u7489\u748A\u748C\u748D\u748F\u7491",10,"\u749D\u749F",7,"\u74AA",15,"\u74BB",12],["ad80","\u74C8",9,"\u74D3",8,"\u74DD\u74DF\u74E1\u74E5\u74E7",6,"\u74F0\u74F1\u74F2"],["ae40","\u74F3\u74F5\u74F8",6,"\u7500\u7501\u7502\u7503\u7505",7,"\u750E\u7510\u7512\u7514\u7515\u7516\u7517\u751B\u751D\u751E\u7520",4,"\u7526\u7527\u752A\u752E\u7534\u7536\u7539\u753C\u753D\u753F\u7541\u7542\u7543\u7544\u7546\u7547\u7549\u754A\u754D\u7550\u7551\u7552\u7553\u7555\u7556\u7557\u7558"],["ae80","\u755D",7,"\u7567\u7568\u7569\u756B",6,"\u7573\u7575\u7576\u7577\u757A",4,"\u7580\u7581\u7582\u7584\u7585\u7587"],["af40","\u7588\u7589\u758A\u758C\u758D\u758E\u7590\u7593\u7595\u7598\u759B\u759C\u759E\u75A2\u75A6",4,"\u75AD\u75B6\u75B7\u75BA\u75BB\u75BF\u75C0\u75C1\u75C6\u75CB\u75CC\u75CE\u75CF\u75D0\u75D1\u75D3\u75D7\u75D9\u75DA\u75DC\u75DD\u75DF\u75E0\u75E1\u75E5\u75E9\u75EC\u75ED\u75EE\u75EF\u75F2\u75F3\u75F5\u75F6\u75F7\u75F8\u75FA\u75FB\u75FD\u75FE\u7602\u7604\u7606\u7607"],["af80","\u7608\u7609\u760B\u760D\u760E\u760F\u7611\u7612\u7613\u7614\u7616\u761A\u761C\u761D\u761E\u7621\u7623\u7627\u7628\u762C\u762E\u762F\u7631\u7632\u7636\u7637\u7639\u763A\u763B\u763D\u7641\u7642\u7644"],["b040","\u7645",6,"\u764E",5,"\u7655\u7657",4,"\u765D\u765F\u7660\u7661\u7662\u7664",6,"\u766C\u766D\u766E\u7670",7,"\u7679\u767A\u767C\u767F\u7680\u7681\u7683\u7685\u7689\u768A\u768C\u768D\u768F\u7690\u7692\u7694\u7695\u7697\u7698\u769A\u769B"],["b080","\u769C",7,"\u76A5",8,"\u76AF\u76B0\u76B3\u76B5",9,"\u76C0\u76C1\u76C3\u554A\u963F\u57C3\u6328\u54CE\u5509\u54C0\u7691\u764C\u853C\u77EE\u827E\u788D\u7231\u9698\u978D\u6C28\u5B89\u4FFA\u6309\u6697\u5CB8\u80FA\u6848\u80AE\u6602\u76CE\u51F9\u6556\u71AC\u7FF1\u8884\u50B2\u5965\u61CA\u6FB3\u82AD\u634C\u6252\u53ED\u5427\u7B06\u516B\u75A4\u5DF4\u62D4\u8DCB\u9776\u628A\u8019\u575D\u9738\u7F62\u7238\u767D\u67CF\u767E\u6446\u4F70\u8D25\u62DC\u7A17\u6591\u73ED\u642C\u6273\u822C\u9881\u677F\u7248\u626E\u62CC\u4F34\u74E3\u534A\u529E\u7ECA\u90A6\u5E2E\u6886\u699C\u8180\u7ED1\u68D2\u78C5\u868C\u9551\u508D\u8C24\u82DE\u80DE\u5305\u8912\u5265"],["b140","\u76C4\u76C7\u76C9\u76CB\u76CC\u76D3\u76D5\u76D9\u76DA\u76DC\u76DD\u76DE\u76E0",4,"\u76E6",7,"\u76F0\u76F3\u76F5\u76F6\u76F7\u76FA\u76FB\u76FD\u76FF\u7700\u7702\u7703\u7705\u7706\u770A\u770C\u770E",10,"\u771B\u771C\u771D\u771E\u7721\u7723\u7724\u7725\u7727\u772A\u772B"],["b180","\u772C\u772E\u7730",4,"\u7739\u773B\u773D\u773E\u773F\u7742\u7744\u7745\u7746\u7748",7,"\u7752",7,"\u775C\u8584\u96F9\u4FDD\u5821\u9971\u5B9D\u62B1\u62A5\u66B4\u8C79\u9C8D\u7206\u676F\u7891\u60B2\u5351\u5317\u8F88\u80CC\u8D1D\u94A1\u500D\u72C8\u5907\u60EB\u7119\u88AB\u5954\u82EF\u672C\u7B28\u5D29\u7EF7\u752D\u6CF5\u8E66\u8FF8\u903C\u9F3B\u6BD4\u9119\u7B14\u5F7C\u78A7\u84D6\u853D\u6BD5\u6BD9\u6BD6\u5E01\u5E87\u75F9\u95ED\u655D\u5F0A\u5FC5\u8F9F\u58C1\u81C2\u907F\u965B\u97AD\u8FB9\u7F16\u8D2C\u6241\u4FBF\u53D8\u535E\u8FA8\u8FA9\u8FAB\u904D\u6807\u5F6A\u8198\u8868\u9CD6\u618B\u522B\u762A\u5F6C\u658C\u6FD2\u6EE8\u5BBE\u6448\u5175\u51B0\u67C4\u4E19\u79C9\u997C\u70B3"],["b240","\u775D\u775E\u775F\u7760\u7764\u7767\u7769\u776A\u776D",11,"\u777A\u777B\u777C\u7781\u7782\u7783\u7786",5,"\u778F\u7790\u7793",11,"\u77A1\u77A3\u77A4\u77A6\u77A8\u77AB\u77AD\u77AE\u77AF\u77B1\u77B2\u77B4\u77B6",4],["b280","\u77BC\u77BE\u77C0",12,"\u77CE",8,"\u77D8\u77D9\u77DA\u77DD",4,"\u77E4\u75C5\u5E76\u73BB\u83E0\u64AD\u62E8\u94B5\u6CE2\u535A\u52C3\u640F\u94C2\u7B94\u4F2F\u5E1B\u8236\u8116\u818A\u6E24\u6CCA\u9A73\u6355\u535C\u54FA\u8865\u57E0\u4E0D\u5E03\u6B65\u7C3F\u90E8\u6016\u64E6\u731C\u88C1\u6750\u624D\u8D22\u776C\u8E29\u91C7\u5F69\u83DC\u8521\u9910\u53C2\u8695\u6B8B\u60ED\u60E8\u707F\u82CD\u8231\u4ED3\u6CA7\u85CF\u64CD\u7CD9\u69FD\u66F9\u8349\u5395\u7B56\u4FA7\u518C\u6D4B\u5C42\u8E6D\u63D2\u53C9\u832C\u8336\u67E5\u78B4\u643D\u5BDF\u5C94\u5DEE\u8BE7\u62C6\u67F4\u8C7A\u6400\u63BA\u8749\u998B\u8C17\u7F20\u94F2\u4EA7\u9610\u98A4\u660C\u7316"],["b340","\u77E6\u77E8\u77EA\u77EF\u77F0\u77F1\u77F2\u77F4\u77F5\u77F7\u77F9\u77FA\u77FB\u77FC\u7803",5,"\u780A\u780B\u780E\u780F\u7810\u7813\u7815\u7819\u781B\u781E\u7820\u7821\u7822\u7824\u7828\u782A\u782B\u782E\u782F\u7831\u7832\u7833\u7835\u7836\u783D\u783F\u7841\u7842\u7843\u7844\u7846\u7848\u7849\u784A\u784B\u784D\u784F\u7851\u7853\u7854\u7858\u7859\u785A"],["b380","\u785B\u785C\u785E",11,"\u786F",7,"\u7878\u7879\u787A\u787B\u787D",6,"\u573A\u5C1D\u5E38\u957F\u507F\u80A0\u5382\u655E\u7545\u5531\u5021\u8D85\u6284\u949E\u671D\u5632\u6F6E\u5DE2\u5435\u7092\u8F66\u626F\u64A4\u63A3\u5F7B\u6F88\u90F4\u81E3\u8FB0\u5C18\u6668\u5FF1\u6C89\u9648\u8D81\u886C\u6491\u79F0\u57CE\u6A59\u6210\u5448\u4E58\u7A0B\u60E9\u6F84\u8BDA\u627F\u901E\u9A8B\u79E4\u5403\u75F4\u6301\u5319\u6C60\u8FDF\u5F1B\u9A70\u803B\u9F7F\u4F88\u5C3A\u8D64\u7FC5\u65A5\u70BD\u5145\u51B2\u866B\u5D07\u5BA0\u62BD\u916C\u7574\u8E0C\u7A20\u6101\u7B79\u4EC7\u7EF8\u7785\u4E11\u81ED\u521D\u51FA\u6A71\u53A8\u8E87\u9504\u96CF\u6EC1\u9664\u695A"],["b440","\u7884\u7885\u7886\u7888\u788A\u788B\u788F\u7890\u7892\u7894\u7895\u7896\u7899\u789D\u789E\u78A0\u78A2\u78A4\u78A6\u78A8",7,"\u78B5\u78B6\u78B7\u78B8\u78BA\u78BB\u78BC\u78BD\u78BF\u78C0\u78C2\u78C3\u78C4\u78C6\u78C7\u78C8\u78CC\u78CD\u78CE\u78CF\u78D1\u78D2\u78D3\u78D6\u78D7\u78D8\u78DA",9],["b480","\u78E4\u78E5\u78E6\u78E7\u78E9\u78EA\u78EB\u78ED",4,"\u78F3\u78F5\u78F6\u78F8\u78F9\u78FB",5,"\u7902\u7903\u7904\u7906",6,"\u7840\u50A8\u77D7\u6410\u89E6\u5904\u63E3\u5DDD\u7A7F\u693D\u4F20\u8239\u5598\u4E32\u75AE\u7A97\u5E62\u5E8A\u95EF\u521B\u5439\u708A\u6376\u9524\u5782\u6625\u693F\u9187\u5507\u6DF3\u7EAF\u8822\u6233\u7EF0\u75B5\u8328\u78C1\u96CC\u8F9E\u6148\u74F7\u8BCD\u6B64\u523A\u8D50\u6B21\u806A\u8471\u56F1\u5306\u4ECE\u4E1B\u51D1\u7C97\u918B\u7C07\u4FC3\u8E7F\u7BE1\u7A9C\u6467\u5D14\u50AC\u8106\u7601\u7CB9\u6DEC\u7FE0\u6751\u5B58\u5BF8\u78CB\u64AE\u6413\u63AA\u632B\u9519\u642D\u8FBE\u7B54\u7629\u6253\u5927\u5446\u6B79\u50A3\u6234\u5E26\u6B86\u4EE3\u8D37\u888B\u5F85\u902E"],["b540","\u790D",5,"\u7914",9,"\u791F",4,"\u7925",14,"\u7935",4,"\u793D\u793F\u7942\u7943\u7944\u7945\u7947\u794A",8,"\u7954\u7955\u7958\u7959\u7961\u7963"],["b580","\u7964\u7966\u7969\u796A\u796B\u796C\u796E\u7970",6,"\u7979\u797B",4,"\u7982\u7983\u7986\u7987\u7988\u7989\u798B\u798C\u798D\u798E\u7990\u7991\u7992\u6020\u803D\u62C5\u4E39\u5355\u90F8\u63B8\u80C6\u65E6\u6C2E\u4F46\u60EE\u6DE1\u8BDE\u5F39\u86CB\u5F53\u6321\u515A\u8361\u6863\u5200\u6363\u8E48\u5012\u5C9B\u7977\u5BFC\u5230\u7A3B\u60BC\u9053\u76D7\u5FB7\u5F97\u7684\u8E6C\u706F\u767B\u7B49\u77AA\u51F3\u9093\u5824\u4F4E\u6EF4\u8FEA\u654C\u7B1B\u72C4\u6DA4\u7FDF\u5AE1\u62B5\u5E95\u5730\u8482\u7B2C\u5E1D\u5F1F\u9012\u7F14\u98A0\u6382\u6EC7\u7898\u70B9\u5178\u975B\u57AB\u7535\u4F43\u7538\u5E97\u60E6\u5960\u6DC0\u6BBF\u7889\u53FC\u96D5\u51CB\u5201\u6389\u540A\u9493\u8C03\u8DCC\u7239\u789F\u8776\u8FED\u8C0D\u53E0"],["b640","\u7993",6,"\u799B",11,"\u79A8",10,"\u79B4",4,"\u79BC\u79BF\u79C2\u79C4\u79C5\u79C7\u79C8\u79CA\u79CC\u79CE\u79CF\u79D0\u79D3\u79D4\u79D6\u79D7\u79D9",5,"\u79E0\u79E1\u79E2\u79E5\u79E8\u79EA"],["b680","\u79EC\u79EE\u79F1",6,"\u79F9\u79FA\u79FC\u79FE\u79FF\u7A01\u7A04\u7A05\u7A07\u7A08\u7A09\u7A0A\u7A0C\u7A0F",4,"\u7A15\u7A16\u7A18\u7A19\u7A1B\u7A1C\u4E01\u76EF\u53EE\u9489\u9876\u9F0E\u952D\u5B9A\u8BA2\u4E22\u4E1C\u51AC\u8463\u61C2\u52A8\u680B\u4F97\u606B\u51BB\u6D1E\u515C\u6296\u6597\u9661\u8C46\u9017\u75D8\u90FD\u7763\u6BD2\u728A\u72EC\u8BFB\u5835\u7779\u8D4C\u675C\u9540\u809A\u5EA6\u6E21\u5992\u7AEF\u77ED\u953B\u6BB5\u65AD\u7F0E\u5806\u5151\u961F\u5BF9\u58A9\u5428\u8E72\u6566\u987F\u56E4\u949D\u76FE\u9041\u6387\u54C6\u591A\u593A\u579B\u8EB2\u6735\u8DFA\u8235\u5241\u60F0\u5815\u86FE\u5CE8\u9E45\u4FC4\u989D\u8BB9\u5A25\u6076\u5384\u627C\u904F\u9102\u997F\u6069\u800C\u513F\u8033\u5C14\u9975\u6D31\u4E8C"],["b740","\u7A1D\u7A1F\u7A21\u7A22\u7A24",14,"\u7A34\u7A35\u7A36\u7A38\u7A3A\u7A3E\u7A40",5,"\u7A47",9,"\u7A52",4,"\u7A58",16],["b780","\u7A69",6,"\u7A71\u7A72\u7A73\u7A75\u7A7B\u7A7C\u7A7D\u7A7E\u7A82\u7A85\u7A87\u7A89\u7A8A\u7A8B\u7A8C\u7A8E\u7A8F\u7A90\u7A93\u7A94\u7A99\u7A9A\u7A9B\u7A9E\u7AA1\u7AA2\u8D30\u53D1\u7F5A\u7B4F\u4F10\u4E4F\u9600\u6CD5\u73D0\u85E9\u5E06\u756A\u7FFB\u6A0A\u77FE\u9492\u7E41\u51E1\u70E6\u53CD\u8FD4\u8303\u8D29\u72AF\u996D\u6CDB\u574A\u82B3\u65B9\u80AA\u623F\u9632\u59A8\u4EFF\u8BBF\u7EBA\u653E\u83F2\u975E\u5561\u98DE\u80A5\u532A\u8BFD\u5420\u80BA\u5E9F\u6CB8\u8D39\u82AC\u915A\u5429\u6C1B\u5206\u7EB7\u575F\u711A\u6C7E\u7C89\u594B\u4EFD\u5FFF\u6124\u7CAA\u4E30\u5C01\u67AB\u8702\u5CF0\u950B\u98CE\u75AF\u70FD\u9022\u51AF\u7F1D\u8BBD\u5949\u51E4\u4F5B\u5426\u592B\u6577\u80A4\u5B75\u6276\u62C2\u8F90\u5E45\u6C1F\u7B26\u4F0F\u4FD8\u670D"],["b840","\u7AA3\u7AA4\u7AA7\u7AA9\u7AAA\u7AAB\u7AAE",4,"\u7AB4",10,"\u7AC0",10,"\u7ACC",9,"\u7AD7\u7AD8\u7ADA\u7ADB\u7ADC\u7ADD\u7AE1\u7AE2\u7AE4\u7AE7",5,"\u7AEE\u7AF0\u7AF1\u7AF2\u7AF3"],["b880","\u7AF4",4,"\u7AFB\u7AFC\u7AFE\u7B00\u7B01\u7B02\u7B05\u7B07\u7B09\u7B0C\u7B0D\u7B0E\u7B10\u7B12\u7B13\u7B16\u7B17\u7B18\u7B1A\u7B1C\u7B1D\u7B1F\u7B21\u7B22\u7B23\u7B27\u7B29\u7B2D\u6D6E\u6DAA\u798F\u88B1\u5F17\u752B\u629A\u8F85\u4FEF\u91DC\u65A7\u812F\u8151\u5E9C\u8150\u8D74\u526F\u8986\u8D4B\u590D\u5085\u4ED8\u961C\u7236\u8179\u8D1F\u5BCC\u8BA3\u9644\u5987\u7F1A\u5490\u5676\u560E\u8BE5\u6539\u6982\u9499\u76D6\u6E89\u5E72\u7518\u6746\u67D1\u7AFF\u809D\u8D76\u611F\u79C6\u6562\u8D63\u5188\u521A\u94A2\u7F38\u809B\u7EB2\u5C97\u6E2F\u6760\u7BD9\u768B\u9AD8\u818F\u7F94\u7CD5\u641E\u9550\u7A3F\u544A\u54E5\u6B4C\u6401\u6208\u9E3D\u80F3\u7599\u5272\u9769\u845B\u683C\u86E4\u9601\u9694\u94EC\u4E2A\u5404\u7ED9\u6839\u8DDF\u8015\u66F4\u5E9A\u7FB9"],["b940","\u7B2F\u7B30\u7B32\u7B34\u7B35\u7B36\u7B37\u7B39\u7B3B\u7B3D\u7B3F",5,"\u7B46\u7B48\u7B4A\u7B4D\u7B4E\u7B53\u7B55\u7B57\u7B59\u7B5C\u7B5E\u7B5F\u7B61\u7B63",10,"\u7B6F\u7B70\u7B73\u7B74\u7B76\u7B78\u7B7A\u7B7C\u7B7D\u7B7F\u7B81\u7B82\u7B83\u7B84\u7B86",6,"\u7B8E\u7B8F"],["b980","\u7B91\u7B92\u7B93\u7B96\u7B98\u7B99\u7B9A\u7B9B\u7B9E\u7B9F\u7BA0\u7BA3\u7BA4\u7BA5\u7BAE\u7BAF\u7BB0\u7BB2\u7BB3\u7BB5\u7BB6\u7BB7\u7BB9",7,"\u7BC2\u7BC3\u7BC4\u57C2\u803F\u6897\u5DE5\u653B\u529F\u606D\u9F9A\u4F9B\u8EAC\u516C\u5BAB\u5F13\u5DE9\u6C5E\u62F1\u8D21\u5171\u94A9\u52FE\u6C9F\u82DF\u72D7\u57A2\u6784\u8D2D\u591F\u8F9C\u83C7\u5495\u7B8D\u4F30\u6CBD\u5B64\u59D1\u9F13\u53E4\u86CA\u9AA8\u8C37\u80A1\u6545\u987E\u56FA\u96C7\u522E\u74DC\u5250\u5BE1\u6302\u8902\u4E56\u62D0\u602A\u68FA\u5173\u5B98\u51A0\u89C2\u7BA1\u9986\u7F50\u60EF\u704C\u8D2F\u5149\u5E7F\u901B\u7470\u89C4\u572D\u7845\u5F52\u9F9F\u95FA\u8F68\u9B3C\u8BE1\u7678\u6842\u67DC\u8DEA\u8D35\u523D\u8F8A\u6EDA\u68CD\u9505\u90ED\u56FD\u679C\u88F9\u8FC7\u54C8"],["ba40","\u7BC5\u7BC8\u7BC9\u7BCA\u7BCB\u7BCD\u7BCE\u7BCF\u7BD0\u7BD2\u7BD4",4,"\u7BDB\u7BDC\u7BDE\u7BDF\u7BE0\u7BE2\u7BE3\u7BE4\u7BE7\u7BE8\u7BE9\u7BEB\u7BEC\u7BED\u7BEF\u7BF0\u7BF2",4,"\u7BF8\u7BF9\u7BFA\u7BFB\u7BFD\u7BFF",7,"\u7C08\u7C09\u7C0A\u7C0D\u7C0E\u7C10",5,"\u7C17\u7C18\u7C19"],["ba80","\u7C1A",4,"\u7C20",5,"\u7C28\u7C29\u7C2B",12,"\u7C39",5,"\u7C42\u9AB8\u5B69\u6D77\u6C26\u4EA5\u5BB3\u9A87\u9163\u61A8\u90AF\u97E9\u542B\u6DB5\u5BD2\u51FD\u558A\u7F55\u7FF0\u64BC\u634D\u65F1\u61BE\u608D\u710A\u6C57\u6C49\u592F\u676D\u822A\u58D5\u568E\u8C6A\u6BEB\u90DD\u597D\u8017\u53F7\u6D69\u5475\u559D\u8377\u83CF\u6838\u79BE\u548C\u4F55\u5408\u76D2\u8C89\u9602\u6CB3\u6DB8\u8D6B\u8910\u9E64\u8D3A\u563F\u9ED1\u75D5\u5F88\u72E0\u6068\u54FC\u4EA8\u6A2A\u8861\u6052\u8F70\u54C4\u70D8\u8679\u9E3F\u6D2A\u5B8F\u5F18\u7EA2\u5589\u4FAF\u7334\u543C\u539A\u5019\u540E\u547C\u4E4E\u5FFD\u745A\u58F6\u846B\u80E1\u8774\u72D0\u7CCA\u6E56"],["bb40","\u7C43",9,"\u7C4E",36,"\u7C75",5,"\u7C7E",9],["bb80","\u7C88\u7C8A",6,"\u7C93\u7C94\u7C96\u7C99\u7C9A\u7C9B\u7CA0\u7CA1\u7CA3\u7CA6\u7CA7\u7CA8\u7CA9\u7CAB\u7CAC\u7CAD\u7CAF\u7CB0\u7CB4",4,"\u7CBA\u7CBB\u5F27\u864E\u552C\u62A4\u4E92\u6CAA\u6237\u82B1\u54D7\u534E\u733E\u6ED1\u753B\u5212\u5316\u8BDD\u69D0\u5F8A\u6000\u6DEE\u574F\u6B22\u73AF\u6853\u8FD8\u7F13\u6362\u60A3\u5524\u75EA\u8C62\u7115\u6DA3\u5BA6\u5E7B\u8352\u614C\u9EC4\u78FA\u8757\u7C27\u7687\u51F0\u60F6\u714C\u6643\u5E4C\u604D\u8C0E\u7070\u6325\u8F89\u5FBD\u6062\u86D4\u56DE\u6BC1\u6094\u6167\u5349\u60E0\u6666\u8D3F\u79FD\u4F1A\u70E9\u6C47\u8BB3\u8BF2\u7ED8\u8364\u660F\u5A5A\u9B42\u6D51\u6DF7\u8C41\u6D3B\u4F19\u706B\u83B7\u6216\u60D1\u970D\u8D27\u7978\u51FB\u573E\u57FA\u673A\u7578\u7A3D\u79EF\u7B95"],["bc40","\u7CBF\u7CC0\u7CC2\u7CC3\u7CC4\u7CC6\u7CC9\u7CCB\u7CCE",6,"\u7CD8\u7CDA\u7CDB\u7CDD\u7CDE\u7CE1",6,"\u7CE9",5,"\u7CF0",7,"\u7CF9\u7CFA\u7CFC",13,"\u7D0B",5],["bc80","\u7D11",14,"\u7D21\u7D23\u7D24\u7D25\u7D26\u7D28\u7D29\u7D2A\u7D2C\u7D2D\u7D2E\u7D30",6,"\u808C\u9965\u8FF9\u6FC0\u8BA5\u9E21\u59EC\u7EE9\u7F09\u5409\u6781\u68D8\u8F91\u7C4D\u96C6\u53CA\u6025\u75BE\u6C72\u5373\u5AC9\u7EA7\u6324\u51E0\u810A\u5DF1\u84DF\u6280\u5180\u5B63\u4F0E\u796D\u5242\u60B8\u6D4E\u5BC4\u5BC2\u8BA1\u8BB0\u65E2\u5FCC\u9645\u5993\u7EE7\u7EAA\u5609\u67B7\u5939\u4F73\u5BB6\u52A0\u835A\u988A\u8D3E\u7532\u94BE\u5047\u7A3C\u4EF7\u67B6\u9A7E\u5AC1\u6B7C\u76D1\u575A\u5C16\u7B3A\u95F4\u714E\u517C\u80A9\u8270\u5978\u7F04\u8327\u68C0\u67EC\u78B1\u7877\u62E3\u6361\u7B80\u4FED\u526A\u51CF\u8350\u69DB\u9274\u8DF5\u8D31\u89C1\u952E\u7BAD\u4EF6"],["bd40","\u7D37",54,"\u7D6F",7],["bd80","\u7D78",32,"\u5065\u8230\u5251\u996F\u6E10\u6E85\u6DA7\u5EFA\u50F5\u59DC\u5C06\u6D46\u6C5F\u7586\u848B\u6868\u5956\u8BB2\u5320\u9171\u964D\u8549\u6912\u7901\u7126\u80F6\u4EA4\u90CA\u6D47\u9A84\u5A07\u56BC\u6405\u94F0\u77EB\u4FA5\u811A\u72E1\u89D2\u997A\u7F34\u7EDE\u527F\u6559\u9175\u8F7F\u8F83\u53EB\u7A96\u63ED\u63A5\u7686\u79F8\u8857\u9636\u622A\u52AB\u8282\u6854\u6770\u6377\u776B\u7AED\u6D01\u7ED3\u89E3\u59D0\u6212\u85C9\u82A5\u754C\u501F\u4ECB\u75A5\u8BEB\u5C4A\u5DFE\u7B4B\u65A4\u91D1\u4ECA\u6D25\u895F\u7D27\u9526\u4EC5\u8C28\u8FDB\u9773\u664B\u7981\u8FD1\u70EC\u6D78"],["be40","\u7D99",12,"\u7DA7",6,"\u7DAF",42],["be80","\u7DDA",32,"\u5C3D\u52B2\u8346\u5162\u830E\u775B\u6676\u9CB8\u4EAC\u60CA\u7CBE\u7CB3\u7ECF\u4E95\u8B66\u666F\u9888\u9759\u5883\u656C\u955C\u5F84\u75C9\u9756\u7ADF\u7ADE\u51C0\u70AF\u7A98\u63EA\u7A76\u7EA0\u7396\u97ED\u4E45\u7078\u4E5D\u9152\u53A9\u6551\u65E7\u81FC\u8205\u548E\u5C31\u759A\u97A0\u62D8\u72D9\u75BD\u5C45\u9A79\u83CA\u5C40\u5480\u77E9\u4E3E\u6CAE\u805A\u62D2\u636E\u5DE8\u5177\u8DDD\u8E1E\u952F\u4FF1\u53E5\u60E7\u70AC\u5267\u6350\u9E43\u5A1F\u5026\u7737\u5377\u7EE2\u6485\u652B\u6289\u6398\u5014\u7235\u89C9\u51B3\u8BC0\u7EDD\u5747\u83CC\u94A7\u519B\u541B\u5CFB"],["bf40","\u7DFB",62],["bf80","\u7E3A\u7E3C",4,"\u7E42",4,"\u7E48",21,"\u4FCA\u7AE3\u6D5A\u90E1\u9A8F\u5580\u5496\u5361\u54AF\u5F00\u63E9\u6977\u51EF\u6168\u520A\u582A\u52D8\u574E\u780D\u770B\u5EB7\u6177\u7CE0\u625B\u6297\u4EA2\u7095\u8003\u62F7\u70E4\u9760\u5777\u82DB\u67EF\u68F5\u78D5\u9897\u79D1\u58F3\u54B3\u53EF\u6E34\u514B\u523B\u5BA2\u8BFE\u80AF\u5543\u57A6\u6073\u5751\u542D\u7A7A\u6050\u5B54\u63A7\u62A0\u53E3\u6263\u5BC7\u67AF\u54ED\u7A9F\u82E6\u9177\u5E93\u88E4\u5938\u57AE\u630E\u8DE8\u80EF\u5757\u7B77\u4FA9\u5FEB\u5BBD\u6B3E\u5321\u7B50\u72C2\u6846\u77FF\u7736\u65F7\u51B5\u4E8F\u76D4\u5CBF\u7AA5\u8475\u594E\u9B41\u5080"],["c040","\u7E5E",35,"\u7E83",23,"\u7E9C\u7E9D\u7E9E"],["c080","\u7EAE\u7EB4\u7EBB\u7EBC\u7ED6\u7EE4\u7EEC\u7EF9\u7F0A\u7F10\u7F1E\u7F37\u7F39\u7F3B",6,"\u7F43\u7F46",9,"\u7F52\u7F53\u9988\u6127\u6E83\u5764\u6606\u6346\u56F0\u62EC\u6269\u5ED3\u9614\u5783\u62C9\u5587\u8721\u814A\u8FA3\u5566\u83B1\u6765\u8D56\u84DD\u5A6A\u680F\u62E6\u7BEE\u9611\u5170\u6F9C\u8C30\u63FD\u89C8\u61D2\u7F06\u70C2\u6EE5\u7405\u6994\u72FC\u5ECA\u90CE\u6717\u6D6A\u635E\u52B3\u7262\u8001\u4F6C\u59E5\u916A\u70D9\u6D9D\u52D2\u4E50\u96F7\u956D\u857E\u78CA\u7D2F\u5121\u5792\u64C2\u808B\u7C7B\u6CEA\u68F1\u695E\u51B7\u5398\u68A8\u7281\u9ECE\u7BF1\u72F8\u79BB\u6F13\u7406\u674E\u91CC\u9CA4\u793C\u8389\u8354\u540F\u6817\u4E3D\u5389\u52B1\u783E\u5386\u5229\u5088\u4F8B\u4FD0"],["c140","\u7F56\u7F59\u7F5B\u7F5C\u7F5D\u7F5E\u7F60\u7F63",4,"\u7F6B\u7F6C\u7F6D\u7F6F\u7F70\u7F73\u7F75\u7F76\u7F77\u7F78\u7F7A\u7F7B\u7F7C\u7F7D\u7F7F\u7F80\u7F82",7,"\u7F8B\u7F8D\u7F8F",4,"\u7F95",4,"\u7F9B\u7F9C\u7FA0\u7FA2\u7FA3\u7FA5\u7FA6\u7FA8",6,"\u7FB1"],["c180","\u7FB3",4,"\u7FBA\u7FBB\u7FBE\u7FC0\u7FC2\u7FC3\u7FC4\u7FC6\u7FC7\u7FC8\u7FC9\u7FCB\u7FCD\u7FCF",4,"\u7FD6\u7FD7\u7FD9",5,"\u7FE2\u7FE3\u75E2\u7ACB\u7C92\u6CA5\u96B6\u529B\u7483\u54E9\u4FE9\u8054\u83B2\u8FDE\u9570\u5EC9\u601C\u6D9F\u5E18\u655B\u8138\u94FE\u604B\u70BC\u7EC3\u7CAE\u51C9\u6881\u7CB1\u826F\u4E24\u8F86\u91CF\u667E\u4EAE\u8C05\u64A9\u804A\u50DA\u7597\u71CE\u5BE5\u8FBD\u6F66\u4E86\u6482\u9563\u5ED6\u6599\u5217\u88C2\u70C8\u52A3\u730E\u7433\u6797\u78F7\u9716\u4E34\u90BB\u9CDE\u6DCB\u51DB\u8D41\u541D\u62CE\u73B2\u83F1\u96F6\u9F84\u94C3\u4F36\u7F9A\u51CC\u7075\u9675\u5CAD\u9886\u53E6\u4EE4\u6E9C\u7409\u69B4\u786B\u998F\u7559\u5218\u7624\u6D41\u67F3\u516D\u9F99\u804B\u5499\u7B3C\u7ABF"],["c240","\u7FE4\u7FE7\u7FE8\u7FEA\u7FEB\u7FEC\u7FED\u7FEF\u7FF2\u7FF4",6,"\u7FFD\u7FFE\u7FFF\u8002\u8007\u8008\u8009\u800A\u800E\u800F\u8011\u8013\u801A\u801B\u801D\u801E\u801F\u8021\u8023\u8024\u802B",5,"\u8032\u8034\u8039\u803A\u803C\u803E\u8040\u8041\u8044\u8045\u8047\u8048\u8049\u804E\u804F\u8050\u8051\u8053\u8055\u8056\u8057"],["c280","\u8059\u805B",13,"\u806B",5,"\u8072",11,"\u9686\u5784\u62E2\u9647\u697C\u5A04\u6402\u7BD3\u6F0F\u964B\u82A6\u5362\u9885\u5E90\u7089\u63B3\u5364\u864F\u9C81\u9E93\u788C\u9732\u8DEF\u8D42\u9E7F\u6F5E\u7984\u5F55\u9646\u622E\u9A74\u5415\u94DD\u4FA3\u65C5\u5C65\u5C61\u7F15\u8651\u6C2F\u5F8B\u7387\u6EE4\u7EFF\u5CE6\u631B\u5B6A\u6EE6\u5375\u4E71\u63A0\u7565\u62A1\u8F6E\u4F26\u4ED1\u6CA6\u7EB6\u8BBA\u841D\u87BA\u7F57\u903B\u9523\u7BA9\u9AA1\u88F8\u843D\u6D1B\u9A86\u7EDC\u5988\u9EBB\u739B\u7801\u8682\u9A6C\u9A82\u561B\u5417\u57CB\u4E70\u9EA6\u5356\u8FC8\u8109\u7792\u9992\u86EE\u6EE1\u8513\u66FC\u6162\u6F2B"],["c340","\u807E\u8081\u8082\u8085\u8088\u808A\u808D",5,"\u8094\u8095\u8097\u8099\u809E\u80A3\u80A6\u80A7\u80A8\u80AC\u80B0\u80B3\u80B5\u80B6\u80B8\u80B9\u80BB\u80C5\u80C7",4,"\u80CF",6,"\u80D8\u80DF\u80E0\u80E2\u80E3\u80E6\u80EE\u80F5\u80F7\u80F9\u80FB\u80FE\u80FF\u8100\u8101\u8103\u8104\u8105\u8107\u8108\u810B"],["c380","\u810C\u8115\u8117\u8119\u811B\u811C\u811D\u811F",12,"\u812D\u812E\u8130\u8133\u8134\u8135\u8137\u8139",4,"\u813F\u8C29\u8292\u832B\u76F2\u6C13\u5FD9\u83BD\u732B\u8305\u951A\u6BDB\u77DB\u94C6\u536F\u8302\u5192\u5E3D\u8C8C\u8D38\u4E48\u73AB\u679A\u6885\u9176\u9709\u7164\u6CA1\u7709\u5A92\u9541\u6BCF\u7F8E\u6627\u5BD0\u59B9\u5A9A\u95E8\u95F7\u4EEC\u840C\u8499\u6AAC\u76DF\u9530\u731B\u68A6\u5B5F\u772F\u919A\u9761\u7CDC\u8FF7\u8C1C\u5F25\u7C73\u79D8\u89C5\u6CCC\u871C\u5BC6\u5E42\u68C9\u7720\u7EF5\u5195\u514D\u52C9\u5A29\u7F05\u9762\u82D7\u63CF\u7784\u85D0\u79D2\u6E3A\u5E99\u5999\u8511\u706D\u6C11\u62BF\u76BF\u654F\u60AF\u95FD\u660E\u879F\u9E23\u94ED\u540D\u547D\u8C2C\u6478"],["c440","\u8140",5,"\u8147\u8149\u814D\u814E\u814F\u8152\u8156\u8157\u8158\u815B",4,"\u8161\u8162\u8163\u8164\u8166\u8168\u816A\u816B\u816C\u816F\u8172\u8173\u8175\u8176\u8177\u8178\u8181\u8183",4,"\u8189\u818B\u818C\u818D\u818E\u8190\u8192",5,"\u8199\u819A\u819E",4,"\u81A4\u81A5"],["c480","\u81A7\u81A9\u81AB",7,"\u81B4",5,"\u81BC\u81BD\u81BE\u81BF\u81C4\u81C5\u81C7\u81C8\u81C9\u81CB\u81CD",6,"\u6479\u8611\u6A21\u819C\u78E8\u6469\u9B54\u62B9\u672B\u83AB\u58A8\u9ED8\u6CAB\u6F20\u5BDE\u964C\u8C0B\u725F\u67D0\u62C7\u7261\u4EA9\u59C6\u6BCD\u5893\u66AE\u5E55\u52DF\u6155\u6728\u76EE\u7766\u7267\u7A46\u62FF\u54EA\u5450\u94A0\u90A3\u5A1C\u7EB3\u6C16\u4E43\u5976\u8010\u5948\u5357\u7537\u96BE\u56CA\u6320\u8111\u607C\u95F9\u6DD6\u5462\u9981\u5185\u5AE9\u80FD\u59AE\u9713\u502A\u6CE5\u5C3C\u62DF\u4F60\u533F\u817B\u9006\u6EBA\u852B\u62C8\u5E74\u78BE\u64B5\u637B\u5FF5\u5A18\u917F\u9E1F\u5C3F\u634F\u8042\u5B7D\u556E\u954A\u954D\u6D85\u60A8\u67E0\u72DE\u51DD\u5B81"],["c540","\u81D4",14,"\u81E4\u81E5\u81E6\u81E8\u81E9\u81EB\u81EE",4,"\u81F5",5,"\u81FD\u81FF\u8203\u8207",4,"\u820E\u820F\u8211\u8213\u8215",5,"\u821D\u8220\u8224\u8225\u8226\u8227\u8229\u822E\u8232\u823A\u823C\u823D\u823F"],["c580","\u8240\u8241\u8242\u8243\u8245\u8246\u8248\u824A\u824C\u824D\u824E\u8250",7,"\u8259\u825B\u825C\u825D\u825E\u8260",7,"\u8269\u62E7\u6CDE\u725B\u626D\u94AE\u7EBD\u8113\u6D53\u519C\u5F04\u5974\u52AA\u6012\u5973\u6696\u8650\u759F\u632A\u61E6\u7CEF\u8BFA\u54E6\u6B27\u9E25\u6BB4\u85D5\u5455\u5076\u6CA4\u556A\u8DB4\u722C\u5E15\u6015\u7436\u62CD\u6392\u724C\u5F98\u6E43\u6D3E\u6500\u6F58\u76D8\u78D0\u76FC\u7554\u5224\u53DB\u4E53\u5E9E\u65C1\u802A\u80D6\u629B\u5486\u5228\u70AE\u888D\u8DD1\u6CE1\u5478\u80DA\u57F9\u88F4\u8D54\u966A\u914D\u4F69\u6C9B\u55B7\u76C6\u7830\u62A8\u70F9\u6F8E\u5F6D\u84EC\u68DA\u787C\u7BF7\u81A8\u670B\u9E4F\u6367\u78B0\u576F\u7812\u9739\u6279\u62AB\u5288\u7435\u6BD7"],["c640","\u826A\u826B\u826C\u826D\u8271\u8275\u8276\u8277\u8278\u827B\u827C\u8280\u8281\u8283\u8285\u8286\u8287\u8289\u828C\u8290\u8293\u8294\u8295\u8296\u829A\u829B\u829E\u82A0\u82A2\u82A3\u82A7\u82B2\u82B5\u82B6\u82BA\u82BB\u82BC\u82BF\u82C0\u82C2\u82C3\u82C5\u82C6\u82C9\u82D0\u82D6\u82D9\u82DA\u82DD\u82E2\u82E7\u82E8\u82E9\u82EA\u82EC\u82ED\u82EE\u82F0\u82F2\u82F3\u82F5\u82F6\u82F8"],["c680","\u82FA\u82FC",4,"\u830A\u830B\u830D\u8310\u8312\u8313\u8316\u8318\u8319\u831D",9,"\u8329\u832A\u832E\u8330\u8332\u8337\u833B\u833D\u5564\u813E\u75B2\u76AE\u5339\u75DE\u50FB\u5C41\u8B6C\u7BC7\u504F\u7247\u9A97\u98D8\u6F02\u74E2\u7968\u6487\u77A5\u62FC\u9891\u8D2B\u54C1\u8058\u4E52\u576A\u82F9\u840D\u5E73\u51ED\u74F6\u8BC4\u5C4F\u5761\u6CFC\u9887\u5A46\u7834\u9B44\u8FEB\u7C95\u5256\u6251\u94FA\u4EC6\u8386\u8461\u83E9\u84B2\u57D4\u6734\u5703\u666E\u6D66\u8C31\u66DD\u7011\u671F\u6B3A\u6816\u621A\u59BB\u4E03\u51C4\u6F06\u67D2\u6C8F\u5176\u68CB\u5947\u6B67\u7566\u5D0E\u8110\u9F50\u65D7\u7948\u7941\u9A91\u8D77\u5C82\u4E5E\u4F01\u542F\u5951\u780C\u5668\u6C14\u8FC4\u5F03\u6C7D\u6CE3\u8BAB\u6390"],["c740","\u833E\u833F\u8341\u8342\u8344\u8345\u8348\u834A",4,"\u8353\u8355",4,"\u835D\u8362\u8370",6,"\u8379\u837A\u837E",6,"\u8387\u8388\u838A\u838B\u838C\u838D\u838F\u8390\u8391\u8394\u8395\u8396\u8397\u8399\u839A\u839D\u839F\u83A1",6,"\u83AC\u83AD\u83AE"],["c780","\u83AF\u83B5\u83BB\u83BE\u83BF\u83C2\u83C3\u83C4\u83C6\u83C8\u83C9\u83CB\u83CD\u83CE\u83D0\u83D1\u83D2\u83D3\u83D5\u83D7\u83D9\u83DA\u83DB\u83DE\u83E2\u83E3\u83E4\u83E6\u83E7\u83E8\u83EB\u83EC\u83ED\u6070\u6D3D\u7275\u6266\u948E\u94C5\u5343\u8FC1\u7B7E\u4EDF\u8C26\u4E7E\u9ED4\u94B1\u94B3\u524D\u6F5C\u9063\u6D45\u8C34\u5811\u5D4C\u6B20\u6B49\u67AA\u545B\u8154\u7F8C\u5899\u8537\u5F3A\u62A2\u6A47\u9539\u6572\u6084\u6865\u77A7\u4E54\u4FA8\u5DE7\u9798\u64AC\u7FD8\u5CED\u4FCF\u7A8D\u5207\u8304\u4E14\u602F\u7A83\u94A6\u4FB5\u4EB2\u79E6\u7434\u52E4\u82B9\u64D2\u79BD\u5BDD\u6C81\u9752\u8F7B\u6C22\u503E\u537F\u6E05\u64CE\u6674\u6C30\u60C5\u9877\u8BF7\u5E86\u743C\u7A77\u79CB\u4E18\u90B1\u7403\u6C42\u56DA\u914B\u6CC5\u8D8B\u533A\u86C6\u66F2\u8EAF\u5C48\u9A71\u6E20"],["c840","\u83EE\u83EF\u83F3",4,"\u83FA\u83FB\u83FC\u83FE\u83FF\u8400\u8402\u8405\u8407\u8408\u8409\u840A\u8410\u8412",5,"\u8419\u841A\u841B\u841E",5,"\u8429",7,"\u8432",5,"\u8439\u843A\u843B\u843E",7,"\u8447\u8448\u8449"],["c880","\u844A",6,"\u8452",4,"\u8458\u845D\u845E\u845F\u8460\u8462\u8464",4,"\u846A\u846E\u846F\u8470\u8472\u8474\u8477\u8479\u847B\u847C\u53D6\u5A36\u9F8B\u8DA3\u53BB\u5708\u98A7\u6743\u919B\u6CC9\u5168\u75CA\u62F3\u72AC\u5238\u529D\u7F3A\u7094\u7638\u5374\u9E4A\u69B7\u786E\u96C0\u88D9\u7FA4\u7136\u71C3\u5189\u67D3\u74E4\u58E4\u6518\u56B7\u8BA9\u9976\u6270\u7ED5\u60F9\u70ED\u58EC\u4EC1\u4EBA\u5FCD\u97E7\u4EFB\u8BA4\u5203\u598A\u7EAB\u6254\u4ECD\u65E5\u620E\u8338\u84C9\u8363\u878D\u7194\u6EB6\u5BB9\u7ED2\u5197\u63C9\u67D4\u8089\u8339\u8815\u5112\u5B7A\u5982\u8FB1\u4E73\u6C5D\u5165\u8925\u8F6F\u962E\u854A\u745E\u9510\u95F0\u6DA6\u82E5\u5F31\u6492\u6D12\u8428\u816E\u9CC3\u585E\u8D5B\u4E09\u53C1"],["c940","\u847D",4,"\u8483\u8484\u8485\u8486\u848A\u848D\u848F",7,"\u8498\u849A\u849B\u849D\u849E\u849F\u84A0\u84A2",12,"\u84B0\u84B1\u84B3\u84B5\u84B6\u84B7\u84BB\u84BC\u84BE\u84C0\u84C2\u84C3\u84C5\u84C6\u84C7\u84C8\u84CB\u84CC\u84CE\u84CF\u84D2\u84D4\u84D5\u84D7"],["c980","\u84D8",4,"\u84DE\u84E1\u84E2\u84E4\u84E7",4,"\u84ED\u84EE\u84EF\u84F1",10,"\u84FD\u84FE\u8500\u8501\u8502\u4F1E\u6563\u6851\u55D3\u4E27\u6414\u9A9A\u626B\u5AC2\u745F\u8272\u6DA9\u68EE\u50E7\u838E\u7802\u6740\u5239\u6C99\u7EB1\u50BB\u5565\u715E\u7B5B\u6652\u73CA\u82EB\u6749\u5C71\u5220\u717D\u886B\u95EA\u9655\u64C5\u8D61\u81B3\u5584\u6C55\u6247\u7F2E\u5892\u4F24\u5546\u8D4F\u664C\u4E0A\u5C1A\u88F3\u68A2\u634E\u7A0D\u70E7\u828D\u52FA\u97F6\u5C11\u54E8\u90B5\u7ECD\u5962\u8D4A\u86C7\u820C\u820D\u8D66\u6444\u5C04\u6151\u6D89\u793E\u8BBE\u7837\u7533\u547B\u4F38\u8EAB\u6DF1\u5A20\u7EC5\u795E\u6C88\u5BA1\u5A76\u751A\u80BE\u614E\u6E17\u58F0\u751F\u7525\u7272\u5347\u7EF3"],["ca40","\u8503",8,"\u850D\u850E\u850F\u8510\u8512\u8514\u8515\u8516\u8518\u8519\u851B\u851C\u851D\u851E\u8520\u8522",8,"\u852D",9,"\u853E",4,"\u8544\u8545\u8546\u8547\u854B",10],["ca80","\u8557\u8558\u855A\u855B\u855C\u855D\u855F",4,"\u8565\u8566\u8567\u8569",8,"\u8573\u8575\u8576\u8577\u8578\u857C\u857D\u857F\u8580\u8581\u7701\u76DB\u5269\u80DC\u5723\u5E08\u5931\u72EE\u65BD\u6E7F\u8BD7\u5C38\u8671\u5341\u77F3\u62FE\u65F6\u4EC0\u98DF\u8680\u5B9E\u8BC6\u53F2\u77E2\u4F7F\u5C4E\u9A76\u59CB\u5F0F\u793A\u58EB\u4E16\u67FF\u4E8B\u62ED\u8A93\u901D\u52BF\u662F\u55DC\u566C\u9002\u4ED5\u4F8D\u91CA\u9970\u6C0F\u5E02\u6043\u5BA4\u89C6\u8BD5\u6536\u624B\u9996\u5B88\u5BFF\u6388\u552E\u53D7\u7626\u517D\u852C\u67A2\u68B3\u6B8A\u6292\u8F93\u53D4\u8212\u6DD1\u758F\u4E66\u8D4E\u5B70\u719F\u85AF\u6691\u66D9\u7F72\u8700\u9ECD\u9F20\u5C5E\u672F\u8FF0\u6811\u675F\u620D\u7AD6\u5885\u5EB6\u6570\u6F31"],["cb40","\u8582\u8583\u8586\u8588",6,"\u8590",10,"\u859D",6,"\u85A5\u85A6\u85A7\u85A9\u85AB\u85AC\u85AD\u85B1",5,"\u85B8\u85BA",6,"\u85C2",6,"\u85CA",4,"\u85D1\u85D2"],["cb80","\u85D4\u85D6",5,"\u85DD",6,"\u85E5\u85E6\u85E7\u85E8\u85EA",14,"\u6055\u5237\u800D\u6454\u8870\u7529\u5E05\u6813\u62F4\u971C\u53CC\u723D\u8C01\u6C34\u7761\u7A0E\u542E\u77AC\u987A\u821C\u8BF4\u7855\u6714\u70C1\u65AF\u6495\u5636\u601D\u79C1\u53F8\u4E1D\u6B7B\u8086\u5BFA\u55E3\u56DB\u4F3A\u4F3C\u9972\u5DF3\u677E\u8038\u6002\u9882\u9001\u5B8B\u8BBC\u8BF5\u641C\u8258\u64DE\u55FD\u82CF\u9165\u4FD7\u7D20\u901F\u7C9F\u50F3\u5851\u6EAF\u5BBF\u8BC9\u8083\u9178\u849C\u7B97\u867D\u968B\u968F\u7EE5\u9AD3\u788E\u5C81\u7A57\u9042\u96A7\u795F\u5B59\u635F\u7B0B\u84D1\u68AD\u5506\u7F29\u7410\u7D22\u9501\u6240\u584C\u4ED6\u5B83\u5979\u5854"],["cc40","\u85F9\u85FA\u85FC\u85FD\u85FE\u8600",4,"\u8606",10,"\u8612\u8613\u8614\u8615\u8617",15,"\u8628\u862A",13,"\u8639\u863A\u863B\u863D\u863E\u863F\u8640"],["cc80","\u8641",11,"\u8652\u8653\u8655",4,"\u865B\u865C\u865D\u865F\u8660\u8661\u8663",7,"\u736D\u631E\u8E4B\u8E0F\u80CE\u82D4\u62AC\u53F0\u6CF0\u915E\u592A\u6001\u6C70\u574D\u644A\u8D2A\u762B\u6EE9\u575B\u6A80\u75F0\u6F6D\u8C2D\u8C08\u5766\u6BEF\u8892\u78B3\u63A2\u53F9\u70AD\u6C64\u5858\u642A\u5802\u68E0\u819B\u5510\u7CD6\u5018\u8EBA\u6DCC\u8D9F\u70EB\u638F\u6D9B\u6ED4\u7EE6\u8404\u6843\u9003\u6DD8\u9676\u8BA8\u5957\u7279\u85E4\u817E\u75BC\u8A8A\u68AF\u5254\u8E22\u9511\u63D0\u9898\u8E44\u557C\u4F53\u66FF\u568F\u60D5\u6D95\u5243\u5C49\u5929\u6DFB\u586B\u7530\u751C\u606C\u8214\u8146\u6311\u6761\u8FE2\u773A\u8DF3\u8D34\u94C1\u5E16\u5385\u542C\u70C3"],["cd40","\u866D\u866F\u8670\u8672",6,"\u8683",6,"\u868E",4,"\u8694\u8696",5,"\u869E",4,"\u86A5\u86A6\u86AB\u86AD\u86AE\u86B2\u86B3\u86B7\u86B8\u86B9\u86BB",4,"\u86C1\u86C2\u86C3\u86C5\u86C8\u86CC\u86CD\u86D2\u86D3\u86D5\u86D6\u86D7\u86DA\u86DC"],["cd80","\u86DD\u86E0\u86E1\u86E2\u86E3\u86E5\u86E6\u86E7\u86E8\u86EA\u86EB\u86EC\u86EF\u86F5\u86F6\u86F7\u86FA\u86FB\u86FC\u86FD\u86FF\u8701\u8704\u8705\u8706\u870B\u870C\u870E\u870F\u8710\u8711\u8714\u8716\u6C40\u5EF7\u505C\u4EAD\u5EAD\u633A\u8247\u901A\u6850\u916E\u77B3\u540C\u94DC\u5F64\u7AE5\u6876\u6345\u7B52\u7EDF\u75DB\u5077\u6295\u5934\u900F\u51F8\u79C3\u7A81\u56FE\u5F92\u9014\u6D82\u5C60\u571F\u5410\u5154\u6E4D\u56E2\u63A8\u9893\u817F\u8715\u892A\u9000\u541E\u5C6F\u81C0\u62D6\u6258\u8131\u9E35\u9640\u9A6E\u9A7C\u692D\u59A5\u62D3\u553E\u6316\u54C7\u86D9\u6D3C\u5A03\u74E6\u889C\u6B6A\u5916\u8C4C\u5F2F\u6E7E\u73A9\u987D\u4E38\u70F7\u5B8C\u7897\u633D\u665A\u7696\u60CB\u5B9B\u5A49\u4E07\u8155\u6C6A\u738B\u4EA1\u6789\u7F51\u5F80\u65FA\u671B\u5FD8\u5984\u5A01"],["ce40","\u8719\u871B\u871D\u871F\u8720\u8724\u8726\u8727\u8728\u872A\u872B\u872C\u872D\u872F\u8730\u8732\u8733\u8735\u8736\u8738\u8739\u873A\u873C\u873D\u8740",6,"\u874A\u874B\u874D\u874F\u8750\u8751\u8752\u8754\u8755\u8756\u8758\u875A",5,"\u8761\u8762\u8766",7,"\u876F\u8771\u8772\u8773\u8775"],["ce80","\u8777\u8778\u8779\u877A\u877F\u8780\u8781\u8784\u8786\u8787\u8789\u878A\u878C\u878E",4,"\u8794\u8795\u8796\u8798",6,"\u87A0",4,"\u5DCD\u5FAE\u5371\u97E6\u8FDD\u6845\u56F4\u552F\u60DF\u4E3A\u6F4D\u7EF4\u82C7\u840E\u59D4\u4F1F\u4F2A\u5C3E\u7EAC\u672A\u851A\u5473\u754F\u80C3\u5582\u9B4F\u4F4D\u6E2D\u8C13\u5C09\u6170\u536B\u761F\u6E29\u868A\u6587\u95FB\u7EB9\u543B\u7A33\u7D0A\u95EE\u55E1\u7FC1\u74EE\u631D\u8717\u6DA1\u7A9D\u6211\u65A1\u5367\u63E1\u6C83\u5DEB\u545C\u94A8\u4E4C\u6C61\u8BEC\u5C4B\u65E0\u829C\u68A7\u543E\u5434\u6BCB\u6B66\u4E94\u6342\u5348\u821E\u4F0D\u4FAE\u575E\u620A\u96FE\u6664\u7269\u52FF\u52A1\u609F\u8BEF\u6614\u7199\u6790\u897F\u7852\u77FD\u6670\u563B\u5438\u9521\u727A"],["cf40","\u87A5\u87A6\u87A7\u87A9\u87AA\u87AE\u87B0\u87B1\u87B2\u87B4\u87B6\u87B7\u87B8\u87B9\u87BB\u87BC\u87BE\u87BF\u87C1",4,"\u87C7\u87C8\u87C9\u87CC",4,"\u87D4",6,"\u87DC\u87DD\u87DE\u87DF\u87E1\u87E2\u87E3\u87E4\u87E6\u87E7\u87E8\u87E9\u87EB\u87EC\u87ED\u87EF",9],["cf80","\u87FA\u87FB\u87FC\u87FD\u87FF\u8800\u8801\u8802\u8804",5,"\u880B",7,"\u8814\u8817\u8818\u8819\u881A\u881C",4,"\u8823\u7A00\u606F\u5E0C\u6089\u819D\u5915\u60DC\u7184\u70EF\u6EAA\u6C50\u7280\u6A84\u88AD\u5E2D\u4E60\u5AB3\u559C\u94E3\u6D17\u7CFB\u9699\u620F\u7EC6\u778E\u867E\u5323\u971E\u8F96\u6687\u5CE1\u4FA0\u72ED\u4E0B\u53A6\u590F\u5413\u6380\u9528\u5148\u4ED9\u9C9C\u7EA4\u54B8\u8D24\u8854\u8237\u95F2\u6D8E\u5F26\u5ACC\u663E\u9669\u73B0\u732E\u53BF\u817A\u9985\u7FA1\u5BAA\u9677\u9650\u7EBF\u76F8\u53A2\u9576\u9999\u7BB1\u8944\u6E58\u4E61\u7FD4\u7965\u8BE6\u60F3\u54CD\u4EAB\u9879\u5DF7\u6A61\u50CF\u5411\u8C61\u8427\u785D\u9704\u524A\u54EE\u56A3\u9500\u6D88\u5BB5\u6DC6\u6653"],["d040","\u8824",13,"\u8833",5,"\u883A\u883B\u883D\u883E\u883F\u8841\u8842\u8843\u8846",5,"\u884E",5,"\u8855\u8856\u8858\u885A",6,"\u8866\u8867\u886A\u886D\u886F\u8871\u8873\u8874\u8875\u8876\u8878\u8879\u887A"],["d080","\u887B\u887C\u8880\u8883\u8886\u8887\u8889\u888A\u888C\u888E\u888F\u8890\u8891\u8893\u8894\u8895\u8897",4,"\u889D",4,"\u88A3\u88A5",5,"\u5C0F\u5B5D\u6821\u8096\u5578\u7B11\u6548\u6954\u4E9B\u6B47\u874E\u978B\u534F\u631F\u643A\u90AA\u659C\u80C1\u8C10\u5199\u68B0\u5378\u87F9\u61C8\u6CC4\u6CFB\u8C22\u5C51\u85AA\u82AF\u950C\u6B23\u8F9B\u65B0\u5FFB\u5FC3\u4FE1\u8845\u661F\u8165\u7329\u60FA\u5174\u5211\u578B\u5F62\u90A2\u884C\u9192\u5E78\u674F\u6027\u59D3\u5144\u51F6\u80F8\u5308\u6C79\u96C4\u718A\u4F11\u4FEE\u7F9E\u673D\u55C5\u9508\u79C0\u8896\u7EE3\u589F\u620C\u9700\u865A\u5618\u987B\u5F90\u8BB8\u84C4\u9157\u53D9\u65ED\u5E8F\u755C\u6064\u7D6E\u5A7F\u7EEA\u7EED\u8F69\u55A7\u5BA3\u60AC\u65CB\u7384"],["d140","\u88AC\u88AE\u88AF\u88B0\u88B2",4,"\u88B8\u88B9\u88BA\u88BB\u88BD\u88BE\u88BF\u88C0\u88C3\u88C4\u88C7\u88C8\u88CA\u88CB\u88CC\u88CD\u88CF\u88D0\u88D1\u88D3\u88D6\u88D7\u88DA",4,"\u88E0\u88E1\u88E6\u88E7\u88E9",6,"\u88F2\u88F5\u88F6\u88F7\u88FA\u88FB\u88FD\u88FF\u8900\u8901\u8903",5],["d180","\u8909\u890B",4,"\u8911\u8914",4,"\u891C",4,"\u8922\u8923\u8924\u8926\u8927\u8928\u8929\u892C\u892D\u892E\u892F\u8931\u8932\u8933\u8935\u8937\u9009\u7663\u7729\u7EDA\u9774\u859B\u5B66\u7A74\u96EA\u8840\u52CB\u718F\u5FAA\u65EC\u8BE2\u5BFB\u9A6F\u5DE1\u6B89\u6C5B\u8BAD\u8BAF\u900A\u8FC5\u538B\u62BC\u9E26\u9E2D\u5440\u4E2B\u82BD\u7259\u869C\u5D16\u8859\u6DAF\u96C5\u54D1\u4E9A\u8BB6\u7109\u54BD\u9609\u70DF\u6DF9\u76D0\u4E25\u7814\u8712\u5CA9\u5EF6\u8A00\u989C\u960E\u708E\u6CBF\u5944\u63A9\u773C\u884D\u6F14\u8273\u5830\u71D5\u538C\u781A\u96C1\u5501\u5F66\u7130\u5BB4\u8C1A\u9A8C\u6B83\u592E\u9E2F\u79E7\u6768\u626C\u4F6F\u75A1\u7F8A\u6D0B\u9633\u6C27\u4EF0\u75D2\u517B\u6837\u6F3E\u9080\u8170\u5996\u7476"],["d240","\u8938",8,"\u8942\u8943\u8945",24,"\u8960",5,"\u8967",19,"\u897C"],["d280","\u897D\u897E\u8980\u8982\u8984\u8985\u8987",26,"\u6447\u5C27\u9065\u7A91\u8C23\u59DA\u54AC\u8200\u836F\u8981\u8000\u6930\u564E\u8036\u7237\u91CE\u51B6\u4E5F\u9875\u6396\u4E1A\u53F6\u66F3\u814B\u591C\u6DB2\u4E00\u58F9\u533B\u63D6\u94F1\u4F9D\u4F0A\u8863\u9890\u5937\u9057\u79FB\u4EEA\u80F0\u7591\u6C82\u5B9C\u59E8\u5F5D\u6905\u8681\u501A\u5DF2\u4E59\u77E3\u4EE5\u827A\u6291\u6613\u9091\u5C79\u4EBF\u5F79\u81C6\u9038\u8084\u75AB\u4EA6\u88D4\u610F\u6BC5\u5FC6\u4E49\u76CA\u6EA2\u8BE3\u8BAE\u8C0A\u8BD1\u5F02\u7FFC\u7FCC\u7ECE\u8335\u836B\u56E0\u6BB7\u97F3\u9634\u59FB\u541F\u94F6\u6DEB\u5BC5\u996E\u5C39\u5F15\u9690"],["d340","\u89A2",30,"\u89C3\u89CD\u89D3\u89D4\u89D5\u89D7\u89D8\u89D9\u89DB\u89DD\u89DF\u89E0\u89E1\u89E2\u89E4\u89E7\u89E8\u89E9\u89EA\u89EC\u89ED\u89EE\u89F0\u89F1\u89F2\u89F4",6],["d380","\u89FB",4,"\u8A01",5,"\u8A08",21,"\u5370\u82F1\u6A31\u5A74\u9E70\u5E94\u7F28\u83B9\u8424\u8425\u8367\u8747\u8FCE\u8D62\u76C8\u5F71\u9896\u786C\u6620\u54DF\u62E5\u4F63\u81C3\u75C8\u5EB8\u96CD\u8E0A\u86F9\u548F\u6CF3\u6D8C\u6C38\u607F\u52C7\u7528\u5E7D\u4F18\u60A0\u5FE7\u5C24\u7531\u90AE\u94C0\u72B9\u6CB9\u6E38\u9149\u6709\u53CB\u53F3\u4F51\u91C9\u8BF1\u53C8\u5E7C\u8FC2\u6DE4\u4E8E\u76C2\u6986\u865E\u611A\u8206\u4F59\u4FDE\u903E\u9C7C\u6109\u6E1D\u6E14\u9685\u4E88\u5A31\u96E8\u4E0E\u5C7F\u79B9\u5B87\u8BED\u7FBD\u7389\u57DF\u828B\u90C1\u5401\u9047\u55BB\u5CEA\u5FA1\u6108\u6B32\u72F1\u80B2\u8A89"],["d440","\u8A1E",31,"\u8A3F",8,"\u8A49",21],["d480","\u8A5F",25,"\u8A7A",6,"\u6D74\u5BD3\u88D5\u9884\u8C6B\u9A6D\u9E33\u6E0A\u51A4\u5143\u57A3\u8881\u539F\u63F4\u8F95\u56ED\u5458\u5706\u733F\u6E90\u7F18\u8FDC\u82D1\u613F\u6028\u9662\u66F0\u7EA6\u8D8A\u8DC3\u94A5\u5CB3\u7CA4\u6708\u60A6\u9605\u8018\u4E91\u90E7\u5300\u9668\u5141\u8FD0\u8574\u915D\u6655\u97F5\u5B55\u531D\u7838\u6742\u683D\u54C9\u707E\u5BB0\u8F7D\u518D\u5728\u54B1\u6512\u6682\u8D5E\u8D43\u810F\u846C\u906D\u7CDF\u51FF\u85FB\u67A3\u65E9\u6FA1\u86A4\u8E81\u566A\u9020\u7682\u7076\u71E5\u8D23\u62E9\u5219\u6CFD\u8D3C\u600E\u589E\u618E\u66FE\u8D60\u624E\u55B3\u6E23\u672D\u8F67"],["d540","\u8A81",7,"\u8A8B",7,"\u8A94",46],["d580","\u8AC3",32,"\u94E1\u95F8\u7728\u6805\u69A8\u548B\u4E4D\u70B8\u8BC8\u6458\u658B\u5B85\u7A84\u503A\u5BE8\u77BB\u6BE1\u8A79\u7C98\u6CBE\u76CF\u65A9\u8F97\u5D2D\u5C55\u8638\u6808\u5360\u6218\u7AD9\u6E5B\u7EFD\u6A1F\u7AE0\u5F70\u6F33\u5F20\u638C\u6DA8\u6756\u4E08\u5E10\u8D26\u4ED7\u80C0\u7634\u969C\u62DB\u662D\u627E\u6CBC\u8D75\u7167\u7F69\u5146\u8087\u53EC\u906E\u6298\u54F2\u86F0\u8F99\u8005\u9517\u8517\u8FD9\u6D59\u73CD\u659F\u771F\u7504\u7827\u81FB\u8D1E\u9488\u4FA6\u6795\u75B9\u8BCA\u9707\u632F\u9547\u9635\u84B8\u6323\u7741\u5F81\u72F0\u4E89\u6014\u6574\u62EF\u6B63\u653F"],["d640","\u8AE4",34,"\u8B08",27],["d680","\u8B24\u8B25\u8B27",30,"\u5E27\u75C7\u90D1\u8BC1\u829D\u679D\u652F\u5431\u8718\u77E5\u80A2\u8102\u6C41\u4E4B\u7EC7\u804C\u76F4\u690D\u6B96\u6267\u503C\u4F84\u5740\u6307\u6B62\u8DBE\u53EA\u65E8\u7EB8\u5FD7\u631A\u63B7\u81F3\u81F4\u7F6E\u5E1C\u5CD9\u5236\u667A\u79E9\u7A1A\u8D28\u7099\u75D4\u6EDE\u6CBB\u7A92\u4E2D\u76C5\u5FE0\u949F\u8877\u7EC8\u79CD\u80BF\u91CD\u4EF2\u4F17\u821F\u5468\u5DDE\u6D32\u8BCC\u7CA5\u8F74\u8098\u5E1A\u5492\u76B1\u5B99\u663C\u9AA4\u73E0\u682A\u86DB\u6731\u732A\u8BF8\u8BDB\u9010\u7AF9\u70DB\u716E\u62C4\u77A9\u5631\u4E3B\u8457\u67F1\u52A9\u86C0\u8D2E\u94F8\u7B51"],["d740","\u8B46",31,"\u8B67",4,"\u8B6D",25],["d780","\u8B87",24,"\u8BAC\u8BB1\u8BBB\u8BC7\u8BD0\u8BEA\u8C09\u8C1E\u4F4F\u6CE8\u795D\u9A7B\u6293\u722A\u62FD\u4E13\u7816\u8F6C\u64B0\u8D5A\u7BC6\u6869\u5E84\u88C5\u5986\u649E\u58EE\u72B6\u690E\u9525\u8FFD\u8D58\u5760\u7F00\u8C06\u51C6\u6349\u62D9\u5353\u684C\u7422\u8301\u914C\u5544\u7740\u707C\u6D4A\u5179\u54A8\u8D44\u59FF\u6ECB\u6DC4\u5B5C\u7D2B\u4ED4\u7C7D\u6ED3\u5B50\u81EA\u6E0D\u5B57\u9B03\u68D5\u8E2A\u5B97\u7EFC\u603B\u7EB5\u90B9\u8D70\u594F\u63CD\u79DF\u8DB3\u5352\u65CF\u7956\u8BC5\u963B\u7EC4\u94BB\u7E82\u5634\u9189\u6700\u7F6A\u5C0A\u9075\u6628\u5DE6\u4F50\u67DE\u505A\u4F5C\u5750\u5EA7"],["d840","\u8C38",8,"\u8C42\u8C43\u8C44\u8C45\u8C48\u8C4A\u8C4B\u8C4D",7,"\u8C56\u8C57\u8C58\u8C59\u8C5B",5,"\u8C63",6,"\u8C6C",6,"\u8C74\u8C75\u8C76\u8C77\u8C7B",6,"\u8C83\u8C84\u8C86\u8C87"],["d880","\u8C88\u8C8B\u8C8D",6,"\u8C95\u8C96\u8C97\u8C99",20,"\u4E8D\u4E0C\u5140\u4E10\u5EFF\u5345\u4E15\u4E98\u4E1E\u9B32\u5B6C\u5669\u4E28\u79BA\u4E3F\u5315\u4E47\u592D\u723B\u536E\u6C10\u56DF\u80E4\u9997\u6BD3\u777E\u9F17\u4E36\u4E9F\u9F10\u4E5C\u4E69\u4E93\u8288\u5B5B\u556C\u560F\u4EC4\u538D\u539D\u53A3\u53A5\u53AE\u9765\u8D5D\u531A\u53F5\u5326\u532E\u533E\u8D5C\u5366\u5363\u5202\u5208\u520E\u522D\u5233\u523F\u5240\u524C\u525E\u5261\u525C\u84AF\u527D\u5282\u5281\u5290\u5293\u5182\u7F54\u4EBB\u4EC3\u4EC9\u4EC2\u4EE8\u4EE1\u4EEB\u4EDE\u4F1B\u4EF3\u4F22\u4F64\u4EF5\u4F25\u4F27\u4F09\u4F2B\u4F5E\u4F67\u6538\u4F5A\u4F5D"],["d940","\u8CAE",62],["d980","\u8CED",32,"\u4F5F\u4F57\u4F32\u4F3D\u4F76\u4F74\u4F91\u4F89\u4F83\u4F8F\u4F7E\u4F7B\u4FAA\u4F7C\u4FAC\u4F94\u4FE6\u4FE8\u4FEA\u4FC5\u4FDA\u4FE3\u4FDC\u4FD1\u4FDF\u4FF8\u5029\u504C\u4FF3\u502C\u500F\u502E\u502D\u4FFE\u501C\u500C\u5025\u5028\u507E\u5043\u5055\u5048\u504E\u506C\u507B\u50A5\u50A7\u50A9\u50BA\u50D6\u5106\u50ED\u50EC\u50E6\u50EE\u5107\u510B\u4EDD\u6C3D\u4F58\u4F65\u4FCE\u9FA0\u6C46\u7C74\u516E\u5DFD\u9EC9\u9998\u5181\u5914\u52F9\u530D\u8A07\u5310\u51EB\u5919\u5155\u4EA0\u5156\u4EB3\u886E\u88A4\u4EB5\u8114\u88D2\u7980\u5B34\u8803\u7FB8\u51AB\u51B1\u51BD\u51BC"],["da40","\u8D0E",14,"\u8D20\u8D51\u8D52\u8D57\u8D5F\u8D65\u8D68\u8D69\u8D6A\u8D6C\u8D6E\u8D6F\u8D71\u8D72\u8D78",8,"\u8D82\u8D83\u8D86\u8D87\u8D88\u8D89\u8D8C",4,"\u8D92\u8D93\u8D95",9,"\u8DA0\u8DA1"],["da80","\u8DA2\u8DA4",12,"\u8DB2\u8DB6\u8DB7\u8DB9\u8DBB\u8DBD\u8DC0\u8DC1\u8DC2\u8DC5\u8DC7\u8DC8\u8DC9\u8DCA\u8DCD\u8DD0\u8DD2\u8DD3\u8DD4\u51C7\u5196\u51A2\u51A5\u8BA0\u8BA6\u8BA7\u8BAA\u8BB4\u8BB5\u8BB7\u8BC2\u8BC3\u8BCB\u8BCF\u8BCE\u8BD2\u8BD3\u8BD4\u8BD6\u8BD8\u8BD9\u8BDC\u8BDF\u8BE0\u8BE4\u8BE8\u8BE9\u8BEE\u8BF0\u8BF3\u8BF6\u8BF9\u8BFC\u8BFF\u8C00\u8C02\u8C04\u8C07\u8C0C\u8C0F\u8C11\u8C12\u8C14\u8C15\u8C16\u8C19\u8C1B\u8C18\u8C1D\u8C1F\u8C20\u8C21\u8C25\u8C27\u8C2A\u8C2B\u8C2E\u8C2F\u8C32\u8C33\u8C35\u8C36\u5369\u537A\u961D\u9622\u9621\u9631\u962A\u963D\u963C\u9642\u9649\u9654\u965F\u9667\u966C\u9672\u9674\u9688\u968D\u9697\u96B0\u9097\u909B\u909D\u9099\u90AC\u90A1\u90B4\u90B3\u90B6\u90BA"],["db40","\u8DD5\u8DD8\u8DD9\u8DDC\u8DE0\u8DE1\u8DE2\u8DE5\u8DE6\u8DE7\u8DE9\u8DED\u8DEE\u8DF0\u8DF1\u8DF2\u8DF4\u8DF6\u8DFC\u8DFE",6,"\u8E06\u8E07\u8E08\u8E0B\u8E0D\u8E0E\u8E10\u8E11\u8E12\u8E13\u8E15",7,"\u8E20\u8E21\u8E24",4,"\u8E2B\u8E2D\u8E30\u8E32\u8E33\u8E34\u8E36\u8E37\u8E38\u8E3B\u8E3C\u8E3E"],["db80","\u8E3F\u8E43\u8E45\u8E46\u8E4C",4,"\u8E53",5,"\u8E5A",11,"\u8E67\u8E68\u8E6A\u8E6B\u8E6E\u8E71\u90B8\u90B0\u90CF\u90C5\u90BE\u90D0\u90C4\u90C7\u90D3\u90E6\u90E2\u90DC\u90D7\u90DB\u90EB\u90EF\u90FE\u9104\u9122\u911E\u9123\u9131\u912F\u9139\u9143\u9146\u520D\u5942\u52A2\u52AC\u52AD\u52BE\u54FF\u52D0\u52D6\u52F0\u53DF\u71EE\u77CD\u5EF4\u51F5\u51FC\u9B2F\u53B6\u5F01\u755A\u5DEF\u574C\u57A9\u57A1\u587E\u58BC\u58C5\u58D1\u5729\u572C\u572A\u5733\u5739\u572E\u572F\u575C\u573B\u5742\u5769\u5785\u576B\u5786\u577C\u577B\u5768\u576D\u5776\u5773\u57AD\u57A4\u578C\u57B2\u57CF\u57A7\u57B4\u5793\u57A0\u57D5\u57D8\u57DA\u57D9\u57D2\u57B8\u57F4\u57EF\u57F8\u57E4\u57DD"],["dc40","\u8E73\u8E75\u8E77",4,"\u8E7D\u8E7E\u8E80\u8E82\u8E83\u8E84\u8E86\u8E88",6,"\u8E91\u8E92\u8E93\u8E95",6,"\u8E9D\u8E9F",11,"\u8EAD\u8EAE\u8EB0\u8EB1\u8EB3",6,"\u8EBB",7],["dc80","\u8EC3",10,"\u8ECF",21,"\u580B\u580D\u57FD\u57ED\u5800\u581E\u5819\u5844\u5820\u5865\u586C\u5881\u5889\u589A\u5880\u99A8\u9F19\u61FF\u8279\u827D\u827F\u828F\u828A\u82A8\u8284\u828E\u8291\u8297\u8299\u82AB\u82B8\u82BE\u82B0\u82C8\u82CA\u82E3\u8298\u82B7\u82AE\u82CB\u82CC\u82C1\u82A9\u82B4\u82A1\u82AA\u829F\u82C4\u82CE\u82A4\u82E1\u8309\u82F7\u82E4\u830F\u8307\u82DC\u82F4\u82D2\u82D8\u830C\u82FB\u82D3\u8311\u831A\u8306\u8314\u8315\u82E0\u82D5\u831C\u8351\u835B\u835C\u8308\u8392\u833C\u8334\u8331\u839B\u835E\u832F\u834F\u8347\u8343\u835F\u8340\u8317\u8360\u832D\u833A\u8333\u8366\u8365"],["dd40","\u8EE5",62],["dd80","\u8F24",32,"\u8368\u831B\u8369\u836C\u836A\u836D\u836E\u83B0\u8378\u83B3\u83B4\u83A0\u83AA\u8393\u839C\u8385\u837C\u83B6\u83A9\u837D\u83B8\u837B\u8398\u839E\u83A8\u83BA\u83BC\u83C1\u8401\u83E5\u83D8\u5807\u8418\u840B\u83DD\u83FD\u83D6\u841C\u8438\u8411\u8406\u83D4\u83DF\u840F\u8403\u83F8\u83F9\u83EA\u83C5\u83C0\u8426\u83F0\u83E1\u845C\u8451\u845A\u8459\u8473\u8487\u8488\u847A\u8489\u8478\u843C\u8446\u8469\u8476\u848C\u848E\u8431\u846D\u84C1\u84CD\u84D0\u84E6\u84BD\u84D3\u84CA\u84BF\u84BA\u84E0\u84A1\u84B9\u84B4\u8497\u84E5\u84E3\u850C\u750D\u8538\u84F0\u8539\u851F\u853A"],["de40","\u8F45",32,"\u8F6A\u8F80\u8F8C\u8F92\u8F9D\u8FA0\u8FA1\u8FA2\u8FA4\u8FA5\u8FA6\u8FA7\u8FAA\u8FAC\u8FAD\u8FAE\u8FAF\u8FB2\u8FB3\u8FB4\u8FB5\u8FB7\u8FB8\u8FBA\u8FBB\u8FBC\u8FBF\u8FC0\u8FC3\u8FC6"],["de80","\u8FC9",4,"\u8FCF\u8FD2\u8FD6\u8FD7\u8FDA\u8FE0\u8FE1\u8FE3\u8FE7\u8FEC\u8FEF\u8FF1\u8FF2\u8FF4\u8FF5\u8FF6\u8FFA\u8FFB\u8FFC\u8FFE\u8FFF\u9007\u9008\u900C\u900E\u9013\u9015\u9018\u8556\u853B\u84FF\u84FC\u8559\u8548\u8568\u8564\u855E\u857A\u77A2\u8543\u8572\u857B\u85A4\u85A8\u8587\u858F\u8579\u85AE\u859C\u8585\u85B9\u85B7\u85B0\u85D3\u85C1\u85DC\u85FF\u8627\u8605\u8629\u8616\u863C\u5EFE\u5F08\u593C\u5941\u8037\u5955\u595A\u5958\u530F\u5C22\u5C25\u5C2C\u5C34\u624C\u626A\u629F\u62BB\u62CA\u62DA\u62D7\u62EE\u6322\u62F6\u6339\u634B\u6343\u63AD\u63F6\u6371\u637A\u638E\u63B4\u636D\u63AC\u638A\u6369\u63AE\u63BC\u63F2\u63F8\u63E0\u63FF\u63C4\u63DE\u63CE\u6452\u63C6\u63BE\u6445\u6441\u640B\u641B\u6420\u640C\u6426\u6421\u645E\u6484\u646D\u6496"],["df40","\u9019\u901C\u9023\u9024\u9025\u9027",5,"\u9030",4,"\u9037\u9039\u903A\u903D\u903F\u9040\u9043\u9045\u9046\u9048",4,"\u904E\u9054\u9055\u9056\u9059\u905A\u905C",5,"\u9064\u9066\u9067\u9069\u906A\u906B\u906C\u906F",4,"\u9076",6,"\u907E\u9081"],["df80","\u9084\u9085\u9086\u9087\u9089\u908A\u908C",4,"\u9092\u9094\u9096\u9098\u909A\u909C\u909E\u909F\u90A0\u90A4\u90A5\u90A7\u90A8\u90A9\u90AB\u90AD\u90B2\u90B7\u90BC\u90BD\u90BF\u90C0\u647A\u64B7\u64B8\u6499\u64BA\u64C0\u64D0\u64D7\u64E4\u64E2\u6509\u6525\u652E\u5F0B\u5FD2\u7519\u5F11\u535F\u53F1\u53FD\u53E9\u53E8\u53FB\u5412\u5416\u5406\u544B\u5452\u5453\u5454\u5456\u5443\u5421\u5457\u5459\u5423\u5432\u5482\u5494\u5477\u5471\u5464\u549A\u549B\u5484\u5476\u5466\u549D\u54D0\u54AD\u54C2\u54B4\u54D2\u54A7\u54A6\u54D3\u54D4\u5472\u54A3\u54D5\u54BB\u54BF\u54CC\u54D9\u54DA\u54DC\u54A9\u54AA\u54A4\u54DD\u54CF\u54DE\u551B\u54E7\u5520\u54FD\u5514\u54F3\u5522\u5523\u550F\u5511\u5527\u552A\u5567\u558F\u55B5\u5549\u556D\u5541\u5555\u553F\u5550\u553C"],["e040","\u90C2\u90C3\u90C6\u90C8\u90C9\u90CB\u90CC\u90CD\u90D2\u90D4\u90D5\u90D6\u90D8\u90D9\u90DA\u90DE\u90DF\u90E0\u90E3\u90E4\u90E5\u90E9\u90EA\u90EC\u90EE\u90F0\u90F1\u90F2\u90F3\u90F5\u90F6\u90F7\u90F9\u90FA\u90FB\u90FC\u90FF\u9100\u9101\u9103\u9105",19,"\u911A\u911B\u911C"],["e080","\u911D\u911F\u9120\u9121\u9124",10,"\u9130\u9132",6,"\u913A",8,"\u9144\u5537\u5556\u5575\u5576\u5577\u5533\u5530\u555C\u558B\u55D2\u5583\u55B1\u55B9\u5588\u5581\u559F\u557E\u55D6\u5591\u557B\u55DF\u55BD\u55BE\u5594\u5599\u55EA\u55F7\u55C9\u561F\u55D1\u55EB\u55EC\u55D4\u55E6\u55DD\u55C4\u55EF\u55E5\u55F2\u55F3\u55CC\u55CD\u55E8\u55F5\u55E4\u8F94\u561E\u5608\u560C\u5601\u5624\u5623\u55FE\u5600\u5627\u562D\u5658\u5639\u5657\u562C\u564D\u5662\u5659\u565C\u564C\u5654\u5686\u5664\u5671\u566B\u567B\u567C\u5685\u5693\u56AF\u56D4\u56D7\u56DD\u56E1\u56F5\u56EB\u56F9\u56FF\u5704\u570A\u5709\u571C\u5E0F\u5E19\u5E14\u5E11\u5E31\u5E3B\u5E3C"],["e140","\u9145\u9147\u9148\u9151\u9153\u9154\u9155\u9156\u9158\u9159\u915B\u915C\u915F\u9160\u9166\u9167\u9168\u916B\u916D\u9173\u917A\u917B\u917C\u9180",4,"\u9186\u9188\u918A\u918E\u918F\u9193",6,"\u919C",5,"\u91A4",5,"\u91AB\u91AC\u91B0\u91B1\u91B2\u91B3\u91B6\u91B7\u91B8\u91B9\u91BB"],["e180","\u91BC",10,"\u91C8\u91CB\u91D0\u91D2",9,"\u91DD",8,"\u5E37\u5E44\u5E54\u5E5B\u5E5E\u5E61\u5C8C\u5C7A\u5C8D\u5C90\u5C96\u5C88\u5C98\u5C99\u5C91\u5C9A\u5C9C\u5CB5\u5CA2\u5CBD\u5CAC\u5CAB\u5CB1\u5CA3\u5CC1\u5CB7\u5CC4\u5CD2\u5CE4\u5CCB\u5CE5\u5D02\u5D03\u5D27\u5D26\u5D2E\u5D24\u5D1E\u5D06\u5D1B\u5D58\u5D3E\u5D34\u5D3D\u5D6C\u5D5B\u5D6F\u5D5D\u5D6B\u5D4B\u5D4A\u5D69\u5D74\u5D82\u5D99\u5D9D\u8C73\u5DB7\u5DC5\u5F73\u5F77\u5F82\u5F87\u5F89\u5F8C\u5F95\u5F99\u5F9C\u5FA8\u5FAD\u5FB5\u5FBC\u8862\u5F61\u72AD\u72B0\u72B4\u72B7\u72B8\u72C3\u72C1\u72CE\u72CD\u72D2\u72E8\u72EF\u72E9\u72F2\u72F4\u72F7\u7301\u72F3\u7303\u72FA"],["e240","\u91E6",62],["e280","\u9225",32,"\u72FB\u7317\u7313\u7321\u730A\u731E\u731D\u7315\u7322\u7339\u7325\u732C\u7338\u7331\u7350\u734D\u7357\u7360\u736C\u736F\u737E\u821B\u5925\u98E7\u5924\u5902\u9963\u9967",5,"\u9974\u9977\u997D\u9980\u9984\u9987\u998A\u998D\u9990\u9991\u9993\u9994\u9995\u5E80\u5E91\u5E8B\u5E96\u5EA5\u5EA0\u5EB9\u5EB5\u5EBE\u5EB3\u8D53\u5ED2\u5ED1\u5EDB\u5EE8\u5EEA\u81BA\u5FC4\u5FC9\u5FD6\u5FCF\u6003\u5FEE\u6004\u5FE1\u5FE4\u5FFE\u6005\u6006\u5FEA\u5FED\u5FF8\u6019\u6035\u6026\u601B\u600F\u600D\u6029\u602B\u600A\u603F\u6021\u6078\u6079\u607B\u607A\u6042"],["e340","\u9246",45,"\u9275",16],["e380","\u9286",7,"\u928F",24,"\u606A\u607D\u6096\u609A\u60AD\u609D\u6083\u6092\u608C\u609B\u60EC\u60BB\u60B1\u60DD\u60D8\u60C6\u60DA\u60B4\u6120\u6126\u6115\u6123\u60F4\u6100\u610E\u612B\u614A\u6175\u61AC\u6194\u61A7\u61B7\u61D4\u61F5\u5FDD\u96B3\u95E9\u95EB\u95F1\u95F3\u95F5\u95F6\u95FC\u95FE\u9603\u9604\u9606\u9608\u960A\u960B\u960C\u960D\u960F\u9612\u9615\u9616\u9617\u9619\u961A\u4E2C\u723F\u6215\u6C35\u6C54\u6C5C\u6C4A\u6CA3\u6C85\u6C90\u6C94\u6C8C\u6C68\u6C69\u6C74\u6C76\u6C86\u6CA9\u6CD0\u6CD4\u6CAD\u6CF7\u6CF8\u6CF1\u6CD7\u6CB2\u6CE0\u6CD6\u6CFA\u6CEB\u6CEE\u6CB1\u6CD3\u6CEF\u6CFE"],["e440","\u92A8",5,"\u92AF",24,"\u92C9",31],["e480","\u92E9",32,"\u6D39\u6D27\u6D0C\u6D43\u6D48\u6D07\u6D04\u6D19\u6D0E\u6D2B\u6D4D\u6D2E\u6D35\u6D1A\u6D4F\u6D52\u6D54\u6D33\u6D91\u6D6F\u6D9E\u6DA0\u6D5E\u6D93\u6D94\u6D5C\u6D60\u6D7C\u6D63\u6E1A\u6DC7\u6DC5\u6DDE\u6E0E\u6DBF\u6DE0\u6E11\u6DE6\u6DDD\u6DD9\u6E16\u6DAB\u6E0C\u6DAE\u6E2B\u6E6E\u6E4E\u6E6B\u6EB2\u6E5F\u6E86\u6E53\u6E54\u6E32\u6E25\u6E44\u6EDF\u6EB1\u6E98\u6EE0\u6F2D\u6EE2\u6EA5\u6EA7\u6EBD\u6EBB\u6EB7\u6ED7\u6EB4\u6ECF\u6E8F\u6EC2\u6E9F\u6F62\u6F46\u6F47\u6F24\u6F15\u6EF9\u6F2F\u6F36\u6F4B\u6F74\u6F2A\u6F09\u6F29\u6F89\u6F8D\u6F8C\u6F78\u6F72\u6F7C\u6F7A\u6FD1"],["e540","\u930A",51,"\u933F",10],["e580","\u934A",31,"\u936B\u6FC9\u6FA7\u6FB9\u6FB6\u6FC2\u6FE1\u6FEE\u6FDE\u6FE0\u6FEF\u701A\u7023\u701B\u7039\u7035\u704F\u705E\u5B80\u5B84\u5B95\u5B93\u5BA5\u5BB8\u752F\u9A9E\u6434\u5BE4\u5BEE\u8930\u5BF0\u8E47\u8B07\u8FB6\u8FD3\u8FD5\u8FE5\u8FEE\u8FE4\u8FE9\u8FE6\u8FF3\u8FE8\u9005\u9004\u900B\u9026\u9011\u900D\u9016\u9021\u9035\u9036\u902D\u902F\u9044\u9051\u9052\u9050\u9068\u9058\u9062\u905B\u66B9\u9074\u907D\u9082\u9088\u9083\u908B\u5F50\u5F57\u5F56\u5F58\u5C3B\u54AB\u5C50\u5C59\u5B71\u5C63\u5C66\u7FBC\u5F2A\u5F29\u5F2D\u8274\u5F3C\u9B3B\u5C6E\u5981\u5983\u598D\u59A9\u59AA\u59A3"],["e640","\u936C",34,"\u9390",27],["e680","\u93AC",29,"\u93CB\u93CC\u93CD\u5997\u59CA\u59AB\u599E\u59A4\u59D2\u59B2\u59AF\u59D7\u59BE\u5A05\u5A06\u59DD\u5A08\u59E3\u59D8\u59F9\u5A0C\u5A09\u5A32\u5A34\u5A11\u5A23\u5A13\u5A40\u5A67\u5A4A\u5A55\u5A3C\u5A62\u5A75\u80EC\u5AAA\u5A9B\u5A77\u5A7A\u5ABE\u5AEB\u5AB2\u5AD2\u5AD4\u5AB8\u5AE0\u5AE3\u5AF1\u5AD6\u5AE6\u5AD8\u5ADC\u5B09\u5B17\u5B16\u5B32\u5B37\u5B40\u5C15\u5C1C\u5B5A\u5B65\u5B73\u5B51\u5B53\u5B62\u9A75\u9A77\u9A78\u9A7A\u9A7F\u9A7D\u9A80\u9A81\u9A85\u9A88\u9A8A\u9A90\u9A92\u9A93\u9A96\u9A98\u9A9B\u9A9C\u9A9D\u9A9F\u9AA0\u9AA2\u9AA3\u9AA5\u9AA7\u7E9F\u7EA1\u7EA3\u7EA5\u7EA8\u7EA9"],["e740","\u93CE",7,"\u93D7",54],["e780","\u940E",32,"\u7EAD\u7EB0\u7EBE\u7EC0\u7EC1\u7EC2\u7EC9\u7ECB\u7ECC\u7ED0\u7ED4\u7ED7\u7EDB\u7EE0\u7EE1\u7EE8\u7EEB\u7EEE\u7EEF\u7EF1\u7EF2\u7F0D\u7EF6\u7EFA\u7EFB\u7EFE\u7F01\u7F02\u7F03\u7F07\u7F08\u7F0B\u7F0C\u7F0F\u7F11\u7F12\u7F17\u7F19\u7F1C\u7F1B\u7F1F\u7F21",6,"\u7F2A\u7F2B\u7F2C\u7F2D\u7F2F",4,"\u7F35\u5E7A\u757F\u5DDB\u753E\u9095\u738E\u7391\u73AE\u73A2\u739F\u73CF\u73C2\u73D1\u73B7\u73B3\u73C0\u73C9\u73C8\u73E5\u73D9\u987C\u740A\u73E9\u73E7\u73DE\u73BA\u73F2\u740F\u742A\u745B\u7426\u7425\u7428\u7430\u742E\u742C"],["e840","\u942F",14,"\u943F",43,"\u946C\u946D\u946E\u946F"],["e880","\u9470",20,"\u9491\u9496\u9498\u94C7\u94CF\u94D3\u94D4\u94DA\u94E6\u94FB\u951C\u9520\u741B\u741A\u7441\u745C\u7457\u7455\u7459\u7477\u746D\u747E\u749C\u748E\u7480\u7481\u7487\u748B\u749E\u74A8\u74A9\u7490\u74A7\u74D2\u74BA\u97EA\u97EB\u97EC\u674C\u6753\u675E\u6748\u6769\u67A5\u6787\u676A\u6773\u6798\u67A7\u6775\u67A8\u679E\u67AD\u678B\u6777\u677C\u67F0\u6809\u67D8\u680A\u67E9\u67B0\u680C\u67D9\u67B5\u67DA\u67B3\u67DD\u6800\u67C3\u67B8\u67E2\u680E\u67C1\u67FD\u6832\u6833\u6860\u6861\u684E\u6862\u6844\u6864\u6883\u681D\u6855\u6866\u6841\u6867\u6840\u683E\u684A\u6849\u6829\u68B5\u688F\u6874\u6877\u6893\u686B\u68C2\u696E\u68FC\u691F\u6920\u68F9"],["e940","\u9527\u9533\u953D\u9543\u9548\u954B\u9555\u955A\u9560\u956E\u9574\u9575\u9577",7,"\u9580",42],["e980","\u95AB",32,"\u6924\u68F0\u690B\u6901\u6957\u68E3\u6910\u6971\u6939\u6960\u6942\u695D\u6984\u696B\u6980\u6998\u6978\u6934\u69CC\u6987\u6988\u69CE\u6989\u6966\u6963\u6979\u699B\u69A7\u69BB\u69AB\u69AD\u69D4\u69B1\u69C1\u69CA\u69DF\u6995\u69E0\u698D\u69FF\u6A2F\u69ED\u6A17\u6A18\u6A65\u69F2\u6A44\u6A3E\u6AA0\u6A50\u6A5B\u6A35\u6A8E\u6A79\u6A3D\u6A28\u6A58\u6A7C\u6A91\u6A90\u6AA9\u6A97\u6AAB\u7337\u7352\u6B81\u6B82\u6B87\u6B84\u6B92\u6B93\u6B8D\u6B9A\u6B9B\u6BA1\u6BAA\u8F6B\u8F6D\u8F71\u8F72\u8F73\u8F75\u8F76\u8F78\u8F77\u8F79\u8F7A\u8F7C\u8F7E\u8F81\u8F82\u8F84\u8F87\u8F8B"],["ea40","\u95CC",27,"\u95EC\u95FF\u9607\u9613\u9618\u961B\u961E\u9620\u9623",6,"\u962B\u962C\u962D\u962F\u9630\u9637\u9638\u9639\u963A\u963E\u9641\u9643\u964A\u964E\u964F\u9651\u9652\u9653\u9656\u9657"],["ea80","\u9658\u9659\u965A\u965C\u965D\u965E\u9660\u9663\u9665\u9666\u966B\u966D",4,"\u9673\u9678",12,"\u9687\u9689\u968A\u8F8D\u8F8E\u8F8F\u8F98\u8F9A\u8ECE\u620B\u6217\u621B\u621F\u6222\u6221\u6225\u6224\u622C\u81E7\u74EF\u74F4\u74FF\u750F\u7511\u7513\u6534\u65EE\u65EF\u65F0\u660A\u6619\u6772\u6603\u6615\u6600\u7085\u66F7\u661D\u6634\u6631\u6636\u6635\u8006\u665F\u6654\u6641\u664F\u6656\u6661\u6657\u6677\u6684\u668C\u66A7\u669D\u66BE\u66DB\u66DC\u66E6\u66E9\u8D32\u8D33\u8D36\u8D3B\u8D3D\u8D40\u8D45\u8D46\u8D48\u8D49\u8D47\u8D4D\u8D55\u8D59\u89C7\u89CA\u89CB\u89CC\u89CE\u89CF\u89D0\u89D1\u726E\u729F\u725D\u7266\u726F\u727E\u727F\u7284\u728B\u728D\u728F\u7292\u6308\u6332\u63B0"],["eb40","\u968C\u968E\u9691\u9692\u9693\u9695\u9696\u969A\u969B\u969D",9,"\u96A8",7,"\u96B1\u96B2\u96B4\u96B5\u96B7\u96B8\u96BA\u96BB\u96BF\u96C2\u96C3\u96C8\u96CA\u96CB\u96D0\u96D1\u96D3\u96D4\u96D6",9,"\u96E1",6,"\u96EB"],["eb80","\u96EC\u96ED\u96EE\u96F0\u96F1\u96F2\u96F4\u96F5\u96F8\u96FA\u96FB\u96FC\u96FD\u96FF\u9702\u9703\u9705\u970A\u970B\u970C\u9710\u9711\u9712\u9714\u9715\u9717",4,"\u971D\u971F\u9720\u643F\u64D8\u8004\u6BEA\u6BF3\u6BFD\u6BF5\u6BF9\u6C05\u6C07\u6C06\u6C0D\u6C15\u6C18\u6C19\u6C1A\u6C21\u6C29\u6C24\u6C2A\u6C32\u6535\u6555\u656B\u724D\u7252\u7256\u7230\u8662\u5216\u809F\u809C\u8093\u80BC\u670A\u80BD\u80B1\u80AB\u80AD\u80B4\u80B7\u80E7\u80E8\u80E9\u80EA\u80DB\u80C2\u80C4\u80D9\u80CD\u80D7\u6710\u80DD\u80EB\u80F1\u80F4\u80ED\u810D\u810E\u80F2\u80FC\u6715\u8112\u8C5A\u8136\u811E\u812C\u8118\u8132\u8148\u814C\u8153\u8174\u8159\u815A\u8171\u8160\u8169\u817C\u817D\u816D\u8167\u584D\u5AB5\u8188\u8182\u8191\u6ED5\u81A3\u81AA\u81CC\u6726\u81CA\u81BB"],["ec40","\u9721",8,"\u972B\u972C\u972E\u972F\u9731\u9733",4,"\u973A\u973B\u973C\u973D\u973F",18,"\u9754\u9755\u9757\u9758\u975A\u975C\u975D\u975F\u9763\u9764\u9766\u9767\u9768\u976A",7],["ec80","\u9772\u9775\u9777",4,"\u977D",7,"\u9786",4,"\u978C\u978E\u978F\u9790\u9793\u9795\u9796\u9797\u9799",4,"\u81C1\u81A6\u6B24\u6B37\u6B39\u6B43\u6B46\u6B59\u98D1\u98D2\u98D3\u98D5\u98D9\u98DA\u6BB3\u5F40\u6BC2\u89F3\u6590\u9F51\u6593\u65BC\u65C6\u65C4\u65C3\u65CC\u65CE\u65D2\u65D6\u7080\u709C\u7096\u709D\u70BB\u70C0\u70B7\u70AB\u70B1\u70E8\u70CA\u7110\u7113\u7116\u712F\u7131\u7173\u715C\u7168\u7145\u7172\u714A\u7178\u717A\u7198\u71B3\u71B5\u71A8\u71A0\u71E0\u71D4\u71E7\u71F9\u721D\u7228\u706C\u7118\u7166\u71B9\u623E\u623D\u6243\u6248\u6249\u793B\u7940\u7946\u7949\u795B\u795C\u7953\u795A\u7962\u7957\u7960\u796F\u7967\u797A\u7985\u798A\u799A\u79A7\u79B3\u5FD1\u5FD0"],["ed40","\u979E\u979F\u97A1\u97A2\u97A4",6,"\u97AC\u97AE\u97B0\u97B1\u97B3\u97B5",46],["ed80","\u97E4\u97E5\u97E8\u97EE",4,"\u97F4\u97F7",23,"\u603C\u605D\u605A\u6067\u6041\u6059\u6063\u60AB\u6106\u610D\u615D\u61A9\u619D\u61CB\u61D1\u6206\u8080\u807F\u6C93\u6CF6\u6DFC\u77F6\u77F8\u7800\u7809\u7817\u7818\u7811\u65AB\u782D\u781C\u781D\u7839\u783A\u783B\u781F\u783C\u7825\u782C\u7823\u7829\u784E\u786D\u7856\u7857\u7826\u7850\u7847\u784C\u786A\u789B\u7893\u789A\u7887\u789C\u78A1\u78A3\u78B2\u78B9\u78A5\u78D4\u78D9\u78C9\u78EC\u78F2\u7905\u78F4\u7913\u7924\u791E\u7934\u9F9B\u9EF9\u9EFB\u9EFC\u76F1\u7704\u770D\u76F9\u7707\u7708\u771A\u7722\u7719\u772D\u7726\u7735\u7738\u7750\u7751\u7747\u7743\u775A\u7768"],["ee40","\u980F",62],["ee80","\u984E",32,"\u7762\u7765\u777F\u778D\u777D\u7780\u778C\u7791\u779F\u77A0\u77B0\u77B5\u77BD\u753A\u7540\u754E\u754B\u7548\u755B\u7572\u7579\u7583\u7F58\u7F61\u7F5F\u8A48\u7F68\u7F74\u7F71\u7F79\u7F81\u7F7E\u76CD\u76E5\u8832\u9485\u9486\u9487\u948B\u948A\u948C\u948D\u948F\u9490\u9494\u9497\u9495\u949A\u949B\u949C\u94A3\u94A4\u94AB\u94AA\u94AD\u94AC\u94AF\u94B0\u94B2\u94B4\u94B6",4,"\u94BC\u94BD\u94BF\u94C4\u94C8",6,"\u94D0\u94D1\u94D2\u94D5\u94D6\u94D7\u94D9\u94D8\u94DB\u94DE\u94DF\u94E0\u94E2\u94E4\u94E5\u94E7\u94E8\u94EA"],["ef40","\u986F",5,"\u988B\u988E\u9892\u9895\u9899\u98A3\u98A8",37,"\u98CF\u98D0\u98D4\u98D6\u98D7\u98DB\u98DC\u98DD\u98E0",4],["ef80","\u98E5\u98E6\u98E9",30,"\u94E9\u94EB\u94EE\u94EF\u94F3\u94F4\u94F5\u94F7\u94F9\u94FC\u94FD\u94FF\u9503\u9502\u9506\u9507\u9509\u950A\u950D\u950E\u950F\u9512",4,"\u9518\u951B\u951D\u951E\u951F\u9522\u952A\u952B\u9529\u952C\u9531\u9532\u9534\u9536\u9537\u9538\u953C\u953E\u953F\u9542\u9535\u9544\u9545\u9546\u9549\u954C\u954E\u954F\u9552\u9553\u9554\u9556\u9557\u9558\u9559\u955B\u955E\u955F\u955D\u9561\u9562\u9564",8,"\u956F\u9571\u9572\u9573\u953A\u77E7\u77EC\u96C9\u79D5\u79ED\u79E3\u79EB\u7A06\u5D47\u7A03\u7A02\u7A1E\u7A14"],["f040","\u9908",4,"\u990E\u990F\u9911",28,"\u992F",26],["f080","\u994A",9,"\u9956",12,"\u9964\u9966\u9973\u9978\u9979\u997B\u997E\u9982\u9983\u9989\u7A39\u7A37\u7A51\u9ECF\u99A5\u7A70\u7688\u768E\u7693\u7699\u76A4\u74DE\u74E0\u752C\u9E20\u9E22\u9E28",4,"\u9E32\u9E31\u9E36\u9E38\u9E37\u9E39\u9E3A\u9E3E\u9E41\u9E42\u9E44\u9E46\u9E47\u9E48\u9E49\u9E4B\u9E4C\u9E4E\u9E51\u9E55\u9E57\u9E5A\u9E5B\u9E5C\u9E5E\u9E63\u9E66",6,"\u9E71\u9E6D\u9E73\u7592\u7594\u7596\u75A0\u759D\u75AC\u75A3\u75B3\u75B4\u75B8\u75C4\u75B1\u75B0\u75C3\u75C2\u75D6\u75CD\u75E3\u75E8\u75E6\u75E4\u75EB\u75E7\u7603\u75F1\u75FC\u75FF\u7610\u7600\u7605\u760C\u7617\u760A\u7625\u7618\u7615\u7619"],["f140","\u998C\u998E\u999A",10,"\u99A6\u99A7\u99A9",47],["f180","\u99D9",32,"\u761B\u763C\u7622\u7620\u7640\u762D\u7630\u763F\u7635\u7643\u763E\u7633\u764D\u765E\u7654\u765C\u7656\u766B\u766F\u7FCA\u7AE6\u7A78\u7A79\u7A80\u7A86\u7A88\u7A95\u7AA6\u7AA0\u7AAC\u7AA8\u7AAD\u7AB3\u8864\u8869\u8872\u887D\u887F\u8882\u88A2\u88C6\u88B7\u88BC\u88C9\u88E2\u88CE\u88E3\u88E5\u88F1\u891A\u88FC\u88E8\u88FE\u88F0\u8921\u8919\u8913\u891B\u890A\u8934\u892B\u8936\u8941\u8966\u897B\u758B\u80E5\u76B2\u76B4\u77DC\u8012\u8014\u8016\u801C\u8020\u8022\u8025\u8026\u8027\u8029\u8028\u8031\u800B\u8035\u8043\u8046\u804D\u8052\u8069\u8071\u8983\u9878\u9880\u9883"],["f240","\u99FA",62],["f280","\u9A39",32,"\u9889\u988C\u988D\u988F\u9894\u989A\u989B\u989E\u989F\u98A1\u98A2\u98A5\u98A6\u864D\u8654\u866C\u866E\u867F\u867A\u867C\u867B\u86A8\u868D\u868B\u86AC\u869D\u86A7\u86A3\u86AA\u8693\u86A9\u86B6\u86C4\u86B5\u86CE\u86B0\u86BA\u86B1\u86AF\u86C9\u86CF\u86B4\u86E9\u86F1\u86F2\u86ED\u86F3\u86D0\u8713\u86DE\u86F4\u86DF\u86D8\u86D1\u8703\u8707\u86F8\u8708\u870A\u870D\u8709\u8723\u873B\u871E\u8725\u872E\u871A\u873E\u8748\u8734\u8731\u8729\u8737\u873F\u8782\u8722\u877D\u877E\u877B\u8760\u8770\u874C\u876E\u878B\u8753\u8763\u877C\u8764\u8759\u8765\u8793\u87AF\u87A8\u87D2"],["f340","\u9A5A",17,"\u9A72\u9A83\u9A89\u9A8D\u9A8E\u9A94\u9A95\u9A99\u9AA6\u9AA9",6,"\u9AB2\u9AB3\u9AB4\u9AB5\u9AB9\u9ABB\u9ABD\u9ABE\u9ABF\u9AC3\u9AC4\u9AC6",4,"\u9ACD\u9ACE\u9ACF\u9AD0\u9AD2\u9AD4\u9AD5\u9AD6\u9AD7\u9AD9\u9ADA\u9ADB\u9ADC"],["f380","\u9ADD\u9ADE\u9AE0\u9AE2\u9AE3\u9AE4\u9AE5\u9AE7\u9AE8\u9AE9\u9AEA\u9AEC\u9AEE\u9AF0",8,"\u9AFA\u9AFC",6,"\u9B04\u9B05\u9B06\u87C6\u8788\u8785\u87AD\u8797\u8783\u87AB\u87E5\u87AC\u87B5\u87B3\u87CB\u87D3\u87BD\u87D1\u87C0\u87CA\u87DB\u87EA\u87E0\u87EE\u8816\u8813\u87FE\u880A\u881B\u8821\u8839\u883C\u7F36\u7F42\u7F44\u7F45\u8210\u7AFA\u7AFD\u7B08\u7B03\u7B04\u7B15\u7B0A\u7B2B\u7B0F\u7B47\u7B38\u7B2A\u7B19\u7B2E\u7B31\u7B20\u7B25\u7B24\u7B33\u7B3E\u7B1E\u7B58\u7B5A\u7B45\u7B75\u7B4C\u7B5D\u7B60\u7B6E\u7B7B\u7B62\u7B72\u7B71\u7B90\u7BA6\u7BA7\u7BB8\u7BAC\u7B9D\u7BA8\u7B85\u7BAA\u7B9C\u7BA2\u7BAB\u7BB4\u7BD1\u7BC1\u7BCC\u7BDD\u7BDA\u7BE5\u7BE6\u7BEA\u7C0C\u7BFE\u7BFC\u7C0F\u7C16\u7C0B"],["f440","\u9B07\u9B09",5,"\u9B10\u9B11\u9B12\u9B14",10,"\u9B20\u9B21\u9B22\u9B24",10,"\u9B30\u9B31\u9B33",7,"\u9B3D\u9B3E\u9B3F\u9B40\u9B46\u9B4A\u9B4B\u9B4C\u9B4E\u9B50\u9B52\u9B53\u9B55",5],["f480","\u9B5B",32,"\u7C1F\u7C2A\u7C26\u7C38\u7C41\u7C40\u81FE\u8201\u8202\u8204\u81EC\u8844\u8221\u8222\u8223\u822D\u822F\u8228\u822B\u8238\u823B\u8233\u8234\u823E\u8244\u8249\u824B\u824F\u825A\u825F\u8268\u887E\u8885\u8888\u88D8\u88DF\u895E\u7F9D\u7F9F\u7FA7\u7FAF\u7FB0\u7FB2\u7C7C\u6549\u7C91\u7C9D\u7C9C\u7C9E\u7CA2\u7CB2\u7CBC\u7CBD\u7CC1\u7CC7\u7CCC\u7CCD\u7CC8\u7CC5\u7CD7\u7CE8\u826E\u66A8\u7FBF\u7FCE\u7FD5\u7FE5\u7FE1\u7FE6\u7FE9\u7FEE\u7FF3\u7CF8\u7D77\u7DA6\u7DAE\u7E47\u7E9B\u9EB8\u9EB4\u8D73\u8D84\u8D94\u8D91\u8DB1\u8D67\u8D6D\u8C47\u8C49\u914A\u9150\u914E\u914F\u9164"],["f540","\u9B7C",62],["f580","\u9BBB",32,"\u9162\u9161\u9170\u9169\u916F\u917D\u917E\u9172\u9174\u9179\u918C\u9185\u9190\u918D\u9191\u91A2\u91A3\u91AA\u91AD\u91AE\u91AF\u91B5\u91B4\u91BA\u8C55\u9E7E\u8DB8\u8DEB\u8E05\u8E59\u8E69\u8DB5\u8DBF\u8DBC\u8DBA\u8DC4\u8DD6\u8DD7\u8DDA\u8DDE\u8DCE\u8DCF\u8DDB\u8DC6\u8DEC\u8DF7\u8DF8\u8DE3\u8DF9\u8DFB\u8DE4\u8E09\u8DFD\u8E14\u8E1D\u8E1F\u8E2C\u8E2E\u8E23\u8E2F\u8E3A\u8E40\u8E39\u8E35\u8E3D\u8E31\u8E49\u8E41\u8E42\u8E51\u8E52\u8E4A\u8E70\u8E76\u8E7C\u8E6F\u8E74\u8E85\u8E8F\u8E94\u8E90\u8E9C\u8E9E\u8C78\u8C82\u8C8A\u8C85\u8C98\u8C94\u659B\u89D6\u89DE\u89DA\u89DC"],["f640","\u9BDC",62],["f680","\u9C1B",32,"\u89E5\u89EB\u89EF\u8A3E\u8B26\u9753\u96E9\u96F3\u96EF\u9706\u9701\u9708\u970F\u970E\u972A\u972D\u9730\u973E\u9F80\u9F83\u9F85",5,"\u9F8C\u9EFE\u9F0B\u9F0D\u96B9\u96BC\u96BD\u96CE\u96D2\u77BF\u96E0\u928E\u92AE\u92C8\u933E\u936A\u93CA\u938F\u943E\u946B\u9C7F\u9C82\u9C85\u9C86\u9C87\u9C88\u7A23\u9C8B\u9C8E\u9C90\u9C91\u9C92\u9C94\u9C95\u9C9A\u9C9B\u9C9E",5,"\u9CA5",4,"\u9CAB\u9CAD\u9CAE\u9CB0",7,"\u9CBA\u9CBB\u9CBC\u9CBD\u9CC4\u9CC5\u9CC6\u9CC7\u9CCA\u9CCB"],["f740","\u9C3C",62],["f780","\u9C7B\u9C7D\u9C7E\u9C80\u9C83\u9C84\u9C89\u9C8A\u9C8C\u9C8F\u9C93\u9C96\u9C97\u9C98\u9C99\u9C9D\u9CAA\u9CAC\u9CAF\u9CB9\u9CBE",4,"\u9CC8\u9CC9\u9CD1\u9CD2\u9CDA\u9CDB\u9CE0\u9CE1\u9CCC",4,"\u9CD3\u9CD4\u9CD5\u9CD7\u9CD8\u9CD9\u9CDC\u9CDD\u9CDF\u9CE2\u977C\u9785\u9791\u9792\u9794\u97AF\u97AB\u97A3\u97B2\u97B4\u9AB1\u9AB0\u9AB7\u9E58\u9AB6\u9ABA\u9ABC\u9AC1\u9AC0\u9AC5\u9AC2\u9ACB\u9ACC\u9AD1\u9B45\u9B43\u9B47\u9B49\u9B48\u9B4D\u9B51\u98E8\u990D\u992E\u9955\u9954\u9ADF\u9AE1\u9AE6\u9AEF\u9AEB\u9AFB\u9AED\u9AF9\u9B08\u9B0F\u9B13\u9B1F\u9B23\u9EBD\u9EBE\u7E3B\u9E82\u9E87\u9E88\u9E8B\u9E92\u93D6\u9E9D\u9E9F\u9EDB\u9EDC\u9EDD\u9EE0\u9EDF\u9EE2\u9EE9\u9EE7\u9EE5\u9EEA\u9EEF\u9F22\u9F2C\u9F2F\u9F39\u9F37\u9F3D\u9F3E\u9F44"],["f840","\u9CE3",62],["f880","\u9D22",32],["f940","\u9D43",62],["f980","\u9D82",32],["fa40","\u9DA3",62],["fa80","\u9DE2",32],["fb40","\u9E03",27,"\u9E24\u9E27\u9E2E\u9E30\u9E34\u9E3B\u9E3C\u9E40\u9E4D\u9E50\u9E52\u9E53\u9E54\u9E56\u9E59\u9E5D\u9E5F\u9E60\u9E61\u9E62\u9E65\u9E6E\u9E6F\u9E72\u9E74",9,"\u9E80"],["fb80","\u9E81\u9E83\u9E84\u9E85\u9E86\u9E89\u9E8A\u9E8C",5,"\u9E94",8,"\u9E9E\u9EA0",5,"\u9EA7\u9EA8\u9EA9\u9EAA"],["fc40","\u9EAB",8,"\u9EB5\u9EB6\u9EB7\u9EB9\u9EBA\u9EBC\u9EBF",4,"\u9EC5\u9EC6\u9EC7\u9EC8\u9ECA\u9ECB\u9ECC\u9ED0\u9ED2\u9ED3\u9ED5\u9ED6\u9ED7\u9ED9\u9EDA\u9EDE\u9EE1\u9EE3\u9EE4\u9EE6\u9EE8\u9EEB\u9EEC\u9EED\u9EEE\u9EF0",8,"\u9EFA\u9EFD\u9EFF",6],["fc80","\u9F06",4,"\u9F0C\u9F0F\u9F11\u9F12\u9F14\u9F15\u9F16\u9F18\u9F1A",5,"\u9F21\u9F23",8,"\u9F2D\u9F2E\u9F30\u9F31"],["fd40","\u9F32",4,"\u9F38\u9F3A\u9F3C\u9F3F",4,"\u9F45",10,"\u9F52",38],["fd80","\u9F79",5,"\u9F81\u9F82\u9F8D",11,"\u9F9C\u9F9D\u9F9E\u9FA1",4,"\uF92C\uF979\uF995\uF9E7\uF9F1"],["fe40","\uFA0C\uFA0D\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA18\uFA1F\uFA20\uFA21\uFA23\uFA24\uFA27\uFA28\uFA29"]]});var uv=H((wle,MG)=>{MG.exports=[["a140","\uE4C6",62],["a180","\uE505",32],["a240","\uE526",62],["a280","\uE565",32],["a2ab","\uE766",5],["a2e3","\u20AC\uE76D"],["a2ef","\uE76E\uE76F"],["a2fd","\uE770\uE771"],["a340","\uE586",62],["a380","\uE5C5",31,"\u3000"],["a440","\uE5E6",62],["a480","\uE625",32],["a4f4","\uE772",10],["a540","\uE646",62],["a580","\uE685",32],["a5f7","\uE77D",7],["a640","\uE6A6",62],["a680","\uE6E5",32],["a6b9","\uE785",7],["a6d9","\uE78D",6],["a6ec","\uE794\uE795"],["a6f3","\uE796"],["a6f6","\uE797",8],["a740","\uE706",62],["a780","\uE745",32],["a7c2","\uE7A0",14],["a7f2","\uE7AF",12],["a896","\uE7BC",10],["a8bc","\uE7C7"],["a8bf","\u01F9"],["a8c1","\uE7C9\uE7CA\uE7CB\uE7CC"],["a8ea","\uE7CD",20],["a958","\uE7E2"],["a95b","\uE7E3"],["a95d","\uE7E4\uE7E5\uE7E6"],["a989","\u303E\u2FF0",11],["a997","\uE7F4",12],["a9f0","\uE801",14],["aaa1","\uE000",93],["aba1","\uE05E",93],["aca1","\uE0BC",93],["ada1","\uE11A",93],["aea1","\uE178",93],["afa1","\uE1D6",93],["d7fa","\uE810",4],["f8a1","\uE234",93],["f9a1","\uE292",93],["faa1","\uE2F0",93],["fba1","\uE34E",93],["fca1","\uE3AC",93],["fda1","\uE40A",93],["fe50","\u2E81\uE816\uE817\uE818\u2E84\u3473\u3447\u2E88\u2E8B\uE81E\u359E\u361A\u360E\u2E8C\u2E97\u396E\u3918\uE826\u39CF\u39DF\u3A73\u39D0\uE82B\uE82C\u3B4E\u3C6E\u3CE0\u2EA7\uE831\uE832\u2EAA\u4056\u415F\u2EAE\u4337\u2EB3\u2EB6\u2EB7\uE83B\u43B1\u43AC\u2EBB\u43DD\u44D6\u4661\u464C\uE843"],["fe80","\u4723\u4729\u477C\u478D\u2ECA\u4947\u497A\u497D\u4982\u4983\u4985\u4986\u499F\u499B\u49B7\u49B6\uE854\uE855\u4CA3\u4C9F\u4CA0\u4CA1\u4C77\u4CA2\u4D13",6,"\u4DAE\uE864\uE468",93]]});var nO=H((Ile,UG)=>{UG.exports={uChars:[128,165,169,178,184,216,226,235,238,244,248,251,253,258,276,284,300,325,329,334,364,463,465,467,469,471,473,475,477,506,594,610,712,716,730,930,938,962,970,1026,1104,1106,8209,8215,8218,8222,8231,8241,8244,8246,8252,8365,8452,8454,8458,8471,8482,8556,8570,8596,8602,8713,8720,8722,8726,8731,8737,8740,8742,8748,8751,8760,8766,8777,8781,8787,8802,8808,8816,8854,8858,8870,8896,8979,9322,9372,9548,9588,9616,9622,9634,9652,9662,9672,9676,9680,9702,9735,9738,9793,9795,11906,11909,11913,11917,11928,11944,11947,11951,11956,11960,11964,11979,12284,12292,12312,12319,12330,12351,12436,12447,12535,12543,12586,12842,12850,12964,13200,13215,13218,13253,13263,13267,13270,13384,13428,13727,13839,13851,14617,14703,14801,14816,14964,15183,15471,15585,16471,16736,17208,17325,17330,17374,17623,17997,18018,18212,18218,18301,18318,18760,18811,18814,18820,18823,18844,18848,18872,19576,19620,19738,19887,40870,59244,59336,59367,59413,59417,59423,59431,59437,59443,59452,59460,59478,59493,63789,63866,63894,63976,63986,64016,64018,64021,64025,64034,64037,64042,65074,65093,65107,65112,65127,65132,65375,65510,65536],gbChars:[0,36,38,45,50,81,89,95,96,100,103,104,105,109,126,133,148,172,175,179,208,306,307,308,309,310,311,312,313,341,428,443,544,545,558,741,742,749,750,805,819,820,7922,7924,7925,7927,7934,7943,7944,7945,7950,8062,8148,8149,8152,8164,8174,8236,8240,8262,8264,8374,8380,8381,8384,8388,8390,8392,8393,8394,8396,8401,8406,8416,8419,8424,8437,8439,8445,8482,8485,8496,8521,8603,8936,8946,9046,9050,9063,9066,9076,9092,9100,9108,9111,9113,9131,9162,9164,9218,9219,11329,11331,11334,11336,11346,11361,11363,11366,11370,11372,11375,11389,11682,11686,11687,11692,11694,11714,11716,11723,11725,11730,11736,11982,11989,12102,12336,12348,12350,12384,12393,12395,12397,12510,12553,12851,12962,12973,13738,13823,13919,13933,14080,14298,14585,14698,15583,15847,16318,16434,16438,16481,16729,17102,17122,17315,17320,17402,17418,17859,17909,17911,17915,17916,17936,17939,17961,18664,18703,18814,18962,19043,33469,33470,33471,33484,33485,33490,33497,33501,33505,33513,33520,33536,33550,37845,37921,37948,38029,38038,38064,38065,38066,38069,38075,38076,38078,39108,39109,39113,39114,39115,39116,39265,39394,189e3]}});var aO=H((xle,BG)=>{BG.exports=[["0","\0",127],["8141","\uAC02\uAC03\uAC05\uAC06\uAC0B",4,"\uAC18\uAC1E\uAC1F\uAC21\uAC22\uAC23\uAC25",6,"\uAC2E\uAC32\uAC33\uAC34"],["8161","\uAC35\uAC36\uAC37\uAC3A\uAC3B\uAC3D\uAC3E\uAC3F\uAC41",9,"\uAC4C\uAC4E",5,"\uAC55"],["8181","\uAC56\uAC57\uAC59\uAC5A\uAC5B\uAC5D",18,"\uAC72\uAC73\uAC75\uAC76\uAC79\uAC7B",4,"\uAC82\uAC87\uAC88\uAC8D\uAC8E\uAC8F\uAC91\uAC92\uAC93\uAC95",6,"\uAC9E\uACA2",5,"\uACAB\uACAD\uACAE\uACB1",6,"\uACBA\uACBE\uACBF\uACC0\uACC2\uACC3\uACC5\uACC6\uACC7\uACC9\uACCA\uACCB\uACCD",7,"\uACD6\uACD8",7,"\uACE2\uACE3\uACE5\uACE6\uACE9\uACEB\uACED\uACEE\uACF2\uACF4\uACF7",4,"\uACFE\uACFF\uAD01\uAD02\uAD03\uAD05\uAD07",4,"\uAD0E\uAD10\uAD12\uAD13"],["8241","\uAD14\uAD15\uAD16\uAD17\uAD19\uAD1A\uAD1B\uAD1D\uAD1E\uAD1F\uAD21",7,"\uAD2A\uAD2B\uAD2E",5],["8261","\uAD36\uAD37\uAD39\uAD3A\uAD3B\uAD3D",6,"\uAD46\uAD48\uAD4A",5,"\uAD51\uAD52\uAD53\uAD55\uAD56\uAD57"],["8281","\uAD59",7,"\uAD62\uAD64",7,"\uAD6E\uAD6F\uAD71\uAD72\uAD77\uAD78\uAD79\uAD7A\uAD7E\uAD80\uAD83",4,"\uAD8A\uAD8B\uAD8D\uAD8E\uAD8F\uAD91",10,"\uAD9E",5,"\uADA5",17,"\uADB8",7,"\uADC2\uADC3\uADC5\uADC6\uADC7\uADC9",6,"\uADD2\uADD4",7,"\uADDD\uADDE\uADDF\uADE1\uADE2\uADE3\uADE5",18],["8341","\uADFA\uADFB\uADFD\uADFE\uAE02",5,"\uAE0A\uAE0C\uAE0E",5,"\uAE15",7],["8361","\uAE1D",18,"\uAE32\uAE33\uAE35\uAE36\uAE39\uAE3B\uAE3C"],["8381","\uAE3D\uAE3E\uAE3F\uAE42\uAE44\uAE47\uAE48\uAE49\uAE4B\uAE4F\uAE51\uAE52\uAE53\uAE55\uAE57",4,"\uAE5E\uAE62\uAE63\uAE64\uAE66\uAE67\uAE6A\uAE6B\uAE6D\uAE6E\uAE6F\uAE71",6,"\uAE7A\uAE7E",5,"\uAE86",5,"\uAE8D",46,"\uAEBF\uAEC1\uAEC2\uAEC3\uAEC5",6,"\uAECE\uAED2",5,"\uAEDA\uAEDB\uAEDD",8],["8441","\uAEE6\uAEE7\uAEE9\uAEEA\uAEEC\uAEEE",5,"\uAEF5\uAEF6\uAEF7\uAEF9\uAEFA\uAEFB\uAEFD",8],["8461","\uAF06\uAF09\uAF0A\uAF0B\uAF0C\uAF0E\uAF0F\uAF11",18],["8481","\uAF24",7,"\uAF2E\uAF2F\uAF31\uAF33\uAF35",6,"\uAF3E\uAF40\uAF44\uAF45\uAF46\uAF47\uAF4A",5,"\uAF51",10,"\uAF5E",5,"\uAF66",18,"\uAF7A",5,"\uAF81\uAF82\uAF83\uAF85\uAF86\uAF87\uAF89",6,"\uAF92\uAF93\uAF94\uAF96",5,"\uAF9D",26,"\uAFBA\uAFBB\uAFBD\uAFBE"],["8541","\uAFBF\uAFC1",5,"\uAFCA\uAFCC\uAFCF",4,"\uAFD5",6,"\uAFDD",4],["8561","\uAFE2",5,"\uAFEA",5,"\uAFF2\uAFF3\uAFF5\uAFF6\uAFF7\uAFF9",6,"\uB002\uB003"],["8581","\uB005",6,"\uB00D\uB00E\uB00F\uB011\uB012\uB013\uB015",6,"\uB01E",9,"\uB029",26,"\uB046\uB047\uB049\uB04B\uB04D\uB04F\uB050\uB051\uB052\uB056\uB058\uB05A\uB05B\uB05C\uB05E",29,"\uB07E\uB07F\uB081\uB082\uB083\uB085",6,"\uB08E\uB090\uB092",5,"\uB09B\uB09D\uB09E\uB0A3\uB0A4"],["8641","\uB0A5\uB0A6\uB0A7\uB0AA\uB0B0\uB0B2\uB0B6\uB0B7\uB0B9\uB0BA\uB0BB\uB0BD",6,"\uB0C6\uB0CA",5,"\uB0D2"],["8661","\uB0D3\uB0D5\uB0D6\uB0D7\uB0D9",6,"\uB0E1\uB0E2\uB0E3\uB0E4\uB0E6",10],["8681","\uB0F1",22,"\uB10A\uB10D\uB10E\uB10F\uB111\uB114\uB115\uB116\uB117\uB11A\uB11E",4,"\uB126\uB127\uB129\uB12A\uB12B\uB12D",6,"\uB136\uB13A",5,"\uB142\uB143\uB145\uB146\uB147\uB149",6,"\uB152\uB153\uB156\uB157\uB159\uB15A\uB15B\uB15D\uB15E\uB15F\uB161",22,"\uB17A\uB17B\uB17D\uB17E\uB17F\uB181\uB183",4,"\uB18A\uB18C\uB18E\uB18F\uB190\uB191\uB195\uB196\uB197\uB199\uB19A\uB19B\uB19D"],["8741","\uB19E",9,"\uB1A9",15],["8761","\uB1B9",18,"\uB1CD\uB1CE\uB1CF\uB1D1\uB1D2\uB1D3\uB1D5"],["8781","\uB1D6",5,"\uB1DE\uB1E0",7,"\uB1EA\uB1EB\uB1ED\uB1EE\uB1EF\uB1F1",7,"\uB1FA\uB1FC\uB1FE",5,"\uB206\uB207\uB209\uB20A\uB20D",6,"\uB216\uB218\uB21A",5,"\uB221",18,"\uB235",6,"\uB23D",26,"\uB259\uB25A\uB25B\uB25D\uB25E\uB25F\uB261",6,"\uB26A",4],["8841","\uB26F",4,"\uB276",5,"\uB27D",6,"\uB286\uB287\uB288\uB28A",4],["8861","\uB28F\uB292\uB293\uB295\uB296\uB297\uB29B",4,"\uB2A2\uB2A4\uB2A7\uB2A8\uB2A9\uB2AB\uB2AD\uB2AE\uB2AF\uB2B1\uB2B2\uB2B3\uB2B5\uB2B6\uB2B7"],["8881","\uB2B8",15,"\uB2CA\uB2CB\uB2CD\uB2CE\uB2CF\uB2D1\uB2D3",4,"\uB2DA\uB2DC\uB2DE\uB2DF\uB2E0\uB2E1\uB2E3\uB2E7\uB2E9\uB2EA\uB2F0\uB2F1\uB2F2\uB2F6\uB2FC\uB2FD\uB2FE\uB302\uB303\uB305\uB306\uB307\uB309",6,"\uB312\uB316",5,"\uB31D",54,"\uB357\uB359\uB35A\uB35D\uB360\uB361\uB362\uB363"],["8941","\uB366\uB368\uB36A\uB36C\uB36D\uB36F\uB372\uB373\uB375\uB376\uB377\uB379",6,"\uB382\uB386",5,"\uB38D"],["8961","\uB38E\uB38F\uB391\uB392\uB393\uB395",10,"\uB3A2",5,"\uB3A9\uB3AA\uB3AB\uB3AD"],["8981","\uB3AE",21,"\uB3C6\uB3C7\uB3C9\uB3CA\uB3CD\uB3CF\uB3D1\uB3D2\uB3D3\uB3D6\uB3D8\uB3DA\uB3DC\uB3DE\uB3DF\uB3E1\uB3E2\uB3E3\uB3E5\uB3E6\uB3E7\uB3E9",18,"\uB3FD",18,"\uB411",6,"\uB419\uB41A\uB41B\uB41D\uB41E\uB41F\uB421",6,"\uB42A\uB42C",7,"\uB435",15],["8a41","\uB445",10,"\uB452\uB453\uB455\uB456\uB457\uB459",6,"\uB462\uB464\uB466"],["8a61","\uB467",4,"\uB46D",18,"\uB481\uB482"],["8a81","\uB483",4,"\uB489",19,"\uB49E",5,"\uB4A5\uB4A6\uB4A7\uB4A9\uB4AA\uB4AB\uB4AD",7,"\uB4B6\uB4B8\uB4BA",5,"\uB4C1\uB4C2\uB4C3\uB4C5\uB4C6\uB4C7\uB4C9",6,"\uB4D1\uB4D2\uB4D3\uB4D4\uB4D6",5,"\uB4DE\uB4DF\uB4E1\uB4E2\uB4E5\uB4E7",4,"\uB4EE\uB4F0\uB4F2",5,"\uB4F9",26,"\uB516\uB517\uB519\uB51A\uB51D"],["8b41","\uB51E",5,"\uB526\uB52B",4,"\uB532\uB533\uB535\uB536\uB537\uB539",6,"\uB542\uB546"],["8b61","\uB547\uB548\uB549\uB54A\uB54E\uB54F\uB551\uB552\uB553\uB555",6,"\uB55E\uB562",8],["8b81","\uB56B",52,"\uB5A2\uB5A3\uB5A5\uB5A6\uB5A7\uB5A9\uB5AC\uB5AD\uB5AE\uB5AF\uB5B2\uB5B6",4,"\uB5BE\uB5BF\uB5C1\uB5C2\uB5C3\uB5C5",6,"\uB5CE\uB5D2",5,"\uB5D9",18,"\uB5ED",18],["8c41","\uB600",15,"\uB612\uB613\uB615\uB616\uB617\uB619",4],["8c61","\uB61E",6,"\uB626",5,"\uB62D",6,"\uB635",5],["8c81","\uB63B",12,"\uB649",26,"\uB665\uB666\uB667\uB669",50,"\uB69E\uB69F\uB6A1\uB6A2\uB6A3\uB6A5",5,"\uB6AD\uB6AE\uB6AF\uB6B0\uB6B2",16],["8d41","\uB6C3",16,"\uB6D5",8],["8d61","\uB6DE",17,"\uB6F1\uB6F2\uB6F3\uB6F5\uB6F6\uB6F7\uB6F9\uB6FA"],["8d81","\uB6FB",4,"\uB702\uB703\uB704\uB706",33,"\uB72A\uB72B\uB72D\uB72E\uB731",6,"\uB73A\uB73C",7,"\uB745\uB746\uB747\uB749\uB74A\uB74B\uB74D",6,"\uB756",9,"\uB761\uB762\uB763\uB765\uB766\uB767\uB769",6,"\uB772\uB774\uB776",5,"\uB77E\uB77F\uB781\uB782\uB783\uB785",6,"\uB78E\uB793\uB794\uB795\uB79A\uB79B\uB79D\uB79E"],["8e41","\uB79F\uB7A1",6,"\uB7AA\uB7AE",5,"\uB7B6\uB7B7\uB7B9",8],["8e61","\uB7C2",4,"\uB7C8\uB7CA",19],["8e81","\uB7DE",13,"\uB7EE\uB7EF\uB7F1\uB7F2\uB7F3\uB7F5",6,"\uB7FE\uB802",4,"\uB80A\uB80B\uB80D\uB80E\uB80F\uB811",6,"\uB81A\uB81C\uB81E",5,"\uB826\uB827\uB829\uB82A\uB82B\uB82D",6,"\uB836\uB83A",5,"\uB841\uB842\uB843\uB845",11,"\uB852\uB854",7,"\uB85E\uB85F\uB861\uB862\uB863\uB865",6,"\uB86E\uB870\uB872",5,"\uB879\uB87A\uB87B\uB87D",7],["8f41","\uB885",7,"\uB88E",17],["8f61","\uB8A0",7,"\uB8A9",6,"\uB8B1\uB8B2\uB8B3\uB8B5\uB8B6\uB8B7\uB8B9",4],["8f81","\uB8BE\uB8BF\uB8C2\uB8C4\uB8C6",5,"\uB8CD\uB8CE\uB8CF\uB8D1\uB8D2\uB8D3\uB8D5",7,"\uB8DE\uB8E0\uB8E2",5,"\uB8EA\uB8EB\uB8ED\uB8EE\uB8EF\uB8F1",6,"\uB8FA\uB8FC\uB8FE",5,"\uB905",18,"\uB919",6,"\uB921",26,"\uB93E\uB93F\uB941\uB942\uB943\uB945",6,"\uB94D\uB94E\uB950\uB952",5],["9041","\uB95A\uB95B\uB95D\uB95E\uB95F\uB961",6,"\uB96A\uB96C\uB96E",5,"\uB976\uB977\uB979\uB97A\uB97B\uB97D"],["9061","\uB97E",5,"\uB986\uB988\uB98B\uB98C\uB98F",15],["9081","\uB99F",12,"\uB9AE\uB9AF\uB9B1\uB9B2\uB9B3\uB9B5",6,"\uB9BE\uB9C0\uB9C2",5,"\uB9CA\uB9CB\uB9CD\uB9D3",4,"\uB9DA\uB9DC\uB9DF\uB9E0\uB9E2\uB9E6\uB9E7\uB9E9\uB9EA\uB9EB\uB9ED",6,"\uB9F6\uB9FB",4,"\uBA02",5,"\uBA09",11,"\uBA16",33,"\uBA3A\uBA3B\uBA3D\uBA3E\uBA3F\uBA41\uBA43\uBA44\uBA45\uBA46"],["9141","\uBA47\uBA4A\uBA4C\uBA4F\uBA50\uBA51\uBA52\uBA56\uBA57\uBA59\uBA5A\uBA5B\uBA5D",6,"\uBA66\uBA6A",5],["9161","\uBA72\uBA73\uBA75\uBA76\uBA77\uBA79",9,"\uBA86\uBA88\uBA89\uBA8A\uBA8B\uBA8D",5],["9181","\uBA93",20,"\uBAAA\uBAAD\uBAAE\uBAAF\uBAB1\uBAB3",4,"\uBABA\uBABC\uBABE",5,"\uBAC5\uBAC6\uBAC7\uBAC9",14,"\uBADA",33,"\uBAFD\uBAFE\uBAFF\uBB01\uBB02\uBB03\uBB05",7,"\uBB0E\uBB10\uBB12",5,"\uBB19\uBB1A\uBB1B\uBB1D\uBB1E\uBB1F\uBB21",6],["9241","\uBB28\uBB2A\uBB2C",7,"\uBB37\uBB39\uBB3A\uBB3F",4,"\uBB46\uBB48\uBB4A\uBB4B\uBB4C\uBB4E\uBB51\uBB52"],["9261","\uBB53\uBB55\uBB56\uBB57\uBB59",7,"\uBB62\uBB64",7,"\uBB6D",4],["9281","\uBB72",21,"\uBB89\uBB8A\uBB8B\uBB8D\uBB8E\uBB8F\uBB91",18,"\uBBA5\uBBA6\uBBA7\uBBA9\uBBAA\uBBAB\uBBAD",6,"\uBBB5\uBBB6\uBBB8",7,"\uBBC1\uBBC2\uBBC3\uBBC5\uBBC6\uBBC7\uBBC9",6,"\uBBD1\uBBD2\uBBD4",35,"\uBBFA\uBBFB\uBBFD\uBBFE\uBC01"],["9341","\uBC03",4,"\uBC0A\uBC0E\uBC10\uBC12\uBC13\uBC19\uBC1A\uBC20\uBC21\uBC22\uBC23\uBC26\uBC28\uBC2A\uBC2B\uBC2C\uBC2E\uBC2F\uBC32\uBC33\uBC35"],["9361","\uBC36\uBC37\uBC39",6,"\uBC42\uBC46\uBC47\uBC48\uBC4A\uBC4B\uBC4E\uBC4F\uBC51",8],["9381","\uBC5A\uBC5B\uBC5C\uBC5E",37,"\uBC86\uBC87\uBC89\uBC8A\uBC8D\uBC8F",4,"\uBC96\uBC98\uBC9B",4,"\uBCA2\uBCA3\uBCA5\uBCA6\uBCA9",6,"\uBCB2\uBCB6",5,"\uBCBE\uBCBF\uBCC1\uBCC2\uBCC3\uBCC5",7,"\uBCCE\uBCD2\uBCD3\uBCD4\uBCD6\uBCD7\uBCD9\uBCDA\uBCDB\uBCDD",22,"\uBCF7\uBCF9\uBCFA\uBCFB\uBCFD"],["9441","\uBCFE",5,"\uBD06\uBD08\uBD0A",5,"\uBD11\uBD12\uBD13\uBD15",8],["9461","\uBD1E",5,"\uBD25",6,"\uBD2D",12],["9481","\uBD3A",5,"\uBD41",6,"\uBD4A\uBD4B\uBD4D\uBD4E\uBD4F\uBD51",6,"\uBD5A",9,"\uBD65\uBD66\uBD67\uBD69",22,"\uBD82\uBD83\uBD85\uBD86\uBD8B",4,"\uBD92\uBD94\uBD96\uBD97\uBD98\uBD9B\uBD9D",6,"\uBDA5",10,"\uBDB1",6,"\uBDB9",24],["9541","\uBDD2\uBDD3\uBDD6\uBDD7\uBDD9\uBDDA\uBDDB\uBDDD",11,"\uBDEA",5,"\uBDF1"],["9561","\uBDF2\uBDF3\uBDF5\uBDF6\uBDF7\uBDF9",6,"\uBE01\uBE02\uBE04\uBE06",5,"\uBE0E\uBE0F\uBE11\uBE12\uBE13"],["9581","\uBE15",6,"\uBE1E\uBE20",35,"\uBE46\uBE47\uBE49\uBE4A\uBE4B\uBE4D\uBE4F",4,"\uBE56\uBE58\uBE5C\uBE5D\uBE5E\uBE5F\uBE62\uBE63\uBE65\uBE66\uBE67\uBE69\uBE6B",4,"\uBE72\uBE76",4,"\uBE7E\uBE7F\uBE81\uBE82\uBE83\uBE85",6,"\uBE8E\uBE92",5,"\uBE9A",13,"\uBEA9",14],["9641","\uBEB8",23,"\uBED2\uBED3"],["9661","\uBED5\uBED6\uBED9",6,"\uBEE1\uBEE2\uBEE6",5,"\uBEED",8],["9681","\uBEF6",10,"\uBF02",5,"\uBF0A",13,"\uBF1A\uBF1E",33,"\uBF42\uBF43\uBF45\uBF46\uBF47\uBF49",6,"\uBF52\uBF53\uBF54\uBF56",44],["9741","\uBF83",16,"\uBF95",8],["9761","\uBF9E",17,"\uBFB1",7],["9781","\uBFB9",11,"\uBFC6",5,"\uBFCE\uBFCF\uBFD1\uBFD2\uBFD3\uBFD5",6,"\uBFDD\uBFDE\uBFE0\uBFE2",89,"\uC03D\uC03E\uC03F"],["9841","\uC040",16,"\uC052",5,"\uC059\uC05A\uC05B"],["9861","\uC05D\uC05E\uC05F\uC061",6,"\uC06A",15],["9881","\uC07A",21,"\uC092\uC093\uC095\uC096\uC097\uC099",6,"\uC0A2\uC0A4\uC0A6",5,"\uC0AE\uC0B1\uC0B2\uC0B7",4,"\uC0BE\uC0C2\uC0C3\uC0C4\uC0C6\uC0C7\uC0CA\uC0CB\uC0CD\uC0CE\uC0CF\uC0D1",6,"\uC0DA\uC0DE",5,"\uC0E6\uC0E7\uC0E9\uC0EA\uC0EB\uC0ED",6,"\uC0F6\uC0F8\uC0FA",5,"\uC101\uC102\uC103\uC105\uC106\uC107\uC109",6,"\uC111\uC112\uC113\uC114\uC116",5,"\uC121\uC122\uC125\uC128\uC129\uC12A\uC12B\uC12E"],["9941","\uC132\uC133\uC134\uC135\uC137\uC13A\uC13B\uC13D\uC13E\uC13F\uC141",6,"\uC14A\uC14E",5,"\uC156\uC157"],["9961","\uC159\uC15A\uC15B\uC15D",6,"\uC166\uC16A",5,"\uC171\uC172\uC173\uC175\uC176\uC177\uC179\uC17A\uC17B"],["9981","\uC17C",8,"\uC186",5,"\uC18F\uC191\uC192\uC193\uC195\uC197",4,"\uC19E\uC1A0\uC1A2\uC1A3\uC1A4\uC1A6\uC1A7\uC1AA\uC1AB\uC1AD\uC1AE\uC1AF\uC1B1",11,"\uC1BE",5,"\uC1C5\uC1C6\uC1C7\uC1C9\uC1CA\uC1CB\uC1CD",6,"\uC1D5\uC1D6\uC1D9",6,"\uC1E1\uC1E2\uC1E3\uC1E5\uC1E6\uC1E7\uC1E9",6,"\uC1F2\uC1F4",7,"\uC1FE\uC1FF\uC201\uC202\uC203\uC205",6,"\uC20E\uC210\uC212",5,"\uC21A\uC21B\uC21D\uC21E\uC221\uC222\uC223"],["9a41","\uC224\uC225\uC226\uC227\uC22A\uC22C\uC22E\uC230\uC233\uC235",16],["9a61","\uC246\uC247\uC249",6,"\uC252\uC253\uC255\uC256\uC257\uC259",6,"\uC261\uC262\uC263\uC264\uC266"],["9a81","\uC267",4,"\uC26E\uC26F\uC271\uC272\uC273\uC275",6,"\uC27E\uC280\uC282",5,"\uC28A",5,"\uC291",6,"\uC299\uC29A\uC29C\uC29E",5,"\uC2A6\uC2A7\uC2A9\uC2AA\uC2AB\uC2AE",5,"\uC2B6\uC2B8\uC2BA",33,"\uC2DE\uC2DF\uC2E1\uC2E2\uC2E5",5,"\uC2EE\uC2F0\uC2F2\uC2F3\uC2F4\uC2F5\uC2F7\uC2FA\uC2FD\uC2FE\uC2FF\uC301",6,"\uC30A\uC30B\uC30E\uC30F"],["9b41","\uC310\uC311\uC312\uC316\uC317\uC319\uC31A\uC31B\uC31D",6,"\uC326\uC327\uC32A",8],["9b61","\uC333",17,"\uC346",7],["9b81","\uC34E",25,"\uC36A\uC36B\uC36D\uC36E\uC36F\uC371\uC373",4,"\uC37A\uC37B\uC37E",5,"\uC385\uC386\uC387\uC389\uC38A\uC38B\uC38D",50,"\uC3C1",22,"\uC3DA"],["9c41","\uC3DB\uC3DD\uC3DE\uC3E1\uC3E3",4,"\uC3EA\uC3EB\uC3EC\uC3EE",5,"\uC3F6\uC3F7\uC3F9",5],["9c61","\uC3FF",8,"\uC409",6,"\uC411",9],["9c81","\uC41B",8,"\uC425",6,"\uC42D\uC42E\uC42F\uC431\uC432\uC433\uC435",6,"\uC43E",9,"\uC449",26,"\uC466\uC467\uC469\uC46A\uC46B\uC46D",6,"\uC476\uC477\uC478\uC47A",5,"\uC481",18,"\uC495",6,"\uC49D",12],["9d41","\uC4AA",13,"\uC4B9\uC4BA\uC4BB\uC4BD",8],["9d61","\uC4C6",25],["9d81","\uC4E0",8,"\uC4EA",5,"\uC4F2\uC4F3\uC4F5\uC4F6\uC4F7\uC4F9\uC4FB\uC4FC\uC4FD\uC4FE\uC502",9,"\uC50D\uC50E\uC50F\uC511\uC512\uC513\uC515",6,"\uC51D",10,"\uC52A\uC52B\uC52D\uC52E\uC52F\uC531",6,"\uC53A\uC53C\uC53E",5,"\uC546\uC547\uC54B\uC54F\uC550\uC551\uC552\uC556\uC55A\uC55B\uC55C\uC55F\uC562\uC563\uC565\uC566\uC567\uC569",6,"\uC572\uC576",5,"\uC57E\uC57F\uC581\uC582\uC583\uC585\uC586\uC588\uC589\uC58A\uC58B\uC58E\uC590\uC592\uC593\uC594"],["9e41","\uC596\uC599\uC59A\uC59B\uC59D\uC59E\uC59F\uC5A1",7,"\uC5AA",9,"\uC5B6"],["9e61","\uC5B7\uC5BA\uC5BF",4,"\uC5CB\uC5CD\uC5CF\uC5D2\uC5D3\uC5D5\uC5D6\uC5D7\uC5D9",6,"\uC5E2\uC5E4\uC5E6\uC5E7"],["9e81","\uC5E8\uC5E9\uC5EA\uC5EB\uC5EF\uC5F1\uC5F2\uC5F3\uC5F5\uC5F8\uC5F9\uC5FA\uC5FB\uC602\uC603\uC604\uC609\uC60A\uC60B\uC60D\uC60E\uC60F\uC611",6,"\uC61A\uC61D",6,"\uC626\uC627\uC629\uC62A\uC62B\uC62F\uC631\uC632\uC636\uC638\uC63A\uC63C\uC63D\uC63E\uC63F\uC642\uC643\uC645\uC646\uC647\uC649",6,"\uC652\uC656",5,"\uC65E\uC65F\uC661",10,"\uC66D\uC66E\uC670\uC672",5,"\uC67A\uC67B\uC67D\uC67E\uC67F\uC681",6,"\uC68A\uC68C\uC68E",5,"\uC696\uC697\uC699\uC69A\uC69B\uC69D",6,"\uC6A6"],["9f41","\uC6A8\uC6AA",5,"\uC6B2\uC6B3\uC6B5\uC6B6\uC6B7\uC6BB",4,"\uC6C2\uC6C4\uC6C6",5,"\uC6CE"],["9f61","\uC6CF\uC6D1\uC6D2\uC6D3\uC6D5",6,"\uC6DE\uC6DF\uC6E2",5,"\uC6EA\uC6EB\uC6ED\uC6EE\uC6EF\uC6F1\uC6F2"],["9f81","\uC6F3",4,"\uC6FA\uC6FB\uC6FC\uC6FE",5,"\uC706\uC707\uC709\uC70A\uC70B\uC70D",6,"\uC716\uC718\uC71A",5,"\uC722\uC723\uC725\uC726\uC727\uC729",6,"\uC732\uC734\uC736\uC738\uC739\uC73A\uC73B\uC73E\uC73F\uC741\uC742\uC743\uC745",4,"\uC74B\uC74E\uC750\uC759\uC75A\uC75B\uC75D\uC75E\uC75F\uC761",6,"\uC769\uC76A\uC76C",7,"\uC776\uC777\uC779\uC77A\uC77B\uC77F\uC780\uC781\uC782\uC786\uC78B\uC78C\uC78D\uC78F\uC792\uC793\uC795\uC799\uC79B",4,"\uC7A2\uC7A7",4,"\uC7AE\uC7AF\uC7B1\uC7B2\uC7B3\uC7B5\uC7B6\uC7B7"],["a041","\uC7B8\uC7B9\uC7BA\uC7BB\uC7BE\uC7C2",5,"\uC7CA\uC7CB\uC7CD\uC7CF\uC7D1",6,"\uC7D9\uC7DA\uC7DB\uC7DC"],["a061","\uC7DE",5,"\uC7E5\uC7E6\uC7E7\uC7E9\uC7EA\uC7EB\uC7ED",13],["a081","\uC7FB",4,"\uC802\uC803\uC805\uC806\uC807\uC809\uC80B",4,"\uC812\uC814\uC817",4,"\uC81E\uC81F\uC821\uC822\uC823\uC825",6,"\uC82E\uC830\uC832",5,"\uC839\uC83A\uC83B\uC83D\uC83E\uC83F\uC841",6,"\uC84A\uC84B\uC84E",5,"\uC855",26,"\uC872\uC873\uC875\uC876\uC877\uC879\uC87B",4,"\uC882\uC884\uC888\uC889\uC88A\uC88E",5,"\uC895",7,"\uC89E\uC8A0\uC8A2\uC8A3\uC8A4"],["a141","\uC8A5\uC8A6\uC8A7\uC8A9",18,"\uC8BE\uC8BF\uC8C0\uC8C1"],["a161","\uC8C2\uC8C3\uC8C5\uC8C6\uC8C7\uC8C9\uC8CA\uC8CB\uC8CD",6,"\uC8D6\uC8D8\uC8DA",5,"\uC8E2\uC8E3\uC8E5"],["a181","\uC8E6",14,"\uC8F6",5,"\uC8FE\uC8FF\uC901\uC902\uC903\uC907",4,"\uC90E\u3000\u3001\u3002\xB7\u2025\u2026\xA8\u3003\xAD\u2015\u2225\uFF3C\u223C\u2018\u2019\u201C\u201D\u3014\u3015\u3008",9,"\xB1\xD7\xF7\u2260\u2264\u2265\u221E\u2234\xB0\u2032\u2033\u2103\u212B\uFFE0\uFFE1\uFFE5\u2642\u2640\u2220\u22A5\u2312\u2202\u2207\u2261\u2252\xA7\u203B\u2606\u2605\u25CB\u25CF\u25CE\u25C7\u25C6\u25A1\u25A0\u25B3\u25B2\u25BD\u25BC\u2192\u2190\u2191\u2193\u2194\u3013\u226A\u226B\u221A\u223D\u221D\u2235\u222B\u222C\u2208\u220B\u2286\u2287\u2282\u2283\u222A\u2229\u2227\u2228\uFFE2"],["a241","\uC910\uC912",5,"\uC919",18],["a261","\uC92D",6,"\uC935",18],["a281","\uC948",7,"\uC952\uC953\uC955\uC956\uC957\uC959",6,"\uC962\uC964",7,"\uC96D\uC96E\uC96F\u21D2\u21D4\u2200\u2203\xB4\uFF5E\u02C7\u02D8\u02DD\u02DA\u02D9\xB8\u02DB\xA1\xBF\u02D0\u222E\u2211\u220F\xA4\u2109\u2030\u25C1\u25C0\u25B7\u25B6\u2664\u2660\u2661\u2665\u2667\u2663\u2299\u25C8\u25A3\u25D0\u25D1\u2592\u25A4\u25A5\u25A8\u25A7\u25A6\u25A9\u2668\u260F\u260E\u261C\u261E\xB6\u2020\u2021\u2195\u2197\u2199\u2196\u2198\u266D\u2669\u266A\u266C\u327F\u321C\u2116\u33C7\u2122\u33C2\u33D8\u2121\u20AC\xAE"],["a341","\uC971\uC972\uC973\uC975",6,"\uC97D",10,"\uC98A\uC98B\uC98D\uC98E\uC98F"],["a361","\uC991",6,"\uC99A\uC99C\uC99E",16],["a381","\uC9AF",16,"\uC9C2\uC9C3\uC9C5\uC9C6\uC9C9\uC9CB",4,"\uC9D2\uC9D4\uC9D7\uC9D8\uC9DB\uFF01",58,"\uFFE6\uFF3D",32,"\uFFE3"],["a441","\uC9DE\uC9DF\uC9E1\uC9E3\uC9E5\uC9E6\uC9E8\uC9E9\uC9EA\uC9EB\uC9EE\uC9F2",5,"\uC9FA\uC9FB\uC9FD\uC9FE\uC9FF\uCA01\uCA02\uCA03\uCA04"],["a461","\uCA05\uCA06\uCA07\uCA0A\uCA0E",5,"\uCA15\uCA16\uCA17\uCA19",12],["a481","\uCA26\uCA27\uCA28\uCA2A",28,"\u3131",93],["a541","\uCA47",4,"\uCA4E\uCA4F\uCA51\uCA52\uCA53\uCA55",6,"\uCA5E\uCA62",5,"\uCA69\uCA6A"],["a561","\uCA6B",17,"\uCA7E",5,"\uCA85\uCA86"],["a581","\uCA87",16,"\uCA99",14,"\u2170",9],["a5b0","\u2160",9],["a5c1","\u0391",16,"\u03A3",6],["a5e1","\u03B1",16,"\u03C3",6],["a641","\uCAA8",19,"\uCABE\uCABF\uCAC1\uCAC2\uCAC3\uCAC5"],["a661","\uCAC6",5,"\uCACE\uCAD0\uCAD2\uCAD4\uCAD5\uCAD6\uCAD7\uCADA",5,"\uCAE1",6],["a681","\uCAE8\uCAE9\uCAEA\uCAEB\uCAED",6,"\uCAF5",18,"\uCB09\uCB0A\u2500\u2502\u250C\u2510\u2518\u2514\u251C\u252C\u2524\u2534\u253C\u2501\u2503\u250F\u2513\u251B\u2517\u2523\u2533\u252B\u253B\u254B\u2520\u252F\u2528\u2537\u253F\u251D\u2530\u2525\u2538\u2542\u2512\u2511\u251A\u2519\u2516\u2515\u250E\u250D\u251E\u251F\u2521\u2522\u2526\u2527\u2529\u252A\u252D\u252E\u2531\u2532\u2535\u2536\u2539\u253A\u253D\u253E\u2540\u2541\u2543",7],["a741","\uCB0B",4,"\uCB11\uCB12\uCB13\uCB15\uCB16\uCB17\uCB19",6,"\uCB22",7],["a761","\uCB2A",22,"\uCB42\uCB43\uCB44"],["a781","\uCB45\uCB46\uCB47\uCB4A\uCB4B\uCB4D\uCB4E\uCB4F\uCB51",6,"\uCB5A\uCB5B\uCB5C\uCB5E",5,"\uCB65",7,"\u3395\u3396\u3397\u2113\u3398\u33C4\u33A3\u33A4\u33A5\u33A6\u3399",9,"\u33CA\u338D\u338E\u338F\u33CF\u3388\u3389\u33C8\u33A7\u33A8\u33B0",9,"\u3380",4,"\u33BA",5,"\u3390",4,"\u2126\u33C0\u33C1\u338A\u338B\u338C\u33D6\u33C5\u33AD\u33AE\u33AF\u33DB\u33A9\u33AA\u33AB\u33AC\u33DD\u33D0\u33D3\u33C3\u33C9\u33DC\u33C6"],["a841","\uCB6D",10,"\uCB7A",14],["a861","\uCB89",18,"\uCB9D",6],["a881","\uCBA4",19,"\uCBB9",11,"\xC6\xD0\xAA\u0126"],["a8a6","\u0132"],["a8a8","\u013F\u0141\xD8\u0152\xBA\xDE\u0166\u014A"],["a8b1","\u3260",27,"\u24D0",25,"\u2460",14,"\xBD\u2153\u2154\xBC\xBE\u215B\u215C\u215D\u215E"],["a941","\uCBC5",14,"\uCBD5",10],["a961","\uCBE0\uCBE1\uCBE2\uCBE3\uCBE5\uCBE6\uCBE8\uCBEA",18],["a981","\uCBFD",14,"\uCC0E\uCC0F\uCC11\uCC12\uCC13\uCC15",6,"\uCC1E\uCC1F\uCC20\uCC23\uCC24\xE6\u0111\xF0\u0127\u0131\u0133\u0138\u0140\u0142\xF8\u0153\xDF\xFE\u0167\u014B\u0149\u3200",27,"\u249C",25,"\u2474",14,"\xB9\xB2\xB3\u2074\u207F\u2081\u2082\u2083\u2084"],["aa41","\uCC25\uCC26\uCC2A\uCC2B\uCC2D\uCC2F\uCC31",6,"\uCC3A\uCC3F",4,"\uCC46\uCC47\uCC49\uCC4A\uCC4B\uCC4D\uCC4E"],["aa61","\uCC4F",4,"\uCC56\uCC5A",5,"\uCC61\uCC62\uCC63\uCC65\uCC67\uCC69",6,"\uCC71\uCC72"],["aa81","\uCC73\uCC74\uCC76",29,"\u3041",82],["ab41","\uCC94\uCC95\uCC96\uCC97\uCC9A\uCC9B\uCC9D\uCC9E\uCC9F\uCCA1",6,"\uCCAA\uCCAE",5,"\uCCB6\uCCB7\uCCB9"],["ab61","\uCCBA\uCCBB\uCCBD",6,"\uCCC6\uCCC8\uCCCA",5,"\uCCD1\uCCD2\uCCD3\uCCD5",5],["ab81","\uCCDB",8,"\uCCE5",6,"\uCCED\uCCEE\uCCEF\uCCF1",12,"\u30A1",85],["ac41","\uCCFE\uCCFF\uCD00\uCD02",5,"\uCD0A\uCD0B\uCD0D\uCD0E\uCD0F\uCD11",6,"\uCD1A\uCD1C\uCD1E\uCD1F\uCD20"],["ac61","\uCD21\uCD22\uCD23\uCD25\uCD26\uCD27\uCD29\uCD2A\uCD2B\uCD2D",11,"\uCD3A",4],["ac81","\uCD3F",28,"\uCD5D\uCD5E\uCD5F\u0410",5,"\u0401\u0416",25],["acd1","\u0430",5,"\u0451\u0436",25],["ad41","\uCD61\uCD62\uCD63\uCD65",6,"\uCD6E\uCD70\uCD72",5,"\uCD79",7],["ad61","\uCD81",6,"\uCD89",10,"\uCD96\uCD97\uCD99\uCD9A\uCD9B\uCD9D\uCD9E\uCD9F"],["ad81","\uCDA0\uCDA1\uCDA2\uCDA3\uCDA6\uCDA8\uCDAA",5,"\uCDB1",18,"\uCDC5"],["ae41","\uCDC6",5,"\uCDCD\uCDCE\uCDCF\uCDD1",16],["ae61","\uCDE2",5,"\uCDE9\uCDEA\uCDEB\uCDED\uCDEE\uCDEF\uCDF1",6,"\uCDFA\uCDFC\uCDFE",4],["ae81","\uCE03\uCE05\uCE06\uCE07\uCE09\uCE0A\uCE0B\uCE0D",6,"\uCE15\uCE16\uCE17\uCE18\uCE1A",5,"\uCE22\uCE23\uCE25\uCE26\uCE27\uCE29\uCE2A\uCE2B"],["af41","\uCE2C\uCE2D\uCE2E\uCE2F\uCE32\uCE34\uCE36",19],["af61","\uCE4A",13,"\uCE5A\uCE5B\uCE5D\uCE5E\uCE62",5,"\uCE6A\uCE6C"],["af81","\uCE6E",5,"\uCE76\uCE77\uCE79\uCE7A\uCE7B\uCE7D",6,"\uCE86\uCE88\uCE8A",5,"\uCE92\uCE93\uCE95\uCE96\uCE97\uCE99"],["b041","\uCE9A",5,"\uCEA2\uCEA6",5,"\uCEAE",12],["b061","\uCEBB",5,"\uCEC2",19],["b081","\uCED6",13,"\uCEE6\uCEE7\uCEE9\uCEEA\uCEED",6,"\uCEF6\uCEFA",5,"\uAC00\uAC01\uAC04\uAC07\uAC08\uAC09\uAC0A\uAC10",7,"\uAC19",4,"\uAC20\uAC24\uAC2C\uAC2D\uAC2F\uAC30\uAC31\uAC38\uAC39\uAC3C\uAC40\uAC4B\uAC4D\uAC54\uAC58\uAC5C\uAC70\uAC71\uAC74\uAC77\uAC78\uAC7A\uAC80\uAC81\uAC83\uAC84\uAC85\uAC86\uAC89\uAC8A\uAC8B\uAC8C\uAC90\uAC94\uAC9C\uAC9D\uAC9F\uACA0\uACA1\uACA8\uACA9\uACAA\uACAC\uACAF\uACB0\uACB8\uACB9\uACBB\uACBC\uACBD\uACC1\uACC4\uACC8\uACCC\uACD5\uACD7\uACE0\uACE1\uACE4\uACE7\uACE8\uACEA\uACEC\uACEF\uACF0\uACF1\uACF3\uACF5\uACF6\uACFC\uACFD\uAD00\uAD04\uAD06"],["b141","\uCF02\uCF03\uCF05\uCF06\uCF07\uCF09",6,"\uCF12\uCF14\uCF16",5,"\uCF1D\uCF1E\uCF1F\uCF21\uCF22\uCF23"],["b161","\uCF25",6,"\uCF2E\uCF32",5,"\uCF39",11],["b181","\uCF45",14,"\uCF56\uCF57\uCF59\uCF5A\uCF5B\uCF5D",6,"\uCF66\uCF68\uCF6A\uCF6B\uCF6C\uAD0C\uAD0D\uAD0F\uAD11\uAD18\uAD1C\uAD20\uAD29\uAD2C\uAD2D\uAD34\uAD35\uAD38\uAD3C\uAD44\uAD45\uAD47\uAD49\uAD50\uAD54\uAD58\uAD61\uAD63\uAD6C\uAD6D\uAD70\uAD73\uAD74\uAD75\uAD76\uAD7B\uAD7C\uAD7D\uAD7F\uAD81\uAD82\uAD88\uAD89\uAD8C\uAD90\uAD9C\uAD9D\uADA4\uADB7\uADC0\uADC1\uADC4\uADC8\uADD0\uADD1\uADD3\uADDC\uADE0\uADE4\uADF8\uADF9\uADFC\uADFF\uAE00\uAE01\uAE08\uAE09\uAE0B\uAE0D\uAE14\uAE30\uAE31\uAE34\uAE37\uAE38\uAE3A\uAE40\uAE41\uAE43\uAE45\uAE46\uAE4A\uAE4C\uAE4D\uAE4E\uAE50\uAE54\uAE56\uAE5C\uAE5D\uAE5F\uAE60\uAE61\uAE65\uAE68\uAE69\uAE6C\uAE70\uAE78"],["b241","\uCF6D\uCF6E\uCF6F\uCF72\uCF73\uCF75\uCF76\uCF77\uCF79",6,"\uCF81\uCF82\uCF83\uCF84\uCF86",5,"\uCF8D"],["b261","\uCF8E",18,"\uCFA2",5,"\uCFA9"],["b281","\uCFAA",5,"\uCFB1",18,"\uCFC5",6,"\uAE79\uAE7B\uAE7C\uAE7D\uAE84\uAE85\uAE8C\uAEBC\uAEBD\uAEBE\uAEC0\uAEC4\uAECC\uAECD\uAECF\uAED0\uAED1\uAED8\uAED9\uAEDC\uAEE8\uAEEB\uAEED\uAEF4\uAEF8\uAEFC\uAF07\uAF08\uAF0D\uAF10\uAF2C\uAF2D\uAF30\uAF32\uAF34\uAF3C\uAF3D\uAF3F\uAF41\uAF42\uAF43\uAF48\uAF49\uAF50\uAF5C\uAF5D\uAF64\uAF65\uAF79\uAF80\uAF84\uAF88\uAF90\uAF91\uAF95\uAF9C\uAFB8\uAFB9\uAFBC\uAFC0\uAFC7\uAFC8\uAFC9\uAFCB\uAFCD\uAFCE\uAFD4\uAFDC\uAFE8\uAFE9\uAFF0\uAFF1\uAFF4\uAFF8\uB000\uB001\uB004\uB00C\uB010\uB014\uB01C\uB01D\uB028\uB044\uB045\uB048\uB04A\uB04C\uB04E\uB053\uB054\uB055\uB057\uB059"],["b341","\uCFCC",19,"\uCFE2\uCFE3\uCFE5\uCFE6\uCFE7\uCFE9"],["b361","\uCFEA",5,"\uCFF2\uCFF4\uCFF6",5,"\uCFFD\uCFFE\uCFFF\uD001\uD002\uD003\uD005",5],["b381","\uD00B",5,"\uD012",5,"\uD019",19,"\uB05D\uB07C\uB07D\uB080\uB084\uB08C\uB08D\uB08F\uB091\uB098\uB099\uB09A\uB09C\uB09F\uB0A0\uB0A1\uB0A2\uB0A8\uB0A9\uB0AB",4,"\uB0B1\uB0B3\uB0B4\uB0B5\uB0B8\uB0BC\uB0C4\uB0C5\uB0C7\uB0C8\uB0C9\uB0D0\uB0D1\uB0D4\uB0D8\uB0E0\uB0E5\uB108\uB109\uB10B\uB10C\uB110\uB112\uB113\uB118\uB119\uB11B\uB11C\uB11D\uB123\uB124\uB125\uB128\uB12C\uB134\uB135\uB137\uB138\uB139\uB140\uB141\uB144\uB148\uB150\uB151\uB154\uB155\uB158\uB15C\uB160\uB178\uB179\uB17C\uB180\uB182\uB188\uB189\uB18B\uB18D\uB192\uB193\uB194\uB198\uB19C\uB1A8\uB1CC\uB1D0\uB1D4\uB1DC\uB1DD"],["b441","\uD02E",5,"\uD036\uD037\uD039\uD03A\uD03B\uD03D",6,"\uD046\uD048\uD04A",5],["b461","\uD051\uD052\uD053\uD055\uD056\uD057\uD059",6,"\uD061",10,"\uD06E\uD06F"],["b481","\uD071\uD072\uD073\uD075",6,"\uD07E\uD07F\uD080\uD082",18,"\uB1DF\uB1E8\uB1E9\uB1EC\uB1F0\uB1F9\uB1FB\uB1FD\uB204\uB205\uB208\uB20B\uB20C\uB214\uB215\uB217\uB219\uB220\uB234\uB23C\uB258\uB25C\uB260\uB268\uB269\uB274\uB275\uB27C\uB284\uB285\uB289\uB290\uB291\uB294\uB298\uB299\uB29A\uB2A0\uB2A1\uB2A3\uB2A5\uB2A6\uB2AA\uB2AC\uB2B0\uB2B4\uB2C8\uB2C9\uB2CC\uB2D0\uB2D2\uB2D8\uB2D9\uB2DB\uB2DD\uB2E2\uB2E4\uB2E5\uB2E6\uB2E8\uB2EB",4,"\uB2F3\uB2F4\uB2F5\uB2F7",4,"\uB2FF\uB300\uB301\uB304\uB308\uB310\uB311\uB313\uB314\uB315\uB31C\uB354\uB355\uB356\uB358\uB35B\uB35C\uB35E\uB35F\uB364\uB365"],["b541","\uD095",14,"\uD0A6\uD0A7\uD0A9\uD0AA\uD0AB\uD0AD",5],["b561","\uD0B3\uD0B6\uD0B8\uD0BA",5,"\uD0C2\uD0C3\uD0C5\uD0C6\uD0C7\uD0CA",5,"\uD0D2\uD0D6",4],["b581","\uD0DB\uD0DE\uD0DF\uD0E1\uD0E2\uD0E3\uD0E5",6,"\uD0EE\uD0F2",5,"\uD0F9",11,"\uB367\uB369\uB36B\uB36E\uB370\uB371\uB374\uB378\uB380\uB381\uB383\uB384\uB385\uB38C\uB390\uB394\uB3A0\uB3A1\uB3A8\uB3AC\uB3C4\uB3C5\uB3C8\uB3CB\uB3CC\uB3CE\uB3D0\uB3D4\uB3D5\uB3D7\uB3D9\uB3DB\uB3DD\uB3E0\uB3E4\uB3E8\uB3FC\uB410\uB418\uB41C\uB420\uB428\uB429\uB42B\uB434\uB450\uB451\uB454\uB458\uB460\uB461\uB463\uB465\uB46C\uB480\uB488\uB49D\uB4A4\uB4A8\uB4AC\uB4B5\uB4B7\uB4B9\uB4C0\uB4C4\uB4C8\uB4D0\uB4D5\uB4DC\uB4DD\uB4E0\uB4E3\uB4E4\uB4E6\uB4EC\uB4ED\uB4EF\uB4F1\uB4F8\uB514\uB515\uB518\uB51B\uB51C\uB524\uB525\uB527\uB528\uB529\uB52A\uB530\uB531\uB534\uB538"],["b641","\uD105",7,"\uD10E",17],["b661","\uD120",15,"\uD132\uD133\uD135\uD136\uD137\uD139\uD13B\uD13C\uD13D\uD13E"],["b681","\uD13F\uD142\uD146",5,"\uD14E\uD14F\uD151\uD152\uD153\uD155",6,"\uD15E\uD160\uD162",5,"\uD169\uD16A\uD16B\uD16D\uB540\uB541\uB543\uB544\uB545\uB54B\uB54C\uB54D\uB550\uB554\uB55C\uB55D\uB55F\uB560\uB561\uB5A0\uB5A1\uB5A4\uB5A8\uB5AA\uB5AB\uB5B0\uB5B1\uB5B3\uB5B4\uB5B5\uB5BB\uB5BC\uB5BD\uB5C0\uB5C4\uB5CC\uB5CD\uB5CF\uB5D0\uB5D1\uB5D8\uB5EC\uB610\uB611\uB614\uB618\uB625\uB62C\uB634\uB648\uB664\uB668\uB69C\uB69D\uB6A0\uB6A4\uB6AB\uB6AC\uB6B1\uB6D4\uB6F0\uB6F4\uB6F8\uB700\uB701\uB705\uB728\uB729\uB72C\uB72F\uB730\uB738\uB739\uB73B\uB744\uB748\uB74C\uB754\uB755\uB760\uB764\uB768\uB770\uB771\uB773\uB775\uB77C\uB77D\uB780\uB784\uB78C\uB78D\uB78F\uB790\uB791\uB792\uB796\uB797"],["b741","\uD16E",13,"\uD17D",6,"\uD185\uD186\uD187\uD189\uD18A"],["b761","\uD18B",20,"\uD1A2\uD1A3\uD1A5\uD1A6\uD1A7"],["b781","\uD1A9",6,"\uD1B2\uD1B4\uD1B6\uD1B7\uD1B8\uD1B9\uD1BB\uD1BD\uD1BE\uD1BF\uD1C1",14,"\uB798\uB799\uB79C\uB7A0\uB7A8\uB7A9\uB7AB\uB7AC\uB7AD\uB7B4\uB7B5\uB7B8\uB7C7\uB7C9\uB7EC\uB7ED\uB7F0\uB7F4\uB7FC\uB7FD\uB7FF\uB800\uB801\uB807\uB808\uB809\uB80C\uB810\uB818\uB819\uB81B\uB81D\uB824\uB825\uB828\uB82C\uB834\uB835\uB837\uB838\uB839\uB840\uB844\uB851\uB853\uB85C\uB85D\uB860\uB864\uB86C\uB86D\uB86F\uB871\uB878\uB87C\uB88D\uB8A8\uB8B0\uB8B4\uB8B8\uB8C0\uB8C1\uB8C3\uB8C5\uB8CC\uB8D0\uB8D4\uB8DD\uB8DF\uB8E1\uB8E8\uB8E9\uB8EC\uB8F0\uB8F8\uB8F9\uB8FB\uB8FD\uB904\uB918\uB920\uB93C\uB93D\uB940\uB944\uB94C\uB94F\uB951\uB958\uB959\uB95C\uB960\uB968\uB969"],["b841","\uD1D0",7,"\uD1D9",17],["b861","\uD1EB",8,"\uD1F5\uD1F6\uD1F7\uD1F9",13],["b881","\uD208\uD20A",5,"\uD211",24,"\uB96B\uB96D\uB974\uB975\uB978\uB97C\uB984\uB985\uB987\uB989\uB98A\uB98D\uB98E\uB9AC\uB9AD\uB9B0\uB9B4\uB9BC\uB9BD\uB9BF\uB9C1\uB9C8\uB9C9\uB9CC\uB9CE",4,"\uB9D8\uB9D9\uB9DB\uB9DD\uB9DE\uB9E1\uB9E3\uB9E4\uB9E5\uB9E8\uB9EC\uB9F4\uB9F5\uB9F7\uB9F8\uB9F9\uB9FA\uBA00\uBA01\uBA08\uBA15\uBA38\uBA39\uBA3C\uBA40\uBA42\uBA48\uBA49\uBA4B\uBA4D\uBA4E\uBA53\uBA54\uBA55\uBA58\uBA5C\uBA64\uBA65\uBA67\uBA68\uBA69\uBA70\uBA71\uBA74\uBA78\uBA83\uBA84\uBA85\uBA87\uBA8C\uBAA8\uBAA9\uBAAB\uBAAC\uBAB0\uBAB2\uBAB8\uBAB9\uBABB\uBABD\uBAC4\uBAC8\uBAD8\uBAD9\uBAFC"],["b941","\uD22A\uD22B\uD22E\uD22F\uD231\uD232\uD233\uD235",6,"\uD23E\uD240\uD242",5,"\uD249\uD24A\uD24B\uD24C"],["b961","\uD24D",14,"\uD25D",6,"\uD265\uD266\uD267\uD268"],["b981","\uD269",22,"\uD282\uD283\uD285\uD286\uD287\uD289\uD28A\uD28B\uD28C\uBB00\uBB04\uBB0D\uBB0F\uBB11\uBB18\uBB1C\uBB20\uBB29\uBB2B\uBB34\uBB35\uBB36\uBB38\uBB3B\uBB3C\uBB3D\uBB3E\uBB44\uBB45\uBB47\uBB49\uBB4D\uBB4F\uBB50\uBB54\uBB58\uBB61\uBB63\uBB6C\uBB88\uBB8C\uBB90\uBBA4\uBBA8\uBBAC\uBBB4\uBBB7\uBBC0\uBBC4\uBBC8\uBBD0\uBBD3\uBBF8\uBBF9\uBBFC\uBBFF\uBC00\uBC02\uBC08\uBC09\uBC0B\uBC0C\uBC0D\uBC0F\uBC11\uBC14",4,"\uBC1B",4,"\uBC24\uBC25\uBC27\uBC29\uBC2D\uBC30\uBC31\uBC34\uBC38\uBC40\uBC41\uBC43\uBC44\uBC45\uBC49\uBC4C\uBC4D\uBC50\uBC5D\uBC84\uBC85\uBC88\uBC8B\uBC8C\uBC8E\uBC94\uBC95\uBC97"],["ba41","\uD28D\uD28E\uD28F\uD292\uD293\uD294\uD296",5,"\uD29D\uD29E\uD29F\uD2A1\uD2A2\uD2A3\uD2A5",6,"\uD2AD"],["ba61","\uD2AE\uD2AF\uD2B0\uD2B2",5,"\uD2BA\uD2BB\uD2BD\uD2BE\uD2C1\uD2C3",4,"\uD2CA\uD2CC",5],["ba81","\uD2D2\uD2D3\uD2D5\uD2D6\uD2D7\uD2D9\uD2DA\uD2DB\uD2DD",6,"\uD2E6",9,"\uD2F2\uD2F3\uD2F5\uD2F6\uD2F7\uD2F9\uD2FA\uBC99\uBC9A\uBCA0\uBCA1\uBCA4\uBCA7\uBCA8\uBCB0\uBCB1\uBCB3\uBCB4\uBCB5\uBCBC\uBCBD\uBCC0\uBCC4\uBCCD\uBCCF\uBCD0\uBCD1\uBCD5\uBCD8\uBCDC\uBCF4\uBCF5\uBCF6\uBCF8\uBCFC\uBD04\uBD05\uBD07\uBD09\uBD10\uBD14\uBD24\uBD2C\uBD40\uBD48\uBD49\uBD4C\uBD50\uBD58\uBD59\uBD64\uBD68\uBD80\uBD81\uBD84\uBD87\uBD88\uBD89\uBD8A\uBD90\uBD91\uBD93\uBD95\uBD99\uBD9A\uBD9C\uBDA4\uBDB0\uBDB8\uBDD4\uBDD5\uBDD8\uBDDC\uBDE9\uBDF0\uBDF4\uBDF8\uBE00\uBE03\uBE05\uBE0C\uBE0D\uBE10\uBE14\uBE1C\uBE1D\uBE1F\uBE44\uBE45\uBE48\uBE4C\uBE4E\uBE54\uBE55\uBE57\uBE59\uBE5A\uBE5B\uBE60\uBE61\uBE64"],["bb41","\uD2FB",4,"\uD302\uD304\uD306",5,"\uD30F\uD311\uD312\uD313\uD315\uD317",4,"\uD31E\uD322\uD323"],["bb61","\uD324\uD326\uD327\uD32A\uD32B\uD32D\uD32E\uD32F\uD331",6,"\uD33A\uD33E",5,"\uD346\uD347\uD348\uD349"],["bb81","\uD34A",31,"\uBE68\uBE6A\uBE70\uBE71\uBE73\uBE74\uBE75\uBE7B\uBE7C\uBE7D\uBE80\uBE84\uBE8C\uBE8D\uBE8F\uBE90\uBE91\uBE98\uBE99\uBEA8\uBED0\uBED1\uBED4\uBED7\uBED8\uBEE0\uBEE3\uBEE4\uBEE5\uBEEC\uBF01\uBF08\uBF09\uBF18\uBF19\uBF1B\uBF1C\uBF1D\uBF40\uBF41\uBF44\uBF48\uBF50\uBF51\uBF55\uBF94\uBFB0\uBFC5\uBFCC\uBFCD\uBFD0\uBFD4\uBFDC\uBFDF\uBFE1\uC03C\uC051\uC058\uC05C\uC060\uC068\uC069\uC090\uC091\uC094\uC098\uC0A0\uC0A1\uC0A3\uC0A5\uC0AC\uC0AD\uC0AF\uC0B0\uC0B3\uC0B4\uC0B5\uC0B6\uC0BC\uC0BD\uC0BF\uC0C0\uC0C1\uC0C5\uC0C8\uC0C9\uC0CC\uC0D0\uC0D8\uC0D9\uC0DB\uC0DC\uC0DD\uC0E4"],["bc41","\uD36A",17,"\uD37E\uD37F\uD381\uD382\uD383\uD385\uD386\uD387"],["bc61","\uD388\uD389\uD38A\uD38B\uD38E\uD392",5,"\uD39A\uD39B\uD39D\uD39E\uD39F\uD3A1",6,"\uD3AA\uD3AC\uD3AE"],["bc81","\uD3AF",4,"\uD3B5\uD3B6\uD3B7\uD3B9\uD3BA\uD3BB\uD3BD",6,"\uD3C6\uD3C7\uD3CA",5,"\uD3D1",5,"\uC0E5\uC0E8\uC0EC\uC0F4\uC0F5\uC0F7\uC0F9\uC100\uC104\uC108\uC110\uC115\uC11C",4,"\uC123\uC124\uC126\uC127\uC12C\uC12D\uC12F\uC130\uC131\uC136\uC138\uC139\uC13C\uC140\uC148\uC149\uC14B\uC14C\uC14D\uC154\uC155\uC158\uC15C\uC164\uC165\uC167\uC168\uC169\uC170\uC174\uC178\uC185\uC18C\uC18D\uC18E\uC190\uC194\uC196\uC19C\uC19D\uC19F\uC1A1\uC1A5\uC1A8\uC1A9\uC1AC\uC1B0\uC1BD\uC1C4\uC1C8\uC1CC\uC1D4\uC1D7\uC1D8\uC1E0\uC1E4\uC1E8\uC1F0\uC1F1\uC1F3\uC1FC\uC1FD\uC200\uC204\uC20C\uC20D\uC20F\uC211\uC218\uC219\uC21C\uC21F\uC220\uC228\uC229\uC22B\uC22D"],["bd41","\uD3D7\uD3D9",7,"\uD3E2\uD3E4",7,"\uD3EE\uD3EF\uD3F1\uD3F2\uD3F3\uD3F5\uD3F6\uD3F7"],["bd61","\uD3F8\uD3F9\uD3FA\uD3FB\uD3FE\uD400\uD402",5,"\uD409",13],["bd81","\uD417",5,"\uD41E",25,"\uC22F\uC231\uC232\uC234\uC248\uC250\uC251\uC254\uC258\uC260\uC265\uC26C\uC26D\uC270\uC274\uC27C\uC27D\uC27F\uC281\uC288\uC289\uC290\uC298\uC29B\uC29D\uC2A4\uC2A5\uC2A8\uC2AC\uC2AD\uC2B4\uC2B5\uC2B7\uC2B9\uC2DC\uC2DD\uC2E0\uC2E3\uC2E4\uC2EB\uC2EC\uC2ED\uC2EF\uC2F1\uC2F6\uC2F8\uC2F9\uC2FB\uC2FC\uC300\uC308\uC309\uC30C\uC30D\uC313\uC314\uC315\uC318\uC31C\uC324\uC325\uC328\uC329\uC345\uC368\uC369\uC36C\uC370\uC372\uC378\uC379\uC37C\uC37D\uC384\uC388\uC38C\uC3C0\uC3D8\uC3D9\uC3DC\uC3DF\uC3E0\uC3E2\uC3E8\uC3E9\uC3ED\uC3F4\uC3F5\uC3F8\uC408\uC410\uC424\uC42C\uC430"],["be41","\uD438",7,"\uD441\uD442\uD443\uD445",14],["be61","\uD454",7,"\uD45D\uD45E\uD45F\uD461\uD462\uD463\uD465",7,"\uD46E\uD470\uD471\uD472"],["be81","\uD473",4,"\uD47A\uD47B\uD47D\uD47E\uD481\uD483",4,"\uD48A\uD48C\uD48E",5,"\uD495",8,"\uC434\uC43C\uC43D\uC448\uC464\uC465\uC468\uC46C\uC474\uC475\uC479\uC480\uC494\uC49C\uC4B8\uC4BC\uC4E9\uC4F0\uC4F1\uC4F4\uC4F8\uC4FA\uC4FF\uC500\uC501\uC50C\uC510\uC514\uC51C\uC528\uC529\uC52C\uC530\uC538\uC539\uC53B\uC53D\uC544\uC545\uC548\uC549\uC54A\uC54C\uC54D\uC54E\uC553\uC554\uC555\uC557\uC558\uC559\uC55D\uC55E\uC560\uC561\uC564\uC568\uC570\uC571\uC573\uC574\uC575\uC57C\uC57D\uC580\uC584\uC587\uC58C\uC58D\uC58F\uC591\uC595\uC597\uC598\uC59C\uC5A0\uC5A9\uC5B4\uC5B5\uC5B8\uC5B9\uC5BB\uC5BC\uC5BD\uC5BE\uC5C4",6,"\uC5CC\uC5CE"],["bf41","\uD49E",10,"\uD4AA",14],["bf61","\uD4B9",18,"\uD4CD\uD4CE\uD4CF\uD4D1\uD4D2\uD4D3\uD4D5"],["bf81","\uD4D6",5,"\uD4DD\uD4DE\uD4E0",7,"\uD4E9\uD4EA\uD4EB\uD4ED\uD4EE\uD4EF\uD4F1",6,"\uD4F9\uD4FA\uD4FC\uC5D0\uC5D1\uC5D4\uC5D8\uC5E0\uC5E1\uC5E3\uC5E5\uC5EC\uC5ED\uC5EE\uC5F0\uC5F4\uC5F6\uC5F7\uC5FC",5,"\uC605\uC606\uC607\uC608\uC60C\uC610\uC618\uC619\uC61B\uC61C\uC624\uC625\uC628\uC62C\uC62D\uC62E\uC630\uC633\uC634\uC635\uC637\uC639\uC63B\uC640\uC641\uC644\uC648\uC650\uC651\uC653\uC654\uC655\uC65C\uC65D\uC660\uC66C\uC66F\uC671\uC678\uC679\uC67C\uC680\uC688\uC689\uC68B\uC68D\uC694\uC695\uC698\uC69C\uC6A4\uC6A5\uC6A7\uC6A9\uC6B0\uC6B1\uC6B4\uC6B8\uC6B9\uC6BA\uC6C0\uC6C1\uC6C3\uC6C5\uC6CC\uC6CD\uC6D0\uC6D4\uC6DC\uC6DD\uC6E0\uC6E1\uC6E8"],["c041","\uD4FE",5,"\uD505\uD506\uD507\uD509\uD50A\uD50B\uD50D",6,"\uD516\uD518",5],["c061","\uD51E",25],["c081","\uD538\uD539\uD53A\uD53B\uD53E\uD53F\uD541\uD542\uD543\uD545",6,"\uD54E\uD550\uD552",5,"\uD55A\uD55B\uD55D\uD55E\uD55F\uD561\uD562\uD563\uC6E9\uC6EC\uC6F0\uC6F8\uC6F9\uC6FD\uC704\uC705\uC708\uC70C\uC714\uC715\uC717\uC719\uC720\uC721\uC724\uC728\uC730\uC731\uC733\uC735\uC737\uC73C\uC73D\uC740\uC744\uC74A\uC74C\uC74D\uC74F\uC751",7,"\uC75C\uC760\uC768\uC76B\uC774\uC775\uC778\uC77C\uC77D\uC77E\uC783\uC784\uC785\uC787\uC788\uC789\uC78A\uC78E\uC790\uC791\uC794\uC796\uC797\uC798\uC79A\uC7A0\uC7A1\uC7A3\uC7A4\uC7A5\uC7A6\uC7AC\uC7AD\uC7B0\uC7B4\uC7BC\uC7BD\uC7BF\uC7C0\uC7C1\uC7C8\uC7C9\uC7CC\uC7CE\uC7D0\uC7D8\uC7DD\uC7E4\uC7E8\uC7EC\uC800\uC801\uC804\uC808\uC80A"],["c141","\uD564\uD566\uD567\uD56A\uD56C\uD56E",5,"\uD576\uD577\uD579\uD57A\uD57B\uD57D",6,"\uD586\uD58A\uD58B"],["c161","\uD58C\uD58D\uD58E\uD58F\uD591",19,"\uD5A6\uD5A7"],["c181","\uD5A8",31,"\uC810\uC811\uC813\uC815\uC816\uC81C\uC81D\uC820\uC824\uC82C\uC82D\uC82F\uC831\uC838\uC83C\uC840\uC848\uC849\uC84C\uC84D\uC854\uC870\uC871\uC874\uC878\uC87A\uC880\uC881\uC883\uC885\uC886\uC887\uC88B\uC88C\uC88D\uC894\uC89D\uC89F\uC8A1\uC8A8\uC8BC\uC8BD\uC8C4\uC8C8\uC8CC\uC8D4\uC8D5\uC8D7\uC8D9\uC8E0\uC8E1\uC8E4\uC8F5\uC8FC\uC8FD\uC900\uC904\uC905\uC906\uC90C\uC90D\uC90F\uC911\uC918\uC92C\uC934\uC950\uC951\uC954\uC958\uC960\uC961\uC963\uC96C\uC970\uC974\uC97C\uC988\uC989\uC98C\uC990\uC998\uC999\uC99B\uC99D\uC9C0\uC9C1\uC9C4\uC9C7\uC9C8\uC9CA\uC9D0\uC9D1\uC9D3"],["c241","\uD5CA\uD5CB\uD5CD\uD5CE\uD5CF\uD5D1\uD5D3",4,"\uD5DA\uD5DC\uD5DE",5,"\uD5E6\uD5E7\uD5E9\uD5EA\uD5EB\uD5ED\uD5EE"],["c261","\uD5EF",4,"\uD5F6\uD5F8\uD5FA",5,"\uD602\uD603\uD605\uD606\uD607\uD609",6,"\uD612"],["c281","\uD616",5,"\uD61D\uD61E\uD61F\uD621\uD622\uD623\uD625",7,"\uD62E",9,"\uD63A\uD63B\uC9D5\uC9D6\uC9D9\uC9DA\uC9DC\uC9DD\uC9E0\uC9E2\uC9E4\uC9E7\uC9EC\uC9ED\uC9EF\uC9F0\uC9F1\uC9F8\uC9F9\uC9FC\uCA00\uCA08\uCA09\uCA0B\uCA0C\uCA0D\uCA14\uCA18\uCA29\uCA4C\uCA4D\uCA50\uCA54\uCA5C\uCA5D\uCA5F\uCA60\uCA61\uCA68\uCA7D\uCA84\uCA98\uCABC\uCABD\uCAC0\uCAC4\uCACC\uCACD\uCACF\uCAD1\uCAD3\uCAD8\uCAD9\uCAE0\uCAEC\uCAF4\uCB08\uCB10\uCB14\uCB18\uCB20\uCB21\uCB41\uCB48\uCB49\uCB4C\uCB50\uCB58\uCB59\uCB5D\uCB64\uCB78\uCB79\uCB9C\uCBB8\uCBD4\uCBE4\uCBE7\uCBE9\uCC0C\uCC0D\uCC10\uCC14\uCC1C\uCC1D\uCC21\uCC22\uCC27\uCC28\uCC29\uCC2C\uCC2E\uCC30\uCC38\uCC39\uCC3B"],["c341","\uD63D\uD63E\uD63F\uD641\uD642\uD643\uD644\uD646\uD647\uD64A\uD64C\uD64E\uD64F\uD650\uD652\uD653\uD656\uD657\uD659\uD65A\uD65B\uD65D",4],["c361","\uD662",4,"\uD668\uD66A",5,"\uD672\uD673\uD675",11],["c381","\uD681\uD682\uD684\uD686",5,"\uD68E\uD68F\uD691\uD692\uD693\uD695",7,"\uD69E\uD6A0\uD6A2",5,"\uD6A9\uD6AA\uCC3C\uCC3D\uCC3E\uCC44\uCC45\uCC48\uCC4C\uCC54\uCC55\uCC57\uCC58\uCC59\uCC60\uCC64\uCC66\uCC68\uCC70\uCC75\uCC98\uCC99\uCC9C\uCCA0\uCCA8\uCCA9\uCCAB\uCCAC\uCCAD\uCCB4\uCCB5\uCCB8\uCCBC\uCCC4\uCCC5\uCCC7\uCCC9\uCCD0\uCCD4\uCCE4\uCCEC\uCCF0\uCD01\uCD08\uCD09\uCD0C\uCD10\uCD18\uCD19\uCD1B\uCD1D\uCD24\uCD28\uCD2C\uCD39\uCD5C\uCD60\uCD64\uCD6C\uCD6D\uCD6F\uCD71\uCD78\uCD88\uCD94\uCD95\uCD98\uCD9C\uCDA4\uCDA5\uCDA7\uCDA9\uCDB0\uCDC4\uCDCC\uCDD0\uCDE8\uCDEC\uCDF0\uCDF8\uCDF9\uCDFB\uCDFD\uCE04\uCE08\uCE0C\uCE14\uCE19\uCE20\uCE21\uCE24\uCE28\uCE30\uCE31\uCE33\uCE35"],["c441","\uD6AB\uD6AD\uD6AE\uD6AF\uD6B1",7,"\uD6BA\uD6BC",7,"\uD6C6\uD6C7\uD6C9\uD6CA\uD6CB"],["c461","\uD6CD\uD6CE\uD6CF\uD6D0\uD6D2\uD6D3\uD6D5\uD6D6\uD6D8\uD6DA",5,"\uD6E1\uD6E2\uD6E3\uD6E5\uD6E6\uD6E7\uD6E9",4],["c481","\uD6EE\uD6EF\uD6F1\uD6F2\uD6F3\uD6F4\uD6F6",5,"\uD6FE\uD6FF\uD701\uD702\uD703\uD705",11,"\uD712\uD713\uD714\uCE58\uCE59\uCE5C\uCE5F\uCE60\uCE61\uCE68\uCE69\uCE6B\uCE6D\uCE74\uCE75\uCE78\uCE7C\uCE84\uCE85\uCE87\uCE89\uCE90\uCE91\uCE94\uCE98\uCEA0\uCEA1\uCEA3\uCEA4\uCEA5\uCEAC\uCEAD\uCEC1\uCEE4\uCEE5\uCEE8\uCEEB\uCEEC\uCEF4\uCEF5\uCEF7\uCEF8\uCEF9\uCF00\uCF01\uCF04\uCF08\uCF10\uCF11\uCF13\uCF15\uCF1C\uCF20\uCF24\uCF2C\uCF2D\uCF2F\uCF30\uCF31\uCF38\uCF54\uCF55\uCF58\uCF5C\uCF64\uCF65\uCF67\uCF69\uCF70\uCF71\uCF74\uCF78\uCF80\uCF85\uCF8C\uCFA1\uCFA8\uCFB0\uCFC4\uCFE0\uCFE1\uCFE4\uCFE8\uCFF0\uCFF1\uCFF3\uCFF5\uCFFC\uD000\uD004\uD011\uD018\uD02D\uD034\uD035\uD038\uD03C"],["c541","\uD715\uD716\uD717\uD71A\uD71B\uD71D\uD71E\uD71F\uD721",6,"\uD72A\uD72C\uD72E",5,"\uD736\uD737\uD739"],["c561","\uD73A\uD73B\uD73D",6,"\uD745\uD746\uD748\uD74A",5,"\uD752\uD753\uD755\uD75A",4],["c581","\uD75F\uD762\uD764\uD766\uD767\uD768\uD76A\uD76B\uD76D\uD76E\uD76F\uD771\uD772\uD773\uD775",6,"\uD77E\uD77F\uD780\uD782",5,"\uD78A\uD78B\uD044\uD045\uD047\uD049\uD050\uD054\uD058\uD060\uD06C\uD06D\uD070\uD074\uD07C\uD07D\uD081\uD0A4\uD0A5\uD0A8\uD0AC\uD0B4\uD0B5\uD0B7\uD0B9\uD0C0\uD0C1\uD0C4\uD0C8\uD0C9\uD0D0\uD0D1\uD0D3\uD0D4\uD0D5\uD0DC\uD0DD\uD0E0\uD0E4\uD0EC\uD0ED\uD0EF\uD0F0\uD0F1\uD0F8\uD10D\uD130\uD131\uD134\uD138\uD13A\uD140\uD141\uD143\uD144\uD145\uD14C\uD14D\uD150\uD154\uD15C\uD15D\uD15F\uD161\uD168\uD16C\uD17C\uD184\uD188\uD1A0\uD1A1\uD1A4\uD1A8\uD1B0\uD1B1\uD1B3\uD1B5\uD1BA\uD1BC\uD1C0\uD1D8\uD1F4\uD1F8\uD207\uD209\uD210\uD22C\uD22D\uD230\uD234\uD23C\uD23D\uD23F\uD241\uD248\uD25C"],["c641","\uD78D\uD78E\uD78F\uD791",6,"\uD79A\uD79C\uD79E",5],["c6a1","\uD264\uD280\uD281\uD284\uD288\uD290\uD291\uD295\uD29C\uD2A0\uD2A4\uD2AC\uD2B1\uD2B8\uD2B9\uD2BC\uD2BF\uD2C0\uD2C2\uD2C8\uD2C9\uD2CB\uD2D4\uD2D8\uD2DC\uD2E4\uD2E5\uD2F0\uD2F1\uD2F4\uD2F8\uD300\uD301\uD303\uD305\uD30C\uD30D\uD30E\uD310\uD314\uD316\uD31C\uD31D\uD31F\uD320\uD321\uD325\uD328\uD329\uD32C\uD330\uD338\uD339\uD33B\uD33C\uD33D\uD344\uD345\uD37C\uD37D\uD380\uD384\uD38C\uD38D\uD38F\uD390\uD391\uD398\uD399\uD39C\uD3A0\uD3A8\uD3A9\uD3AB\uD3AD\uD3B4\uD3B8\uD3BC\uD3C4\uD3C5\uD3C8\uD3C9\uD3D0\uD3D8\uD3E1\uD3E3\uD3EC\uD3ED\uD3F0\uD3F4\uD3FC\uD3FD\uD3FF\uD401"],["c7a1","\uD408\uD41D\uD440\uD444\uD45C\uD460\uD464\uD46D\uD46F\uD478\uD479\uD47C\uD47F\uD480\uD482\uD488\uD489\uD48B\uD48D\uD494\uD4A9\uD4CC\uD4D0\uD4D4\uD4DC\uD4DF\uD4E8\uD4EC\uD4F0\uD4F8\uD4FB\uD4FD\uD504\uD508\uD50C\uD514\uD515\uD517\uD53C\uD53D\uD540\uD544\uD54C\uD54D\uD54F\uD551\uD558\uD559\uD55C\uD560\uD565\uD568\uD569\uD56B\uD56D\uD574\uD575\uD578\uD57C\uD584\uD585\uD587\uD588\uD589\uD590\uD5A5\uD5C8\uD5C9\uD5CC\uD5D0\uD5D2\uD5D8\uD5D9\uD5DB\uD5DD\uD5E4\uD5E5\uD5E8\uD5EC\uD5F4\uD5F5\uD5F7\uD5F9\uD600\uD601\uD604\uD608\uD610\uD611\uD613\uD614\uD615\uD61C\uD620"],["c8a1","\uD624\uD62D\uD638\uD639\uD63C\uD640\uD645\uD648\uD649\uD64B\uD64D\uD651\uD654\uD655\uD658\uD65C\uD667\uD669\uD670\uD671\uD674\uD683\uD685\uD68C\uD68D\uD690\uD694\uD69D\uD69F\uD6A1\uD6A8\uD6AC\uD6B0\uD6B9\uD6BB\uD6C4\uD6C5\uD6C8\uD6CC\uD6D1\uD6D4\uD6D7\uD6D9\uD6E0\uD6E4\uD6E8\uD6F0\uD6F5\uD6FC\uD6FD\uD700\uD704\uD711\uD718\uD719\uD71C\uD720\uD728\uD729\uD72B\uD72D\uD734\uD735\uD738\uD73C\uD744\uD747\uD749\uD750\uD751\uD754\uD756\uD757\uD758\uD759\uD760\uD761\uD763\uD765\uD769\uD76C\uD770\uD774\uD77C\uD77D\uD781\uD788\uD789\uD78C\uD790\uD798\uD799\uD79B\uD79D"],["caa1","\u4F3D\u4F73\u5047\u50F9\u52A0\u53EF\u5475\u54E5\u5609\u5AC1\u5BB6\u6687\u67B6\u67B7\u67EF\u6B4C\u73C2\u75C2\u7A3C\u82DB\u8304\u8857\u8888\u8A36\u8CC8\u8DCF\u8EFB\u8FE6\u99D5\u523B\u5374\u5404\u606A\u6164\u6BBC\u73CF\u811A\u89BA\u89D2\u95A3\u4F83\u520A\u58BE\u5978\u59E6\u5E72\u5E79\u61C7\u63C0\u6746\u67EC\u687F\u6F97\u764E\u770B\u78F5\u7A08\u7AFF\u7C21\u809D\u826E\u8271\u8AEB\u9593\u4E6B\u559D\u66F7\u6E34\u78A3\u7AED\u845B\u8910\u874E\u97A8\u52D8\u574E\u582A\u5D4C\u611F\u61BE\u6221\u6562\u67D1\u6A44\u6E1B\u7518\u75B3\u76E3\u77B0\u7D3A\u90AF\u9451\u9452\u9F95"],["cba1","\u5323\u5CAC\u7532\u80DB\u9240\u9598\u525B\u5808\u59DC\u5CA1\u5D17\u5EB7\u5F3A\u5F4A\u6177\u6C5F\u757A\u7586\u7CE0\u7D73\u7DB1\u7F8C\u8154\u8221\u8591\u8941\u8B1B\u92FC\u964D\u9C47\u4ECB\u4EF7\u500B\u51F1\u584F\u6137\u613E\u6168\u6539\u69EA\u6F11\u75A5\u7686\u76D6\u7B87\u82A5\u84CB\uF900\u93A7\u958B\u5580\u5BA2\u5751\uF901\u7CB3\u7FB9\u91B5\u5028\u53BB\u5C45\u5DE8\u62D2\u636E\u64DA\u64E7\u6E20\u70AC\u795B\u8DDD\u8E1E\uF902\u907D\u9245\u92F8\u4E7E\u4EF6\u5065\u5DFE\u5EFA\u6106\u6957\u8171\u8654\u8E47\u9375\u9A2B\u4E5E\u5091\u6770\u6840\u5109\u528D\u5292\u6AA2"],["cca1","\u77BC\u9210\u9ED4\u52AB\u602F\u8FF2\u5048\u61A9\u63ED\u64CA\u683C\u6A84\u6FC0\u8188\u89A1\u9694\u5805\u727D\u72AC\u7504\u7D79\u7E6D\u80A9\u898B\u8B74\u9063\u9D51\u6289\u6C7A\u6F54\u7D50\u7F3A\u8A23\u517C\u614A\u7B9D\u8B19\u9257\u938C\u4EAC\u4FD3\u501E\u50BE\u5106\u52C1\u52CD\u537F\u5770\u5883\u5E9A\u5F91\u6176\u61AC\u64CE\u656C\u666F\u66BB\u66F4\u6897\u6D87\u7085\u70F1\u749F\u74A5\u74CA\u75D9\u786C\u78EC\u7ADF\u7AF6\u7D45\u7D93\u8015\u803F\u811B\u8396\u8B66\u8F15\u9015\u93E1\u9803\u9838\u9A5A\u9BE8\u4FC2\u5553\u583A\u5951\u5B63\u5C46\u60B8\u6212\u6842\u68B0"],["cda1","\u68E8\u6EAA\u754C\u7678\u78CE\u7A3D\u7CFB\u7E6B\u7E7C\u8A08\u8AA1\u8C3F\u968E\u9DC4\u53E4\u53E9\u544A\u5471\u56FA\u59D1\u5B64\u5C3B\u5EAB\u62F7\u6537\u6545\u6572\u66A0\u67AF\u69C1\u6CBD\u75FC\u7690\u777E\u7A3F\u7F94\u8003\u80A1\u818F\u82E6\u82FD\u83F0\u85C1\u8831\u88B4\u8AA5\uF903\u8F9C\u932E\u96C7\u9867\u9AD8\u9F13\u54ED\u659B\u66F2\u688F\u7A40\u8C37\u9D60\u56F0\u5764\u5D11\u6606\u68B1\u68CD\u6EFE\u7428\u889E\u9BE4\u6C68\uF904\u9AA8\u4F9B\u516C\u5171\u529F\u5B54\u5DE5\u6050\u606D\u62F1\u63A7\u653B\u73D9\u7A7A\u86A3\u8CA2\u978F\u4E32\u5BE1\u6208\u679C\u74DC"],["cea1","\u79D1\u83D3\u8A87\u8AB2\u8DE8\u904E\u934B\u9846\u5ED3\u69E8\u85FF\u90ED\uF905\u51A0\u5B98\u5BEC\u6163\u68FA\u6B3E\u704C\u742F\u74D8\u7BA1\u7F50\u83C5\u89C0\u8CAB\u95DC\u9928\u522E\u605D\u62EC\u9002\u4F8A\u5149\u5321\u58D9\u5EE3\u66E0\u6D38\u709A\u72C2\u73D6\u7B50\u80F1\u945B\u5366\u639B\u7F6B\u4E56\u5080\u584A\u58DE\u602A\u6127\u62D0\u69D0\u9B41\u5B8F\u7D18\u80B1\u8F5F\u4EA4\u50D1\u54AC\u55AC\u5B0C\u5DA0\u5DE7\u652A\u654E\u6821\u6A4B\u72E1\u768E\u77EF\u7D5E\u7FF9\u81A0\u854E\u86DF\u8F03\u8F4E\u90CA\u9903\u9A55\u9BAB\u4E18\u4E45\u4E5D\u4EC7\u4FF1\u5177\u52FE"],["cfa1","\u5340\u53E3\u53E5\u548E\u5614\u5775\u57A2\u5BC7\u5D87\u5ED0\u61FC\u62D8\u6551\u67B8\u67E9\u69CB\u6B50\u6BC6\u6BEC\u6C42\u6E9D\u7078\u72D7\u7396\u7403\u77BF\u77E9\u7A76\u7D7F\u8009\u81FC\u8205\u820A\u82DF\u8862\u8B33\u8CFC\u8EC0\u9011\u90B1\u9264\u92B6\u99D2\u9A45\u9CE9\u9DD7\u9F9C\u570B\u5C40\u83CA\u97A0\u97AB\u9EB4\u541B\u7A98\u7FA4\u88D9\u8ECD\u90E1\u5800\u5C48\u6398\u7A9F\u5BAE\u5F13\u7A79\u7AAE\u828E\u8EAC\u5026\u5238\u52F8\u5377\u5708\u62F3\u6372\u6B0A\u6DC3\u7737\u53A5\u7357\u8568\u8E76\u95D5\u673A\u6AC3\u6F70\u8A6D\u8ECC\u994B\uF906\u6677\u6B78\u8CB4"],["d0a1","\u9B3C\uF907\u53EB\u572D\u594E\u63C6\u69FB\u73EA\u7845\u7ABA\u7AC5\u7CFE\u8475\u898F\u8D73\u9035\u95A8\u52FB\u5747\u7547\u7B60\u83CC\u921E\uF908\u6A58\u514B\u524B\u5287\u621F\u68D8\u6975\u9699\u50C5\u52A4\u52E4\u61C3\u65A4\u6839\u69FF\u747E\u7B4B\u82B9\u83EB\u89B2\u8B39\u8FD1\u9949\uF909\u4ECA\u5997\u64D2\u6611\u6A8E\u7434\u7981\u79BD\u82A9\u887E\u887F\u895F\uF90A\u9326\u4F0B\u53CA\u6025\u6271\u6C72\u7D1A\u7D66\u4E98\u5162\u77DC\u80AF\u4F01\u4F0E\u5176\u5180\u55DC\u5668\u573B\u57FA\u57FC\u5914\u5947\u5993\u5BC4\u5C90\u5D0E\u5DF1\u5E7E\u5FCC\u6280\u65D7\u65E3"],["d1a1","\u671E\u671F\u675E\u68CB\u68C4\u6A5F\u6B3A\u6C23\u6C7D\u6C82\u6DC7\u7398\u7426\u742A\u7482\u74A3\u7578\u757F\u7881\u78EF\u7941\u7947\u7948\u797A\u7B95\u7D00\u7DBA\u7F88\u8006\u802D\u808C\u8A18\u8B4F\u8C48\u8D77\u9321\u9324\u98E2\u9951\u9A0E\u9A0F\u9A65\u9E92\u7DCA\u4F76\u5409\u62EE\u6854\u91D1\u55AB\u513A\uF90B\uF90C\u5A1C\u61E6\uF90D\u62CF\u62FF\uF90E",5,"\u90A3\uF914",4,"\u8AFE\uF919\uF91A\uF91B\uF91C\u6696\uF91D\u7156\uF91E\uF91F\u96E3\uF920\u634F\u637A\u5357\uF921\u678F\u6960\u6E73\uF922\u7537\uF923\uF924\uF925"],["d2a1","\u7D0D\uF926\uF927\u8872\u56CA\u5A18\uF928",4,"\u4E43\uF92D\u5167\u5948\u67F0\u8010\uF92E\u5973\u5E74\u649A\u79CA\u5FF5\u606C\u62C8\u637B\u5BE7\u5BD7\u52AA\uF92F\u5974\u5F29\u6012\uF930\uF931\uF932\u7459\uF933",5,"\u99D1\uF939",10,"\u6FC3\uF944\uF945\u81BF\u8FB2\u60F1\uF946\uF947\u8166\uF948\uF949\u5C3F\uF94A",7,"\u5AE9\u8A25\u677B\u7D10\uF952",5,"\u80FD\uF958\uF959\u5C3C\u6CE5\u533F\u6EBA\u591A\u8336"],["d3a1","\u4E39\u4EB6\u4F46\u55AE\u5718\u58C7\u5F56\u65B7\u65E6\u6A80\u6BB5\u6E4D\u77ED\u7AEF\u7C1E\u7DDE\u86CB\u8892\u9132\u935B\u64BB\u6FBE\u737A\u75B8\u9054\u5556\u574D\u61BA\u64D4\u66C7\u6DE1\u6E5B\u6F6D\u6FB9\u75F0\u8043\u81BD\u8541\u8983\u8AC7\u8B5A\u931F\u6C93\u7553\u7B54\u8E0F\u905D\u5510\u5802\u5858\u5E62\u6207\u649E\u68E0\u7576\u7CD6\u87B3\u9EE8\u4EE3\u5788\u576E\u5927\u5C0D\u5CB1\u5E36\u5F85\u6234\u64E1\u73B3\u81FA\u888B\u8CB8\u968A\u9EDB\u5B85\u5FB7\u60B3\u5012\u5200\u5230\u5716\u5835\u5857\u5C0E\u5C60\u5CF6\u5D8B\u5EA6\u5F92\u60BC\u6311\u6389\u6417\u6843"],["d4a1","\u68F9\u6AC2\u6DD8\u6E21\u6ED4\u6FE4\u71FE\u76DC\u7779\u79B1\u7A3B\u8404\u89A9\u8CED\u8DF3\u8E48\u9003\u9014\u9053\u90FD\u934D\u9676\u97DC\u6BD2\u7006\u7258\u72A2\u7368\u7763\u79BF\u7BE4\u7E9B\u8B80\u58A9\u60C7\u6566\u65FD\u66BE\u6C8C\u711E\u71C9\u8C5A\u9813\u4E6D\u7A81\u4EDD\u51AC\u51CD\u52D5\u540C\u61A7\u6771\u6850\u68DF\u6D1E\u6F7C\u75BC\u77B3\u7AE5\u80F4\u8463\u9285\u515C\u6597\u675C\u6793\u75D8\u7AC7\u8373\uF95A\u8C46\u9017\u982D\u5C6F\u81C0\u829A\u9041\u906F\u920D\u5F97\u5D9D\u6A59\u71C8\u767B\u7B49\u85E4\u8B04\u9127\u9A30\u5587\u61F6\uF95B\u7669\u7F85"],["d5a1","\u863F\u87BA\u88F8\u908F\uF95C\u6D1B\u70D9\u73DE\u7D61\u843D\uF95D\u916A\u99F1\uF95E\u4E82\u5375\u6B04\u6B12\u703E\u721B\u862D\u9E1E\u524C\u8FA3\u5D50\u64E5\u652C\u6B16\u6FEB\u7C43\u7E9C\u85CD\u8964\u89BD\u62C9\u81D8\u881F\u5ECA\u6717\u6D6A\u72FC\u7405\u746F\u8782\u90DE\u4F86\u5D0D\u5FA0\u840A\u51B7\u63A0\u7565\u4EAE\u5006\u5169\u51C9\u6881\u6A11\u7CAE\u7CB1\u7CE7\u826F\u8AD2\u8F1B\u91CF\u4FB6\u5137\u52F5\u5442\u5EEC\u616E\u623E\u65C5\u6ADA\u6FFE\u792A\u85DC\u8823\u95AD\u9A62\u9A6A\u9E97\u9ECE\u529B\u66C6\u6B77\u701D\u792B\u8F62\u9742\u6190\u6200\u6523\u6F23"],["d6a1","\u7149\u7489\u7DF4\u806F\u84EE\u8F26\u9023\u934A\u51BD\u5217\u52A3\u6D0C\u70C8\u88C2\u5EC9\u6582\u6BAE\u6FC2\u7C3E\u7375\u4EE4\u4F36\u56F9\uF95F\u5CBA\u5DBA\u601C\u73B2\u7B2D\u7F9A\u7FCE\u8046\u901E\u9234\u96F6\u9748\u9818\u9F61\u4F8B\u6FA7\u79AE\u91B4\u96B7\u52DE\uF960\u6488\u64C4\u6AD3\u6F5E\u7018\u7210\u76E7\u8001\u8606\u865C\u8DEF\u8F05\u9732\u9B6F\u9DFA\u9E75\u788C\u797F\u7DA0\u83C9\u9304\u9E7F\u9E93\u8AD6\u58DF\u5F04\u6727\u7027\u74CF\u7C60\u807E\u5121\u7028\u7262\u78CA\u8CC2\u8CDA\u8CF4\u96F7\u4E86\u50DA\u5BEE\u5ED6\u6599\u71CE\u7642\u77AD\u804A\u84FC"],["d7a1","\u907C\u9B27\u9F8D\u58D8\u5A41\u5C62\u6A13\u6DDA\u6F0F\u763B\u7D2F\u7E37\u851E\u8938\u93E4\u964B\u5289\u65D2\u67F3\u69B4\u6D41\u6E9C\u700F\u7409\u7460\u7559\u7624\u786B\u8B2C\u985E\u516D\u622E\u9678\u4F96\u502B\u5D19\u6DEA\u7DB8\u8F2A\u5F8B\u6144\u6817\uF961\u9686\u52D2\u808B\u51DC\u51CC\u695E\u7A1C\u7DBE\u83F1\u9675\u4FDA\u5229\u5398\u540F\u550E\u5C65\u60A7\u674E\u68A8\u6D6C\u7281\u72F8\u7406\u7483\uF962\u75E2\u7C6C\u7F79\u7FB8\u8389\u88CF\u88E1\u91CC\u91D0\u96E2\u9BC9\u541D\u6F7E\u71D0\u7498\u85FA\u8EAA\u96A3\u9C57\u9E9F\u6797\u6DCB\u7433\u81E8\u9716\u782C"],["d8a1","\u7ACB\u7B20\u7C92\u6469\u746A\u75F2\u78BC\u78E8\u99AC\u9B54\u9EBB\u5BDE\u5E55\u6F20\u819C\u83AB\u9088\u4E07\u534D\u5A29\u5DD2\u5F4E\u6162\u633D\u6669\u66FC\u6EFF\u6F2B\u7063\u779E\u842C\u8513\u883B\u8F13\u9945\u9C3B\u551C\u62B9\u672B\u6CAB\u8309\u896A\u977A\u4EA1\u5984\u5FD8\u5FD9\u671B\u7DB2\u7F54\u8292\u832B\u83BD\u8F1E\u9099\u57CB\u59B9\u5A92\u5BD0\u6627\u679A\u6885\u6BCF\u7164\u7F75\u8CB7\u8CE3\u9081\u9B45\u8108\u8C8A\u964C\u9A40\u9EA5\u5B5F\u6C13\u731B\u76F2\u76DF\u840C\u51AA\u8993\u514D\u5195\u52C9\u68C9\u6C94\u7704\u7720\u7DBF\u7DEC\u9762\u9EB5\u6EC5"],["d9a1","\u8511\u51A5\u540D\u547D\u660E\u669D\u6927\u6E9F\u76BF\u7791\u8317\u84C2\u879F\u9169\u9298\u9CF4\u8882\u4FAE\u5192\u52DF\u59C6\u5E3D\u6155\u6478\u6479\u66AE\u67D0\u6A21\u6BCD\u6BDB\u725F\u7261\u7441\u7738\u77DB\u8017\u82BC\u8305\u8B00\u8B28\u8C8C\u6728\u6C90\u7267\u76EE\u7766\u7A46\u9DA9\u6B7F\u6C92\u5922\u6726\u8499\u536F\u5893\u5999\u5EDF\u63CF\u6634\u6773\u6E3A\u732B\u7AD7\u82D7\u9328\u52D9\u5DEB\u61AE\u61CB\u620A\u62C7\u64AB\u65E0\u6959\u6B66\u6BCB\u7121\u73F7\u755D\u7E46\u821E\u8302\u856A\u8AA3\u8CBF\u9727\u9D61\u58A8\u9ED8\u5011\u520E\u543B\u554F\u6587"],["daa1","\u6C76\u7D0A\u7D0B\u805E\u868A\u9580\u96EF\u52FF\u6C95\u7269\u5473\u5A9A\u5C3E\u5D4B\u5F4C\u5FAE\u672A\u68B6\u6963\u6E3C\u6E44\u7709\u7C73\u7F8E\u8587\u8B0E\u8FF7\u9761\u9EF4\u5CB7\u60B6\u610D\u61AB\u654F\u65FB\u65FC\u6C11\u6CEF\u739F\u73C9\u7DE1\u9594\u5BC6\u871C\u8B10\u525D\u535A\u62CD\u640F\u64B2\u6734\u6A38\u6CCA\u73C0\u749E\u7B94\u7C95\u7E1B\u818A\u8236\u8584\u8FEB\u96F9\u99C1\u4F34\u534A\u53CD\u53DB\u62CC\u642C\u6500\u6591\u69C3\u6CEE\u6F58\u73ED\u7554\u7622\u76E4\u76FC\u78D0\u78FB\u792C\u7D46\u822C\u87E0\u8FD4\u9812\u98EF\u52C3\u62D4\u64A5\u6E24\u6F51"],["dba1","\u767C\u8DCB\u91B1\u9262\u9AEE\u9B43\u5023\u508D\u574A\u59A8\u5C28\u5E47\u5F77\u623F\u653E\u65B9\u65C1\u6609\u678B\u699C\u6EC2\u78C5\u7D21\u80AA\u8180\u822B\u82B3\u84A1\u868C\u8A2A\u8B17\u90A6\u9632\u9F90\u500D\u4FF3\uF963\u57F9\u5F98\u62DC\u6392\u676F\u6E43\u7119\u76C3\u80CC\u80DA\u88F4\u88F5\u8919\u8CE0\u8F29\u914D\u966A\u4F2F\u4F70\u5E1B\u67CF\u6822\u767D\u767E\u9B44\u5E61\u6A0A\u7169\u71D4\u756A\uF964\u7E41\u8543\u85E9\u98DC\u4F10\u7B4F\u7F70\u95A5\u51E1\u5E06\u68B5\u6C3E\u6C4E\u6CDB\u72AF\u7BC4\u8303\u6CD5\u743A\u50FB\u5288\u58C1\u64D8\u6A97\u74A7\u7656"],["dca1","\u78A7\u8617\u95E2\u9739\uF965\u535E\u5F01\u8B8A\u8FA8\u8FAF\u908A\u5225\u77A5\u9C49\u9F08\u4E19\u5002\u5175\u5C5B\u5E77\u661E\u663A\u67C4\u68C5\u70B3\u7501\u75C5\u79C9\u7ADD\u8F27\u9920\u9A08\u4FDD\u5821\u5831\u5BF6\u666E\u6B65\u6D11\u6E7A\u6F7D\u73E4\u752B\u83E9\u88DC\u8913\u8B5C\u8F14\u4F0F\u50D5\u5310\u535C\u5B93\u5FA9\u670D\u798F\u8179\u832F\u8514\u8907\u8986\u8F39\u8F3B\u99A5\u9C12\u672C\u4E76\u4FF8\u5949\u5C01\u5CEF\u5CF0\u6367\u68D2\u70FD\u71A2\u742B\u7E2B\u84EC\u8702\u9022\u92D2\u9CF3\u4E0D\u4ED8\u4FEF\u5085\u5256\u526F\u5426\u5490\u57E0\u592B\u5A66"],["dda1","\u5B5A\u5B75\u5BCC\u5E9C\uF966\u6276\u6577\u65A7\u6D6E\u6EA5\u7236\u7B26\u7C3F\u7F36\u8150\u8151\u819A\u8240\u8299\u83A9\u8A03\u8CA0\u8CE6\u8CFB\u8D74\u8DBA\u90E8\u91DC\u961C\u9644\u99D9\u9CE7\u5317\u5206\u5429\u5674\u58B3\u5954\u596E\u5FFF\u61A4\u626E\u6610\u6C7E\u711A\u76C6\u7C89\u7CDE\u7D1B\u82AC\u8CC1\u96F0\uF967\u4F5B\u5F17\u5F7F\u62C2\u5D29\u670B\u68DA\u787C\u7E43\u9D6C\u4E15\u5099\u5315\u532A\u5351\u5983\u5A62\u5E87\u60B2\u618A\u6249\u6279\u6590\u6787\u69A7\u6BD4\u6BD6\u6BD7\u6BD8\u6CB8\uF968\u7435\u75FA\u7812\u7891\u79D5\u79D8\u7C83\u7DCB\u7FE1\u80A5"],["dea1","\u813E\u81C2\u83F2\u871A\u88E8\u8AB9\u8B6C\u8CBB\u9119\u975E\u98DB\u9F3B\u56AC\u5B2A\u5F6C\u658C\u6AB3\u6BAF\u6D5C\u6FF1\u7015\u725D\u73AD\u8CA7\u8CD3\u983B\u6191\u6C37\u8058\u9A01\u4E4D\u4E8B\u4E9B\u4ED5\u4F3A\u4F3C\u4F7F\u4FDF\u50FF\u53F2\u53F8\u5506\u55E3\u56DB\u58EB\u5962\u5A11\u5BEB\u5BFA\u5C04\u5DF3\u5E2B\u5F99\u601D\u6368\u659C\u65AF\u67F6\u67FB\u68AD\u6B7B\u6C99\u6CD7\u6E23\u7009\u7345\u7802\u793E\u7940\u7960\u79C1\u7BE9\u7D17\u7D72\u8086\u820D\u838E\u84D1\u86C7\u88DF\u8A50\u8A5E\u8B1D\u8CDC\u8D66\u8FAD\u90AA\u98FC\u99DF\u9E9D\u524A\uF969\u6714\uF96A"],["dfa1","\u5098\u522A\u5C71\u6563\u6C55\u73CA\u7523\u759D\u7B97\u849C\u9178\u9730\u4E77\u6492\u6BBA\u715E\u85A9\u4E09\uF96B\u6749\u68EE\u6E17\u829F\u8518\u886B\u63F7\u6F81\u9212\u98AF\u4E0A\u50B7\u50CF\u511F\u5546\u55AA\u5617\u5B40\u5C19\u5CE0\u5E38\u5E8A\u5EA0\u5EC2\u60F3\u6851\u6A61\u6E58\u723D\u7240\u72C0\u76F8\u7965\u7BB1\u7FD4\u88F3\u89F4\u8A73\u8C61\u8CDE\u971C\u585E\u74BD\u8CFD\u55C7\uF96C\u7A61\u7D22\u8272\u7272\u751F\u7525\uF96D\u7B19\u5885\u58FB\u5DBC\u5E8F\u5EB6\u5F90\u6055\u6292\u637F\u654D\u6691\u66D9\u66F8\u6816\u68F2\u7280\u745E\u7B6E\u7D6E\u7DD6\u7F72"],["e0a1","\u80E5\u8212\u85AF\u897F\u8A93\u901D\u92E4\u9ECD\u9F20\u5915\u596D\u5E2D\u60DC\u6614\u6673\u6790\u6C50\u6DC5\u6F5F\u77F3\u78A9\u84C6\u91CB\u932B\u4ED9\u50CA\u5148\u5584\u5B0B\u5BA3\u6247\u657E\u65CB\u6E32\u717D\u7401\u7444\u7487\u74BF\u766C\u79AA\u7DDA\u7E55\u7FA8\u817A\u81B3\u8239\u861A\u87EC\u8A75\u8DE3\u9078\u9291\u9425\u994D\u9BAE\u5368\u5C51\u6954\u6CC4\u6D29\u6E2B\u820C\u859B\u893B\u8A2D\u8AAA\u96EA\u9F67\u5261\u66B9\u6BB2\u7E96\u87FE\u8D0D\u9583\u965D\u651D\u6D89\u71EE\uF96E\u57CE\u59D3\u5BAC\u6027\u60FA\u6210\u661F\u665F\u7329\u73F9\u76DB\u7701\u7B6C"],["e1a1","\u8056\u8072\u8165\u8AA0\u9192\u4E16\u52E2\u6B72\u6D17\u7A05\u7B39\u7D30\uF96F\u8CB0\u53EC\u562F\u5851\u5BB5\u5C0F\u5C11\u5DE2\u6240\u6383\u6414\u662D\u68B3\u6CBC\u6D88\u6EAF\u701F\u70A4\u71D2\u7526\u758F\u758E\u7619\u7B11\u7BE0\u7C2B\u7D20\u7D39\u852C\u856D\u8607\u8A34\u900D\u9061\u90B5\u92B7\u97F6\u9A37\u4FD7\u5C6C\u675F\u6D91\u7C9F\u7E8C\u8B16\u8D16\u901F\u5B6B\u5DFD\u640D\u84C0\u905C\u98E1\u7387\u5B8B\u609A\u677E\u6DDE\u8A1F\u8AA6\u9001\u980C\u5237\uF970\u7051\u788E\u9396\u8870\u91D7\u4FEE\u53D7\u55FD\u56DA\u5782\u58FD\u5AC2\u5B88\u5CAB\u5CC0\u5E25\u6101"],["e2a1","\u620D\u624B\u6388\u641C\u6536\u6578\u6A39\u6B8A\u6C34\u6D19\u6F31\u71E7\u72E9\u7378\u7407\u74B2\u7626\u7761\u79C0\u7A57\u7AEA\u7CB9\u7D8F\u7DAC\u7E61\u7F9E\u8129\u8331\u8490\u84DA\u85EA\u8896\u8AB0\u8B90\u8F38\u9042\u9083\u916C\u9296\u92B9\u968B\u96A7\u96A8\u96D6\u9700\u9808\u9996\u9AD3\u9B1A\u53D4\u587E\u5919\u5B70\u5BBF\u6DD1\u6F5A\u719F\u7421\u74B9\u8085\u83FD\u5DE1\u5F87\u5FAA\u6042\u65EC\u6812\u696F\u6A53\u6B89\u6D35\u6DF3\u73E3\u76FE\u77AC\u7B4D\u7D14\u8123\u821C\u8340\u84F4\u8563\u8A62\u8AC4\u9187\u931E\u9806\u99B4\u620C\u8853\u8FF0\u9265\u5D07\u5D27"],["e3a1","\u5D69\u745F\u819D\u8768\u6FD5\u62FE\u7FD2\u8936\u8972\u4E1E\u4E58\u50E7\u52DD\u5347\u627F\u6607\u7E69\u8805\u965E\u4F8D\u5319\u5636\u59CB\u5AA4\u5C38\u5C4E\u5C4D\u5E02\u5F11\u6043\u65BD\u662F\u6642\u67BE\u67F4\u731C\u77E2\u793A\u7FC5\u8494\u84CD\u8996\u8A66\u8A69\u8AE1\u8C55\u8C7A\u57F4\u5BD4\u5F0F\u606F\u62ED\u690D\u6B96\u6E5C\u7184\u7BD2\u8755\u8B58\u8EFE\u98DF\u98FE\u4F38\u4F81\u4FE1\u547B\u5A20\u5BB8\u613C\u65B0\u6668\u71FC\u7533\u795E\u7D33\u814E\u81E3\u8398\u85AA\u85CE\u8703\u8A0A\u8EAB\u8F9B\uF971\u8FC5\u5931\u5BA4\u5BE6\u6089\u5BE9\u5C0B\u5FC3\u6C81"],["e4a1","\uF972\u6DF1\u700B\u751A\u82AF\u8AF6\u4EC0\u5341\uF973\u96D9\u6C0F\u4E9E\u4FC4\u5152\u555E\u5A25\u5CE8\u6211\u7259\u82BD\u83AA\u86FE\u8859\u8A1D\u963F\u96C5\u9913\u9D09\u9D5D\u580A\u5CB3\u5DBD\u5E44\u60E1\u6115\u63E1\u6A02\u6E25\u9102\u9354\u984E\u9C10\u9F77\u5B89\u5CB8\u6309\u664F\u6848\u773C\u96C1\u978D\u9854\u9B9F\u65A1\u8B01\u8ECB\u95BC\u5535\u5CA9\u5DD6\u5EB5\u6697\u764C\u83F4\u95C7\u58D3\u62BC\u72CE\u9D28\u4EF0\u592E\u600F\u663B\u6B83\u79E7\u9D26\u5393\u54C0\u57C3\u5D16\u611B\u66D6\u6DAF\u788D\u827E\u9698\u9744\u5384\u627C\u6396\u6DB2\u7E0A\u814B\u984D"],["e5a1","\u6AFB\u7F4C\u9DAF\u9E1A\u4E5F\u503B\u51B6\u591C\u60F9\u63F6\u6930\u723A\u8036\uF974\u91CE\u5F31\uF975\uF976\u7D04\u82E5\u846F\u84BB\u85E5\u8E8D\uF977\u4F6F\uF978\uF979\u58E4\u5B43\u6059\u63DA\u6518\u656D\u6698\uF97A\u694A\u6A23\u6D0B\u7001\u716C\u75D2\u760D\u79B3\u7A70\uF97B\u7F8A\uF97C\u8944\uF97D\u8B93\u91C0\u967D\uF97E\u990A\u5704\u5FA1\u65BC\u6F01\u7600\u79A6\u8A9E\u99AD\u9B5A\u9F6C\u5104\u61B6\u6291\u6A8D\u81C6\u5043\u5830\u5F66\u7109\u8A00\u8AFA\u5B7C\u8616\u4FFA\u513C\u56B4\u5944\u63A9\u6DF9\u5DAA\u696D\u5186\u4E88\u4F59\uF97F\uF980\uF981\u5982\uF982"],["e6a1","\uF983\u6B5F\u6C5D\uF984\u74B5\u7916\uF985\u8207\u8245\u8339\u8F3F\u8F5D\uF986\u9918\uF987\uF988\uF989\u4EA6\uF98A\u57DF\u5F79\u6613\uF98B\uF98C\u75AB\u7E79\u8B6F\uF98D\u9006\u9A5B\u56A5\u5827\u59F8\u5A1F\u5BB4\uF98E\u5EF6\uF98F\uF990\u6350\u633B\uF991\u693D\u6C87\u6CBF\u6D8E\u6D93\u6DF5\u6F14\uF992\u70DF\u7136\u7159\uF993\u71C3\u71D5\uF994\u784F\u786F\uF995\u7B75\u7DE3\uF996\u7E2F\uF997\u884D\u8EDF\uF998\uF999\uF99A\u925B\uF99B\u9CF6\uF99C\uF99D\uF99E\u6085\u6D85\uF99F\u71B1\uF9A0\uF9A1\u95B1\u53AD\uF9A2\uF9A3\uF9A4\u67D3\uF9A5\u708E\u7130\u7430\u8276\u82D2"],["e7a1","\uF9A6\u95BB\u9AE5\u9E7D\u66C4\uF9A7\u71C1\u8449\uF9A8\uF9A9\u584B\uF9AA\uF9AB\u5DB8\u5F71\uF9AC\u6620\u668E\u6979\u69AE\u6C38\u6CF3\u6E36\u6F41\u6FDA\u701B\u702F\u7150\u71DF\u7370\uF9AD\u745B\uF9AE\u74D4\u76C8\u7A4E\u7E93\uF9AF\uF9B0\u82F1\u8A60\u8FCE\uF9B1\u9348\uF9B2\u9719\uF9B3\uF9B4\u4E42\u502A\uF9B5\u5208\u53E1\u66F3\u6C6D\u6FCA\u730A\u777F\u7A62\u82AE\u85DD\u8602\uF9B6\u88D4\u8A63\u8B7D\u8C6B\uF9B7\u92B3\uF9B8\u9713\u9810\u4E94\u4F0D\u4FC9\u50B2\u5348\u543E\u5433\u55DA\u5862\u58BA\u5967\u5A1B\u5BE4\u609F\uF9B9\u61CA\u6556\u65FF\u6664\u68A7\u6C5A\u6FB3"],["e8a1","\u70CF\u71AC\u7352\u7B7D\u8708\u8AA4\u9C32\u9F07\u5C4B\u6C83\u7344\u7389\u923A\u6EAB\u7465\u761F\u7A69\u7E15\u860A\u5140\u58C5\u64C1\u74EE\u7515\u7670\u7FC1\u9095\u96CD\u9954\u6E26\u74E6\u7AA9\u7AAA\u81E5\u86D9\u8778\u8A1B\u5A49\u5B8C\u5B9B\u68A1\u6900\u6D63\u73A9\u7413\u742C\u7897\u7DE9\u7FEB\u8118\u8155\u839E\u8C4C\u962E\u9811\u66F0\u5F80\u65FA\u6789\u6C6A\u738B\u502D\u5A03\u6B6A\u77EE\u5916\u5D6C\u5DCD\u7325\u754F\uF9BA\uF9BB\u50E5\u51F9\u582F\u592D\u5996\u59DA\u5BE5\uF9BC\uF9BD\u5DA2\u62D7\u6416\u6493\u64FE\uF9BE\u66DC\uF9BF\u6A48\uF9C0\u71FF\u7464\uF9C1"],["e9a1","\u7A88\u7AAF\u7E47\u7E5E\u8000\u8170\uF9C2\u87EF\u8981\u8B20\u9059\uF9C3\u9080\u9952\u617E\u6B32\u6D74\u7E1F\u8925\u8FB1\u4FD1\u50AD\u5197\u52C7\u57C7\u5889\u5BB9\u5EB8\u6142\u6995\u6D8C\u6E67\u6EB6\u7194\u7462\u7528\u752C\u8073\u8338\u84C9\u8E0A\u9394\u93DE\uF9C4\u4E8E\u4F51\u5076\u512A\u53C8\u53CB\u53F3\u5B87\u5BD3\u5C24\u611A\u6182\u65F4\u725B\u7397\u7440\u76C2\u7950\u7991\u79B9\u7D06\u7FBD\u828B\u85D5\u865E\u8FC2\u9047\u90F5\u91EA\u9685\u96E8\u96E9\u52D6\u5F67\u65ED\u6631\u682F\u715C\u7A36\u90C1\u980A\u4E91\uF9C5\u6A52\u6B9E\u6F90\u7189\u8018\u82B8\u8553"],["eaa1","\u904B\u9695\u96F2\u97FB\u851A\u9B31\u4E90\u718A\u96C4\u5143\u539F\u54E1\u5713\u5712\u57A3\u5A9B\u5AC4\u5BC3\u6028\u613F\u63F4\u6C85\u6D39\u6E72\u6E90\u7230\u733F\u7457\u82D1\u8881\u8F45\u9060\uF9C6\u9662\u9858\u9D1B\u6708\u8D8A\u925E\u4F4D\u5049\u50DE\u5371\u570D\u59D4\u5A01\u5C09\u6170\u6690\u6E2D\u7232\u744B\u7DEF\u80C3\u840E\u8466\u853F\u875F\u885B\u8918\u8B02\u9055\u97CB\u9B4F\u4E73\u4F91\u5112\u516A\uF9C7\u552F\u55A9\u5B7A\u5BA5\u5E7C\u5E7D\u5EBE\u60A0\u60DF\u6108\u6109\u63C4\u6538\u6709\uF9C8\u67D4\u67DA\uF9C9\u6961\u6962\u6CB9\u6D27\uF9CA\u6E38\uF9CB"],["eba1","\u6FE1\u7336\u7337\uF9CC\u745C\u7531\uF9CD\u7652\uF9CE\uF9CF\u7DAD\u81FE\u8438\u88D5\u8A98\u8ADB\u8AED\u8E30\u8E42\u904A\u903E\u907A\u9149\u91C9\u936E\uF9D0\uF9D1\u5809\uF9D2\u6BD3\u8089\u80B2\uF9D3\uF9D4\u5141\u596B\u5C39\uF9D5\uF9D6\u6F64\u73A7\u80E4\u8D07\uF9D7\u9217\u958F\uF9D8\uF9D9\uF9DA\uF9DB\u807F\u620E\u701C\u7D68\u878D\uF9DC\u57A0\u6069\u6147\u6BB7\u8ABE\u9280\u96B1\u4E59\u541F\u6DEB\u852D\u9670\u97F3\u98EE\u63D6\u6CE3\u9091\u51DD\u61C9\u81BA\u9DF9\u4F9D\u501A\u5100\u5B9C\u610F\u61FF\u64EC\u6905\u6BC5\u7591\u77E3\u7FA9\u8264\u858F\u87FB\u8863\u8ABC"],["eca1","\u8B70\u91AB\u4E8C\u4EE5\u4F0A\uF9DD\uF9DE\u5937\u59E8\uF9DF\u5DF2\u5F1B\u5F5B\u6021\uF9E0\uF9E1\uF9E2\uF9E3\u723E\u73E5\uF9E4\u7570\u75CD\uF9E5\u79FB\uF9E6\u800C\u8033\u8084\u82E1\u8351\uF9E7\uF9E8\u8CBD\u8CB3\u9087\uF9E9\uF9EA\u98F4\u990C\uF9EB\uF9EC\u7037\u76CA\u7FCA\u7FCC\u7FFC\u8B1A\u4EBA\u4EC1\u5203\u5370\uF9ED\u54BD\u56E0\u59FB\u5BC5\u5F15\u5FCD\u6E6E\uF9EE\uF9EF\u7D6A\u8335\uF9F0\u8693\u8A8D\uF9F1\u976D\u9777\uF9F2\uF9F3\u4E00\u4F5A\u4F7E\u58F9\u65E5\u6EA2\u9038\u93B0\u99B9\u4EFB\u58EC\u598A\u59D9\u6041\uF9F4\uF9F5\u7A14\uF9F6\u834F\u8CC3\u5165\u5344"],["eda1","\uF9F7\uF9F8\uF9F9\u4ECD\u5269\u5B55\u82BF\u4ED4\u523A\u54A8\u59C9\u59FF\u5B50\u5B57\u5B5C\u6063\u6148\u6ECB\u7099\u716E\u7386\u74F7\u75B5\u78C1\u7D2B\u8005\u81EA\u8328\u8517\u85C9\u8AEE\u8CC7\u96CC\u4F5C\u52FA\u56BC\u65AB\u6628\u707C\u70B8\u7235\u7DBD\u828D\u914C\u96C0\u9D72\u5B71\u68E7\u6B98\u6F7A\u76DE\u5C91\u66AB\u6F5B\u7BB4\u7C2A\u8836\u96DC\u4E08\u4ED7\u5320\u5834\u58BB\u58EF\u596C\u5C07\u5E33\u5E84\u5F35\u638C\u66B2\u6756\u6A1F\u6AA3\u6B0C\u6F3F\u7246\uF9FA\u7350\u748B\u7AE0\u7CA7\u8178\u81DF\u81E7\u838A\u846C\u8523\u8594\u85CF\u88DD\u8D13\u91AC\u9577"],["eea1","\u969C\u518D\u54C9\u5728\u5BB0\u624D\u6750\u683D\u6893\u6E3D\u6ED3\u707D\u7E21\u88C1\u8CA1\u8F09\u9F4B\u9F4E\u722D\u7B8F\u8ACD\u931A\u4F47\u4F4E\u5132\u5480\u59D0\u5E95\u62B5\u6775\u696E\u6A17\u6CAE\u6E1A\u72D9\u732A\u75BD\u7BB8\u7D35\u82E7\u83F9\u8457\u85F7\u8A5B\u8CAF\u8E87\u9019\u90B8\u96CE\u9F5F\u52E3\u540A\u5AE1\u5BC2\u6458\u6575\u6EF4\u72C4\uF9FB\u7684\u7A4D\u7B1B\u7C4D\u7E3E\u7FDF\u837B\u8B2B\u8CCA\u8D64\u8DE1\u8E5F\u8FEA\u8FF9\u9069\u93D1\u4F43\u4F7A\u50B3\u5168\u5178\u524D\u526A\u5861\u587C\u5960\u5C08\u5C55\u5EDB\u609B\u6230\u6813\u6BBF\u6C08\u6FB1"],["efa1","\u714E\u7420\u7530\u7538\u7551\u7672\u7B4C\u7B8B\u7BAD\u7BC6\u7E8F\u8A6E\u8F3E\u8F49\u923F\u9293\u9322\u942B\u96FB\u985A\u986B\u991E\u5207\u622A\u6298\u6D59\u7664\u7ACA\u7BC0\u7D76\u5360\u5CBE\u5E97\u6F38\u70B9\u7C98\u9711\u9B8E\u9EDE\u63A5\u647A\u8776\u4E01\u4E95\u4EAD\u505C\u5075\u5448\u59C3\u5B9A\u5E40\u5EAD\u5EF7\u5F81\u60C5\u633A\u653F\u6574\u65CC\u6676\u6678\u67FE\u6968\u6A89\u6B63\u6C40\u6DC0\u6DE8\u6E1F\u6E5E\u701E\u70A1\u738E\u73FD\u753A\u775B\u7887\u798E\u7A0B\u7A7D\u7CBE\u7D8E\u8247\u8A02\u8AEA\u8C9E\u912D\u914A\u91D8\u9266\u92CC\u9320\u9706\u9756"],["f0a1","\u975C\u9802\u9F0E\u5236\u5291\u557C\u5824\u5E1D\u5F1F\u608C\u63D0\u68AF\u6FDF\u796D\u7B2C\u81CD\u85BA\u88FD\u8AF8\u8E44\u918D\u9664\u969B\u973D\u984C\u9F4A\u4FCE\u5146\u51CB\u52A9\u5632\u5F14\u5F6B\u63AA\u64CD\u65E9\u6641\u66FA\u66F9\u671D\u689D\u68D7\u69FD\u6F15\u6F6E\u7167\u71E5\u722A\u74AA\u773A\u7956\u795A\u79DF\u7A20\u7A95\u7C97\u7CDF\u7D44\u7E70\u8087\u85FB\u86A4\u8A54\u8ABF\u8D99\u8E81\u9020\u906D\u91E3\u963B\u96D5\u9CE5\u65CF\u7C07\u8DB3\u93C3\u5B58\u5C0A\u5352\u62D9\u731D\u5027\u5B97\u5F9E\u60B0\u616B\u68D5\u6DD9\u742E\u7A2E\u7D42\u7D9C\u7E31\u816B"],["f1a1","\u8E2A\u8E35\u937E\u9418\u4F50\u5750\u5DE6\u5EA7\u632B\u7F6A\u4E3B\u4F4F\u4F8F\u505A\u59DD\u80C4\u546A\u5468\u55FE\u594F\u5B99\u5DDE\u5EDA\u665D\u6731\u67F1\u682A\u6CE8\u6D32\u6E4A\u6F8D\u70B7\u73E0\u7587\u7C4C\u7D02\u7D2C\u7DA2\u821F\u86DB\u8A3B\u8A85\u8D70\u8E8A\u8F33\u9031\u914E\u9152\u9444\u99D0\u7AF9\u7CA5\u4FCA\u5101\u51C6\u57C8\u5BEF\u5CFB\u6659\u6A3D\u6D5A\u6E96\u6FEC\u710C\u756F\u7AE3\u8822\u9021\u9075\u96CB\u99FF\u8301\u4E2D\u4EF2\u8846\u91CD\u537D\u6ADB\u696B\u6C41\u847A\u589E\u618E\u66FE\u62EF\u70DD\u7511\u75C7\u7E52\u84B8\u8B49\u8D08\u4E4B\u53EA"],["f2a1","\u54AB\u5730\u5740\u5FD7\u6301\u6307\u646F\u652F\u65E8\u667A\u679D\u67B3\u6B62\u6C60\u6C9A\u6F2C\u77E5\u7825\u7949\u7957\u7D19\u80A2\u8102\u81F3\u829D\u82B7\u8718\u8A8C\uF9FC\u8D04\u8DBE\u9072\u76F4\u7A19\u7A37\u7E54\u8077\u5507\u55D4\u5875\u632F\u6422\u6649\u664B\u686D\u699B\u6B84\u6D25\u6EB1\u73CD\u7468\u74A1\u755B\u75B9\u76E1\u771E\u778B\u79E6\u7E09\u7E1D\u81FB\u852F\u8897\u8A3A\u8CD1\u8EEB\u8FB0\u9032\u93AD\u9663\u9673\u9707\u4F84\u53F1\u59EA\u5AC9\u5E19\u684E\u74C6\u75BE\u79E9\u7A92\u81A3\u86ED\u8CEA\u8DCC\u8FED\u659F\u6715\uF9FD\u57F7\u6F57\u7DDD\u8F2F"],["f3a1","\u93F6\u96C6\u5FB5\u61F2\u6F84\u4E14\u4F98\u501F\u53C9\u55DF\u5D6F\u5DEE\u6B21\u6B64\u78CB\u7B9A\uF9FE\u8E49\u8ECA\u906E\u6349\u643E\u7740\u7A84\u932F\u947F\u9F6A\u64B0\u6FAF\u71E6\u74A8\u74DA\u7AC4\u7C12\u7E82\u7CB2\u7E98\u8B9A\u8D0A\u947D\u9910\u994C\u5239\u5BDF\u64E6\u672D\u7D2E\u50ED\u53C3\u5879\u6158\u6159\u61FA\u65AC\u7AD9\u8B92\u8B96\u5009\u5021\u5275\u5531\u5A3C\u5EE0\u5F70\u6134\u655E\u660C\u6636\u66A2\u69CD\u6EC4\u6F32\u7316\u7621\u7A93\u8139\u8259\u83D6\u84BC\u50B5\u57F0\u5BC0\u5BE8\u5F69\u63A1\u7826\u7DB5\u83DC\u8521\u91C7\u91F5\u518A\u67F5\u7B56"],["f4a1","\u8CAC\u51C4\u59BB\u60BD\u8655\u501C\uF9FF\u5254\u5C3A\u617D\u621A\u62D3\u64F2\u65A5\u6ECC\u7620\u810A\u8E60\u965F\u96BB\u4EDF\u5343\u5598\u5929\u5DDD\u64C5\u6CC9\u6DFA\u7394\u7A7F\u821B\u85A6\u8CE4\u8E10\u9077\u91E7\u95E1\u9621\u97C6\u51F8\u54F2\u5586\u5FB9\u64A4\u6F88\u7DB4\u8F1F\u8F4D\u9435\u50C9\u5C16\u6CBE\u6DFB\u751B\u77BB\u7C3D\u7C64\u8A79\u8AC2\u581E\u59BE\u5E16\u6377\u7252\u758A\u776B\u8ADC\u8CBC\u8F12\u5EF3\u6674\u6DF8\u807D\u83C1\u8ACB\u9751\u9BD6\uFA00\u5243\u66FF\u6D95\u6EEF\u7DE0\u8AE6\u902E\u905E\u9AD4\u521D\u527F\u54E8\u6194\u6284\u62DB\u68A2"],["f5a1","\u6912\u695A\u6A35\u7092\u7126\u785D\u7901\u790E\u79D2\u7A0D\u8096\u8278\u82D5\u8349\u8549\u8C82\u8D85\u9162\u918B\u91AE\u4FC3\u56D1\u71ED\u77D7\u8700\u89F8\u5BF8\u5FD6\u6751\u90A8\u53E2\u585A\u5BF5\u60A4\u6181\u6460\u7E3D\u8070\u8525\u9283\u64AE\u50AC\u5D14\u6700\u589C\u62BD\u63A8\u690E\u6978\u6A1E\u6E6B\u76BA\u79CB\u82BB\u8429\u8ACF\u8DA8\u8FFD\u9112\u914B\u919C\u9310\u9318\u939A\u96DB\u9A36\u9C0D\u4E11\u755C\u795D\u7AFA\u7B51\u7BC9\u7E2E\u84C4\u8E59\u8E74\u8EF8\u9010\u6625\u693F\u7443\u51FA\u672E\u9EDC\u5145\u5FE0\u6C96\u87F2\u885D\u8877\u60B4\u81B5\u8403"],["f6a1","\u8D05\u53D6\u5439\u5634\u5A36\u5C31\u708A\u7FE0\u805A\u8106\u81ED\u8DA3\u9189\u9A5F\u9DF2\u5074\u4EC4\u53A0\u60FB\u6E2C\u5C64\u4F88\u5024\u55E4\u5CD9\u5E5F\u6065\u6894\u6CBB\u6DC4\u71BE\u75D4\u75F4\u7661\u7A1A\u7A49\u7DC7\u7DFB\u7F6E\u81F4\u86A9\u8F1C\u96C9\u99B3\u9F52\u5247\u52C5\u98ED\u89AA\u4E03\u67D2\u6F06\u4FB5\u5BE2\u6795\u6C88\u6D78\u741B\u7827\u91DD\u937C\u87C4\u79E4\u7A31\u5FEB\u4ED6\u54A4\u553E\u58AE\u59A5\u60F0\u6253\u62D6\u6736\u6955\u8235\u9640\u99B1\u99DD\u502C\u5353\u5544\u577C\uFA01\u6258\uFA02\u64E2\u666B\u67DD\u6FC1\u6FEF\u7422\u7438\u8A17"],["f7a1","\u9438\u5451\u5606\u5766\u5F48\u619A\u6B4E\u7058\u70AD\u7DBB\u8A95\u596A\u812B\u63A2\u7708\u803D\u8CAA\u5854\u642D\u69BB\u5B95\u5E11\u6E6F\uFA03\u8569\u514C\u53F0\u592A\u6020\u614B\u6B86\u6C70\u6CF0\u7B1E\u80CE\u82D4\u8DC6\u90B0\u98B1\uFA04\u64C7\u6FA4\u6491\u6504\u514E\u5410\u571F\u8A0E\u615F\u6876\uFA05\u75DB\u7B52\u7D71\u901A\u5806\u69CC\u817F\u892A\u9000\u9839\u5078\u5957\u59AC\u6295\u900F\u9B2A\u615D\u7279\u95D6\u5761\u5A46\u5DF4\u628A\u64AD\u64FA\u6777\u6CE2\u6D3E\u722C\u7436\u7834\u7F77\u82AD\u8DDB\u9817\u5224\u5742\u677F\u7248\u74E3\u8CA9\u8FA6\u9211"],["f8a1","\u962A\u516B\u53ED\u634C\u4F69\u5504\u6096\u6557\u6C9B\u6D7F\u724C\u72FD\u7A17\u8987\u8C9D\u5F6D\u6F8E\u70F9\u81A8\u610E\u4FBF\u504F\u6241\u7247\u7BC7\u7DE8\u7FE9\u904D\u97AD\u9A19\u8CB6\u576A\u5E73\u67B0\u840D\u8A55\u5420\u5B16\u5E63\u5EE2\u5F0A\u6583\u80BA\u853D\u9589\u965B\u4F48\u5305\u530D\u530F\u5486\u54FA\u5703\u5E03\u6016\u629B\u62B1\u6355\uFA06\u6CE1\u6D66\u75B1\u7832\u80DE\u812F\u82DE\u8461\u84B2\u888D\u8912\u900B\u92EA\u98FD\u9B91\u5E45\u66B4\u66DD\u7011\u7206\uFA07\u4FF5\u527D\u5F6A\u6153\u6753\u6A19\u6F02\u74E2\u7968\u8868\u8C79\u98C7\u98C4\u9A43"],["f9a1","\u54C1\u7A1F\u6953\u8AF7\u8C4A\u98A8\u99AE\u5F7C\u62AB\u75B2\u76AE\u88AB\u907F\u9642\u5339\u5F3C\u5FC5\u6CCC\u73CC\u7562\u758B\u7B46\u82FE\u999D\u4E4F\u903C\u4E0B\u4F55\u53A6\u590F\u5EC8\u6630\u6CB3\u7455\u8377\u8766\u8CC0\u9050\u971E\u9C15\u58D1\u5B78\u8650\u8B14\u9DB4\u5BD2\u6068\u608D\u65F1\u6C57\u6F22\u6FA3\u701A\u7F55\u7FF0\u9591\u9592\u9650\u97D3\u5272\u8F44\u51FD\u542B\u54B8\u5563\u558A\u6ABB\u6DB5\u7DD8\u8266\u929C\u9677\u9E79\u5408\u54C8\u76D2\u86E4\u95A4\u95D4\u965C\u4EA2\u4F09\u59EE\u5AE6\u5DF7\u6052\u6297\u676D\u6841\u6C86\u6E2F\u7F38\u809B\u822A"],["faa1","\uFA08\uFA09\u9805\u4EA5\u5055\u54B3\u5793\u595A\u5B69\u5BB3\u61C8\u6977\u6D77\u7023\u87F9\u89E3\u8A72\u8AE7\u9082\u99ED\u9AB8\u52BE\u6838\u5016\u5E78\u674F\u8347\u884C\u4EAB\u5411\u56AE\u73E6\u9115\u97FF\u9909\u9957\u9999\u5653\u589F\u865B\u8A31\u61B2\u6AF6\u737B\u8ED2\u6B47\u96AA\u9A57\u5955\u7200\u8D6B\u9769\u4FD4\u5CF4\u5F26\u61F8\u665B\u6CEB\u70AB\u7384\u73B9\u73FE\u7729\u774D\u7D43\u7D62\u7E23\u8237\u8852\uFA0A\u8CE2\u9249\u986F\u5B51\u7A74\u8840\u9801\u5ACC\u4FE0\u5354\u593E\u5CFD\u633E\u6D79\u72F9\u8105\u8107\u83A2\u92CF\u9830\u4EA8\u5144\u5211\u578B"],["fba1","\u5F62\u6CC2\u6ECE\u7005\u7050\u70AF\u7192\u73E9\u7469\u834A\u87A2\u8861\u9008\u90A2\u93A3\u99A8\u516E\u5F57\u60E0\u6167\u66B3\u8559\u8E4A\u91AF\u978B\u4E4E\u4E92\u547C\u58D5\u58FA\u597D\u5CB5\u5F27\u6236\u6248\u660A\u6667\u6BEB\u6D69\u6DCF\u6E56\u6EF8\u6F94\u6FE0\u6FE9\u705D\u72D0\u7425\u745A\u74E0\u7693\u795C\u7CCA\u7E1E\u80E1\u82A6\u846B\u84BF\u864E\u865F\u8774\u8B77\u8C6A\u93AC\u9800\u9865\u60D1\u6216\u9177\u5A5A\u660F\u6DF7\u6E3E\u743F\u9B42\u5FFD\u60DA\u7B0F\u54C4\u5F18\u6C5E\u6CD3\u6D2A\u70D8\u7D05\u8679\u8A0C\u9D3B\u5316\u548C\u5B05\u6A3A\u706B\u7575"],["fca1","\u798D\u79BE\u82B1\u83EF\u8A71\u8B41\u8CA8\u9774\uFA0B\u64F4\u652B\u78BA\u78BB\u7A6B\u4E38\u559A\u5950\u5BA6\u5E7B\u60A3\u63DB\u6B61\u6665\u6853\u6E19\u7165\u74B0\u7D08\u9084\u9A69\u9C25\u6D3B\u6ED1\u733E\u8C41\u95CA\u51F0\u5E4C\u5FA8\u604D\u60F6\u6130\u614C\u6643\u6644\u69A5\u6CC1\u6E5F\u6EC9\u6F62\u714C\u749C\u7687\u7BC1\u7C27\u8352\u8757\u9051\u968D\u9EC3\u532F\u56DE\u5EFB\u5F8A\u6062\u6094\u61F7\u6666\u6703\u6A9C\u6DEE\u6FAE\u7070\u736A\u7E6A\u81BE\u8334\u86D4\u8AA8\u8CC4\u5283\u7372\u5B96\u6A6B\u9404\u54EE\u5686\u5B5D\u6548\u6585\u66C9\u689F\u6D8D\u6DC6"],["fda1","\u723B\u80B4\u9175\u9A4D\u4FAF\u5019\u539A\u540E\u543C\u5589\u55C5\u5E3F\u5F8C\u673D\u7166\u73DD\u9005\u52DB\u52F3\u5864\u58CE\u7104\u718F\u71FB\u85B0\u8A13\u6688\u85A8\u55A7\u6684\u714A\u8431\u5349\u5599\u6BC1\u5F59\u5FBD\u63EE\u6689\u7147\u8AF1\u8F1D\u9EBE\u4F11\u643A\u70CB\u7566\u8667\u6064\u8B4E\u9DF8\u5147\u51F6\u5308\u6D36\u80F8\u9ED1\u6615\u6B23\u7098\u75D5\u5403\u5C79\u7D07\u8A16\u6B20\u6B3D\u6B46\u5438\u6070\u6D3D\u7FD5\u8208\u50D6\u51DE\u559C\u566B\u56CD\u59EC\u5B09\u5E0C\u6199\u6198\u6231\u665E\u66E6\u7199\u71B9\u71BA\u72A7\u79A7\u7A00\u7FB2\u8A70"]]});var pv=H((Tle,FG)=>{FG.exports=[["0","\0",127],["a140","\u3000\uFF0C\u3001\u3002\uFF0E\u2027\uFF1B\uFF1A\uFF1F\uFF01\uFE30\u2026\u2025\uFE50\uFE51\uFE52\xB7\uFE54\uFE55\uFE56\uFE57\uFF5C\u2013\uFE31\u2014\uFE33\u2574\uFE34\uFE4F\uFF08\uFF09\uFE35\uFE36\uFF5B\uFF5D\uFE37\uFE38\u3014\u3015\uFE39\uFE3A\u3010\u3011\uFE3B\uFE3C\u300A\u300B\uFE3D\uFE3E\u3008\u3009\uFE3F\uFE40\u300C\u300D\uFE41\uFE42\u300E\u300F\uFE43\uFE44\uFE59\uFE5A"],["a1a1","\uFE5B\uFE5C\uFE5D\uFE5E\u2018\u2019\u201C\u201D\u301D\u301E\u2035\u2032\uFF03\uFF06\uFF0A\u203B\xA7\u3003\u25CB\u25CF\u25B3\u25B2\u25CE\u2606\u2605\u25C7\u25C6\u25A1\u25A0\u25BD\u25BC\u32A3\u2105\xAF\uFFE3\uFF3F\u02CD\uFE49\uFE4A\uFE4D\uFE4E\uFE4B\uFE4C\uFE5F\uFE60\uFE61\uFF0B\uFF0D\xD7\xF7\xB1\u221A\uFF1C\uFF1E\uFF1D\u2266\u2267\u2260\u221E\u2252\u2261\uFE62",4,"\uFF5E\u2229\u222A\u22A5\u2220\u221F\u22BF\u33D2\u33D1\u222B\u222E\u2235\u2234\u2640\u2642\u2295\u2299\u2191\u2193\u2190\u2192\u2196\u2197\u2199\u2198\u2225\u2223\uFF0F"],["a240","\uFF3C\u2215\uFE68\uFF04\uFFE5\u3012\uFFE0\uFFE1\uFF05\uFF20\u2103\u2109\uFE69\uFE6A\uFE6B\u33D5\u339C\u339D\u339E\u33CE\u33A1\u338E\u338F\u33C4\xB0\u5159\u515B\u515E\u515D\u5161\u5163\u55E7\u74E9\u7CCE\u2581",7,"\u258F\u258E\u258D\u258C\u258B\u258A\u2589\u253C\u2534\u252C\u2524\u251C\u2594\u2500\u2502\u2595\u250C\u2510\u2514\u2518\u256D"],["a2a1","\u256E\u2570\u256F\u2550\u255E\u256A\u2561\u25E2\u25E3\u25E5\u25E4\u2571\u2572\u2573\uFF10",9,"\u2160",9,"\u3021",8,"\u5341\u5344\u5345\uFF21",25,"\uFF41",21],["a340","\uFF57\uFF58\uFF59\uFF5A\u0391",16,"\u03A3",6,"\u03B1",16,"\u03C3",6,"\u3105",10],["a3a1","\u3110",25,"\u02D9\u02C9\u02CA\u02C7\u02CB"],["a3e1","\u20AC"],["a440","\u4E00\u4E59\u4E01\u4E03\u4E43\u4E5D\u4E86\u4E8C\u4EBA\u513F\u5165\u516B\u51E0\u5200\u5201\u529B\u5315\u5341\u535C\u53C8\u4E09\u4E0B\u4E08\u4E0A\u4E2B\u4E38\u51E1\u4E45\u4E48\u4E5F\u4E5E\u4E8E\u4EA1\u5140\u5203\u52FA\u5343\u53C9\u53E3\u571F\u58EB\u5915\u5927\u5973\u5B50\u5B51\u5B53\u5BF8\u5C0F\u5C22\u5C38\u5C71\u5DDD\u5DE5\u5DF1\u5DF2\u5DF3\u5DFE\u5E72\u5EFE\u5F0B\u5F13\u624D"],["a4a1","\u4E11\u4E10\u4E0D\u4E2D\u4E30\u4E39\u4E4B\u5C39\u4E88\u4E91\u4E95\u4E92\u4E94\u4EA2\u4EC1\u4EC0\u4EC3\u4EC6\u4EC7\u4ECD\u4ECA\u4ECB\u4EC4\u5143\u5141\u5167\u516D\u516E\u516C\u5197\u51F6\u5206\u5207\u5208\u52FB\u52FE\u52FF\u5316\u5339\u5348\u5347\u5345\u535E\u5384\u53CB\u53CA\u53CD\u58EC\u5929\u592B\u592A\u592D\u5B54\u5C11\u5C24\u5C3A\u5C6F\u5DF4\u5E7B\u5EFF\u5F14\u5F15\u5FC3\u6208\u6236\u624B\u624E\u652F\u6587\u6597\u65A4\u65B9\u65E5\u66F0\u6708\u6728\u6B20\u6B62\u6B79\u6BCB\u6BD4\u6BDB\u6C0F\u6C34\u706B\u722A\u7236\u723B\u7247\u7259\u725B\u72AC\u738B\u4E19"],["a540","\u4E16\u4E15\u4E14\u4E18\u4E3B\u4E4D\u4E4F\u4E4E\u4EE5\u4ED8\u4ED4\u4ED5\u4ED6\u4ED7\u4EE3\u4EE4\u4ED9\u4EDE\u5145\u5144\u5189\u518A\u51AC\u51F9\u51FA\u51F8\u520A\u52A0\u529F\u5305\u5306\u5317\u531D\u4EDF\u534A\u5349\u5361\u5360\u536F\u536E\u53BB\u53EF\u53E4\u53F3\u53EC\u53EE\u53E9\u53E8\u53FC\u53F8\u53F5\u53EB\u53E6\u53EA\u53F2\u53F1\u53F0\u53E5\u53ED\u53FB\u56DB\u56DA\u5916"],["a5a1","\u592E\u5931\u5974\u5976\u5B55\u5B83\u5C3C\u5DE8\u5DE7\u5DE6\u5E02\u5E03\u5E73\u5E7C\u5F01\u5F18\u5F17\u5FC5\u620A\u6253\u6254\u6252\u6251\u65A5\u65E6\u672E\u672C\u672A\u672B\u672D\u6B63\u6BCD\u6C11\u6C10\u6C38\u6C41\u6C40\u6C3E\u72AF\u7384\u7389\u74DC\u74E6\u7518\u751F\u7528\u7529\u7530\u7531\u7532\u7533\u758B\u767D\u76AE\u76BF\u76EE\u77DB\u77E2\u77F3\u793A\u79BE\u7A74\u7ACB\u4E1E\u4E1F\u4E52\u4E53\u4E69\u4E99\u4EA4\u4EA6\u4EA5\u4EFF\u4F09\u4F19\u4F0A\u4F15\u4F0D\u4F10\u4F11\u4F0F\u4EF2\u4EF6\u4EFB\u4EF0\u4EF3\u4EFD\u4F01\u4F0B\u5149\u5147\u5146\u5148\u5168"],["a640","\u5171\u518D\u51B0\u5217\u5211\u5212\u520E\u5216\u52A3\u5308\u5321\u5320\u5370\u5371\u5409\u540F\u540C\u540A\u5410\u5401\u540B\u5404\u5411\u540D\u5408\u5403\u540E\u5406\u5412\u56E0\u56DE\u56DD\u5733\u5730\u5728\u572D\u572C\u572F\u5729\u5919\u591A\u5937\u5938\u5984\u5978\u5983\u597D\u5979\u5982\u5981\u5B57\u5B58\u5B87\u5B88\u5B85\u5B89\u5BFA\u5C16\u5C79\u5DDE\u5E06\u5E76\u5E74"],["a6a1","\u5F0F\u5F1B\u5FD9\u5FD6\u620E\u620C\u620D\u6210\u6263\u625B\u6258\u6536\u65E9\u65E8\u65EC\u65ED\u66F2\u66F3\u6709\u673D\u6734\u6731\u6735\u6B21\u6B64\u6B7B\u6C16\u6C5D\u6C57\u6C59\u6C5F\u6C60\u6C50\u6C55\u6C61\u6C5B\u6C4D\u6C4E\u7070\u725F\u725D\u767E\u7AF9\u7C73\u7CF8\u7F36\u7F8A\u7FBD\u8001\u8003\u800C\u8012\u8033\u807F\u8089\u808B\u808C\u81E3\u81EA\u81F3\u81FC\u820C\u821B\u821F\u826E\u8272\u827E\u866B\u8840\u884C\u8863\u897F\u9621\u4E32\u4EA8\u4F4D\u4F4F\u4F47\u4F57\u4F5E\u4F34\u4F5B\u4F55\u4F30\u4F50\u4F51\u4F3D\u4F3A\u4F38\u4F43\u4F54\u4F3C\u4F46\u4F63"],["a740","\u4F5C\u4F60\u4F2F\u4F4E\u4F36\u4F59\u4F5D\u4F48\u4F5A\u514C\u514B\u514D\u5175\u51B6\u51B7\u5225\u5224\u5229\u522A\u5228\u52AB\u52A9\u52AA\u52AC\u5323\u5373\u5375\u541D\u542D\u541E\u543E\u5426\u544E\u5427\u5446\u5443\u5433\u5448\u5442\u541B\u5429\u544A\u5439\u543B\u5438\u542E\u5435\u5436\u5420\u543C\u5440\u5431\u542B\u541F\u542C\u56EA\u56F0\u56E4\u56EB\u574A\u5751\u5740\u574D"],["a7a1","\u5747\u574E\u573E\u5750\u574F\u573B\u58EF\u593E\u599D\u5992\u59A8\u599E\u59A3\u5999\u5996\u598D\u59A4\u5993\u598A\u59A5\u5B5D\u5B5C\u5B5A\u5B5B\u5B8C\u5B8B\u5B8F\u5C2C\u5C40\u5C41\u5C3F\u5C3E\u5C90\u5C91\u5C94\u5C8C\u5DEB\u5E0C\u5E8F\u5E87\u5E8A\u5EF7\u5F04\u5F1F\u5F64\u5F62\u5F77\u5F79\u5FD8\u5FCC\u5FD7\u5FCD\u5FF1\u5FEB\u5FF8\u5FEA\u6212\u6211\u6284\u6297\u6296\u6280\u6276\u6289\u626D\u628A\u627C\u627E\u6279\u6273\u6292\u626F\u6298\u626E\u6295\u6293\u6291\u6286\u6539\u653B\u6538\u65F1\u66F4\u675F\u674E\u674F\u6750\u6751\u675C\u6756\u675E\u6749\u6746\u6760"],["a840","\u6753\u6757\u6B65\u6BCF\u6C42\u6C5E\u6C99\u6C81\u6C88\u6C89\u6C85\u6C9B\u6C6A\u6C7A\u6C90\u6C70\u6C8C\u6C68\u6C96\u6C92\u6C7D\u6C83\u6C72\u6C7E\u6C74\u6C86\u6C76\u6C8D\u6C94\u6C98\u6C82\u7076\u707C\u707D\u7078\u7262\u7261\u7260\u72C4\u72C2\u7396\u752C\u752B\u7537\u7538\u7682\u76EF\u77E3\u79C1\u79C0\u79BF\u7A76\u7CFB\u7F55\u8096\u8093\u809D\u8098\u809B\u809A\u80B2\u826F\u8292"],["a8a1","\u828B\u828D\u898B\u89D2\u8A00\u8C37\u8C46\u8C55\u8C9D\u8D64\u8D70\u8DB3\u8EAB\u8ECA\u8F9B\u8FB0\u8FC2\u8FC6\u8FC5\u8FC4\u5DE1\u9091\u90A2\u90AA\u90A6\u90A3\u9149\u91C6\u91CC\u9632\u962E\u9631\u962A\u962C\u4E26\u4E56\u4E73\u4E8B\u4E9B\u4E9E\u4EAB\u4EAC\u4F6F\u4F9D\u4F8D\u4F73\u4F7F\u4F6C\u4F9B\u4F8B\u4F86\u4F83\u4F70\u4F75\u4F88\u4F69\u4F7B\u4F96\u4F7E\u4F8F\u4F91\u4F7A\u5154\u5152\u5155\u5169\u5177\u5176\u5178\u51BD\u51FD\u523B\u5238\u5237\u523A\u5230\u522E\u5236\u5241\u52BE\u52BB\u5352\u5354\u5353\u5351\u5366\u5377\u5378\u5379\u53D6\u53D4\u53D7\u5473\u5475"],["a940","\u5496\u5478\u5495\u5480\u547B\u5477\u5484\u5492\u5486\u547C\u5490\u5471\u5476\u548C\u549A\u5462\u5468\u548B\u547D\u548E\u56FA\u5783\u5777\u576A\u5769\u5761\u5766\u5764\u577C\u591C\u5949\u5947\u5948\u5944\u5954\u59BE\u59BB\u59D4\u59B9\u59AE\u59D1\u59C6\u59D0\u59CD\u59CB\u59D3\u59CA\u59AF\u59B3\u59D2\u59C5\u5B5F\u5B64\u5B63\u5B97\u5B9A\u5B98\u5B9C\u5B99\u5B9B\u5C1A\u5C48\u5C45"],["a9a1","\u5C46\u5CB7\u5CA1\u5CB8\u5CA9\u5CAB\u5CB1\u5CB3\u5E18\u5E1A\u5E16\u5E15\u5E1B\u5E11\u5E78\u5E9A\u5E97\u5E9C\u5E95\u5E96\u5EF6\u5F26\u5F27\u5F29\u5F80\u5F81\u5F7F\u5F7C\u5FDD\u5FE0\u5FFD\u5FF5\u5FFF\u600F\u6014\u602F\u6035\u6016\u602A\u6015\u6021\u6027\u6029\u602B\u601B\u6216\u6215\u623F\u623E\u6240\u627F\u62C9\u62CC\u62C4\u62BF\u62C2\u62B9\u62D2\u62DB\u62AB\u62D3\u62D4\u62CB\u62C8\u62A8\u62BD\u62BC\u62D0\u62D9\u62C7\u62CD\u62B5\u62DA\u62B1\u62D8\u62D6\u62D7\u62C6\u62AC\u62CE\u653E\u65A7\u65BC\u65FA\u6614\u6613\u660C\u6606\u6602\u660E\u6600\u660F\u6615\u660A"],["aa40","\u6607\u670D\u670B\u676D\u678B\u6795\u6771\u679C\u6773\u6777\u6787\u679D\u6797\u676F\u6770\u677F\u6789\u677E\u6790\u6775\u679A\u6793\u677C\u676A\u6772\u6B23\u6B66\u6B67\u6B7F\u6C13\u6C1B\u6CE3\u6CE8\u6CF3\u6CB1\u6CCC\u6CE5\u6CB3\u6CBD\u6CBE\u6CBC\u6CE2\u6CAB\u6CD5\u6CD3\u6CB8\u6CC4\u6CB9\u6CC1\u6CAE\u6CD7\u6CC5\u6CF1\u6CBF\u6CBB\u6CE1\u6CDB\u6CCA\u6CAC\u6CEF\u6CDC\u6CD6\u6CE0"],["aaa1","\u7095\u708E\u7092\u708A\u7099\u722C\u722D\u7238\u7248\u7267\u7269\u72C0\u72CE\u72D9\u72D7\u72D0\u73A9\u73A8\u739F\u73AB\u73A5\u753D\u759D\u7599\u759A\u7684\u76C2\u76F2\u76F4\u77E5\u77FD\u793E\u7940\u7941\u79C9\u79C8\u7A7A\u7A79\u7AFA\u7CFE\u7F54\u7F8C\u7F8B\u8005\u80BA\u80A5\u80A2\u80B1\u80A1\u80AB\u80A9\u80B4\u80AA\u80AF\u81E5\u81FE\u820D\u82B3\u829D\u8299\u82AD\u82BD\u829F\u82B9\u82B1\u82AC\u82A5\u82AF\u82B8\u82A3\u82B0\u82BE\u82B7\u864E\u8671\u521D\u8868\u8ECB\u8FCE\u8FD4\u8FD1\u90B5\u90B8\u90B1\u90B6\u91C7\u91D1\u9577\u9580\u961C\u9640\u963F\u963B\u9644"],["ab40","\u9642\u96B9\u96E8\u9752\u975E\u4E9F\u4EAD\u4EAE\u4FE1\u4FB5\u4FAF\u4FBF\u4FE0\u4FD1\u4FCF\u4FDD\u4FC3\u4FB6\u4FD8\u4FDF\u4FCA\u4FD7\u4FAE\u4FD0\u4FC4\u4FC2\u4FDA\u4FCE\u4FDE\u4FB7\u5157\u5192\u5191\u51A0\u524E\u5243\u524A\u524D\u524C\u524B\u5247\u52C7\u52C9\u52C3\u52C1\u530D\u5357\u537B\u539A\u53DB\u54AC\u54C0\u54A8\u54CE\u54C9\u54B8\u54A6\u54B3\u54C7\u54C2\u54BD\u54AA\u54C1"],["aba1","\u54C4\u54C8\u54AF\u54AB\u54B1\u54BB\u54A9\u54A7\u54BF\u56FF\u5782\u578B\u57A0\u57A3\u57A2\u57CE\u57AE\u5793\u5955\u5951\u594F\u594E\u5950\u59DC\u59D8\u59FF\u59E3\u59E8\u5A03\u59E5\u59EA\u59DA\u59E6\u5A01\u59FB\u5B69\u5BA3\u5BA6\u5BA4\u5BA2\u5BA5\u5C01\u5C4E\u5C4F\u5C4D\u5C4B\u5CD9\u5CD2\u5DF7\u5E1D\u5E25\u5E1F\u5E7D\u5EA0\u5EA6\u5EFA\u5F08\u5F2D\u5F65\u5F88\u5F85\u5F8A\u5F8B\u5F87\u5F8C\u5F89\u6012\u601D\u6020\u6025\u600E\u6028\u604D\u6070\u6068\u6062\u6046\u6043\u606C\u606B\u606A\u6064\u6241\u62DC\u6316\u6309\u62FC\u62ED\u6301\u62EE\u62FD\u6307\u62F1\u62F7"],["ac40","\u62EF\u62EC\u62FE\u62F4\u6311\u6302\u653F\u6545\u65AB\u65BD\u65E2\u6625\u662D\u6620\u6627\u662F\u661F\u6628\u6631\u6624\u66F7\u67FF\u67D3\u67F1\u67D4\u67D0\u67EC\u67B6\u67AF\u67F5\u67E9\u67EF\u67C4\u67D1\u67B4\u67DA\u67E5\u67B8\u67CF\u67DE\u67F3\u67B0\u67D9\u67E2\u67DD\u67D2\u6B6A\u6B83\u6B86\u6BB5\u6BD2\u6BD7\u6C1F\u6CC9\u6D0B\u6D32\u6D2A\u6D41\u6D25\u6D0C\u6D31\u6D1E\u6D17"],["aca1","\u6D3B\u6D3D\u6D3E\u6D36\u6D1B\u6CF5\u6D39\u6D27\u6D38\u6D29\u6D2E\u6D35\u6D0E\u6D2B\u70AB\u70BA\u70B3\u70AC\u70AF\u70AD\u70B8\u70AE\u70A4\u7230\u7272\u726F\u7274\u72E9\u72E0\u72E1\u73B7\u73CA\u73BB\u73B2\u73CD\u73C0\u73B3\u751A\u752D\u754F\u754C\u754E\u754B\u75AB\u75A4\u75A5\u75A2\u75A3\u7678\u7686\u7687\u7688\u76C8\u76C6\u76C3\u76C5\u7701\u76F9\u76F8\u7709\u770B\u76FE\u76FC\u7707\u77DC\u7802\u7814\u780C\u780D\u7946\u7949\u7948\u7947\u79B9\u79BA\u79D1\u79D2\u79CB\u7A7F\u7A81\u7AFF\u7AFD\u7C7D\u7D02\u7D05\u7D00\u7D09\u7D07\u7D04\u7D06\u7F38\u7F8E\u7FBF\u8004"],["ad40","\u8010\u800D\u8011\u8036\u80D6\u80E5\u80DA\u80C3\u80C4\u80CC\u80E1\u80DB\u80CE\u80DE\u80E4\u80DD\u81F4\u8222\u82E7\u8303\u8305\u82E3\u82DB\u82E6\u8304\u82E5\u8302\u8309\u82D2\u82D7\u82F1\u8301\u82DC\u82D4\u82D1\u82DE\u82D3\u82DF\u82EF\u8306\u8650\u8679\u867B\u867A\u884D\u886B\u8981\u89D4\u8A08\u8A02\u8A03\u8C9E\u8CA0\u8D74\u8D73\u8DB4\u8ECD\u8ECC\u8FF0\u8FE6\u8FE2\u8FEA\u8FE5"],["ada1","\u8FED\u8FEB\u8FE4\u8FE8\u90CA\u90CE\u90C1\u90C3\u914B\u914A\u91CD\u9582\u9650\u964B\u964C\u964D\u9762\u9769\u97CB\u97ED\u97F3\u9801\u98A8\u98DB\u98DF\u9996\u9999\u4E58\u4EB3\u500C\u500D\u5023\u4FEF\u5026\u5025\u4FF8\u5029\u5016\u5006\u503C\u501F\u501A\u5012\u5011\u4FFA\u5000\u5014\u5028\u4FF1\u5021\u500B\u5019\u5018\u4FF3\u4FEE\u502D\u502A\u4FFE\u502B\u5009\u517C\u51A4\u51A5\u51A2\u51CD\u51CC\u51C6\u51CB\u5256\u525C\u5254\u525B\u525D\u532A\u537F\u539F\u539D\u53DF\u54E8\u5510\u5501\u5537\u54FC\u54E5\u54F2\u5506\u54FA\u5514\u54E9\u54ED\u54E1\u5509\u54EE\u54EA"],["ae40","\u54E6\u5527\u5507\u54FD\u550F\u5703\u5704\u57C2\u57D4\u57CB\u57C3\u5809\u590F\u5957\u5958\u595A\u5A11\u5A18\u5A1C\u5A1F\u5A1B\u5A13\u59EC\u5A20\u5A23\u5A29\u5A25\u5A0C\u5A09\u5B6B\u5C58\u5BB0\u5BB3\u5BB6\u5BB4\u5BAE\u5BB5\u5BB9\u5BB8\u5C04\u5C51\u5C55\u5C50\u5CED\u5CFD\u5CFB\u5CEA\u5CE8\u5CF0\u5CF6\u5D01\u5CF4\u5DEE\u5E2D\u5E2B\u5EAB\u5EAD\u5EA7\u5F31\u5F92\u5F91\u5F90\u6059"],["aea1","\u6063\u6065\u6050\u6055\u606D\u6069\u606F\u6084\u609F\u609A\u608D\u6094\u608C\u6085\u6096\u6247\u62F3\u6308\u62FF\u634E\u633E\u632F\u6355\u6342\u6346\u634F\u6349\u633A\u6350\u633D\u632A\u632B\u6328\u634D\u634C\u6548\u6549\u6599\u65C1\u65C5\u6642\u6649\u664F\u6643\u6652\u664C\u6645\u6641\u66F8\u6714\u6715\u6717\u6821\u6838\u6848\u6846\u6853\u6839\u6842\u6854\u6829\u68B3\u6817\u684C\u6851\u683D\u67F4\u6850\u6840\u683C\u6843\u682A\u6845\u6813\u6818\u6841\u6B8A\u6B89\u6BB7\u6C23\u6C27\u6C28\u6C26\u6C24\u6CF0\u6D6A\u6D95\u6D88\u6D87\u6D66\u6D78\u6D77\u6D59\u6D93"],["af40","\u6D6C\u6D89\u6D6E\u6D5A\u6D74\u6D69\u6D8C\u6D8A\u6D79\u6D85\u6D65\u6D94\u70CA\u70D8\u70E4\u70D9\u70C8\u70CF\u7239\u7279\u72FC\u72F9\u72FD\u72F8\u72F7\u7386\u73ED\u7409\u73EE\u73E0\u73EA\u73DE\u7554\u755D\u755C\u755A\u7559\u75BE\u75C5\u75C7\u75B2\u75B3\u75BD\u75BC\u75B9\u75C2\u75B8\u768B\u76B0\u76CA\u76CD\u76CE\u7729\u771F\u7720\u7728\u77E9\u7830\u7827\u7838\u781D\u7834\u7837"],["afa1","\u7825\u782D\u7820\u781F\u7832\u7955\u7950\u7960\u795F\u7956\u795E\u795D\u7957\u795A\u79E4\u79E3\u79E7\u79DF\u79E6\u79E9\u79D8\u7A84\u7A88\u7AD9\u7B06\u7B11\u7C89\u7D21\u7D17\u7D0B\u7D0A\u7D20\u7D22\u7D14\u7D10\u7D15\u7D1A\u7D1C\u7D0D\u7D19\u7D1B\u7F3A\u7F5F\u7F94\u7FC5\u7FC1\u8006\u8018\u8015\u8019\u8017\u803D\u803F\u80F1\u8102\u80F0\u8105\u80ED\u80F4\u8106\u80F8\u80F3\u8108\u80FD\u810A\u80FC\u80EF\u81ED\u81EC\u8200\u8210\u822A\u822B\u8228\u822C\u82BB\u832B\u8352\u8354\u834A\u8338\u8350\u8349\u8335\u8334\u834F\u8332\u8339\u8336\u8317\u8340\u8331\u8328\u8343"],["b040","\u8654\u868A\u86AA\u8693\u86A4\u86A9\u868C\u86A3\u869C\u8870\u8877\u8881\u8882\u887D\u8879\u8A18\u8A10\u8A0E\u8A0C\u8A15\u8A0A\u8A17\u8A13\u8A16\u8A0F\u8A11\u8C48\u8C7A\u8C79\u8CA1\u8CA2\u8D77\u8EAC\u8ED2\u8ED4\u8ECF\u8FB1\u9001\u9006\u8FF7\u9000\u8FFA\u8FF4\u9003\u8FFD\u9005\u8FF8\u9095\u90E1\u90DD\u90E2\u9152\u914D\u914C\u91D8\u91DD\u91D7\u91DC\u91D9\u9583\u9662\u9663\u9661"],["b0a1","\u965B\u965D\u9664\u9658\u965E\u96BB\u98E2\u99AC\u9AA8\u9AD8\u9B25\u9B32\u9B3C\u4E7E\u507A\u507D\u505C\u5047\u5043\u504C\u505A\u5049\u5065\u5076\u504E\u5055\u5075\u5074\u5077\u504F\u500F\u506F\u506D\u515C\u5195\u51F0\u526A\u526F\u52D2\u52D9\u52D8\u52D5\u5310\u530F\u5319\u533F\u5340\u533E\u53C3\u66FC\u5546\u556A\u5566\u5544\u555E\u5561\u5543\u554A\u5531\u5556\u554F\u5555\u552F\u5564\u5538\u552E\u555C\u552C\u5563\u5533\u5541\u5557\u5708\u570B\u5709\u57DF\u5805\u580A\u5806\u57E0\u57E4\u57FA\u5802\u5835\u57F7\u57F9\u5920\u5962\u5A36\u5A41\u5A49\u5A66\u5A6A\u5A40"],["b140","\u5A3C\u5A62\u5A5A\u5A46\u5A4A\u5B70\u5BC7\u5BC5\u5BC4\u5BC2\u5BBF\u5BC6\u5C09\u5C08\u5C07\u5C60\u5C5C\u5C5D\u5D07\u5D06\u5D0E\u5D1B\u5D16\u5D22\u5D11\u5D29\u5D14\u5D19\u5D24\u5D27\u5D17\u5DE2\u5E38\u5E36\u5E33\u5E37\u5EB7\u5EB8\u5EB6\u5EB5\u5EBE\u5F35\u5F37\u5F57\u5F6C\u5F69\u5F6B\u5F97\u5F99\u5F9E\u5F98\u5FA1\u5FA0\u5F9C\u607F\u60A3\u6089\u60A0\u60A8\u60CB\u60B4\u60E6\u60BD"],["b1a1","\u60C5\u60BB\u60B5\u60DC\u60BC\u60D8\u60D5\u60C6\u60DF\u60B8\u60DA\u60C7\u621A\u621B\u6248\u63A0\u63A7\u6372\u6396\u63A2\u63A5\u6377\u6367\u6398\u63AA\u6371\u63A9\u6389\u6383\u639B\u636B\u63A8\u6384\u6388\u6399\u63A1\u63AC\u6392\u638F\u6380\u637B\u6369\u6368\u637A\u655D\u6556\u6551\u6559\u6557\u555F\u654F\u6558\u6555\u6554\u659C\u659B\u65AC\u65CF\u65CB\u65CC\u65CE\u665D\u665A\u6664\u6668\u6666\u665E\u66F9\u52D7\u671B\u6881\u68AF\u68A2\u6893\u68B5\u687F\u6876\u68B1\u68A7\u6897\u68B0\u6883\u68C4\u68AD\u6886\u6885\u6894\u689D\u68A8\u689F\u68A1\u6882\u6B32\u6BBA"],["b240","\u6BEB\u6BEC\u6C2B\u6D8E\u6DBC\u6DF3\u6DD9\u6DB2\u6DE1\u6DCC\u6DE4\u6DFB\u6DFA\u6E05\u6DC7\u6DCB\u6DAF\u6DD1\u6DAE\u6DDE\u6DF9\u6DB8\u6DF7\u6DF5\u6DC5\u6DD2\u6E1A\u6DB5\u6DDA\u6DEB\u6DD8\u6DEA\u6DF1\u6DEE\u6DE8\u6DC6\u6DC4\u6DAA\u6DEC\u6DBF\u6DE6\u70F9\u7109\u710A\u70FD\u70EF\u723D\u727D\u7281\u731C\u731B\u7316\u7313\u7319\u7387\u7405\u740A\u7403\u7406\u73FE\u740D\u74E0\u74F6"],["b2a1","\u74F7\u751C\u7522\u7565\u7566\u7562\u7570\u758F\u75D4\u75D5\u75B5\u75CA\u75CD\u768E\u76D4\u76D2\u76DB\u7737\u773E\u773C\u7736\u7738\u773A\u786B\u7843\u784E\u7965\u7968\u796D\u79FB\u7A92\u7A95\u7B20\u7B28\u7B1B\u7B2C\u7B26\u7B19\u7B1E\u7B2E\u7C92\u7C97\u7C95\u7D46\u7D43\u7D71\u7D2E\u7D39\u7D3C\u7D40\u7D30\u7D33\u7D44\u7D2F\u7D42\u7D32\u7D31\u7F3D\u7F9E\u7F9A\u7FCC\u7FCE\u7FD2\u801C\u804A\u8046\u812F\u8116\u8123\u812B\u8129\u8130\u8124\u8202\u8235\u8237\u8236\u8239\u838E\u839E\u8398\u8378\u83A2\u8396\u83BD\u83AB\u8392\u838A\u8393\u8389\u83A0\u8377\u837B\u837C"],["b340","\u8386\u83A7\u8655\u5F6A\u86C7\u86C0\u86B6\u86C4\u86B5\u86C6\u86CB\u86B1\u86AF\u86C9\u8853\u889E\u8888\u88AB\u8892\u8896\u888D\u888B\u8993\u898F\u8A2A\u8A1D\u8A23\u8A25\u8A31\u8A2D\u8A1F\u8A1B\u8A22\u8C49\u8C5A\u8CA9\u8CAC\u8CAB\u8CA8\u8CAA\u8CA7\u8D67\u8D66\u8DBE\u8DBA\u8EDB\u8EDF\u9019\u900D\u901A\u9017\u9023\u901F\u901D\u9010\u9015\u901E\u9020\u900F\u9022\u9016\u901B\u9014"],["b3a1","\u90E8\u90ED\u90FD\u9157\u91CE\u91F5\u91E6\u91E3\u91E7\u91ED\u91E9\u9589\u966A\u9675\u9673\u9678\u9670\u9674\u9676\u9677\u966C\u96C0\u96EA\u96E9\u7AE0\u7ADF\u9802\u9803\u9B5A\u9CE5\u9E75\u9E7F\u9EA5\u9EBB\u50A2\u508D\u5085\u5099\u5091\u5080\u5096\u5098\u509A\u6700\u51F1\u5272\u5274\u5275\u5269\u52DE\u52DD\u52DB\u535A\u53A5\u557B\u5580\u55A7\u557C\u558A\u559D\u5598\u5582\u559C\u55AA\u5594\u5587\u558B\u5583\u55B3\u55AE\u559F\u553E\u55B2\u559A\u55BB\u55AC\u55B1\u557E\u5589\u55AB\u5599\u570D\u582F\u582A\u5834\u5824\u5830\u5831\u5821\u581D\u5820\u58F9\u58FA\u5960"],["b440","\u5A77\u5A9A\u5A7F\u5A92\u5A9B\u5AA7\u5B73\u5B71\u5BD2\u5BCC\u5BD3\u5BD0\u5C0A\u5C0B\u5C31\u5D4C\u5D50\u5D34\u5D47\u5DFD\u5E45\u5E3D\u5E40\u5E43\u5E7E\u5ECA\u5EC1\u5EC2\u5EC4\u5F3C\u5F6D\u5FA9\u5FAA\u5FA8\u60D1\u60E1\u60B2\u60B6\u60E0\u611C\u6123\u60FA\u6115\u60F0\u60FB\u60F4\u6168\u60F1\u610E\u60F6\u6109\u6100\u6112\u621F\u6249\u63A3\u638C\u63CF\u63C0\u63E9\u63C9\u63C6\u63CD"],["b4a1","\u63D2\u63E3\u63D0\u63E1\u63D6\u63ED\u63EE\u6376\u63F4\u63EA\u63DB\u6452\u63DA\u63F9\u655E\u6566\u6562\u6563\u6591\u6590\u65AF\u666E\u6670\u6674\u6676\u666F\u6691\u667A\u667E\u6677\u66FE\u66FF\u671F\u671D\u68FA\u68D5\u68E0\u68D8\u68D7\u6905\u68DF\u68F5\u68EE\u68E7\u68F9\u68D2\u68F2\u68E3\u68CB\u68CD\u690D\u6912\u690E\u68C9\u68DA\u696E\u68FB\u6B3E\u6B3A\u6B3D\u6B98\u6B96\u6BBC\u6BEF\u6C2E\u6C2F\u6C2C\u6E2F\u6E38\u6E54\u6E21\u6E32\u6E67\u6E4A\u6E20\u6E25\u6E23\u6E1B\u6E5B\u6E58\u6E24\u6E56\u6E6E\u6E2D\u6E26\u6E6F\u6E34\u6E4D\u6E3A\u6E2C\u6E43\u6E1D\u6E3E\u6ECB"],["b540","\u6E89\u6E19\u6E4E\u6E63\u6E44\u6E72\u6E69\u6E5F\u7119\u711A\u7126\u7130\u7121\u7136\u716E\u711C\u724C\u7284\u7280\u7336\u7325\u7334\u7329\u743A\u742A\u7433\u7422\u7425\u7435\u7436\u7434\u742F\u741B\u7426\u7428\u7525\u7526\u756B\u756A\u75E2\u75DB\u75E3\u75D9\u75D8\u75DE\u75E0\u767B\u767C\u7696\u7693\u76B4\u76DC\u774F\u77ED\u785D\u786C\u786F\u7A0D\u7A08\u7A0B\u7A05\u7A00\u7A98"],["b5a1","\u7A97\u7A96\u7AE5\u7AE3\u7B49\u7B56\u7B46\u7B50\u7B52\u7B54\u7B4D\u7B4B\u7B4F\u7B51\u7C9F\u7CA5\u7D5E\u7D50\u7D68\u7D55\u7D2B\u7D6E\u7D72\u7D61\u7D66\u7D62\u7D70\u7D73\u5584\u7FD4\u7FD5\u800B\u8052\u8085\u8155\u8154\u814B\u8151\u814E\u8139\u8146\u813E\u814C\u8153\u8174\u8212\u821C\u83E9\u8403\u83F8\u840D\u83E0\u83C5\u840B\u83C1\u83EF\u83F1\u83F4\u8457\u840A\u83F0\u840C\u83CC\u83FD\u83F2\u83CA\u8438\u840E\u8404\u83DC\u8407\u83D4\u83DF\u865B\u86DF\u86D9\u86ED\u86D4\u86DB\u86E4\u86D0\u86DE\u8857\u88C1\u88C2\u88B1\u8983\u8996\u8A3B\u8A60\u8A55\u8A5E\u8A3C\u8A41"],["b640","\u8A54\u8A5B\u8A50\u8A46\u8A34\u8A3A\u8A36\u8A56\u8C61\u8C82\u8CAF\u8CBC\u8CB3\u8CBD\u8CC1\u8CBB\u8CC0\u8CB4\u8CB7\u8CB6\u8CBF\u8CB8\u8D8A\u8D85\u8D81\u8DCE\u8DDD\u8DCB\u8DDA\u8DD1\u8DCC\u8DDB\u8DC6\u8EFB\u8EF8\u8EFC\u8F9C\u902E\u9035\u9031\u9038\u9032\u9036\u9102\u90F5\u9109\u90FE\u9163\u9165\u91CF\u9214\u9215\u9223\u9209\u921E\u920D\u9210\u9207\u9211\u9594\u958F\u958B\u9591"],["b6a1","\u9593\u9592\u958E\u968A\u968E\u968B\u967D\u9685\u9686\u968D\u9672\u9684\u96C1\u96C5\u96C4\u96C6\u96C7\u96EF\u96F2\u97CC\u9805\u9806\u9808\u98E7\u98EA\u98EF\u98E9\u98F2\u98ED\u99AE\u99AD\u9EC3\u9ECD\u9ED1\u4E82\u50AD\u50B5\u50B2\u50B3\u50C5\u50BE\u50AC\u50B7\u50BB\u50AF\u50C7\u527F\u5277\u527D\u52DF\u52E6\u52E4\u52E2\u52E3\u532F\u55DF\u55E8\u55D3\u55E6\u55CE\u55DC\u55C7\u55D1\u55E3\u55E4\u55EF\u55DA\u55E1\u55C5\u55C6\u55E5\u55C9\u5712\u5713\u585E\u5851\u5858\u5857\u585A\u5854\u586B\u584C\u586D\u584A\u5862\u5852\u584B\u5967\u5AC1\u5AC9\u5ACC\u5ABE\u5ABD\u5ABC"],["b740","\u5AB3\u5AC2\u5AB2\u5D69\u5D6F\u5E4C\u5E79\u5EC9\u5EC8\u5F12\u5F59\u5FAC\u5FAE\u611A\u610F\u6148\u611F\u60F3\u611B\u60F9\u6101\u6108\u614E\u614C\u6144\u614D\u613E\u6134\u6127\u610D\u6106\u6137\u6221\u6222\u6413\u643E\u641E\u642A\u642D\u643D\u642C\u640F\u641C\u6414\u640D\u6436\u6416\u6417\u6406\u656C\u659F\u65B0\u6697\u6689\u6687\u6688\u6696\u6684\u6698\u668D\u6703\u6994\u696D"],["b7a1","\u695A\u6977\u6960\u6954\u6975\u6930\u6982\u694A\u6968\u696B\u695E\u6953\u6979\u6986\u695D\u6963\u695B\u6B47\u6B72\u6BC0\u6BBF\u6BD3\u6BFD\u6EA2\u6EAF\u6ED3\u6EB6\u6EC2\u6E90\u6E9D\u6EC7\u6EC5\u6EA5\u6E98\u6EBC\u6EBA\u6EAB\u6ED1\u6E96\u6E9C\u6EC4\u6ED4\u6EAA\u6EA7\u6EB4\u714E\u7159\u7169\u7164\u7149\u7167\u715C\u716C\u7166\u714C\u7165\u715E\u7146\u7168\u7156\u723A\u7252\u7337\u7345\u733F\u733E\u746F\u745A\u7455\u745F\u745E\u7441\u743F\u7459\u745B\u745C\u7576\u7578\u7600\u75F0\u7601\u75F2\u75F1\u75FA\u75FF\u75F4\u75F3\u76DE\u76DF\u775B\u776B\u7766\u775E\u7763"],["b840","\u7779\u776A\u776C\u775C\u7765\u7768\u7762\u77EE\u788E\u78B0\u7897\u7898\u788C\u7889\u787C\u7891\u7893\u787F\u797A\u797F\u7981\u842C\u79BD\u7A1C\u7A1A\u7A20\u7A14\u7A1F\u7A1E\u7A9F\u7AA0\u7B77\u7BC0\u7B60\u7B6E\u7B67\u7CB1\u7CB3\u7CB5\u7D93\u7D79\u7D91\u7D81\u7D8F\u7D5B\u7F6E\u7F69\u7F6A\u7F72\u7FA9\u7FA8\u7FA4\u8056\u8058\u8086\u8084\u8171\u8170\u8178\u8165\u816E\u8173\u816B"],["b8a1","\u8179\u817A\u8166\u8205\u8247\u8482\u8477\u843D\u8431\u8475\u8466\u846B\u8449\u846C\u845B\u843C\u8435\u8461\u8463\u8469\u846D\u8446\u865E\u865C\u865F\u86F9\u8713\u8708\u8707\u8700\u86FE\u86FB\u8702\u8703\u8706\u870A\u8859\u88DF\u88D4\u88D9\u88DC\u88D8\u88DD\u88E1\u88CA\u88D5\u88D2\u899C\u89E3\u8A6B\u8A72\u8A73\u8A66\u8A69\u8A70\u8A87\u8A7C\u8A63\u8AA0\u8A71\u8A85\u8A6D\u8A62\u8A6E\u8A6C\u8A79\u8A7B\u8A3E\u8A68\u8C62\u8C8A\u8C89\u8CCA\u8CC7\u8CC8\u8CC4\u8CB2\u8CC3\u8CC2\u8CC5\u8DE1\u8DDF\u8DE8\u8DEF\u8DF3\u8DFA\u8DEA\u8DE4\u8DE6\u8EB2\u8F03\u8F09\u8EFE\u8F0A"],["b940","\u8F9F\u8FB2\u904B\u904A\u9053\u9042\u9054\u903C\u9055\u9050\u9047\u904F\u904E\u904D\u9051\u903E\u9041\u9112\u9117\u916C\u916A\u9169\u91C9\u9237\u9257\u9238\u923D\u9240\u923E\u925B\u924B\u9264\u9251\u9234\u9249\u924D\u9245\u9239\u923F\u925A\u9598\u9698\u9694\u9695\u96CD\u96CB\u96C9\u96CA\u96F7\u96FB\u96F9\u96F6\u9756\u9774\u9776\u9810\u9811\u9813\u980A\u9812\u980C\u98FC\u98F4"],["b9a1","\u98FD\u98FE\u99B3\u99B1\u99B4\u9AE1\u9CE9\u9E82\u9F0E\u9F13\u9F20\u50E7\u50EE\u50E5\u50D6\u50ED\u50DA\u50D5\u50CF\u50D1\u50F1\u50CE\u50E9\u5162\u51F3\u5283\u5282\u5331\u53AD\u55FE\u5600\u561B\u5617\u55FD\u5614\u5606\u5609\u560D\u560E\u55F7\u5616\u561F\u5608\u5610\u55F6\u5718\u5716\u5875\u587E\u5883\u5893\u588A\u5879\u5885\u587D\u58FD\u5925\u5922\u5924\u596A\u5969\u5AE1\u5AE6\u5AE9\u5AD7\u5AD6\u5AD8\u5AE3\u5B75\u5BDE\u5BE7\u5BE1\u5BE5\u5BE6\u5BE8\u5BE2\u5BE4\u5BDF\u5C0D\u5C62\u5D84\u5D87\u5E5B\u5E63\u5E55\u5E57\u5E54\u5ED3\u5ED6\u5F0A\u5F46\u5F70\u5FB9\u6147"],["ba40","\u613F\u614B\u6177\u6162\u6163\u615F\u615A\u6158\u6175\u622A\u6487\u6458\u6454\u64A4\u6478\u645F\u647A\u6451\u6467\u6434\u646D\u647B\u6572\u65A1\u65D7\u65D6\u66A2\u66A8\u669D\u699C\u69A8\u6995\u69C1\u69AE\u69D3\u69CB\u699B\u69B7\u69BB\u69AB\u69B4\u69D0\u69CD\u69AD\u69CC\u69A6\u69C3\u69A3\u6B49\u6B4C\u6C33\u6F33\u6F14\u6EFE\u6F13\u6EF4\u6F29\u6F3E\u6F20\u6F2C\u6F0F\u6F02\u6F22"],["baa1","\u6EFF\u6EEF\u6F06\u6F31\u6F38\u6F32\u6F23\u6F15\u6F2B\u6F2F\u6F88\u6F2A\u6EEC\u6F01\u6EF2\u6ECC\u6EF7\u7194\u7199\u717D\u718A\u7184\u7192\u723E\u7292\u7296\u7344\u7350\u7464\u7463\u746A\u7470\u746D\u7504\u7591\u7627\u760D\u760B\u7609\u7613\u76E1\u76E3\u7784\u777D\u777F\u7761\u78C1\u789F\u78A7\u78B3\u78A9\u78A3\u798E\u798F\u798D\u7A2E\u7A31\u7AAA\u7AA9\u7AED\u7AEF\u7BA1\u7B95\u7B8B\u7B75\u7B97\u7B9D\u7B94\u7B8F\u7BB8\u7B87\u7B84\u7CB9\u7CBD\u7CBE\u7DBB\u7DB0\u7D9C\u7DBD\u7DBE\u7DA0\u7DCA\u7DB4\u7DB2\u7DB1\u7DBA\u7DA2\u7DBF\u7DB5\u7DB8\u7DAD\u7DD2\u7DC7\u7DAC"],["bb40","\u7F70\u7FE0\u7FE1\u7FDF\u805E\u805A\u8087\u8150\u8180\u818F\u8188\u818A\u817F\u8182\u81E7\u81FA\u8207\u8214\u821E\u824B\u84C9\u84BF\u84C6\u84C4\u8499\u849E\u84B2\u849C\u84CB\u84B8\u84C0\u84D3\u8490\u84BC\u84D1\u84CA\u873F\u871C\u873B\u8722\u8725\u8734\u8718\u8755\u8737\u8729\u88F3\u8902\u88F4\u88F9\u88F8\u88FD\u88E8\u891A\u88EF\u8AA6\u8A8C\u8A9E\u8AA3\u8A8D\u8AA1\u8A93\u8AA4"],["bba1","\u8AAA\u8AA5\u8AA8\u8A98\u8A91\u8A9A\u8AA7\u8C6A\u8C8D\u8C8C\u8CD3\u8CD1\u8CD2\u8D6B\u8D99\u8D95\u8DFC\u8F14\u8F12\u8F15\u8F13\u8FA3\u9060\u9058\u905C\u9063\u9059\u905E\u9062\u905D\u905B\u9119\u9118\u911E\u9175\u9178\u9177\u9174\u9278\u9280\u9285\u9298\u9296\u927B\u9293\u929C\u92A8\u927C\u9291\u95A1\u95A8\u95A9\u95A3\u95A5\u95A4\u9699\u969C\u969B\u96CC\u96D2\u9700\u977C\u9785\u97F6\u9817\u9818\u98AF\u98B1\u9903\u9905\u990C\u9909\u99C1\u9AAF\u9AB0\u9AE6\u9B41\u9B42\u9CF4\u9CF6\u9CF3\u9EBC\u9F3B\u9F4A\u5104\u5100\u50FB\u50F5\u50F9\u5102\u5108\u5109\u5105\u51DC"],["bc40","\u5287\u5288\u5289\u528D\u528A\u52F0\u53B2\u562E\u563B\u5639\u5632\u563F\u5634\u5629\u5653\u564E\u5657\u5674\u5636\u562F\u5630\u5880\u589F\u589E\u58B3\u589C\u58AE\u58A9\u58A6\u596D\u5B09\u5AFB\u5B0B\u5AF5\u5B0C\u5B08\u5BEE\u5BEC\u5BE9\u5BEB\u5C64\u5C65\u5D9D\u5D94\u5E62\u5E5F\u5E61\u5EE2\u5EDA\u5EDF\u5EDD\u5EE3\u5EE0\u5F48\u5F71\u5FB7\u5FB5\u6176\u6167\u616E\u615D\u6155\u6182"],["bca1","\u617C\u6170\u616B\u617E\u61A7\u6190\u61AB\u618E\u61AC\u619A\u61A4\u6194\u61AE\u622E\u6469\u646F\u6479\u649E\u64B2\u6488\u6490\u64B0\u64A5\u6493\u6495\u64A9\u6492\u64AE\u64AD\u64AB\u649A\u64AC\u6499\u64A2\u64B3\u6575\u6577\u6578\u66AE\u66AB\u66B4\u66B1\u6A23\u6A1F\u69E8\u6A01\u6A1E\u6A19\u69FD\u6A21\u6A13\u6A0A\u69F3\u6A02\u6A05\u69ED\u6A11\u6B50\u6B4E\u6BA4\u6BC5\u6BC6\u6F3F\u6F7C\u6F84\u6F51\u6F66\u6F54\u6F86\u6F6D\u6F5B\u6F78\u6F6E\u6F8E\u6F7A\u6F70\u6F64\u6F97\u6F58\u6ED5\u6F6F\u6F60\u6F5F\u719F\u71AC\u71B1\u71A8\u7256\u729B\u734E\u7357\u7469\u748B\u7483"],["bd40","\u747E\u7480\u757F\u7620\u7629\u761F\u7624\u7626\u7621\u7622\u769A\u76BA\u76E4\u778E\u7787\u778C\u7791\u778B\u78CB\u78C5\u78BA\u78CA\u78BE\u78D5\u78BC\u78D0\u7A3F\u7A3C\u7A40\u7A3D\u7A37\u7A3B\u7AAF\u7AAE\u7BAD\u7BB1\u7BC4\u7BB4\u7BC6\u7BC7\u7BC1\u7BA0\u7BCC\u7CCA\u7DE0\u7DF4\u7DEF\u7DFB\u7DD8\u7DEC\u7DDD\u7DE8\u7DE3\u7DDA\u7DDE\u7DE9\u7D9E\u7DD9\u7DF2\u7DF9\u7F75\u7F77\u7FAF"],["bda1","\u7FE9\u8026\u819B\u819C\u819D\u81A0\u819A\u8198\u8517\u853D\u851A\u84EE\u852C\u852D\u8513\u8511\u8523\u8521\u8514\u84EC\u8525\u84FF\u8506\u8782\u8774\u8776\u8760\u8766\u8778\u8768\u8759\u8757\u874C\u8753\u885B\u885D\u8910\u8907\u8912\u8913\u8915\u890A\u8ABC\u8AD2\u8AC7\u8AC4\u8A95\u8ACB\u8AF8\u8AB2\u8AC9\u8AC2\u8ABF\u8AB0\u8AD6\u8ACD\u8AB6\u8AB9\u8ADB\u8C4C\u8C4E\u8C6C\u8CE0\u8CDE\u8CE6\u8CE4\u8CEC\u8CED\u8CE2\u8CE3\u8CDC\u8CEA\u8CE1\u8D6D\u8D9F\u8DA3\u8E2B\u8E10\u8E1D\u8E22\u8E0F\u8E29\u8E1F\u8E21\u8E1E\u8EBA\u8F1D\u8F1B\u8F1F\u8F29\u8F26\u8F2A\u8F1C\u8F1E"],["be40","\u8F25\u9069\u906E\u9068\u906D\u9077\u9130\u912D\u9127\u9131\u9187\u9189\u918B\u9183\u92C5\u92BB\u92B7\u92EA\u92AC\u92E4\u92C1\u92B3\u92BC\u92D2\u92C7\u92F0\u92B2\u95AD\u95B1\u9704\u9706\u9707\u9709\u9760\u978D\u978B\u978F\u9821\u982B\u981C\u98B3\u990A\u9913\u9912\u9918\u99DD\u99D0\u99DF\u99DB\u99D1\u99D5\u99D2\u99D9\u9AB7\u9AEE\u9AEF\u9B27\u9B45\u9B44\u9B77\u9B6F\u9D06\u9D09"],["bea1","\u9D03\u9EA9\u9EBE\u9ECE\u58A8\u9F52\u5112\u5118\u5114\u5110\u5115\u5180\u51AA\u51DD\u5291\u5293\u52F3\u5659\u566B\u5679\u5669\u5664\u5678\u566A\u5668\u5665\u5671\u566F\u566C\u5662\u5676\u58C1\u58BE\u58C7\u58C5\u596E\u5B1D\u5B34\u5B78\u5BF0\u5C0E\u5F4A\u61B2\u6191\u61A9\u618A\u61CD\u61B6\u61BE\u61CA\u61C8\u6230\u64C5\u64C1\u64CB\u64BB\u64BC\u64DA\u64C4\u64C7\u64C2\u64CD\u64BF\u64D2\u64D4\u64BE\u6574\u66C6\u66C9\u66B9\u66C4\u66C7\u66B8\u6A3D\u6A38\u6A3A\u6A59\u6A6B\u6A58\u6A39\u6A44\u6A62\u6A61\u6A4B\u6A47\u6A35\u6A5F\u6A48\u6B59\u6B77\u6C05\u6FC2\u6FB1\u6FA1"],["bf40","\u6FC3\u6FA4\u6FC1\u6FA7\u6FB3\u6FC0\u6FB9\u6FB6\u6FA6\u6FA0\u6FB4\u71BE\u71C9\u71D0\u71D2\u71C8\u71D5\u71B9\u71CE\u71D9\u71DC\u71C3\u71C4\u7368\u749C\u74A3\u7498\u749F\u749E\u74E2\u750C\u750D\u7634\u7638\u763A\u76E7\u76E5\u77A0\u779E\u779F\u77A5\u78E8\u78DA\u78EC\u78E7\u79A6\u7A4D\u7A4E\u7A46\u7A4C\u7A4B\u7ABA\u7BD9\u7C11\u7BC9\u7BE4\u7BDB\u7BE1\u7BE9\u7BE6\u7CD5\u7CD6\u7E0A"],["bfa1","\u7E11\u7E08\u7E1B\u7E23\u7E1E\u7E1D\u7E09\u7E10\u7F79\u7FB2\u7FF0\u7FF1\u7FEE\u8028\u81B3\u81A9\u81A8\u81FB\u8208\u8258\u8259\u854A\u8559\u8548\u8568\u8569\u8543\u8549\u856D\u856A\u855E\u8783\u879F\u879E\u87A2\u878D\u8861\u892A\u8932\u8925\u892B\u8921\u89AA\u89A6\u8AE6\u8AFA\u8AEB\u8AF1\u8B00\u8ADC\u8AE7\u8AEE\u8AFE\u8B01\u8B02\u8AF7\u8AED\u8AF3\u8AF6\u8AFC\u8C6B\u8C6D\u8C93\u8CF4\u8E44\u8E31\u8E34\u8E42\u8E39\u8E35\u8F3B\u8F2F\u8F38\u8F33\u8FA8\u8FA6\u9075\u9074\u9078\u9072\u907C\u907A\u9134\u9192\u9320\u9336\u92F8\u9333\u932F\u9322\u92FC\u932B\u9304\u931A"],["c040","\u9310\u9326\u9321\u9315\u932E\u9319\u95BB\u96A7\u96A8\u96AA\u96D5\u970E\u9711\u9716\u970D\u9713\u970F\u975B\u975C\u9766\u9798\u9830\u9838\u983B\u9837\u982D\u9839\u9824\u9910\u9928\u991E\u991B\u9921\u991A\u99ED\u99E2\u99F1\u9AB8\u9ABC\u9AFB\u9AED\u9B28\u9B91\u9D15\u9D23\u9D26\u9D28\u9D12\u9D1B\u9ED8\u9ED4\u9F8D\u9F9C\u512A\u511F\u5121\u5132\u52F5\u568E\u5680\u5690\u5685\u5687"],["c0a1","\u568F\u58D5\u58D3\u58D1\u58CE\u5B30\u5B2A\u5B24\u5B7A\u5C37\u5C68\u5DBC\u5DBA\u5DBD\u5DB8\u5E6B\u5F4C\u5FBD\u61C9\u61C2\u61C7\u61E6\u61CB\u6232\u6234\u64CE\u64CA\u64D8\u64E0\u64F0\u64E6\u64EC\u64F1\u64E2\u64ED\u6582\u6583\u66D9\u66D6\u6A80\u6A94\u6A84\u6AA2\u6A9C\u6ADB\u6AA3\u6A7E\u6A97\u6A90\u6AA0\u6B5C\u6BAE\u6BDA\u6C08\u6FD8\u6FF1\u6FDF\u6FE0\u6FDB\u6FE4\u6FEB\u6FEF\u6F80\u6FEC\u6FE1\u6FE9\u6FD5\u6FEE\u6FF0\u71E7\u71DF\u71EE\u71E6\u71E5\u71ED\u71EC\u71F4\u71E0\u7235\u7246\u7370\u7372\u74A9\u74B0\u74A6\u74A8\u7646\u7642\u764C\u76EA\u77B3\u77AA\u77B0\u77AC"],["c140","\u77A7\u77AD\u77EF\u78F7\u78FA\u78F4\u78EF\u7901\u79A7\u79AA\u7A57\u7ABF\u7C07\u7C0D\u7BFE\u7BF7\u7C0C\u7BE0\u7CE0\u7CDC\u7CDE\u7CE2\u7CDF\u7CD9\u7CDD\u7E2E\u7E3E\u7E46\u7E37\u7E32\u7E43\u7E2B\u7E3D\u7E31\u7E45\u7E41\u7E34\u7E39\u7E48\u7E35\u7E3F\u7E2F\u7F44\u7FF3\u7FFC\u8071\u8072\u8070\u806F\u8073\u81C6\u81C3\u81BA\u81C2\u81C0\u81BF\u81BD\u81C9\u81BE\u81E8\u8209\u8271\u85AA"],["c1a1","\u8584\u857E\u859C\u8591\u8594\u85AF\u859B\u8587\u85A8\u858A\u8667\u87C0\u87D1\u87B3\u87D2\u87C6\u87AB\u87BB\u87BA\u87C8\u87CB\u893B\u8936\u8944\u8938\u893D\u89AC\u8B0E\u8B17\u8B19\u8B1B\u8B0A\u8B20\u8B1D\u8B04\u8B10\u8C41\u8C3F\u8C73\u8CFA\u8CFD\u8CFC\u8CF8\u8CFB\u8DA8\u8E49\u8E4B\u8E48\u8E4A\u8F44\u8F3E\u8F42\u8F45\u8F3F\u907F\u907D\u9084\u9081\u9082\u9080\u9139\u91A3\u919E\u919C\u934D\u9382\u9328\u9375\u934A\u9365\u934B\u9318\u937E\u936C\u935B\u9370\u935A\u9354\u95CA\u95CB\u95CC\u95C8\u95C6\u96B1\u96B8\u96D6\u971C\u971E\u97A0\u97D3\u9846\u98B6\u9935\u9A01"],["c240","\u99FF\u9BAE\u9BAB\u9BAA\u9BAD\u9D3B\u9D3F\u9E8B\u9ECF\u9EDE\u9EDC\u9EDD\u9EDB\u9F3E\u9F4B\u53E2\u5695\u56AE\u58D9\u58D8\u5B38\u5F5D\u61E3\u6233\u64F4\u64F2\u64FE\u6506\u64FA\u64FB\u64F7\u65B7\u66DC\u6726\u6AB3\u6AAC\u6AC3\u6ABB\u6AB8\u6AC2\u6AAE\u6AAF\u6B5F\u6B78\u6BAF\u7009\u700B\u6FFE\u7006\u6FFA\u7011\u700F\u71FB\u71FC\u71FE\u71F8\u7377\u7375\u74A7\u74BF\u7515\u7656\u7658"],["c2a1","\u7652\u77BD\u77BF\u77BB\u77BC\u790E\u79AE\u7A61\u7A62\u7A60\u7AC4\u7AC5\u7C2B\u7C27\u7C2A\u7C1E\u7C23\u7C21\u7CE7\u7E54\u7E55\u7E5E\u7E5A\u7E61\u7E52\u7E59\u7F48\u7FF9\u7FFB\u8077\u8076\u81CD\u81CF\u820A\u85CF\u85A9\u85CD\u85D0\u85C9\u85B0\u85BA\u85B9\u85A6\u87EF\u87EC\u87F2\u87E0\u8986\u89B2\u89F4\u8B28\u8B39\u8B2C\u8B2B\u8C50\u8D05\u8E59\u8E63\u8E66\u8E64\u8E5F\u8E55\u8EC0\u8F49\u8F4D\u9087\u9083\u9088\u91AB\u91AC\u91D0\u9394\u938A\u9396\u93A2\u93B3\u93AE\u93AC\u93B0\u9398\u939A\u9397\u95D4\u95D6\u95D0\u95D5\u96E2\u96DC\u96D9\u96DB\u96DE\u9724\u97A3\u97A6"],["c340","\u97AD\u97F9\u984D\u984F\u984C\u984E\u9853\u98BA\u993E\u993F\u993D\u992E\u99A5\u9A0E\u9AC1\u9B03\u9B06\u9B4F\u9B4E\u9B4D\u9BCA\u9BC9\u9BFD\u9BC8\u9BC0\u9D51\u9D5D\u9D60\u9EE0\u9F15\u9F2C\u5133\u56A5\u58DE\u58DF\u58E2\u5BF5\u9F90\u5EEC\u61F2\u61F7\u61F6\u61F5\u6500\u650F\u66E0\u66DD\u6AE5\u6ADD\u6ADA\u6AD3\u701B\u701F\u7028\u701A\u701D\u7015\u7018\u7206\u720D\u7258\u72A2\u7378"],["c3a1","\u737A\u74BD\u74CA\u74E3\u7587\u7586\u765F\u7661\u77C7\u7919\u79B1\u7A6B\u7A69\u7C3E\u7C3F\u7C38\u7C3D\u7C37\u7C40\u7E6B\u7E6D\u7E79\u7E69\u7E6A\u7F85\u7E73\u7FB6\u7FB9\u7FB8\u81D8\u85E9\u85DD\u85EA\u85D5\u85E4\u85E5\u85F7\u87FB\u8805\u880D\u87F9\u87FE\u8960\u895F\u8956\u895E\u8B41\u8B5C\u8B58\u8B49\u8B5A\u8B4E\u8B4F\u8B46\u8B59\u8D08\u8D0A\u8E7C\u8E72\u8E87\u8E76\u8E6C\u8E7A\u8E74\u8F54\u8F4E\u8FAD\u908A\u908B\u91B1\u91AE\u93E1\u93D1\u93DF\u93C3\u93C8\u93DC\u93DD\u93D6\u93E2\u93CD\u93D8\u93E4\u93D7\u93E8\u95DC\u96B4\u96E3\u972A\u9727\u9761\u97DC\u97FB\u985E"],["c440","\u9858\u985B\u98BC\u9945\u9949\u9A16\u9A19\u9B0D\u9BE8\u9BE7\u9BD6\u9BDB\u9D89\u9D61\u9D72\u9D6A\u9D6C\u9E92\u9E97\u9E93\u9EB4\u52F8\u56A8\u56B7\u56B6\u56B4\u56BC\u58E4\u5B40\u5B43\u5B7D\u5BF6\u5DC9\u61F8\u61FA\u6518\u6514\u6519\u66E6\u6727\u6AEC\u703E\u7030\u7032\u7210\u737B\u74CF\u7662\u7665\u7926\u792A\u792C\u792B\u7AC7\u7AF6\u7C4C\u7C43\u7C4D\u7CEF\u7CF0\u8FAE\u7E7D\u7E7C"],["c4a1","\u7E82\u7F4C\u8000\u81DA\u8266\u85FB\u85F9\u8611\u85FA\u8606\u860B\u8607\u860A\u8814\u8815\u8964\u89BA\u89F8\u8B70\u8B6C\u8B66\u8B6F\u8B5F\u8B6B\u8D0F\u8D0D\u8E89\u8E81\u8E85\u8E82\u91B4\u91CB\u9418\u9403\u93FD\u95E1\u9730\u98C4\u9952\u9951\u99A8\u9A2B\u9A30\u9A37\u9A35\u9C13\u9C0D\u9E79\u9EB5\u9EE8\u9F2F\u9F5F\u9F63\u9F61\u5137\u5138\u56C1\u56C0\u56C2\u5914\u5C6C\u5DCD\u61FC\u61FE\u651D\u651C\u6595\u66E9\u6AFB\u6B04\u6AFA\u6BB2\u704C\u721B\u72A7\u74D6\u74D4\u7669\u77D3\u7C50\u7E8F\u7E8C\u7FBC\u8617\u862D\u861A\u8823\u8822\u8821\u881F\u896A\u896C\u89BD\u8B74"],["c540","\u8B77\u8B7D\u8D13\u8E8A\u8E8D\u8E8B\u8F5F\u8FAF\u91BA\u942E\u9433\u9435\u943A\u9438\u9432\u942B\u95E2\u9738\u9739\u9732\u97FF\u9867\u9865\u9957\u9A45\u9A43\u9A40\u9A3E\u9ACF\u9B54\u9B51\u9C2D\u9C25\u9DAF\u9DB4\u9DC2\u9DB8\u9E9D\u9EEF\u9F19\u9F5C\u9F66\u9F67\u513C\u513B\u56C8\u56CA\u56C9\u5B7F\u5DD4\u5DD2\u5F4E\u61FF\u6524\u6B0A\u6B61\u7051\u7058\u7380\u74E4\u758A\u766E\u766C"],["c5a1","\u79B3\u7C60\u7C5F\u807E\u807D\u81DF\u8972\u896F\u89FC\u8B80\u8D16\u8D17\u8E91\u8E93\u8F61\u9148\u9444\u9451\u9452\u973D\u973E\u97C3\u97C1\u986B\u9955\u9A55\u9A4D\u9AD2\u9B1A\u9C49\u9C31\u9C3E\u9C3B\u9DD3\u9DD7\u9F34\u9F6C\u9F6A\u9F94\u56CC\u5DD6\u6200\u6523\u652B\u652A\u66EC\u6B10\u74DA\u7ACA\u7C64\u7C63\u7C65\u7E93\u7E96\u7E94\u81E2\u8638\u863F\u8831\u8B8A\u9090\u908F\u9463\u9460\u9464\u9768\u986F\u995C\u9A5A\u9A5B\u9A57\u9AD3\u9AD4\u9AD1\u9C54\u9C57\u9C56\u9DE5\u9E9F\u9EF4\u56D1\u58E9\u652C\u705E\u7671\u7672\u77D7\u7F50\u7F88\u8836\u8839\u8862\u8B93\u8B92"],["c640","\u8B96\u8277\u8D1B\u91C0\u946A\u9742\u9748\u9744\u97C6\u9870\u9A5F\u9B22\u9B58\u9C5F\u9DF9\u9DFA\u9E7C\u9E7D\u9F07\u9F77\u9F72\u5EF3\u6B16\u7063\u7C6C\u7C6E\u883B\u89C0\u8EA1\u91C1\u9472\u9470\u9871\u995E\u9AD6\u9B23\u9ECC\u7064\u77DA\u8B9A\u9477\u97C9\u9A62\u9A65\u7E9C\u8B9C\u8EAA\u91C5\u947D\u947E\u947C\u9C77\u9C78\u9EF7\u8C54\u947F\u9E1A\u7228\u9A6A\u9B31\u9E1B\u9E1E\u7C72"],["c940","\u4E42\u4E5C\u51F5\u531A\u5382\u4E07\u4E0C\u4E47\u4E8D\u56D7\uFA0C\u5C6E\u5F73\u4E0F\u5187\u4E0E\u4E2E\u4E93\u4EC2\u4EC9\u4EC8\u5198\u52FC\u536C\u53B9\u5720\u5903\u592C\u5C10\u5DFF\u65E1\u6BB3\u6BCC\u6C14\u723F\u4E31\u4E3C\u4EE8\u4EDC\u4EE9\u4EE1\u4EDD\u4EDA\u520C\u531C\u534C\u5722\u5723\u5917\u592F\u5B81\u5B84\u5C12\u5C3B\u5C74\u5C73\u5E04\u5E80\u5E82\u5FC9\u6209\u6250\u6C15"],["c9a1","\u6C36\u6C43\u6C3F\u6C3B\u72AE\u72B0\u738A\u79B8\u808A\u961E\u4F0E\u4F18\u4F2C\u4EF5\u4F14\u4EF1\u4F00\u4EF7\u4F08\u4F1D\u4F02\u4F05\u4F22\u4F13\u4F04\u4EF4\u4F12\u51B1\u5213\u5209\u5210\u52A6\u5322\u531F\u534D\u538A\u5407\u56E1\u56DF\u572E\u572A\u5734\u593C\u5980\u597C\u5985\u597B\u597E\u5977\u597F\u5B56\u5C15\u5C25\u5C7C\u5C7A\u5C7B\u5C7E\u5DDF\u5E75\u5E84\u5F02\u5F1A\u5F74\u5FD5\u5FD4\u5FCF\u625C\u625E\u6264\u6261\u6266\u6262\u6259\u6260\u625A\u6265\u65EF\u65EE\u673E\u6739\u6738\u673B\u673A\u673F\u673C\u6733\u6C18\u6C46\u6C52\u6C5C\u6C4F\u6C4A\u6C54\u6C4B"],["ca40","\u6C4C\u7071\u725E\u72B4\u72B5\u738E\u752A\u767F\u7A75\u7F51\u8278\u827C\u8280\u827D\u827F\u864D\u897E\u9099\u9097\u9098\u909B\u9094\u9622\u9624\u9620\u9623\u4F56\u4F3B\u4F62\u4F49\u4F53\u4F64\u4F3E\u4F67\u4F52\u4F5F\u4F41\u4F58\u4F2D\u4F33\u4F3F\u4F61\u518F\u51B9\u521C\u521E\u5221\u52AD\u52AE\u5309\u5363\u5372\u538E\u538F\u5430\u5437\u542A\u5454\u5445\u5419\u541C\u5425\u5418"],["caa1","\u543D\u544F\u5441\u5428\u5424\u5447\u56EE\u56E7\u56E5\u5741\u5745\u574C\u5749\u574B\u5752\u5906\u5940\u59A6\u5998\u59A0\u5997\u598E\u59A2\u5990\u598F\u59A7\u59A1\u5B8E\u5B92\u5C28\u5C2A\u5C8D\u5C8F\u5C88\u5C8B\u5C89\u5C92\u5C8A\u5C86\u5C93\u5C95\u5DE0\u5E0A\u5E0E\u5E8B\u5E89\u5E8C\u5E88\u5E8D\u5F05\u5F1D\u5F78\u5F76\u5FD2\u5FD1\u5FD0\u5FED\u5FE8\u5FEE\u5FF3\u5FE1\u5FE4\u5FE3\u5FFA\u5FEF\u5FF7\u5FFB\u6000\u5FF4\u623A\u6283\u628C\u628E\u628F\u6294\u6287\u6271\u627B\u627A\u6270\u6281\u6288\u6277\u627D\u6272\u6274\u6537\u65F0\u65F4\u65F3\u65F2\u65F5\u6745\u6747"],["cb40","\u6759\u6755\u674C\u6748\u675D\u674D\u675A\u674B\u6BD0\u6C19\u6C1A\u6C78\u6C67\u6C6B\u6C84\u6C8B\u6C8F\u6C71\u6C6F\u6C69\u6C9A\u6C6D\u6C87\u6C95\u6C9C\u6C66\u6C73\u6C65\u6C7B\u6C8E\u7074\u707A\u7263\u72BF\u72BD\u72C3\u72C6\u72C1\u72BA\u72C5\u7395\u7397\u7393\u7394\u7392\u753A\u7539\u7594\u7595\u7681\u793D\u8034\u8095\u8099\u8090\u8092\u809C\u8290\u828F\u8285\u828E\u8291\u8293"],["cba1","\u828A\u8283\u8284\u8C78\u8FC9\u8FBF\u909F\u90A1\u90A5\u909E\u90A7\u90A0\u9630\u9628\u962F\u962D\u4E33\u4F98\u4F7C\u4F85\u4F7D\u4F80\u4F87\u4F76\u4F74\u4F89\u4F84\u4F77\u4F4C\u4F97\u4F6A\u4F9A\u4F79\u4F81\u4F78\u4F90\u4F9C\u4F94\u4F9E\u4F92\u4F82\u4F95\u4F6B\u4F6E\u519E\u51BC\u51BE\u5235\u5232\u5233\u5246\u5231\u52BC\u530A\u530B\u533C\u5392\u5394\u5487\u547F\u5481\u5491\u5482\u5488\u546B\u547A\u547E\u5465\u546C\u5474\u5466\u548D\u546F\u5461\u5460\u5498\u5463\u5467\u5464\u56F7\u56F9\u576F\u5772\u576D\u576B\u5771\u5770\u5776\u5780\u5775\u577B\u5773\u5774\u5762"],["cc40","\u5768\u577D\u590C\u5945\u59B5\u59BA\u59CF\u59CE\u59B2\u59CC\u59C1\u59B6\u59BC\u59C3\u59D6\u59B1\u59BD\u59C0\u59C8\u59B4\u59C7\u5B62\u5B65\u5B93\u5B95\u5C44\u5C47\u5CAE\u5CA4\u5CA0\u5CB5\u5CAF\u5CA8\u5CAC\u5C9F\u5CA3\u5CAD\u5CA2\u5CAA\u5CA7\u5C9D\u5CA5\u5CB6\u5CB0\u5CA6\u5E17\u5E14\u5E19\u5F28\u5F22\u5F23\u5F24\u5F54\u5F82\u5F7E\u5F7D\u5FDE\u5FE5\u602D\u6026\u6019\u6032\u600B"],["cca1","\u6034\u600A\u6017\u6033\u601A\u601E\u602C\u6022\u600D\u6010\u602E\u6013\u6011\u600C\u6009\u601C\u6214\u623D\u62AD\u62B4\u62D1\u62BE\u62AA\u62B6\u62CA\u62AE\u62B3\u62AF\u62BB\u62A9\u62B0\u62B8\u653D\u65A8\u65BB\u6609\u65FC\u6604\u6612\u6608\u65FB\u6603\u660B\u660D\u6605\u65FD\u6611\u6610\u66F6\u670A\u6785\u676C\u678E\u6792\u6776\u677B\u6798\u6786\u6784\u6774\u678D\u678C\u677A\u679F\u6791\u6799\u6783\u677D\u6781\u6778\u6779\u6794\u6B25\u6B80\u6B7E\u6BDE\u6C1D\u6C93\u6CEC\u6CEB\u6CEE\u6CD9\u6CB6\u6CD4\u6CAD\u6CE7\u6CB7\u6CD0\u6CC2\u6CBA\u6CC3\u6CC6\u6CED\u6CF2"],["cd40","\u6CD2\u6CDD\u6CB4\u6C8A\u6C9D\u6C80\u6CDE\u6CC0\u6D30\u6CCD\u6CC7\u6CB0\u6CF9\u6CCF\u6CE9\u6CD1\u7094\u7098\u7085\u7093\u7086\u7084\u7091\u7096\u7082\u709A\u7083\u726A\u72D6\u72CB\u72D8\u72C9\u72DC\u72D2\u72D4\u72DA\u72CC\u72D1\u73A4\u73A1\u73AD\u73A6\u73A2\u73A0\u73AC\u739D\u74DD\u74E8\u753F\u7540\u753E\u758C\u7598\u76AF\u76F3\u76F1\u76F0\u76F5\u77F8\u77FC\u77F9\u77FB\u77FA"],["cda1","\u77F7\u7942\u793F\u79C5\u7A78\u7A7B\u7AFB\u7C75\u7CFD\u8035\u808F\u80AE\u80A3\u80B8\u80B5\u80AD\u8220\u82A0\u82C0\u82AB\u829A\u8298\u829B\u82B5\u82A7\u82AE\u82BC\u829E\u82BA\u82B4\u82A8\u82A1\u82A9\u82C2\u82A4\u82C3\u82B6\u82A2\u8670\u866F\u866D\u866E\u8C56\u8FD2\u8FCB\u8FD3\u8FCD\u8FD6\u8FD5\u8FD7\u90B2\u90B4\u90AF\u90B3\u90B0\u9639\u963D\u963C\u963A\u9643\u4FCD\u4FC5\u4FD3\u4FB2\u4FC9\u4FCB\u4FC1\u4FD4\u4FDC\u4FD9\u4FBB\u4FB3\u4FDB\u4FC7\u4FD6\u4FBA\u4FC0\u4FB9\u4FEC\u5244\u5249\u52C0\u52C2\u533D\u537C\u5397\u5396\u5399\u5398\u54BA\u54A1\u54AD\u54A5\u54CF"],["ce40","\u54C3\u830D\u54B7\u54AE\u54D6\u54B6\u54C5\u54C6\u54A0\u5470\u54BC\u54A2\u54BE\u5472\u54DE\u54B0\u57B5\u579E\u579F\u57A4\u578C\u5797\u579D\u579B\u5794\u5798\u578F\u5799\u57A5\u579A\u5795\u58F4\u590D\u5953\u59E1\u59DE\u59EE\u5A00\u59F1\u59DD\u59FA\u59FD\u59FC\u59F6\u59E4\u59F2\u59F7\u59DB\u59E9\u59F3\u59F5\u59E0\u59FE\u59F4\u59ED\u5BA8\u5C4C\u5CD0\u5CD8\u5CCC\u5CD7\u5CCB\u5CDB"],["cea1","\u5CDE\u5CDA\u5CC9\u5CC7\u5CCA\u5CD6\u5CD3\u5CD4\u5CCF\u5CC8\u5CC6\u5CCE\u5CDF\u5CF8\u5DF9\u5E21\u5E22\u5E23\u5E20\u5E24\u5EB0\u5EA4\u5EA2\u5E9B\u5EA3\u5EA5\u5F07\u5F2E\u5F56\u5F86\u6037\u6039\u6054\u6072\u605E\u6045\u6053\u6047\u6049\u605B\u604C\u6040\u6042\u605F\u6024\u6044\u6058\u6066\u606E\u6242\u6243\u62CF\u630D\u630B\u62F5\u630E\u6303\u62EB\u62F9\u630F\u630C\u62F8\u62F6\u6300\u6313\u6314\u62FA\u6315\u62FB\u62F0\u6541\u6543\u65AA\u65BF\u6636\u6621\u6632\u6635\u661C\u6626\u6622\u6633\u662B\u663A\u661D\u6634\u6639\u662E\u670F\u6710\u67C1\u67F2\u67C8\u67BA"],["cf40","\u67DC\u67BB\u67F8\u67D8\u67C0\u67B7\u67C5\u67EB\u67E4\u67DF\u67B5\u67CD\u67B3\u67F7\u67F6\u67EE\u67E3\u67C2\u67B9\u67CE\u67E7\u67F0\u67B2\u67FC\u67C6\u67ED\u67CC\u67AE\u67E6\u67DB\u67FA\u67C9\u67CA\u67C3\u67EA\u67CB\u6B28\u6B82\u6B84\u6BB6\u6BD6\u6BD8\u6BE0\u6C20\u6C21\u6D28\u6D34\u6D2D\u6D1F\u6D3C\u6D3F\u6D12\u6D0A\u6CDA\u6D33\u6D04\u6D19\u6D3A\u6D1A\u6D11\u6D00\u6D1D\u6D42"],["cfa1","\u6D01\u6D18\u6D37\u6D03\u6D0F\u6D40\u6D07\u6D20\u6D2C\u6D08\u6D22\u6D09\u6D10\u70B7\u709F\u70BE\u70B1\u70B0\u70A1\u70B4\u70B5\u70A9\u7241\u7249\u724A\u726C\u7270\u7273\u726E\u72CA\u72E4\u72E8\u72EB\u72DF\u72EA\u72E6\u72E3\u7385\u73CC\u73C2\u73C8\u73C5\u73B9\u73B6\u73B5\u73B4\u73EB\u73BF\u73C7\u73BE\u73C3\u73C6\u73B8\u73CB\u74EC\u74EE\u752E\u7547\u7548\u75A7\u75AA\u7679\u76C4\u7708\u7703\u7704\u7705\u770A\u76F7\u76FB\u76FA\u77E7\u77E8\u7806\u7811\u7812\u7805\u7810\u780F\u780E\u7809\u7803\u7813\u794A\u794C\u794B\u7945\u7944\u79D5\u79CD\u79CF\u79D6\u79CE\u7A80"],["d040","\u7A7E\u7AD1\u7B00\u7B01\u7C7A\u7C78\u7C79\u7C7F\u7C80\u7C81\u7D03\u7D08\u7D01\u7F58\u7F91\u7F8D\u7FBE\u8007\u800E\u800F\u8014\u8037\u80D8\u80C7\u80E0\u80D1\u80C8\u80C2\u80D0\u80C5\u80E3\u80D9\u80DC\u80CA\u80D5\u80C9\u80CF\u80D7\u80E6\u80CD\u81FF\u8221\u8294\u82D9\u82FE\u82F9\u8307\u82E8\u8300\u82D5\u833A\u82EB\u82D6\u82F4\u82EC\u82E1\u82F2\u82F5\u830C\u82FB\u82F6\u82F0\u82EA"],["d0a1","\u82E4\u82E0\u82FA\u82F3\u82ED\u8677\u8674\u867C\u8673\u8841\u884E\u8867\u886A\u8869\u89D3\u8A04\u8A07\u8D72\u8FE3\u8FE1\u8FEE\u8FE0\u90F1\u90BD\u90BF\u90D5\u90C5\u90BE\u90C7\u90CB\u90C8\u91D4\u91D3\u9654\u964F\u9651\u9653\u964A\u964E\u501E\u5005\u5007\u5013\u5022\u5030\u501B\u4FF5\u4FF4\u5033\u5037\u502C\u4FF6\u4FF7\u5017\u501C\u5020\u5027\u5035\u502F\u5031\u500E\u515A\u5194\u5193\u51CA\u51C4\u51C5\u51C8\u51CE\u5261\u525A\u5252\u525E\u525F\u5255\u5262\u52CD\u530E\u539E\u5526\u54E2\u5517\u5512\u54E7\u54F3\u54E4\u551A\u54FF\u5504\u5508\u54EB\u5511\u5505\u54F1"],["d140","\u550A\u54FB\u54F7\u54F8\u54E0\u550E\u5503\u550B\u5701\u5702\u57CC\u5832\u57D5\u57D2\u57BA\u57C6\u57BD\u57BC\u57B8\u57B6\u57BF\u57C7\u57D0\u57B9\u57C1\u590E\u594A\u5A19\u5A16\u5A2D\u5A2E\u5A15\u5A0F\u5A17\u5A0A\u5A1E\u5A33\u5B6C\u5BA7\u5BAD\u5BAC\u5C03\u5C56\u5C54\u5CEC\u5CFF\u5CEE\u5CF1\u5CF7\u5D00\u5CF9\u5E29\u5E28\u5EA8\u5EAE\u5EAA\u5EAC\u5F33\u5F30\u5F67\u605D\u605A\u6067"],["d1a1","\u6041\u60A2\u6088\u6080\u6092\u6081\u609D\u6083\u6095\u609B\u6097\u6087\u609C\u608E\u6219\u6246\u62F2\u6310\u6356\u632C\u6344\u6345\u6336\u6343\u63E4\u6339\u634B\u634A\u633C\u6329\u6341\u6334\u6358\u6354\u6359\u632D\u6347\u6333\u635A\u6351\u6338\u6357\u6340\u6348\u654A\u6546\u65C6\u65C3\u65C4\u65C2\u664A\u665F\u6647\u6651\u6712\u6713\u681F\u681A\u6849\u6832\u6833\u683B\u684B\u684F\u6816\u6831\u681C\u6835\u682B\u682D\u682F\u684E\u6844\u6834\u681D\u6812\u6814\u6826\u6828\u682E\u684D\u683A\u6825\u6820\u6B2C\u6B2F\u6B2D\u6B31\u6B34\u6B6D\u8082\u6B88\u6BE6\u6BE4"],["d240","\u6BE8\u6BE3\u6BE2\u6BE7\u6C25\u6D7A\u6D63\u6D64\u6D76\u6D0D\u6D61\u6D92\u6D58\u6D62\u6D6D\u6D6F\u6D91\u6D8D\u6DEF\u6D7F\u6D86\u6D5E\u6D67\u6D60\u6D97\u6D70\u6D7C\u6D5F\u6D82\u6D98\u6D2F\u6D68\u6D8B\u6D7E\u6D80\u6D84\u6D16\u6D83\u6D7B\u6D7D\u6D75\u6D90\u70DC\u70D3\u70D1\u70DD\u70CB\u7F39\u70E2\u70D7\u70D2\u70DE\u70E0\u70D4\u70CD\u70C5\u70C6\u70C7\u70DA\u70CE\u70E1\u7242\u7278"],["d2a1","\u7277\u7276\u7300\u72FA\u72F4\u72FE\u72F6\u72F3\u72FB\u7301\u73D3\u73D9\u73E5\u73D6\u73BC\u73E7\u73E3\u73E9\u73DC\u73D2\u73DB\u73D4\u73DD\u73DA\u73D7\u73D8\u73E8\u74DE\u74DF\u74F4\u74F5\u7521\u755B\u755F\u75B0\u75C1\u75BB\u75C4\u75C0\u75BF\u75B6\u75BA\u768A\u76C9\u771D\u771B\u7710\u7713\u7712\u7723\u7711\u7715\u7719\u771A\u7722\u7727\u7823\u782C\u7822\u7835\u782F\u7828\u782E\u782B\u7821\u7829\u7833\u782A\u7831\u7954\u795B\u794F\u795C\u7953\u7952\u7951\u79EB\u79EC\u79E0\u79EE\u79ED\u79EA\u79DC\u79DE\u79DD\u7A86\u7A89\u7A85\u7A8B\u7A8C\u7A8A\u7A87\u7AD8\u7B10"],["d340","\u7B04\u7B13\u7B05\u7B0F\u7B08\u7B0A\u7B0E\u7B09\u7B12\u7C84\u7C91\u7C8A\u7C8C\u7C88\u7C8D\u7C85\u7D1E\u7D1D\u7D11\u7D0E\u7D18\u7D16\u7D13\u7D1F\u7D12\u7D0F\u7D0C\u7F5C\u7F61\u7F5E\u7F60\u7F5D\u7F5B\u7F96\u7F92\u7FC3\u7FC2\u7FC0\u8016\u803E\u8039\u80FA\u80F2\u80F9\u80F5\u8101\u80FB\u8100\u8201\u822F\u8225\u8333\u832D\u8344\u8319\u8351\u8325\u8356\u833F\u8341\u8326\u831C\u8322"],["d3a1","\u8342\u834E\u831B\u832A\u8308\u833C\u834D\u8316\u8324\u8320\u8337\u832F\u8329\u8347\u8345\u834C\u8353\u831E\u832C\u834B\u8327\u8348\u8653\u8652\u86A2\u86A8\u8696\u868D\u8691\u869E\u8687\u8697\u8686\u868B\u869A\u8685\u86A5\u8699\u86A1\u86A7\u8695\u8698\u868E\u869D\u8690\u8694\u8843\u8844\u886D\u8875\u8876\u8872\u8880\u8871\u887F\u886F\u8883\u887E\u8874\u887C\u8A12\u8C47\u8C57\u8C7B\u8CA4\u8CA3\u8D76\u8D78\u8DB5\u8DB7\u8DB6\u8ED1\u8ED3\u8FFE\u8FF5\u9002\u8FFF\u8FFB\u9004\u8FFC\u8FF6\u90D6\u90E0\u90D9\u90DA\u90E3\u90DF\u90E5\u90D8\u90DB\u90D7\u90DC\u90E4\u9150"],["d440","\u914E\u914F\u91D5\u91E2\u91DA\u965C\u965F\u96BC\u98E3\u9ADF\u9B2F\u4E7F\u5070\u506A\u5061\u505E\u5060\u5053\u504B\u505D\u5072\u5048\u504D\u5041\u505B\u504A\u5062\u5015\u5045\u505F\u5069\u506B\u5063\u5064\u5046\u5040\u506E\u5073\u5057\u5051\u51D0\u526B\u526D\u526C\u526E\u52D6\u52D3\u532D\u539C\u5575\u5576\u553C\u554D\u5550\u5534\u552A\u5551\u5562\u5536\u5535\u5530\u5552\u5545"],["d4a1","\u550C\u5532\u5565\u554E\u5539\u5548\u552D\u553B\u5540\u554B\u570A\u5707\u57FB\u5814\u57E2\u57F6\u57DC\u57F4\u5800\u57ED\u57FD\u5808\u57F8\u580B\u57F3\u57CF\u5807\u57EE\u57E3\u57F2\u57E5\u57EC\u57E1\u580E\u57FC\u5810\u57E7\u5801\u580C\u57F1\u57E9\u57F0\u580D\u5804\u595C\u5A60\u5A58\u5A55\u5A67\u5A5E\u5A38\u5A35\u5A6D\u5A50\u5A5F\u5A65\u5A6C\u5A53\u5A64\u5A57\u5A43\u5A5D\u5A52\u5A44\u5A5B\u5A48\u5A8E\u5A3E\u5A4D\u5A39\u5A4C\u5A70\u5A69\u5A47\u5A51\u5A56\u5A42\u5A5C\u5B72\u5B6E\u5BC1\u5BC0\u5C59\u5D1E\u5D0B\u5D1D\u5D1A\u5D20\u5D0C\u5D28\u5D0D\u5D26\u5D25\u5D0F"],["d540","\u5D30\u5D12\u5D23\u5D1F\u5D2E\u5E3E\u5E34\u5EB1\u5EB4\u5EB9\u5EB2\u5EB3\u5F36\u5F38\u5F9B\u5F96\u5F9F\u608A\u6090\u6086\u60BE\u60B0\u60BA\u60D3\u60D4\u60CF\u60E4\u60D9\u60DD\u60C8\u60B1\u60DB\u60B7\u60CA\u60BF\u60C3\u60CD\u60C0\u6332\u6365\u638A\u6382\u637D\u63BD\u639E\u63AD\u639D\u6397\u63AB\u638E\u636F\u6387\u6390\u636E\u63AF\u6375\u639C\u636D\u63AE\u637C\u63A4\u633B\u639F"],["d5a1","\u6378\u6385\u6381\u6391\u638D\u6370\u6553\u65CD\u6665\u6661\u665B\u6659\u665C\u6662\u6718\u6879\u6887\u6890\u689C\u686D\u686E\u68AE\u68AB\u6956\u686F\u68A3\u68AC\u68A9\u6875\u6874\u68B2\u688F\u6877\u6892\u687C\u686B\u6872\u68AA\u6880\u6871\u687E\u689B\u6896\u688B\u68A0\u6889\u68A4\u6878\u687B\u6891\u688C\u688A\u687D\u6B36\u6B33\u6B37\u6B38\u6B91\u6B8F\u6B8D\u6B8E\u6B8C\u6C2A\u6DC0\u6DAB\u6DB4\u6DB3\u6E74\u6DAC\u6DE9\u6DE2\u6DB7\u6DF6\u6DD4\u6E00\u6DC8\u6DE0\u6DDF\u6DD6\u6DBE\u6DE5\u6DDC\u6DDD\u6DDB\u6DF4\u6DCA\u6DBD\u6DED\u6DF0\u6DBA\u6DD5\u6DC2\u6DCF\u6DC9"],["d640","\u6DD0\u6DF2\u6DD3\u6DFD\u6DD7\u6DCD\u6DE3\u6DBB\u70FA\u710D\u70F7\u7117\u70F4\u710C\u70F0\u7104\u70F3\u7110\u70FC\u70FF\u7106\u7113\u7100\u70F8\u70F6\u710B\u7102\u710E\u727E\u727B\u727C\u727F\u731D\u7317\u7307\u7311\u7318\u730A\u7308\u72FF\u730F\u731E\u7388\u73F6\u73F8\u73F5\u7404\u7401\u73FD\u7407\u7400\u73FA\u73FC\u73FF\u740C\u740B\u73F4\u7408\u7564\u7563\u75CE\u75D2\u75CF"],["d6a1","\u75CB\u75CC\u75D1\u75D0\u768F\u7689\u76D3\u7739\u772F\u772D\u7731\u7732\u7734\u7733\u773D\u7725\u773B\u7735\u7848\u7852\u7849\u784D\u784A\u784C\u7826\u7845\u7850\u7964\u7967\u7969\u796A\u7963\u796B\u7961\u79BB\u79FA\u79F8\u79F6\u79F7\u7A8F\u7A94\u7A90\u7B35\u7B47\u7B34\u7B25\u7B30\u7B22\u7B24\u7B33\u7B18\u7B2A\u7B1D\u7B31\u7B2B\u7B2D\u7B2F\u7B32\u7B38\u7B1A\u7B23\u7C94\u7C98\u7C96\u7CA3\u7D35\u7D3D\u7D38\u7D36\u7D3A\u7D45\u7D2C\u7D29\u7D41\u7D47\u7D3E\u7D3F\u7D4A\u7D3B\u7D28\u7F63\u7F95\u7F9C\u7F9D\u7F9B\u7FCA\u7FCB\u7FCD\u7FD0\u7FD1\u7FC7\u7FCF\u7FC9\u801F"],["d740","\u801E\u801B\u8047\u8043\u8048\u8118\u8125\u8119\u811B\u812D\u811F\u812C\u811E\u8121\u8115\u8127\u811D\u8122\u8211\u8238\u8233\u823A\u8234\u8232\u8274\u8390\u83A3\u83A8\u838D\u837A\u8373\u83A4\u8374\u838F\u8381\u8395\u8399\u8375\u8394\u83A9\u837D\u8383\u838C\u839D\u839B\u83AA\u838B\u837E\u83A5\u83AF\u8388\u8397\u83B0\u837F\u83A6\u8387\u83AE\u8376\u839A\u8659\u8656\u86BF\u86B7"],["d7a1","\u86C2\u86C1\u86C5\u86BA\u86B0\u86C8\u86B9\u86B3\u86B8\u86CC\u86B4\u86BB\u86BC\u86C3\u86BD\u86BE\u8852\u8889\u8895\u88A8\u88A2\u88AA\u889A\u8891\u88A1\u889F\u8898\u88A7\u8899\u889B\u8897\u88A4\u88AC\u888C\u8893\u888E\u8982\u89D6\u89D9\u89D5\u8A30\u8A27\u8A2C\u8A1E\u8C39\u8C3B\u8C5C\u8C5D\u8C7D\u8CA5\u8D7D\u8D7B\u8D79\u8DBC\u8DC2\u8DB9\u8DBF\u8DC1\u8ED8\u8EDE\u8EDD\u8EDC\u8ED7\u8EE0\u8EE1\u9024\u900B\u9011\u901C\u900C\u9021\u90EF\u90EA\u90F0\u90F4\u90F2\u90F3\u90D4\u90EB\u90EC\u90E9\u9156\u9158\u915A\u9153\u9155\u91EC\u91F4\u91F1\u91F3\u91F8\u91E4\u91F9\u91EA"],["d840","\u91EB\u91F7\u91E8\u91EE\u957A\u9586\u9588\u967C\u966D\u966B\u9671\u966F\u96BF\u976A\u9804\u98E5\u9997\u509B\u5095\u5094\u509E\u508B\u50A3\u5083\u508C\u508E\u509D\u5068\u509C\u5092\u5082\u5087\u515F\u51D4\u5312\u5311\u53A4\u53A7\u5591\u55A8\u55A5\u55AD\u5577\u5645\u55A2\u5593\u5588\u558F\u55B5\u5581\u55A3\u5592\u55A4\u557D\u558C\u55A6\u557F\u5595\u55A1\u558E\u570C\u5829\u5837"],["d8a1","\u5819\u581E\u5827\u5823\u5828\u57F5\u5848\u5825\u581C\u581B\u5833\u583F\u5836\u582E\u5839\u5838\u582D\u582C\u583B\u5961\u5AAF\u5A94\u5A9F\u5A7A\u5AA2\u5A9E\u5A78\u5AA6\u5A7C\u5AA5\u5AAC\u5A95\u5AAE\u5A37\u5A84\u5A8A\u5A97\u5A83\u5A8B\u5AA9\u5A7B\u5A7D\u5A8C\u5A9C\u5A8F\u5A93\u5A9D\u5BEA\u5BCD\u5BCB\u5BD4\u5BD1\u5BCA\u5BCE\u5C0C\u5C30\u5D37\u5D43\u5D6B\u5D41\u5D4B\u5D3F\u5D35\u5D51\u5D4E\u5D55\u5D33\u5D3A\u5D52\u5D3D\u5D31\u5D59\u5D42\u5D39\u5D49\u5D38\u5D3C\u5D32\u5D36\u5D40\u5D45\u5E44\u5E41\u5F58\u5FA6\u5FA5\u5FAB\u60C9\u60B9\u60CC\u60E2\u60CE\u60C4\u6114"],["d940","\u60F2\u610A\u6116\u6105\u60F5\u6113\u60F8\u60FC\u60FE\u60C1\u6103\u6118\u611D\u6110\u60FF\u6104\u610B\u624A\u6394\u63B1\u63B0\u63CE\u63E5\u63E8\u63EF\u63C3\u649D\u63F3\u63CA\u63E0\u63F6\u63D5\u63F2\u63F5\u6461\u63DF\u63BE\u63DD\u63DC\u63C4\u63D8\u63D3\u63C2\u63C7\u63CC\u63CB\u63C8\u63F0\u63D7\u63D9\u6532\u6567\u656A\u6564\u655C\u6568\u6565\u658C\u659D\u659E\u65AE\u65D0\u65D2"],["d9a1","\u667C\u666C\u667B\u6680\u6671\u6679\u666A\u6672\u6701\u690C\u68D3\u6904\u68DC\u692A\u68EC\u68EA\u68F1\u690F\u68D6\u68F7\u68EB\u68E4\u68F6\u6913\u6910\u68F3\u68E1\u6907\u68CC\u6908\u6970\u68B4\u6911\u68EF\u68C6\u6914\u68F8\u68D0\u68FD\u68FC\u68E8\u690B\u690A\u6917\u68CE\u68C8\u68DD\u68DE\u68E6\u68F4\u68D1\u6906\u68D4\u68E9\u6915\u6925\u68C7\u6B39\u6B3B\u6B3F\u6B3C\u6B94\u6B97\u6B99\u6B95\u6BBD\u6BF0\u6BF2\u6BF3\u6C30\u6DFC\u6E46\u6E47\u6E1F\u6E49\u6E88\u6E3C\u6E3D\u6E45\u6E62\u6E2B\u6E3F\u6E41\u6E5D\u6E73\u6E1C\u6E33\u6E4B\u6E40\u6E51\u6E3B\u6E03\u6E2E\u6E5E"],["da40","\u6E68\u6E5C\u6E61\u6E31\u6E28\u6E60\u6E71\u6E6B\u6E39\u6E22\u6E30\u6E53\u6E65\u6E27\u6E78\u6E64\u6E77\u6E55\u6E79\u6E52\u6E66\u6E35\u6E36\u6E5A\u7120\u711E\u712F\u70FB\u712E\u7131\u7123\u7125\u7122\u7132\u711F\u7128\u713A\u711B\u724B\u725A\u7288\u7289\u7286\u7285\u728B\u7312\u730B\u7330\u7322\u7331\u7333\u7327\u7332\u732D\u7326\u7323\u7335\u730C\u742E\u742C\u7430\u742B\u7416"],["daa1","\u741A\u7421\u742D\u7431\u7424\u7423\u741D\u7429\u7420\u7432\u74FB\u752F\u756F\u756C\u75E7\u75DA\u75E1\u75E6\u75DD\u75DF\u75E4\u75D7\u7695\u7692\u76DA\u7746\u7747\u7744\u774D\u7745\u774A\u774E\u774B\u774C\u77DE\u77EC\u7860\u7864\u7865\u785C\u786D\u7871\u786A\u786E\u7870\u7869\u7868\u785E\u7862\u7974\u7973\u7972\u7970\u7A02\u7A0A\u7A03\u7A0C\u7A04\u7A99\u7AE6\u7AE4\u7B4A\u7B3B\u7B44\u7B48\u7B4C\u7B4E\u7B40\u7B58\u7B45\u7CA2\u7C9E\u7CA8\u7CA1\u7D58\u7D6F\u7D63\u7D53\u7D56\u7D67\u7D6A\u7D4F\u7D6D\u7D5C\u7D6B\u7D52\u7D54\u7D69\u7D51\u7D5F\u7D4E\u7F3E\u7F3F\u7F65"],["db40","\u7F66\u7FA2\u7FA0\u7FA1\u7FD7\u8051\u804F\u8050\u80FE\u80D4\u8143\u814A\u8152\u814F\u8147\u813D\u814D\u813A\u81E6\u81EE\u81F7\u81F8\u81F9\u8204\u823C\u823D\u823F\u8275\u833B\u83CF\u83F9\u8423\u83C0\u83E8\u8412\u83E7\u83E4\u83FC\u83F6\u8410\u83C6\u83C8\u83EB\u83E3\u83BF\u8401\u83DD\u83E5\u83D8\u83FF\u83E1\u83CB\u83CE\u83D6\u83F5\u83C9\u8409\u840F\u83DE\u8411\u8406\u83C2\u83F3"],["dba1","\u83D5\u83FA\u83C7\u83D1\u83EA\u8413\u83C3\u83EC\u83EE\u83C4\u83FB\u83D7\u83E2\u841B\u83DB\u83FE\u86D8\u86E2\u86E6\u86D3\u86E3\u86DA\u86EA\u86DD\u86EB\u86DC\u86EC\u86E9\u86D7\u86E8\u86D1\u8848\u8856\u8855\u88BA\u88D7\u88B9\u88B8\u88C0\u88BE\u88B6\u88BC\u88B7\u88BD\u88B2\u8901\u88C9\u8995\u8998\u8997\u89DD\u89DA\u89DB\u8A4E\u8A4D\u8A39\u8A59\u8A40\u8A57\u8A58\u8A44\u8A45\u8A52\u8A48\u8A51\u8A4A\u8A4C\u8A4F\u8C5F\u8C81\u8C80\u8CBA\u8CBE\u8CB0\u8CB9\u8CB5\u8D84\u8D80\u8D89\u8DD8\u8DD3\u8DCD\u8DC7\u8DD6\u8DDC\u8DCF\u8DD5\u8DD9\u8DC8\u8DD7\u8DC5\u8EEF\u8EF7\u8EFA"],["dc40","\u8EF9\u8EE6\u8EEE\u8EE5\u8EF5\u8EE7\u8EE8\u8EF6\u8EEB\u8EF1\u8EEC\u8EF4\u8EE9\u902D\u9034\u902F\u9106\u912C\u9104\u90FF\u90FC\u9108\u90F9\u90FB\u9101\u9100\u9107\u9105\u9103\u9161\u9164\u915F\u9162\u9160\u9201\u920A\u9225\u9203\u921A\u9226\u920F\u920C\u9200\u9212\u91FF\u91FD\u9206\u9204\u9227\u9202\u921C\u9224\u9219\u9217\u9205\u9216\u957B\u958D\u958C\u9590\u9687\u967E\u9688"],["dca1","\u9689\u9683\u9680\u96C2\u96C8\u96C3\u96F1\u96F0\u976C\u9770\u976E\u9807\u98A9\u98EB\u9CE6\u9EF9\u4E83\u4E84\u4EB6\u50BD\u50BF\u50C6\u50AE\u50C4\u50CA\u50B4\u50C8\u50C2\u50B0\u50C1\u50BA\u50B1\u50CB\u50C9\u50B6\u50B8\u51D7\u527A\u5278\u527B\u527C\u55C3\u55DB\u55CC\u55D0\u55CB\u55CA\u55DD\u55C0\u55D4\u55C4\u55E9\u55BF\u55D2\u558D\u55CF\u55D5\u55E2\u55D6\u55C8\u55F2\u55CD\u55D9\u55C2\u5714\u5853\u5868\u5864\u584F\u584D\u5849\u586F\u5855\u584E\u585D\u5859\u5865\u585B\u583D\u5863\u5871\u58FC\u5AC7\u5AC4\u5ACB\u5ABA\u5AB8\u5AB1\u5AB5\u5AB0\u5ABF\u5AC8\u5ABB\u5AC6"],["dd40","\u5AB7\u5AC0\u5ACA\u5AB4\u5AB6\u5ACD\u5AB9\u5A90\u5BD6\u5BD8\u5BD9\u5C1F\u5C33\u5D71\u5D63\u5D4A\u5D65\u5D72\u5D6C\u5D5E\u5D68\u5D67\u5D62\u5DF0\u5E4F\u5E4E\u5E4A\u5E4D\u5E4B\u5EC5\u5ECC\u5EC6\u5ECB\u5EC7\u5F40\u5FAF\u5FAD\u60F7\u6149\u614A\u612B\u6145\u6136\u6132\u612E\u6146\u612F\u614F\u6129\u6140\u6220\u9168\u6223\u6225\u6224\u63C5\u63F1\u63EB\u6410\u6412\u6409\u6420\u6424"],["dda1","\u6433\u6443\u641F\u6415\u6418\u6439\u6437\u6422\u6423\u640C\u6426\u6430\u6428\u6441\u6435\u642F\u640A\u641A\u6440\u6425\u6427\u640B\u63E7\u641B\u642E\u6421\u640E\u656F\u6592\u65D3\u6686\u668C\u6695\u6690\u668B\u668A\u6699\u6694\u6678\u6720\u6966\u695F\u6938\u694E\u6962\u6971\u693F\u6945\u696A\u6939\u6942\u6957\u6959\u697A\u6948\u6949\u6935\u696C\u6933\u693D\u6965\u68F0\u6978\u6934\u6969\u6940\u696F\u6944\u6976\u6958\u6941\u6974\u694C\u693B\u694B\u6937\u695C\u694F\u6951\u6932\u6952\u692F\u697B\u693C\u6B46\u6B45\u6B43\u6B42\u6B48\u6B41\u6B9B\uFA0D\u6BFB\u6BFC"],["de40","\u6BF9\u6BF7\u6BF8\u6E9B\u6ED6\u6EC8\u6E8F\u6EC0\u6E9F\u6E93\u6E94\u6EA0\u6EB1\u6EB9\u6EC6\u6ED2\u6EBD\u6EC1\u6E9E\u6EC9\u6EB7\u6EB0\u6ECD\u6EA6\u6ECF\u6EB2\u6EBE\u6EC3\u6EDC\u6ED8\u6E99\u6E92\u6E8E\u6E8D\u6EA4\u6EA1\u6EBF\u6EB3\u6ED0\u6ECA\u6E97\u6EAE\u6EA3\u7147\u7154\u7152\u7163\u7160\u7141\u715D\u7162\u7172\u7178\u716A\u7161\u7142\u7158\u7143\u714B\u7170\u715F\u7150\u7153"],["dea1","\u7144\u714D\u715A\u724F\u728D\u728C\u7291\u7290\u728E\u733C\u7342\u733B\u733A\u7340\u734A\u7349\u7444\u744A\u744B\u7452\u7451\u7457\u7440\u744F\u7450\u744E\u7442\u7446\u744D\u7454\u74E1\u74FF\u74FE\u74FD\u751D\u7579\u7577\u6983\u75EF\u760F\u7603\u75F7\u75FE\u75FC\u75F9\u75F8\u7610\u75FB\u75F6\u75ED\u75F5\u75FD\u7699\u76B5\u76DD\u7755\u775F\u7760\u7752\u7756\u775A\u7769\u7767\u7754\u7759\u776D\u77E0\u7887\u789A\u7894\u788F\u7884\u7895\u7885\u7886\u78A1\u7883\u7879\u7899\u7880\u7896\u787B\u797C\u7982\u797D\u7979\u7A11\u7A18\u7A19\u7A12\u7A17\u7A15\u7A22\u7A13"],["df40","\u7A1B\u7A10\u7AA3\u7AA2\u7A9E\u7AEB\u7B66\u7B64\u7B6D\u7B74\u7B69\u7B72\u7B65\u7B73\u7B71\u7B70\u7B61\u7B78\u7B76\u7B63\u7CB2\u7CB4\u7CAF\u7D88\u7D86\u7D80\u7D8D\u7D7F\u7D85\u7D7A\u7D8E\u7D7B\u7D83\u7D7C\u7D8C\u7D94\u7D84\u7D7D\u7D92\u7F6D\u7F6B\u7F67\u7F68\u7F6C\u7FA6\u7FA5\u7FA7\u7FDB\u7FDC\u8021\u8164\u8160\u8177\u815C\u8169\u815B\u8162\u8172\u6721\u815E\u8176\u8167\u816F"],["dfa1","\u8144\u8161\u821D\u8249\u8244\u8240\u8242\u8245\u84F1\u843F\u8456\u8476\u8479\u848F\u848D\u8465\u8451\u8440\u8486\u8467\u8430\u844D\u847D\u845A\u8459\u8474\u8473\u845D\u8507\u845E\u8437\u843A\u8434\u847A\u8443\u8478\u8432\u8445\u8429\u83D9\u844B\u842F\u8442\u842D\u845F\u8470\u8439\u844E\u844C\u8452\u846F\u84C5\u848E\u843B\u8447\u8436\u8433\u8468\u847E\u8444\u842B\u8460\u8454\u846E\u8450\u870B\u8704\u86F7\u870C\u86FA\u86D6\u86F5\u874D\u86F8\u870E\u8709\u8701\u86F6\u870D\u8705\u88D6\u88CB\u88CD\u88CE\u88DE\u88DB\u88DA\u88CC\u88D0\u8985\u899B\u89DF\u89E5\u89E4"],["e040","\u89E1\u89E0\u89E2\u89DC\u89E6\u8A76\u8A86\u8A7F\u8A61\u8A3F\u8A77\u8A82\u8A84\u8A75\u8A83\u8A81\u8A74\u8A7A\u8C3C\u8C4B\u8C4A\u8C65\u8C64\u8C66\u8C86\u8C84\u8C85\u8CCC\u8D68\u8D69\u8D91\u8D8C\u8D8E\u8D8F\u8D8D\u8D93\u8D94\u8D90\u8D92\u8DF0\u8DE0\u8DEC\u8DF1\u8DEE\u8DD0\u8DE9\u8DE3\u8DE2\u8DE7\u8DF2\u8DEB\u8DF4\u8F06\u8EFF\u8F01\u8F00\u8F05\u8F07\u8F08\u8F02\u8F0B\u9052\u903F"],["e0a1","\u9044\u9049\u903D\u9110\u910D\u910F\u9111\u9116\u9114\u910B\u910E\u916E\u916F\u9248\u9252\u9230\u923A\u9266\u9233\u9265\u925E\u9283\u922E\u924A\u9246\u926D\u926C\u924F\u9260\u9267\u926F\u9236\u9261\u9270\u9231\u9254\u9263\u9250\u9272\u924E\u9253\u924C\u9256\u9232\u959F\u959C\u959E\u959B\u9692\u9693\u9691\u9697\u96CE\u96FA\u96FD\u96F8\u96F5\u9773\u9777\u9778\u9772\u980F\u980D\u980E\u98AC\u98F6\u98F9\u99AF\u99B2\u99B0\u99B5\u9AAD\u9AAB\u9B5B\u9CEA\u9CED\u9CE7\u9E80\u9EFD\u50E6\u50D4\u50D7\u50E8\u50F3\u50DB\u50EA\u50DD\u50E4\u50D3\u50EC\u50F0\u50EF\u50E3\u50E0"],["e140","\u51D8\u5280\u5281\u52E9\u52EB\u5330\u53AC\u5627\u5615\u560C\u5612\u55FC\u560F\u561C\u5601\u5613\u5602\u55FA\u561D\u5604\u55FF\u55F9\u5889\u587C\u5890\u5898\u5886\u5881\u587F\u5874\u588B\u587A\u5887\u5891\u588E\u5876\u5882\u5888\u587B\u5894\u588F\u58FE\u596B\u5ADC\u5AEE\u5AE5\u5AD5\u5AEA\u5ADA\u5AED\u5AEB\u5AF3\u5AE2\u5AE0\u5ADB\u5AEC\u5ADE\u5ADD\u5AD9\u5AE8\u5ADF\u5B77\u5BE0"],["e1a1","\u5BE3\u5C63\u5D82\u5D80\u5D7D\u5D86\u5D7A\u5D81\u5D77\u5D8A\u5D89\u5D88\u5D7E\u5D7C\u5D8D\u5D79\u5D7F\u5E58\u5E59\u5E53\u5ED8\u5ED1\u5ED7\u5ECE\u5EDC\u5ED5\u5ED9\u5ED2\u5ED4\u5F44\u5F43\u5F6F\u5FB6\u612C\u6128\u6141\u615E\u6171\u6173\u6152\u6153\u6172\u616C\u6180\u6174\u6154\u617A\u615B\u6165\u613B\u616A\u6161\u6156\u6229\u6227\u622B\u642B\u644D\u645B\u645D\u6474\u6476\u6472\u6473\u647D\u6475\u6466\u64A6\u644E\u6482\u645E\u645C\u644B\u6453\u6460\u6450\u647F\u643F\u646C\u646B\u6459\u6465\u6477\u6573\u65A0\u66A1\u66A0\u669F\u6705\u6704\u6722\u69B1\u69B6\u69C9"],["e240","\u69A0\u69CE\u6996\u69B0\u69AC\u69BC\u6991\u6999\u698E\u69A7\u698D\u69A9\u69BE\u69AF\u69BF\u69C4\u69BD\u69A4\u69D4\u69B9\u69CA\u699A\u69CF\u69B3\u6993\u69AA\u69A1\u699E\u69D9\u6997\u6990\u69C2\u69B5\u69A5\u69C6\u6B4A\u6B4D\u6B4B\u6B9E\u6B9F\u6BA0\u6BC3\u6BC4\u6BFE\u6ECE\u6EF5\u6EF1\u6F03\u6F25\u6EF8\u6F37\u6EFB\u6F2E\u6F09\u6F4E\u6F19\u6F1A\u6F27\u6F18\u6F3B\u6F12\u6EED\u6F0A"],["e2a1","\u6F36\u6F73\u6EF9\u6EEE\u6F2D\u6F40\u6F30\u6F3C\u6F35\u6EEB\u6F07\u6F0E\u6F43\u6F05\u6EFD\u6EF6\u6F39\u6F1C\u6EFC\u6F3A\u6F1F\u6F0D\u6F1E\u6F08\u6F21\u7187\u7190\u7189\u7180\u7185\u7182\u718F\u717B\u7186\u7181\u7197\u7244\u7253\u7297\u7295\u7293\u7343\u734D\u7351\u734C\u7462\u7473\u7471\u7475\u7472\u7467\u746E\u7500\u7502\u7503\u757D\u7590\u7616\u7608\u760C\u7615\u7611\u760A\u7614\u76B8\u7781\u777C\u7785\u7782\u776E\u7780\u776F\u777E\u7783\u78B2\u78AA\u78B4\u78AD\u78A8\u787E\u78AB\u789E\u78A5\u78A0\u78AC\u78A2\u78A4\u7998\u798A\u798B\u7996\u7995\u7994\u7993"],["e340","\u7997\u7988\u7992\u7990\u7A2B\u7A4A\u7A30\u7A2F\u7A28\u7A26\u7AA8\u7AAB\u7AAC\u7AEE\u7B88\u7B9C\u7B8A\u7B91\u7B90\u7B96\u7B8D\u7B8C\u7B9B\u7B8E\u7B85\u7B98\u5284\u7B99\u7BA4\u7B82\u7CBB\u7CBF\u7CBC\u7CBA\u7DA7\u7DB7\u7DC2\u7DA3\u7DAA\u7DC1\u7DC0\u7DC5\u7D9D\u7DCE\u7DC4\u7DC6\u7DCB\u7DCC\u7DAF\u7DB9\u7D96\u7DBC\u7D9F\u7DA6\u7DAE\u7DA9\u7DA1\u7DC9\u7F73\u7FE2\u7FE3\u7FE5\u7FDE"],["e3a1","\u8024\u805D\u805C\u8189\u8186\u8183\u8187\u818D\u818C\u818B\u8215\u8497\u84A4\u84A1\u849F\u84BA\u84CE\u84C2\u84AC\u84AE\u84AB\u84B9\u84B4\u84C1\u84CD\u84AA\u849A\u84B1\u84D0\u849D\u84A7\u84BB\u84A2\u8494\u84C7\u84CC\u849B\u84A9\u84AF\u84A8\u84D6\u8498\u84B6\u84CF\u84A0\u84D7\u84D4\u84D2\u84DB\u84B0\u8491\u8661\u8733\u8723\u8728\u876B\u8740\u872E\u871E\u8721\u8719\u871B\u8743\u872C\u8741\u873E\u8746\u8720\u8732\u872A\u872D\u873C\u8712\u873A\u8731\u8735\u8742\u8726\u8727\u8738\u8724\u871A\u8730\u8711\u88F7\u88E7\u88F1\u88F2\u88FA\u88FE\u88EE\u88FC\u88F6\u88FB"],["e440","\u88F0\u88EC\u88EB\u899D\u89A1\u899F\u899E\u89E9\u89EB\u89E8\u8AAB\u8A99\u8A8B\u8A92\u8A8F\u8A96\u8C3D\u8C68\u8C69\u8CD5\u8CCF\u8CD7\u8D96\u8E09\u8E02\u8DFF\u8E0D\u8DFD\u8E0A\u8E03\u8E07\u8E06\u8E05\u8DFE\u8E00\u8E04\u8F10\u8F11\u8F0E\u8F0D\u9123\u911C\u9120\u9122\u911F\u911D\u911A\u9124\u9121\u911B\u917A\u9172\u9179\u9173\u92A5\u92A4\u9276\u929B\u927A\u92A0\u9294\u92AA\u928D"],["e4a1","\u92A6\u929A\u92AB\u9279\u9297\u927F\u92A3\u92EE\u928E\u9282\u9295\u92A2\u927D\u9288\u92A1\u928A\u9286\u928C\u9299\u92A7\u927E\u9287\u92A9\u929D\u928B\u922D\u969E\u96A1\u96FF\u9758\u977D\u977A\u977E\u9783\u9780\u9782\u977B\u9784\u9781\u977F\u97CE\u97CD\u9816\u98AD\u98AE\u9902\u9900\u9907\u999D\u999C\u99C3\u99B9\u99BB\u99BA\u99C2\u99BD\u99C7\u9AB1\u9AE3\u9AE7\u9B3E\u9B3F\u9B60\u9B61\u9B5F\u9CF1\u9CF2\u9CF5\u9EA7\u50FF\u5103\u5130\u50F8\u5106\u5107\u50F6\u50FE\u510B\u510C\u50FD\u510A\u528B\u528C\u52F1\u52EF\u5648\u5642\u564C\u5635\u5641\u564A\u5649\u5646\u5658"],["e540","\u565A\u5640\u5633\u563D\u562C\u563E\u5638\u562A\u563A\u571A\u58AB\u589D\u58B1\u58A0\u58A3\u58AF\u58AC\u58A5\u58A1\u58FF\u5AFF\u5AF4\u5AFD\u5AF7\u5AF6\u5B03\u5AF8\u5B02\u5AF9\u5B01\u5B07\u5B05\u5B0F\u5C67\u5D99\u5D97\u5D9F\u5D92\u5DA2\u5D93\u5D95\u5DA0\u5D9C\u5DA1\u5D9A\u5D9E\u5E69\u5E5D\u5E60\u5E5C\u7DF3\u5EDB\u5EDE\u5EE1\u5F49\u5FB2\u618B\u6183\u6179\u61B1\u61B0\u61A2\u6189"],["e5a1","\u619B\u6193\u61AF\u61AD\u619F\u6192\u61AA\u61A1\u618D\u6166\u61B3\u622D\u646E\u6470\u6496\u64A0\u6485\u6497\u649C\u648F\u648B\u648A\u648C\u64A3\u649F\u6468\u64B1\u6498\u6576\u657A\u6579\u657B\u65B2\u65B3\u66B5\u66B0\u66A9\u66B2\u66B7\u66AA\u66AF\u6A00\u6A06\u6A17\u69E5\u69F8\u6A15\u69F1\u69E4\u6A20\u69FF\u69EC\u69E2\u6A1B\u6A1D\u69FE\u6A27\u69F2\u69EE\u6A14\u69F7\u69E7\u6A40\u6A08\u69E6\u69FB\u6A0D\u69FC\u69EB\u6A09\u6A04\u6A18\u6A25\u6A0F\u69F6\u6A26\u6A07\u69F4\u6A16\u6B51\u6BA5\u6BA3\u6BA2\u6BA6\u6C01\u6C00\u6BFF\u6C02\u6F41\u6F26\u6F7E\u6F87\u6FC6\u6F92"],["e640","\u6F8D\u6F89\u6F8C\u6F62\u6F4F\u6F85\u6F5A\u6F96\u6F76\u6F6C\u6F82\u6F55\u6F72\u6F52\u6F50\u6F57\u6F94\u6F93\u6F5D\u6F00\u6F61\u6F6B\u6F7D\u6F67\u6F90\u6F53\u6F8B\u6F69\u6F7F\u6F95\u6F63\u6F77\u6F6A\u6F7B\u71B2\u71AF\u719B\u71B0\u71A0\u719A\u71A9\u71B5\u719D\u71A5\u719E\u71A4\u71A1\u71AA\u719C\u71A7\u71B3\u7298\u729A\u7358\u7352\u735E\u735F\u7360\u735D\u735B\u7361\u735A\u7359"],["e6a1","\u7362\u7487\u7489\u748A\u7486\u7481\u747D\u7485\u7488\u747C\u7479\u7508\u7507\u757E\u7625\u761E\u7619\u761D\u761C\u7623\u761A\u7628\u761B\u769C\u769D\u769E\u769B\u778D\u778F\u7789\u7788\u78CD\u78BB\u78CF\u78CC\u78D1\u78CE\u78D4\u78C8\u78C3\u78C4\u78C9\u799A\u79A1\u79A0\u799C\u79A2\u799B\u6B76\u7A39\u7AB2\u7AB4\u7AB3\u7BB7\u7BCB\u7BBE\u7BAC\u7BCE\u7BAF\u7BB9\u7BCA\u7BB5\u7CC5\u7CC8\u7CCC\u7CCB\u7DF7\u7DDB\u7DEA\u7DE7\u7DD7\u7DE1\u7E03\u7DFA\u7DE6\u7DF6\u7DF1\u7DF0\u7DEE\u7DDF\u7F76\u7FAC\u7FB0\u7FAD\u7FED\u7FEB\u7FEA\u7FEC\u7FE6\u7FE8\u8064\u8067\u81A3\u819F"],["e740","\u819E\u8195\u81A2\u8199\u8197\u8216\u824F\u8253\u8252\u8250\u824E\u8251\u8524\u853B\u850F\u8500\u8529\u850E\u8509\u850D\u851F\u850A\u8527\u851C\u84FB\u852B\u84FA\u8508\u850C\u84F4\u852A\u84F2\u8515\u84F7\u84EB\u84F3\u84FC\u8512\u84EA\u84E9\u8516\u84FE\u8528\u851D\u852E\u8502\u84FD\u851E\u84F6\u8531\u8526\u84E7\u84E8\u84F0\u84EF\u84F9\u8518\u8520\u8530\u850B\u8519\u852F\u8662"],["e7a1","\u8756\u8763\u8764\u8777\u87E1\u8773\u8758\u8754\u875B\u8752\u8761\u875A\u8751\u875E\u876D\u876A\u8750\u874E\u875F\u875D\u876F\u876C\u877A\u876E\u875C\u8765\u874F\u877B\u8775\u8762\u8767\u8769\u885A\u8905\u890C\u8914\u890B\u8917\u8918\u8919\u8906\u8916\u8911\u890E\u8909\u89A2\u89A4\u89A3\u89ED\u89F0\u89EC\u8ACF\u8AC6\u8AB8\u8AD3\u8AD1\u8AD4\u8AD5\u8ABB\u8AD7\u8ABE\u8AC0\u8AC5\u8AD8\u8AC3\u8ABA\u8ABD\u8AD9\u8C3E\u8C4D\u8C8F\u8CE5\u8CDF\u8CD9\u8CE8\u8CDA\u8CDD\u8CE7\u8DA0\u8D9C\u8DA1\u8D9B\u8E20\u8E23\u8E25\u8E24\u8E2E\u8E15\u8E1B\u8E16\u8E11\u8E19\u8E26\u8E27"],["e840","\u8E14\u8E12\u8E18\u8E13\u8E1C\u8E17\u8E1A\u8F2C\u8F24\u8F18\u8F1A\u8F20\u8F23\u8F16\u8F17\u9073\u9070\u906F\u9067\u906B\u912F\u912B\u9129\u912A\u9132\u9126\u912E\u9185\u9186\u918A\u9181\u9182\u9184\u9180\u92D0\u92C3\u92C4\u92C0\u92D9\u92B6\u92CF\u92F1\u92DF\u92D8\u92E9\u92D7\u92DD\u92CC\u92EF\u92C2\u92E8\u92CA\u92C8\u92CE\u92E6\u92CD\u92D5\u92C9\u92E0\u92DE\u92E7\u92D1\u92D3"],["e8a1","\u92B5\u92E1\u92C6\u92B4\u957C\u95AC\u95AB\u95AE\u95B0\u96A4\u96A2\u96D3\u9705\u9708\u9702\u975A\u978A\u978E\u9788\u97D0\u97CF\u981E\u981D\u9826\u9829\u9828\u9820\u981B\u9827\u98B2\u9908\u98FA\u9911\u9914\u9916\u9917\u9915\u99DC\u99CD\u99CF\u99D3\u99D4\u99CE\u99C9\u99D6\u99D8\u99CB\u99D7\u99CC\u9AB3\u9AEC\u9AEB\u9AF3\u9AF2\u9AF1\u9B46\u9B43\u9B67\u9B74\u9B71\u9B66\u9B76\u9B75\u9B70\u9B68\u9B64\u9B6C\u9CFC\u9CFA\u9CFD\u9CFF\u9CF7\u9D07\u9D00\u9CF9\u9CFB\u9D08\u9D05\u9D04\u9E83\u9ED3\u9F0F\u9F10\u511C\u5113\u5117\u511A\u5111\u51DE\u5334\u53E1\u5670\u5660\u566E"],["e940","\u5673\u5666\u5663\u566D\u5672\u565E\u5677\u571C\u571B\u58C8\u58BD\u58C9\u58BF\u58BA\u58C2\u58BC\u58C6\u5B17\u5B19\u5B1B\u5B21\u5B14\u5B13\u5B10\u5B16\u5B28\u5B1A\u5B20\u5B1E\u5BEF\u5DAC\u5DB1\u5DA9\u5DA7\u5DB5\u5DB0\u5DAE\u5DAA\u5DA8\u5DB2\u5DAD\u5DAF\u5DB4\u5E67\u5E68\u5E66\u5E6F\u5EE9\u5EE7\u5EE6\u5EE8\u5EE5\u5F4B\u5FBC\u619D\u61A8\u6196\u61C5\u61B4\u61C6\u61C1\u61CC\u61BA"],["e9a1","\u61BF\u61B8\u618C\u64D7\u64D6\u64D0\u64CF\u64C9\u64BD\u6489\u64C3\u64DB\u64F3\u64D9\u6533\u657F\u657C\u65A2\u66C8\u66BE\u66C0\u66CA\u66CB\u66CF\u66BD\u66BB\u66BA\u66CC\u6723\u6A34\u6A66\u6A49\u6A67\u6A32\u6A68\u6A3E\u6A5D\u6A6D\u6A76\u6A5B\u6A51\u6A28\u6A5A\u6A3B\u6A3F\u6A41\u6A6A\u6A64\u6A50\u6A4F\u6A54\u6A6F\u6A69\u6A60\u6A3C\u6A5E\u6A56\u6A55\u6A4D\u6A4E\u6A46\u6B55\u6B54\u6B56\u6BA7\u6BAA\u6BAB\u6BC8\u6BC7\u6C04\u6C03\u6C06\u6FAD\u6FCB\u6FA3\u6FC7\u6FBC\u6FCE\u6FC8\u6F5E\u6FC4\u6FBD\u6F9E\u6FCA\u6FA8\u7004\u6FA5\u6FAE\u6FBA\u6FAC\u6FAA\u6FCF\u6FBF\u6FB8"],["ea40","\u6FA2\u6FC9\u6FAB\u6FCD\u6FAF\u6FB2\u6FB0\u71C5\u71C2\u71BF\u71B8\u71D6\u71C0\u71C1\u71CB\u71D4\u71CA\u71C7\u71CF\u71BD\u71D8\u71BC\u71C6\u71DA\u71DB\u729D\u729E\u7369\u7366\u7367\u736C\u7365\u736B\u736A\u747F\u749A\u74A0\u7494\u7492\u7495\u74A1\u750B\u7580\u762F\u762D\u7631\u763D\u7633\u763C\u7635\u7632\u7630\u76BB\u76E6\u779A\u779D\u77A1\u779C\u779B\u77A2\u77A3\u7795\u7799"],["eaa1","\u7797\u78DD\u78E9\u78E5\u78EA\u78DE\u78E3\u78DB\u78E1\u78E2\u78ED\u78DF\u78E0\u79A4\u7A44\u7A48\u7A47\u7AB6\u7AB8\u7AB5\u7AB1\u7AB7\u7BDE\u7BE3\u7BE7\u7BDD\u7BD5\u7BE5\u7BDA\u7BE8\u7BF9\u7BD4\u7BEA\u7BE2\u7BDC\u7BEB\u7BD8\u7BDF\u7CD2\u7CD4\u7CD7\u7CD0\u7CD1\u7E12\u7E21\u7E17\u7E0C\u7E1F\u7E20\u7E13\u7E0E\u7E1C\u7E15\u7E1A\u7E22\u7E0B\u7E0F\u7E16\u7E0D\u7E14\u7E25\u7E24\u7F43\u7F7B\u7F7C\u7F7A\u7FB1\u7FEF\u802A\u8029\u806C\u81B1\u81A6\u81AE\u81B9\u81B5\u81AB\u81B0\u81AC\u81B4\u81B2\u81B7\u81A7\u81F2\u8255\u8256\u8257\u8556\u8545\u856B\u854D\u8553\u8561\u8558"],["eb40","\u8540\u8546\u8564\u8541\u8562\u8544\u8551\u8547\u8563\u853E\u855B\u8571\u854E\u856E\u8575\u8555\u8567\u8560\u858C\u8566\u855D\u8554\u8565\u856C\u8663\u8665\u8664\u879B\u878F\u8797\u8793\u8792\u8788\u8781\u8796\u8798\u8779\u8787\u87A3\u8785\u8790\u8791\u879D\u8784\u8794\u879C\u879A\u8789\u891E\u8926\u8930\u892D\u892E\u8927\u8931\u8922\u8929\u8923\u892F\u892C\u891F\u89F1\u8AE0"],["eba1","\u8AE2\u8AF2\u8AF4\u8AF5\u8ADD\u8B14\u8AE4\u8ADF\u8AF0\u8AC8\u8ADE\u8AE1\u8AE8\u8AFF\u8AEF\u8AFB\u8C91\u8C92\u8C90\u8CF5\u8CEE\u8CF1\u8CF0\u8CF3\u8D6C\u8D6E\u8DA5\u8DA7\u8E33\u8E3E\u8E38\u8E40\u8E45\u8E36\u8E3C\u8E3D\u8E41\u8E30\u8E3F\u8EBD\u8F36\u8F2E\u8F35\u8F32\u8F39\u8F37\u8F34\u9076\u9079\u907B\u9086\u90FA\u9133\u9135\u9136\u9193\u9190\u9191\u918D\u918F\u9327\u931E\u9308\u931F\u9306\u930F\u937A\u9338\u933C\u931B\u9323\u9312\u9301\u9346\u932D\u930E\u930D\u92CB\u931D\u92FA\u9325\u9313\u92F9\u92F7\u9334\u9302\u9324\u92FF\u9329\u9339\u9335\u932A\u9314\u930C"],["ec40","\u930B\u92FE\u9309\u9300\u92FB\u9316\u95BC\u95CD\u95BE\u95B9\u95BA\u95B6\u95BF\u95B5\u95BD\u96A9\u96D4\u970B\u9712\u9710\u9799\u9797\u9794\u97F0\u97F8\u9835\u982F\u9832\u9924\u991F\u9927\u9929\u999E\u99EE\u99EC\u99E5\u99E4\u99F0\u99E3\u99EA\u99E9\u99E7\u9AB9\u9ABF\u9AB4\u9ABB\u9AF6\u9AFA\u9AF9\u9AF7\u9B33\u9B80\u9B85\u9B87\u9B7C\u9B7E\u9B7B\u9B82\u9B93\u9B92\u9B90\u9B7A\u9B95"],["eca1","\u9B7D\u9B88\u9D25\u9D17\u9D20\u9D1E\u9D14\u9D29\u9D1D\u9D18\u9D22\u9D10\u9D19\u9D1F\u9E88\u9E86\u9E87\u9EAE\u9EAD\u9ED5\u9ED6\u9EFA\u9F12\u9F3D\u5126\u5125\u5122\u5124\u5120\u5129\u52F4\u5693\u568C\u568D\u5686\u5684\u5683\u567E\u5682\u567F\u5681\u58D6\u58D4\u58CF\u58D2\u5B2D\u5B25\u5B32\u5B23\u5B2C\u5B27\u5B26\u5B2F\u5B2E\u5B7B\u5BF1\u5BF2\u5DB7\u5E6C\u5E6A\u5FBE\u5FBB\u61C3\u61B5\u61BC\u61E7\u61E0\u61E5\u61E4\u61E8\u61DE\u64EF\u64E9\u64E3\u64EB\u64E4\u64E8\u6581\u6580\u65B6\u65DA\u66D2\u6A8D\u6A96\u6A81\u6AA5\u6A89\u6A9F\u6A9B\u6AA1\u6A9E\u6A87\u6A93\u6A8E"],["ed40","\u6A95\u6A83\u6AA8\u6AA4\u6A91\u6A7F\u6AA6\u6A9A\u6A85\u6A8C\u6A92\u6B5B\u6BAD\u6C09\u6FCC\u6FA9\u6FF4\u6FD4\u6FE3\u6FDC\u6FED\u6FE7\u6FE6\u6FDE\u6FF2\u6FDD\u6FE2\u6FE8\u71E1\u71F1\u71E8\u71F2\u71E4\u71F0\u71E2\u7373\u736E\u736F\u7497\u74B2\u74AB\u7490\u74AA\u74AD\u74B1\u74A5\u74AF\u7510\u7511\u7512\u750F\u7584\u7643\u7648\u7649\u7647\u76A4\u76E9\u77B5\u77AB\u77B2\u77B7\u77B6"],["eda1","\u77B4\u77B1\u77A8\u77F0\u78F3\u78FD\u7902\u78FB\u78FC\u78F2\u7905\u78F9\u78FE\u7904\u79AB\u79A8\u7A5C\u7A5B\u7A56\u7A58\u7A54\u7A5A\u7ABE\u7AC0\u7AC1\u7C05\u7C0F\u7BF2\u7C00\u7BFF\u7BFB\u7C0E\u7BF4\u7C0B\u7BF3\u7C02\u7C09\u7C03\u7C01\u7BF8\u7BFD\u7C06\u7BF0\u7BF1\u7C10\u7C0A\u7CE8\u7E2D\u7E3C\u7E42\u7E33\u9848\u7E38\u7E2A\u7E49\u7E40\u7E47\u7E29\u7E4C\u7E30\u7E3B\u7E36\u7E44\u7E3A\u7F45\u7F7F\u7F7E\u7F7D\u7FF4\u7FF2\u802C\u81BB\u81C4\u81CC\u81CA\u81C5\u81C7\u81BC\u81E9\u825B\u825A\u825C\u8583\u8580\u858F\u85A7\u8595\u85A0\u858B\u85A3\u857B\u85A4\u859A\u859E"],["ee40","\u8577\u857C\u8589\u85A1\u857A\u8578\u8557\u858E\u8596\u8586\u858D\u8599\u859D\u8581\u85A2\u8582\u8588\u8585\u8579\u8576\u8598\u8590\u859F\u8668\u87BE\u87AA\u87AD\u87C5\u87B0\u87AC\u87B9\u87B5\u87BC\u87AE\u87C9\u87C3\u87C2\u87CC\u87B7\u87AF\u87C4\u87CA\u87B4\u87B6\u87BF\u87B8\u87BD\u87DE\u87B2\u8935\u8933\u893C\u893E\u8941\u8952\u8937\u8942\u89AD\u89AF\u89AE\u89F2\u89F3\u8B1E"],["eea1","\u8B18\u8B16\u8B11\u8B05\u8B0B\u8B22\u8B0F\u8B12\u8B15\u8B07\u8B0D\u8B08\u8B06\u8B1C\u8B13\u8B1A\u8C4F\u8C70\u8C72\u8C71\u8C6F\u8C95\u8C94\u8CF9\u8D6F\u8E4E\u8E4D\u8E53\u8E50\u8E4C\u8E47\u8F43\u8F40\u9085\u907E\u9138\u919A\u91A2\u919B\u9199\u919F\u91A1\u919D\u91A0\u93A1\u9383\u93AF\u9364\u9356\u9347\u937C\u9358\u935C\u9376\u9349\u9350\u9351\u9360\u936D\u938F\u934C\u936A\u9379\u9357\u9355\u9352\u934F\u9371\u9377\u937B\u9361\u935E\u9363\u9367\u9380\u934E\u9359\u95C7\u95C0\u95C9\u95C3\u95C5\u95B7\u96AE\u96B0\u96AC\u9720\u971F\u9718\u971D\u9719\u979A\u97A1\u979C"],["ef40","\u979E\u979D\u97D5\u97D4\u97F1\u9841\u9844\u984A\u9849\u9845\u9843\u9925\u992B\u992C\u992A\u9933\u9932\u992F\u992D\u9931\u9930\u9998\u99A3\u99A1\u9A02\u99FA\u99F4\u99F7\u99F9\u99F8\u99F6\u99FB\u99FD\u99FE\u99FC\u9A03\u9ABE\u9AFE\u9AFD\u9B01\u9AFC\u9B48\u9B9A\u9BA8\u9B9E\u9B9B\u9BA6\u9BA1\u9BA5\u9BA4\u9B86\u9BA2\u9BA0\u9BAF\u9D33\u9D41\u9D67\u9D36\u9D2E\u9D2F\u9D31\u9D38\u9D30"],["efa1","\u9D45\u9D42\u9D43\u9D3E\u9D37\u9D40\u9D3D\u7FF5\u9D2D\u9E8A\u9E89\u9E8D\u9EB0\u9EC8\u9EDA\u9EFB\u9EFF\u9F24\u9F23\u9F22\u9F54\u9FA0\u5131\u512D\u512E\u5698\u569C\u5697\u569A\u569D\u5699\u5970\u5B3C\u5C69\u5C6A\u5DC0\u5E6D\u5E6E\u61D8\u61DF\u61ED\u61EE\u61F1\u61EA\u61F0\u61EB\u61D6\u61E9\u64FF\u6504\u64FD\u64F8\u6501\u6503\u64FC\u6594\u65DB\u66DA\u66DB\u66D8\u6AC5\u6AB9\u6ABD\u6AE1\u6AC6\u6ABA\u6AB6\u6AB7\u6AC7\u6AB4\u6AAD\u6B5E\u6BC9\u6C0B\u7007\u700C\u700D\u7001\u7005\u7014\u700E\u6FFF\u7000\u6FFB\u7026\u6FFC\u6FF7\u700A\u7201\u71FF\u71F9\u7203\u71FD\u7376"],["f040","\u74B8\u74C0\u74B5\u74C1\u74BE\u74B6\u74BB\u74C2\u7514\u7513\u765C\u7664\u7659\u7650\u7653\u7657\u765A\u76A6\u76BD\u76EC\u77C2\u77BA\u78FF\u790C\u7913\u7914\u7909\u7910\u7912\u7911\u79AD\u79AC\u7A5F\u7C1C\u7C29\u7C19\u7C20\u7C1F\u7C2D\u7C1D\u7C26\u7C28\u7C22\u7C25\u7C30\u7E5C\u7E50\u7E56\u7E63\u7E58\u7E62\u7E5F\u7E51\u7E60\u7E57\u7E53\u7FB5\u7FB3\u7FF7\u7FF8\u8075\u81D1\u81D2"],["f0a1","\u81D0\u825F\u825E\u85B4\u85C6\u85C0\u85C3\u85C2\u85B3\u85B5\u85BD\u85C7\u85C4\u85BF\u85CB\u85CE\u85C8\u85C5\u85B1\u85B6\u85D2\u8624\u85B8\u85B7\u85BE\u8669\u87E7\u87E6\u87E2\u87DB\u87EB\u87EA\u87E5\u87DF\u87F3\u87E4\u87D4\u87DC\u87D3\u87ED\u87D8\u87E3\u87A4\u87D7\u87D9\u8801\u87F4\u87E8\u87DD\u8953\u894B\u894F\u894C\u8946\u8950\u8951\u8949\u8B2A\u8B27\u8B23\u8B33\u8B30\u8B35\u8B47\u8B2F\u8B3C\u8B3E\u8B31\u8B25\u8B37\u8B26\u8B36\u8B2E\u8B24\u8B3B\u8B3D\u8B3A\u8C42\u8C75\u8C99\u8C98\u8C97\u8CFE\u8D04\u8D02\u8D00\u8E5C\u8E62\u8E60\u8E57\u8E56\u8E5E\u8E65\u8E67"],["f140","\u8E5B\u8E5A\u8E61\u8E5D\u8E69\u8E54\u8F46\u8F47\u8F48\u8F4B\u9128\u913A\u913B\u913E\u91A8\u91A5\u91A7\u91AF\u91AA\u93B5\u938C\u9392\u93B7\u939B\u939D\u9389\u93A7\u938E\u93AA\u939E\u93A6\u9395\u9388\u9399\u939F\u938D\u93B1\u9391\u93B2\u93A4\u93A8\u93B4\u93A3\u93A5\u95D2\u95D3\u95D1\u96B3\u96D7\u96DA\u5DC2\u96DF\u96D8\u96DD\u9723\u9722\u9725\u97AC\u97AE\u97A8\u97AB\u97A4\u97AA"],["f1a1","\u97A2\u97A5\u97D7\u97D9\u97D6\u97D8\u97FA\u9850\u9851\u9852\u98B8\u9941\u993C\u993A\u9A0F\u9A0B\u9A09\u9A0D\u9A04\u9A11\u9A0A\u9A05\u9A07\u9A06\u9AC0\u9ADC\u9B08\u9B04\u9B05\u9B29\u9B35\u9B4A\u9B4C\u9B4B\u9BC7\u9BC6\u9BC3\u9BBF\u9BC1\u9BB5\u9BB8\u9BD3\u9BB6\u9BC4\u9BB9\u9BBD\u9D5C\u9D53\u9D4F\u9D4A\u9D5B\u9D4B\u9D59\u9D56\u9D4C\u9D57\u9D52\u9D54\u9D5F\u9D58\u9D5A\u9E8E\u9E8C\u9EDF\u9F01\u9F00\u9F16\u9F25\u9F2B\u9F2A\u9F29\u9F28\u9F4C\u9F55\u5134\u5135\u5296\u52F7\u53B4\u56AB\u56AD\u56A6\u56A7\u56AA\u56AC\u58DA\u58DD\u58DB\u5912\u5B3D\u5B3E\u5B3F\u5DC3\u5E70"],["f240","\u5FBF\u61FB\u6507\u6510\u650D\u6509\u650C\u650E\u6584\u65DE\u65DD\u66DE\u6AE7\u6AE0\u6ACC\u6AD1\u6AD9\u6ACB\u6ADF\u6ADC\u6AD0\u6AEB\u6ACF\u6ACD\u6ADE\u6B60\u6BB0\u6C0C\u7019\u7027\u7020\u7016\u702B\u7021\u7022\u7023\u7029\u7017\u7024\u701C\u702A\u720C\u720A\u7207\u7202\u7205\u72A5\u72A6\u72A4\u72A3\u72A1\u74CB\u74C5\u74B7\u74C3\u7516\u7660\u77C9\u77CA\u77C4\u77F1\u791D\u791B"],["f2a1","\u7921\u791C\u7917\u791E\u79B0\u7A67\u7A68\u7C33\u7C3C\u7C39\u7C2C\u7C3B\u7CEC\u7CEA\u7E76\u7E75\u7E78\u7E70\u7E77\u7E6F\u7E7A\u7E72\u7E74\u7E68\u7F4B\u7F4A\u7F83\u7F86\u7FB7\u7FFD\u7FFE\u8078\u81D7\u81D5\u8264\u8261\u8263\u85EB\u85F1\u85ED\u85D9\u85E1\u85E8\u85DA\u85D7\u85EC\u85F2\u85F8\u85D8\u85DF\u85E3\u85DC\u85D1\u85F0\u85E6\u85EF\u85DE\u85E2\u8800\u87FA\u8803\u87F6\u87F7\u8809\u880C\u880B\u8806\u87FC\u8808\u87FF\u880A\u8802\u8962\u895A\u895B\u8957\u8961\u895C\u8958\u895D\u8959\u8988\u89B7\u89B6\u89F6\u8B50\u8B48\u8B4A\u8B40\u8B53\u8B56\u8B54\u8B4B\u8B55"],["f340","\u8B51\u8B42\u8B52\u8B57\u8C43\u8C77\u8C76\u8C9A\u8D06\u8D07\u8D09\u8DAC\u8DAA\u8DAD\u8DAB\u8E6D\u8E78\u8E73\u8E6A\u8E6F\u8E7B\u8EC2\u8F52\u8F51\u8F4F\u8F50\u8F53\u8FB4\u9140\u913F\u91B0\u91AD\u93DE\u93C7\u93CF\u93C2\u93DA\u93D0\u93F9\u93EC\u93CC\u93D9\u93A9\u93E6\u93CA\u93D4\u93EE\u93E3\u93D5\u93C4\u93CE\u93C0\u93D2\u93E7\u957D\u95DA\u95DB\u96E1\u9729\u972B\u972C\u9728\u9726"],["f3a1","\u97B3\u97B7\u97B6\u97DD\u97DE\u97DF\u985C\u9859\u985D\u9857\u98BF\u98BD\u98BB\u98BE\u9948\u9947\u9943\u99A6\u99A7\u9A1A\u9A15\u9A25\u9A1D\u9A24\u9A1B\u9A22\u9A20\u9A27\u9A23\u9A1E\u9A1C\u9A14\u9AC2\u9B0B\u9B0A\u9B0E\u9B0C\u9B37\u9BEA\u9BEB\u9BE0\u9BDE\u9BE4\u9BE6\u9BE2\u9BF0\u9BD4\u9BD7\u9BEC\u9BDC\u9BD9\u9BE5\u9BD5\u9BE1\u9BDA\u9D77\u9D81\u9D8A\u9D84\u9D88\u9D71\u9D80\u9D78\u9D86\u9D8B\u9D8C\u9D7D\u9D6B\u9D74\u9D75\u9D70\u9D69\u9D85\u9D73\u9D7B\u9D82\u9D6F\u9D79\u9D7F\u9D87\u9D68\u9E94\u9E91\u9EC0\u9EFC\u9F2D\u9F40\u9F41\u9F4D\u9F56\u9F57\u9F58\u5337\u56B2"],["f440","\u56B5\u56B3\u58E3\u5B45\u5DC6\u5DC7\u5EEE\u5EEF\u5FC0\u5FC1\u61F9\u6517\u6516\u6515\u6513\u65DF\u66E8\u66E3\u66E4\u6AF3\u6AF0\u6AEA\u6AE8\u6AF9\u6AF1\u6AEE\u6AEF\u703C\u7035\u702F\u7037\u7034\u7031\u7042\u7038\u703F\u703A\u7039\u7040\u703B\u7033\u7041\u7213\u7214\u72A8\u737D\u737C\u74BA\u76AB\u76AA\u76BE\u76ED\u77CC\u77CE\u77CF\u77CD\u77F2\u7925\u7923\u7927\u7928\u7924\u7929"],["f4a1","\u79B2\u7A6E\u7A6C\u7A6D\u7AF7\u7C49\u7C48\u7C4A\u7C47\u7C45\u7CEE\u7E7B\u7E7E\u7E81\u7E80\u7FBA\u7FFF\u8079\u81DB\u81D9\u820B\u8268\u8269\u8622\u85FF\u8601\u85FE\u861B\u8600\u85F6\u8604\u8609\u8605\u860C\u85FD\u8819\u8810\u8811\u8817\u8813\u8816\u8963\u8966\u89B9\u89F7\u8B60\u8B6A\u8B5D\u8B68\u8B63\u8B65\u8B67\u8B6D\u8DAE\u8E86\u8E88\u8E84\u8F59\u8F56\u8F57\u8F55\u8F58\u8F5A\u908D\u9143\u9141\u91B7\u91B5\u91B2\u91B3\u940B\u9413\u93FB\u9420\u940F\u9414\u93FE\u9415\u9410\u9428\u9419\u940D\u93F5\u9400\u93F7\u9407\u940E\u9416\u9412\u93FA\u9409\u93F8\u940A\u93FF"],["f540","\u93FC\u940C\u93F6\u9411\u9406\u95DE\u95E0\u95DF\u972E\u972F\u97B9\u97BB\u97FD\u97FE\u9860\u9862\u9863\u985F\u98C1\u98C2\u9950\u994E\u9959\u994C\u994B\u9953\u9A32\u9A34\u9A31\u9A2C\u9A2A\u9A36\u9A29\u9A2E\u9A38\u9A2D\u9AC7\u9ACA\u9AC6\u9B10\u9B12\u9B11\u9C0B\u9C08\u9BF7\u9C05\u9C12\u9BF8\u9C40\u9C07\u9C0E\u9C06\u9C17\u9C14\u9C09\u9D9F\u9D99\u9DA4\u9D9D\u9D92\u9D98\u9D90\u9D9B"],["f5a1","\u9DA0\u9D94\u9D9C\u9DAA\u9D97\u9DA1\u9D9A\u9DA2\u9DA8\u9D9E\u9DA3\u9DBF\u9DA9\u9D96\u9DA6\u9DA7\u9E99\u9E9B\u9E9A\u9EE5\u9EE4\u9EE7\u9EE6\u9F30\u9F2E\u9F5B\u9F60\u9F5E\u9F5D\u9F59\u9F91\u513A\u5139\u5298\u5297\u56C3\u56BD\u56BE\u5B48\u5B47\u5DCB\u5DCF\u5EF1\u61FD\u651B\u6B02\u6AFC\u6B03\u6AF8\u6B00\u7043\u7044\u704A\u7048\u7049\u7045\u7046\u721D\u721A\u7219\u737E\u7517\u766A\u77D0\u792D\u7931\u792F\u7C54\u7C53\u7CF2\u7E8A\u7E87\u7E88\u7E8B\u7E86\u7E8D\u7F4D\u7FBB\u8030\u81DD\u8618\u862A\u8626\u861F\u8623\u861C\u8619\u8627\u862E\u8621\u8620\u8629\u861E\u8625"],["f640","\u8829\u881D\u881B\u8820\u8824\u881C\u882B\u884A\u896D\u8969\u896E\u896B\u89FA\u8B79\u8B78\u8B45\u8B7A\u8B7B\u8D10\u8D14\u8DAF\u8E8E\u8E8C\u8F5E\u8F5B\u8F5D\u9146\u9144\u9145\u91B9\u943F\u943B\u9436\u9429\u943D\u943C\u9430\u9439\u942A\u9437\u942C\u9440\u9431\u95E5\u95E4\u95E3\u9735\u973A\u97BF\u97E1\u9864\u98C9\u98C6\u98C0\u9958\u9956\u9A39\u9A3D\u9A46\u9A44\u9A42\u9A41\u9A3A"],["f6a1","\u9A3F\u9ACD\u9B15\u9B17\u9B18\u9B16\u9B3A\u9B52\u9C2B\u9C1D\u9C1C\u9C2C\u9C23\u9C28\u9C29\u9C24\u9C21\u9DB7\u9DB6\u9DBC\u9DC1\u9DC7\u9DCA\u9DCF\u9DBE\u9DC5\u9DC3\u9DBB\u9DB5\u9DCE\u9DB9\u9DBA\u9DAC\u9DC8\u9DB1\u9DAD\u9DCC\u9DB3\u9DCD\u9DB2\u9E7A\u9E9C\u9EEB\u9EEE\u9EED\u9F1B\u9F18\u9F1A\u9F31\u9F4E\u9F65\u9F64\u9F92\u4EB9\u56C6\u56C5\u56CB\u5971\u5B4B\u5B4C\u5DD5\u5DD1\u5EF2\u6521\u6520\u6526\u6522\u6B0B\u6B08\u6B09\u6C0D\u7055\u7056\u7057\u7052\u721E\u721F\u72A9\u737F\u74D8\u74D5\u74D9\u74D7\u766D\u76AD\u7935\u79B4\u7A70\u7A71\u7C57\u7C5C\u7C59\u7C5B\u7C5A"],["f740","\u7CF4\u7CF1\u7E91\u7F4F\u7F87\u81DE\u826B\u8634\u8635\u8633\u862C\u8632\u8636\u882C\u8828\u8826\u882A\u8825\u8971\u89BF\u89BE\u89FB\u8B7E\u8B84\u8B82\u8B86\u8B85\u8B7F\u8D15\u8E95\u8E94\u8E9A\u8E92\u8E90\u8E96\u8E97\u8F60\u8F62\u9147\u944C\u9450\u944A\u944B\u944F\u9447\u9445\u9448\u9449\u9446\u973F\u97E3\u986A\u9869\u98CB\u9954\u995B\u9A4E\u9A53\u9A54\u9A4C\u9A4F\u9A48\u9A4A"],["f7a1","\u9A49\u9A52\u9A50\u9AD0\u9B19\u9B2B\u9B3B\u9B56\u9B55\u9C46\u9C48\u9C3F\u9C44\u9C39\u9C33\u9C41\u9C3C\u9C37\u9C34\u9C32\u9C3D\u9C36\u9DDB\u9DD2\u9DDE\u9DDA\u9DCB\u9DD0\u9DDC\u9DD1\u9DDF\u9DE9\u9DD9\u9DD8\u9DD6\u9DF5\u9DD5\u9DDD\u9EB6\u9EF0\u9F35\u9F33\u9F32\u9F42\u9F6B\u9F95\u9FA2\u513D\u5299\u58E8\u58E7\u5972\u5B4D\u5DD8\u882F\u5F4F\u6201\u6203\u6204\u6529\u6525\u6596\u66EB\u6B11\u6B12\u6B0F\u6BCA\u705B\u705A\u7222\u7382\u7381\u7383\u7670\u77D4\u7C67\u7C66\u7E95\u826C\u863A\u8640\u8639\u863C\u8631\u863B\u863E\u8830\u8832\u882E\u8833\u8976\u8974\u8973\u89FE"],["f840","\u8B8C\u8B8E\u8B8B\u8B88\u8C45\u8D19\u8E98\u8F64\u8F63\u91BC\u9462\u9455\u945D\u9457\u945E\u97C4\u97C5\u9800\u9A56\u9A59\u9B1E\u9B1F\u9B20\u9C52\u9C58\u9C50\u9C4A\u9C4D\u9C4B\u9C55\u9C59\u9C4C\u9C4E\u9DFB\u9DF7\u9DEF\u9DE3\u9DEB\u9DF8\u9DE4\u9DF6\u9DE1\u9DEE\u9DE6\u9DF2\u9DF0\u9DE2\u9DEC\u9DF4\u9DF3\u9DE8\u9DED\u9EC2\u9ED0\u9EF2\u9EF3\u9F06\u9F1C\u9F38\u9F37\u9F36\u9F43\u9F4F"],["f8a1","\u9F71\u9F70\u9F6E\u9F6F\u56D3\u56CD\u5B4E\u5C6D\u652D\u66ED\u66EE\u6B13\u705F\u7061\u705D\u7060\u7223\u74DB\u74E5\u77D5\u7938\u79B7\u79B6\u7C6A\u7E97\u7F89\u826D\u8643\u8838\u8837\u8835\u884B\u8B94\u8B95\u8E9E\u8E9F\u8EA0\u8E9D\u91BE\u91BD\u91C2\u946B\u9468\u9469\u96E5\u9746\u9743\u9747\u97C7\u97E5\u9A5E\u9AD5\u9B59\u9C63\u9C67\u9C66\u9C62\u9C5E\u9C60\u9E02\u9DFE\u9E07\u9E03\u9E06\u9E05\u9E00\u9E01\u9E09\u9DFF\u9DFD\u9E04\u9EA0\u9F1E\u9F46\u9F74\u9F75\u9F76\u56D4\u652E\u65B8\u6B18\u6B19\u6B17\u6B1A\u7062\u7226\u72AA\u77D8\u77D9\u7939\u7C69\u7C6B\u7CF6\u7E9A"],["f940","\u7E98\u7E9B\u7E99\u81E0\u81E1\u8646\u8647\u8648\u8979\u897A\u897C\u897B\u89FF\u8B98\u8B99\u8EA5\u8EA4\u8EA3\u946E\u946D\u946F\u9471\u9473\u9749\u9872\u995F\u9C68\u9C6E\u9C6D\u9E0B\u9E0D\u9E10\u9E0F\u9E12\u9E11\u9EA1\u9EF5\u9F09\u9F47\u9F78\u9F7B\u9F7A\u9F79\u571E\u7066\u7C6F\u883C\u8DB2\u8EA6\u91C3\u9474\u9478\u9476\u9475\u9A60\u9C74\u9C73\u9C71\u9C75\u9E14\u9E13\u9EF6\u9F0A"],["f9a1","\u9FA4\u7068\u7065\u7CF7\u866A\u883E\u883D\u883F\u8B9E\u8C9C\u8EA9\u8EC9\u974B\u9873\u9874\u98CC\u9961\u99AB\u9A64\u9A66\u9A67\u9B24\u9E15\u9E17\u9F48\u6207\u6B1E\u7227\u864C\u8EA8\u9482\u9480\u9481\u9A69\u9A68\u9B2E\u9E19\u7229\u864B\u8B9F\u9483\u9C79\u9EB7\u7675\u9A6B\u9C7A\u9E1D\u7069\u706A\u9EA4\u9F7E\u9F49\u9F98\u7881\u92B9\u88CF\u58BB\u6052\u7CA7\u5AFA\u2554\u2566\u2557\u2560\u256C\u2563\u255A\u2569\u255D\u2552\u2564\u2555\u255E\u256A\u2561\u2558\u2567\u255B\u2553\u2565\u2556\u255F\u256B\u2562\u2559\u2568\u255C\u2551\u2550\u256D\u256E\u2570\u256F\u2593"]]});var sO=H((Ole,qG)=>{qG.exports=[["8740","\u43F0\u4C32\u4603\u45A6\u4578\u{27267}\u4D77\u45B3\u{27CB1}\u4CE2\u{27CC5}\u3B95\u4736\u4744\u4C47\u4C40\u{242BF}\u{23617}\u{27352}\u{26E8B}\u{270D2}\u4C57\u{2A351}\u474F\u45DA\u4C85\u{27C6C}\u4D07\u4AA4\u46A1\u{26B23}\u7225\u{25A54}\u{21A63}\u{23E06}\u{23F61}\u664D\u56FB"],["8767","\u7D95\u591D\u{28BB9}\u3DF4\u9734\u{27BEF}\u5BDB\u{21D5E}\u5AA4\u3625\u{29EB0}\u5AD1\u5BB7\u5CFC\u676E\u8593\u{29945}\u7461\u749D\u3875\u{21D53}\u{2369E}\u{26021}\u3EEC"],["87a1","\u{258DE}\u3AF5\u7AFC\u9F97\u{24161}\u{2890D}\u{231EA}\u{20A8A}\u{2325E}\u430A\u8484\u9F96\u942F\u4930\u8613\u5896\u974A\u9218\u79D0\u7A32\u6660\u6A29\u889D\u744C\u7BC5\u6782\u7A2C\u524F\u9046\u34E6\u73C4\u{25DB9}\u74C6\u9FC7\u57B3\u492F\u544C\u4131\u{2368E}\u5818\u7A72\u{27B65}\u8B8F\u46AE\u{26E88}\u4181\u{25D99}\u7BAE\u{224BC}\u9FC8\u{224C1}\u{224C9}\u{224CC}\u9FC9\u8504\u{235BB}\u40B4\u9FCA\u44E1\u{2ADFF}\u62C1\u706E\u9FCB"],["8840","\u31C0",4,"\u{2010C}\u31C5\u{200D1}\u{200CD}\u31C6\u31C7\u{200CB}\u{21FE8}\u31C8\u{200CA}\u31C9\u31CA\u31CB\u31CC\u{2010E}\u31CD\u31CE\u0100\xC1\u01CD\xC0\u0112\xC9\u011A\xC8\u014C\xD3\u01D1\xD2\u0FFF\xCA\u0304\u1EBE\u0FFF\xCA\u030C\u1EC0\xCA\u0101\xE1\u01CE\xE0\u0251\u0113\xE9\u011B\xE8\u012B\xED\u01D0\xEC\u014D\xF3\u01D2\xF2\u016B\xFA\u01D4\xF9\u01D6\u01D8\u01DA"],["88a1","\u01DC\xFC\u0FFF\xEA\u0304\u1EBF\u0FFF\xEA\u030C\u1EC1\xEA\u0261\u23DA\u23DB"],["8940","\u{2A3A9}\u{21145}"],["8943","\u650A"],["8946","\u4E3D\u6EDD\u9D4E\u91DF"],["894c","\u{27735}\u6491\u4F1A\u4F28\u4FA8\u5156\u5174\u519C\u51E4\u52A1\u52A8\u533B\u534E\u53D1\u53D8\u56E2\u58F0\u5904\u5907\u5932\u5934\u5B66\u5B9E\u5B9F\u5C9A\u5E86\u603B\u6589\u67FE\u6804\u6865\u6D4E\u70BC\u7535\u7EA4\u7EAC\u7EBA\u7EC7\u7ECF\u7EDF\u7F06\u7F37\u827A\u82CF\u836F\u89C6\u8BBE\u8BE2\u8F66\u8F67\u8F6E"],["89a1","\u7411\u7CFC\u7DCD\u6946\u7AC9\u5227"],["89ab","\u918C\u78B8\u915E\u80BC"],["89b0","\u8D0B\u80F6\u{209E7}"],["89b5","\u809F\u9EC7\u4CCD\u9DC9\u9E0C\u4C3E\u{29DF6}\u{2700E}\u9E0A\u{2A133}\u35C1"],["89c1","\u6E9A\u823E\u7519"],["89c5","\u4911\u9A6C\u9A8F\u9F99\u7987\u{2846C}\u{21DCA}\u{205D0}\u{22AE6}\u4E24\u4E81\u4E80\u4E87\u4EBF\u4EEB\u4F37\u344C\u4FBD\u3E48\u5003\u5088\u347D\u3493\u34A5\u5186\u5905\u51DB\u51FC\u5205\u4E89\u5279\u5290\u5327\u35C7\u53A9\u3551\u53B0\u3553\u53C2\u5423\u356D\u3572\u3681\u5493\u54A3\u54B4\u54B9\u54D0\u54EF\u5518\u5523\u5528\u3598\u553F\u35A5\u35BF\u55D7\u35C5"],["8a40","\u{27D84}\u5525"],["8a43","\u{20C42}\u{20D15}\u{2512B}\u5590\u{22CC6}\u39EC\u{20341}\u8E46\u{24DB8}\u{294E5}\u4053\u{280BE}\u777A\u{22C38}\u3A34\u47D5\u{2815D}\u{269F2}\u{24DEA}\u64DD\u{20D7C}\u{20FB4}\u{20CD5}\u{210F4}\u648D\u8E7E\u{20E96}\u{20C0B}\u{20F64}\u{22CA9}\u{28256}\u{244D3}"],["8a64","\u{20D46}\u{29A4D}\u{280E9}\u47F4\u{24EA7}\u{22CC2}\u9AB2\u3A67\u{295F4}\u3FED\u3506\u{252C7}\u{297D4}\u{278C8}\u{22D44}\u9D6E\u9815"],["8a76","\u43D9\u{260A5}\u64B4\u54E3\u{22D4C}\u{22BCA}\u{21077}\u39FB\u{2106F}"],["8aa1","\u{266DA}\u{26716}\u{279A0}\u64EA\u{25052}\u{20C43}\u8E68\u{221A1}\u{28B4C}\u{20731}"],["8aac","\u480B\u{201A9}\u3FFA\u5873\u{22D8D}"],["8ab2","\u{245C8}\u{204FC}\u{26097}\u{20F4C}\u{20D96}\u5579\u40BB\u43BA"],["8abb","\u4AB4\u{22A66}\u{2109D}\u81AA\u98F5\u{20D9C}\u6379\u39FE\u{22775}\u8DC0\u56A1\u647C\u3E43"],["8ac9","\u{2A601}\u{20E09}\u{22ACF}\u{22CC9}"],["8ace","\u{210C8}\u{239C2}\u3992\u3A06\u{2829B}\u3578\u{25E49}\u{220C7}\u5652\u{20F31}\u{22CB2}\u{29720}\u34BC\u6C3D\u{24E3B}"],["8adf","\u{27574}\u{22E8B}\u{22208}\u{2A65B}\u{28CCD}\u{20E7A}\u{20C34}\u{2681C}\u7F93\u{210CF}\u{22803}\u{22939}\u35FB\u{251E3}\u{20E8C}\u{20F8D}\u{20EAA}\u3F93\u{20F30}\u{20D47}\u{2114F}\u{20E4C}"],["8af6","\u{20EAB}\u{20BA9}\u{20D48}\u{210C0}\u{2113D}\u3FF9\u{22696}\u6432\u{20FAD}"],["8b40","\u{233F4}\u{27639}\u{22BCE}\u{20D7E}\u{20D7F}\u{22C51}\u{22C55}\u3A18\u{20E98}\u{210C7}\u{20F2E}\u{2A632}\u{26B50}\u{28CD2}\u{28D99}\u{28CCA}\u95AA\u54CC\u82C4\u55B9"],["8b55","\u{29EC3}\u9C26\u9AB6\u{2775E}\u{22DEE}\u7140\u816D\u80EC\u5C1C\u{26572}\u8134\u3797\u535F\u{280BD}\u91B6\u{20EFA}\u{20E0F}\u{20E77}\u{20EFB}\u35DD\u{24DEB}\u3609\u{20CD6}\u56AF\u{227B5}\u{210C9}\u{20E10}\u{20E78}\u{21078}\u{21148}\u{28207}\u{21455}\u{20E79}\u{24E50}\u{22DA4}\u5A54\u{2101D}\u{2101E}\u{210F5}\u{210F6}\u579C\u{20E11}"],["8ba1","\u{27694}\u{282CD}\u{20FB5}\u{20E7B}\u{2517E}\u3703\u{20FB6}\u{21180}\u{252D8}\u{2A2BD}\u{249DA}\u{2183A}\u{24177}\u{2827C}\u5899\u5268\u361A\u{2573D}\u7BB2\u5B68\u4800\u4B2C\u9F27\u49E7\u9C1F\u9B8D\u{25B74}\u{2313D}\u55FB\u35F2\u5689\u4E28\u5902\u{21BC1}\u{2F878}\u9751\u{20086}\u4E5B\u4EBB\u353E\u5C23\u5F51\u5FC4\u38FA\u624C\u6535\u6B7A\u6C35\u6C3A\u706C\u722B\u4E2C\u72AD\u{248E9}\u7F52\u793B\u7CF9\u7F53\u{2626A}\u34C1"],["8bde","\u{2634B}\u8002\u8080\u{26612}\u{26951}\u535D\u8864\u89C1\u{278B2}\u8BA0\u8D1D\u9485\u9578\u957F\u95E8\u{28E0F}\u97E6\u9875\u98CE\u98DE\u9963\u{29810}\u9C7C\u9E1F\u9EC4\u6B6F\uF907\u4E37\u{20087}\u961D\u6237\u94A2"],["8c40","\u503B\u6DFE\u{29C73}\u9FA6\u3DC9\u888F\u{2414E}\u7077\u5CF5\u4B20\u{251CD}\u3559\u{25D30}\u6122\u{28A32}\u8FA7\u91F6\u7191\u6719\u73BA\u{23281}\u{2A107}\u3C8B\u{21980}\u4B10\u78E4\u7402\u51AE\u{2870F}\u4009\u6A63\u{2A2BA}\u4223\u860F\u{20A6F}\u7A2A\u{29947}\u{28AEA}\u9755\u704D\u5324\u{2207E}\u93F4\u76D9\u{289E3}\u9FA7\u77DD\u4EA3\u4FF0\u50BC\u4E2F\u4F17\u9FA8\u5434\u7D8B\u5892\u58D0\u{21DB6}\u5E92\u5E99\u5FC2\u{22712}\u658B"],["8ca1","\u{233F9}\u6919\u6A43\u{23C63}\u6CFF"],["8ca7","\u7200\u{24505}\u738C\u3EDB\u{24A13}\u5B15\u74B9\u8B83\u{25CA4}\u{25695}\u7A93\u7BEC\u7CC3\u7E6C\u82F8\u8597\u9FA9\u8890\u9FAA\u8EB9\u9FAB\u8FCF\u855F\u99E0\u9221\u9FAC\u{28DB9}\u{2143F}\u4071\u42A2\u5A1A"],["8cc9","\u9868\u676B\u4276\u573D"],["8cce","\u85D6\u{2497B}\u82BF\u{2710D}\u4C81\u{26D74}\u5D7B\u{26B15}\u{26FBE}\u9FAD\u9FAE\u5B96\u9FAF\u66E7\u7E5B\u6E57\u79CA\u3D88\u44C3\u{23256}\u{22796}\u439A\u4536"],["8ce6","\u5CD5\u{23B1A}\u8AF9\u5C78\u3D12\u{23551}\u5D78\u9FB2\u7157\u4558\u{240EC}\u{21E23}\u4C77\u3978\u344A\u{201A4}\u{26C41}\u8ACC\u4FB4\u{20239}\u59BF\u816C\u9856\u{298FA}\u5F3B"],["8d40","\u{20B9F}"],["8d42","\u{221C1}\u{2896D}\u4102\u46BB\u{29079}\u3F07\u9FB3\u{2A1B5}\u40F8\u37D6\u46F7\u{26C46}\u417C\u{286B2}\u{273FF}\u456D\u38D4\u{2549A}\u4561\u451B\u4D89\u4C7B\u4D76\u45EA\u3FC8\u{24B0F}\u3661\u44DE\u44BD\u41ED\u5D3E\u5D48\u5D56\u3DFC\u380F\u5DA4\u5DB9\u3820\u3838\u5E42\u5EBD\u5F25\u5F83\u3908\u3914\u393F\u394D\u60D7\u613D\u5CE5\u3989\u61B7\u61B9\u61CF\u39B8\u622C\u6290\u62E5\u6318\u39F8\u56B1"],["8da1","\u3A03\u63E2\u63FB\u6407\u645A\u3A4B\u64C0\u5D15\u5621\u9F9F\u3A97\u6586\u3ABD\u65FF\u6653\u3AF2\u6692\u3B22\u6716\u3B42\u67A4\u6800\u3B58\u684A\u6884\u3B72\u3B71\u3B7B\u6909\u6943\u725C\u6964\u699F\u6985\u3BBC\u69D6\u3BDD\u6A65\u6A74\u6A71\u6A82\u3BEC\u6A99\u3BF2\u6AAB\u6AB5\u6AD4\u6AF6\u6B81\u6BC1\u6BEA\u6C75\u6CAA\u3CCB\u6D02\u6D06\u6D26\u6D81\u3CEF\u6DA4\u6DB1\u6E15\u6E18\u6E29\u6E86\u{289C0}\u6EBB\u6EE2\u6EDA\u9F7F\u6EE8\u6EE9\u6F24\u6F34\u3D46\u{23F41}\u6F81\u6FBE\u3D6A\u3D75\u71B7\u5C99\u3D8A\u702C\u3D91\u7050\u7054\u706F\u707F\u7089\u{20325}\u43C1\u35F1\u{20ED8}"],["8e40","\u{23ED7}\u57BE\u{26ED3}\u713E\u{257E0}\u364E\u69A2\u{28BE9}\u5B74\u7A49\u{258E1}\u{294D9}\u7A65\u7A7D\u{259AC}\u7ABB\u7AB0\u7AC2\u7AC3\u71D1\u{2648D}\u41CA\u7ADA\u7ADD\u7AEA\u41EF\u54B2\u{25C01}\u7B0B\u7B55\u7B29\u{2530E}\u{25CFE}\u7BA2\u7B6F\u839C\u{25BB4}\u{26C7F}\u7BD0\u8421\u7B92\u7BB8\u{25D20}\u3DAD\u{25C65}\u8492\u7BFA\u7C06\u7C35\u{25CC1}\u7C44\u7C83\u{24882}\u7CA6\u667D\u{24578}\u7CC9\u7CC7\u7CE6\u7C74\u7CF3\u7CF5\u7CCE"],["8ea1","\u7E67\u451D\u{26E44}\u7D5D\u{26ED6}\u748D\u7D89\u7DAB\u7135\u7DB3\u7DD2\u{24057}\u{26029}\u7DE4\u3D13\u7DF5\u{217F9}\u7DE5\u{2836D}\u7E1D\u{26121}\u{2615A}\u7E6E\u7E92\u432B\u946C\u7E27\u7F40\u7F41\u7F47\u7936\u{262D0}\u99E1\u7F97\u{26351}\u7FA3\u{21661}\u{20068}\u455C\u{23766}\u4503\u{2833A}\u7FFA\u{26489}\u8005\u8008\u801D\u8028\u802F\u{2A087}\u{26CC3}\u803B\u803C\u8061\u{22714}\u4989\u{26626}\u{23DE3}\u{266E8}\u6725\u80A7\u{28A48}\u8107\u811A\u58B0\u{226F6}\u6C7F\u{26498}\u{24FB8}\u64E7\u{2148A}\u8218\u{2185E}\u6A53\u{24A65}\u{24A95}\u447A\u8229\u{20B0D}\u{26A52}\u{23D7E}\u4FF9\u{214FD}\u84E2\u8362\u{26B0A}\u{249A7}\u{23530}\u{21773}\u{23DF8}\u82AA\u691B\u{2F994}\u41DB"],["8f40","\u854B\u82D0\u831A\u{20E16}\u{217B4}\u36C1\u{2317D}\u{2355A}\u827B\u82E2\u8318\u{23E8B}\u{26DA3}\u{26B05}\u{26B97}\u{235CE}\u3DBF\u831D\u55EC\u8385\u450B\u{26DA5}\u83AC\u83C1\u83D3\u347E\u{26ED4}\u6A57\u855A\u3496\u{26E42}\u{22EEF}\u8458\u{25BE4}\u8471\u3DD3\u44E4\u6AA7\u844A\u{23CB5}\u7958\u84A8\u{26B96}\u{26E77}\u{26E43}\u84DE\u840F\u8391\u44A0\u8493\u84E4\u{25C91}\u4240\u{25CC0}\u4543\u8534\u5AF2\u{26E99}\u4527\u8573\u4516\u67BF\u8616"],["8fa1","\u{28625}\u{2863B}\u85C1\u{27088}\u8602\u{21582}\u{270CD}\u{2F9B2}\u456A\u8628\u3648\u{218A2}\u53F7\u{2739A}\u867E\u8771\u{2A0F8}\u87EE\u{22C27}\u87B1\u87DA\u880F\u5661\u866C\u6856\u460F\u8845\u8846\u{275E0}\u{23DB9}\u{275E4}\u885E\u889C\u465B\u88B4\u88B5\u63C1\u88C5\u7777\u{2770F}\u8987\u898A\u89A6\u89A9\u89A7\u89BC\u{28A25}\u89E7\u{27924}\u{27ABD}\u8A9C\u7793\u91FE\u8A90\u{27A59}\u7AE9\u{27B3A}\u{23F8F}\u4713\u{27B38}\u717C\u8B0C\u8B1F\u{25430}\u{25565}\u8B3F\u8B4C\u8B4D\u8AA9\u{24A7A}\u8B90\u8B9B\u8AAF\u{216DF}\u4615\u884F\u8C9B\u{27D54}\u{27D8F}\u{2F9D4}\u3725\u{27D53}\u8CD6\u{27D98}\u{27DBD}\u8D12\u8D03\u{21910}\u8CDB\u705C\u8D11\u{24CC9}\u3ED0\u8D77"],["9040","\u8DA9\u{28002}\u{21014}\u{2498A}\u3B7C\u{281BC}\u{2710C}\u7AE7\u8EAD\u8EB6\u8EC3\u92D4\u8F19\u8F2D\u{28365}\u{28412}\u8FA5\u9303\u{2A29F}\u{20A50}\u8FB3\u492A\u{289DE}\u{2853D}\u{23DBB}\u5EF8\u{23262}\u8FF9\u{2A014}\u{286BC}\u{28501}\u{22325}\u3980\u{26ED7}\u9037\u{2853C}\u{27ABE}\u9061\u{2856C}\u{2860B}\u90A8\u{28713}\u90C4\u{286E6}\u90AE\u90FD\u9167\u3AF0\u91A9\u91C4\u7CAC\u{28933}\u{21E89}\u920E\u6C9F\u9241\u9262\u{255B9}\u92B9\u{28AC6}\u{23C9B}\u{28B0C}\u{255DB}"],["90a1","\u{20D31}\u932C\u936B\u{28AE1}\u{28BEB}\u708F\u5AC3\u{28AE2}\u{28AE5}\u4965\u9244\u{28BEC}\u{28C39}\u{28BFF}\u9373\u945B\u8EBC\u9585\u95A6\u9426\u95A0\u6FF6\u42B9\u{2267A}\u{286D8}\u{2127C}\u{23E2E}\u49DF\u6C1C\u967B\u9696\u416C\u96A3\u{26ED5}\u61DA\u96B6\u78F5\u{28AE0}\u96BD\u53CC\u49A1\u{26CB8}\u{20274}\u{26410}\u{290AF}\u{290E5}\u{24AD1}\u{21915}\u{2330A}\u9731\u8642\u9736\u4A0F\u453D\u4585\u{24AE9}\u7075\u5B41\u971B\u975C\u{291D5}\u9757\u5B4A\u{291EB}\u975F\u9425\u50D0\u{230B7}\u{230BC}\u9789\u979F\u97B1\u97BE\u97C0\u97D2\u97E0\u{2546C}\u97EE\u741C\u{29433}\u97FF\u97F5\u{2941D}\u{2797A}\u4AD1\u9834\u9833\u984B\u9866\u3B0E\u{27175}\u3D51\u{20630}\u{2415C}"],["9140","\u{25706}\u98CA\u98B7\u98C8\u98C7\u4AFF\u{26D27}\u{216D3}\u55B0\u98E1\u98E6\u98EC\u9378\u9939\u{24A29}\u4B72\u{29857}\u{29905}\u99F5\u9A0C\u9A3B\u9A10\u9A58\u{25725}\u36C4\u{290B1}\u{29BD5}\u9AE0\u9AE2\u{29B05}\u9AF4\u4C0E\u9B14\u9B2D\u{28600}\u5034\u9B34\u{269A8}\u38C3\u{2307D}\u9B50\u9B40\u{29D3E}\u5A45\u{21863}\u9B8E\u{2424B}\u9C02\u9BFF\u9C0C\u{29E68}\u9DD4\u{29FB7}\u{2A192}\u{2A1AB}\u{2A0E1}\u{2A123}\u{2A1DF}\u9D7E\u9D83\u{2A134}\u9E0E\u6888"],["91a1","\u9DC4\u{2215B}\u{2A193}\u{2A220}\u{2193B}\u{2A233}\u9D39\u{2A0B9}\u{2A2B4}\u9E90\u9E95\u9E9E\u9EA2\u4D34\u9EAA\u9EAF\u{24364}\u9EC1\u3B60\u39E5\u3D1D\u4F32\u37BE\u{28C2B}\u9F02\u9F08\u4B96\u9424\u{26DA2}\u9F17\u9F16\u9F39\u569F\u568A\u9F45\u99B8\u{2908B}\u97F2\u847F\u9F62\u9F69\u7ADC\u9F8E\u7216\u4BBE\u{24975}\u{249BB}\u7177\u{249F8}\u{24348}\u{24A51}\u739E\u{28BDA}\u{218FA}\u799F\u{2897E}\u{28E36}\u9369\u93F3\u{28A44}\u92EC\u9381\u93CB\u{2896C}\u{244B9}\u7217\u3EEB\u7772\u7A43\u70D0\u{24473}\u{243F8}\u717E\u{217EF}\u70A3\u{218BE}\u{23599}\u3EC7\u{21885}\u{2542F}\u{217F8}\u3722\u{216FB}\u{21839}\u36E1\u{21774}\u{218D1}\u{25F4B}\u3723\u{216C0}\u575B\u{24A25}\u{213FE}\u{212A8}"],["9240","\u{213C6}\u{214B6}\u8503\u{236A6}\u8503\u8455\u{24994}\u{27165}\u{23E31}\u{2555C}\u{23EFB}\u{27052}\u44F4\u{236EE}\u{2999D}\u{26F26}\u67F9\u3733\u3C15\u3DE7\u586C\u{21922}\u6810\u4057\u{2373F}\u{240E1}\u{2408B}\u{2410F}\u{26C21}\u54CB\u569E\u{266B1}\u5692\u{20FDF}\u{20BA8}\u{20E0D}\u93C6\u{28B13}\u939C\u4EF8\u512B\u3819\u{24436}\u4EBC\u{20465}\u{2037F}\u4F4B\u4F8A\u{25651}\u5A68\u{201AB}\u{203CB}\u3999\u{2030A}\u{20414}\u3435\u4F29\u{202C0}\u{28EB3}\u{20275}\u8ADA\u{2020C}\u4E98"],["92a1","\u50CD\u510D\u4FA2\u4F03\u{24A0E}\u{23E8A}\u4F42\u502E\u506C\u5081\u4FCC\u4FE5\u5058\u50FC\u5159\u515B\u515D\u515E\u6E76\u{23595}\u{23E39}\u{23EBF}\u6D72\u{21884}\u{23E89}\u51A8\u51C3\u{205E0}\u44DD\u{204A3}\u{20492}\u{20491}\u8D7A\u{28A9C}\u{2070E}\u5259\u52A4\u{20873}\u52E1\u936E\u467A\u718C\u{2438C}\u{20C20}\u{249AC}\u{210E4}\u69D1\u{20E1D}\u7479\u3EDE\u7499\u7414\u7456\u7398\u4B8E\u{24ABC}\u{2408D}\u53D0\u3584\u720F\u{240C9}\u55B4\u{20345}\u54CD\u{20BC6}\u571D\u925D\u96F4\u9366\u57DD\u578D\u577F\u363E\u58CB\u5A99\u{28A46}\u{216FA}\u{2176F}\u{21710}\u5A2C\u59B8\u928F\u5A7E\u5ACF\u5A12\u{25946}\u{219F3}\u{21861}\u{24295}\u36F5\u6D05\u7443\u5A21\u{25E83}"],["9340","\u5A81\u{28BD7}\u{20413}\u93E0\u748C\u{21303}\u7105\u4972\u9408\u{289FB}\u93BD\u37A0\u5C1E\u5C9E\u5E5E\u5E48\u{21996}\u{2197C}\u{23AEE}\u5ECD\u5B4F\u{21903}\u{21904}\u3701\u{218A0}\u36DD\u{216FE}\u36D3\u812A\u{28A47}\u{21DBA}\u{23472}\u{289A8}\u5F0C\u5F0E\u{21927}\u{217AB}\u5A6B\u{2173B}\u5B44\u8614\u{275FD}\u8860\u607E\u{22860}\u{2262B}\u5FDB\u3EB8\u{225AF}\u{225BE}\u{29088}\u{26F73}\u61C0\u{2003E}\u{20046}\u{2261B}\u6199\u6198\u6075\u{22C9B}\u{22D07}\u{246D4}\u{2914D}"],["93a1","\u6471\u{24665}\u{22B6A}\u3A29\u{22B22}\u{23450}\u{298EA}\u{22E78}\u6337\u{2A45B}\u64B6\u6331\u63D1\u{249E3}\u{22D67}\u62A4\u{22CA1}\u643B\u656B\u6972\u3BF4\u{2308E}\u{232AD}\u{24989}\u{232AB}\u550D\u{232E0}\u{218D9}\u{2943F}\u66CE\u{23289}\u{231B3}\u3AE0\u4190\u{25584}\u{28B22}\u{2558F}\u{216FC}\u{2555B}\u{25425}\u78EE\u{23103}\u{2182A}\u{23234}\u3464\u{2320F}\u{23182}\u{242C9}\u668E\u{26D24}\u666B\u4B93\u6630\u{27870}\u{21DEB}\u6663\u{232D2}\u{232E1}\u661E\u{25872}\u38D1\u{2383A}\u{237BC}\u3B99\u{237A2}\u{233FE}\u74D0\u3B96\u678F\u{2462A}\u68B6\u681E\u3BC4\u6ABE\u3863\u{237D5}\u{24487}\u6A33\u6A52\u6AC9\u6B05\u{21912}\u6511\u6898\u6A4C\u3BD7\u6A7A\u6B57\u{23FC0}\u{23C9A}\u93A0\u92F2\u{28BEA}\u{28ACB}"],["9440","\u9289\u{2801E}\u{289DC}\u9467\u6DA5\u6F0B\u{249EC}\u6D67\u{23F7F}\u3D8F\u6E04\u{2403C}\u5A3D\u6E0A\u5847\u6D24\u7842\u713B\u{2431A}\u{24276}\u70F1\u7250\u7287\u7294\u{2478F}\u{24725}\u5179\u{24AA4}\u{205EB}\u747A\u{23EF8}\u{2365F}\u{24A4A}\u{24917}\u{25FE1}\u3F06\u3EB1\u{24ADF}\u{28C23}\u{23F35}\u60A7\u3EF3\u74CC\u743C\u9387\u7437\u449F\u{26DEA}\u4551\u7583\u3F63\u{24CD9}\u{24D06}\u3F58\u7555\u7673\u{2A5C6}\u3B19\u7468\u{28ACC}\u{249AB}\u{2498E}\u3AFB"],["94a1","\u3DCD\u{24A4E}\u3EFF\u{249C5}\u{248F3}\u91FA\u5732\u9342\u{28AE3}\u{21864}\u50DF\u{25221}\u{251E7}\u7778\u{23232}\u770E\u770F\u777B\u{24697}\u{23781}\u3A5E\u{248F0}\u7438\u749B\u3EBF\u{24ABA}\u{24AC7}\u40C8\u{24A96}\u{261AE}\u9307\u{25581}\u781E\u788D\u7888\u78D2\u73D0\u7959\u{27741}\u{256E3}\u410E\u799B\u8496\u79A5\u6A2D\u{23EFA}\u7A3A\u79F4\u416E\u{216E6}\u4132\u9235\u79F1\u{20D4C}\u{2498C}\u{20299}\u{23DBA}\u{2176E}\u3597\u556B\u3570\u36AA\u{201D4}\u{20C0D}\u7AE2\u5A59\u{226F5}\u{25AAF}\u{25A9C}\u5A0D\u{2025B}\u78F0\u5A2A\u{25BC6}\u7AFE\u41F9\u7C5D\u7C6D\u4211\u{25BB3}\u{25EBC}\u{25EA6}\u7CCD\u{249F9}\u{217B0}\u7C8E\u7C7C\u7CAE\u6AB2\u7DDC\u7E07\u7DD3\u7F4E\u{26261}"],["9540","\u{2615C}\u{27B48}\u7D97\u{25E82}\u426A\u{26B75}\u{20916}\u67D6\u{2004E}\u{235CF}\u57C4\u{26412}\u{263F8}\u{24962}\u7FDD\u7B27\u{2082C}\u{25AE9}\u{25D43}\u7B0C\u{25E0E}\u99E6\u8645\u9A63\u6A1C\u{2343F}\u39E2\u{249F7}\u{265AD}\u9A1F\u{265A0}\u8480\u{27127}\u{26CD1}\u44EA\u8137\u4402\u80C6\u8109\u8142\u{267B4}\u98C3\u{26A42}\u8262\u8265\u{26A51}\u8453\u{26DA7}\u8610\u{2721B}\u5A86\u417F\u{21840}\u5B2B\u{218A1}\u5AE4\u{218D8}\u86A0\u{2F9BC}\u{23D8F}\u882D\u{27422}\u5A02"],["95a1","\u886E\u4F45\u8887\u88BF\u88E6\u8965\u894D\u{25683}\u8954\u{27785}\u{27784}\u{28BF5}\u{28BD9}\u{28B9C}\u{289F9}\u3EAD\u84A3\u46F5\u46CF\u37F2\u8A3D\u8A1C\u{29448}\u5F4D\u922B\u{24284}\u65D4\u7129\u70C4\u{21845}\u9D6D\u8C9F\u8CE9\u{27DDC}\u599A\u77C3\u59F0\u436E\u36D4\u8E2A\u8EA7\u{24C09}\u8F30\u8F4A\u42F4\u6C58\u6FBB\u{22321}\u489B\u6F79\u6E8B\u{217DA}\u9BE9\u36B5\u{2492F}\u90BB\u9097\u5571\u4906\u91BB\u9404\u{28A4B}\u4062\u{28AFC}\u9427\u{28C1D}\u{28C3B}\u84E5\u8A2B\u9599\u95A7\u9597\u9596\u{28D34}\u7445\u3EC2\u{248FF}\u{24A42}\u{243EA}\u3EE7\u{23225}\u968F\u{28EE7}\u{28E66}\u{28E65}\u3ECC\u{249ED}\u{24A78}\u{23FEE}\u7412\u746B\u3EFC\u9741\u{290B0}"],["9640","\u6847\u4A1D\u{29093}\u{257DF}\u975D\u9368\u{28989}\u{28C26}\u{28B2F}\u{263BE}\u92BA\u5B11\u8B69\u493C\u73F9\u{2421B}\u979B\u9771\u9938\u{20F26}\u5DC1\u{28BC5}\u{24AB2}\u981F\u{294DA}\u92F6\u{295D7}\u91E5\u44C0\u{28B50}\u{24A67}\u{28B64}\u98DC\u{28A45}\u3F00\u922A\u4925\u8414\u993B\u994D\u{27B06}\u3DFD\u999B\u4B6F\u99AA\u9A5C\u{28B65}\u{258C8}\u6A8F\u9A21\u5AFE\u9A2F\u{298F1}\u4B90\u{29948}\u99BC\u4BBD\u4B97\u937D\u5872\u{21302}\u5822\u{249B8}"],["96a1","\u{214E8}\u7844\u{2271F}\u{23DB8}\u68C5\u3D7D\u9458\u3927\u6150\u{22781}\u{2296B}\u6107\u9C4F\u9C53\u9C7B\u9C35\u9C10\u9B7F\u9BCF\u{29E2D}\u9B9F\u{2A1F5}\u{2A0FE}\u9D21\u4CAE\u{24104}\u9E18\u4CB0\u9D0C\u{2A1B4}\u{2A0ED}\u{2A0F3}\u{2992F}\u9DA5\u84BD\u{26E12}\u{26FDF}\u{26B82}\u85FC\u4533\u{26DA4}\u{26E84}\u{26DF0}\u8420\u85EE\u{26E00}\u{237D7}\u{26064}\u79E2\u{2359C}\u{23640}\u492D\u{249DE}\u3D62\u93DB\u92BE\u9348\u{202BF}\u78B9\u9277\u944D\u4FE4\u3440\u9064\u{2555D}\u783D\u7854\u78B6\u784B\u{21757}\u{231C9}\u{24941}\u369A\u4F72\u6FDA\u6FD9\u701E\u701E\u5414\u{241B5}\u57BB\u58F3\u578A\u9D16\u57D7\u7134\u34AF\u{241AC}\u71EB\u{26C40}\u{24F97}\u5B28\u{217B5}\u{28A49}"],["9740","\u610C\u5ACE\u5A0B\u42BC\u{24488}\u372C\u4B7B\u{289FC}\u93BB\u93B8\u{218D6}\u{20F1D}\u8472\u{26CC0}\u{21413}\u{242FA}\u{22C26}\u{243C1}\u5994\u{23DB7}\u{26741}\u7DA8\u{2615B}\u{260A4}\u{249B9}\u{2498B}\u{289FA}\u92E5\u73E2\u3EE9\u74B4\u{28B63}\u{2189F}\u3EE1\u{24AB3}\u6AD8\u73F3\u73FB\u3ED6\u{24A3E}\u{24A94}\u{217D9}\u{24A66}\u{203A7}\u{21424}\u{249E5}\u7448\u{24916}\u70A5\u{24976}\u9284\u73E6\u935F\u{204FE}\u9331\u{28ACE}\u{28A16}\u9386\u{28BE7}\u{255D5}\u4935\u{28A82}\u716B"],["97a1","\u{24943}\u{20CFF}\u56A4\u{2061A}\u{20BEB}\u{20CB8}\u5502\u79C4\u{217FA}\u7DFE\u{216C2}\u{24A50}\u{21852}\u452E\u9401\u370A\u{28AC0}\u{249AD}\u59B0\u{218BF}\u{21883}\u{27484}\u5AA1\u36E2\u{23D5B}\u36B0\u925F\u5A79\u{28A81}\u{21862}\u9374\u3CCD\u{20AB4}\u4A96\u398A\u50F4\u3D69\u3D4C\u{2139C}\u7175\u42FB\u{28218}\u6E0F\u{290E4}\u44EB\u6D57\u{27E4F}\u7067\u6CAF\u3CD6\u{23FED}\u{23E2D}\u6E02\u6F0C\u3D6F\u{203F5}\u7551\u36BC\u34C8\u4680\u3EDA\u4871\u59C4\u926E\u493E\u8F41\u{28C1C}\u{26BC0}\u5812\u57C8\u36D6\u{21452}\u70FE\u{24362}\u{24A71}\u{22FE3}\u{212B0}\u{223BD}\u68B9\u6967\u{21398}\u{234E5}\u{27BF4}\u{236DF}\u{28A83}\u{237D6}\u{233FA}\u{24C9F}\u6A1A\u{236AD}\u{26CB7}\u843E\u44DF\u44CE"],["9840","\u{26D26}\u{26D51}\u{26C82}\u{26FDE}\u6F17\u{27109}\u833D\u{2173A}\u83ED\u{26C80}\u{27053}\u{217DB}\u5989\u5A82\u{217B3}\u5A61\u5A71\u{21905}\u{241FC}\u372D\u59EF\u{2173C}\u36C7\u718E\u9390\u669A\u{242A5}\u5A6E\u5A2B\u{24293}\u6A2B\u{23EF9}\u{27736}\u{2445B}\u{242CA}\u711D\u{24259}\u{289E1}\u4FB0\u{26D28}\u5CC2\u{244CE}\u{27E4D}\u{243BD}\u6A0C\u{24256}\u{21304}\u70A6\u7133\u{243E9}\u3DA5\u6CDF\u{2F825}\u{24A4F}\u7E65\u59EB\u5D2F\u3DF3\u5F5C\u{24A5D}\u{217DF}\u7DA4\u8426"],["98a1","\u5485\u{23AFA}\u{23300}\u{20214}\u577E\u{208D5}\u{20619}\u3FE5\u{21F9E}\u{2A2B6}\u7003\u{2915B}\u5D70\u738F\u7CD3\u{28A59}\u{29420}\u4FC8\u7FE7\u72CD\u7310\u{27AF4}\u7338\u7339\u{256F6}\u7341\u7348\u3EA9\u{27B18}\u906C\u71F5\u{248F2}\u73E1\u81F6\u3ECA\u770C\u3ED1\u6CA2\u56FD\u7419\u741E\u741F\u3EE2\u3EF0\u3EF4\u3EFA\u74D3\u3F0E\u3F53\u7542\u756D\u7572\u758D\u3F7C\u75C8\u75DC\u3FC0\u764D\u3FD7\u7674\u3FDC\u767A\u{24F5C}\u7188\u5623\u8980\u5869\u401D\u7743\u4039\u6761\u4045\u35DB\u7798\u406A\u406F\u5C5E\u77BE\u77CB\u58F2\u7818\u70B9\u781C\u40A8\u7839\u7847\u7851\u7866\u8448\u{25535}\u7933\u6803\u7932\u4103"],["9940","\u4109\u7991\u7999\u8FBB\u7A06\u8FBC\u4167\u7A91\u41B2\u7ABC\u8279\u41C4\u7ACF\u7ADB\u41CF\u4E21\u7B62\u7B6C\u7B7B\u7C12\u7C1B\u4260\u427A\u7C7B\u7C9C\u428C\u7CB8\u4294\u7CED\u8F93\u70C0\u{20CCF}\u7DCF\u7DD4\u7DD0\u7DFD\u7FAE\u7FB4\u729F\u4397\u8020\u8025\u7B39\u802E\u8031\u8054\u3DCC\u57B4\u70A0\u80B7\u80E9\u43ED\u810C\u732A\u810E\u8112\u7560\u8114\u4401\u3B39\u8156\u8159\u815A"],["99a1","\u4413\u583A\u817C\u8184\u4425\u8193\u442D\u81A5\u57EF\u81C1\u81E4\u8254\u448F\u82A6\u8276\u82CA\u82D8\u82FF\u44B0\u8357\u9669\u698A\u8405\u70F5\u8464\u60E3\u8488\u4504\u84BE\u84E1\u84F8\u8510\u8538\u8552\u453B\u856F\u8570\u85E0\u4577\u8672\u8692\u86B2\u86EF\u9645\u878B\u4606\u4617\u88AE\u88FF\u8924\u8947\u8991\u{27967}\u8A29\u8A38\u8A94\u8AB4\u8C51\u8CD4\u8CF2\u8D1C\u4798\u585F\u8DC3\u47ED\u4EEE\u8E3A\u55D8\u5754\u8E71\u55F5\u8EB0\u4837\u8ECE\u8EE2\u8EE4\u8EED\u8EF2\u8FB7\u8FC1\u8FCA\u8FCC\u9033\u99C4\u48AD\u98E0\u9213\u491E\u9228\u9258\u926B\u92B1\u92AE\u92BF"],["9a40","\u92E3\u92EB\u92F3\u92F4\u92FD\u9343\u9384\u93AD\u4945\u4951\u9EBF\u9417\u5301\u941D\u942D\u943E\u496A\u9454\u9479\u952D\u95A2\u49A7\u95F4\u9633\u49E5\u67A0\u4A24\u9740\u4A35\u97B2\u97C2\u5654\u4AE4\u60E8\u98B9\u4B19\u98F1\u5844\u990E\u9919\u51B4\u991C\u9937\u9942\u995D\u9962\u4B70\u99C5\u4B9D\u9A3C\u9B0F\u7A83\u9B69\u9B81\u9BDD\u9BF1\u9BF4\u4C6D\u9C20\u376F\u{21BC2}\u9D49\u9C3A"],["9aa1","\u9EFE\u5650\u9D93\u9DBD\u9DC0\u9DFC\u94F6\u8FB6\u9E7B\u9EAC\u9EB1\u9EBD\u9EC6\u94DC\u9EE2\u9EF1\u9EF8\u7AC8\u9F44\u{20094}\u{202B7}\u{203A0}\u691A\u94C3\u59AC\u{204D7}\u5840\u94C1\u37B9\u{205D5}\u{20615}\u{20676}\u{216BA}\u5757\u7173\u{20AC2}\u{20ACD}\u{20BBF}\u546A\u{2F83B}\u{20BCB}\u549E\u{20BFB}\u{20C3B}\u{20C53}\u{20C65}\u{20C7C}\u60E7\u{20C8D}\u567A\u{20CB5}\u{20CDD}\u{20CED}\u{20D6F}\u{20DB2}\u{20DC8}\u6955\u9C2F\u87A5\u{20E04}\u{20E0E}\u{20ED7}\u{20F90}\u{20F2D}\u{20E73}\u5C20\u{20FBC}\u5E0B\u{2105C}\u{2104F}\u{21076}\u671E\u{2107B}\u{21088}\u{21096}\u3647\u{210BF}\u{210D3}\u{2112F}\u{2113B}\u5364\u84AD\u{212E3}\u{21375}\u{21336}\u8B81\u{21577}\u{21619}\u{217C3}\u{217C7}\u4E78\u70BB\u{2182D}\u{2196A}"],["9b40","\u{21A2D}\u{21A45}\u{21C2A}\u{21C70}\u{21CAC}\u{21EC8}\u62C3\u{21ED5}\u{21F15}\u7198\u6855\u{22045}\u69E9\u36C8\u{2227C}\u{223D7}\u{223FA}\u{2272A}\u{22871}\u{2294F}\u82FD\u{22967}\u{22993}\u{22AD5}\u89A5\u{22AE8}\u8FA0\u{22B0E}\u97B8\u{22B3F}\u9847\u9ABD\u{22C4C}"],["9b62","\u{22C88}\u{22CB7}\u{25BE8}\u{22D08}\u{22D12}\u{22DB7}\u{22D95}\u{22E42}\u{22F74}\u{22FCC}\u{23033}\u{23066}\u{2331F}\u{233DE}\u5FB1\u6648\u66BF\u{27A79}\u{23567}\u{235F3}\u7201\u{249BA}\u77D7\u{2361A}\u{23716}\u7E87\u{20346}\u58B5\u670E"],["9ba1","\u6918\u{23AA7}\u{27657}\u{25FE2}\u{23E11}\u{23EB9}\u{275FE}\u{2209A}\u48D0\u4AB8\u{24119}\u{28A9A}\u{242EE}\u{2430D}\u{2403B}\u{24334}\u{24396}\u{24A45}\u{205CA}\u51D2\u{20611}\u599F\u{21EA8}\u3BBE\u{23CFF}\u{24404}\u{244D6}\u5788\u{24674}\u399B\u{2472F}\u{285E8}\u{299C9}\u3762\u{221C3}\u8B5E\u{28B4E}\u99D6\u{24812}\u{248FB}\u{24A15}\u7209\u{24AC0}\u{20C78}\u5965\u{24EA5}\u{24F86}\u{20779}\u8EDA\u{2502C}\u528F\u573F\u7171\u{25299}\u{25419}\u{23F4A}\u{24AA7}\u55BC\u{25446}\u{2546E}\u{26B52}\u91D4\u3473\u{2553F}\u{27632}\u{2555E}\u4718\u{25562}\u{25566}\u{257C7}\u{2493F}\u{2585D}\u5066\u34FB\u{233CC}\u60DE\u{25903}\u477C\u{28948}\u{25AAE}\u{25B89}\u{25C06}\u{21D90}\u57A1\u7151\u6FB6\u{26102}\u{27C12}\u9056\u{261B2}\u{24F9A}\u8B62\u{26402}\u{2644A}"],["9c40","\u5D5B\u{26BF7}\u8F36\u{26484}\u{2191C}\u8AEA\u{249F6}\u{26488}\u{23FEF}\u{26512}\u4BC0\u{265BF}\u{266B5}\u{2271B}\u9465\u{257E1}\u6195\u5A27\u{2F8CD}\u4FBB\u56B9\u{24521}\u{266FC}\u4E6A\u{24934}\u9656\u6D8F\u{26CBD}\u3618\u8977\u{26799}\u{2686E}\u{26411}\u{2685E}\u71DF\u{268C7}\u7B42\u{290C0}\u{20A11}\u{26926}\u9104\u{26939}\u7A45\u9DF0\u{269FA}\u9A26\u{26A2D}\u365F\u{26469}\u{20021}\u7983\u{26A34}\u{26B5B}\u5D2C\u{23519}\u83CF\u{26B9D}\u46D0\u{26CA4}\u753B\u8865\u{26DAE}\u58B6"],["9ca1","\u371C\u{2258D}\u{2704B}\u{271CD}\u3C54\u{27280}\u{27285}\u9281\u{2217A}\u{2728B}\u9330\u{272E6}\u{249D0}\u6C39\u949F\u{27450}\u{20EF8}\u8827\u88F5\u{22926}\u{28473}\u{217B1}\u6EB8\u{24A2A}\u{21820}\u39A4\u36B9\u5C10\u79E3\u453F\u66B6\u{29CAD}\u{298A4}\u8943\u{277CC}\u{27858}\u56D6\u40DF\u{2160A}\u39A1\u{2372F}\u{280E8}\u{213C5}\u71AD\u8366\u{279DD}\u{291A8}\u5A67\u4CB7\u{270AF}\u{289AB}\u{279FD}\u{27A0A}\u{27B0B}\u{27D66}\u{2417A}\u7B43\u797E\u{28009}\u6FB5\u{2A2DF}\u6A03\u{28318}\u53A2\u{26E07}\u93BF\u6836\u975D\u{2816F}\u{28023}\u{269B5}\u{213ED}\u{2322F}\u{28048}\u5D85\u{28C30}\u{28083}\u5715\u9823\u{28949}\u5DAB\u{24988}\u65BE\u69D5\u53D2\u{24AA5}\u{23F81}\u3C11\u6736\u{28090}\u{280F4}\u{2812E}\u{21FA1}\u{2814F}"],["9d40","\u{28189}\u{281AF}\u{2821A}\u{28306}\u{2832F}\u{2838A}\u35CA\u{28468}\u{286AA}\u48FA\u63E6\u{28956}\u7808\u9255\u{289B8}\u43F2\u{289E7}\u43DF\u{289E8}\u{28B46}\u{28BD4}\u59F8\u{28C09}\u8F0B\u{28FC5}\u{290EC}\u7B51\u{29110}\u{2913C}\u3DF7\u{2915E}\u{24ACA}\u8FD0\u728F\u568B\u{294E7}\u{295E9}\u{295B0}\u{295B8}\u{29732}\u{298D1}\u{29949}\u{2996A}\u{299C3}\u{29A28}\u{29B0E}\u{29D5A}\u{29D9B}\u7E9F\u{29EF8}\u{29F23}\u4CA4\u9547\u{2A293}\u71A2\u{2A2FF}\u4D91\u9012\u{2A5CB}\u4D9C\u{20C9C}\u8FBE\u55C1"],["9da1","\u8FBA\u{224B0}\u8FB9\u{24A93}\u4509\u7E7F\u6F56\u6AB1\u4EEA\u34E4\u{28B2C}\u{2789D}\u373A\u8E80\u{217F5}\u{28024}\u{28B6C}\u{28B99}\u{27A3E}\u{266AF}\u3DEB\u{27655}\u{23CB7}\u{25635}\u{25956}\u4E9A\u{25E81}\u{26258}\u56BF\u{20E6D}\u8E0E\u5B6D\u{23E88}\u{24C9E}\u63DE\u62D0\u{217F6}\u{2187B}\u6530\u562D\u{25C4A}\u541A\u{25311}\u3DC6\u{29D98}\u4C7D\u5622\u561E\u7F49\u{25ED8}\u5975\u{23D40}\u8770\u4E1C\u{20FEA}\u{20D49}\u{236BA}\u8117\u9D5E\u8D18\u763B\u9C45\u764E\u77B9\u9345\u5432\u8148\u82F7\u5625\u8132\u8418\u80BD\u55EA\u7962\u5643\u5416\u{20E9D}\u35CE\u5605\u55F1\u66F1\u{282E2}\u362D\u7534\u55F0\u55BA\u5497\u5572\u{20C41}\u{20C96}\u5ED0\u{25148}\u{20E76}\u{22C62}"],["9e40","\u{20EA2}\u9EAB\u7D5A\u55DE\u{21075}\u629D\u976D\u5494\u8CCD\u71F6\u9176\u63FC\u63B9\u63FE\u5569\u{22B43}\u9C72\u{22EB3}\u519A\u34DF\u{20DA7}\u51A7\u544D\u551E\u5513\u7666\u8E2D\u{2688A}\u75B1\u80B6\u8804\u8786\u88C7\u81B6\u841C\u{210C1}\u44EC\u7304\u{24706}\u5B90\u830B\u{26893}\u567B\u{226F4}\u{27D2F}\u{241A3}\u{27D73}\u{26ED0}\u{272B6}\u9170\u{211D9}\u9208\u{23CFC}\u{2A6A9}\u{20EAC}\u{20EF9}\u7266\u{21CA2}\u474E\u{24FC2}\u{27FF9}\u{20FEB}\u40FA"],["9ea1","\u9C5D\u651F\u{22DA0}\u48F3\u{247E0}\u{29D7C}\u{20FEC}\u{20E0A}\u6062\u{275A3}\u{20FED}"],["9ead","\u{26048}\u{21187}\u71A3\u7E8E\u9D50\u4E1A\u4E04\u3577\u5B0D\u6CB2\u5367\u36AC\u39DC\u537D\u36A5\u{24618}\u589A\u{24B6E}\u822D\u544B\u57AA\u{25A95}\u{20979}"],["9ec5","\u3A52\u{22465}\u7374\u{29EAC}\u4D09\u9BED\u{23CFE}\u{29F30}\u4C5B\u{24FA9}\u{2959E}\u{29FDE}\u845C\u{23DB6}\u{272B2}\u{267B3}\u{23720}\u632E\u7D25\u{23EF7}\u{23E2C}\u3A2A\u9008\u52CC\u3E74\u367A\u45E9\u{2048E}\u7640\u5AF0\u{20EB6}\u787A\u{27F2E}\u58A7\u40BF\u567C\u9B8B\u5D74\u7654\u{2A434}\u9E85\u4CE1\u75F9\u37FB\u6119\u{230DA}\u{243F2}"],["9ef5","\u565D\u{212A9}\u57A7\u{24963}\u{29E06}\u5234\u{270AE}\u35AD\u6C4A\u9D7C"],["9f40","\u7C56\u9B39\u57DE\u{2176C}\u5C53\u64D3\u{294D0}\u{26335}\u{27164}\u86AD\u{20D28}\u{26D22}\u{24AE2}\u{20D71}"],["9f4f","\u51FE\u{21F0F}\u5D8E\u9703\u{21DD1}\u9E81\u904C\u7B1F\u9B02\u5CD1\u7BA3\u6268\u6335\u9AFF\u7BCF\u9B2A\u7C7E\u9B2E\u7C42\u7C86\u9C15\u7BFC\u9B09\u9F17\u9C1B\u{2493E}\u9F5A\u5573\u5BC3\u4FFD\u9E98\u4FF2\u5260\u3E06\u52D1\u5767\u5056\u59B7\u5E12\u97C8\u9DAB\u8F5C\u5469\u97B4\u9940\u97BA\u532C\u6130"],["9fa1","\u692C\u53DA\u9C0A\u9D02\u4C3B\u9641\u6980\u50A6\u7546\u{2176D}\u99DA\u5273"],["9fae","\u9159\u9681\u915C"],["9fb2","\u9151\u{28E97}\u637F\u{26D23}\u6ACA\u5611\u918E\u757A\u6285\u{203FC}\u734F\u7C70\u{25C21}\u{23CFD}"],["9fc1","\u{24919}\u76D6\u9B9D\u4E2A\u{20CD4}\u83BE\u8842"],["9fc9","\u5C4A\u69C0\u50ED\u577A\u521F\u5DF5\u4ECE\u6C31\u{201F2}\u4F39\u549C\u54DA\u529A\u8D82\u35FE\u5F0C\u35F3"],["9fdb","\u6B52\u917C\u9FA5\u9B97\u982E\u98B4\u9ABA\u9EA8\u9E84\u717A\u7B14"],["9fe7","\u6BFA\u8818\u7F78"],["9feb","\u5620\u{2A64A}\u8E77\u9F53"],["9ff0","\u8DD4\u8E4F\u9E1C\u8E01\u6282\u{2837D}\u8E28\u8E75\u7AD3\u{24A77}\u7A3E\u78D8\u6CEA\u8A67\u7607"],["a040","\u{28A5A}\u9F26\u6CCE\u87D6\u75C3\u{2A2B2}\u7853\u{2F840}\u8D0C\u72E2\u7371\u8B2D\u7302\u74F1\u8CEB\u{24ABB}\u862F\u5FBA\u88A0\u44B7"],["a055","\u{2183B}\u{26E05}"],["a058","\u8A7E\u{2251B}"],["a05b","\u60FD\u7667\u9AD7\u9D44\u936E\u9B8F\u87F5"],["a063","\u880F\u8CF7\u732C\u9721\u9BB0\u35D6\u72B2\u4C07\u7C51\u994A\u{26159}\u6159\u4C04\u9E96\u617D"],["a073","\u575F\u616F\u62A6\u6239\u62CE\u3A5C\u61E2\u53AA\u{233F5}\u6364\u6802\u35D2"],["a0a1","\u5D57\u{28BC2}\u8FDA\u{28E39}"],["a0a6","\u50D9\u{21D46}\u7906\u5332\u9638\u{20F3B}\u4065"],["a0ae","\u77FE"],["a0b0","\u7CC2\u{25F1A}\u7CDA\u7A2D\u8066\u8063\u7D4D\u7505\u74F2\u8994\u821A\u670C\u8062\u{27486}\u805B\u74F0\u8103\u7724\u8989\u{267CC}\u7553\u{26ED1}\u87A9\u87CE\u81C8\u878C\u8A49\u8CAD\u8B43\u772B\u74F8\u84DA\u3635\u69B2\u8DA6"],["a0d4","\u89A9\u7468\u6DB9\u87C1\u{24011}\u74E7\u3DDB\u7176\u60A4\u619C\u3CD1\u7162\u6077"],["a0e2","\u7F71\u{28B2D}\u7250\u60E9\u4B7E\u5220\u3C18\u{23CC7}\u{25ED7}\u{27656}\u{25531}\u{21944}\u{212FE}\u{29903}\u{26DDC}\u{270AD}\u5CC1\u{261AD}\u{28A0F}\u{23677}\u{200EE}\u{26846}\u{24F0E}\u4562\u5B1F\u{2634C}\u9F50\u9EA6\u{2626B}"],["a3c0","\u2400",31,"\u2421"],["c6a1","\u2460",9,"\u2474",9,"\u2170",9,"\u4E36\u4E3F\u4E85\u4EA0\u5182\u5196\u51AB\u52F9\u5338\u5369\u53B6\u590A\u5B80\u5DDB\u2F33\u5E7F\u5EF4\u5F50\u5F61\u6534\u65E0\u7592\u7676\u8FB5\u96B6\xA8\u02C6\u30FD\u30FE\u309D\u309E\u3003\u4EDD\u3005\u3006\u3007\u30FC\uFF3B\uFF3D\u273D\u3041",23],["c740","\u3059",58,"\u30A1\u30A2\u30A3\u30A4"],["c7a1","\u30A5",81,"\u0410",5,"\u0401\u0416",4],["c840","\u041B",26,"\u0451\u0436",25,"\u21E7\u21B8\u21B9\u31CF\u{200CC}\u4E5A\u{2008A}\u5202\u4491"],["c8a1","\u9FB0\u5188\u9FB1\u{27607}"],["c8cd","\uFFE2\uFFE4\uFF07\uFF02\u3231\u2116\u2121\u309B\u309C\u2E80\u2E84\u2E86\u2E87\u2E88\u2E8A\u2E8C\u2E8D\u2E95\u2E9C\u2E9D\u2EA5\u2EA7\u2EAA\u2EAC\u2EAE\u2EB6\u2EBC\u2EBE\u2EC6\u2ECA\u2ECC\u2ECD\u2ECF\u2ED6\u2ED7\u2EDE\u2EE3"],["c8f5","\u0283\u0250\u025B\u0254\u0275\u0153\xF8\u014B\u028A\u026A"],["f9fe","\uFFED"],["fa40","\u{20547}\u92DB\u{205DF}\u{23FC5}\u854C\u42B5\u73EF\u51B5\u3649\u{24942}\u{289E4}\u9344\u{219DB}\u82EE\u{23CC8}\u783C\u6744\u62DF\u{24933}\u{289AA}\u{202A0}\u{26BB3}\u{21305}\u4FAB\u{224ED}\u5008\u{26D29}\u{27A84}\u{23600}\u{24AB1}\u{22513}\u5029\u{2037E}\u5FA4\u{20380}\u{20347}\u6EDB\u{2041F}\u507D\u5101\u347A\u510E\u986C\u3743\u8416\u{249A4}\u{20487}\u5160\u{233B4}\u516A\u{20BFF}\u{220FC}\u{202E5}\u{22530}\u{2058E}\u{23233}\u{21983}\u5B82\u877D\u{205B3}\u{23C99}\u51B2\u51B8"],["faa1","\u9D34\u51C9\u51CF\u51D1\u3CDC\u51D3\u{24AA6}\u51B3\u51E2\u5342\u51ED\u83CD\u693E\u{2372D}\u5F7B\u520B\u5226\u523C\u52B5\u5257\u5294\u52B9\u52C5\u7C15\u8542\u52E0\u860D\u{26B13}\u5305\u{28ADE}\u5549\u6ED9\u{23F80}\u{20954}\u{23FEC}\u5333\u5344\u{20BE2}\u6CCB\u{21726}\u681B\u73D5\u604A\u3EAA\u38CC\u{216E8}\u71DD\u44A2\u536D\u5374\u{286AB}\u537E\u537F\u{21596}\u{21613}\u77E6\u5393\u{28A9B}\u53A0\u53AB\u53AE\u73A7\u{25772}\u3F59\u739C\u53C1\u53C5\u6C49\u4E49\u57FE\u53D9\u3AAB\u{20B8F}\u53E0\u{23FEB}\u{22DA3}\u53F6\u{20C77}\u5413\u7079\u552B\u6657\u6D5B\u546D\u{26B53}\u{20D74}\u555D\u548F\u54A4\u47A6\u{2170D}\u{20EDD}\u3DB4\u{20D4D}"],["fb40","\u{289BC}\u{22698}\u5547\u4CED\u542F\u7417\u5586\u55A9\u5605\u{218D7}\u{2403A}\u4552\u{24435}\u66B3\u{210B4}\u5637\u66CD\u{2328A}\u66A4\u66AD\u564D\u564F\u78F1\u56F1\u9787\u53FE\u5700\u56EF\u56ED\u{28B66}\u3623\u{2124F}\u5746\u{241A5}\u6C6E\u708B\u5742\u36B1\u{26C7E}\u57E6\u{21416}\u5803\u{21454}\u{24363}\u5826\u{24BF5}\u585C\u58AA\u3561\u58E0\u58DC\u{2123C}\u58FB\u5BFF\u5743\u{2A150}\u{24278}\u93D3\u35A1\u591F\u68A6\u36C3\u6E59"],["fba1","\u{2163E}\u5A24\u5553\u{21692}\u8505\u59C9\u{20D4E}\u{26C81}\u{26D2A}\u{217DC}\u59D9\u{217FB}\u{217B2}\u{26DA6}\u6D71\u{21828}\u{216D5}\u59F9\u{26E45}\u5AAB\u5A63\u36E6\u{249A9}\u5A77\u3708\u5A96\u7465\u5AD3\u{26FA1}\u{22554}\u3D85\u{21911}\u3732\u{216B8}\u5E83\u52D0\u5B76\u6588\u5B7C\u{27A0E}\u4004\u485D\u{20204}\u5BD5\u6160\u{21A34}\u{259CC}\u{205A5}\u5BF3\u5B9D\u4D10\u5C05\u{21B44}\u5C13\u73CE\u5C14\u{21CA5}\u{26B28}\u5C49\u48DD\u5C85\u5CE9\u5CEF\u5D8B\u{21DF9}\u{21E37}\u5D10\u5D18\u5D46\u{21EA4}\u5CBA\u5DD7\u82FC\u382D\u{24901}\u{22049}\u{22173}\u8287\u3836\u3BC2\u5E2E\u6A8A\u5E75\u5E7A\u{244BC}\u{20CD3}\u53A6\u4EB7\u5ED0\u53A8\u{21771}\u5E09\u5EF4\u{28482}"],["fc40","\u5EF9\u5EFB\u38A0\u5EFC\u683E\u941B\u5F0D\u{201C1}\u{2F894}\u3ADE\u48AE\u{2133A}\u5F3A\u{26888}\u{223D0}\u5F58\u{22471}\u5F63\u97BD\u{26E6E}\u5F72\u9340\u{28A36}\u5FA7\u5DB6\u3D5F\u{25250}\u{21F6A}\u{270F8}\u{22668}\u91D6\u{2029E}\u{28A29}\u6031\u6685\u{21877}\u3963\u3DC7\u3639\u5790\u{227B4}\u7971\u3E40\u609E\u60A4\u60B3\u{24982}\u{2498F}\u{27A53}\u74A4\u50E1\u5AA0\u6164\u8424\u6142\u{2F8A6}\u{26ED2}\u6181\u51F4\u{20656}\u6187\u5BAA\u{23FB7}"],["fca1","\u{2285F}\u61D3\u{28B9D}\u{2995D}\u61D0\u3932\u{22980}\u{228C1}\u6023\u615C\u651E\u638B\u{20118}\u62C5\u{21770}\u62D5\u{22E0D}\u636C\u{249DF}\u3A17\u6438\u63F8\u{2138E}\u{217FC}\u6490\u6F8A\u{22E36}\u9814\u{2408C}\u{2571D}\u64E1\u64E5\u947B\u3A66\u643A\u3A57\u654D\u6F16\u{24A28}\u{24A23}\u6585\u656D\u655F\u{2307E}\u65B5\u{24940}\u4B37\u65D1\u40D8\u{21829}\u65E0\u65E3\u5FDF\u{23400}\u6618\u{231F7}\u{231F8}\u6644\u{231A4}\u{231A5}\u664B\u{20E75}\u6667\u{251E6}\u6673\u6674\u{21E3D}\u{23231}\u{285F4}\u{231C8}\u{25313}\u77C5\u{228F7}\u99A4\u6702\u{2439C}\u{24A21}\u3B2B\u69FA\u{237C2}\u675E\u6767\u6762\u{241CD}\u{290ED}\u67D7\u44E9\u6822\u6E50\u923C\u6801\u{233E6}\u{26DA0}\u685D"],["fd40","\u{2346F}\u69E1\u6A0B\u{28ADF}\u6973\u68C3\u{235CD}\u6901\u6900\u3D32\u3A01\u{2363C}\u3B80\u67AC\u6961\u{28A4A}\u42FC\u6936\u6998\u3BA1\u{203C9}\u8363\u5090\u69F9\u{23659}\u{2212A}\u6A45\u{23703}\u6A9D\u3BF3\u67B1\u6AC8\u{2919C}\u3C0D\u6B1D\u{20923}\u60DE\u6B35\u6B74\u{227CD}\u6EB5\u{23ADB}\u{203B5}\u{21958}\u3740\u5421\u{23B5A}\u6BE1\u{23EFC}\u6BDC\u6C37\u{2248B}\u{248F1}\u{26B51}\u6C5A\u8226\u6C79\u{23DBC}\u44C5\u{23DBD}\u{241A4}\u{2490C}\u{24900}"],["fda1","\u{23CC9}\u36E5\u3CEB\u{20D32}\u9B83\u{231F9}\u{22491}\u7F8F\u6837\u{26D25}\u{26DA1}\u{26DEB}\u6D96\u6D5C\u6E7C\u6F04\u{2497F}\u{24085}\u{26E72}\u8533\u{26F74}\u51C7\u6C9C\u6E1D\u842E\u{28B21}\u6E2F\u{23E2F}\u7453\u{23F82}\u79CC\u6E4F\u5A91\u{2304B}\u6FF8\u370D\u6F9D\u{23E30}\u6EFA\u{21497}\u{2403D}\u4555\u93F0\u6F44\u6F5C\u3D4E\u6F74\u{29170}\u3D3B\u6F9F\u{24144}\u6FD3\u{24091}\u{24155}\u{24039}\u{23FF0}\u{23FB4}\u{2413F}\u51DF\u{24156}\u{24157}\u{24140}\u{261DD}\u704B\u707E\u70A7\u7081\u70CC\u70D5\u70D6\u70DF\u4104\u3DE8\u71B4\u7196\u{24277}\u712B\u7145\u5A88\u714A\u716E\u5C9C\u{24365}\u714F\u9362\u{242C1}\u712C\u{2445A}\u{24A27}\u{24A22}\u71BA\u{28BE8}\u70BD\u720E"],["fe40","\u9442\u7215\u5911\u9443\u7224\u9341\u{25605}\u722E\u7240\u{24974}\u68BD\u7255\u7257\u3E55\u{23044}\u680D\u6F3D\u7282\u732A\u732B\u{24823}\u{2882B}\u48ED\u{28804}\u7328\u732E\u73CF\u73AA\u{20C3A}\u{26A2E}\u73C9\u7449\u{241E2}\u{216E7}\u{24A24}\u6623\u36C5\u{249B7}\u{2498D}\u{249FB}\u73F7\u7415\u6903\u{24A26}\u7439\u{205C3}\u3ED7\u745C\u{228AD}\u7460\u{28EB2}\u7447\u73E4\u7476\u83B9\u746C\u3730\u7474\u93F1\u6A2C\u7482\u4953\u{24A8C}"],["fea1","\u{2415F}\u{24A79}\u{28B8F}\u5B46\u{28C03}\u{2189E}\u74C8\u{21988}\u750E\u74E9\u751E\u{28ED9}\u{21A4B}\u5BD7\u{28EAC}\u9385\u754D\u754A\u7567\u756E\u{24F82}\u3F04\u{24D13}\u758E\u745D\u759E\u75B4\u7602\u762C\u7651\u764F\u766F\u7676\u{263F5}\u7690\u81EF\u37F8\u{26911}\u{2690E}\u76A1\u76A5\u76B7\u76CC\u{26F9F}\u8462\u{2509D}\u{2517D}\u{21E1C}\u771E\u7726\u7740\u64AF\u{25220}\u7758\u{232AC}\u77AF\u{28964}\u{28968}\u{216C1}\u77F4\u7809\u{21376}\u{24A12}\u68CA\u78AF\u78C7\u78D3\u96A5\u792E\u{255E0}\u78D7\u7934\u78B1\u{2760C}\u8FB8\u8884\u{28B2B}\u{26083}\u{2261C}\u7986\u8900\u6902\u7980\u{25857}\u799D\u{27B39}\u793C\u79A9\u6E2A\u{27126}\u3EA8\u79C6\u{2910D}\u79D4"]]});var iO=H((Nle,oO)=>{"use strict";oO.exports={shiftjis:{type:"_dbcs",table:function(){return tO()},encodeAdd:{"\xA5":92,"\u203E":126},encodeSkipVals:[{from:60736,to:63808}]},csshiftjis:"shiftjis",mskanji:"shiftjis",sjis:"shiftjis",windows31j:"shiftjis",ms31j:"shiftjis",xsjis:"shiftjis",windows932:"shiftjis",ms932:"shiftjis",932:"shiftjis",cp932:"shiftjis",eucjp:{type:"_dbcs",table:function(){return rO()},encodeAdd:{"\xA5":92,"\u203E":126}},gb2312:"cp936",gb231280:"cp936",gb23121980:"cp936",csgb2312:"cp936",csiso58gb231280:"cp936",euccn:"cp936",windows936:"cp936",ms936:"cp936",936:"cp936",cp936:{type:"_dbcs",table:function(){return hh()}},gbk:{type:"_dbcs",table:function(){return hh().concat(uv())}},xgbk:"gbk",isoir58:"gbk",gb18030:{type:"_dbcs",table:function(){return hh().concat(uv())},gb18030:function(){return nO()},encodeSkipVals:[128],encodeAdd:{"\u20AC":41699}},chinese:"gb18030",windows949:"cp949",ms949:"cp949",949:"cp949",cp949:{type:"_dbcs",table:function(){return aO()}},cseuckr:"cp949",csksc56011987:"cp949",euckr:"cp949",isoir149:"cp949",korean:"cp949",ksc56011987:"cp949",ksc56011989:"cp949",ksc5601:"cp949",windows950:"cp950",ms950:"cp950",950:"cp950",cp950:{type:"_dbcs",table:function(){return pv()}},big5:"big5hkscs",big5hkscs:{type:"_dbcs",table:function(){return pv().concat(sO())},encodeSkipVals:[41676]},cnbig5:"big5hkscs",csbig5:"big5hkscs",xxbig5:"big5hkscs"}});var uO=H((lO,rl)=>{"use strict";var cO=[FT(),GT(),zT(),WT(),JT(),XT(),eO(),iO()];for(fh=0;fh<cO.length;fh++){rl=cO[fh];for(gh in rl)Object.prototype.hasOwnProperty.call(rl,gh)&&(lO[gh]=rl[gh])}var rl,gh,fh});var mO=H((_le,dO)=>{"use strict";var pO=require("buffer").Buffer,yh=require("stream").Transform;dO.exports=function(r){r.encodeStream=function(t,n){return new Ci(r.getEncoder(t,n),n)},r.decodeStream=function(t,n){return new vo(r.getDecoder(t,n),n)},r.supportsStreams=!0,r.IconvLiteEncoderStream=Ci,r.IconvLiteDecoderStream=vo,r._collect=vo.prototype.collect};function Ci(r,e){this.conv=r,e=e||{},e.decodeStrings=!1,yh.call(this,e)}Ci.prototype=Object.create(yh.prototype,{constructor:{value:Ci}});Ci.prototype._transform=function(r,e,t){if(typeof r!="string")return t(new Error("Iconv encoding stream needs strings as its input."));try{var n=this.conv.write(r);n&&n.length&&this.push(n),t()}catch(a){t(a)}};Ci.prototype._flush=function(r){try{var e=this.conv.end();e&&e.length&&this.push(e),r()}catch(t){r(t)}};Ci.prototype.collect=function(r){var e=[];return this.on("error",r),this.on("data",function(t){e.push(t)}),this.on("end",function(){r(null,pO.concat(e))}),this};function vo(r,e){this.conv=r,e=e||{},e.encoding=this.encoding="utf8",yh.call(this,e)}vo.prototype=Object.create(yh.prototype,{constructor:{value:vo}});vo.prototype._transform=function(r,e,t){if(!pO.isBuffer(r))return t(new Error("Iconv decoding stream needs buffers as its input."));try{var n=this.conv.write(r);n&&n.length&&this.push(n,this.encoding),t()}catch(a){t(a)}};vo.prototype._flush=function(r){try{var e=this.conv.end();e&&e.length&&this.push(e,this.encoding),r()}catch(t){r(t)}};vo.prototype.collect=function(r){var e="";return this.on("error",r),this.on("data",function(t){e+=t}),this.on("end",function(){r(null,e)}),this}});var fO=H((Ple,hO)=>{"use strict";var Ir=require("buffer").Buffer;hO.exports=function(r){var e=void 0;r.supportsNodeEncodingsExtension=!(Ir.from||new Ir(0)instanceof Uint8Array),r.extendNodeEncodings=function(){if(!e){if(e={},!r.supportsNodeEncodingsExtension){console.error("ACTION NEEDED: require('iconv-lite').extendNodeEncodings() is not supported in your version of Node"),console.error("See more info at https://github.com/ashtuchkin/iconv-lite/wiki/Node-v4-compatibility");return}var n={hex:!0,utf8:!0,"utf-8":!0,ascii:!0,binary:!0,base64:!0,ucs2:!0,"ucs-2":!0,utf16le:!0,"utf-16le":!0};Ir.isNativeEncoding=function(o){return o&&n[o.toLowerCase()]};var a=require("buffer").SlowBuffer;if(e.SlowBufferToString=a.prototype.toString,a.prototype.toString=function(o,i,u){return o=String(o||"utf8").toLowerCase(),Ir.isNativeEncoding(o)?e.SlowBufferToString.call(this,o,i,u):(typeof i>"u"&&(i=0),typeof u>"u"&&(u=this.length),r.decode(this.slice(i,u),o))},e.SlowBufferWrite=a.prototype.write,a.prototype.write=function(o,i,u,c){if(isFinite(i))isFinite(u)||(c=u,u=void 0);else{var p=c;c=i,i=u,u=p}i=+i||0;var m=this.length-i;if(u?(u=+u,u>m&&(u=m)):u=m,c=String(c||"utf8").toLowerCase(),Ir.isNativeEncoding(c))return e.SlowBufferWrite.call(this,o,i,u,c);if(o.length>0&&(u<0||i<0))throw new RangeError("attempt to write beyond buffer bounds");var f=r.encode(o,c);return f.length<u&&(u=f.length),f.copy(this,i,0,u),u},e.BufferIsEncoding=Ir.isEncoding,Ir.isEncoding=function(o){return Ir.isNativeEncoding(o)||r.encodingExists(o)},e.BufferByteLength=Ir.byteLength,Ir.byteLength=a.byteLength=function(o,i){return i=String(i||"utf8").toLowerCase(),Ir.isNativeEncoding(i)?e.BufferByteLength.call(this,o,i):r.encode(o,i).length},e.BufferToString=Ir.prototype.toString,Ir.prototype.toString=function(o,i,u){return o=String(o||"utf8").toLowerCase(),Ir.isNativeEncoding(o)?e.BufferToString.call(this,o,i,u):(typeof i>"u"&&(i=0),typeof u>"u"&&(u=this.length),r.decode(this.slice(i,u),o))},e.BufferWrite=Ir.prototype.write,Ir.prototype.write=function(o,i,u,c){var p=i,m=u,f=c;if(isFinite(i))isFinite(u)||(c=u,u=void 0);else{var g=c;c=i,i=u,u=g}if(c=String(c||"utf8").toLowerCase(),Ir.isNativeEncoding(c))return e.BufferWrite.call(this,o,p,m,f);i=+i||0;var y=this.length-i;if(u?(u=+u,u>y&&(u=y)):u=y,o.length>0&&(u<0||i<0))throw new RangeError("attempt to write beyond buffer bounds");var C=r.encode(o,c);return C.length<u&&(u=C.length),C.copy(this,i,0,u),u},r.supportsStreams){var s=require("stream").Readable;e.ReadableSetEncoding=s.prototype.setEncoding,s.prototype.setEncoding=function(i,u){this._readableState.decoder=r.getDecoder(i,u),this._readableState.encoding=i},s.prototype.collect=r._collect}}},r.undoExtendNodeEncodings=function(){if(r.supportsNodeEncodingsExtension){if(!e)throw new Error("require('iconv-lite').undoExtendNodeEncodings(): Nothing to undo; extendNodeEncodings() is not called.");delete Ir.isNativeEncoding;var n=require("buffer").SlowBuffer;if(n.prototype.toString=e.SlowBufferToString,n.prototype.write=e.SlowBufferWrite,Ir.isEncoding=e.BufferIsEncoding,Ir.byteLength=e.BufferByteLength,Ir.prototype.toString=e.BufferToString,Ir.prototype.write=e.BufferWrite,r.supportsStreams){var a=require("stream").Readable;a.prototype.setEncoding=e.ReadableSetEncoding,delete a.prototype.collect}e=void 0}}}});var mv=H(($le,vO)=>{"use strict";var yO=vi().Buffer,bO=MT(),zt=vO.exports;zt.encodings=null;zt.defaultCharUnicode="\uFFFD";zt.defaultCharSingleByte="?";zt.encode=function(e,t,n){e=""+(e||"");var a=zt.getEncoder(t,n),s=a.write(e),o=a.end();return o&&o.length>0?yO.concat([s,o]):s};zt.decode=function(e,t,n){typeof e=="string"&&(zt.skipDecodeWarning||(console.error("Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding"),zt.skipDecodeWarning=!0),e=yO.from(""+(e||""),"binary"));var a=zt.getDecoder(t,n),s=a.write(e),o=a.end();return o?s+o:s};zt.encodingExists=function(e){try{return zt.getCodec(e),!0}catch{return!1}};zt.toEncoding=zt.encode;zt.fromEncoding=zt.decode;zt._codecDataCache={};zt.getCodec=function(e){zt.encodings||(zt.encodings=uO());for(var t=zt._canonicalizeEncoding(e),n={};;){var a=zt._codecDataCache[t];if(a)return a;var s=zt.encodings[t];switch(typeof s){case"string":t=s;break;case"object":for(var o in s)n[o]=s[o];n.encodingName||(n.encodingName=t),t=s.type;break;case"function":return n.encodingName||(n.encodingName=t),a=new s(n,zt),zt._codecDataCache[n.encodingName]=a,a;default:throw new Error("Encoding not recognized: '"+e+"' (searched as: '"+t+"')")}}};zt._canonicalizeEncoding=function(r){return(""+r).toLowerCase().replace(/:\d{4}$|[^0-9a-z]/g,"")};zt.getEncoder=function(e,t){var n=zt.getCodec(e),a=new n.encoder(t,n);return n.bomAware&&t&&t.addBOM&&(a=new bO.PrependBOM(a,t)),a};zt.getDecoder=function(e,t){var n=zt.getCodec(e),a=new n.decoder(t,n);return n.bomAware&&!(t&&t.stripBOM===!1)&&(a=new bO.StripBOM(a,t)),a};var gO=typeof process<"u"&&process.versions&&process.versions.node;gO&&(dv=gO.split(".").map(Number),(dv[0]>0||dv[1]>=10)&&mO()(zt),fO()(zt));var dv});var bh=H((Lle,EO)=>{"use strict";EO.exports=VG;function GG(r){for(var e=r.listeners("data"),t=0;t<e.length;t++)if(e[t].name==="ondata")return!0;return!1}function VG(r){if(!r)throw new TypeError("argument stream is required");if(typeof r.unpipe=="function"){r.unpipe();return}if(GG(r))for(var e,t=r.listeners("close"),n=0;n<t.length;n++)e=t[n],!(e.name!=="cleanup"&&e.name!=="onclose")&&e.call(r)}});var RO=H((jle,SO)=>{"use strict";var CO=YG(),zG=Qc(),Ai=jT(),HG=mv(),WG=bh();SO.exports=KG;var QG=/^Encoding not recognized: /;function JG(r){if(!r)return null;try{return HG.getDecoder(r)}catch(e){throw QG.test(e.message)?Ai(415,"specified encoding unsupported",{encoding:r,type:"encoding.unsupported"}):e}}function KG(r,e,t){var n=t,a=e||{};if(r===void 0)throw new TypeError("argument stream is required");if(typeof r!="object"||r===null||typeof r.on!="function")throw new TypeError("argument stream must be a stream");if((e===!0||typeof e=="string")&&(a={encoding:e}),typeof e=="function"&&(n=e,a={}),n!==void 0&&typeof n!="function")throw new TypeError("argument callback must be a function");if(!n&&!global.Promise)throw new TypeError("argument callback is required");var s=a.encoding!==!0?a.encoding:"utf-8",o=zG.parse(a.limit),i=a.length!=null&&!isNaN(a.length)?parseInt(a.length,10):null;return n?AO(r,s,i,o,ZG(n)):new Promise(function(c,p){AO(r,s,i,o,function(f,g){if(f)return p(f);c(g)})})}function XG(r){WG(r),typeof r.pause=="function"&&r.pause()}function AO(r,e,t,n,a){var s=!1,o=!0;if(n!==null&&t!==null&&t>n)return m(Ai(413,"request entity too large",{expected:t,length:t,limit:n,type:"entity.too.large"}));var i=r._readableState;if(r._decoder||i&&(i.encoding||i.decoder))return m(Ai(500,"stream encoding should not be set",{type:"stream.encoding.set"}));if(typeof r.readable<"u"&&!r.readable)return m(Ai(500,"stream is not readable",{type:"stream.not.readable"}));var u=0,c;try{c=JG(e)}catch(A){return m(A)}var p=c?"":[];r.on("aborted",f),r.on("close",C),r.on("data",g),r.on("end",y),r.on("error",y),o=!1;function m(){for(var A=new Array(arguments.length),T=0;T<A.length;T++)A[T]=arguments[T];s=!0,o?process.nextTick(E):E();function E(){C(),A[0]&&XG(r),a.apply(null,A)}}function f(){s||m(Ai(400,"request aborted",{code:"ECONNABORTED",expected:t,length:t,received:u,type:"request.aborted"}))}function g(A){s||(u+=A.length,n!==null&&u>n?m(Ai(413,"request entity too large",{limit:n,received:u,type:"entity.too.large"})):c?p+=c.write(A):p.push(A))}function y(A){if(!s){if(A)return m(A);if(t!==null&&u!==t)m(Ai(400,"request size did not match content length",{expected:t,length:t,received:u,type:"request.size.invalid"}));else{var T=c?p+(c.end()||""):Buffer.concat(p);m(null,T)}}}function C(){p=null,r.removeListener("aborted",f),r.removeListener("data",g),r.removeListener("end",y),r.removeListener("error",y),r.removeListener("close",C)}}function YG(){try{return require("async_hooks")}catch{return{}}}function ZG(r){var e;return CO.AsyncResource&&(e=new CO.AsyncResource(r.name||"bound-anonymous-fn")),!e||!e.runInAsyncScope?r:e.runInAsyncScope.bind(e,r,null)}});var IO=H((kle,wO)=>{"use strict";wO.exports=e8;function e8(r,e){if(!Array.isArray(r))throw new TypeError("arg must be an array of [ee, events...] arrays");for(var t=[],n=0;n<r.length;n++){var a=r[n];if(!Array.isArray(a)||a.length<2)throw new TypeError("each array member must be [ee, events...]");for(var s=a[0],o=1;o<a.length;o++){var i=a[o],u=t8(i,c);s.on(i,u),t.push({ee:s,event:i,fn:u})}}function c(){p(),e.apply(null,arguments)}function p(){for(var f,g=0;g<t.length;g++)f=t[g],f.ee.removeListener(f.event,f.fn)}function m(f){e=f}return m.cancel=p,m}function t8(r,e){return function(n){for(var a=new Array(arguments.length),s=this,o=r==="error"?n:null,i=0;i<a.length;i++)a[i]=arguments[i];e(o,s,r,a)}}});var op=H((Dle,hv)=>{"use strict";hv.exports=n8;hv.exports.isFinished=OO;var xO=c8(),TO=IO(),r8=typeof setImmediate=="function"?setImmediate:function(r){process.nextTick(r.bind.apply(r,arguments))};function n8(r,e){return OO(r)!==!1?(r8(e,null,r),r):(s8(r,l8(e)),r)}function OO(r){var e=r.socket;if(typeof r.finished=="boolean")return!!(r.finished||e&&!e.writable);if(typeof r.complete=="boolean")return!!(r.upgrade||!e||!e.readable||r.complete&&!r.readable)}function a8(r,e){var t,n,a=!1;function s(i){t.cancel(),n.cancel(),a=!0,e(i)}t=n=TO([[r,"end","finish"]],s);function o(i){r.removeListener("socket",o),!a&&t===n&&(n=TO([[i,"error","close"]],s))}if(r.socket){o(r.socket);return}r.on("socket",o),r.socket===void 0&&i8(r,o)}function s8(r,e){var t=r.__onFinished;(!t||!t.queue)&&(t=r.__onFinished=o8(r),a8(r,t)),t.queue.push(e)}function o8(r){function e(t){if(r.__onFinished===e&&(r.__onFinished=null),!!e.queue){var n=e.queue;e.queue=null;for(var a=0;a<n.length;a++)n[a](t,r)}}return e.queue=[],e}function i8(r,e){var t=r.assignSocket;typeof t=="function"&&(r.assignSocket=function(a){t.call(this,a),e(a)})}function c8(){try{return require("async_hooks")}catch{return{}}}function l8(r){var e;return xO.AsyncResource&&(e=new xO.AsyncResource(r.name||"bound-anonymous-fn")),!e||!e.runInAsyncScope?r:e.runInAsyncScope.bind(e,r,null)}});var ip=H((Mle,$O)=>{"use strict";var Eo=th(),u8=kb(),p8=RO(),NO=mv(),_O=op(),d8=bh(),PO=require("zlib");$O.exports=m8;function m8(r,e,t,n,a,s){var o,i=s,u;r._body=!0;var c=i.encoding!==null?i.encoding:null,p=i.verify;try{u=h8(r,a,i.inflate),o=u.length,u.length=void 0}catch(m){return t(m)}if(i.length=o,i.encoding=p?null:c,i.encoding===null&&c!==null&&!NO.encodingExists(c))return t(Eo(415,'unsupported charset "'+c.toUpperCase()+'"',{charset:c.toLowerCase(),type:"charset.unsupported"}));a("read body"),p8(u,i,function(m,f){if(m){var g;m.type==="encoding.unsupported"?g=Eo(415,'unsupported charset "'+c.toUpperCase()+'"',{charset:c.toLowerCase(),type:"charset.unsupported"}):g=Eo(400,m),u!==r&&(d8(r),u8(u,!0)),f8(r,function(){t(Eo(400,g))});return}if(p)try{a("verify body"),p(r,e,f,c)}catch(C){t(Eo(403,C,{body:f,type:C.type||"entity.verify.failed"}));return}var y=f;try{a("parse body"),y=typeof f!="string"&&c!==null?NO.decode(f,c):f,r.body=n(y)}catch(C){t(Eo(400,C,{body:y,type:C.type||"entity.parse.failed"}));return}t()})}function h8(r,e,t){var n=(r.headers["content-encoding"]||"identity").toLowerCase(),a=r.headers["content-length"],s;if(e('content-encoding "%s"',n),t===!1&&n!=="identity")throw Eo(415,"content encoding unsupported",{encoding:n,type:"encoding.unsupported"});switch(n){case"deflate":s=PO.createInflate(),e("inflate body"),r.pipe(s);break;case"gzip":s=PO.createGunzip(),e("gunzip body"),r.pipe(s);break;case"identity":s=r,s.length=a;break;default:throw Eo(415,'unsupported content encoding "'+n+'"',{encoding:n,type:"encoding.unsupported"})}return s}function f8(r,e){_O.isFinished(r)?e(null):(_O(r,e),r.resume())}});var DO=H(fv=>{var LO=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u0020-\u007e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,g8=/^[\u0020-\u007e\u0080-\u00ff]+$/,kO=/^[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+$/,y8=/\\([\u0000-\u007f])/g,b8=/([\\"])/g,v8=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,jO=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,E8=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;fv.format=C8;fv.parse=A8;function C8(r){if(!r||typeof r!="object")throw new TypeError("argument obj is required");var e=r.parameters,t=r.subtype,n=r.suffix,a=r.type;if(!a||!jO.test(a))throw new TypeError("invalid type");if(!t||!v8.test(t))throw new TypeError("invalid subtype");var s=a+"/"+t;if(n){if(!jO.test(n))throw new TypeError("invalid suffix");s+="+"+n}if(e&&typeof e=="object")for(var o,i=Object.keys(e).sort(),u=0;u<i.length;u++){if(o=i[u],!kO.test(o))throw new TypeError("invalid parameter name");s+="; "+o+"="+R8(e[o])}return s}function A8(r){if(!r)throw new TypeError("argument string is required");if(typeof r=="object"&&(r=S8(r)),typeof r!="string")throw new TypeError("argument string is required to be a string");var e=r.indexOf(";"),t=e!==-1?r.substr(0,e):r,n,a,s=w8(t),o={},i;for(LO.lastIndex=e;a=LO.exec(r);){if(a.index!==e)throw new TypeError("invalid parameter format");e+=a[0].length,n=a[1].toLowerCase(),i=a[2],i[0]==='"'&&(i=i.substr(1,i.length-2).replace(y8,"$1")),o[n]=i}if(e!==-1&&e!==r.length)throw new TypeError("invalid parameter format");return s.parameters=o,s}function S8(r){if(typeof r.getHeader=="function")return r.getHeader("content-type");if(typeof r.headers=="object")return r.headers&&r.headers["content-type"]}function R8(r){var e=String(r);if(kO.test(e))return e;if(e.length>0&&!g8.test(e))throw new TypeError("invalid parameter value");return'"'+e.replace(b8,"\\$1")+'"'}function w8(r){var e=E8.exec(r.toLowerCase());if(!e)throw new TypeError("invalid media type");var t=e[1],n=e[2],a,s=n.lastIndexOf("+");s!==-1&&(a=n.substr(s+1),n=n.substr(0,s));var o={type:t,subtype:n,suffix:a};return o}});var MO=H((Ble,I8)=>{I8.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}}});var BO=H((Fle,UO)=>{UO.exports=MO()});var gv=H($n=>{"use strict";var vh=BO(),x8=require("path").extname,FO=/^\s*([^;\s]*)(?:;|\s|$)/,T8=/^text\//i;$n.charset=qO;$n.charsets={lookup:qO};$n.contentType=O8;$n.extension=N8;$n.extensions=Object.create(null);$n.lookup=_8;$n.types=Object.create(null);P8($n.extensions,$n.types);function qO(r){if(!r||typeof r!="string")return!1;var e=FO.exec(r),t=e&&vh[e[1].toLowerCase()];return t&&t.charset?t.charset:e&&T8.test(e[1])?"UTF-8":!1}function O8(r){if(!r||typeof r!="string")return!1;var e=r.indexOf("/")===-1?$n.lookup(r):r;if(!e)return!1;if(e.indexOf("charset")===-1){var t=$n.charset(e);t&&(e+="; charset="+t.toLowerCase())}return e}function N8(r){if(!r||typeof r!="string")return!1;var e=FO.exec(r),t=e&&$n.extensions[e[1].toLowerCase()];return!t||!t.length?!1:t[0]}function _8(r){if(!r||typeof r!="string")return!1;var e=x8("x."+r).toLowerCase().substr(1);return e&&$n.types[e]||!1}function P8(r,e){var t=["nginx","apache",void 0,"iana"];Object.keys(vh).forEach(function(a){var s=vh[a],o=s.extensions;if(!(!o||!o.length)){r[a]=o;for(var i=0;i<o.length;i++){var u=o[i];if(e[u]){var c=t.indexOf(vh[e[u]].source),p=t.indexOf(s.source);if(e[u]!=="application/octet-stream"&&(c>p||c===p&&e[u].substr(0,12)==="application/"))continue}e[u]=a}}})}});var Si=H((Gle,nl)=>{"use strict";var GO=DO(),$8=gv();nl.exports=L8;nl.exports.is=VO;nl.exports.hasBody=zO;nl.exports.normalize=HO;nl.exports.match=WO;function VO(r,e){var t,n=e,a=k8(r);if(!a)return!1;if(n&&!Array.isArray(n))for(n=new Array(arguments.length-1),t=0;t<n.length;t++)n[t]=arguments[t+1];if(!n||!n.length)return a;var s;for(t=0;t<n.length;t++)if(WO(HO(s=n[t]),a))return s[0]==="+"||s.indexOf("*")!==-1?a:s;return!1}function zO(r){return r.headers["transfer-encoding"]!==void 0||!isNaN(r.headers["content-length"])}function L8(r,e){var t=e;if(!zO(r))return null;if(arguments.length>2){t=new Array(arguments.length-1);for(var n=0;n<t.length;n++)t[n]=arguments[n+1]}var a=r.headers["content-type"];return VO(a,t)}function HO(r){if(typeof r!="string")return!1;switch(r){case"urlencoded":return"application/x-www-form-urlencoded";case"multipart":return"multipart/*"}return r[0]==="+"?"*/*"+r:r.indexOf("/")===-1?$8.lookup(r):r}function WO(r,e){if(r===!1)return!1;var t=e.split("/"),n=r.split("/");return t.length!==2||n.length!==2||n[0]!=="*"&&n[0]!==t[0]?!1:n[1].substr(0,2)==="*+"?n[1].length<=t[1].length+1&&n[1].substr(1)===t[1].substr(1-n[1].length):!(n[1]!=="*"&&n[1]!==t[1])}function j8(r){var e=GO.parse(r);return e.parameters=void 0,GO.format(e)}function k8(r){if(!r)return null;try{return j8(r)}catch{return null}}});var YO=H((Vle,XO)=>{"use strict";var D8=Qc(),M8=Ku(),U8=th(),Co=rp()("body-parser:json"),B8=ip(),JO=Si();XO.exports=G8;var F8=/^[\x20\x09\x0a\x0d]*([^\x20\x09\x0a\x0d])/,QO="#",q8=/#+/g;function G8(r){var e=r||{},t=typeof e.limit!="number"?D8.parse(e.limit||"100kb"):e.limit,n=e.inflate!==!1,a=e.reviver,s=e.strict!==!1,o=e.type||"application/json",i=e.verify||!1;if(i!==!1&&typeof i!="function")throw new TypeError("option verify must be function");var u=typeof o!="function"?W8(o):o;function c(p){if(p.length===0)return{};if(s){var m=z8(p);if(m!=="{"&&m!=="[")throw Co("strict violation"),V8(p,m)}try{return Co("parse json"),JSON.parse(p,a)}catch(f){throw KO(f,{message:f.message,stack:f.stack})}}return function(m,f,g){if(m._body){Co("body already parsed"),g();return}if(m.body=m.body||{},!JO.hasBody(m)){Co("skip empty body"),g();return}if(Co("content-type %j",m.headers["content-type"]),!u(m)){Co("skip parsing"),g();return}var y=H8(m)||"utf-8";if(y.slice(0,4)!=="utf-"){Co("invalid charset"),g(U8(415,'unsupported charset "'+y.toUpperCase()+'"',{charset:y,type:"charset.unsupported"}));return}B8(m,f,g,c,Co,{encoding:y,inflate:n,limit:t,verify:i})}}function V8(r,e){var t=r.indexOf(e),n="";if(t!==-1){n=r.substring(0,t)+QO;for(var a=t+1;a<r.length;a++)n+=QO}try{throw JSON.parse(n),new SyntaxError("strict violation")}catch(s){return KO(s,{message:s.message.replace(q8,function(o){return r.substring(t,t+o.length)}),stack:s.stack})}}function z8(r){var e=F8.exec(r);return e?e[1]:void 0}function H8(r){try{return(M8.parse(r).parameters.charset||"").toLowerCase()}catch{return}}function KO(r,e){for(var t=Object.getOwnPropertyNames(r),n=0;n<t.length;n++){var a=t[n];a!=="stack"&&a!=="message"&&delete r[a]}return r.stack=e.stack.replace(r.message,e.message),r.message=e.message,r}function W8(r){return function(t){return!!JO(t,r)}}});var tN=H((zle,eN)=>{"use strict";var Q8=Qc(),cp=rp()("body-parser:raw"),J8=ip(),ZO=Si();eN.exports=K8;function K8(r){var e=r||{},t=e.inflate!==!1,n=typeof e.limit!="number"?Q8.parse(e.limit||"100kb"):e.limit,a=e.type||"application/octet-stream",s=e.verify||!1;if(s!==!1&&typeof s!="function")throw new TypeError("option verify must be function");var o=typeof a!="function"?X8(a):a;function i(u){return u}return function(c,p,m){if(c._body){cp("body already parsed"),m();return}if(c.body=c.body||{},!ZO.hasBody(c)){cp("skip empty body"),m();return}if(cp("content-type %j",c.headers["content-type"]),!o(c)){cp("skip parsing"),m();return}J8(c,p,m,i,cp,{encoding:null,inflate:t,limit:n,verify:s})}}function X8(r){return function(t){return!!ZO(t,r)}}});var aN=H((Hle,nN)=>{"use strict";var Y8=Qc(),Z8=Ku(),lp=rp()("body-parser:text"),eV=ip(),rN=Si();nN.exports=tV;function tV(r){var e=r||{},t=e.defaultCharset||"utf-8",n=e.inflate!==!1,a=typeof e.limit!="number"?Y8.parse(e.limit||"100kb"):e.limit,s=e.type||"text/plain",o=e.verify||!1;if(o!==!1&&typeof o!="function")throw new TypeError("option verify must be function");var i=typeof s!="function"?nV(s):s;function u(c){return c}return function(p,m,f){if(p._body){lp("body already parsed"),f();return}if(p.body=p.body||{},!rN.hasBody(p)){lp("skip empty body"),f();return}if(lp("content-type %j",p.headers["content-type"]),!i(p)){lp("skip parsing"),f();return}var g=rV(p)||t;eV(p,m,f,u,lp,{encoding:g,inflate:n,limit:a,verify:o})}}function rV(r){try{return(Z8.parse(r).parameters.charset||"").toLowerCase()}catch{return}}function nV(r){return function(t){return!!rN(t,r)}}});var Ri=H((Wle,sN)=>{"use strict";sN.exports=TypeError});var iN=H((Qle,oN)=>{oN.exports=require("util").inspect});var hp=H((Jle,xN)=>{var Iv=typeof Map=="function"&&Map.prototype,yv=Object.getOwnPropertyDescriptor&&Iv?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ch=Iv&&yv&&typeof yv.get=="function"?yv.get:null,cN=Iv&&Map.prototype.forEach,xv=typeof Set=="function"&&Set.prototype,bv=Object.getOwnPropertyDescriptor&&xv?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ah=xv&&bv&&typeof bv.get=="function"?bv.get:null,lN=xv&&Set.prototype.forEach,aV=typeof WeakMap=="function"&&WeakMap.prototype,pp=aV?WeakMap.prototype.has:null,sV=typeof WeakSet=="function"&&WeakSet.prototype,dp=sV?WeakSet.prototype.has:null,oV=typeof WeakRef=="function"&&WeakRef.prototype,uN=oV?WeakRef.prototype.deref:null,iV=Boolean.prototype.valueOf,cV=Object.prototype.toString,lV=Function.prototype.toString,uV=String.prototype.match,Tv=String.prototype.slice,Ao=String.prototype.replace,pV=String.prototype.toUpperCase,pN=String.prototype.toLowerCase,EN=RegExp.prototype.test,dN=Array.prototype.concat,ts=Array.prototype.join,dV=Array.prototype.slice,mN=Math.floor,Cv=typeof BigInt=="function"?BigInt.prototype.valueOf:null,vv=Object.getOwnPropertySymbols,Av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,al=typeof Symbol=="function"&&typeof Symbol.iterator=="object",mp=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===al||!0)?Symbol.toStringTag:null,CN=Object.prototype.propertyIsEnumerable,hN=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function fN(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||EN.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-mN(-r):mN(r);if(n!==r){var a=String(n),s=Tv.call(e,a.length+1);return Ao.call(a,t,"$&_")+"."+Ao.call(Ao.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ao.call(e,t,"$&_")}var Sv=iN(),gN=Sv.custom,yN=RN(gN)?gN:null,AN={__proto__:null,double:'"',single:"'"},mV={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};xN.exports=function r(e,t,n,a){var s=t||{};if(Ps(s,"quoteStyle")&&!Ps(AN,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ps(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Ps(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ps(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ps(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var i=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return IN(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var u=String(e);return i?fN(e,u):u}if(typeof e=="bigint"){var c=String(e)+"n";return i?fN(e,c):c}var p=typeof s.depth>"u"?5:s.depth;if(typeof n>"u"&&(n=0),n>=p&&p>0&&typeof e=="object")return Rv(e)?"[Array]":"[Object]";var m=_V(s,n);if(typeof a>"u")a=[];else if(wN(a,e)>=0)return"[Circular]";function f(_,N,P){if(N&&(a=dV.call(a),a.push(N)),P){var L={depth:s.depth};return Ps(s,"quoteStyle")&&(L.quoteStyle=s.quoteStyle),r(_,L,n+1,a)}return r(_,s,n+1,a)}if(typeof e=="function"&&!bN(e)){var g=AV(e),y=Eh(e,f);return"[Function"+(g?": "+g:" (anonymous)")+"]"+(y.length>0?" { "+ts.call(y,", ")+" }":"")}if(RN(e)){var C=al?Ao.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Av.call(e);return typeof e=="object"&&!al?up(C):C}if(TV(e)){for(var A="<"+pN.call(String(e.nodeName)),T=e.attributes||[],E=0;E<T.length;E++)A+=" "+T[E].name+"="+SN(hV(T[E].value),"double",s);return A+=">",e.childNodes&&e.childNodes.length&&(A+="..."),A+="</"+pN.call(String(e.nodeName))+">",A}if(Rv(e)){if(e.length===0)return"[]";var d=Eh(e,f);return m&&!NV(d)?"["+wv(d,m)+"]":"[ "+ts.call(d,", ")+" ]"}if(gV(e)){var l=Eh(e,f);return!("cause"in Error.prototype)&&"cause"in e&&!CN.call(e,"cause")?"{ ["+String(e)+"] "+ts.call(dN.call("[cause]: "+f(e.cause),l),", ")+" }":l.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+ts.call(l,", ")+" }"}if(typeof e=="object"&&o){if(yN&&typeof e[yN]=="function"&&Sv)return Sv(e,{depth:p-n});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(SV(e)){var h=[];return cN&&cN.call(e,function(_,N){h.push(f(N,e,!0)+" => "+f(_,e))}),vN("Map",Ch.call(e),h,m)}if(IV(e)){var v=[];return lN&&lN.call(e,function(_){v.push(f(_,e))}),vN("Set",Ah.call(e),v,m)}if(RV(e))return Ev("WeakMap");if(xV(e))return Ev("WeakSet");if(wV(e))return Ev("WeakRef");if(bV(e))return up(f(Number(e)));if(EV(e))return up(f(Cv.call(e)));if(vV(e))return up(iV.call(e));if(yV(e))return up(f(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof global<"u"&&e===global)return"{ [object globalThis] }";if(!fV(e)&&!bN(e)){var S=Eh(e,f),R=hN?hN(e)===Object.prototype:e instanceof Object||e.constructor===Object,x=e instanceof Object?"":"null prototype",w=!R&&mp&&Object(e)===e&&mp in e?Tv.call(So(e),8,-1):x?"Object":"",O=R||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",I=O+(w||x?"["+ts.call(dN.call([],w||[],x||[]),": ")+"] ":"");return S.length===0?I+"{}":m?I+"{"+wv(S,m)+"}":I+"{ "+ts.call(S,", ")+" }"}return String(e)};function SN(r,e,t){var n=t.quoteStyle||e,a=AN[n];return a+r+a}function hV(r){return Ao.call(String(r),/"/g,"&quot;")}function wi(r){return!mp||!(typeof r=="object"&&(mp in r||typeof r[mp]<"u"))}function Rv(r){return So(r)==="[object Array]"&&wi(r)}function fV(r){return So(r)==="[object Date]"&&wi(r)}function bN(r){return So(r)==="[object RegExp]"&&wi(r)}function gV(r){return So(r)==="[object Error]"&&wi(r)}function yV(r){return So(r)==="[object String]"&&wi(r)}function bV(r){return So(r)==="[object Number]"&&wi(r)}function vV(r){return So(r)==="[object Boolean]"&&wi(r)}function RN(r){if(al)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Av)return!1;try{return Av.call(r),!0}catch{}return!1}function EV(r){if(!r||typeof r!="object"||!Cv)return!1;try{return Cv.call(r),!0}catch{}return!1}var CV=Object.prototype.hasOwnProperty||function(r){return r in this};function Ps(r,e){return CV.call(r,e)}function So(r){return cV.call(r)}function AV(r){if(r.name)return r.name;var e=uV.call(lV.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function wN(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,n=r.length;t<n;t++)if(r[t]===e)return t;return-1}function SV(r){if(!Ch||!r||typeof r!="object")return!1;try{Ch.call(r);try{Ah.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function RV(r){if(!pp||!r||typeof r!="object")return!1;try{pp.call(r,pp);try{dp.call(r,dp)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function wV(r){if(!uN||!r||typeof r!="object")return!1;try{return uN.call(r),!0}catch{}return!1}function IV(r){if(!Ah||!r||typeof r!="object")return!1;try{Ah.call(r);try{Ch.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function xV(r){if(!dp||!r||typeof r!="object")return!1;try{dp.call(r,dp);try{pp.call(r,pp)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function TV(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function IN(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,n="... "+t+" more character"+(t>1?"s":"");return IN(Tv.call(r,0,e.maxStringLength),e)+n}var a=mV[e.quoteStyle||"single"];a.lastIndex=0;var s=Ao.call(Ao.call(r,a,"\\$1"),/[\x00-\x1f]/g,OV);return SN(s,"single",e)}function OV(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+pV.call(e.toString(16))}function up(r){return"Object("+r+")"}function Ev(r){return r+" { ? }"}function vN(r,e,t,n){var a=n?wv(t,n):ts.call(t,", ");return r+" ("+e+") {"+a+"}"}function NV(r){for(var e=0;e<r.length;e++)if(wN(r[e],`
`)>=0)return!1;return!0}function _V(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=ts.call(Array(r.indent+1)," ");else return null;return{base:t,prev:ts.call(Array(e+1),t)}}function wv(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+ts.call(r,","+t)+`
`+e.prev}function Eh(r,e){var t=Rv(r),n=[];if(t){n.length=r.length;for(var a=0;a<r.length;a++)n[a]=Ps(r,a)?e(r[a],r):""}var s=typeof vv=="function"?vv(r):[],o;if(al){o={};for(var i=0;i<s.length;i++)o["$"+s[i]]=s[i]}for(var u in r)Ps(r,u)&&(t&&String(Number(u))===u&&u<r.length||al&&o["$"+u]instanceof Symbol||(EN.call(/[^\w$]/,u)?n.push(e(u,r)+": "+e(r[u],r)):n.push(u+": "+e(r[u],r))));if(typeof vv=="function")for(var c=0;c<s.length;c++)CN.call(r,s[c])&&n.push("["+e(s[c])+"]: "+e(r[s[c]],r));return n}});var ON=H((Kle,TN)=>{"use strict";var PV=hp(),$V=Ri(),Sh=function(r,e,t){for(var n=r,a;(a=n.next)!=null;n=a)if(a.key===e)return n.next=a.next,t||(a.next=r.next,r.next=a),a},LV=function(r,e){if(r){var t=Sh(r,e);return t&&t.value}},jV=function(r,e,t){var n=Sh(r,e);n?n.value=t:r.next={key:e,next:r.next,value:t}},kV=function(r,e){return r?!!Sh(r,e):!1},DV=function(r,e){if(r)return Sh(r,e,!0)};TN.exports=function(){var e,t={assert:function(n){if(!t.has(n))throw new $V("Side channel does not contain "+PV(n))},delete:function(n){var a=e&&e.next,s=DV(e,n);return s&&a&&a===s&&(e=void 0),!!s},get:function(n){return LV(e,n)},has:function(n){return kV(e,n)},set:function(n,a){e||(e={next:void 0}),jV(e,n,a)}};return t}});var Ov=H((Xle,NN)=>{"use strict";NN.exports=Object});var PN=H((Yle,_N)=>{"use strict";_N.exports=Error});var LN=H((Zle,$N)=>{"use strict";$N.exports=EvalError});var kN=H((eue,jN)=>{"use strict";jN.exports=RangeError});var MN=H((tue,DN)=>{"use strict";DN.exports=ReferenceError});var BN=H((rue,UN)=>{"use strict";UN.exports=SyntaxError});var qN=H((nue,FN)=>{"use strict";FN.exports=URIError});var VN=H((aue,GN)=>{"use strict";GN.exports=Math.abs});var HN=H((sue,zN)=>{"use strict";zN.exports=Math.floor});var QN=H((oue,WN)=>{"use strict";WN.exports=Math.max});var KN=H((iue,JN)=>{"use strict";JN.exports=Math.min});var YN=H((cue,XN)=>{"use strict";XN.exports=Math.pow});var e_=H((lue,ZN)=>{"use strict";ZN.exports=Math.round});var r_=H((uue,t_)=>{"use strict";t_.exports=Number.isNaN||function(e){return e!==e}});var a_=H((pue,n_)=>{"use strict";var MV=r_();n_.exports=function(e){return MV(e)||e===0?e:e<0?-1:1}});var o_=H((due,s_)=>{"use strict";s_.exports=Object.getOwnPropertyDescriptor});var Nv=H((mue,i_)=>{"use strict";var Rh=o_();if(Rh)try{Rh([],"length")}catch{Rh=null}i_.exports=Rh});var l_=H((hue,c_)=>{"use strict";var wh=Object.defineProperty||!1;if(wh)try{wh({},"a",{value:1})}catch{wh=!1}c_.exports=wh});var p_=H((fue,u_)=>{"use strict";u_.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var a=42;e[t]=a;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var i=Object.getOwnPropertyDescriptor(e,t);if(i.value!==a||i.enumerable!==!0)return!1}return!0}});var h_=H((gue,m_)=>{"use strict";var d_=typeof Symbol<"u"&&Symbol,UV=p_();m_.exports=function(){return typeof d_!="function"||typeof Symbol!="function"||typeof d_("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:UV()}});var _v=H((yue,f_)=>{"use strict";f_.exports=typeof Reflect<"u"&&Reflect.getPrototypeOf||null});var Pv=H((bue,g_)=>{"use strict";var BV=Ov();g_.exports=BV.getPrototypeOf||null});var v_=H((vue,b_)=>{"use strict";var FV="Function.prototype.bind called on incompatible ",qV=Object.prototype.toString,GV=Math.max,VV="[object Function]",y_=function(e,t){for(var n=[],a=0;a<e.length;a+=1)n[a]=e[a];for(var s=0;s<t.length;s+=1)n[s+e.length]=t[s];return n},zV=function(e,t){for(var n=[],a=t||0,s=0;a<e.length;a+=1,s+=1)n[s]=e[a];return n},HV=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t};b_.exports=function(e){var t=this;if(typeof t!="function"||qV.apply(t)!==VV)throw new TypeError(FV+t);for(var n=zV(arguments,1),a,s=function(){if(this instanceof a){var p=t.apply(this,y_(n,arguments));return Object(p)===p?p:this}return t.apply(e,y_(n,arguments))},o=GV(0,t.length-n.length),i=[],u=0;u<o;u++)i[u]="$"+u;if(a=Function("binder","return function ("+HV(i,",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var c=function(){};c.prototype=t.prototype,a.prototype=new c,c.prototype=null}return a}});var fp=H((Eue,E_)=>{"use strict";var WV=v_();E_.exports=Function.prototype.bind||WV});var Ih=H((Cue,C_)=>{"use strict";C_.exports=Function.prototype.call});var $v=H((Aue,A_)=>{"use strict";A_.exports=Function.prototype.apply});var R_=H((Sue,S_)=>{"use strict";S_.exports=typeof Reflect<"u"&&Reflect&&Reflect.apply});var I_=H((Rue,w_)=>{"use strict";var QV=fp(),JV=$v(),KV=Ih(),XV=R_();w_.exports=XV||QV.call(KV,JV)});var Lv=H((wue,x_)=>{"use strict";var YV=fp(),ZV=Ri(),ez=Ih(),tz=I_();x_.exports=function(e){if(e.length<1||typeof e[0]!="function")throw new ZV("a function is required");return tz(YV,ez,e)}});var $_=H((Iue,P_)=>{"use strict";var rz=Lv(),T_=Nv(),N_;try{N_=[].__proto__===Array.prototype}catch(r){if(!r||typeof r!="object"||!("code"in r)||r.code!=="ERR_PROTO_ACCESS")throw r}var jv=!!N_&&T_&&T_(Object.prototype,"__proto__"),__=Object,O_=__.getPrototypeOf;P_.exports=jv&&typeof jv.get=="function"?rz([jv.get]):typeof O_=="function"?function(e){return O_(e==null?e:__(e))}:!1});var M_=H((xue,D_)=>{"use strict";var L_=_v(),j_=Pv(),k_=$_();D_.exports=L_?function(e){return L_(e)}:j_?function(e){if(!e||typeof e!="object"&&typeof e!="function")throw new TypeError("getProto: not an object");return j_(e)}:k_?function(e){return k_(e)}:null});var B_=H((Tue,U_)=>{"use strict";var nz=Function.prototype.call,az=Object.prototype.hasOwnProperty,sz=fp();U_.exports=sz.call(nz,az)});var Oh=H((Oue,H_)=>{"use strict";var Pt,oz=Ov(),iz=PN(),cz=LN(),lz=kN(),uz=MN(),cl=BN(),il=Ri(),pz=qN(),dz=VN(),mz=HN(),hz=QN(),fz=KN(),gz=YN(),yz=e_(),bz=a_(),V_=Function,kv=function(r){try{return V_('"use strict"; return ('+r+").constructor;")()}catch{}},gp=Nv(),vz=l_(),Dv=function(){throw new il},Ez=gp?(function(){try{return arguments.callee,Dv}catch{try{return gp(arguments,"callee").get}catch{return Dv}}})():Dv,sl=h_()(),Xr=M_(),Cz=Pv(),Az=_v(),z_=$v(),yp=Ih(),ol={},Sz=typeof Uint8Array>"u"||!Xr?Pt:Xr(Uint8Array),Ii={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Pt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Pt:ArrayBuffer,"%ArrayIteratorPrototype%":sl&&Xr?Xr([][Symbol.iterator]()):Pt,"%AsyncFromSyncIteratorPrototype%":Pt,"%AsyncFunction%":ol,"%AsyncGenerator%":ol,"%AsyncGeneratorFunction%":ol,"%AsyncIteratorPrototype%":ol,"%Atomics%":typeof Atomics>"u"?Pt:Atomics,"%BigInt%":typeof BigInt>"u"?Pt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Pt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Pt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Pt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":iz,"%eval%":eval,"%EvalError%":cz,"%Float16Array%":typeof Float16Array>"u"?Pt:Float16Array,"%Float32Array%":typeof Float32Array>"u"?Pt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Pt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Pt:FinalizationRegistry,"%Function%":V_,"%GeneratorFunction%":ol,"%Int8Array%":typeof Int8Array>"u"?Pt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Pt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Pt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":sl&&Xr?Xr(Xr([][Symbol.iterator]())):Pt,"%JSON%":typeof JSON=="object"?JSON:Pt,"%Map%":typeof Map>"u"?Pt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!sl||!Xr?Pt:Xr(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":oz,"%Object.getOwnPropertyDescriptor%":gp,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Pt:Promise,"%Proxy%":typeof Proxy>"u"?Pt:Proxy,"%RangeError%":lz,"%ReferenceError%":uz,"%Reflect%":typeof Reflect>"u"?Pt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Pt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!sl||!Xr?Pt:Xr(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Pt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":sl&&Xr?Xr(""[Symbol.iterator]()):Pt,"%Symbol%":sl?Symbol:Pt,"%SyntaxError%":cl,"%ThrowTypeError%":Ez,"%TypedArray%":Sz,"%TypeError%":il,"%Uint8Array%":typeof Uint8Array>"u"?Pt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Pt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Pt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Pt:Uint32Array,"%URIError%":pz,"%WeakMap%":typeof WeakMap>"u"?Pt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Pt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Pt:WeakSet,"%Function.prototype.call%":yp,"%Function.prototype.apply%":z_,"%Object.defineProperty%":vz,"%Object.getPrototypeOf%":Cz,"%Math.abs%":dz,"%Math.floor%":mz,"%Math.max%":hz,"%Math.min%":fz,"%Math.pow%":gz,"%Math.round%":yz,"%Math.sign%":bz,"%Reflect.getPrototypeOf%":Az};if(Xr)try{null.error}catch(r){F_=Xr(Xr(r)),Ii["%Error.prototype%"]=F_}var F_,Rz=function r(e){var t;if(e==="%AsyncFunction%")t=kv("async function () {}");else if(e==="%GeneratorFunction%")t=kv("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=kv("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var a=r("%AsyncGenerator%");a&&Xr&&(t=Xr(a.prototype))}return Ii[e]=t,t},q_={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bp=fp(),xh=B_(),wz=bp.call(yp,Array.prototype.concat),Iz=bp.call(z_,Array.prototype.splice),G_=bp.call(yp,String.prototype.replace),Th=bp.call(yp,String.prototype.slice),xz=bp.call(yp,RegExp.prototype.exec),Tz=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Oz=/\\(\\)?/g,Nz=function(e){var t=Th(e,0,1),n=Th(e,-1);if(t==="%"&&n!=="%")throw new cl("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new cl("invalid intrinsic syntax, expected opening `%`");var a=[];return G_(e,Tz,function(s,o,i,u){a[a.length]=i?G_(u,Oz,"$1"):o||s}),a},_z=function(e,t){var n=e,a;if(xh(q_,n)&&(a=q_[n],n="%"+a[0]+"%"),xh(Ii,n)){var s=Ii[n];if(s===ol&&(s=Rz(n)),typeof s>"u"&&!t)throw new il("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:a,name:n,value:s}}throw new cl("intrinsic "+e+" does not exist!")};H_.exports=function(e,t){if(typeof e!="string"||e.length===0)throw new il("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new il('"allowMissing" argument must be a boolean');if(xz(/^%?[^%]*%?$/,e)===null)throw new cl("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Nz(e),a=n.length>0?n[0]:"",s=_z("%"+a+"%",t),o=s.name,i=s.value,u=!1,c=s.alias;c&&(a=c[0],Iz(n,wz([0,1],c)));for(var p=1,m=!0;p<n.length;p+=1){var f=n[p],g=Th(f,0,1),y=Th(f,-1);if((g==='"'||g==="'"||g==="`"||y==='"'||y==="'"||y==="`")&&g!==y)throw new cl("property names with quotes must have matching quotes");if((f==="constructor"||!m)&&(u=!0),a+="."+f,o="%"+a+"%",xh(Ii,o))i=Ii[o];else if(i!=null){if(!(f in i)){if(!t)throw new il("base intrinsic for "+e+" exists, but the property is not available.");return}if(gp&&p+1>=n.length){var C=gp(i,f);m=!!C,m&&"get"in C&&!("originalValue"in C.get)?i=C.get:i=i[f]}else m=xh(i,f),i=i[f];m&&!u&&(Ii[o]=i)}}return i}});var Mv=H((Nue,J_)=>{"use strict";var W_=Oh(),Q_=Lv(),Pz=Q_([W_("%String.prototype.indexOf%")]);J_.exports=function(e,t){var n=W_(e,!!t);return typeof n=="function"&&Pz(e,".prototype.")>-1?Q_([n]):n}});var Uv=H((_ue,X_)=>{"use strict";var $z=Oh(),vp=Mv(),Lz=hp(),jz=Ri(),K_=$z("%Map%",!0),kz=vp("Map.prototype.get",!0),Dz=vp("Map.prototype.set",!0),Mz=vp("Map.prototype.has",!0),Uz=vp("Map.prototype.delete",!0),Bz=vp("Map.prototype.size",!0);X_.exports=!!K_&&function(){var e,t={assert:function(n){if(!t.has(n))throw new jz("Side channel does not contain "+Lz(n))},delete:function(n){if(e){var a=Uz(e,n);return Bz(e)===0&&(e=void 0),a}return!1},get:function(n){if(e)return kz(e,n)},has:function(n){return e?Mz(e,n):!1},set:function(n,a){e||(e=new K_),Dz(e,n,a)}};return t}});var Z_=H((Pue,Y_)=>{"use strict";var Fz=Oh(),_h=Mv(),qz=hp(),Nh=Uv(),Gz=Ri(),ll=Fz("%WeakMap%",!0),Vz=_h("WeakMap.prototype.get",!0),zz=_h("WeakMap.prototype.set",!0),Hz=_h("WeakMap.prototype.has",!0),Wz=_h("WeakMap.prototype.delete",!0);Y_.exports=ll?function(){var e,t,n={assert:function(a){if(!n.has(a))throw new Gz("Side channel does not contain "+qz(a))},delete:function(a){if(ll&&a&&(typeof a=="object"||typeof a=="function")){if(e)return Wz(e,a)}else if(Nh&&t)return t.delete(a);return!1},get:function(a){return ll&&a&&(typeof a=="object"||typeof a=="function")&&e?Vz(e,a):t&&t.get(a)},has:function(a){return ll&&a&&(typeof a=="object"||typeof a=="function")&&e?Hz(e,a):!!t&&t.has(a)},set:function(a,s){ll&&a&&(typeof a=="object"||typeof a=="function")?(e||(e=new ll),zz(e,a,s)):Nh&&(t||(t=Nh()),t.set(a,s))}};return n}:Nh});var Bv=H(($ue,eP)=>{"use strict";var Qz=Ri(),Jz=hp(),Kz=ON(),Xz=Uv(),Yz=Z_(),Zz=Yz||Xz||Kz;eP.exports=function(){var e,t={assert:function(n){if(!t.has(n))throw new Qz("Side channel does not contain "+Jz(n))},delete:function(n){return!!e&&e.delete(n)},get:function(n){return e&&e.get(n)},has:function(n){return!!e&&e.has(n)},set:function(n,a){e||(e=Zz()),e.set(n,a)}};return t}});var Ph=H((Lue,tP)=>{"use strict";var e3=String.prototype.replace,t3=/%20/g,Fv={RFC1738:"RFC1738",RFC3986:"RFC3986"};tP.exports={default:Fv.RFC3986,formatters:{RFC1738:function(r){return e3.call(r,t3,"+")},RFC3986:function(r){return String(r)}},RFC1738:Fv.RFC1738,RFC3986:Fv.RFC3986}});var Hv=H((jue,aP)=>{"use strict";var r3=Ph(),n3=Bv(),qv=Object.prototype.hasOwnProperty,xi=Array.isArray,Lh=n3(),rP=function(e,t){return Lh.set(e,t),e},$h=function(e){return Lh.has(e)},Vv=function(e){return Lh.get(e)},nP=function(e,t){Lh.set(e,t)},rs=(function(){for(var r=[],e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),a3=function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(xi(n)){for(var a=[],s=0;s<n.length;++s)typeof n[s]<"u"&&a.push(n[s]);t.obj[t.prop]=a}}},zv=function(e,t){for(var n=t&&t.plainObjects?{__proto__:null}:{},a=0;a<e.length;++a)typeof e[a]<"u"&&(n[a]=e[a]);return n},s3=function r(e,t,n){if(!t)return e;if(typeof t!="object"&&typeof t!="function"){if(xi(e))e.push(t);else if(e&&typeof e=="object")if($h(e)){var a=Vv(e)+1;e[a]=t,nP(e,a)}else(n&&(n.plainObjects||n.allowPrototypes)||!qv.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object"){if($h(t)){for(var s=Object.keys(t),o=n&&n.plainObjects?{__proto__:null,0:e}:{0:e},i=0;i<s.length;i++){var u=parseInt(s[i],10);o[u+1]=t[s[i]]}return rP(o,Vv(t)+1)}return[e].concat(t)}var c=e;return xi(e)&&!xi(t)&&(c=zv(e,n)),xi(e)&&xi(t)?(t.forEach(function(p,m){if(qv.call(e,m)){var f=e[m];f&&typeof f=="object"&&p&&typeof p=="object"?e[m]=r(f,p,n):e.push(p)}else e[m]=p}),e):Object.keys(t).reduce(function(p,m){var f=t[m];return qv.call(p,m)?p[m]=r(p[m],f,n):p[m]=f,p},c)},o3=function(e,t){return Object.keys(t).reduce(function(n,a){return n[a]=t[a],n},e)},i3=function(r,e,t){var n=r.replace(/\+/g," ");if(t==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},Gv=1024,c3=function(e,t,n,a,s){if(e.length===0)return e;var o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),n==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(g){return"%26%23"+parseInt(g.slice(2),16)+"%3B"});for(var i="",u=0;u<o.length;u+=Gv){for(var c=o.length>=Gv?o.slice(u,u+Gv):o,p=[],m=0;m<c.length;++m){var f=c.charCodeAt(m);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||s===r3.RFC1738&&(f===40||f===41)){p[p.length]=c.charAt(m);continue}if(f<128){p[p.length]=rs[f];continue}if(f<2048){p[p.length]=rs[192|f>>6]+rs[128|f&63];continue}if(f<55296||f>=57344){p[p.length]=rs[224|f>>12]+rs[128|f>>6&63]+rs[128|f&63];continue}m+=1,f=65536+((f&1023)<<10|c.charCodeAt(m)&1023),p[p.length]=rs[240|f>>18]+rs[128|f>>12&63]+rs[128|f>>6&63]+rs[128|f&63]}i+=p.join("")}return i},l3=function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],a=0;a<t.length;++a)for(var s=t[a],o=s.obj[s.prop],i=Object.keys(o),u=0;u<i.length;++u){var c=i[u],p=o[c];typeof p=="object"&&p!==null&&n.indexOf(p)===-1&&(t.push({obj:o,prop:c}),n.push(p))}return a3(t),e},u3=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},p3=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},d3=function(e,t,n,a){if($h(e)){var s=Vv(e)+1;return e[s]=t,nP(e,s),e}var o=[].concat(e,t);return o.length>n?rP(zv(o,{plainObjects:a}),o.length-1):o},m3=function(e,t){if(xi(e)){for(var n=[],a=0;a<e.length;a+=1)n.push(t(e[a]));return n}return t(e)};aP.exports={arrayToObject:zv,assign:o3,combine:d3,compact:l3,decode:i3,encode:c3,isBuffer:p3,isOverflow:$h,isRegExp:u3,maybeMap:m3,merge:s3}});var uP=H((kue,lP)=>{"use strict";var oP=Bv(),jh=Hv(),Ep=Ph(),h3=Object.prototype.hasOwnProperty,iP={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},ns=Array.isArray,f3=Array.prototype.push,cP=function(r,e){f3.apply(r,ns(e)?e:[e])},g3=Date.prototype.toISOString,sP=Ep.default,Gr={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:jh.encode,encodeValuesOnly:!1,filter:void 0,format:sP,formatter:Ep.formatters[sP],indices:!1,serializeDate:function(e){return g3.call(e)},skipNulls:!1,strictNullHandling:!1},y3=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Wv={},b3=function r(e,t,n,a,s,o,i,u,c,p,m,f,g,y,C,A,T,E){for(var d=e,l=E,h=0,v=!1;(l=l.get(Wv))!==void 0&&!v;){var S=l.get(e);if(h+=1,typeof S<"u"){if(S===h)throw new RangeError("Cyclic object value");v=!0}typeof l.get(Wv)>"u"&&(h=0)}if(typeof p=="function"?d=p(t,d):d instanceof Date?d=g(d):n==="comma"&&ns(d)&&(d=jh.maybeMap(d,function(k){return k instanceof Date?g(k):k})),d===null){if(o)return c&&!A?c(t,Gr.encoder,T,"key",y):t;d=""}if(y3(d)||jh.isBuffer(d)){if(c){var R=A?t:c(t,Gr.encoder,T,"key",y);return[C(R)+"="+C(c(d,Gr.encoder,T,"value",y))]}return[C(t)+"="+C(String(d))]}var x=[];if(typeof d>"u")return x;var w;if(n==="comma"&&ns(d))A&&c&&(d=jh.maybeMap(d,c)),w=[{value:d.length>0?d.join(",")||null:void 0}];else if(ns(p))w=p;else{var O=Object.keys(d);w=m?O.sort(m):O}var I=u?String(t).replace(/\./g,"%2E"):String(t),_=a&&ns(d)&&d.length===1?I+"[]":I;if(s&&ns(d)&&d.length===0)return _+"[]";for(var N=0;N<w.length;++N){var P=w[N],L=typeof P=="object"&&P&&typeof P.value<"u"?P.value:d[P];if(!(i&&L===null)){var j=f&&u?String(P).replace(/\./g,"%2E"):String(P),$=ns(d)?typeof n=="function"?n(_,j):_:_+(f?"."+j:"["+j+"]");E.set(e,h);var U=oP();U.set(Wv,E),cP(x,r(L,$,n,a,s,o,i,u,n==="comma"&&A&&ns(d)?null:c,p,m,f,g,y,C,A,T,U))}}return x},v3=function(e){if(!e)return Gr;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||Gr.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=Ep.default;if(typeof e.format<"u"){if(!h3.call(Ep.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var a=Ep.formatters[n],s=Gr.filter;(typeof e.filter=="function"||ns(e.filter))&&(s=e.filter);var o;if(e.arrayFormat in iP?o=e.arrayFormat:"indices"in e?o=e.indices?"indices":"repeat":o=Gr.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var i=typeof e.allowDots>"u"?e.encodeDotInKeys===!0?!0:Gr.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:Gr.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:Gr.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Gr.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?Gr.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:Gr.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:Gr.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:Gr.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:Gr.encodeValuesOnly,filter:s,format:n,formatter:a,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:Gr.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:Gr.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Gr.strictNullHandling}};lP.exports=function(r,e){var t=r,n=v3(e),a,s;typeof n.filter=="function"?(s=n.filter,t=s("",t)):ns(n.filter)&&(s=n.filter,a=s);var o=[];if(typeof t!="object"||t===null)return"";var i=iP[n.arrayFormat],u=i==="comma"&&n.commaRoundTrip;a||(a=Object.keys(t)),n.sort&&a.sort(n.sort);for(var c=oP(),p=0;p<a.length;++p){var m=a[p],f=t[m];n.skipNulls&&f===null||cP(o,b3(f,m,i,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}var g=o.join(n.delimiter),y=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),g.length>0?y+g:""}});var hP=H((Due,mP)=>{"use strict";var Ro=Hv(),kh=Object.prototype.hasOwnProperty,pP=Array.isArray,xr={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Ro.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},E3=function(r){return r.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},dP=function(r,e,t){if(r&&typeof r=="string"&&e.comma&&r.indexOf(",")>-1)return r.split(",");if(e.throwOnLimitExceeded&&t>=e.arrayLimit)throw new RangeError("Array limit exceeded. Only "+e.arrayLimit+" element"+(e.arrayLimit===1?"":"s")+" allowed in an array.");return r},C3="utf8=%26%2310003%3B",A3="utf8=%E2%9C%93",S3=function(e,t){var n={__proto__:null},a=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;a=a.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=t.parameterLimit===1/0?void 0:t.parameterLimit,o=a.split(t.delimiter,t.throwOnLimitExceeded?s+1:s);if(t.throwOnLimitExceeded&&o.length>s)throw new RangeError("Parameter limit exceeded. Only "+s+" parameter"+(s===1?"":"s")+" allowed.");var i=-1,u,c=t.charset;if(t.charsetSentinel)for(u=0;u<o.length;++u)o[u].indexOf("utf8=")===0&&(o[u]===A3?c="utf-8":o[u]===C3&&(c="iso-8859-1"),i=u,u=o.length);for(u=0;u<o.length;++u)if(u!==i){var p=o[u],m=p.indexOf("]="),f=m===-1?p.indexOf("="):m+1,g,y;if(f===-1?(g=t.decoder(p,xr.decoder,c,"key"),y=t.strictNullHandling?null:""):(g=t.decoder(p.slice(0,f),xr.decoder,c,"key"),g!==null&&(y=Ro.maybeMap(dP(p.slice(f+1),t,pP(n[g])?n[g].length:0),function(A){return t.decoder(A,xr.decoder,c,"value")}))),y&&t.interpretNumericEntities&&c==="iso-8859-1"&&(y=E3(String(y))),p.indexOf("[]=")>-1&&(y=pP(y)?[y]:y),g!==null){var C=kh.call(n,g);C&&t.duplicates==="combine"?n[g]=Ro.combine(n[g],y,t.arrayLimit,t.plainObjects):(!C||t.duplicates==="last")&&(n[g]=y)}}return n},R3=function(r,e,t,n){var a=0;if(r.length>0&&r[r.length-1]==="[]"){var s=r.slice(0,-1).join("");a=Array.isArray(e)&&e[s]?e[s].length:0}for(var o=n?e:dP(e,t,a),i=r.length-1;i>=0;--i){var u,c=r[i];if(c==="[]"&&t.parseArrays)Ro.isOverflow(o)?u=o:u=t.allowEmptyArrays&&(o===""||t.strictNullHandling&&o===null)?[]:Ro.combine([],o,t.arrayLimit,t.plainObjects);else{u=t.plainObjects?{__proto__:null}:{};var p=c.charAt(0)==="["&&c.charAt(c.length-1)==="]"?c.slice(1,-1):c,m=t.decodeDotInKeys?p.replace(/%2E/g,"."):p,f=parseInt(m,10);!t.parseArrays&&m===""?u={0:o}:!isNaN(f)&&c!==m&&String(f)===m&&f>=0&&t.parseArrays&&f<=t.arrayLimit?(u=[],u[f]=o):m!=="__proto__"&&(u[m]=o)}o=u}return o},w3=function(e,t){var n=t.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e;if(t.depth<=0)return!t.plainObjects&&kh.call(Object.prototype,n)&&!t.allowPrototypes?void 0:[n];var a=/(\[[^[\]]*])/,s=/(\[[^[\]]*])/g,o=a.exec(n),i=o?n.slice(0,o.index):n,u=[];if(i){if(!t.plainObjects&&kh.call(Object.prototype,i)&&!t.allowPrototypes)return;u.push(i)}for(var c=0;(o=s.exec(n))!==null&&c<t.depth;){c+=1;var p=o[1].slice(1,-1);if(!t.plainObjects&&kh.call(Object.prototype,p)&&!t.allowPrototypes)return;u.push(o[1])}if(o){if(t.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+t.depth+" and strictDepth is true");u.push("["+n.slice(o.index)+"]")}return u},I3=function(e,t,n,a){if(e){var s=w3(e,n);if(s)return R3(s,t,n,a)}},x3=function(e){if(!e)return xr;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof e.throwOnLimitExceeded<"u"&&typeof e.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var t=typeof e.charset>"u"?xr.charset:e.charset,n=typeof e.duplicates>"u"?xr.duplicates:e.duplicates;if(n!=="combine"&&n!=="first"&&n!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var a=typeof e.allowDots>"u"?e.decodeDotInKeys===!0?!0:xr.allowDots:!!e.allowDots;return{allowDots:a,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:xr.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:xr.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:xr.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:xr.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:xr.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:xr.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:xr.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:xr.decoder,delimiter:typeof e.delimiter=="string"||Ro.isRegExp(e.delimiter)?e.delimiter:xr.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:xr.depth,duplicates:n,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:xr.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:xr.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:xr.plainObjects,strictDepth:typeof e.strictDepth=="boolean"?!!e.strictDepth:xr.strictDepth,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:xr.strictNullHandling,throwOnLimitExceeded:typeof e.throwOnLimitExceeded=="boolean"?e.throwOnLimitExceeded:!1}};mP.exports=function(r,e){var t=x3(e);if(r===""||r===null||typeof r>"u")return t.plainObjects?{__proto__:null}:{};for(var n=typeof r=="string"?S3(r,t):r,a=t.plainObjects?{__proto__:null}:{},s=Object.keys(n),o=0;o<s.length;++o){var i=s[o],u=I3(i,n[i],t,typeof r=="string");a=Ro.merge(a,u,t)}return t.allowSparse===!0?a:Ro.compact(a)}});var Dh=H((Mue,fP)=>{"use strict";var T3=uP(),O3=hP(),N3=Ph();fP.exports={formats:N3,parse:O3,stringify:T3}});var CP=H((Uue,EP)=>{"use strict";var _3=Qc(),P3=Ku(),Mh=th(),$a=rp()("body-parser:urlencoded"),$3=ca()("body-parser"),L3=ip(),yP=Si();EP.exports=j3;var gP=Object.create(null);function j3(r){var e=r||{};e.extended===void 0&&$3("undefined extended: provide extended option");var t=e.extended!==!1,n=e.inflate!==!1,a=typeof e.limit!="number"?_3.parse(e.limit||"100kb"):e.limit,s=e.type||"application/x-www-form-urlencoded",o=e.verify||!1;if(o!==!1&&typeof o!="function")throw new TypeError("option verify must be function");var i=t?k3(e):M3(e),u=typeof s!="function"?U3(s):s;function c(p){return p.length?i(p):{}}return function(m,f,g){if(m._body){$a("body already parsed"),g();return}if(m.body=m.body||{},!yP.hasBody(m)){$a("skip empty body"),g();return}if($a("content-type %j",m.headers["content-type"]),!u(m)){$a("skip parsing"),g();return}var y=D3(m)||"utf-8";if(y!=="utf-8"){$a("invalid charset"),g(Mh(415,'unsupported charset "'+y.toUpperCase()+'"',{charset:y,type:"charset.unsupported"}));return}L3(m,f,g,c,$a,{debug:$a,encoding:y,inflate:n,limit:a,verify:o})}}function k3(r){var e=r.parameterLimit!==void 0?r.parameterLimit:1e3,t=r.depth!==void 0?r.depth:32,n=vP("qs");if(isNaN(e)||e<1)throw new TypeError("option parameterLimit must be a positive number");if(isNaN(t)||t<0)throw new TypeError("option depth must be a zero or a positive number");return isFinite(e)&&(e=e|0),function(s){var o=bP(s,e);if(o===void 0)throw $a("too many parameters"),Mh(413,"too many parameters",{type:"parameters.too.many"});var i=Math.max(100,o);$a("parse extended urlencoding");try{return n(s,{allowPrototypes:!0,arrayLimit:i,depth:t,strictDepth:!0,parameterLimit:e})}catch(u){throw u instanceof RangeError?Mh(400,"The input exceeded the depth",{type:"querystring.parse.rangeError"}):u}}}function D3(r){try{return(P3.parse(r).parameters.charset||"").toLowerCase()}catch{return}}function bP(r,e){for(var t=0,n=0;(n=r.indexOf("&",n))!==-1;)if(t++,n++,t===e)return;return t}function vP(r){var e=gP[r];if(e!==void 0)return e.parse;switch(r){case"qs":e=Dh();break;case"querystring":e=require("querystring");break}return gP[r]=e,e.parse}function M3(r){var e=r.parameterLimit!==void 0?r.parameterLimit:1e3,t=vP("querystring");if(isNaN(e)||e<1)throw new TypeError("option parameterLimit must be a positive number");return isFinite(e)&&(e=e|0),function(a){var s=bP(a,e);if(s===void 0)throw $a("too many parameters"),Mh(413,"too many parameters",{type:"parameters.too.many"});return $a("parse urlencoding"),t(a,void 0,void 0,{maxKeys:e})}}function U3(r){return function(t){return!!yP(t,r)}}});var RP=H((wo,SP)=>{"use strict";var B3=ca()("body-parser"),AP=Object.create(null);wo=SP.exports=B3.function(F3,"bodyParser: use individual json/urlencoded middlewares");Object.defineProperty(wo,"json",{configurable:!0,enumerable:!0,get:Uh("json")});Object.defineProperty(wo,"raw",{configurable:!0,enumerable:!0,get:Uh("raw")});Object.defineProperty(wo,"text",{configurable:!0,enumerable:!0,get:Uh("text")});Object.defineProperty(wo,"urlencoded",{configurable:!0,enumerable:!0,get:Uh("urlencoded")});function F3(r){var e=Object.create(r||null,{type:{configurable:!0,enumerable:!0,value:void 0,writable:!0}}),t=wo.urlencoded(e),n=wo.json(e);return function(s,o,i){n(s,o,function(u){if(u)return i(u);t(s,o,i)})}}function Uh(r){return function(){return q3(r)}}function q3(r){var e=AP[r];if(e!==void 0)return e;switch(r){case"json":e=YO();break;case"raw":e=tN();break;case"text":e=aN();break;case"urlencoded":e=CP();break}return AP[r]=e}});var IP=H((Bue,wP)=>{"use strict";wP.exports=V3;var G3=Object.prototype.hasOwnProperty;function V3(r,e,t){if(!r)throw new TypeError("argument dest is required");if(!e)throw new TypeError("argument src is required");return t===void 0&&(t=!0),Object.getOwnPropertyNames(e).forEach(function(a){if(!(!t&&G3.call(r,a))){var s=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(r,a,s)}}),r}});var TP=H((Fue,xP)=>{var Cp=1e3,Ap=Cp*60,Sp=Ap*60,Rp=Sp*24,z3=Rp*365.25;xP.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return H3(r);if(t==="number"&&isNaN(r)===!1)return e.long?Q3(r):W3(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function H3(r){if(r=String(r),!(r.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*z3;case"days":case"day":case"d":return t*Rp;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Sp;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ap;case"seconds":case"second":case"secs":case"sec":case"s":return t*Cp;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function W3(r){return r>=Rp?Math.round(r/Rp)+"d":r>=Sp?Math.round(r/Sp)+"h":r>=Ap?Math.round(r/Ap)+"m":r>=Cp?Math.round(r/Cp)+"s":r+"ms"}function Q3(r){return Bh(r,Rp,"day")||Bh(r,Sp,"hour")||Bh(r,Ap,"minute")||Bh(r,Cp,"second")||r+" ms"}function Bh(r,e,t){if(!(r<e))return r<e*1.5?Math.floor(r/e)+" "+t:Math.ceil(r/e)+" "+t+"s"}});var Kv=H((Qt,OP)=>{Qt=OP.exports=Jv.debug=Jv.default=Jv;Qt.coerce=Z3;Qt.disable=X3;Qt.enable=K3;Qt.enabled=Y3;Qt.humanize=TP();Qt.names=[];Qt.skips=[];Qt.formatters={};var Qv;function J3(r){var e=0,t;for(t in r)e=(e<<5)-e+r.charCodeAt(t),e|=0;return Qt.colors[Math.abs(e)%Qt.colors.length]}function Jv(r){function e(){if(e.enabled){var t=e,n=+new Date,a=n-(Qv||n);t.diff=a,t.prev=Qv,t.curr=n,Qv=n;for(var s=new Array(arguments.length),o=0;o<s.length;o++)s[o]=arguments[o];s[0]=Qt.coerce(s[0]),typeof s[0]!="string"&&s.unshift("%O");var i=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(c,p){if(c==="%%")return c;i++;var m=Qt.formatters[p];if(typeof m=="function"){var f=s[i];c=m.call(t,f),s.splice(i,1),i--}return c}),Qt.formatArgs.call(t,s);var u=e.log||Qt.log||console.log.bind(console);u.apply(t,s)}}return e.namespace=r,e.enabled=Qt.enabled(r),e.useColors=Qt.useColors(),e.color=J3(r),typeof Qt.init=="function"&&Qt.init(e),e}function K3(r){Qt.save(r),Qt.names=[],Qt.skips=[];for(var e=(typeof r=="string"?r:"").split(/[\s,]+/),t=e.length,n=0;n<t;n++)e[n]&&(r=e[n].replace(/\*/g,".*?"),r[0]==="-"?Qt.skips.push(new RegExp("^"+r.substr(1)+"$")):Qt.names.push(new RegExp("^"+r+"$")))}function X3(){Qt.enable("")}function Y3(r){var e,t;for(e=0,t=Qt.skips.length;e<t;e++)if(Qt.skips[e].test(r))return!1;for(e=0,t=Qt.names.length;e<t;e++)if(Qt.names[e].test(r))return!0;return!1}function Z3(r){return r instanceof Error?r.stack||r.message:r}});var PP=H((Sn,_P)=>{Sn=_P.exports=Kv();Sn.log=r6;Sn.formatArgs=t6;Sn.save=n6;Sn.load=NP;Sn.useColors=e6;Sn.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:a6();Sn.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function e6(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}Sn.formatters.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function t6(r){var e=this.useColors;if(r[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+r[0]+(e?"%c ":" ")+"+"+Sn.humanize(this.diff),!!e){var t="color: "+this.color;r.splice(1,0,t,"color: inherit");var n=0,a=0;r[0].replace(/%[a-zA-Z%]/g,function(s){s!=="%%"&&(n++,s==="%c"&&(a=n))}),r.splice(a,0,t)}}function r6(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function n6(r){try{r==null?Sn.storage.removeItem("debug"):Sn.storage.debug=r}catch{}}function NP(){var r;try{r=Sn.storage.debug}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}Sn.enable(NP());function a6(){try{return window.localStorage}catch{}}});var kP=H((Yr,jP)=>{var $P=require("tty"),wp=require("util");Yr=jP.exports=Kv();Yr.init=p6;Yr.log=c6;Yr.formatArgs=i6;Yr.save=l6;Yr.load=LP;Yr.useColors=o6;Yr.colors=[6,2,3,4,5,1];Yr.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(a,s){return s.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});var ul=parseInt(process.env.DEBUG_FD,10)||2;ul!==1&&ul!==2&&wp.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var s6=ul===1?process.stdout:ul===2?process.stderr:u6(ul);function o6(){return"colors"in Yr.inspectOpts?!!Yr.inspectOpts.colors:$P.isatty(ul)}Yr.formatters.o=function(r){return this.inspectOpts.colors=this.useColors,wp.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};Yr.formatters.O=function(r){return this.inspectOpts.colors=this.useColors,wp.inspect(r,this.inspectOpts)};function i6(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,a="  \x1B[3"+n+";1m"+e+" \x1B[0m";r[0]=a+r[0].split(`
`).join(`
`+a),r.push("\x1B[3"+n+"m+"+Yr.humanize(this.diff)+"\x1B[0m")}else r[0]=new Date().toUTCString()+" "+e+" "+r[0]}function c6(){return s6.write(wp.format.apply(wp,arguments)+`
`)}function l6(r){r==null?delete process.env.DEBUG:process.env.DEBUG=r}function LP(){return process.env.DEBUG}function u6(r){var e,t=process.binding("tty_wrap");switch(t.guessHandleType(r)){case"TTY":e=new $P.WriteStream(r),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(r,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var a=require("net");e=new a.Socket({fd:r,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=r,e._isStdio=!0,e}function p6(r){r.inspectOpts={};for(var e=Object.keys(Yr.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=Yr.inspectOpts[e[t]]}Yr.enable(LP())});var DP=H((que,Xv)=>{typeof process<"u"&&process.type==="renderer"?Xv.exports=PP():Xv.exports=kP()});var Fh=H((Gue,MP)=>{"use strict";MP.exports=f6;var d6=/(?:[^\x21\x23-\x3B\x3D\x3F-\x5F\x61-\x7A\x7C\x7E]|%(?:[^0-9A-Fa-f]|[0-9A-Fa-f][^0-9A-Fa-f]|$))+/g,m6=/(^|[^\uD800-\uDBFF])[\uDC00-\uDFFF]|[\uD800-\uDBFF]([^\uDC00-\uDFFF]|$)/g,h6="$1\uFFFD$2";function f6(r){return String(r).replace(m6,h6).replace(d6,encodeURI)}});var Ip=H((Vue,UP)=>{"use strict";var g6=/["'&<>]/;UP.exports=y6;function y6(r){var e=""+r,t=g6.exec(e);if(!t)return e;var n,a="",s=0,o=0;for(s=t.index;s<e.length;s++){switch(e.charCodeAt(s)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&#39;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}o!==s&&(a+=e.substring(o,s)),o=s+1,a+=n}return o!==s?a+e.substring(o,s):a}});var pl=H((zue,Yv)=>{"use strict";var FP=require("url"),BP=FP.parse,qh=FP.Url;Yv.exports=qP;Yv.exports.original=b6;function qP(r){var e=r.url;if(e!==void 0){var t=r._parsedUrl;return VP(e,t)?t:(t=GP(e),t._raw=e,r._parsedUrl=t)}}function b6(r){var e=r.originalUrl;if(typeof e!="string")return qP(r);var t=r._parsedOriginalUrl;return VP(e,t)?t:(t=GP(e),t._raw=e,r._parsedOriginalUrl=t)}function GP(r){if(typeof r!="string"||r.charCodeAt(0)!==47)return BP(r);for(var e=r,t=null,n=null,a=1;a<r.length;a++)switch(r.charCodeAt(a)){case 63:n===null&&(e=r.substring(0,a),t=r.substring(a+1),n=r.substring(a));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return BP(r)}var s=qh!==void 0?new qh:{};return s.path=r,s.href=r,s.pathname=e,n!==null&&(s.query=t,s.search=n),s}function VP(r,e){return typeof e=="object"&&e!==null&&(qh===void 0||e instanceof qh)&&e._raw===r}});var zP=H((Hue,v6)=>{v6.exports={"100":"Continue","101":"Switching Protocols","102":"Processing","103":"Early Hints","200":"OK","201":"Created","202":"Accepted","203":"Non-Authoritative Information","204":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","208":"Already Reported","226":"IM Used","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Temporary Redirect","308":"Permanent Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Timeout","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Payload Too Large","414":"URI Too Long","415":"Unsupported Media Type","416":"Range Not Satisfiable","417":"Expectation Failed","418":"I'm a Teapot","421":"Misdirected Request","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","425":"Too Early","426":"Upgrade Required","428":"Precondition Required","429":"Too Many Requests","431":"Request Header Fields Too Large","451":"Unavailable For Legal Reasons","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Timeout","505":"HTTP Version Not Supported","506":"Variant Also Negotiates","507":"Insufficient Storage","508":"Loop Detected","509":"Bandwidth Limit Exceeded","510":"Not Extended","511":"Network Authentication Required"}});var xp=H((Wue,WP)=>{"use strict";var Zv=zP();WP.exports=La;La.message=Zv;La.code=E6(Zv);La.codes=C6(Zv);La.redirect={300:!0,301:!0,302:!0,303:!0,305:!0,307:!0,308:!0};La.empty={204:!0,205:!0,304:!0};La.retry={502:!0,503:!0,504:!0};function E6(r){var e={};return Object.keys(r).forEach(function(n){var a=r[n],s=Number(n);e[a.toLowerCase()]=s}),e}function C6(r){return Object.keys(r).map(function(t){return Number(t)})}function A6(r){var e=r.toLowerCase();if(!Object.prototype.hasOwnProperty.call(La.code,e))throw new Error('invalid status message: "'+r+'"');return La.code[e]}function HP(r){if(!Object.prototype.hasOwnProperty.call(La.message,r))throw new Error("invalid status code: "+r);return La.message[r]}function La(r){if(typeof r=="number")return HP(r);if(typeof r!="string")throw new TypeError("code must be a number or string");var e=parseInt(r,10);return isNaN(e)?A6(r):HP(e)}});var YP=H((Que,XP)=>{"use strict";var eE=DP()("finalhandler"),S6=Fh(),R6=Ip(),JP=op(),w6=pl(),KP=xp(),I6=bh(),x6=/\x20{2}/g,T6=/\n/g,O6=typeof setImmediate=="function"?setImmediate:function(r){process.nextTick(r.bind.apply(r,arguments))},N6=JP.isFinished;function _6(r){var e=R6(r).replace(T6,"<br>").replace(x6," &nbsp;");return`<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Error</title>
</head>
<body>
<pre>`+e+`</pre>
</body>
</html>
`}XP.exports=P6;function P6(r,e,t){var n=t||{},a=n.env||"production",s=n.onerror;return function(o){var i,u,c;if(!o&&QP(e)){eE("cannot 404 after headers sent");return}if(o?(c=j6(o),c===void 0?c=D6(e):i=$6(o),u=L6(o,c,a)):(c=404,u="Cannot "+r.method+" "+S6(k6(r))),eE("default %s",c),o&&s&&O6(s,o,r,e),QP(e)){eE("cannot %d after headers sent",c),r.socket&&r.socket.destroy();return}M6(r,e,c,i,u)}}function $6(r){if(!(!r.headers||typeof r.headers!="object")){for(var e=Object.create(null),t=Object.keys(r.headers),n=0;n<t.length;n++){var a=t[n];e[a]=r.headers[a]}return e}}function L6(r,e,t){var n;return t!=="production"&&(n=r.stack,!n&&typeof r.toString=="function"&&(n=r.toString())),n||KP.message[e]}function j6(r){if(typeof r.status=="number"&&r.status>=400&&r.status<600)return r.status;if(typeof r.statusCode=="number"&&r.statusCode>=400&&r.statusCode<600)return r.statusCode}function k6(r){try{return w6.original(r).pathname}catch{return"resource"}}function D6(r){var e=r.statusCode;return(typeof e!="number"||e<400||e>599)&&(e=500),e}function QP(r){return typeof r.headersSent!="boolean"?!!r._header:r.headersSent}function M6(r,e,t,n,a){function s(){var o=_6(a);if(e.statusCode=t,r.httpVersionMajor<2&&(e.statusMessage=KP.message[t]),e.removeHeader("Content-Encoding"),e.removeHeader("Content-Language"),e.removeHeader("Content-Range"),U6(e,n),e.setHeader("Content-Security-Policy","default-src 'none'"),e.setHeader("X-Content-Type-Options","nosniff"),e.setHeader("Content-Type","text/html; charset=utf-8"),e.setHeader("Content-Length",Buffer.byteLength(o,"utf8")),r.method==="HEAD"){e.end();return}e.end(o,"utf8")}if(N6(r)){s();return}I6(r),JP(r,s),r.resume()}function U6(r,e){if(e)for(var t=Object.keys(e),n=0;n<t.length;n++){var a=t[n];r.setHeader(a,e[a])}}});var e1=H((Jue,ZP)=>{var Tp=1e3,Op=Tp*60,Np=Op*60,_p=Np*24,B6=_p*365.25;ZP.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return F6(r);if(t==="number"&&isNaN(r)===!1)return e.long?G6(r):q6(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function F6(r){if(r=String(r),!(r.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*B6;case"days":case"day":case"d":return t*_p;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Np;case"minutes":case"minute":case"mins":case"min":case"m":return t*Op;case"seconds":case"second":case"secs":case"sec":case"s":return t*Tp;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function q6(r){return r>=_p?Math.round(r/_p)+"d":r>=Np?Math.round(r/Np)+"h":r>=Op?Math.round(r/Op)+"m":r>=Tp?Math.round(r/Tp)+"s":r+"ms"}function G6(r){return Gh(r,_p,"day")||Gh(r,Np,"hour")||Gh(r,Op,"minute")||Gh(r,Tp,"second")||r+" ms"}function Gh(r,e,t){if(!(r<e))return r<e*1.5?Math.floor(r/e)+" "+t:Math.ceil(r/e)+" "+t+"s"}});var nE=H((Jt,t1)=>{Jt=t1.exports=rE.debug=rE.default=rE;Jt.coerce=Q6;Jt.disable=H6;Jt.enable=z6;Jt.enabled=W6;Jt.humanize=e1();Jt.names=[];Jt.skips=[];Jt.formatters={};var tE;function V6(r){var e=0,t;for(t in r)e=(e<<5)-e+r.charCodeAt(t),e|=0;return Jt.colors[Math.abs(e)%Jt.colors.length]}function rE(r){function e(){if(e.enabled){var t=e,n=+new Date,a=n-(tE||n);t.diff=a,t.prev=tE,t.curr=n,tE=n;for(var s=new Array(arguments.length),o=0;o<s.length;o++)s[o]=arguments[o];s[0]=Jt.coerce(s[0]),typeof s[0]!="string"&&s.unshift("%O");var i=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(c,p){if(c==="%%")return c;i++;var m=Jt.formatters[p];if(typeof m=="function"){var f=s[i];c=m.call(t,f),s.splice(i,1),i--}return c}),Jt.formatArgs.call(t,s);var u=e.log||Jt.log||console.log.bind(console);u.apply(t,s)}}return e.namespace=r,e.enabled=Jt.enabled(r),e.useColors=Jt.useColors(),e.color=V6(r),typeof Jt.init=="function"&&Jt.init(e),e}function z6(r){Jt.save(r),Jt.names=[],Jt.skips=[];for(var e=(typeof r=="string"?r:"").split(/[\s,]+/),t=e.length,n=0;n<t;n++)e[n]&&(r=e[n].replace(/\*/g,".*?"),r[0]==="-"?Jt.skips.push(new RegExp("^"+r.substr(1)+"$")):Jt.names.push(new RegExp("^"+r+"$")))}function H6(){Jt.enable("")}function W6(r){var e,t;for(e=0,t=Jt.skips.length;e<t;e++)if(Jt.skips[e].test(r))return!1;for(e=0,t=Jt.names.length;e<t;e++)if(Jt.names[e].test(r))return!0;return!1}function Q6(r){return r instanceof Error?r.stack||r.message:r}});var a1=H((Rn,n1)=>{Rn=n1.exports=nE();Rn.log=X6;Rn.formatArgs=K6;Rn.save=Y6;Rn.load=r1;Rn.useColors=J6;Rn.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:Z6();Rn.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function J6(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}Rn.formatters.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function K6(r){var e=this.useColors;if(r[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+r[0]+(e?"%c ":" ")+"+"+Rn.humanize(this.diff),!!e){var t="color: "+this.color;r.splice(1,0,t,"color: inherit");var n=0,a=0;r[0].replace(/%[a-zA-Z%]/g,function(s){s!=="%%"&&(n++,s==="%c"&&(a=n))}),r.splice(a,0,t)}}function X6(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function Y6(r){try{r==null?Rn.storage.removeItem("debug"):Rn.storage.debug=r}catch{}}function r1(){var r;try{r=Rn.storage.debug}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}Rn.enable(r1());function Z6(){try{return window.localStorage}catch{}}});var c1=H((Zr,i1)=>{var s1=require("tty"),Pp=require("util");Zr=i1.exports=nE();Zr.init=oH;Zr.log=nH;Zr.formatArgs=rH;Zr.save=aH;Zr.load=o1;Zr.useColors=tH;Zr.colors=[6,2,3,4,5,1];Zr.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(a,s){return s.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});var dl=parseInt(process.env.DEBUG_FD,10)||2;dl!==1&&dl!==2&&Pp.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var eH=dl===1?process.stdout:dl===2?process.stderr:sH(dl);function tH(){return"colors"in Zr.inspectOpts?!!Zr.inspectOpts.colors:s1.isatty(dl)}Zr.formatters.o=function(r){return this.inspectOpts.colors=this.useColors,Pp.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};Zr.formatters.O=function(r){return this.inspectOpts.colors=this.useColors,Pp.inspect(r,this.inspectOpts)};function rH(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,a="  \x1B[3"+n+";1m"+e+" \x1B[0m";r[0]=a+r[0].split(`
`).join(`
`+a),r.push("\x1B[3"+n+"m+"+Zr.humanize(this.diff)+"\x1B[0m")}else r[0]=new Date().toUTCString()+" "+e+" "+r[0]}function nH(){return eH.write(Pp.format.apply(Pp,arguments)+`
`)}function aH(r){r==null?delete process.env.DEBUG:process.env.DEBUG=r}function o1(){return process.env.DEBUG}function sH(r){var e,t=process.binding("tty_wrap");switch(t.guessHandleType(r)){case"TTY":e=new s1.WriteStream(r),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(r,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var a=require("net");e=new a.Socket({fd:r,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=r,e._isStdio=!0,e}function oH(r){r.inspectOpts={};for(var e=Object.keys(Zr.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=Zr.inspectOpts[e[t]]}Zr.enable(o1())});var ml=H((Kue,aE)=>{typeof process<"u"&&process.type==="renderer"?aE.exports=a1():aE.exports=c1()});var $p=H((Xue,p1)=>{"use strict";p1.exports=iH;function l1(r,e,t){for(var n=0;n<r.length;n++){var a=r[n];t>0&&Array.isArray(a)?l1(a,e,t-1):e.push(a)}return e}function u1(r,e){for(var t=0;t<r.length;t++){var n=r[t];Array.isArray(n)?u1(n,e):e.push(n)}return e}function iH(r,e){return e==null?u1(r,[]):l1(r,[],e)}});var f1=H((Yue,h1)=>{h1.exports=m1;var d1=/\\.|\((?:\?<(.*?)>)?(?!\?)/g;function m1(r,e,t){t=t||{},e=e||[];var n=t.strict,a=t.end!==!1,s=t.sensitive?"":"i",o=t.lookahead!==!1,i=0,u=e.length,c=0,p=0,m=0,f="",g;if(r instanceof RegExp){for(;g=d1.exec(r.source);)g[0][0]!=="\\"&&e.push({name:g[1]||p++,optional:!1,offset:g.index});return r}if(Array.isArray(r))return r=r.map(function(y){return m1(y,e,t).source}),new RegExp(r.join("|"),s);if(typeof r!="string")throw new TypeError("path must be a string, array of strings, or regular expression");for(r=r.replace(/\\.|(\/)?(\.)?:(\w+)(\(.*?\))?(\*)?(\?)?|[.*]|\/\(/g,function(y,C,A,T,E,d,l,h){if(y[0]==="\\")return f+=y,m+=2,y;if(y===".")return f+="\\.",i+=1,m+=1,"\\.";if(C||A?f="":f+=r.slice(m,h),m=h+y.length,y==="*")return i+=3,"(.*)";if(y==="/(")return f+="/",i+=2,"/(?:";C=C||"",A=A?"\\.":"",l=l||"",E=E?E.replace(/\\.|\*/,function(S){return S==="*"?"(.*)":S}):f?"((?:(?!/|"+f+").)+?)":"([^/"+A+"]+?)",e.push({name:T,optional:!!l,offset:h+i});var v="(?:"+A+C+E+(d?"((?:[/"+A+"].+?)?)":"")+")"+l;return i+=v.length-y.length,v});g=d1.exec(r);)g[0][0]!=="\\"&&((u+c===e.length||e[u+c].offset>g.index)&&e.splice(u+c,0,{name:p++,optional:!1,offset:g.index}),c++);return r+=n?"":r[r.length-1]==="/"?"?":"/?",a?r+="$":r[r.length-1]!=="/"&&(r+=o?"(?=/|$)":"(?:/|$)"),new RegExp("^"+r,s)}});var sE=H((Zue,y1)=>{"use strict";var cH=f1(),lH=ml()("express:router:layer"),uH=Object.prototype.hasOwnProperty;y1.exports=hl;function hl(r,e,t){if(!(this instanceof hl))return new hl(r,e,t);lH("new %o",r);var n=e||{};this.handle=t,this.name=t.name||"<anonymous>",this.params=void 0,this.path=void 0,this.regexp=cH(r,this.keys=[],n),this.regexp.fast_star=r==="*",this.regexp.fast_slash=r==="/"&&n.end===!1}hl.prototype.handle_error=function(e,t,n,a){var s=this.handle;if(s.length!==4)return a(e);try{s(e,t,n,a)}catch(o){a(o)}};hl.prototype.handle_request=function(e,t,n){var a=this.handle;if(a.length>3)return n();try{a(e,t,n)}catch(s){n(s)}};hl.prototype.match=function(e){var t;if(e!=null){if(this.regexp.fast_slash)return this.params={},this.path="",!0;if(this.regexp.fast_star)return this.params={0:g1(e)},this.path=e,!0;t=this.regexp.exec(e)}if(!t)return this.params=void 0,this.path=void 0,!1;this.params={},this.path=t[0];for(var n=this.keys,a=this.params,s=1;s<t.length;s++){var o=n[s-1],i=o.name,u=g1(t[s]);(u!==void 0||!uH.call(a,i))&&(a[i]=u)}return!0};function g1(r){if(typeof r!="string"||r.length===0)return r;try{return decodeURIComponent(r)}catch(e){throw e instanceof URIError&&(e.message="Failed to decode param '"+r+"'",e.status=e.statusCode=400),e}}});var Vh=H((epe,v1)=>{"use strict";var b1=require("http");v1.exports=pH()||dH();function pH(){return b1.METHODS&&b1.METHODS.map(function(e){return e.toLowerCase()})}function dH(){return["get","post","put","head","delete","options","trace","copy","lock","mkcol","move","purge","propfind","proppatch","unlock","report","mkactivity","checkout","merge","m-search","notify","subscribe","unsubscribe","patch","search","connect"]}});var oE=H((tpe,w1)=>{"use strict";var E1=ml()("express:router:route"),C1=$p(),A1=sE(),mH=Vh(),S1=Array.prototype.slice,R1=Object.prototype.toString;w1.exports=fl;function fl(r){this.path=r,this.stack=[],E1("new %o",r),this.methods={}}fl.prototype._handles_method=function(e){if(this.methods._all)return!0;var t=typeof e=="string"?e.toLowerCase():e;return t==="head"&&!this.methods.head&&(t="get"),!!this.methods[t]};fl.prototype._options=function(){var e=Object.keys(this.methods);this.methods.get&&!this.methods.head&&e.push("head");for(var t=0;t<e.length;t++)e[t]=e[t].toUpperCase();return e};fl.prototype.dispatch=function(e,t,n){var a=0,s=this.stack,o=0;if(s.length===0)return n();var i=typeof e.method=="string"?e.method.toLowerCase():e.method;i==="head"&&!this.methods.head&&(i="get"),e.route=this,u();function u(c){if(c&&c==="route")return n();if(c&&c==="router")return n(c);if(++o>100)return setImmediate(u,c);var p=s[a++];if(!p)return n(c);p.method&&p.method!==i?u(c):c?p.handle_error(c,e,t,u):p.handle_request(e,t,u),o=0}};fl.prototype.all=function(){for(var e=C1(S1.call(arguments)),t=0;t<e.length;t++){var n=e[t];if(typeof n!="function"){var a=R1.call(n),s="Route.all() requires a callback function but got a "+a;throw new TypeError(s)}var o=A1("/",{},n);o.method=void 0,this.methods._all=!0,this.stack.push(o)}return this};mH.forEach(function(r){fl.prototype[r]=function(){for(var e=C1(S1.call(arguments)),t=0;t<e.length;t++){var n=e[t];if(typeof n!="function"){var a=R1.call(n),s="Route."+r+"() requires a callback function but got a "+a;throw new Error(s)}E1("%s %o",r,this.path);var o=A1("/",{},n);o.method=r,this.methods[r]=!0,this.stack.push(o)}return this}})});var Lp=H((I1,x1)=>{I1=x1.exports=function(r,e){if(r&&e)for(var t in e)r[t]=e[t];return r}});var cE=H((rpe,_1)=>{"use strict";var hH=oE(),O1=sE(),fH=Vh(),iE=Lp(),zh=ml()("express:router"),T1=ca()("express"),gH=$p(),yH=pl(),bH=fi(),vH=/^\[object (\S+)\]$/,N1=Array.prototype.slice,EH=Object.prototype.toString,Ti=_1.exports=function(r){var e=r||{};function t(n,a,s){t.handle(n,a,s)}return bH(t,Ti),t.params={},t._params=[],t.caseSensitive=e.caseSensitive,t.mergeParams=e.mergeParams,t.strict=e.strict,t.stack=[],t};Ti.param=function(e,t){if(typeof e=="function"){T1("router.param(fn): Refactor to use path params"),this._params.push(e);return}var n=this._params,a=n.length,s;e[0]===":"&&(T1("router.param("+JSON.stringify(e)+", fn): Use router.param("+JSON.stringify(e.slice(1))+", fn) instead"),e=e.slice(1));for(var o=0;o<a;++o)(s=n[o](e,t))&&(t=s);if(typeof t!="function")throw new Error("invalid param() call for "+e+", got "+t);return(this.params[e]=this.params[e]||[]).push(t),this};Ti.handle=function(e,t,n){var a=this;zh("dispatching %s %s",e.method,e.url);var s=0,o=SH(e.url)||"",i="",u=!1,c=0,p={},m=[],f=a.stack,g=e.params,y=e.baseUrl||"",C=xH(n,e,"baseUrl","next","params");e.next=A,e.method==="OPTIONS"&&(C=OH(C,function(E,d){if(d||m.length===0)return E(d);TH(t,m,E)})),e.baseUrl=y,e.originalUrl=e.originalUrl||e.url,A();function A(E){var d=E==="route"?null:E;if(u&&(e.url=e.url.slice(1),u=!1),i.length!==0&&(e.baseUrl=y,e.url=o+i+e.url.slice(o.length),i=""),d==="router"){setImmediate(C,null);return}if(s>=f.length){setImmediate(C,d);return}if(++c>100)return setImmediate(A,E);var l=AH(e);if(l==null)return C(d);for(var h,v,S;v!==!0&&s<f.length;)if(h=f[s++],v=wH(h,l),S=h.route,typeof v!="boolean"&&(d=d||v),v===!0&&S){if(d){v=!1;continue}var R=e.method,x=S._handles_method(R);!x&&R==="OPTIONS"&&CH(m,S._options()),!x&&R!=="HEAD"&&(v=!1)}if(v!==!0)return C(d);S&&(e.route=S),e.params=a.mergeParams?IH(h.params,g):h.params;var w=h.path;a.process_params(h,p,e,t,function(O){O?A(d||O):S?h.handle_request(e,t,A):T(h,d,w,l),c=0})}function T(E,d,l,h){if(l.length!==0){if(l!==h.slice(0,l.length)){A(d);return}var v=h[l.length];if(v&&v!=="/"&&v!==".")return A(d);zh("trim prefix (%s) from url %s",l,e.url),i=l,e.url=o+e.url.slice(o.length+i.length),!o&&e.url[0]!=="/"&&(e.url="/"+e.url,u=!0),e.baseUrl=y+(i[i.length-1]==="/"?i.substring(0,i.length-1):i)}zh("%s %s : %s",E.name,l,e.originalUrl),d?E.handle_error(d,e,t,A):E.handle_request(e,t,A)}};Ti.process_params=function(e,t,n,a,s){var o=this.params,i=e.keys;if(!i||i.length===0)return s();var u=0,c,p=0,m,f,g,y;function C(T){if(T)return s(T);if(u>=i.length)return s();if(p=0,m=i[u++],c=m.name,f=n.params[c],g=o[c],y=t[c],f===void 0||!g)return C();if(y&&(y.match===f||y.error&&y.error!=="route"))return n.params[c]=y.value,C(y.error);t[c]=y={error:null,match:f,value:f},A()}function A(T){var E=g[p++];if(y.value=n.params[m.name],T){y.error=T,C(T);return}if(!E)return C();try{E(n,a,A,f,m.name)}catch(d){A(d)}}C()};Ti.use=function(e){var t=0,n="/";if(typeof e!="function"){for(var a=e;Array.isArray(a)&&a.length!==0;)a=a[0];typeof a!="function"&&(t=1,n=e)}var s=gH(N1.call(arguments,t));if(s.length===0)throw new TypeError("Router.use() requires a middleware function");for(var o=0;o<s.length;o++){var e=s[o];if(typeof e!="function")throw new TypeError("Router.use() requires a middleware function but got a "+RH(e));zh("use %o %s",n,e.name||"<anonymous>");var i=new O1(n,{sensitive:this.caseSensitive,strict:!1,end:!1},e);i.route=void 0,this.stack.push(i)}return this};Ti.route=function(e){var t=new hH(e),n=new O1(e,{sensitive:this.caseSensitive,strict:this.strict,end:!0},t.dispatch.bind(t));return n.route=t,this.stack.push(n),t};fH.concat("all").forEach(function(r){Ti[r]=function(e){var t=this.route(e);return t[r].apply(t,N1.call(arguments,1)),this}});function CH(r,e){for(var t=0;t<e.length;t++){var n=e[t];r.indexOf(n)===-1&&r.push(n)}}function AH(r){try{return yH(r).pathname}catch{return}}function SH(r){if(!(typeof r!="string"||r.length===0||r[0]==="/")){var e=r.indexOf("?"),t=e!==-1?e:r.length,n=r.slice(0,t).indexOf("://");return n!==-1?r.substring(0,r.indexOf("/",3+n)):void 0}}function RH(r){var e=typeof r;return e!=="object"?e:EH.call(r).replace(vH,"$1")}function wH(r,e){try{return r.match(e)}catch(t){return t}}function IH(r,e){if(typeof e!="object"||!e)return r;var t=iE({},e);if(!(0 in r)||!(0 in e))return iE(t,r);for(var n=0,a=0;n in r;)n++;for(;a in e;)a++;for(n--;n>=0;n--)r[n+a]=r[n],n<a&&delete r[n];return iE(t,r)}function xH(r,e){for(var t=new Array(arguments.length-2),n=new Array(arguments.length-2),a=0;a<t.length;a++)t[a]=arguments[a+2],n[a]=e[t[a]];return function(){for(var s=0;s<t.length;s++)e[t[s]]=n[s];return r.apply(this,arguments)}}function TH(r,e,t){try{var n=e.join(",");r.set("Allow",n),r.send(n)}catch(a){t(a)}}function OH(r,e){return function(){var n=new Array(arguments.length+1);n[0]=r;for(var a=0,s=arguments.length;a<s;a++)n[a+1]=arguments[a];e.apply(this,n)}}});var L1=H($1=>{"use strict";var P1=fi();$1.init=function(r){return function(t,n,a){r.enabled("x-powered-by")&&n.setHeader("X-Powered-By","Express"),t.res=n,n.req=t,t.next=a,P1(t,r.request),P1(n,r.response),n.locals=n.locals||Object.create(null),a()}}});var lE=H((ape,j1)=>{"use strict";var NH=Lp(),_H=pl(),PH=Dh();j1.exports=function(e){var t=NH({},e),n=PH.parse;return typeof e=="function"&&(n=e,t=void 0),t!==void 0&&t.allowPrototypes===void 0&&(t.allowPrototypes=!0),function(s,o,i){if(!s.query){var u=_H(s).query;s.query=n(u,t)}i()}}});var B1=H((spe,U1)=>{"use strict";var Hh=ml()("express:view"),jp=require("path"),$H=require("fs"),LH=jp.dirname,M1=jp.basename,jH=jp.extname,k1=jp.join,kH=jp.resolve;U1.exports=Wh;function Wh(r,e){var t=e||{};if(this.defaultEngine=t.defaultEngine,this.ext=jH(r),this.name=r,this.root=t.root,!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");var n=r;if(this.ext||(this.ext=this.defaultEngine[0]!=="."?"."+this.defaultEngine:this.defaultEngine,n+=this.ext),!t.engines[this.ext]){var a=this.ext.slice(1);Hh('require "%s"',a);var s=require(a).__express;if(typeof s!="function")throw new Error('Module "'+a+'" does not provide a view engine.');t.engines[this.ext]=s}this.engine=t.engines[this.ext],this.path=this.lookup(n)}Wh.prototype.lookup=function(e){var t,n=[].concat(this.root);Hh('lookup "%s"',e);for(var a=0;a<n.length&&!t;a++){var s=n[a],o=kH(s,e),i=LH(o),u=M1(o);t=this.resolve(i,u)}return t};Wh.prototype.render=function(e,t){Hh('render "%s"',this.path),this.engine(this.path,e,t)};Wh.prototype.resolve=function(e,t){var n=this.ext,a=k1(e,t),s=D1(a);if(s&&s.isFile()||(a=k1(e,M1(t,n),"index"+n),s=D1(a),s&&s.isFile()))return a};function D1(r){Hh('stat "%s"',r);try{return $H.statSync(r)}catch{return}}});var Jh=H((uE,q1)=>{var Qh=require("buffer"),as=Qh.Buffer;function F1(r,e){for(var t in r)e[t]=r[t]}as.from&&as.alloc&&as.allocUnsafe&&as.allocUnsafeSlow?q1.exports=Qh:(F1(Qh,uE),uE.Buffer=Oi);function Oi(r,e,t){return as(r,e,t)}Oi.prototype=Object.create(as.prototype);F1(as,Oi);Oi.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return as(r,e,t)};Oi.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=as(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};Oi.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return as(r)};Oi.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Qh.SlowBuffer(r)}});var dE=H((ope,pE)=>{"use strict";pE.exports=WH;pE.exports.parse=XH;var G1=require("path").basename,DH=Jh().Buffer,MH=/[\x00-\x20"'()*,/:;<=>?@[\\\]{}\x7f]/g,UH=/%[0-9A-Fa-f]{2}/,BH=/%([0-9A-Fa-f]{2})/g,z1=/[^\x20-\x7e\xa0-\xff]/g,FH=/\\([\u0000-\u007f])/g,qH=/([\\"])/g,V1=/;[\x09\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*=[\x09\x20]*("(?:[\x20!\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*/g,GH=/^[\x20-\x7e\x80-\xff]+$/,VH=/^[!#$%&'*+.0-9A-Z^_`a-z|~-]+$/,zH=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/,HH=/^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*(?:$|;)/;function WH(r,e){var t=e||{},n=t.type||"attachment",a=QH(r,t.fallback);return JH(new W1(n,a))}function QH(r,e){if(r!==void 0){var t={};if(typeof r!="string")throw new TypeError("filename must be a string");if(e===void 0&&(e=!0),typeof e!="string"&&typeof e!="boolean")throw new TypeError("fallback must be a string or boolean");if(typeof e=="string"&&z1.test(e))throw new TypeError("fallback must be ISO-8859-1 string");var n=G1(r),a=GH.test(n),s=typeof e!="string"?e&&H1(n):G1(e),o=typeof s=="string"&&s!==n;return(o||!a||UH.test(n))&&(t["filename*"]=n),(a||o)&&(t.filename=o?s:n),t}}function JH(r){var e=r.parameters,t=r.type;if(!t||typeof t!="string"||!VH.test(t))throw new TypeError("invalid type");var n=String(t).toLowerCase();if(e&&typeof e=="object")for(var a,s=Object.keys(e).sort(),o=0;o<s.length;o++){a=s[o];var i=a.substr(-1)==="*"?t9(e[a]):e9(e[a]);n+="; "+a+"="+i}return n}function KH(r){var e=zH.exec(r);if(!e)throw new TypeError("invalid extended field value");var t=e[1].toLowerCase(),n=e[2],a,s=n.replace(BH,YH);switch(t){case"iso-8859-1":a=H1(s);break;case"utf-8":a=DH.from(s,"binary").toString("utf8");break;default:throw new TypeError("unsupported charset in extended field")}return a}function H1(r){return String(r).replace(z1,"?")}function XH(r){if(!r||typeof r!="string")throw new TypeError("argument string is required");var e=HH.exec(r);if(!e)throw new TypeError("invalid type format");var t=e[0].length,n=e[1].toLowerCase(),a,s=[],o={},i;for(t=V1.lastIndex=e[0].substr(-1)===";"?t-1:t;e=V1.exec(r);){if(e.index!==t)throw new TypeError("invalid parameter format");if(t+=e[0].length,a=e[1].toLowerCase(),i=e[2],s.indexOf(a)!==-1)throw new TypeError("invalid duplicate parameter");if(s.push(a),a.indexOf("*")+1===a.length){a=a.slice(0,-1),i=KH(i),o[a]=i;continue}typeof o[a]!="string"&&(i[0]==='"'&&(i=i.substr(1,i.length-2).replace(FH,"$1")),o[a]=i)}if(t!==-1&&t!==r.length)throw new TypeError("invalid parameter format");return new W1(n,o)}function YH(r,e){return String.fromCharCode(parseInt(e,16))}function ZH(r){return"%"+String(r).charCodeAt(0).toString(16).toUpperCase()}function e9(r){var e=String(r);return'"'+e.replace(qH,"\\$1")+'"'}function t9(r){var e=String(r),t=encodeURIComponent(e).replace(MH,ZH);return"UTF-8''"+t}function W1(r,e){this.type=r,this.parameters=e}});var hE=H((ipe,Ni)=>{"use strict";var r9=ca()("http-errors"),Q1=fi(),gl=xp(),mE=Ya(),n9=Zm();Ni.exports=Kh;Ni.exports.HttpError=a9();Ni.exports.isHttpError=o9(Ni.exports.HttpError);c9(Ni.exports,gl.codes,Ni.exports.HttpError);function J1(r){return+(String(r).charAt(0)+"00")}function Kh(){for(var r,e,t=500,n={},a=0;a<arguments.length;a++){var s=arguments[a],o=typeof s;if(o==="object"&&s instanceof Error)r=s,t=r.status||r.statusCode||t;else if(o==="number"&&a===0)t=s;else if(o==="string")e=s;else if(o==="object")n=s;else throw new TypeError("argument #"+(a+1)+" unsupported type "+o)}typeof t=="number"&&(t<400||t>=600)&&r9("non-error status code; use only 4xx or 5xx status codes"),(typeof t!="number"||!gl.message[t]&&(t<400||t>=600))&&(t=500);var i=Kh[t]||Kh[J1(t)];r||(r=i?new i(e):new Error(e||gl.message[t]),Error.captureStackTrace(r,Kh)),(!i||!(r instanceof i)||r.status!==t)&&(r.expose=t<500,r.status=r.statusCode=t);for(var u in n)u!=="status"&&u!=="statusCode"&&(r[u]=n[u]);return r}function a9(){function r(){throw new TypeError("cannot construct abstract class")}return mE(r,Error),r}function s9(r,e,t){var n=X1(e);function a(s){var o=s??gl.message[t],i=new Error(o);return Error.captureStackTrace(i,a),Q1(i,a.prototype),Object.defineProperty(i,"message",{enumerable:!0,configurable:!0,value:o,writable:!0}),Object.defineProperty(i,"name",{enumerable:!1,configurable:!0,value:n,writable:!0}),i}return mE(a,r),K1(a,n),a.prototype.status=t,a.prototype.statusCode=t,a.prototype.expose=!0,a}function o9(r){return function(t){return!t||typeof t!="object"?!1:t instanceof r?!0:t instanceof Error&&typeof t.expose=="boolean"&&typeof t.statusCode=="number"&&t.status===t.statusCode}}function i9(r,e,t){var n=X1(e);function a(s){var o=s??gl.message[t],i=new Error(o);return Error.captureStackTrace(i,a),Q1(i,a.prototype),Object.defineProperty(i,"message",{enumerable:!0,configurable:!0,value:o,writable:!0}),Object.defineProperty(i,"name",{enumerable:!1,configurable:!0,value:n,writable:!0}),i}return mE(a,r),K1(a,n),a.prototype.status=t,a.prototype.statusCode=t,a.prototype.expose=!1,a}function K1(r,e){var t=Object.getOwnPropertyDescriptor(r,"name");t&&t.configurable&&(t.value=e,Object.defineProperty(r,"name",t))}function c9(r,e,t){e.forEach(function(a){var s,o=n9(gl.message[a]);switch(J1(a)){case 400:s=s9(t,o,a);break;case 500:s=i9(t,o,a);break}s&&(r[a]=s,r[o]=s)})}function X1(r){return r.substr(-5)!=="Error"?r+"Error":r}});var Z1=H((cpe,Y1)=>{var kp=1e3,Dp=kp*60,Mp=Dp*60,Up=Mp*24,l9=Up*365.25;Y1.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return u9(r);if(t==="number"&&isNaN(r)===!1)return e.long?d9(r):p9(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function u9(r){if(r=String(r),!(r.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*l9;case"days":case"day":case"d":return t*Up;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Mp;case"minutes":case"minute":case"mins":case"min":case"m":return t*Dp;case"seconds":case"second":case"secs":case"sec":case"s":return t*kp;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function p9(r){return r>=Up?Math.round(r/Up)+"d":r>=Mp?Math.round(r/Mp)+"h":r>=Dp?Math.round(r/Dp)+"m":r>=kp?Math.round(r/kp)+"s":r+"ms"}function d9(r){return Xh(r,Up,"day")||Xh(r,Mp,"hour")||Xh(r,Dp,"minute")||Xh(r,kp,"second")||r+" ms"}function Xh(r,e,t){if(!(r<e))return r<e*1.5?Math.floor(r/e)+" "+t:Math.ceil(r/e)+" "+t+"s"}});var yE=H((Kt,e$)=>{Kt=e$.exports=gE.debug=gE.default=gE;Kt.coerce=y9;Kt.disable=f9;Kt.enable=h9;Kt.enabled=g9;Kt.humanize=Z1();Kt.names=[];Kt.skips=[];Kt.formatters={};var fE;function m9(r){var e=0,t;for(t in r)e=(e<<5)-e+r.charCodeAt(t),e|=0;return Kt.colors[Math.abs(e)%Kt.colors.length]}function gE(r){function e(){if(e.enabled){var t=e,n=+new Date,a=n-(fE||n);t.diff=a,t.prev=fE,t.curr=n,fE=n;for(var s=new Array(arguments.length),o=0;o<s.length;o++)s[o]=arguments[o];s[0]=Kt.coerce(s[0]),typeof s[0]!="string"&&s.unshift("%O");var i=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(c,p){if(c==="%%")return c;i++;var m=Kt.formatters[p];if(typeof m=="function"){var f=s[i];c=m.call(t,f),s.splice(i,1),i--}return c}),Kt.formatArgs.call(t,s);var u=e.log||Kt.log||console.log.bind(console);u.apply(t,s)}}return e.namespace=r,e.enabled=Kt.enabled(r),e.useColors=Kt.useColors(),e.color=m9(r),typeof Kt.init=="function"&&Kt.init(e),e}function h9(r){Kt.save(r),Kt.names=[],Kt.skips=[];for(var e=(typeof r=="string"?r:"").split(/[\s,]+/),t=e.length,n=0;n<t;n++)e[n]&&(r=e[n].replace(/\*/g,".*?"),r[0]==="-"?Kt.skips.push(new RegExp("^"+r.substr(1)+"$")):Kt.names.push(new RegExp("^"+r+"$")))}function f9(){Kt.enable("")}function g9(r){var e,t;for(e=0,t=Kt.skips.length;e<t;e++)if(Kt.skips[e].test(r))return!1;for(e=0,t=Kt.names.length;e<t;e++)if(Kt.names[e].test(r))return!0;return!1}function y9(r){return r instanceof Error?r.stack||r.message:r}});var n$=H((wn,r$)=>{wn=r$.exports=yE();wn.log=E9;wn.formatArgs=v9;wn.save=C9;wn.load=t$;wn.useColors=b9;wn.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:A9();wn.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function b9(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}wn.formatters.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function v9(r){var e=this.useColors;if(r[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+r[0]+(e?"%c ":" ")+"+"+wn.humanize(this.diff),!!e){var t="color: "+this.color;r.splice(1,0,t,"color: inherit");var n=0,a=0;r[0].replace(/%[a-zA-Z%]/g,function(s){s!=="%%"&&(n++,s==="%c"&&(a=n))}),r.splice(a,0,t)}}function E9(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function C9(r){try{r==null?wn.storage.removeItem("debug"):wn.storage.debug=r}catch{}}function t$(){var r;try{r=wn.storage.debug}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}wn.enable(t$());function A9(){try{return window.localStorage}catch{}}});var i$=H((en,o$)=>{var a$=require("tty"),Bp=require("util");en=o$.exports=yE();en.init=O9;en.log=I9;en.formatArgs=w9;en.save=x9;en.load=s$;en.useColors=R9;en.colors=[6,2,3,4,5,1];en.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(a,s){return s.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});var yl=parseInt(process.env.DEBUG_FD,10)||2;yl!==1&&yl!==2&&Bp.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var S9=yl===1?process.stdout:yl===2?process.stderr:T9(yl);function R9(){return"colors"in en.inspectOpts?!!en.inspectOpts.colors:a$.isatty(yl)}en.formatters.o=function(r){return this.inspectOpts.colors=this.useColors,Bp.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};en.formatters.O=function(r){return this.inspectOpts.colors=this.useColors,Bp.inspect(r,this.inspectOpts)};function w9(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,a="  \x1B[3"+n+";1m"+e+" \x1B[0m";r[0]=a+r[0].split(`
`).join(`
`+a),r.push("\x1B[3"+n+"m+"+en.humanize(this.diff)+"\x1B[0m")}else r[0]=new Date().toUTCString()+" "+e+" "+r[0]}function I9(){return S9.write(Bp.format.apply(Bp,arguments)+`
`)}function x9(r){r==null?delete process.env.DEBUG:process.env.DEBUG=r}function s$(){return process.env.DEBUG}function T9(r){var e,t=process.binding("tty_wrap");switch(t.guessHandleType(r)){case"TTY":e=new a$.WriteStream(r),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(r,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var a=require("net");e=new a.Socket({fd:r,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=r,e._isStdio=!0,e}function O9(r){r.inspectOpts={};for(var e=Object.keys(en.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=en.inspectOpts[e[t]]}en.enable(s$())});var c$=H((lpe,bE)=>{typeof process<"u"&&process.type==="renderer"?bE.exports=n$():bE.exports=i$()});var u$=H((upe,l$)=>{"use strict";l$.exports=$9;var N9=/(?:[^\x21\x25\x26-\x3B\x3D\x3F-\x5B\x5D\x5F\x61-\x7A\x7E]|%(?:[^0-9A-Fa-f]|[0-9A-Fa-f][^0-9A-Fa-f]|$))+/g,_9=/(^|[^\uD800-\uDBFF])[\uDC00-\uDFFF]|[\uD800-\uDBFF]([^\uDC00-\uDFFF]|$)/g,P9="$1\uFFFD$2";function $9(r){return String(r).replace(_9,P9).replace(N9,encodeURI)}});var vE=H((ppe,m$)=>{"use strict";m$.exports=k9;var L9=require("crypto"),p$=require("fs").Stats,d$=Object.prototype.toString;function j9(r){if(r.length===0)return'"0-2jmj7l5rSw0yVb/vlWAYkK/YBwk"';var e=L9.createHash("sha1").update(r,"utf8").digest("base64").substring(0,27),t=typeof r=="string"?Buffer.byteLength(r,"utf8"):r.length;return'"'+t.toString(16)+"-"+e+'"'}function k9(r,e){if(r==null)throw new TypeError("argument entity is required");var t=D9(r),n=e&&typeof e.weak=="boolean"?e.weak:t;if(!t&&typeof r!="string"&&!Buffer.isBuffer(r))throw new TypeError("argument entity must be string, Buffer, or fs.Stats");var a=t?M9(r):j9(r);return n?"W/"+a:a}function D9(r){return typeof p$=="function"&&r instanceof p$?!0:r&&typeof r=="object"&&"ctime"in r&&d$.call(r.ctime)==="[object Date]"&&"mtime"in r&&d$.call(r.mtime)==="[object Date]"&&"ino"in r&&typeof r.ino=="number"&&"size"in r&&typeof r.size=="number"}function M9(r){var e=r.mtime.getTime().toString(16),t=r.size.toString(16);return'"'+t+"-"+e+'"'}});var EE=H((dpe,f$)=>{"use strict";var U9=/(?:^|,)\s*?no-cache\s*?(?:,|$)/;f$.exports=B9;function B9(r,e){var t=r["if-modified-since"],n=r["if-none-match"];if(!t&&!n)return!1;var a=r["cache-control"];if(a&&U9.test(a))return!1;if(n&&n!=="*"){var s=e.etag;if(!s)return!1;for(var o=!0,i=F9(n),u=0;u<i.length;u++){var c=i[u];if(c===s||c==="W/"+s||"W/"+c===s){o=!1;break}}if(o)return!1}if(t){var p=e["last-modified"],m=!p||!(h$(p)<=h$(t));if(m)return!1}return!0}function h$(r){var e=r&&Date.parse(r);return typeof e=="number"?e:NaN}function F9(r){for(var e=0,t=[],n=0,a=0,s=r.length;a<s;a++)switch(r.charCodeAt(a)){case 32:n===e&&(n=e=a+1);break;case 44:t.push(r.substring(n,e)),n=e=a+1;break;default:e=a+1;break}return t.push(r.substring(n,e)),t}});var g$=H((mpe,q9)=>{q9.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomsvc+xml":["atomsvc"],"application/bdoc":["bdoc"],"application/ccxml+xml":["ccxml"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/font-tdpfr":["pfr"],"application/font-woff":[],"application/font-woff2":[],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/prs.cww":["cww"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["xfdf"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.apple.pkpass":["pkpass"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-apps.document":["gdoc"],"application/vnd.google-apps.presentation":["gslides"],"application/vnd.google-apps.spreadsheet":["gsheet"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.hydrostatix.sof-data":["sfd-hdstx"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-outlook":["msg"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["mpp","mpt"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.n-gage.symbian.install":["n-gage"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.wadl+xml":["wadl"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":[],"application/x-arj":["arj"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bdoc":[],"application/x-bittorrent":["torrent"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-chrome-extension":["crx"],"application/x-cocoa":["cco"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-httpd-php":["php"],"application/x-install-instructions":["install"],"application/x-iso9660-image":[],"application/x-java-archive-diff":["jardiff"],"application/x-java-jnlp-file":["jnlp"],"application/x-latex":["latex"],"application/x-lua-bytecode":["luac"],"application/x-lzh-compressed":["lzh","lha"],"application/x-makeself":["run"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdos-program":[],"application/x-msdownload":["com","bat"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["wmf","emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-ns-proxy-autoconfig":["pac"],"application/x-nzb":["nzb"],"application/x-perl":["pl","pm"],"application/x-pilot":[],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["rar"],"application/x-redhat-package-manager":["rpm"],"application/x-research-info-systems":["ris"],"application/x-sea":["sea"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl","tk"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["obj"],"application/x-ustar":["ustar"],"application/x-virtualbox-hdd":["hdd"],"application/x-virtualbox-ova":["ova"],"application/x-virtualbox-ovf":["ovf"],"application/x-virtualbox-vbox":["vbox"],"application/x-virtualbox-vbox-extpack":["vbox-extpack"],"application/x-virtualbox-vdi":["vdi"],"application/x-virtualbox-vhd":["vhd"],"application/x-virtualbox-vmdk":["vmdk"],"application/x-wais-source":["src"],"application/x-web-app-manifest+json":["webapp"],"application/x-x509-ca-cert":["der","crt","pem"],"application/x-xfig":["fig"],"application/x-xliff+xml":["xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"application/xaml+xml":["xaml"],"application/xcap-diff+xml":["xdf"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":[],"audio/adpcm":["adp"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mp3":[],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/wav":["wav"],"audio/wave":[],"audio/webm":["weba"],"audio/x-aac":["aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-m4a":[],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-realaudio":[],"audio/x-wav":[],"audio/xm":["xm"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/apng":["apng"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/g3fax":["g3"],"image/gif":["gif"],"image/ief":["ief"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/ktx":["ktx"],"image/png":["png"],"image/prs.btif":["btif"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/tiff":["tiff","tif"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":[],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/webp":["webp"],"image/x-3ds":["3ds"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["ico"],"image/x-jng":["jng"],"image/x-mrsid-image":["sid"],"image/x-ms-bmp":[],"image/x-pcx":["pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/rfc822":["eml","mime"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["mts"],"model/vnd.vtu":["vtu"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["x3db","x3dbz"],"model/x3d+vrml":["x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/hjson":["hjson"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/prs.lines.tag":["dsc"],"text/richtext":["rtx"],"text/rtf":[],"text/sgml":["sgml","sgm"],"text/slim":["slim","slm"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/vtt":["vtt"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-component":["htc"],"text/x-fortran":["f","for","f77","f90"],"text/x-handlebars-template":["hbs"],"text/x-java-source":["java"],"text/x-lua":["lua"],"text/x-markdown":["mkd"],"text/x-nfo":["nfo"],"text/x-opml":["opml"],"text/x-org":[],"text/x-pascal":["p","pas"],"text/x-processing":["pde"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-suse-ymp":["ymp"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"text/xml":[],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/jpeg":["jpgv"],"video/jpm":["jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]}});var b$=H((fpe,y$)=>{var hpe=require("path"),G9=require("fs");function vl(){this.types=Object.create(null),this.extensions=Object.create(null)}vl.prototype.define=function(r){for(var e in r){for(var t=r[e],n=0;n<t.length;n++)process.env.DEBUG_MIME&&this.types[t[n]]&&console.warn((this._loading||"define()").replace(/.*\//,""),'changes "'+t[n]+'" extension type from '+this.types[t[n]]+" to "+e),this.types[t[n]]=e;this.extensions[e]||(this.extensions[e]=t[0])}};vl.prototype.load=function(r){this._loading=r;var e={},t=G9.readFileSync(r,"ascii"),n=t.split(/[\r\n]+/);n.forEach(function(a){var s=a.replace(/\s*#.*|^\s*|\s*$/g,"").split(/\s+/);e[s.shift()]=s}),this.define(e),this._loading=null};vl.prototype.lookup=function(r,e){var t=r.replace(/^.*[\.\/\\]/,"").toLowerCase();return this.types[t]||e||this.default_type};vl.prototype.extension=function(r){var e=r.match(/^\s*([^;\s]*)(?:;|\s|$)/)[1].toLowerCase();return this.extensions[e]};var bl=new vl;bl.define(g$());bl.default_type=bl.lookup("bin");bl.Mime=vl;bl.charsets={lookup:function(r,e){return/^text\/|^application\/(javascript|json)/.test(r)?"UTF-8":e}};y$.exports=bl});var E$=H((gpe,v$)=>{var El=1e3,Cl=El*60,Al=Cl*60,_i=Al*24,V9=_i*7,z9=_i*365.25;v$.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return H9(r);if(t==="number"&&isFinite(r))return e.long?Q9(r):W9(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function H9(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*z9;case"weeks":case"week":case"w":return t*V9;case"days":case"day":case"d":return t*_i;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Al;case"minutes":case"minute":case"mins":case"min":case"m":return t*Cl;case"seconds":case"second":case"secs":case"sec":case"s":return t*El;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function W9(r){var e=Math.abs(r);return e>=_i?Math.round(r/_i)+"d":e>=Al?Math.round(r/Al)+"h":e>=Cl?Math.round(r/Cl)+"m":e>=El?Math.round(r/El)+"s":r+"ms"}function Q9(r){var e=Math.abs(r);return e>=_i?Yh(r,e,_i,"day"):e>=Al?Yh(r,e,Al,"hour"):e>=Cl?Yh(r,e,Cl,"minute"):e>=El?Yh(r,e,El,"second"):r+" ms"}function Yh(r,e,t,n){var a=e>=t*1.5;return Math.round(r/t)+" "+n+(a?"s":"")}});var CE=H((ype,C$)=>{"use strict";C$.exports=J9;function J9(r,e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");var n=e.indexOf("=");if(n===-1)return-2;var a=e.slice(n+1).split(","),s=[];s.type=e.slice(0,n);for(var o=0;o<a.length;o++){var i=a[o].split("-"),u=parseInt(i[0],10),c=parseInt(i[1],10);isNaN(u)?(u=r-c,c=r-1):isNaN(c)&&(c=r-1),c>r-1&&(c=r-1),!(isNaN(u)||isNaN(c)||u>c||u<0)&&s.push({start:u,end:c})}return s.length<1?-1:t&&t.combine?K9(s):s}function K9(r){for(var e=r.map(X9).sort(eW),t=0,n=1;n<e.length;n++){var a=e[n],s=e[t];a.start>s.end+1?e[++t]=a:a.end>s.end&&(s.end=a.end,s.index=Math.min(s.index,a.index))}e.length=t+1;var o=e.sort(Z9).map(Y9);return o.type=r.type,o}function X9(r,e){return{start:r.start,end:r.end,index:e}}function Y9(r){return{start:r.start,end:r.end}}function Z9(r,e){return r.index-e.index}function eW(r,e){return r.start-e.start}});var rf=H((bpe,xE)=>{"use strict";var AE=hE(),gr=c$()("send"),Pi=ca()("send"),tW=kb(),rW=u$(),R$=Ip(),nW=vE(),aW=EE(),ef=require("fs"),RE=b$(),w$=E$(),sW=op(),oW=CE(),Fp=require("path"),iW=xp(),I$=require("stream"),cW=require("util"),lW=Fp.extname,x$=Fp.join,SE=Fp.normalize,IE=Fp.resolve,Zh=Fp.sep,uW=/^ *bytes=/,T$=3600*24*365*1e3,A$=/(?:^|[\\/])\.\.(?:[\\/]|$)/;xE.exports=pW;xE.exports.mime=RE;function pW(r,e,t){return new Xt(r,e,t)}function Xt(r,e,t){I$.call(this);var n=t||{};if(this.options=n,this.path=e,this.req=r,this._acceptRanges=n.acceptRanges!==void 0?!!n.acceptRanges:!0,this._cacheControl=n.cacheControl!==void 0?!!n.cacheControl:!0,this._etag=n.etag!==void 0?!!n.etag:!0,this._dotfiles=n.dotfiles!==void 0?n.dotfiles:"ignore",this._dotfiles!=="ignore"&&this._dotfiles!=="allow"&&this._dotfiles!=="deny")throw new TypeError('dotfiles option must be "allow", "deny", or "ignore"');this._hidden=!!n.hidden,n.hidden!==void 0&&Pi("hidden: use dotfiles: '"+(this._hidden?"allow":"ignore")+"' instead"),n.dotfiles===void 0&&(this._dotfiles=void 0),this._extensions=n.extensions!==void 0?wE(n.extensions,"extensions option"):[],this._immutable=n.immutable!==void 0?!!n.immutable:!1,this._index=n.index!==void 0?wE(n.index,"index option"):["index.html"],this._lastModified=n.lastModified!==void 0?!!n.lastModified:!0,this._maxage=n.maxAge||n.maxage,this._maxage=typeof this._maxage=="string"?w$(this._maxage):Number(this._maxage),this._maxage=isNaN(this._maxage)?0:Math.min(Math.max(0,this._maxage),T$),this._root=n.root?IE(n.root):null,!this._root&&n.from&&this.from(n.from)}cW.inherits(Xt,I$);Xt.prototype.etag=Pi.function(function(e){return this._etag=!!e,gr("etag %s",this._etag),this},"send.etag: pass etag as option");Xt.prototype.hidden=Pi.function(function(e){return this._hidden=!!e,this._dotfiles=void 0,gr("hidden %s",this._hidden),this},"send.hidden: use dotfiles option");Xt.prototype.index=Pi.function(function(e){var t=e?wE(e,"paths argument"):[];return gr("index %o",e),this._index=t,this},"send.index: pass index as option");Xt.prototype.root=function(e){return this._root=IE(String(e)),gr("root %s",this._root),this};Xt.prototype.from=Pi.function(Xt.prototype.root,"send.from: pass root as option");Xt.prototype.root=Pi.function(Xt.prototype.root,"send.root: pass root as option");Xt.prototype.maxage=Pi.function(function(e){return this._maxage=typeof e=="string"?w$(e):Number(e),this._maxage=isNaN(this._maxage)?0:Math.min(Math.max(0,this._maxage),T$),gr("max-age %d",this._maxage),this},"send.maxage: pass maxAge as option");Xt.prototype.error=function(e,t){if(N$(this,"error"))return this.emit("error",fW(e,t));var n=this.res,a=iW.message[e]||String(e),s=O$("Error",R$(a));dW(n),t&&t.headers&&EW(n,t.headers),n.statusCode=e,n.setHeader("Content-Type","text/html; charset=UTF-8"),n.setHeader("Content-Length",Buffer.byteLength(s)),n.setHeader("Content-Security-Policy","default-src 'none'"),n.setHeader("X-Content-Type-Options","nosniff"),n.end(s)};Xt.prototype.hasTrailingSlash=function(){return this.path[this.path.length-1]==="/"};Xt.prototype.isConditionalGET=function(){return this.req.headers["if-match"]||this.req.headers["if-unmodified-since"]||this.req.headers["if-none-match"]||this.req.headers["if-modified-since"]};Xt.prototype.isPreconditionFailure=function(){var e=this.req,t=this.res,n=e.headers["if-match"];if(n){var a=t.getHeader("ETag");return!a||n!=="*"&&vW(n).every(function(i){return i!==a&&i!=="W/"+a&&"W/"+i!==a})}var s=tf(e.headers["if-unmodified-since"]);if(!isNaN(s)){var o=tf(t.getHeader("Last-Modified"));return isNaN(o)||o>s}return!1};Xt.prototype.removeContentHeaderFields=function(){var e=this.res;e.removeHeader("Content-Encoding"),e.removeHeader("Content-Language"),e.removeHeader("Content-Length"),e.removeHeader("Content-Range"),e.removeHeader("Content-Type")};Xt.prototype.notModified=function(){var e=this.res;gr("not modified"),this.removeContentHeaderFields(),e.statusCode=304,e.end()};Xt.prototype.headersAlreadySent=function(){var e=new Error("Can't set headers after they are sent.");gr("headers already sent"),this.error(500,e)};Xt.prototype.isCachable=function(){var e=this.res.statusCode;return e>=200&&e<300||e===304};Xt.prototype.onStatError=function(e){switch(e.code){case"ENAMETOOLONG":case"ENOENT":case"ENOTDIR":this.error(404,e);break;default:this.error(500,e);break}};Xt.prototype.isFresh=function(){return aW(this.req.headers,{etag:this.res.getHeader("ETag"),"last-modified":this.res.getHeader("Last-Modified")})};Xt.prototype.isRangeFresh=function(){var e=this.req.headers["if-range"];if(!e)return!0;if(e.indexOf('"')!==-1){var t=this.res.getHeader("ETag");return!!(t&&e.indexOf(t)!==-1)}var n=this.res.getHeader("Last-Modified");return tf(n)<=tf(e)};Xt.prototype.redirect=function(e){var t=this.res;if(N$(this,"directory")){this.emit("directory",t,e);return}if(this.hasTrailingSlash()){this.error(403);return}var n=rW(mW(this.path+"/")),a=O$("Redirecting","Redirecting to "+R$(n));t.statusCode=301,t.setHeader("Content-Type","text/html; charset=UTF-8"),t.setHeader("Content-Length",Buffer.byteLength(a)),t.setHeader("Content-Security-Policy","default-src 'none'"),t.setHeader("X-Content-Type-Options","nosniff"),t.setHeader("Location",n),t.end(a)};Xt.prototype.pipe=function(e){var t=this._root;this.res=e;var n=gW(this.path);if(n===-1)return this.error(400),e;if(~n.indexOf("\0"))return this.error(400),e;var a;if(t!==null){if(n&&(n=SE("."+Zh+n)),A$.test(n))return gr('malicious path "%s"',n),this.error(403),e;a=n.split(Zh),n=SE(x$(t,n))}else{if(A$.test(n))return gr('malicious path "%s"',n),this.error(403),e;a=SE(n).split(Zh),n=IE(n)}if(hW(a)){var s=this._dotfiles;switch(s===void 0&&(s=a[a.length-1][0]==="."?this._hidden?"allow":"ignore":"allow"),gr('%s dotfile "%s"',s,n),s){case"allow":break;case"deny":return this.error(403),e;case"ignore":default:return this.error(404),e}}return this._index.length&&this.hasTrailingSlash()?(this.sendIndex(n),e):(this.sendFile(n),e)};Xt.prototype.send=function(e,t){var n=t.size,a=this.options,s={},o=this.res,i=this.req,u=i.headers.range,c=a.start||0;if(bW(o)){this.headersAlreadySent();return}if(gr('pipe "%s"',e),this.setHeader(e,t),this.type(e),this.isConditionalGET()){if(this.isPreconditionFailure()){this.error(412);return}if(this.isCachable()&&this.isFresh()){this.notModified();return}}if(n=Math.max(0,n-c),a.end!==void 0){var p=a.end-c+1;n>p&&(n=p)}if(this._acceptRanges&&uW.test(u)){if(u=oW(n,u,{combine:!0}),this.isRangeFresh()||(gr("range stale"),u=-2),u===-1)return gr("range unsatisfiable"),o.setHeader("Content-Range",S$("bytes",n)),this.error(416,{headers:{"Content-Range":o.getHeader("Content-Range")}});u!==-2&&u.length===1&&(gr("range %j",u),o.statusCode=206,o.setHeader("Content-Range",S$("bytes",n,u[0])),c+=u[0].start,n=u[0].end-u[0].start+1)}for(var m in a)s[m]=a[m];if(s.start=c,s.end=Math.max(c,c+n-1),o.setHeader("Content-Length",n),i.method==="HEAD"){o.end();return}this.stream(e,s)};Xt.prototype.sendFile=function(e){var t=0,n=this;gr('stat "%s"',e),ef.stat(e,function(o,i){if(o&&o.code==="ENOENT"&&!lW(e)&&e[e.length-1]!==Zh)return a(o);if(o)return n.onStatError(o);if(i.isDirectory())return n.redirect(e);n.emit("file",e,i),n.send(e,i)});function a(s){if(n._extensions.length<=t)return s?n.onStatError(s):n.error(404);var o=e+"."+n._extensions[t++];gr('stat "%s"',o),ef.stat(o,function(i,u){if(i)return a(i);if(u.isDirectory())return a();n.emit("file",o,u),n.send(o,u)})}};Xt.prototype.sendIndex=function(e){var t=-1,n=this;function a(s){if(++t>=n._index.length)return s?n.onStatError(s):n.error(404);var o=x$(e,n._index[t]);gr('stat "%s"',o),ef.stat(o,function(i,u){if(i)return a(i);if(u.isDirectory())return a();n.emit("file",o,u),n.send(o,u)})}a()};Xt.prototype.stream=function(e,t){var n=this,a=this.res,s=ef.createReadStream(e,t);this.emit("stream",s),s.pipe(a);function o(){tW(s,!0)}sW(a,o),s.on("error",function(u){o(),n.onStatError(u)}),s.on("end",function(){n.emit("end")})};Xt.prototype.type=function(e){var t=this.res;if(!t.getHeader("Content-Type")){var n=RE.lookup(e);if(!n){gr("no content-type");return}var a=RE.charsets.lookup(n);gr("content-type %s",n),t.setHeader("Content-Type",n+(a?"; charset="+a:""))}};Xt.prototype.setHeader=function(e,t){var n=this.res;if(this.emit("headers",n,e,t),this._acceptRanges&&!n.getHeader("Accept-Ranges")&&(gr("accept ranges"),n.setHeader("Accept-Ranges","bytes")),this._cacheControl&&!n.getHeader("Cache-Control")){var a="public, max-age="+Math.floor(this._maxage/1e3);this._immutable&&(a+=", immutable"),gr("cache-control %s",a),n.setHeader("Cache-Control",a)}if(this._lastModified&&!n.getHeader("Last-Modified")){var s=t.mtime.toUTCString();gr("modified %s",s),n.setHeader("Last-Modified",s)}if(this._etag&&!n.getHeader("ETag")){var o=nW(t);gr("etag %s",o),n.setHeader("ETag",o)}};function dW(r){for(var e=yW(r),t=0;t<e.length;t++)r.removeHeader(e[t])}function mW(r){for(var e=0;e<r.length&&r[e]==="/";e++);return e>1?"/"+r.substr(e):r}function hW(r){for(var e=0;e<r.length;e++){var t=r[e];if(t.length>1&&t[0]===".")return!0}return!1}function S$(r,e,t){return r+" "+(t?t.start+"-"+t.end:"*")+"/"+e}function O$(r,e){return`<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>`+r+`</title>
</head>
<body>
<pre>`+e+`</pre>
</body>
</html>
`}function fW(r,e){return e?e instanceof Error?AE(r,e,{expose:!1}):AE(r,e):AE(r)}function gW(r){try{return decodeURIComponent(r)}catch{return-1}}function yW(r){return typeof r.getHeaderNames!="function"?Object.keys(r._headers||{}):r.getHeaderNames()}function N$(r,e){var t=typeof r.listenerCount!="function"?r.listeners(e).length:r.listenerCount(e);return t>0}function bW(r){return typeof r.headersSent!="boolean"?!!r._header:r.headersSent}function wE(r,e){for(var t=[].concat(r||[]),n=0;n<t.length;n++)if(typeof t[n]!="string")throw new TypeError(e+" must be array of strings or false");return t}function tf(r){var e=r&&Date.parse(r);return typeof e=="number"?e:NaN}function vW(r){for(var e=0,t=[],n=0,a=0,s=r.length;a<s;a++)switch(r.charCodeAt(a)){case 32:n===e&&(n=e=a+1);break;case 44:n!==e&&t.push(r.substring(n,e)),n=e=a+1;break;default:e=a+1;break}return n!==e&&t.push(r.substring(n,e)),t}function EW(r,e){for(var t=Object.keys(e),n=0;n<t.length;n++){var a=t[n];r.setHeader(a,e[a])}}});var P$=H((vpe,_$)=>{"use strict";_$.exports=CW;function CW(r){if(!r)throw new TypeError("argument req is required");var e=SW(r.headers["x-forwarded-for"]||""),t=AW(r),n=[t].concat(e);return n}function AW(r){return r.socket?r.socket.remoteAddress:r.connection.remoteAddress}function SW(r){for(var e=r.length,t=[],n=r.length,a=r.length-1;a>=0;a--)switch(r.charCodeAt(a)){case 32:n===e&&(n=e=a);break;case 44:n!==e&&t.push(r.substring(n,e)),n=e=a;break;default:n=a;break}return n!==e&&t.push(r.substring(n,e)),t}});var L$=H(($$,qp)=>{(function(){var r,e,t,n,a,s,o,i,u;e={},i=this,typeof qp<"u"&&qp!==null&&qp.exports?qp.exports=e:i.ipaddr=e,o=function(c,p,m,f){var g,y;if(c.length!==p.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");for(g=0;f>0;){if(y=m-f,y<0&&(y=0),c[g]>>y!==p[g]>>y)return!1;f-=m,g+=1}return!0},e.subnetMatch=function(c,p,m){var f,g,y,C,A;m==null&&(m="unicast");for(y in p)for(C=p[y],C[0]&&!(C[0]instanceof Array)&&(C=[C]),f=0,g=C.length;f<g;f++)if(A=C[f],c.kind()===A[0].kind()&&c.match.apply(c,A))return y;return m},e.IPv4=(function(){function c(p){var m,f,g;if(p.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");for(m=0,f=p.length;m<f;m++)if(g=p[m],!(0<=g&&g<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=p}return c.prototype.kind=function(){return"ipv4"},c.prototype.toString=function(){return this.octets.join(".")},c.prototype.toNormalizedString=function(){return this.toString()},c.prototype.toByteArray=function(){return this.octets.slice(0)},c.prototype.match=function(p,m){var f;if(m===void 0&&(f=p,p=f[0],m=f[1]),p.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return o(this.octets,p.octets,8,m)},c.prototype.SpecialRanges={unspecified:[[new c([0,0,0,0]),8]],broadcast:[[new c([255,255,255,255]),32]],multicast:[[new c([224,0,0,0]),4]],linkLocal:[[new c([169,254,0,0]),16]],loopback:[[new c([127,0,0,0]),8]],carrierGradeNat:[[new c([100,64,0,0]),10]],private:[[new c([10,0,0,0]),8],[new c([172,16,0,0]),12],[new c([192,168,0,0]),16]],reserved:[[new c([192,0,0,0]),24],[new c([192,0,2,0]),24],[new c([192,88,99,0]),24],[new c([198,51,100,0]),24],[new c([203,0,113,0]),24],[new c([240,0,0,0]),4]]},c.prototype.range=function(){return e.subnetMatch(this,this.SpecialRanges)},c.prototype.toIPv4MappedAddress=function(){return e.IPv6.parse("::ffff:"+this.toString())},c.prototype.prefixLengthFromSubnetMask=function(){var p,m,f,g,y,C,A;for(A={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},p=0,y=!1,m=f=3;f>=0;m=f+=-1)if(g=this.octets[m],g in A){if(C=A[g],y&&C!==0)return null;C!==8&&(y=!0),p+=C}else return null;return 32-p},c})(),t="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp("^"+t+"\\."+t+"\\."+t+"\\."+t+"$","i"),longValue:new RegExp("^"+t+"$","i")},e.IPv4.parser=function(c){var p,m,f,g,y;if(m=function(C){return C[0]==="0"&&C[1]!=="x"?parseInt(C,8):parseInt(C)},p=c.match(n.fourOctet))return(function(){var C,A,T,E;for(T=p.slice(1,6),E=[],C=0,A=T.length;C<A;C++)f=T[C],E.push(m(f));return E})();if(p=c.match(n.longValue)){if(y=m(p[1]),y>4294967295||y<0)throw new Error("ipaddr: address outside defined range");return(function(){var C,A;for(A=[],g=C=0;C<=24;g=C+=8)A.push(y>>g&255);return A})().reverse()}else return null},e.IPv6=(function(){function c(p,m){var f,g,y,C,A,T;if(p.length===16)for(this.parts=[],f=g=0;g<=14;f=g+=2)this.parts.push(p[f]<<8|p[f+1]);else if(p.length===8)this.parts=p;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(T=this.parts,y=0,C=T.length;y<C;y++)if(A=T[y],!(0<=A&&A<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");m&&(this.zoneId=m)}return c.prototype.kind=function(){return"ipv6"},c.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},c.prototype.toRFC5952String=function(){var p,m,f,g,y;for(g=/((^|:)(0(:|$)){2,})/g,y=this.toNormalizedString(),p=0,m=-1;f=g.exec(y);)f[0].length>m&&(p=f.index,m=f[0].length);return m<0?y:y.substring(0,p)+"::"+y.substring(p+m)},c.prototype.toByteArray=function(){var p,m,f,g,y;for(p=[],y=this.parts,m=0,f=y.length;m<f;m++)g=y[m],p.push(g>>8),p.push(g&255);return p},c.prototype.toNormalizedString=function(){var p,m,f;return p=(function(){var g,y,C,A;for(C=this.parts,A=[],g=0,y=C.length;g<y;g++)m=C[g],A.push(m.toString(16));return A}).call(this).join(":"),f="",this.zoneId&&(f="%"+this.zoneId),p+f},c.prototype.toFixedLengthString=function(){var p,m,f;return p=(function(){var g,y,C,A;for(C=this.parts,A=[],g=0,y=C.length;g<y;g++)m=C[g],A.push(m.toString(16).padStart(4,"0"));return A}).call(this).join(":"),f="",this.zoneId&&(f="%"+this.zoneId),p+f},c.prototype.match=function(p,m){var f;if(m===void 0&&(f=p,p=f[0],m=f[1]),p.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return o(this.parts,p.parts,16,m)},c.prototype.SpecialRanges={unspecified:[new c([0,0,0,0,0,0,0,0]),128],linkLocal:[new c([65152,0,0,0,0,0,0,0]),10],multicast:[new c([65280,0,0,0,0,0,0,0]),8],loopback:[new c([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new c([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new c([0,0,0,0,0,65535,0,0]),96],rfc6145:[new c([0,0,0,0,65535,0,0,0]),96],rfc6052:[new c([100,65435,0,0,0,0,0,0]),96],"6to4":[new c([8194,0,0,0,0,0,0,0]),16],teredo:[new c([8193,0,0,0,0,0,0,0]),32],reserved:[[new c([8193,3512,0,0,0,0,0,0]),32]]},c.prototype.range=function(){return e.subnetMatch(this,this.SpecialRanges)},c.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},c.prototype.toIPv4Address=function(){var p,m,f;if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");return f=this.parts.slice(-2),p=f[0],m=f[1],new e.IPv4([p>>8,p&255,m>>8,m&255])},c.prototype.prefixLengthFromSubnetMask=function(){var p,m,f,g,y,C,A;for(A={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},p=0,y=!1,m=f=7;f>=0;m=f+=-1)if(g=this.parts[m],g in A){if(C=A[g],y&&C!==0)return null;C!==16&&(y=!0),p+=C}else return null;return 128-p},c})(),a="(?:[0-9a-f]+::?)+",u="%[0-9a-z]{1,}",s={zoneIndex:new RegExp(u,"i"),native:new RegExp("^(::)?("+a+")?([0-9a-f]+)?(::)?("+u+")?$","i"),transitional:new RegExp("^((?:"+a+")|(?:::)(?:"+a+")?)"+(t+"\\."+t+"\\."+t+"\\."+t)+("("+u+")?$"),"i")},r=function(c,p){var m,f,g,y,C,A;if(c.indexOf("::")!==c.lastIndexOf("::"))return null;for(A=(c.match(s.zoneIndex)||[])[0],A&&(A=A.substring(1),c=c.replace(/%.+$/,"")),m=0,f=-1;(f=c.indexOf(":",f+1))>=0;)m++;if(c.substr(0,2)==="::"&&m--,c.substr(-2,2)==="::"&&m--,m>p)return null;for(C=p-m,y=":";C--;)y+="0:";return c=c.replace("::",y),c[0]===":"&&(c=c.slice(1)),c[c.length-1]===":"&&(c=c.slice(0,-1)),p=(function(){var T,E,d,l;for(d=c.split(":"),l=[],T=0,E=d.length;T<E;T++)g=d[T],l.push(parseInt(g,16));return l})(),{parts:p,zoneId:A}},e.IPv6.parser=function(c){var p,m,f,g,y,C,A;if(s.native.test(c))return r(c,8);if((g=c.match(s.transitional))&&(A=g[6]||"",p=r(g[1].slice(0,-1)+A,6),p.parts)){for(C=[parseInt(g[2]),parseInt(g[3]),parseInt(g[4]),parseInt(g[5])],m=0,f=C.length;m<f;m++)if(y=C[m],!(0<=y&&y<=255))return null;return p.parts.push(C[0]<<8|C[1]),p.parts.push(C[2]<<8|C[3]),{parts:p.parts,zoneId:p.zoneId}}return null},e.IPv4.isIPv4=e.IPv6.isIPv6=function(c){return this.parser(c)!==null},e.IPv4.isValid=function(c){var p;try{return new this(this.parser(c)),!0}catch(m){return p=m,!1}},e.IPv4.isValidFourPartDecimal=function(c){return!!(e.IPv4.isValid(c)&&c.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},e.IPv6.isValid=function(c){var p,m;if(typeof c=="string"&&c.indexOf(":")===-1)return!1;try{return p=this.parser(c),new this(p.parts,p.zoneId),!0}catch(f){return m=f,!1}},e.IPv4.parse=function(c){var p;if(p=this.parser(c),p===null)throw new Error("ipaddr: string is not formatted like ip address");return new this(p)},e.IPv6.parse=function(c){var p;if(p=this.parser(c),p.parts===null)throw new Error("ipaddr: string is not formatted like ip address");return new this(p.parts,p.zoneId)},e.IPv4.parseCIDR=function(c){var p,m,f;if((m=c.match(/^(.+)\/(\d+)$/))&&(p=parseInt(m[2]),p>=0&&p<=32))return f=[this.parse(m[1]),p],Object.defineProperty(f,"toString",{value:function(){return this.join("/")}}),f;throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},e.IPv4.subnetMaskFromPrefixLength=function(c){var p,m,f;if(c=parseInt(c),c<0||c>32)throw new Error("ipaddr: invalid IPv4 prefix length");for(f=[0,0,0,0],m=0,p=Math.floor(c/8);m<p;)f[m]=255,m++;return p<4&&(f[p]=Math.pow(2,c%8)-1<<8-c%8),new this(f)},e.IPv4.broadcastAddressFromCIDR=function(c){var p,m,f,g,y,C;try{for(p=this.parseCIDR(c),g=p[0].toByteArray(),C=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),y=[],f=0;f<4;)y.push(parseInt(g[f],10)|parseInt(C[f],10)^255),f++;return new this(y)}catch(A){throw m=A,new Error("ipaddr: the address does not have IPv4 CIDR format")}},e.IPv4.networkAddressFromCIDR=function(c){var p,m,f,g,y,C;try{for(p=this.parseCIDR(c),g=p[0].toByteArray(),C=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),y=[],f=0;f<4;)y.push(parseInt(g[f],10)&parseInt(C[f],10)),f++;return new this(y)}catch(A){throw m=A,new Error("ipaddr: the address does not have IPv4 CIDR format")}},e.IPv6.parseCIDR=function(c){var p,m,f;if((m=c.match(/^(.+)\/(\d+)$/))&&(p=parseInt(m[2]),p>=0&&p<=128))return f=[this.parse(m[1]),p],Object.defineProperty(f,"toString",{value:function(){return this.join("/")}}),f;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},e.isValid=function(c){return e.IPv6.isValid(c)||e.IPv4.isValid(c)},e.parse=function(c){if(e.IPv6.isValid(c))return e.IPv6.parse(c);if(e.IPv4.isValid(c))return e.IPv4.parse(c);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},e.parseCIDR=function(c){var p;try{return e.IPv6.parseCIDR(c)}catch(m){p=m;try{return e.IPv4.parseCIDR(c)}catch(f){throw p=f,new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},e.fromByteArray=function(c){var p;if(p=c.length,p===4)return new e.IPv4(c);if(p===16)return new e.IPv6(c);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},e.process=function(c){var p;return p=this.parse(c),p.kind()==="ipv6"&&p.isIPv4MappedAddress()?p.toIPv4Address():p}}).call($$)});var TE=H((Epe,sf)=>{"use strict";sf.exports=NW;sf.exports.all=D$;sf.exports.compile=M$;var RW=P$(),k$=L$(),wW=/^[0-9]+$/,nf=k$.isValid,af=k$.parse,j$={linklocal:["169.254.0.0/16","fe80::/10"],loopback:["127.0.0.1/8","::1/128"],uniquelocal:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","fc00::/7"]};function D$(r,e){var t=RW(r);if(!e)return t;typeof e!="function"&&(e=M$(e));for(var n=0;n<t.length-1;n++)e(t[n],n)||(t.length=n+1);return t}function M$(r){if(!r)throw new TypeError("argument is required");var e;if(typeof r=="string")e=[r];else if(Array.isArray(r))e=r.slice();else throw new TypeError("unsupported trust argument");for(var t=0;t<e.length;t++)r=e[t],Object.prototype.hasOwnProperty.call(j$,r)&&(r=j$[r],e.splice.apply(e,[t,1].concat(r)),t+=r.length-1);return xW(IW(e))}function IW(r){for(var e=new Array(r.length),t=0;t<r.length;t++)e[t]=TW(r[t]);return e}function xW(r){var e=r.length;return e===0?_W:e===1?$W(r[0]):PW(r)}function TW(r){var e=r.lastIndexOf("/"),t=e!==-1?r.substring(0,e):r;if(!nf(t))throw new TypeError("invalid IP address: "+t);var n=af(t);e===-1&&n.kind()==="ipv6"&&n.isIPv4MappedAddress()&&(n=n.toIPv4Address());var a=n.kind()==="ipv6"?128:32,s=e!==-1?r.substring(e+1,r.length):null;if(s===null?s=a:wW.test(s)?s=parseInt(s,10):n.kind()==="ipv4"&&nf(s)?s=OW(s):s=null,s<=0||s>a)throw new TypeError("invalid range on address: "+r);return[n,s]}function OW(r){var e=af(r),t=e.kind();return t==="ipv4"?e.prefixLengthFromSubnetMask():null}function NW(r,e){if(!r)throw new TypeError("req argument is required");if(!e)throw new TypeError("trust argument is required");var t=D$(r,e),n=t[t.length-1];return n}function _W(){return!1}function PW(r){return function(t){if(!nf(t))return!1;for(var n=af(t),a,s=n.kind(),o=0;o<r.length;o++){var i=r[o],u=i[0],c=u.kind(),p=i[1],m=n;if(s!==c){if(c==="ipv4"&&!n.isIPv4MappedAddress())continue;a||(a=c==="ipv4"?n.toIPv4Address():n.toIPv4MappedAddress()),m=a}if(m.match(u,p))return!0}return!1}}function $W(r){var e=r[0],t=e.kind(),n=t==="ipv4",a=r[1];return function(o){if(!nf(o))return!1;var i=af(o),u=i.kind();if(u!==t){if(n&&!i.isIPv4MappedAddress())return!1;i=n?i.toIPv4Address():i.toIPv4MappedAddress()}return i.match(e,a)}}});var Io=H(In=>{"use strict";var U$=Jh().Buffer,LW=dE(),B$=Ku(),F$=ca()("express"),jW=$p(),kW=rf().mime,DW=vE(),MW=TE(),UW=Dh(),BW=require("querystring");In.etag=q$({weak:!1});In.wetag=q$({weak:!0});In.isAbsolute=function(r){if(r[0]==="/"||r[1]===":"&&(r[2]==="\\"||r[2]==="/")||r.substring(0,2)==="\\\\")return!0};In.flatten=F$.function(jW,"utils.flatten: use array-flatten npm module instead");In.normalizeType=function(r){return~r.indexOf("/")?FW(r):{value:kW.lookup(r),params:{}}};In.normalizeTypes=function(r){for(var e=[],t=0;t<r.length;++t)e.push(In.normalizeType(r[t]));return e};In.contentDisposition=F$.function(LW,"utils.contentDisposition: use content-disposition npm module instead");function FW(r){for(var e=r.split(/ *; */),t={value:e[0],quality:1,params:{}},n=1;n<e.length;++n){var a=e[n].split(/ *= */);a[0]==="q"?t.quality=parseFloat(a[1]):t.params[a[0]]=a[1]}return t}In.compileETag=function(r){var e;if(typeof r=="function")return r;switch(r){case!0:case"weak":e=In.wetag;break;case!1:break;case"strong":e=In.etag;break;default:throw new TypeError("unknown value for etag function: "+r)}return e};In.compileQueryParser=function(e){var t;if(typeof e=="function")return e;switch(e){case!0:case"simple":t=BW.parse;break;case!1:t=GW;break;case"extended":t=qW;break;default:throw new TypeError("unknown value for query parser function: "+e)}return t};In.compileTrust=function(r){return typeof r=="function"?r:r===!0?function(){return!0}:typeof r=="number"?function(e,t){return t<r}:(typeof r=="string"&&(r=r.split(",").map(function(e){return e.trim()})),MW.compile(r||[]))};In.setCharset=function(e,t){if(!e||!t)return e;var n=B$.parse(e);return n.parameters.charset=t,B$.format(n)};function q$(r){return function(t,n){var a=U$.isBuffer(t)?t:U$.from(t,n);return DW(a,r)}}function qW(r){return UW.parse(r,{allowPrototypes:!0})}function GW(){return{}}});var z$=H((G$,V$)=>{"use strict";var VW=YP(),zW=cE(),NE=Vh(),HW=L1(),WW=lE(),of=ml()("express:application"),QW=B1(),JW=require("http"),KW=Io().compileETag,XW=Io().compileQueryParser,YW=Io().compileTrust,ZW=ca()("express"),eQ=$p(),OE=Lp(),tQ=require("path").resolve,Sl=fi(),rQ=Object.prototype.hasOwnProperty,PE=Array.prototype.slice,Dr=G$=V$.exports={},_E="@@symbol:trust_proxy_default";Dr.init=function(){this.cache={},this.engines={},this.settings={},this.defaultConfiguration()};Dr.defaultConfiguration=function(){var e="production";this.enable("x-powered-by"),this.set("etag","weak"),this.set("env",e),this.set("query parser","extended"),this.set("subdomain offset",2),this.set("trust proxy",!1),Object.defineProperty(this.settings,_E,{configurable:!0,value:!0}),of("booting in %s mode",e),this.on("mount",function(n){this.settings[_E]===!0&&typeof n.settings["trust proxy fn"]=="function"&&(delete this.settings["trust proxy"],delete this.settings["trust proxy fn"]),Sl(this.request,n.request),Sl(this.response,n.response),Sl(this.engines,n.engines),Sl(this.settings,n.settings)}),this.locals=Object.create(null),this.mountpath="/",this.locals.settings=this.settings,this.set("view",QW),this.set("views",tQ("views")),this.set("jsonp callback name","callback"),e==="production"&&this.enable("view cache"),Object.defineProperty(this,"router",{get:function(){throw new Error(`'app.router' is deprecated!
Please see the 3.x to 4.x migration guide for details on how to update your app.`)}})};Dr.lazyrouter=function(){this._router||(this._router=new zW({caseSensitive:this.enabled("case sensitive routing"),strict:this.enabled("strict routing")}),this._router.use(WW(this.get("query parser fn"))),this._router.use(HW.init(this)))};Dr.handle=function(e,t,n){var a=this._router,s=n||VW(e,t,{env:this.get("env"),onerror:nQ.bind(this)});if(!a){of("no routes defined on app"),s();return}a.handle(e,t,s)};Dr.use=function(e){var t=0,n="/";if(typeof e!="function"){for(var a=e;Array.isArray(a)&&a.length!==0;)a=a[0];typeof a!="function"&&(t=1,n=e)}var s=eQ(PE.call(arguments,t));if(s.length===0)throw new TypeError("app.use() requires a middleware function");this.lazyrouter();var o=this._router;return s.forEach(function(i){if(!i||!i.handle||!i.set)return o.use(n,i);of(".use app under %s",n),i.mountpath=n,i.parent=this,o.use(n,function(c,p,m){var f=c.app;i.handle(c,p,function(g){Sl(c,f.request),Sl(p,f.response),m(g)})}),i.emit("mount",this)},this),this};Dr.route=function(e){return this.lazyrouter(),this._router.route(e)};Dr.engine=function(e,t){if(typeof t!="function")throw new Error("callback function required");var n=e[0]!=="."?"."+e:e;return this.engines[n]=t,this};Dr.param=function(e,t){if(this.lazyrouter(),Array.isArray(e)){for(var n=0;n<e.length;n++)this.param(e[n],t);return this}return this._router.param(e,t),this};Dr.set=function(e,t){if(arguments.length===1){for(var n=this.settings;n&&n!==Object.prototype;){if(rQ.call(n,e))return n[e];n=Object.getPrototypeOf(n)}return}switch(of('set "%s" to %o',e,t),this.settings[e]=t,e){case"etag":this.set("etag fn",KW(t));break;case"query parser":this.set("query parser fn",XW(t));break;case"trust proxy":this.set("trust proxy fn",YW(t)),Object.defineProperty(this.settings,_E,{configurable:!0,value:!1});break}return this};Dr.path=function(){return this.parent?this.parent.path()+this.mountpath:""};Dr.enabled=function(e){return!!this.set(e)};Dr.disabled=function(e){return!this.set(e)};Dr.enable=function(e){return this.set(e,!0)};Dr.disable=function(e){return this.set(e,!1)};NE.forEach(function(r){Dr[r]=function(e){if(r==="get"&&arguments.length===1)return this.set(e);this.lazyrouter();var t=this._router.route(e);return t[r].apply(t,PE.call(arguments,1)),this}});Dr.all=function(e){this.lazyrouter();for(var t=this._router.route(e),n=PE.call(arguments,1),a=0;a<NE.length;a++)t[NE[a]].apply(t,n);return this};Dr.del=ZW.function(Dr.delete,"app.del: Use app.delete instead");Dr.render=function(e,t,n){var a=this.cache,s=n,o=this.engines,i=t,u={},c;if(typeof t=="function"&&(s=t,i={}),OE(u,this.locals),i._locals&&OE(u,i._locals),OE(u,i),u.cache==null&&(u.cache=this.enabled("view cache")),u.cache&&(c=a[e]),!c){var p=this.get("view");if(c=new p(e,{defaultEngine:this.get("view engine"),root:this.get("views"),engines:o}),!c.path){var m=Array.isArray(c.root)&&c.root.length>1?'directories "'+c.root.slice(0,-1).join('", "')+'" or "'+c.root[c.root.length-1]+'"':'directory "'+c.root+'"',f=new Error('Failed to lookup view "'+e+'" in views '+m);return f.view=c,s(f)}u.cache&&(a[e]=c)}aQ(c,u,s)};Dr.listen=function(){var e=JW.createServer(this);return e.listen.apply(e,arguments)};function nQ(r){this.get("env")!=="test"&&console.error(r.stack||r.toString())}function aQ(r,e,t){try{r.render(e,t)}catch(n){t(n)}}});var J$=H((Ape,$E)=>{"use strict";$E.exports=Q$;$E.exports.preferredCharsets=Q$;var sQ=/^\s*([^\s;]+)\s*(?:;(.*))?$/;function oQ(r){for(var e=r.split(","),t=0,n=0;t<e.length;t++){var a=iQ(e[t].trim(),t);a&&(e[n++]=a)}return e.length=n,e}function iQ(r,e){var t=sQ.exec(r);if(!t)return null;var n=t[1],a=1;if(t[2])for(var s=t[2].split(";"),o=0;o<s.length;o++){var i=s[o].trim().split("=");if(i[0]==="q"){a=parseFloat(i[1]);break}}return{charset:n,q:a,i:e}}function cQ(r,e,t){for(var n={o:-1,q:0,s:0},a=0;a<e.length;a++){var s=lQ(r,e[a],t);s&&(n.s-s.s||n.q-s.q||n.o-s.o)<0&&(n=s)}return n}function lQ(r,e,t){var n=0;if(e.charset.toLowerCase()===r.toLowerCase())n|=1;else if(e.charset!=="*")return null;return{i:t,o:e.i,q:e.q,s:n}}function Q$(r,e){var t=oQ(r===void 0?"*":r||"");if(!e)return t.filter(W$).sort(H$).map(uQ);var n=e.map(function(s,o){return cQ(s,t,o)});return n.filter(W$).sort(H$).map(function(s){return e[n.indexOf(s)]})}function H$(r,e){return e.q-r.q||e.s-r.s||r.o-e.o||r.i-e.i||0}function uQ(r){return r.charset}function W$(r){return r.q>0}});var eL=H((Spe,LE)=>{"use strict";LE.exports=Z$;LE.exports.preferredEncodings=Z$;var pQ=/^\s*([^\s;]+)\s*(?:;(.*))?$/;function dQ(r){for(var e=r.split(","),t=!1,n=1,a=0,s=0;a<e.length;a++){var o=mQ(e[a].trim(),a);o&&(e[s++]=o,t=t||Y$("identity",o),n=Math.min(n,o.q||1))}return t||(e[s++]={encoding:"identity",q:n,i:a}),e.length=s,e}function mQ(r,e){var t=pQ.exec(r);if(!t)return null;var n=t[1],a=1;if(t[2])for(var s=t[2].split(";"),o=0;o<s.length;o++){var i=s[o].trim().split("=");if(i[0]==="q"){a=parseFloat(i[1]);break}}return{encoding:n,q:a,i:e}}function hQ(r,e,t){for(var n={o:-1,q:0,s:0},a=0;a<e.length;a++){var s=Y$(r,e[a],t);s&&(n.s-s.s||n.q-s.q||n.o-s.o)<0&&(n=s)}return n}function Y$(r,e,t){var n=0;if(e.encoding.toLowerCase()===r.toLowerCase())n|=1;else if(e.encoding!=="*")return null;return{i:t,o:e.i,q:e.q,s:n}}function Z$(r,e){var t=dQ(r||"");if(!e)return t.filter(X$).sort(K$).map(fQ);var n=e.map(function(s,o){return hQ(s,t,o)});return n.filter(X$).sort(K$).map(function(s){return e[n.indexOf(s)]})}function K$(r,e){return e.q-r.q||e.s-r.s||r.o-e.o||r.i-e.i||0}function fQ(r){return r.encoding}function X$(r){return r.q>0}});var sL=H((Rpe,jE)=>{"use strict";jE.exports=aL;jE.exports.preferredLanguages=aL;var gQ=/^\s*([^\s\-;]+)(?:-([^\s;]+))?\s*(?:;(.*))?$/;function yQ(r){for(var e=r.split(","),t=0,n=0;t<e.length;t++){var a=nL(e[t].trim(),t);a&&(e[n++]=a)}return e.length=n,e}function nL(r,e){var t=gQ.exec(r);if(!t)return null;var n=t[1],a=t[2],s=n;a&&(s+="-"+a);var o=1;if(t[3])for(var i=t[3].split(";"),u=0;u<i.length;u++){var c=i[u].split("=");c[0]==="q"&&(o=parseFloat(c[1]))}return{prefix:n,suffix:a,q:o,i:e,full:s}}function bQ(r,e,t){for(var n={o:-1,q:0,s:0},a=0;a<e.length;a++){var s=vQ(r,e[a],t);s&&(n.s-s.s||n.q-s.q||n.o-s.o)<0&&(n=s)}return n}function vQ(r,e,t){var n=nL(r);if(!n)return null;var a=0;if(e.full.toLowerCase()===n.full.toLowerCase())a|=4;else if(e.prefix.toLowerCase()===n.full.toLowerCase())a|=2;else if(e.full.toLowerCase()===n.prefix.toLowerCase())a|=1;else if(e.full!=="*")return null;return{i:t,o:e.i,q:e.q,s:a}}function aL(r,e){var t=yQ(r===void 0?"*":r||"");if(!e)return t.filter(rL).sort(tL).map(EQ);var n=e.map(function(s,o){return bQ(s,t,o)});return n.filter(rL).sort(tL).map(function(s){return e[n.indexOf(s)]})}function tL(r,e){return e.q-r.q||e.s-r.s||r.o-e.o||r.i-e.i||0}function EQ(r){return r.full}function rL(r){return r.q>0}});var pL=H((wpe,kE)=>{"use strict";kE.exports=lL;kE.exports.preferredMediaTypes=lL;var CQ=/^\s*([^\s\/;]+)\/([^;\s]+)\s*(?:;(.*))?$/;function AQ(r){for(var e=xQ(r),t=0,n=0;t<e.length;t++){var a=cL(e[t].trim(),t);a&&(e[n++]=a)}return e.length=n,e}function cL(r,e){var t=CQ.exec(r);if(!t)return null;var n=Object.create(null),a=1,s=t[2],o=t[1];if(t[3])for(var i=TQ(t[3]).map(IQ),u=0;u<i.length;u++){var c=i[u],p=c[0].toLowerCase(),m=c[1],f=m&&m[0]==='"'&&m[m.length-1]==='"'?m.substr(1,m.length-2):m;if(p==="q"){a=parseFloat(f);break}n[p]=f}return{type:o,subtype:s,params:n,q:a,i:e}}function SQ(r,e,t){for(var n={o:-1,q:0,s:0},a=0;a<e.length;a++){var s=RQ(r,e[a],t);s&&(n.s-s.s||n.q-s.q||n.o-s.o)<0&&(n=s)}return n}function RQ(r,e,t){var n=cL(r),a=0;if(!n)return null;if(e.type.toLowerCase()==n.type.toLowerCase())a|=4;else if(e.type!="*")return null;if(e.subtype.toLowerCase()==n.subtype.toLowerCase())a|=2;else if(e.subtype!="*")return null;var s=Object.keys(e.params);if(s.length>0)if(s.every(function(o){return e.params[o]=="*"||(e.params[o]||"").toLowerCase()==(n.params[o]||"").toLowerCase()}))a|=1;else return null;return{i:t,o:e.i,q:e.q,s:a}}function lL(r,e){var t=AQ(r===void 0?"*/*":r||"");if(!e)return t.filter(iL).sort(oL).map(wQ);var n=e.map(function(s,o){return SQ(s,t,o)});return n.filter(iL).sort(oL).map(function(s){return e[n.indexOf(s)]})}function oL(r,e){return e.q-r.q||e.s-r.s||r.o-e.o||r.i-e.i||0}function wQ(r){return r.type+"/"+r.subtype}function iL(r){return r.q>0}function uL(r){for(var e=0,t=0;(t=r.indexOf('"',t))!==-1;)e++,t++;return e}function IQ(r){var e=r.indexOf("="),t,n;return e===-1?t=r:(t=r.substr(0,e),n=r.substr(e+1)),[t,n]}function xQ(r){for(var e=r.split(","),t=1,n=0;t<e.length;t++)uL(e[n])%2==0?e[++n]=e[t]:e[n]+=","+e[t];return e.length=n+1,e}function TQ(r){for(var e=r.split(";"),t=1,n=0;t<e.length;t++)uL(e[n])%2==0?e[++n]=e[t]:e[n]+=";"+e[t];e.length=n+1;for(var t=0;t<e.length;t++)e[t]=e[t].trim();return e}});var dL=H((Ipe,DE)=>{"use strict";var OQ=J$(),NQ=eL(),_Q=sL(),PQ=pL();DE.exports=nr;DE.exports.Negotiator=nr;function nr(r){if(!(this instanceof nr))return new nr(r);this.request=r}nr.prototype.charset=function(e){var t=this.charsets(e);return t&&t[0]};nr.prototype.charsets=function(e){return OQ(this.request.headers["accept-charset"],e)};nr.prototype.encoding=function(e){var t=this.encodings(e);return t&&t[0]};nr.prototype.encodings=function(e){return NQ(this.request.headers["accept-encoding"],e)};nr.prototype.language=function(e){var t=this.languages(e);return t&&t[0]};nr.prototype.languages=function(e){return _Q(this.request.headers["accept-language"],e)};nr.prototype.mediaType=function(e){var t=this.mediaTypes(e);return t&&t[0]};nr.prototype.mediaTypes=function(e){return PQ(this.request.headers.accept,e)};nr.prototype.preferredCharset=nr.prototype.charset;nr.prototype.preferredCharsets=nr.prototype.charsets;nr.prototype.preferredEncoding=nr.prototype.encoding;nr.prototype.preferredEncodings=nr.prototype.encodings;nr.prototype.preferredLanguage=nr.prototype.language;nr.prototype.preferredLanguages=nr.prototype.languages;nr.prototype.preferredMediaType=nr.prototype.mediaType;nr.prototype.preferredMediaTypes=nr.prototype.mediaTypes});var hL=H((xpe,mL)=>{"use strict";var $Q=dL(),LQ=gv();mL.exports=Wn;function Wn(r){if(!(this instanceof Wn))return new Wn(r);this.headers=r.headers,this.negotiator=new $Q(r)}Wn.prototype.type=Wn.prototype.types=function(r){var e=r;if(e&&!Array.isArray(e)){e=new Array(arguments.length);for(var t=0;t<e.length;t++)e[t]=arguments[t]}if(!e||e.length===0)return this.negotiator.mediaTypes();if(!this.headers.accept)return e[0];var n=e.map(jQ),a=this.negotiator.mediaTypes(n.filter(kQ)),s=a[0];return s?e[n.indexOf(s)]:!1};Wn.prototype.encoding=Wn.prototype.encodings=function(r){var e=r;if(e&&!Array.isArray(e)){e=new Array(arguments.length);for(var t=0;t<e.length;t++)e[t]=arguments[t]}return!e||e.length===0?this.negotiator.encodings():this.negotiator.encodings(e)[0]||!1};Wn.prototype.charset=Wn.prototype.charsets=function(r){var e=r;if(e&&!Array.isArray(e)){e=new Array(arguments.length);for(var t=0;t<e.length;t++)e[t]=arguments[t]}return!e||e.length===0?this.negotiator.charsets():this.negotiator.charsets(e)[0]||!1};Wn.prototype.lang=Wn.prototype.langs=Wn.prototype.language=Wn.prototype.languages=function(r){var e=r;if(e&&!Array.isArray(e)){e=new Array(arguments.length);for(var t=0;t<e.length;t++)e[t]=arguments[t]}return!e||e.length===0?this.negotiator.languages():this.negotiator.languages(e)[0]||!1};function jQ(r){return r.indexOf("/")===-1?LQ.lookup(r):r}function kQ(r){return typeof r=="string"}});var yL=H((Tpe,gL)=>{"use strict";var cf=hL(),Gp=ca()("express"),DQ=require("net").isIP,MQ=Si(),UQ=require("http"),BQ=EE(),FQ=CE(),qQ=pl(),fL=TE(),sr=Object.create(UQ.IncomingMessage.prototype);gL.exports=sr;sr.get=sr.header=function(e){if(!e)throw new TypeError("name argument is required to req.get");if(typeof e!="string")throw new TypeError("name must be a string to req.get");var t=e.toLowerCase();switch(t){case"referer":case"referrer":return this.headers.referrer||this.headers.referer;default:return this.headers[t]}};sr.accepts=function(){var r=cf(this);return r.types.apply(r,arguments)};sr.acceptsEncodings=function(){var r=cf(this);return r.encodings.apply(r,arguments)};sr.acceptsEncoding=Gp.function(sr.acceptsEncodings,"req.acceptsEncoding: Use acceptsEncodings instead");sr.acceptsCharsets=function(){var r=cf(this);return r.charsets.apply(r,arguments)};sr.acceptsCharset=Gp.function(sr.acceptsCharsets,"req.acceptsCharset: Use acceptsCharsets instead");sr.acceptsLanguages=function(){var r=cf(this);return r.languages.apply(r,arguments)};sr.acceptsLanguage=Gp.function(sr.acceptsLanguages,"req.acceptsLanguage: Use acceptsLanguages instead");sr.range=function(e,t){var n=this.get("Range");if(n)return FQ(e,n,t)};sr.param=function(e,t){var n=this.params||{},a=this.body||{},s=this.query||{},o=arguments.length===1?"name":"name, default";return Gp("req.param("+o+"): Use req.params, req.body, or req.query instead"),n[e]!=null&&n.hasOwnProperty(e)?n[e]:a[e]!=null?a[e]:s[e]!=null?s[e]:t};sr.is=function(e){var t=e;if(!Array.isArray(e)){t=new Array(arguments.length);for(var n=0;n<t.length;n++)t[n]=arguments[n]}return MQ(this,t)};ja(sr,"protocol",function(){var e=this.connection.encrypted?"https":"http",t=this.app.get("trust proxy fn");if(!t(this.connection.remoteAddress,0))return e;var n=this.get("X-Forwarded-Proto")||e,a=n.indexOf(",");return a!==-1?n.substring(0,a).trim():n.trim()});ja(sr,"secure",function(){return this.protocol==="https"});ja(sr,"ip",function(){var e=this.app.get("trust proxy fn");return fL(this,e)});ja(sr,"ips",function(){var e=this.app.get("trust proxy fn"),t=fL.all(this,e);return t.reverse().pop(),t});ja(sr,"subdomains",function(){var e=this.hostname;if(!e)return[];var t=this.app.get("subdomain offset"),n=DQ(e)?[e]:e.split(".").reverse();return n.slice(t)});ja(sr,"path",function(){return qQ(this).pathname});ja(sr,"hostname",function(){var e=this.app.get("trust proxy fn"),t=this.get("X-Forwarded-Host");if(!t||!e(this.connection.remoteAddress,0)?t=this.get("Host"):t.indexOf(",")!==-1&&(t=t.substring(0,t.indexOf(",")).trimRight()),!!t){var n=t[0]==="["?t.indexOf("]")+1:0,a=t.indexOf(":",n);return a!==-1?t.substring(0,a):t}});ja(sr,"host",Gp.function(function(){return this.hostname},"req.host: Use req.hostname instead"));ja(sr,"fresh",function(){var r=this.method,e=this.res,t=e.statusCode;return r!=="GET"&&r!=="HEAD"?!1:t>=200&&t<300||t===304?BQ(this.headers,{etag:e.get("ETag"),"last-modified":e.get("Last-Modified")}):!1});ja(sr,"stale",function(){return!this.fresh});ja(sr,"xhr",function(){var e=this.get("X-Requested-With")||"";return e.toLowerCase()==="xmlhttprequest"});function ja(r,e,t){Object.defineProperty(r,e,{configurable:!0,enumerable:!0,get:t})}});var EL=H(lf=>{var vL=require("crypto");lf.sign=function(r,e){if(typeof r!="string")throw new TypeError("Cookie value must be provided as a string.");if(typeof e!="string")throw new TypeError("Secret string must be provided.");return r+"."+vL.createHmac("sha256",e).update(r).digest("base64").replace(/\=+$/,"")};lf.unsign=function(r,e){if(typeof r!="string")throw new TypeError("Signed cookie string must be provided.");if(typeof e!="string")throw new TypeError("Secret string must be provided.");var t=r.slice(0,r.lastIndexOf(".")),n=lf.sign(t,e);return bL(n)==bL(r)?t:!1};function bL(r){return vL.createHash("sha1").update(r).digest("hex")}});var SL=H(ME=>{"use strict";ME.parse=JQ;ME.serialize=KQ;var GQ=Object.prototype.toString,VQ=Object.prototype.hasOwnProperty,zQ=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,HQ=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,WQ=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,QQ=/^[\u0020-\u003A\u003D-\u007E]*$/;function JQ(r,e){if(typeof r!="string")throw new TypeError("argument str must be a string");var t={},n=r.length;if(n<2)return t;var a=e&&e.decode||XQ,s=0,o=0,i=0;do{if(o=r.indexOf("=",s),o===-1)break;if(i=r.indexOf(";",s),i===-1)i=n;else if(o>i){s=r.lastIndexOf(";",o-1)+1;continue}var u=CL(r,s,o),c=AL(r,o,u),p=r.slice(u,c);if(!VQ.call(t,p)){var m=CL(r,o+1,i),f=AL(r,i,m);r.charCodeAt(m)===34&&r.charCodeAt(f-1)===34&&(m++,f--);var g=r.slice(m,f);t[p]=ZQ(g,a)}s=i+1}while(s<n);return t}function CL(r,e,t){do{var n=r.charCodeAt(e);if(n!==32&&n!==9)return e}while(++e<t);return t}function AL(r,e,t){for(;e>t;){var n=r.charCodeAt(--e);if(n!==32&&n!==9)return e+1}return t}function KQ(r,e,t){var n=t&&t.encode||encodeURIComponent;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!zQ.test(r))throw new TypeError("argument name is invalid");var a=n(e);if(!HQ.test(a))throw new TypeError("argument val is invalid");var s=r+"="+a;if(!t)return s;if(t.maxAge!=null){var o=Math.floor(t.maxAge);if(!isFinite(o))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+o}if(t.domain){if(!WQ.test(t.domain))throw new TypeError("option domain is invalid");s+="; Domain="+t.domain}if(t.path){if(!QQ.test(t.path))throw new TypeError("option path is invalid");s+="; Path="+t.path}if(t.expires){var i=t.expires;if(!YQ(i)||isNaN(i.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+i.toUTCString()}if(t.httpOnly&&(s+="; HttpOnly"),t.secure&&(s+="; Secure"),t.partitioned&&(s+="; Partitioned"),t.priority){var u=typeof t.priority=="string"?t.priority.toLowerCase():t.priority;switch(u){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(t.sameSite){var c=typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite;switch(c){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return s}function XQ(r){return r.indexOf("%")!==-1?decodeURIComponent(r):r}function YQ(r){return GQ.call(r)==="[object Date]"}function ZQ(r,e){try{return e(r)}catch{return r}}});var IL=H((_pe,UE)=>{"use strict";UE.exports=t7;UE.exports.append=wL;var e7=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/;function wL(r,e){if(typeof r!="string")throw new TypeError("header argument is required");if(!e)throw new TypeError("field argument is required");for(var t=Array.isArray(e)?e:RL(String(e)),n=0;n<t.length;n++)if(!e7.test(t[n]))throw new TypeError("field argument contains an invalid header name");if(r==="*")return r;var a=r,s=RL(r.toLowerCase());if(t.indexOf("*")!==-1||s.indexOf("*")!==-1)return"*";for(var o=0;o<t.length;o++){var i=t[o].toLowerCase();s.indexOf(i)===-1&&(s.push(i),a=a?a+", "+t[o]:t[o])}return a}function RL(r){for(var e=0,t=[],n=0,a=0,s=r.length;a<s;a++)switch(r.charCodeAt(a)){case 32:n===e&&(n=e=a+1);break;case 44:t.push(r.substring(n,e)),n=e=a+1;break;default:e=a+1;break}return t.push(r.substring(n,e)),t}function t7(r,e){if(!r||!r.getHeader||!r.setHeader)throw new TypeError("res argument is required");var t=r.getHeader("Vary")||"",n=Array.isArray(t)?t.join(", "):String(t);(t=wL(n,e))&&r.setHeader("Vary",t)}});var LL=H((Ppe,$L)=>{"use strict";var Vp=Jh().Buffer,xL=dE(),r7=hE(),Ln=ca()("express"),n7=Fh(),a7=Ip(),s7=require("http"),o7=Io().isAbsolute,i7=op(),TL=require("path"),uf=xp(),OL=Lp(),c7=EL().sign,l7=Io().normalizeType,u7=Io().normalizeTypes,p7=Io().setCharset,d7=SL(),BE=rf(),m7=TL.extname,NL=BE.mime,h7=TL.resolve,f7=IL(),lr=Object.create(s7.ServerResponse.prototype);$L.exports=lr;var g7=/;\s*charset\s*=/;lr.status=function(e){return(typeof e=="string"||Math.floor(e)!==e)&&e>99&&e<1e3&&Ln("res.status("+JSON.stringify(e)+"): use res.status("+Math.floor(e)+") instead"),this.statusCode=e,this};lr.links=function(r){var e=this.get("Link")||"";return e&&(e+=", "),this.set("Link",e+Object.keys(r).map(function(t){return"<"+r[t]+'>; rel="'+t+'"'}).join(", "))};lr.send=function(e){var t=e,n,a=this.req,s,o=this.app;switch(arguments.length===2&&(typeof arguments[0]!="number"&&typeof arguments[1]=="number"?(Ln("res.send(body, status): Use res.status(status).send(body) instead"),this.statusCode=arguments[1]):(Ln("res.send(status, body): Use res.status(status).send(body) instead"),this.statusCode=arguments[0],t=arguments[1])),typeof t=="number"&&arguments.length===1&&(this.get("Content-Type")||this.type("txt"),Ln("res.send(status): Use res.sendStatus(status) instead"),this.statusCode=t,t=uf.message[t]),typeof t){case"string":this.get("Content-Type")||this.type("html");break;case"boolean":case"number":case"object":if(t===null)t="";else if(Vp.isBuffer(t))this.get("Content-Type")||this.type("bin");else return this.json(t);break}typeof t=="string"&&(n="utf8",s=this.get("Content-Type"),typeof s=="string"&&this.set("Content-Type",p7(s,"utf-8")));var i=o.get("etag fn"),u=!this.get("ETag")&&typeof i=="function",c;t!==void 0&&(Vp.isBuffer(t)?c=t.length:!u&&t.length<1e3?c=Vp.byteLength(t,n):(t=Vp.from(t,n),n=void 0,c=t.length),this.set("Content-Length",c));var p;return u&&c!==void 0&&(p=i(t,n))&&this.set("ETag",p),a.fresh&&(this.statusCode=304),(this.statusCode===204||this.statusCode===304)&&(this.removeHeader("Content-Type"),this.removeHeader("Content-Length"),this.removeHeader("Transfer-Encoding"),t=""),this.statusCode===205&&(this.set("Content-Length","0"),this.removeHeader("Transfer-Encoding"),t=""),a.method==="HEAD"?this.end():this.end(t,n),this};lr.json=function(e){var t=e;arguments.length===2&&(typeof arguments[1]=="number"?(Ln("res.json(obj, status): Use res.status(status).json(obj) instead"),this.statusCode=arguments[1]):(Ln("res.json(status, obj): Use res.status(status).json(obj) instead"),this.statusCode=arguments[0],t=arguments[1]));var n=this.app,a=n.get("json escape"),s=n.get("json replacer"),o=n.get("json spaces"),i=PL(t,s,o,a);return this.get("Content-Type")||this.set("Content-Type","application/json"),this.send(i)};lr.jsonp=function(e){var t=e;arguments.length===2&&(typeof arguments[1]=="number"?(Ln("res.jsonp(obj, status): Use res.status(status).jsonp(obj) instead"),this.statusCode=arguments[1]):(Ln("res.jsonp(status, obj): Use res.status(status).jsonp(obj) instead"),this.statusCode=arguments[0],t=arguments[1]));var n=this.app,a=n.get("json escape"),s=n.get("json replacer"),o=n.get("json spaces"),i=PL(t,s,o,a),u=this.req.query[n.get("jsonp callback name")];return this.get("Content-Type")||(this.set("X-Content-Type-Options","nosniff"),this.set("Content-Type","application/json")),Array.isArray(u)&&(u=u[0]),typeof u=="string"&&u.length!==0&&(this.set("X-Content-Type-Options","nosniff"),this.set("Content-Type","text/javascript"),u=u.replace(/[^\[\]\w$.]/g,""),i===void 0?i="":typeof i=="string"&&(i=i.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")),i="/**/ typeof "+u+" === 'function' && "+u+"("+i+");"),this.send(i)};lr.sendStatus=function(e){var t=uf.message[e]||String(e);return this.statusCode=e,this.type("txt"),this.send(t)};lr.sendFile=function(e,t,n){var a=n,s=this.req,o=this,i=s.next,u=t||{};if(!e)throw new TypeError("path argument is required to res.sendFile");if(typeof e!="string")throw new TypeError("path must be a string to res.sendFile");if(typeof t=="function"&&(a=t,u={}),!u.root&&!o7(e))throw new TypeError("path must be absolute or specify root to res.sendFile");var c=encodeURI(e),p=BE(s,c,u);_L(o,p,u,function(m){if(a)return a(m);if(m&&m.code==="EISDIR")return i();m&&m.code!=="ECONNABORTED"&&m.syscall!=="write"&&i(m)})};lr.sendfile=function(r,e,t){var n=t,a=this.req,s=this,o=a.next,i=e||{};typeof e=="function"&&(n=e,i={});var u=BE(a,r,i);_L(s,u,i,function(c){if(n)return n(c);if(c&&c.code==="EISDIR")return o();c&&c.code!=="ECONNABORTED"&&c.syscall!=="write"&&o(c)})};lr.sendfile=Ln.function(lr.sendfile,"res.sendfile: Use res.sendFile instead");lr.download=function(e,t,n,a){var s=a,o=t,i=n||null;typeof t=="function"?(s=t,o=null,i=null):typeof n=="function"&&(s=n,i=null),typeof t=="object"&&(typeof n=="function"||n===void 0)&&(o=null,i=t);var u={"Content-Disposition":xL(o||e)};if(i&&i.headers)for(var c=Object.keys(i.headers),p=0;p<c.length;p++){var m=c[p];m.toLowerCase()!=="content-disposition"&&(u[m]=i.headers[m])}i=Object.create(i),i.headers=u;var f=i.root?e:h7(e);return this.sendFile(f,i,s)};lr.contentType=lr.type=function(e){var t=e.indexOf("/")===-1?NL.lookup(e):e;return this.set("Content-Type",t)};lr.format=function(r){var e=this.req,t=e.next,n=Object.keys(r).filter(function(s){return s!=="default"}),a=n.length>0?e.accepts(n):!1;return this.vary("Accept"),a?(this.set("Content-Type",l7(a).value),r[a](e,this,t)):r.default?r.default(e,this,t):t(r7(406,{types:u7(n).map(function(s){return s.value})})),this};lr.attachment=function(e){return e&&this.type(m7(e)),this.set("Content-Disposition",xL(e)),this};lr.append=function(e,t){var n=this.get(e),a=t;return n&&(a=Array.isArray(n)?n.concat(t):Array.isArray(t)?[n].concat(t):[n,t]),this.set(e,a)};lr.set=lr.header=function(e,t){if(arguments.length===2){var n=Array.isArray(t)?t.map(String):String(t);if(e.toLowerCase()==="content-type"){if(Array.isArray(n))throw new TypeError("Content-Type cannot be set to an Array");if(!g7.test(n)){var a=NL.charsets.lookup(n.split(";")[0]);a&&(n+="; charset="+a.toLowerCase())}}this.setHeader(e,n)}else for(var s in e)this.set(s,e[s]);return this};lr.get=function(r){return this.getHeader(r)};lr.clearCookie=function(e,t){t&&(t.maxAge&&Ln('res.clearCookie: Passing "options.maxAge" is deprecated. In v5.0.0 of Express, this option will be ignored, as res.clearCookie will automatically set cookies to expire immediately. Please update your code to omit this option.'),t.expires&&Ln('res.clearCookie: Passing "options.expires" is deprecated. In v5.0.0 of Express, this option will be ignored, as res.clearCookie will automatically set cookies to expire immediately. Please update your code to omit this option.'));var n=OL({expires:new Date(1),path:"/"},t);return this.cookie(e,"",n)};lr.cookie=function(r,e,t){var n=OL({},t),a=this.req.secret,s=n.signed;if(s&&!a)throw new Error('cookieParser("secret") required for signed cookies');var o=typeof e=="object"?"j:"+JSON.stringify(e):String(e);if(s&&(o="s:"+c7(o,a)),n.maxAge!=null){var i=n.maxAge-0;isNaN(i)||(n.expires=new Date(Date.now()+i),n.maxAge=Math.floor(i/1e3))}return n.path==null&&(n.path="/"),this.append("Set-Cookie",d7.serialize(r,String(o),n)),this};lr.location=function(e){var t;return e==="back"?(Ln('res.location("back"): use res.location(req.get("Referrer") || "/") and refer to https://dub.sh/security-redirect for best practices'),t=this.req.get("Referrer")||"/"):t=String(e),this.set("Location",n7(t))};lr.redirect=function(e){var t=e,n,a=302;arguments.length===2&&(typeof arguments[0]=="number"?(a=arguments[0],t=arguments[1]):(Ln("res.redirect(url, status): Use res.redirect(status, url) instead"),a=arguments[1])),t=this.location(t).get("Location"),this.format({text:function(){n=uf.message[a]+". Redirecting to "+t},html:function(){var s=a7(t);n="<p>"+uf.message[a]+". Redirecting to "+s+"</p>"},default:function(){n=""}}),this.statusCode=a,this.set("Content-Length",Vp.byteLength(n)),this.req.method==="HEAD"?this.end():this.end(n)};lr.vary=function(r){return!r||Array.isArray(r)&&!r.length?(Ln("res.vary(): Provide a field name"),this):(f7(this,r),this)};lr.render=function(e,t,n){var a=this.req.app,s=n,o=t||{},i=this.req,u=this;typeof t=="function"&&(s=t,o={}),o._locals=u.locals,s=s||function(c,p){if(c)return i.next(c);u.send(p)},a.render(e,o,s)};function _L(r,e,t,n){var a=!1,s;function o(){if(!a){a=!0;var g=new Error("Request aborted");g.code="ECONNABORTED",n(g)}}function i(){if(!a){a=!0;var g=new Error("EISDIR, read");g.code="EISDIR",n(g)}}function u(g){a||(a=!0,n(g))}function c(){a||(a=!0,n())}function p(){s=!1}function m(g){if(g&&g.code==="ECONNRESET")return o();if(g)return u(g);a||setImmediate(function(){if(s!==!1&&!a){o();return}a||(a=!0,n())})}function f(){s=!0}e.on("directory",i),e.on("end",c),e.on("error",u),e.on("file",p),e.on("stream",f),i7(r,m),t.headers&&e.on("headers",function(y){for(var C=t.headers,A=Object.keys(C),T=0;T<A.length;T++){var E=A[T];y.setHeader(E,C[E])}}),e.pipe(r)}function PL(r,e,t,n){var a=e||t?JSON.stringify(r,e,t):JSON.stringify(r);return n&&typeof a=="string"&&(a=a.replace(/[<>&]/g,function(s){switch(s.charCodeAt(0)){case 60:return"\\u003c";case 62:return"\\u003e";case 38:return"\\u0026";default:return s}})),a}});var kL=H(($pe,qE)=>{"use strict";var y7=Fh(),b7=Ip(),FE=pl(),v7=require("path").resolve,jL=rf(),E7=require("url");qE.exports=C7;qE.exports.mime=jL.mime;function C7(r,e){if(!r)throw new TypeError("root path required");if(typeof r!="string")throw new TypeError("root path must be a string");var t=Object.create(e||null),n=t.fallthrough!==!1,a=t.redirect!==!1,s=t.setHeaders;if(s&&typeof s!="function")throw new TypeError("option setHeaders must be function");t.maxage=t.maxage||t.maxAge||0,t.root=v7(r);var o=a?w7():R7();return function(u,c,p){if(u.method!=="GET"&&u.method!=="HEAD"){if(n)return p();c.statusCode=405,c.setHeader("Allow","GET, HEAD"),c.setHeader("Content-Length","0"),c.end();return}var m=!n,f=FE.original(u),g=FE(u).pathname;g==="/"&&f.pathname.substr(-1)!=="/"&&(g="");var y=jL(u,g,t);y.on("directory",o),s&&y.on("headers",s),n&&y.on("file",function(){m=!0}),y.on("error",function(A){if(m||!(A.statusCode<500)){p(A);return}p()}),y.pipe(c)}}function A7(r){for(var e=0;e<r.length&&r.charCodeAt(e)===47;e++);return e>1?"/"+r.substr(e):r}function S7(r,e){return`<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>`+r+`</title>
</head>
<body>
<pre>`+e+`</pre>
</body>
</html>
`}function R7(){return function(){this.error(404)}}function w7(){return function(e){if(this.hasTrailingSlash()){this.error(404);return}var t=FE.original(this.req);t.path=null,t.pathname=A7(t.pathname+"/");var n=y7(E7.format(t)),a=S7("Redirecting","Redirecting to "+b7(n));e.statusCode=301,e.setHeader("Content-Type","text/html; charset=UTF-8"),e.setHeader("Content-Length",Buffer.byteLength(a)),e.setHeader("Content-Security-Policy","default-src 'none'"),e.setHeader("X-Content-Type-Options","nosniff"),e.setHeader("Location",n),e.end(a)}}});var qL=H((jn,FL)=>{"use strict";var pf=RP(),I7=require("events").EventEmitter,DL=IP(),ML=z$(),x7=oE(),T7=cE(),UL=yL(),BL=LL();jn=FL.exports=O7;function O7(){var r=function(e,t,n){r.handle(e,t,n)};return DL(r,I7.prototype,!1),DL(r,ML,!1),r.request=Object.create(UL,{app:{configurable:!0,enumerable:!0,writable:!0,value:r}}),r.response=Object.create(BL,{app:{configurable:!0,enumerable:!0,writable:!0,value:r}}),r.init(),r}jn.application=ML;jn.request=UL;jn.response=BL;jn.Route=x7;jn.Router=T7;jn.json=pf.json;jn.query=lE();jn.raw=pf.raw;jn.static=kL();jn.text=pf.text;jn.urlencoded=pf.urlencoded;var N7=["bodyParser","compress","cookieSession","session","logger","cookieParser","favicon","responseTime","errorHandler","timeout","methodOverride","vhost","csrf","directory","limit","multipart","staticCache"];N7.forEach(function(r){Object.defineProperty(jn,r,{get:function(){throw new Error("Most middleware (like "+r+") is no longer bundled with Express and must be installed separately. Please see https://github.com/senchalabs/connect#middleware.")},configurable:!0})})});var GE=H((Lpe,GL)=>{"use strict";GL.exports=qL()});var zE=H(VL=>{"use strict";VL.parse=function(r,e){return new VE(r,e).parse()};var VE=class r{constructor(e,t){this.source=e,this.transform=t||_7,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,n,a;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!a)this.dimension++,this.dimension>1&&(n=new r(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(t.value==="}"&&!a){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(a&&this.newEntry(!0),a=!a):t.value===","&&!a?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function _7(r){return r}});var HE=H((kpe,zL)=>{var P7=zE();zL.exports={create:function(r,e){return{parse:function(){return P7.parse(r,e)}}}}});var QL=H((Dpe,WL)=>{"use strict";var $7=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,L7=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,j7=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,k7=/^-?infinity$/;WL.exports=function(e){if(k7.test(e))return Number(e.replace("i","I"));var t=$7.exec(e);if(!t)return D7(e)||null;var n=!!t[8],a=parseInt(t[1],10);n&&(a=HL(a));var s=parseInt(t[2],10)-1,o=t[3],i=parseInt(t[4],10),u=parseInt(t[5],10),c=parseInt(t[6],10),p=t[7];p=p?1e3*parseFloat(p):0;var m,f=M7(e);return f!=null?(m=new Date(Date.UTC(a,s,o,i,u,c,p)),WE(a)&&m.setUTCFullYear(a),f!==0&&m.setTime(m.getTime()-f)):(m=new Date(a,s,o,i,u,c,p),WE(a)&&m.setFullYear(a)),m};function D7(r){var e=L7.exec(r);if(e){var t=parseInt(e[1],10),n=!!e[4];n&&(t=HL(t));var a=parseInt(e[2],10)-1,s=e[3],o=new Date(t,a,s);return WE(t)&&o.setFullYear(t),o}}function M7(r){if(r.endsWith("+00"))return 0;var e=j7.exec(r.split(" ")[1]);if(e){var t=e[1];if(t==="Z")return 0;var n=t==="-"?-1:1,a=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return a*n*1e3}}function HL(r){return-(r-1)}function WE(r){return r>=0&&r<100}});var KL=H((Mpe,JL)=>{JL.exports=B7;var U7=Object.prototype.hasOwnProperty;function B7(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)U7.call(t,n)&&(r[n]=t[n])}return r}});var ZL=H((Upe,YL)=>{"use strict";var F7=KL();YL.exports=Rl;function Rl(r){if(!(this instanceof Rl))return new Rl(r);F7(this,Z7(r))}var q7=["seconds","minutes","hours","days","months","years"];Rl.prototype.toPostgres=function(){var r=q7.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var G7={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},V7=["years","months","days"],z7=["hours","minutes","seconds"];Rl.prototype.toISOString=Rl.prototype.toISO=function(){var r=V7.map(t,this).join(""),e=z7.map(t,this).join("");return"P"+r+"T"+e;function t(n){var a=this[n]||0;return n==="seconds"&&this.milliseconds&&(a=(a+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),a+G7[n]}};var QE="([+-]?\\d+)",H7=QE+"\\s+years?",W7=QE+"\\s+mons?",Q7=QE+"\\s+days?",J7="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",K7=new RegExp([H7,W7,Q7,J7].map(function(r){return"("+r+")?"}).join("\\s*")),XL={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},X7=["hours","minutes","seconds","milliseconds"];function Y7(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function Z7(r){if(!r)return{};var e=K7.exec(r),t=e[8]==="-";return Object.keys(XL).reduce(function(n,a){var s=XL[a],o=e[s];return!o||(o=a==="milliseconds"?Y7(o):parseInt(o,10),!o)||(t&&~X7.indexOf(a)&&(o*=-1),n[a]=o),n},{})}});var tj=H((Bpe,ej)=>{"use strict";ej.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",n=0;n<e.length;)if(e[n]!=="\\")t+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))t+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var a=1;n+a<e.length&&e[n+a]==="\\";)a++;for(var s=0;s<Math.floor(a/2);++s)t+="\\";n+=Math.floor(a/2)*2}return new Buffer(t,"binary")}});var cj=H((Fpe,ij)=>{var zp=zE(),Hp=HE(),df=QL(),nj=ZL(),aj=tj();function mf(r){return function(t){return t===null?t:r(t)}}function sj(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function eJ(r){return r?zp.parse(r,sj):null}function tJ(r){return parseInt(r,10)}function JE(r){return r?zp.parse(r,mf(tJ)):null}function rJ(r){return r?zp.parse(r,mf(function(e){return oj(e).trim()})):null}var nJ=function(r){if(!r)return null;var e=Hp.create(r,function(t){return t!==null&&(t=ZE(t)),t});return e.parse()},KE=function(r){if(!r)return null;var e=Hp.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},da=function(r){if(!r)return null;var e=Hp.create(r);return e.parse()},XE=function(r){if(!r)return null;var e=Hp.create(r,function(t){return t!==null&&(t=df(t)),t});return e.parse()},aJ=function(r){if(!r)return null;var e=Hp.create(r,function(t){return t!==null&&(t=nj(t)),t});return e.parse()},sJ=function(r){return r?zp.parse(r,mf(aj)):null},YE=function(r){return parseInt(r,10)},oj=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},rj=function(r){return r?zp.parse(r,mf(JSON.parse)):null},ZE=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},oJ=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",n=!1,a=2;a<r.length-1;a++){if(n||(e+=r[a]),r[a]===")"){n=!0;continue}else if(!n)continue;r[a]!==","&&(t+=r[a])}var s=ZE(e);return s.radius=parseFloat(t),s},iJ=function(r){r(20,oj),r(21,YE),r(23,YE),r(26,YE),r(700,parseFloat),r(701,parseFloat),r(16,sj),r(1082,df),r(1114,df),r(1184,df),r(600,ZE),r(651,da),r(718,oJ),r(1e3,eJ),r(1001,sJ),r(1005,JE),r(1007,JE),r(1028,JE),r(1016,rJ),r(1017,nJ),r(1021,KE),r(1022,KE),r(1231,KE),r(1014,da),r(1015,da),r(1008,da),r(1009,da),r(1040,da),r(1041,da),r(1115,XE),r(1182,XE),r(1185,XE),r(1186,nj),r(1187,aJ),r(17,aj),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,rj),r(3807,rj),r(3907,da),r(2951,da),r(791,da),r(1183,da),r(1270,da)};ij.exports={init:iJ}});var uj=H((qpe,lj)=>{"use strict";var kn=1e6;function cJ(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),n="";e<0&&(e=~e+(t===0),t=~t+1>>>0,n="-");var a="",s,o,i,u,c,p;{if(s=e%kn,e=e/kn>>>0,o=4294967296*s+t,t=o/kn>>>0,i=""+(o-kn*t),t===0&&e===0)return n+i+a;for(u="",c=6-i.length,p=0;p<c;p++)u+="0";a=u+i+a}{if(s=e%kn,e=e/kn>>>0,o=4294967296*s+t,t=o/kn>>>0,i=""+(o-kn*t),t===0&&e===0)return n+i+a;for(u="",c=6-i.length,p=0;p<c;p++)u+="0";a=u+i+a}{if(s=e%kn,e=e/kn>>>0,o=4294967296*s+t,t=o/kn>>>0,i=""+(o-kn*t),t===0&&e===0)return n+i+a;for(u="",c=6-i.length,p=0;p<c;p++)u+="0";a=u+i+a}return s=e%kn,o=4294967296*s+t,i=""+o%kn,n+i+a}lj.exports=cJ});var fj=H((Gpe,hj)=>{var lJ=uj(),yr=function(r,e,t,n,a){t=t||0,n=n||!1,a=a||function(g,y,C){return g*Math.pow(2,C)+y};var s=t>>3,o=function(g){return n?~g&255:g},i=255,u=8-t%8;e<u&&(i=255<<8-e&255,u=e),t&&(i=i>>t%8);var c=0;t%8+e>=8&&(c=a(0,o(r[s])&i,u));for(var p=e+t>>3,m=s+1;m<p;m++)c=a(c,o(r[m]),8);var f=(e+t)%8;return f>0&&(c=a(c,o(r[p])>>8-f,f)),c},mj=function(r,e,t){var n=Math.pow(2,t-1)-1,a=yr(r,1),s=yr(r,t,1);if(s===0)return 0;var o=1,i=function(c,p,m){c===0&&(c=1);for(var f=1;f<=m;f++)o/=2,(p&1<<m-f)>0&&(c+=o);return c},u=yr(r,e,t+1,!1,i);return s==Math.pow(2,t+1)-1?u===0?a===0?1/0:-1/0:NaN:(a===0?1:-1)*Math.pow(2,s-n)*u},uJ=function(r){return yr(r,1)==1?-1*(yr(r,15,1,!0)+1):yr(r,15,1)},pj=function(r){return yr(r,1)==1?-1*(yr(r,31,1,!0)+1):yr(r,31,1)},pJ=function(r){return mj(r,23,8)},dJ=function(r){return mj(r,52,11)},mJ=function(r){var e=yr(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,yr(r,16,16)),n=0,a=[],s=yr(r,16),o=0;o<s;o++)n+=yr(r,16,64+16*o)*t,t/=1e4;var i=Math.pow(10,yr(r,16,48));return(e===0?1:-1)*Math.round(n*i)/i},dj=function(r,e){var t=yr(e,1),n=yr(e,63,1),a=new Date((t===0?1:-1)*n/1e3+9466848e5);return r||a.setTime(a.getTime()+a.getTimezoneOffset()*6e4),a.usec=n%1e3,a.getMicroSeconds=function(){return this.usec},a.setMicroSeconds=function(s){this.usec=s},a.getUTCMicroSeconds=function(){return this.usec},a},Wp=function(r){for(var e=yr(r,32),t=yr(r,32,32),n=yr(r,32,64),a=96,s=[],o=0;o<e;o++)s[o]=yr(r,32,a),a+=32,a+=32;var i=function(c){var p=yr(r,32,a);if(a+=32,p==4294967295)return null;var m;if(c==23||c==20)return m=yr(r,p*8,a),a+=p*8,m;if(c==25)return m=r.toString(this.encoding,a>>3,(a+=p<<3)>>3),m;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,p){var m=[],f;if(c.length>1){var g=c.shift();for(f=0;f<g;f++)m[f]=u(c,p);c.unshift(g)}else for(f=0;f<c[0];f++)m[f]=i(p);return m};return u(s,n)},hJ=function(r){return r.toString("utf8")},fJ=function(r){return r===null?null:yr(r,8)>0},gJ=function(r){r(20,lJ),r(21,uJ),r(23,pj),r(26,pj),r(1700,mJ),r(700,pJ),r(701,dJ),r(16,fJ),r(1114,dj.bind(null,!1)),r(1184,dj.bind(null,!0)),r(1e3,Wp),r(1007,Wp),r(1016,Wp),r(1008,Wp),r(1009,Wp),r(25,hJ)};hj.exports={init:gJ}});var yj=H((Vpe,gj)=>{gj.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var Kp=H(Jp=>{var yJ=cj(),bJ=fj(),vJ=HE(),EJ=yj();Jp.getTypeParser=CJ;Jp.setTypeParser=AJ;Jp.arrayParser=vJ;Jp.builtins=EJ;var Qp={text:{},binary:{}};function bj(r){return String(r)}function CJ(r,e){return e=e||"text",Qp[e]&&Qp[e][r]||bj}function AJ(r,e,t){typeof e=="function"&&(t=e,e="text"),Qp[e][r]=t}yJ.init(function(r,e){Qp.text[r]=e});bJ.init(function(r,e){Qp.binary[r]=e})});var Xp=H((Hpe,eC)=>{"use strict";eC.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var wl=Kp(),SJ=wl.getTypeParser(20,"text"),RJ=wl.getTypeParser(1016,"text");eC.exports.__defineSetter__("parseInt8",function(r){wl.setTypeParser(20,"text",r?wl.getTypeParser(23,"text"):SJ),wl.setTypeParser(1016,"text",r?wl.getTypeParser(1007,"text"):RJ)})});var Il=H((Wpe,Cj)=>{"use strict";var wJ=Xp(),vj=require("util"),{isDate:IJ}=vj.types||vj;function xJ(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Ej(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+Ej(r[t]);else if(ArrayBuffer.isView(r[t])){let n=r[t];if(!(n instanceof Buffer)){let a=Buffer.from(n.buffer,n.byteOffset,n.byteLength);a.length===n.byteLength?n=a:n=a.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=xJ(hf(r[t]));return e=e+"}",e}var hf=function(r,e){if(r==null)return null;if(typeof r=="object"){if(r instanceof Buffer)return r;if(ArrayBuffer.isView(r)){let t=Buffer.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return IJ(r)?wJ.parseInputDatesAsUTC?NJ(r):OJ(r):Array.isArray(r)?Ej(r):TJ(r,e)}return r.toString()};function TJ(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),hf(r.toPostgres(hf),e)}return JSON.stringify(r)}function OJ(r){let e=-r.getTimezoneOffset(),t=r.getFullYear(),n=t<1;n&&(t=Math.abs(t)+1);let a=String(t).padStart(4,"0")+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0")+"."+String(r.getMilliseconds()).padStart(3,"0");return e<0?(a+="-",e*=-1):a+="+",a+=String(Math.floor(e/60)).padStart(2,"0")+":"+String(e%60).padStart(2,"0"),n&&(a+=" BC"),a}function NJ(r){let e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);let n=String(e).padStart(4,"0")+"-"+String(r.getUTCMonth()+1).padStart(2,"0")+"-"+String(r.getUTCDate()).padStart(2,"0")+"T"+String(r.getUTCHours()).padStart(2,"0")+":"+String(r.getUTCMinutes()).padStart(2,"0")+":"+String(r.getUTCSeconds()).padStart(2,"0")+"."+String(r.getUTCMilliseconds()).padStart(3,"0");return n+="+00:00",t&&(n+=" BC"),n}function _J(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var PJ=function(r){return'"'+r.replace(/"/g,'""')+'"'},$J=function(r){let e=!1,t="'";if(r==null||typeof r!="string")return"''";for(let n=0;n<r.length;n++){let a=r[n];a==="'"?t+=a+a:a==="\\"?(t+=a+a,e=!0):t+=a}return t+="'",e===!0&&(t=" E"+t),t};Cj.exports={prepareValue:function(e){return hf(e)},normalizeQueryConfig:_J,escapeIdentifier:PJ,escapeLiteral:$J}});var Sj=H((Qpe,Aj)=>{"use strict";var xl=require("crypto");function tC(r){return xl.createHash("md5").update(r,"utf-8").digest("hex")}function LJ(r,e,t){let n=tC(e+r);return"md5"+tC(Buffer.concat([Buffer.from(n),t]))}function jJ(r){return xl.createHash("sha256").update(r).digest()}function kJ(r,e){return r=r.replace(/(\D)-/,"$1"),xl.createHash(r).update(e).digest()}function DJ(r,e){return xl.createHmac("sha256",r).update(e).digest()}async function MJ(r,e,t){return xl.pbkdf2Sync(r,e,t,32,"sha256")}Aj.exports={postgresMd5PasswordHash:LJ,randomBytes:xl.randomBytes,deriveKey:MJ,sha256:jJ,hashByName:kJ,hmacSha256:DJ,md5:tC}});var xj=H((Jpe,Ij)=>{var Rj=require("crypto");Ij.exports={postgresMd5PasswordHash:BJ,randomBytes:UJ,deriveKey:VJ,sha256:FJ,hashByName:qJ,hmacSha256:GJ,md5:rC};var wj=Rj.webcrypto||globalThis.crypto,$i=wj.subtle,nC=new TextEncoder;function UJ(r){return wj.getRandomValues(Buffer.alloc(r))}async function rC(r){try{return Rj.createHash("md5").update(r,"utf-8").digest("hex")}catch{let t=typeof r=="string"?nC.encode(r):r,n=await $i.digest("MD5",t);return Array.from(new Uint8Array(n)).map(a=>a.toString(16).padStart(2,"0")).join("")}}async function BJ(r,e,t){let n=await rC(e+r);return"md5"+await rC(Buffer.concat([Buffer.from(n),t]))}async function FJ(r){return await $i.digest("SHA-256",r)}async function qJ(r,e){return await $i.digest(r,e)}async function GJ(r,e){let t=await $i.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await $i.sign("HMAC",t,nC.encode(e))}async function VJ(r,e,t){let n=await $i.importKey("raw",nC.encode(r),"PBKDF2",!1,["deriveBits"]),a={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:t};return await $i.deriveBits(a,n,256,["deriveBits"])}});var sC=H((Kpe,aC)=>{"use strict";var zJ=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;zJ?aC.exports=Sj():aC.exports=xj()});var Nj=H((Xpe,Oj)=>{function Li(r,e){return new Error("SASL channel binding: "+r+" when parsing public certificate "+e.toString("base64"))}function oC(r,e){let t=r[e++];if(t<128)return{length:t,index:e};let n=t&127;if(n>4)throw Li("bad length",r);t=0;for(let a=0;a<n;a++)t=t<<8|r[e++];return{length:t,index:e}}function Tj(r,e){if(r[e++]!==6)throw Li("non-OID data",r);let{length:t,index:n}=oC(r,e);e=n;let a=e+t,s=r[e++],o=(s/40>>0)+"."+s%40;for(;e<a;){let i=0;for(;e<a;){let u=r[e++];if(i=i<<7|u&127,u<128)break}o+="."+i}return{oid:o,index:e}}function Yp(r,e){if(r[e++]!==48)throw Li("non-sequence data",r);return oC(r,e)}function HJ(r,e){e===void 0&&(e=0),e=Yp(r,e).index;let{length:t,index:n}=Yp(r,e);e=n+t,e=Yp(r,e).index;let{oid:a,index:s}=Tj(r,e);switch(a){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(e=s,e=Yp(r,e).index,r[e++]!==160)throw Li("non-tag data",r);e=oC(r,e).index,e=Yp(r,e).index;let{oid:o}=Tj(r,e);switch(o){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw Li("unknown hash OID "+o,r)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw Li("Ed448 certificate channel binding is not currently supported by Postgres")}throw Li("unknown OID "+a,r)}Oj.exports={signatureAlgorithmHashFromCertificate:HJ}});var Lj=H((Ype,$j)=>{"use strict";var xo=sC(),{signatureAlgorithmHashFromCertificate:WJ}=Nj();function QJ(r,e){let t=["SCRAM-SHA-256"];e&&t.unshift("SCRAM-SHA-256-PLUS");let n=t.find(o=>r.includes(o));if(!n)throw new Error("SASL: Only mechanism(s) "+t.join(" and ")+" are supported");if(n==="SCRAM-SHA-256-PLUS"&&typeof e.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");let a=xo.randomBytes(18).toString("base64");return{mechanism:n,clientNonce:a,response:(n==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":e?"y":"n")+",,n=*,r="+a,message:"SASLInitialResponse"}}async function JJ(r,e,t,n){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let a=YJ(t);if(a.nonce.startsWith(r.clientNonce)){if(a.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");let s="n=*,r="+r.clientNonce,o="r="+a.nonce+",s="+a.salt+",i="+a.iteration,i=n?"eSws":"biws";if(r.mechanism==="SCRAM-SHA-256-PLUS"){let E=n.getPeerCertificate().raw,d=WJ(E);(d==="MD5"||d==="SHA-1")&&(d="SHA-256");let l=await xo.hashByName(d,E);i=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(l)]).toString("base64")}let u="c="+i+",r="+a.nonce,c=s+","+o+","+u,p=Buffer.from(a.salt,"base64"),m=await xo.deriveKey(e,p,a.iteration),f=await xo.hmacSha256(m,"Client Key"),g=await xo.sha256(f),y=await xo.hmacSha256(g,c),C=eK(Buffer.from(f),Buffer.from(y)).toString("base64"),A=await xo.hmacSha256(m,"Server Key"),T=await xo.hmacSha256(A,c);r.message="SASLResponse",r.serverSignature=Buffer.from(T).toString("base64"),r.response=u+",p="+C}function KJ(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=ZJ(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function XJ(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function _j(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function Pj(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],n=e.substring(2);return[t,n]}))}function YJ(r){let e=Pj(r),t=e.get("r");if(t){if(!XJ(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!_j(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let a=e.get("i");if(a){if(!/^[1-9][0-9]*$/.test(a))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let s=parseInt(a,10);return{nonce:t,salt:n,iteration:s}}function ZJ(r){let t=Pj(r).get("v");if(t){if(!_j(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function eK(r,e){if(!Buffer.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(r.map((t,n)=>r[n]^e[n]))}$j.exports={startSession:QJ,continueSession:JJ,finalizeSession:KJ}});var gf=H((Zpe,jj)=>{"use strict";var tK=Kp();function ff(r){this._types=r||tK,this.text={},this.binary={}}ff.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};ff.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};ff.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};jj.exports=ff});var Mj=H((ede,Dj)=>{"use strict";function Tl(r,e={}){if(r.charAt(0)==="/"){let u=r.split(" ");return{host:u[0],database:u[1]}}let t={},n,a=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)&&(r=encodeURI(r).replace(/%25(\d\d)/g,"%$1"));try{try{n=new URL(r,"postgres://base")}catch{n=new URL(r.replace("@/","@___DUMMY___/"),"postgres://base"),a=!0}}catch(u){u.input&&(u.input="*****REDACTED*****")}for(let u of n.searchParams.entries())t[u[0]]=u[1];if(t.user=t.user||decodeURIComponent(n.username),t.password=t.password||decodeURIComponent(n.password),n.protocol=="socket:")return t.host=decodeURI(n.pathname),t.database=n.searchParams.get("db"),t.client_encoding=n.searchParams.get("encoding"),t;let s=a?"":n.hostname;t.host?s&&/^%2f/i.test(s)&&(n.pathname=s+n.pathname):t.host=decodeURIComponent(s),t.port||(t.port=n.port);let o=n.pathname.slice(1)||null;t.database=o?decodeURI(o):null,(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={});let i=t.sslcert||t.sslkey||t.sslrootcert?require("fs"):null;if(t.sslcert&&(t.ssl.cert=i.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=i.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=i.readFileSync(t.sslrootcert).toString()),e.useLibpqCompat&&t.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(t.uselibpqcompat==="true"||e.useLibpqCompat)switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":{t.ssl.rejectUnauthorized=!1;break}case"require":{t.sslrootcert?t.ssl.checkServerIdentity=function(){}:t.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!t.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");t.ssl.checkServerIdentity=function(){};break}case"verify-full":break}else switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}function rK(r){return Object.entries(r).reduce((t,[n,a])=>(a!=null&&(t[n]=a),t),{})}function kj(r){return Object.entries(r).reduce((t,[n,a])=>{if(n==="ssl"){let s=a;typeof s=="boolean"&&(t[n]=s),typeof s=="object"&&(t[n]=rK(s))}else if(a!=null)if(n==="port"){if(a!==""){let s=parseInt(a,10);if(isNaN(s))throw new Error(`Invalid ${n}: ${a}`);t[n]=s}}else t[n]=a;return t},{})}function nK(r){return kj(Tl(r))}Dj.exports=Tl;Tl.parse=Tl;Tl.toClientConfig=kj;Tl.parseIntoClientConfig=nK});var cC=H((tde,Fj)=>{"use strict";var aK=require("dns"),Bj=Xp(),Uj=Mj().parse,xn=function(r,e,t){return t===void 0?t=process.env["PG"+r.toUpperCase()]:t===!1||(t=process.env[t]),e[r]||t||Bj[r]},sK=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Bj.ssl},Ol=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},ma=function(r,e,t){let n=e[t];n!=null&&r.push(t+"="+Ol(n))},iC=class{constructor(e){e=typeof e=="string"?Uj(e):e||{},e.connectionString&&(e=Object.assign({},e,Uj(e.connectionString))),this.user=xn("user",e),this.database=xn("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(xn("port",e),10),this.host=xn("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:xn("password",e)}),this.binary=xn("binary",e),this.options=xn("options",e),this.ssl=typeof e.ssl>"u"?sK():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=xn("client_encoding",e),this.replication=xn("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=xn("application_name",e,"PGAPPNAME"),this.fallback_application_name=xn("fallback_application_name",e,!1),this.statement_timeout=xn("statement_timeout",e,!1),this.lock_timeout=xn("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=xn("idle_in_transaction_session_timeout",e,!1),this.query_timeout=xn("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){let t=[];ma(t,this,"user"),ma(t,this,"password"),ma(t,this,"port"),ma(t,this,"application_name"),ma(t,this,"fallback_application_name"),ma(t,this,"connect_timeout"),ma(t,this,"options");let n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(ma(t,n,"sslmode"),ma(t,n,"sslca"),ma(t,n,"sslkey"),ma(t,n,"sslcert"),ma(t,n,"sslrootcert"),this.database&&t.push("dbname="+Ol(this.database)),this.replication&&t.push("replication="+Ol(this.replication)),this.host&&t.push("host="+Ol(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+Ol(this.client_encoding)),aK.lookup(this.host,function(a,s){return a?e(a,null):(t.push("hostaddr="+Ol(s)),e(null,t.join(" ")))})}};Fj.exports=iC});var uC=H((rde,Gj)=>{"use strict";var oK=Kp(),qj=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,lC=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){let t;e.text?t=qj.exec(e.text):t=qj.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){let t=new Array(e.length);for(let n=0,a=e.length;n<a;n++){let s=e[n];s!==null?t[n]=this._parsers[n](s):t[n]=null}return t}parseRow(e){let t={...this._prebuiltEmptyResultObject};for(let n=0,a=e.length;n<a;n++){let s=e[n],o=this.fields[n].name;if(s!==null){let i=this.fields[n].format==="binary"?Buffer.from(s):s;t[o]=this._parsers[n](i)}else t[o]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));let t={};for(let n=0;n<e.length;n++){let a=e[n];t[a.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(a.dataTypeID,a.format||"text"):this._parsers[n]=oK.getTypeParser(a.dataTypeID,a.format||"text")}this._prebuiltEmptyResultObject={...t}}};Gj.exports=lC});var Wj=H((nde,Hj)=>{"use strict";var{EventEmitter:iK}=require("events"),Vj=uC(),zj=Il(),pC=class extends iK{constructor(e,t,n){super(),e=zj.normalizeQueryConfig(e,t,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Vj(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Vj(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];if(this.text&&t&&this.text!==t)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){e.stream.cork&&e.stream.cork();try{this.prepare(e)}finally{e.stream.uncork&&e.stream.uncork()}}else e.query(this.text);return null}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:zj.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};Hj.exports=pC});var IC=H(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.NoticeMessage=yt.DataRowMessage=yt.CommandCompleteMessage=yt.ReadyForQueryMessage=yt.NotificationResponseMessage=yt.BackendKeyDataMessage=yt.AuthenticationMD5Password=yt.ParameterStatusMessage=yt.ParameterDescriptionMessage=yt.RowDescriptionMessage=yt.Field=yt.CopyResponse=yt.CopyDataMessage=yt.DatabaseError=yt.copyDone=yt.emptyQuery=yt.replicationStart=yt.portalSuspended=yt.noData=yt.closeComplete=yt.bindComplete=yt.parseComplete=void 0;yt.parseComplete={name:"parseComplete",length:5};yt.bindComplete={name:"bindComplete",length:5};yt.closeComplete={name:"closeComplete",length:5};yt.noData={name:"noData",length:5};yt.portalSuspended={name:"portalSuspended",length:5};yt.replicationStart={name:"replicationStart",length:4};yt.emptyQuery={name:"emptyQuery",length:4};yt.copyDone={name:"copyDone",length:4};var dC=class extends Error{constructor(e,t,n){super(e),this.length=t,this.name=n}};yt.DatabaseError=dC;var mC=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};yt.CopyDataMessage=mC;var hC=class{constructor(e,t,n,a){this.length=e,this.name=t,this.binary=n,this.columnTypes=new Array(a)}};yt.CopyResponse=hC;var fC=class{constructor(e,t,n,a,s,o,i){this.name=e,this.tableID=t,this.columnID=n,this.dataTypeID=a,this.dataTypeSize=s,this.dataTypeModifier=o,this.format=i}};yt.Field=fC;var gC=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};yt.RowDescriptionMessage=gC;var yC=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};yt.ParameterDescriptionMessage=yC;var bC=class{constructor(e,t,n){this.length=e,this.parameterName=t,this.parameterValue=n,this.name="parameterStatus"}};yt.ParameterStatusMessage=bC;var vC=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};yt.AuthenticationMD5Password=vC;var EC=class{constructor(e,t,n){this.length=e,this.processID=t,this.secretKey=n,this.name="backendKeyData"}};yt.BackendKeyDataMessage=EC;var CC=class{constructor(e,t,n,a){this.length=e,this.processId=t,this.channel=n,this.payload=a,this.name="notification"}};yt.NotificationResponseMessage=CC;var AC=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};yt.ReadyForQueryMessage=AC;var SC=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};yt.CommandCompleteMessage=SC;var RC=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};yt.DataRowMessage=RC;var wC=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};yt.NoticeMessage=wC});var Qj=H(yf=>{"use strict";Object.defineProperty(yf,"__esModule",{value:!0});yf.Writer=void 0;var xC=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){if(this.buffer.length-this.offset<e){let n=this.buffer,a=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(a),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{let t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){let t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){let t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}};yf.Writer=xC});var Kj=H(vf=>{"use strict";Object.defineProperty(vf,"__esModule",{value:!0});vf.serialize=void 0;var TC=Qj(),dr=new TC.Writer,cK=r=>{dr.addInt16(3).addInt16(0);for(let n of Object.keys(r))dr.addCString(n).addCString(r[n]);dr.addCString("client_encoding").addCString("UTF8");let e=dr.addCString("").flush(),t=e.length+4;return new TC.Writer().addInt32(t).add(e).flush()},lK=()=>{let r=Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},uK=r=>dr.addCString(r).flush(112),pK=function(r,e){return dr.addCString(r).addInt32(Buffer.byteLength(e)).addString(e),dr.flush(112)},dK=function(r){return dr.addString(r).flush(112)},mK=r=>dr.addCString(r).flush(81),Jj=[],hK=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||Jj,n=t.length,a=dr.addCString(e).addCString(r.text).addInt16(n);for(let s=0;s<n;s++)a.addInt32(t[s]);return dr.flush(80)},Nl=new TC.Writer,fK=function(r,e){for(let t=0;t<r.length;t++){let n=e?e(r[t],t):r[t];n==null?(dr.addInt16(0),Nl.addInt32(-1)):n instanceof Buffer?(dr.addInt16(1),Nl.addInt32(n.length),Nl.add(n)):(dr.addInt16(0),Nl.addInt32(Buffer.byteLength(n)),Nl.addString(n))}},gK=(r={})=>{let e=r.portal||"",t=r.statement||"",n=r.binary||!1,a=r.values||Jj,s=a.length;return dr.addCString(e).addCString(t),dr.addInt16(s),fK(a,r.valueMapper),dr.addInt16(s),dr.add(Nl.flush()),dr.addInt16(1),dr.addInt16(n?1:0),dr.flush(66)},yK=Buffer.from([69,0,0,0,9,0,0,0,0,0]),bK=r=>{if(!r||!r.portal&&!r.rows)return yK;let e=r.portal||"",t=r.rows||0,n=Buffer.byteLength(e),a=4+n+1+4,s=Buffer.allocUnsafe(1+a);return s[0]=69,s.writeInt32BE(a,1),s.write(e,5,"utf-8"),s[n+5]=0,s.writeUInt32BE(t,s.length-4),s},vK=(r,e)=>{let t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},OC=(r,e)=>{let n=4+Buffer.byteLength(e)+1,a=Buffer.allocUnsafe(1+n);return a[0]=r,a.writeInt32BE(n,1),a.write(e,5,"utf-8"),a[n]=0,a},EK=dr.addCString("P").flush(68),CK=dr.addCString("S").flush(68),AK=r=>r.name?OC(68,`${r.type}${r.name||""}`):r.type==="P"?EK:CK,SK=r=>{let e=`${r.type}${r.name||""}`;return OC(67,e)},RK=r=>dr.add(r).flush(100),wK=r=>OC(102,r),bf=r=>Buffer.from([r,0,0,0,4]),IK=bf(72),xK=bf(83),TK=bf(88),OK=bf(99),NK={startup:cK,password:uK,requestSsl:lK,sendSASLInitialResponseMessage:pK,sendSCRAMClientFinalMessage:dK,query:mK,parse:hK,bind:gK,execute:bK,describe:AK,close:SK,flush:()=>IK,sync:()=>xK,end:()=>TK,copyData:RK,copyDone:()=>OK,copyFail:wK,cancel:vK};vf.serialize=NK});var Xj=H(Ef=>{"use strict";Object.defineProperty(Ef,"__esModule",{value:!0});Ef.BufferReader=void 0;var _K=Buffer.allocUnsafe(0),NC=class{constructor(e=0){this.offset=e,this.buffer=_K,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}uint32(){let e=this.buffer.readUInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};Ef.BufferReader=NC});var ek=H(Cf=>{"use strict";Object.defineProperty(Cf,"__esModule",{value:!0});Cf.Parser=void 0;var br=IC(),PK=Xj(),_C=1,$K=4,Yj=_C+$K,Zj=Buffer.allocUnsafe(0),PC=class{constructor(e){if(this.buffer=Zj,this.bufferLength=0,this.bufferOffset=0,this.reader=new PK.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,a=this.bufferOffset;for(;a+Yj<=n;){let s=this.buffer[a],o=this.buffer.readUInt32BE(a+_C),i=_C+o;if(i+a<=n){let u=this.handlePacket(a+Yj,s,o,this.buffer);t(u),a+=i}else break}a===n?(this.buffer=Zj,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-a,this.bufferOffset=a)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let a;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)a=this.buffer;else{let s=this.buffer.byteLength*2;for(;t>=s;)s*=2;a=Buffer.allocUnsafe(s)}this.buffer.copy(a,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=a,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,n,a){switch(t){case 50:return br.bindComplete;case 49:return br.parseComplete;case 51:return br.closeComplete;case 110:return br.noData;case 115:return br.portalSuspended;case 99:return br.copyDone;case 87:return br.replicationStart;case 73:return br.emptyQuery;case 68:return this.parseDataRowMessage(e,n,a);case 67:return this.parseCommandCompleteMessage(e,n,a);case 90:return this.parseReadyForQueryMessage(e,n,a);case 65:return this.parseNotificationMessage(e,n,a);case 82:return this.parseAuthenticationResponse(e,n,a);case 83:return this.parseParameterStatusMessage(e,n,a);case 75:return this.parseBackendKeyData(e,n,a);case 69:return this.parseErrorMessage(e,n,a,"error");case 78:return this.parseErrorMessage(e,n,a,"notice");case 84:return this.parseRowDescriptionMessage(e,n,a);case 116:return this.parseParameterDescriptionMessage(e,n,a);case 71:return this.parseCopyInMessage(e,n,a);case 72:return this.parseCopyOutMessage(e,n,a);case 100:return this.parseCopyData(e,n,a);default:return new br.DatabaseError("received invalid response: "+t.toString(16),n,"error")}}parseReadyForQueryMessage(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.string(1);return new br.ReadyForQueryMessage(t,a)}parseCommandCompleteMessage(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.cstring();return new br.CommandCompleteMessage(t,a)}parseCopyData(e,t,n){let a=n.slice(e,e+(t-4));return new br.CopyDataMessage(t,a)}parseCopyInMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyInResponse")}parseCopyOutMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyOutResponse")}parseCopyMessage(e,t,n,a){this.reader.setBuffer(e,n);let s=this.reader.byte()!==0,o=this.reader.int16(),i=new br.CopyResponse(t,a,s,o);for(let u=0;u<o;u++)i.columnTypes[u]=this.reader.int16();return i}parseNotificationMessage(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.int32(),s=this.reader.cstring(),o=this.reader.cstring();return new br.NotificationResponseMessage(t,a,s,o)}parseRowDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.int16(),s=new br.RowDescriptionMessage(t,a);for(let o=0;o<a;o++)s.fields[o]=this.parseField();return s}parseField(){let e=this.reader.cstring(),t=this.reader.uint32(),n=this.reader.int16(),a=this.reader.uint32(),s=this.reader.int16(),o=this.reader.int32(),i=this.reader.int16()===0?"text":"binary";return new br.Field(e,t,n,a,s,o,i)}parseParameterDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.int16(),s=new br.ParameterDescriptionMessage(t,a);for(let o=0;o<a;o++)s.dataTypeIDs[o]=this.reader.int32();return s}parseDataRowMessage(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.int16(),s=new Array(a);for(let o=0;o<a;o++){let i=this.reader.int32();s[o]=i===-1?null:this.reader.string(i)}return new br.DataRowMessage(t,s)}parseParameterStatusMessage(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.cstring(),s=this.reader.cstring();return new br.ParameterStatusMessage(t,a,s)}parseBackendKeyData(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.int32(),s=this.reader.int32();return new br.BackendKeyDataMessage(t,a,s)}parseAuthenticationResponse(e,t,n){this.reader.setBuffer(e,n);let a=this.reader.int32(),s={name:"authenticationOk",length:t};switch(a){case 0:break;case 3:s.length===8&&(s.name="authenticationCleartextPassword");break;case 5:if(s.length===12){s.name="authenticationMD5Password";let o=this.reader.bytes(4);return new br.AuthenticationMD5Password(t,o)}break;case 10:{s.name="authenticationSASL",s.mechanisms=[];let o;do o=this.reader.cstring(),o&&s.mechanisms.push(o);while(o)}break;case 11:s.name="authenticationSASLContinue",s.data=this.reader.string(t-8);break;case 12:s.name="authenticationSASLFinal",s.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+a)}return s}parseErrorMessage(e,t,n,a){this.reader.setBuffer(e,n);let s={},o=this.reader.string(1);for(;o!=="\0";)s[o]=this.reader.cstring(),o=this.reader.string(1);let i=s.M,u=a==="notice"?new br.NoticeMessage(t,i):new br.DatabaseError(i,t,a);return u.severity=s.S,u.code=s.C,u.detail=s.D,u.hint=s.H,u.position=s.P,u.internalPosition=s.p,u.internalQuery=s.q,u.where=s.W,u.schema=s.s,u.table=s.t,u.column=s.c,u.dataType=s.d,u.constraint=s.n,u.file=s.F,u.line=s.L,u.routine=s.R,u}};Cf.Parser=PC});var $C=H(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.DatabaseError=To.serialize=To.parse=void 0;var LK=IC();Object.defineProperty(To,"DatabaseError",{enumerable:!0,get:function(){return LK.DatabaseError}});var jK=Kj();Object.defineProperty(To,"serialize",{enumerable:!0,get:function(){return jK.serialize}});var kK=ek();function DK(r,e){let t=new kK.Parser;return r.on("data",n=>t.parse(n,e)),new Promise(n=>r.on("end",()=>n()))}To.parse=DK});var tk=H(LC=>{"use strict";Object.defineProperty(LC,"__esModule",{value:!0});LC.default={}});var nk=H((pde,rk)=>{var{getStream:MK,getSecureStream:UK}=GK();rk.exports={getStream:MK,getSecureStream:UK};function BK(){function r(t){let n=require("net");return new n.Socket}function e(t){return require("tls").connect(t)}return{getStream:r,getSecureStream:e}}function FK(){function r(t){let{CloudflareSocket:n}=tk();return new n(t)}function e(t){return t.socket.startTls(t),t.socket}return{getStream:r,getSecureStream:e}}function qK(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){let r=new Response(null,{cf:{thing:!0}});if(typeof r.cf=="object"&&r.cf!==null&&r.cf.thing)return!0}return!1}function GK(){return qK()?FK():BK()}});var kC=H((dde,ak)=>{"use strict";var VK=require("events").EventEmitter,{parse:zK,serialize:tn}=$C(),{getStream:HK,getSecureStream:WK}=nk(),QK=tn.flush(),JK=tn.sync(),KK=tn.end(),jC=class extends VK{constructor(e){super(),e=e||{},this.stream=e.stream||HK(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;let t=this;this.on("newListener",function(n){n==="message"&&(t._emitMessage=!0)})}connect(e,t){let n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let a=function(s){n._ending&&(s.code==="ECONNRESET"||s.code==="EPIPE")||n.emit("error",s)};if(this.stream.on("error",a),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(s){switch(s.toString("utf8")){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let i={socket:n.stream};n.ssl!==!0&&(Object.assign(i,n.ssl),"key"in n.ssl&&(i.key=n.ssl.key));let u=require("net");u.isIP&&u.isIP(t)===0&&(i.servername=t);try{n.stream=WK(i)}catch(c){return n.emit("error",c)}n.attachListeners(n.stream),n.stream.on("error",a),n.emit("sslconnect")})}attachListeners(e){zK(e,t=>{let n=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(n,t)})}requestSsl(){this.stream.write(tn.requestSsl())}startup(e){this.stream.write(tn.startup(e))}cancel(e,t){this._send(tn.cancel(e,t))}password(e){this._send(tn.password(e))}sendSASLInitialResponseMessage(e,t){this._send(tn.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(tn.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(tn.query(e))}parse(e){this._send(tn.parse(e))}bind(e){this._send(tn.bind(e))}execute(e){this._send(tn.execute(e))}flush(){this.stream.writable&&this.stream.write(QK)}sync(){this._ending=!0,this._send(JK)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(KK,()=>{this.stream.end()})}close(e){this._send(tn.close(e))}describe(e){this._send(tn.describe(e))}sendCopyFromChunk(e){this._send(tn.copyData(e))}endCopyFrom(){this._send(tn.copyDone())}sendCopyFail(e){this._send(tn.copyFail(e))}};ak.exports=jC});var ck=H((mde,ik)=>{"use strict";var{Transform:XK}=require("stream"),{StringDecoder:YK}=require("string_decoder"),Oo=Symbol("last"),Af=Symbol("decoder");function ZK(r,e,t){let n;if(this.overflow){if(n=this[Af].write(r).split(this.matcher),n.length===1)return t();n.shift(),this.overflow=!1}else this[Oo]+=this[Af].write(r),n=this[Oo].split(this.matcher);this[Oo]=n.pop();for(let a=0;a<n.length;a++)try{ok(this,this.mapper(n[a]))}catch(s){return t(s)}if(this.overflow=this[Oo].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function eX(r){if(this[Oo]+=this[Af].end(),this[Oo])try{ok(this,this.mapper(this[Oo]))}catch(e){return r(e)}r()}function ok(r,e){e!==void 0&&r.push(e)}function sk(r){return r}function tX(r,e,t){switch(r=r||/\r?\n/,e=e||sk,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&!r[Symbol.split]&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=sk)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=ZK,t.flush=eX,t.readableObjectMode=!0;let n=new XK(t);return n[Oo]="",n[Af]=new YK("utf8"),n.matcher=r,n.mapper=e,n.maxLength=t.maxLength,n.skipOverflow=t.skipOverflow||!1,n.overflow=!1,n._destroy=function(a,s){this._writableState.errorEmitted=!1,s(a)},n}ik.exports=tX});var pk=H((hde,$s)=>{"use strict";var lk=require("path"),rX=require("stream").Stream,nX=ck(),uk=require("util"),aX=5432,Sf=process.platform==="win32",Zp=process.stderr,sX=56,oX=7,iX=61440,cX=32768;function lX(r){return(r&iX)==cX}var _l=["host","port","database","user","password"],DC=_l.length,uX=_l[DC-1];function MC(){var r=Zp instanceof rX&&Zp.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);Zp.write(uk.format.apply(uk,e))}}Object.defineProperty($s.exports,"isWin",{get:function(){return Sf},set:function(r){Sf=r}});$s.exports.warnTo=function(r){var e=Zp;return Zp=r,e};$s.exports.getFileName=function(r){var e=r||process.env,t=e.PGPASSFILE||(Sf?lk.join(e.APPDATA||"./","postgresql","pgpass.conf"):lk.join(e.HOME||"./",".pgpass"));return t};$s.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Sf?!0:(e=e||"<unkn>",lX(r.mode)?r.mode&(sX|oX)?(MC('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(MC('WARNING: password file "%s" is not a plain file',e),!1))};var pX=$s.exports.match=function(r,e){return _l.slice(0,-1).reduce(function(t,n,a){return a==1&&Number(r[n]||aX)===Number(e[n])?t&&!0:t&&(e[n]==="*"||e[n]===r[n])},!0)};$s.exports.getPassword=function(r,e,t){var n,a=e.pipe(nX());function s(u){var c=dX(u);c&&mX(c)&&pX(r,c)&&(n=c[uX],a.end())}var o=function(){e.destroy(),t(n)},i=function(u){e.destroy(),MC("WARNING: error on reading file: %s",u),t(void 0)};e.on("error",i),a.on("data",s).on("end",o).on("error",i)};var dX=$s.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",n=0,a=0,s=0,o={},i=!1,u=function(p,m,f){var g=r.substring(m,f);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(g=g.replace(/\\([:\\])/g,"$1")),o[_l[p]]=g},c=0;c<r.length-1;c+=1){if(e=r.charAt(c+1),t=r.charAt(c),i=n==DC-1,i){u(n,a);break}c>=0&&e==":"&&t!=="\\"&&(u(n,a,c+1),a=c+2,n+=1)}return o=Object.keys(o).length===DC?o:null,o},mX=$s.exports.isValidEntry=function(r){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},t=0;t<_l.length;t+=1){var n=e[t],a=r[_l[t]]||"",s=n(a);if(!s)return!1}return!0}});var mk=H((gde,UC)=>{"use strict";var fde=require("path"),dk=require("fs"),Rf=pk();UC.exports=function(r,e){var t=Rf.getFileName();dk.stat(t,function(n,a){if(n||!Rf.usePgPass(a,t))return e(void 0);var s=dk.createReadStream(t);Rf.getPassword(r,s,e)})};UC.exports.warnTo=Rf.warnTo});var yk=H((yde,gk)=>{"use strict";var hX=require("events").EventEmitter,hk=Il(),BC=Lj(),fX=gf(),gX=cC(),fk=Wj(),yX=Xp(),bX=kC(),vX=sC(),wf=class extends hX{constructor(e){super(),this.connectionParameters=new gX(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let t=e||{};this._Promise=t.Promise||global.Promise,this._types=new fX(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!t.enableChannelBinding,this.connection=t.connection||new bX({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||yX.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){let t=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let a=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(a)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){t.ssl?n.requestSsl():n.startup(t.getStartupConf())}),n.on("sslconnect",function(){n.startup(t.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let a=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(a),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(a):this._handleErrorEvent(a):this._connectionError||this._handleErrorEvent(a)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,n)=>{this._connect(a=>{a?n(a):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{t.emit("error",n)});else if(this.password!==null)e();else try{mk()(this.connectionParameters,a=>{a!==void 0&&(this.connectionParameters.password=this.password=a),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let t=await vX.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}catch(t){this.emit("error",t)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=BC.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}async _handleAuthSASLContinue(e){try{await BC.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{BC.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let t=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(t);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,t={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(t.application_name=n),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,n){return this._types.setTypeParser(e,t,n)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return hk.escapeIdentifier(e)}escapeLiteral(e){return hk.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,n){let a,s,o,i,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,s=a=e,typeof t=="function"&&(a.callback=a.callback||t)):(o=e.query_timeout||this.connectionParameters.query_timeout,a=new fk(e,t,n),a.callback||(s=new this._Promise((c,p)=>{a.callback=(m,f)=>m?p(m):c(f)}).catch(c=>{throw Error.captureStackTrace(c),c}))),o&&(u=a.callback,i=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{a.handleError(c,this.connection)}),u(c),a.callback=()=>{};let p=this.queryQueue.indexOf(a);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},o),a.callback=(c,p)=>{clearTimeout(i),u(c,p)}),this.binary&&!a.binary&&(a.binary=!0),a._result&&!a._result._types&&(a._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{a.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(a),this._pulseQueryQueue(),s):(process.nextTick(()=>{a.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};wf.Query=fk;gk.exports=wf});var Ck=H((bde,Ek)=>{"use strict";var EX=require("events").EventEmitter,bk=function(){},vk=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},FC=class{constructor(e,t,n){this.client=e,this.idleListener=t,this.timeoutId=n}},Pl=class{constructor(e){this.callback=e}};function CX(){throw new Error("Release called on client which has already been released to the pool.")}function If(r,e){if(e)return{callback:e,result:void 0};let t,n,a=function(o,i){o?t(o):n(i)},s=new r(function(o,i){n=o,t=i}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:a,result:s}}function AX(r,e){return function t(n){n.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",n)}),r._remove(e),r.emit("error",n,e)}}var qC=class extends EX{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||GC().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let n=t.client;n.ref&&n.ref();let a=t.idleListener;return this._acquireClient(n,e,a,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,t){let n=vk(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let a=this;e.end(()=>{a.emit("remove",e),typeof t=="function"&&t()})}connect(e){if(this.ending){let a=new Error("Cannot use a pool after calling end on the pool");return e?e(a):this.Promise.reject(a)}let t=If(this.Promise,e),n=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Pl(t.callback)),n;let a=(i,u,c)=>{clearTimeout(o),t.callback(i,u,c)},s=new Pl(a),o=setTimeout(()=>{vk(this._pendingQueue,i=>i.callback===a),s.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return o.unref&&o.unref(),this._pendingQueue.push(s),n}return this.newClient(new Pl(t.callback)),n}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let n=AX(this,t);this.log("checking client timeout");let a,s=!1;this.options.connectionTimeoutMillis&&(a=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(o=>{if(a&&clearTimeout(a),t.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(i=>i!==t),s&&(o=new Error("Connection terminated due to connection timeout",{cause:o})),this._pulseQueue(),e.timedOut||e.callback(o,void 0,bk);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let i=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(c=>c.client===t)!==-1&&this._acquireClient(t,new Pl((c,p,m)=>m()),n,!1)},this.options.maxLifetimeSeconds*1e3);i.unref(),t.once("end",()=>clearTimeout(i))}return this._acquireClient(t,e,n,!0)}})}_acquireClient(e,t,n,a){a&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),t.timedOut?a&&this.options.verify?this.options.verify(e,e.release):e.release():a&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),t.callback(s,void 0,bk);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let n=!1;return a=>{n&&CX(),n=!0,this._release(e,t,a)}}_release(e,t,n){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new FC(e,t,s)),this._pulseQueue()}query(e,t,n){if(typeof e=="function"){let s=If(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof t=="function"&&(n=t,t=void 0);let a=If(this.Promise,n);return n=a.callback,this.connect((s,o)=>{if(s)return n(s);let i=!1,u=c=>{i||(i=!0,o.release(c),n(c))};o.once("error",u),this.log("dispatching query");try{o.query(e,t,(c,p)=>{if(this.log("query dispatched"),o.removeListener("error",u),!i)return i=!0,o.release(c),c?n(c):n(void 0,p)})}catch(c){return o.release(c),n(c)}}),a.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let t=If(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};Ek.exports=qC});var Rk=H((vde,Sk)=>{"use strict";var Ak=require("events").EventEmitter,SX=require("util"),VC=Il(),$l=Sk.exports=function(r,e,t){Ak.call(this),r=VC.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.queryMode=r.queryMode,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};SX.inherits($l,Ak);var RX={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};$l.prototype.handleError=function(r){let e=this.native.pq.resultErrorFields();if(e)for(let t in e){let n=RX[t]||t;r[n]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};$l.prototype.then=function(r,e){return this._getPromise().then(r,e)};$l.prototype.catch=function(r){return this._getPromise().catch(r)};$l.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};$l.prototype.submit=function(r){this.state="running";let e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;let t=function(n,a,s){if(r.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?a.forEach((o,i)=>{o.forEach(u=>{e.emit("row",u,s[i])})}):a.forEach(function(o){e.emit("row",o,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(t=process.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(VC.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(a)}return r.native.execute(this.name,n,t)}return r.native.prepare(this.name,this.text,n.length,function(a){return a?t(a):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,n,t))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return t(a)}let n=this.values.map(VC.prepareValue);r.native.query(this.text,n,t)}else this.queryMode==="extended"?r.native.query(this.text,[],t):r.native.query(this.text,t)}});var Ok=H((Ede,Tk)=>{"use strict";var wk;try{wk=require("pg-native")}catch(r){throw r}var wX=gf(),Ik=require("events").EventEmitter,IX=require("util"),xX=cC(),xk=Rk(),Dn=Tk.exports=function(r){Ik.call(this),r=r||{},this._Promise=r.Promise||global.Promise,this._types=new wX(r.types),this.native=new wk({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new xX(r);r.nativeConnectionString&&(e.nativeConnectionString=r.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};Dn.Query=xk;IX.inherits(Dn,Ik);Dn.prototype._errorAllQueries=function(r){let e=t=>{process.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};Dn.prototype._connect=function(r){let e=this;if(this._connecting){process.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),t)return r(t);e.native.connect(n,function(a){if(a)return e.native.end(),r(a);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};Dn.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(n=>{n?t(n):e()})})};Dn.prototype.query=function(r,e,t){let n,a,s,o,i;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")s=r.query_timeout||this.connectionParameters.query_timeout,a=n=r,typeof e=="function"&&(r.callback=e);else if(s=r.query_timeout||this.connectionParameters.query_timeout,n=new xk(r,e,t),!n.callback){let u,c;a=new this._Promise((p,m)=>{u=p,c=m}).catch(p=>{throw Error.captureStackTrace(p),p}),n.callback=(p,m)=>p?c(p):u(m)}return s&&(i=n.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),i(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},s),n.callback=(u,c)=>{clearTimeout(o),i(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),a):(this._queryQueue.push(n),this._pulseQueryQueue(),a):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),a)};Dn.prototype.end=function(r){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));let t;return r||(t=new this._Promise(function(n,a){r=s=>s?a(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),r&&r()})}),t};Dn.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};Dn.prototype._pulseQueryQueue=function(r){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);let t=this;e.once("_done",function(){t._pulseQueryQueue()})};Dn.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};Dn.prototype.ref=function(){};Dn.prototype.unref=function(){};Dn.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};Dn.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var zC=H((Cde,Nk)=>{"use strict";Nk.exports=Ok()});var GC=H((Sde,ed)=>{"use strict";var TX=yk(),OX=Xp(),NX=kC(),_X=uC(),PX=Il(),$X=Ck(),LX=gf(),{DatabaseError:jX}=$C(),{escapeIdentifier:kX,escapeLiteral:DX}=Il(),MX=r=>class extends $X{constructor(t){super(t,r)}},HC=function(r){this.defaults=OX,this.Client=r,this.Query=this.Client.Query,this.Pool=MX(this.Client),this._pools=[],this.Connection=NX,this.types=Kp(),this.DatabaseError=jX,this.TypeOverrides=LX,this.escapeIdentifier=kX,this.escapeLiteral=DX,this.Result=_X,this.utils=PX};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ed.exports=new HC(zC()):(ed.exports=new HC(TX),Object.defineProperty(ed.exports,"native",{configurable:!0,enumerable:!1,get(){let r=null;try{r=new HC(zC())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ed.exports,"native",{value:r}),r}}))});var Qn,Rde,wde,Ide,xde,Tde,Ode,Nde,_de,Pde,$de,Lde,No,xf=G(()=>{Qn=ln(GC(),1),Rde=Qn.default.Client,wde=Qn.default.Pool,Ide=Qn.default.Connection,xde=Qn.default.types,Tde=Qn.default.Query,Ode=Qn.default.DatabaseError,Nde=Qn.default.escapeIdentifier,_de=Qn.default.escapeLiteral,Pde=Qn.default.Result,$de=Qn.default.TypeOverrides,Lde=Qn.default.defaults,No=Qn.default});function pe(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,z))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(r).constructor;if(t)for(;t;){if(z in t&&t[z]===e[z])return!0;t=Object.getPrototypeOf(t)}return!1}var z,kde,Te=G(()=>{z=Symbol.for("drizzle:entityKind"),kde=Symbol.for("drizzle:hasOwnEntityKind")});var WC,Tf,Of,Nf=G(()=>{Te();WC=class{static[z]="ConsoleLogWriter";write(e){console.log(e)}},Tf=class{static[z]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new WC}logQuery(e,t){let n=t.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),a=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${a}`)}},Of=class{static[z]="NoopLogger";logQuery(){}}});var fn,Ls=G(()=>{Te();fn=class{static[z]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}}});var Ht,ss=G(()=>{Te();Ht=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static[z]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}});var _f,QC=G(()=>{Te();_f=class{static[z]="ColumnBuilder";config;constructor(e,t,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}}});var ka,Pf=G(()=>{ka=Symbol.for("drizzle:Name")});var $f,JC,KC=G(()=>{Te();Pf();$f=class{static[z]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:n,columns:a,foreignColumns:s}=e();return{name:n,columns:a,foreignTable:s[0].table,foreignColumns:s}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new JC(e,this)}},JC=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[z]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:n}=this.reference(),a=t.map(i=>i.name),s=n.map(i=>i.name),o=[this.table[ka],...a,n[0].table[ka],...s];return e??`${o.join("_")}_fk`}}});function Lf(r,...e){return r(...e)}var XC=G(()=>{});function eA(r,e){return`${r[ka]}_${e.join("_")}_unique`}var YC,_k,ZC,tA=G(()=>{Te();Pf();YC=class{constructor(e,t){this.name=t,this.columns=e}static[z]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new ZC(e,this.columns,this.nullsNotDistinctConfig,this.name)}},_k=class{static[z]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new YC(e,this.name)}},ZC=class{constructor(e,t,n,a){this.table=e,this.columns=t,this.name=a??eA(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[z]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}}});function Pk(r,e,t){for(let n=e;n<r.length;n++){let a=r[n];if(a==="\\"){n++;continue}if(a==='"')return[r.slice(e,n).replace(/\\/g,""),n+1];if(!t&&(a===","||a==="}"))return[r.slice(e,n).replace(/\\/g,""),n]}return[r.slice(e).replace(/\\/g,""),r.length]}function $k(r,e=0){let t=[],n=e,a=!1;for(;n<r.length;){let s=r[n];if(s===","){(a||n===e)&&t.push(""),a=!0,n++;continue}if(a=!1,s==="\\"){n+=2;continue}if(s==='"'){let[u,c]=Pk(r,n+1,!0);t.push(u),n=c;continue}if(s==="}")return[t,n+1];if(s==="{"){let[u,c]=$k(r,n+1);t.push(u),n=c;continue}let[o,i]=Pk(r,n,!1);t.push(o),n=i}return[t,n]}function Lk(r){let[e]=$k(r,1);return e}function rA(r){return`{${r.map(e=>Array.isArray(e)?rA(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var nA=G(()=>{});var Ge,we,aA,Ll,sA,oA,$t=G(()=>{QC();ss();Te();KC();XC();tA();nA();Ge=class extends _f{foreignKeyConfigs=[];static[z]="PgColumnBuilder";array(e){return new sA(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:n,actions:a})=>Lf((s,o)=>{let i=new $f(()=>{let u=s();return{columns:[e],foreignColumns:[u]}});return o.onUpdate&&i.onUpdate(o.onUpdate),o.onDelete&&i.onDelete(o.onDelete),i.build(t)},n,a))}buildExtraConfigColumn(e){return new aA(e,this.config)}},we=class extends Ht{constructor(e,t){t.uniqueName||(t.uniqueName=eA(e,[t.name])),super(e,t),this.table=e}static[z]="PgColumn"},aA=class extends we{static[z]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Ll=class{static[z]="IndexedColumn";constructor(e,t,n,a){this.name=e,this.keyAsName=t,this.type=n,this.indexConfig=a}name;keyAsName;type;indexConfig},sA=class extends Ge{static[z]="PgArrayBuilder";constructor(e,t,n){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=n}build(e){let t=this.config.baseBuilder.build(e);return new oA(e,this.config,t)}},oA=class r extends we{constructor(e,t,n,a){super(e,t),this.baseColumn=n,this.range=a,this.size=t.size}size;static[z]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Lk(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let n=e.map(a=>a===null?null:pe(this.baseColumn,r)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return t?n:rA(n)}}});function jk(r){return!!r&&typeof r=="function"&&iA in r&&r[iA]===!0}function kk(r,e,t){let n=Object.assign(a=>new cA(a??"",n),{enumName:r,enumValues:e,schema:t,[iA]:!0});return n}var iA,cA,lA,jf=G(()=>{Te();$t();iA=Symbol.for("drizzle:isPgEnum");cA=class extends Ge{static[z]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new lA(e,this.config)}},lA=class extends we{static[z]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}}});var Mr,jl,os=G(()=>{Te();Mr=class{static[z]="Subquery";constructor(e,t,n,a=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:n,isWith:a}}},jl=class extends Mr{static[z]="WithSubquery"}});var Dk,Mk=G(()=>{Dk="0.39.3"});var uA,pA,or,js=G(()=>{XC();Mk();or={startActiveSpan(r,e){return uA?(pA||(pA=uA.trace.getTracer("drizzle-orm",Dk)),Lf((t,n)=>n.startActiveSpan(r,a=>{try{return e(a)}catch(s){throw a.setStatus({code:t.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{a.end()}}),uA,pA)):e()}}});var ir,ks=G(()=>{ir=Symbol.for("drizzle:ViewBaseConfig")});function hA(r){return typeof r=="object"&&r!==null&&Fk in r}function Mn(r){return r[ka]}function ji(r){return`${r[kf]??"public"}.${r[ka]}`}var kf,Df,Uk,dA,mA,td,Bk,Fk,$e,Un=G(()=>{Te();Pf();kf=Symbol.for("drizzle:Schema"),Df=Symbol.for("drizzle:Columns"),Uk=Symbol.for("drizzle:ExtraConfigColumns"),dA=Symbol.for("drizzle:OriginalName"),mA=Symbol.for("drizzle:BaseName"),td=Symbol.for("drizzle:IsAlias"),Bk=Symbol.for("drizzle:ExtraConfigBuilder"),Fk=Symbol.for("drizzle:IsDrizzleTable"),$e=class{static[z]="Table";static Symbol={Name:ka,Schema:kf,OriginalName:dA,Columns:Df,ExtraConfigColumns:Uk,BaseName:mA,IsAlias:td,ExtraConfigBuilder:Bk};[ka];[dA];[kf];[Df];[Uk];[mA];[td]=!1;[Fk]=!0;[Bk]=void 0;constructor(e,t,n){this[ka]=this[dA]=e,this[kf]=t,this[mA]=n}}});function fA(r){return r!=null&&typeof r.getSQL=="function"}function UX(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}function Gk(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}function B(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new Ur(r[0]));for(let[n,a]of e.entries())t.push(a,new Ur(r[n+1]));return new je(t)}function gA(r,e){return r.map(t=>{if(pe(t,Ds)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}if(pe(t,Bn)&&pe(t.value,Ds)){if(!(t.value.name in e))throw new Error(`No value for placeholder "${t.value.name}" was provided`);return t.encoder.mapToDriverValue(e[t.value.name])}return t})}function Wk(r){return typeof r=="object"&&r!==null&&Hk in r}var qk,Ur,je,rd,Vk,zk,Ome,Bn,Ds,Hk,Tn,Br=G(()=>{Te();jf();os();js();ks();ss();Un();qk=class{static[z]="FakePrimitiveParam"};Ur=class{static[z]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new je([this])}},je=class r{constructor(e){this.queryChunks=e}static[z]="SQL";decoder=Vk;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return or.startActiveSpan("drizzle.buildSQL",t=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,t){let n=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:a,escapeName:s,escapeParam:o,prepareTyping:i,inlineParams:u,paramStartIndex:c}=n;return UX(e.map(p=>{if(pe(p,Ur))return{sql:p.value.join(""),params:[]};if(pe(p,rd))return{sql:s(p.value),params:[]};if(p===void 0)return{sql:"",params:[]};if(Array.isArray(p)){let m=[new Ur("(")];for(let[f,g]of p.entries())m.push(g),f<p.length-1&&m.push(new Ur(", "));return m.push(new Ur(")")),this.buildQueryFromSourceParams(m,n)}if(pe(p,r))return this.buildQueryFromSourceParams(p.queryChunks,{...n,inlineParams:u||p.shouldInlineParams});if(pe(p,$e)){let m=p[$e.Symbol.Schema],f=p[$e.Symbol.Name];return{sql:m===void 0||p[td]?s(f):s(m)+"."+s(f),params:[]}}if(pe(p,Ht)){let m=a.getColumnCasing(p);if(t.invokeSource==="indexes")return{sql:s(m),params:[]};let f=p.table[$e.Symbol.Schema];return{sql:p.table[td]||f===void 0?s(p.table[$e.Symbol.Name])+"."+s(m):s(f)+"."+s(p.table[$e.Symbol.Name])+"."+s(m),params:[]}}if(pe(p,Tn)){let m=p[ir].schema,f=p[ir].name;return{sql:m===void 0||p[ir].isAlias?s(f):s(m)+"."+s(f),params:[]}}if(pe(p,Bn)){if(pe(p.value,Ds))return{sql:o(c.value++,p),params:[p],typings:["none"]};let m=p.value===null?null:p.encoder.mapToDriverValue(p.value);if(pe(m,r))return this.buildQueryFromSourceParams([m],n);if(u)return{sql:this.mapInlineParam(m,n),params:[]};let f=["none"];return i&&(f=[i(p.encoder)]),{sql:o(c.value++,m),params:[m],typings:f}}return pe(p,Ds)?{sql:o(c.value++,p),params:[p],typings:["none"]}:pe(p,r.Aliased)&&p.fieldAlias!==void 0?{sql:s(p.fieldAlias),params:[]}:pe(p,Mr)?p._.isWith?{sql:s(p._.alias),params:[]}:this.buildQueryFromSourceParams([new Ur("("),p._.sql,new Ur(") "),new rd(p._.alias)],n):jk(p)?p.schema?{sql:s(p.schema)+"."+s(p.enumName),params:[]}:{sql:s(p.enumName),params:[]}:fA(p)?p.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([p.getSQL()],n):this.buildQueryFromSourceParams([new Ur("("),p.getSQL(),new Ur(")")],n):u?{sql:this.mapInlineParam(p,n),params:[]}:{sql:o(c.value++,p),params:[p],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let n=e.toString();return t(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new r.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},rd=class{constructor(e){this.value=e}static[z]="Name";brand;getSQL(){return new je([this])}};Vk={mapFromDriverValue:r=>r},zk={mapToDriverValue:r=>r},Ome={...Vk,...zk},Bn=class{constructor(e,t=zk){this.value=e,this.encoder=t}static[z]="Param";brand;getSQL(){return new je([this])}};(r=>{function e(){return new je([])}r.empty=e;function t(u){return new je(u)}r.fromList=t;function n(u){return new je([new Ur(u)])}r.raw=n;function a(u,c){let p=[];for(let[m,f]of u.entries())m>0&&c!==void 0&&p.push(c),p.push(f);return new je(p)}r.join=a;function s(u){return new rd(u)}r.identifier=s;function o(u){return new Ds(u)}r.placeholder=o;function i(u,c){return new Bn(u,c)}r.param=i})(B||(B={}));(r=>{class e{constructor(n,a){this.sql=n,this.fieldAlias=a}static[z]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(je||(je={}));Ds=class{constructor(e){this.name=e}static[z]="Placeholder";getSQL(){return new je([this])}};Hk=Symbol.for("drizzle:IsDrizzleView"),Tn=class{static[z]="View";[ir];[Hk]=!0;constructor({name:e,schema:t,selectedFields:n,query:a}){this[ir]={name:e,originalName:e,schema:t,selectedFields:n,query:a,isExisting:!a,isAlias:!1}}getSQL(){return new je([this])}};Ht.prototype.getSQL=function(){return new je([this])};$e.prototype.getSQL=function(){return new je([this])};Mr.prototype.getSQL=function(){return new je([this])}});function nd(r,e){return new Proxy(r,new kl(e,!1))}function is(r,e){return new Proxy(r,new ki(new Proxy(r.table,new kl(e,!1))))}function yA(r,e){return new je.Aliased(ad(r.sql,e),r.fieldAlias)}function ad(r,e){return B.join(r.queryChunks.map(t=>pe(t,Ht)?is(t,e):pe(t,je)?ad(t,e):pe(t,je.Aliased)?yA(t,e):t))}var ki,kl,Qk,Mf=G(()=>{ss();Te();Br();Un();ks();ki=class{constructor(e){this.table=e}static[z]="ColumnAliasProxyHandler";get(e,t){return t==="table"?this.table:e[t]}},kl=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[z]="TableAliasProxyHandler";get(e,t){if(t===$e.Symbol.IsAlias)return!0;if(t===$e.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===$e.Symbol.OriginalName)return this.alias;if(t===ir)return{...e[ir],name:this.alias,isAlias:!0};if(t===$e.Symbol.Columns){let a=e[$e.Symbol.Columns];if(!a)return a;let s={};return Object.keys(a).map(o=>{s[o]=new Proxy(a[o],new ki(new Proxy(e,this)))}),s}let n=e[t];return pe(n,Ht)?new Proxy(n,new ki(new Proxy(e,this))):n}},Qk=class{constructor(e){this.alias=e}static[z]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?nd(e.sourceTable,this.alias):e[t]}}});var tr,_o=G(()=>{Mf();ss();Te();Br();os();ks();tr=class r{static[z]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===ir)return{...e[ir],selectedFields:new Proxy(e[ir].selectedFields,this)};if(typeof t=="symbol")return e[t];let a=(pe(e,Mr)?e._.selectedFields:pe(e,Tn)?e[ir].selectedFields:e)[t];if(pe(a,je.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!a.isSelectionField)return a.sql;let s=a.clone();return s.isSelectionField=!0,s}if(pe(a,je)){if(this.config.sqlBehavior==="sql")return a;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return pe(a,Ht)?this.config.alias?new Proxy(a,new ki(new Proxy(a.table,new kl(this.config.alias,this.config.replaceOriginalName??!1)))):a:typeof a!="object"||a===null?a:new Proxy(a,new r(this.config))}}});function Jk(r,e,t){let n={},a=r.reduce((s,{path:o,field:i},u)=>{let c;pe(i,Ht)?c=i:pe(i,je)?c=i.decoder:c=i.sql.decoder;let p=s;for(let[m,f]of o.entries())if(m<o.length-1)f in p||(p[f]={}),p=p[f];else{let g=e[u],y=p[f]=g===null?null:c.mapFromDriverValue(g);if(t&&pe(i,Ht)&&o.length===2){let C=o[0];C in n?typeof n[C]=="string"&&n[C]!==Mn(i.table)&&(n[C]=!1):n[C]=y===null?Mn(i.table):!1}}return s},{});if(t&&Object.keys(n).length>0)for(let[s,o]of Object.entries(n))typeof o=="string"&&!t[o]&&(a[s]=null);return a}function ha(r,e){return Object.entries(r).reduce((t,[n,a])=>{if(typeof n!="string")return t;let s=e?[...e,n]:[n];return pe(a,Ht)||pe(a,je)||pe(a,je.Aliased)?t.push({path:s,field:a}):pe(a,$e)?t.push(...ha(a[$e.Symbol.Columns],s)):t.push(...ha(a,s)),t},[])}function sd(r,e){let t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(let[a,s]of t.entries())if(s!==n[a])return!1;return!0}function Uf(r,e){let t=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,a])=>pe(a,je)||pe(a,Ht)?[n,a]:[n,new Bn(a,r[$e.Symbol.Columns][n])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function Kk(r,e){for(let t of e)for(let n of Object.getOwnPropertyNames(t.prototype))n!=="constructor"&&Object.defineProperty(r.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))}function Di(r){return r[$e.Symbol.Columns]}function Xk(r){return r[ir].selectedFields}function Ms(r){return pe(r,Mr)?r._.alias:pe(r,Tn)?r[ir].name:pe(r,je)?void 0:r[$e.Symbol.IsAlias]?r[$e.Symbol.Name]:r[$e.Symbol.BaseName]}function jt(r,e){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:e}}function Yk(r){if(typeof r!="object"||r===null||r.constructor.name!=="Object")return!1;if("logger"in r){let e=typeof r.logger;return!(e!=="boolean"&&(e!=="object"||typeof r.logger.logQuery!="function")&&e!=="undefined")}if("schema"in r){let e=typeof r.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in r){let e=typeof r.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in r)return!(r.mode!=="default"||r.mode!=="planetscale"||r.mode!==void 0);if("connection"in r){let e=typeof r.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in r){let e=typeof r.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(r).length===0}var rr=G(()=>{ss();Te();Br();os();Un();ks()});var od,Zk=G(()=>{Te();Ls();_o();Un();js();rr();od=class extends fn{constructor(e,t,n,a){super(),this.session=t,this.dialect=n,this.config={table:e,withList:a}}static[z]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[$e.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ha(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return or.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>or.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new tr({alias:Mn(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}});function BX(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function FX(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,n,a)=>{let s=a===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return t+s},"")}function qX(r){return r}var Bf,eD=G(()=>{Te();Un();Bf=class{static[z]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?BX:e==="camelCase"?FX:qX}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[$e.Symbol.Schema]??"public",n=e.table[$e.Symbol.OriginalName],a=`${t}.${n}.${e.name}`;return this.cache[a]||this.cacheTable(e.table),this.cache[a]}cacheTable(e){let t=e[$e.Symbol.Schema]??"public",n=e[$e.Symbol.OriginalName],a=`${t}.${n}`;if(!this.cachedTables[a]){for(let s of Object.values(e[$e.Symbol.Columns])){let o=`${a}.${s.name}`;this.cache[o]=this.convert(s.name)}this.cachedTables[a]=!0}}clearCache(){this.cache={},this.cachedTables={}}}});var id,Ff,qf=G(()=>{Te();id=class extends Error{static[z]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Ff=class extends id{static[z]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}});var Us,cd=G(()=>{Te();$t();Us=class extends Ge{static[z]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:t,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}});function tD(r,e){let{name:t,config:n}=jt(r,e);return n.mode==="number"?new bA(t):new EA(t)}var bA,vA,EA,CA,AA=G(()=>{Te();rr();$t();cd();bA=class extends Us{static[z]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new vA(e,this.config)}},vA=class extends we{static[z]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},EA=class extends Us{static[z]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new CA(e,this.config)}},CA=class extends we{static[z]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}}});function rD(r,e){let{name:t,config:n}=jt(r,e);return n.mode==="number"?new SA(t):new wA(t)}var SA,RA,wA,IA,xA=G(()=>{Te();rr();$t();SA=class extends Ge{static[z]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new RA(e,this.config)}},RA=class extends we{static[z]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},wA=class extends Ge{static[z]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new IA(e,this.config)}},IA=class extends we{static[z]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}}});function Yt(r){return new TA(r??"")}var TA,OA,NA=G(()=>{Te();$t();TA=class extends Ge{static[z]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new OA(e,this.config)}},OA=class extends we{static[z]="PgBoolean";getSQLType(){return"boolean"}}});function nD(r,e={}){let{name:t,config:n}=jt(r,e);return new _A(t,n)}var _A,PA,$A=G(()=>{Te();rr();$t();_A=class extends Ge{static[z]="PgCharBuilder";constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new PA(e,this.config)}},PA=class extends we{static[z]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}});function aD(r){return new LA(r??"")}var LA,jA,kA=G(()=>{Te();$t();LA=class extends Ge{static[z]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new jA(e,this.config)}},jA=class extends we{static[z]="PgCidr";getSQLType(){return"cidr"}}});function sD(r){return(e,t)=>{let{name:n,config:a}=jt(e,t);return new DA(n,a,r)}}var DA,MA,UA=G(()=>{Te();rr();$t();DA=class extends Ge{static[z]="PgCustomColumnBuilder";constructor(e,t,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=n}build(e){return new MA(e,this.config)}},MA=class extends we{static[z]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}}});var cs,Gf=G(()=>{Te();Br();$t();cs=class extends Ge{static[z]="PgDateColumnBaseBuilder";defaultNow(){return this.default(B`now()`)}}});function oD(r,e){let{name:t,config:n}=jt(r,e);return n?.mode==="date"?new BA(t):new FA(t)}var BA,ld,FA,ud,qA=G(()=>{Te();rr();$t();Gf();BA=class extends cs{static[z]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new ld(e,this.config)}},ld=class extends we{static[z]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},FA=class extends cs{static[z]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ud(e,this.config)}},ud=class extends we{static[z]="PgDateString";getSQLType(){return"date"}}});function iD(r){return new GA(r??"")}var GA,VA,zA=G(()=>{Te();$t();GA=class extends Ge{static[z]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new VA(e,this.config)}},VA=class extends we{static[z]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}}});function cD(r){return new HA(r??"")}var HA,WA,QA=G(()=>{Te();$t();HA=class extends Ge{static[z]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new WA(e,this.config)}},WA=class extends we{static[z]="PgInet";getSQLType(){return"inet"}}});function X(r){return new JA(r??"")}var JA,KA,XA=G(()=>{Te();$t();cd();JA=class extends Us{static[z]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new KA(e,this.config)}},KA=class extends we{static[z]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}}});function lD(r,e={}){let{name:t,config:n}=jt(r,e);return new YA(t,n)}var YA,ZA,e0=G(()=>{Te();rr();$t();YA=class extends Ge{static[z]="PgIntervalBuilder";constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new ZA(e,this.config)}},ZA=class extends we{static[z]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",t=this.precision?`(${this.precision})`:"";return`interval${e}${t}`}}});function uD(r){return new t0(r??"")}var t0,pd,r0=G(()=>{Te();$t();t0=class extends Ge{static[z]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new pd(e,this.config)}},pd=class extends we{static[z]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}}});function Ne(r){return new n0(r??"")}var n0,dd,a0=G(()=>{Te();$t();n0=class extends Ge{static[z]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new dd(e,this.config)}},dd=class extends we{static[z]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}}});function pD(r,e){let{name:t,config:n}=jt(r,e);return!n?.mode||n.mode==="tuple"?new s0(t):new i0(t)}var s0,o0,i0,c0,l0=G(()=>{Te();rr();$t();s0=class extends Ge{static[z]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new o0(e,this.config)}},o0=class extends we{static[z]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[t,n,a]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(n),Number.parseFloat(a)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},i0=class extends Ge{static[z]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new c0(e,this.config)}},c0=class extends we{static[z]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[t,n,a]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(n),c:Number.parseFloat(a)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}}});function dD(r){return new u0(r??"")}var u0,p0,d0=G(()=>{Te();$t();u0=class extends Ge{static[z]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new p0(e,this.config)}},p0=class extends we{static[z]="PgMacaddr";getSQLType(){return"macaddr"}}});function mD(r){return new m0(r??"")}var m0,h0,f0=G(()=>{Te();$t();m0=class extends Ge{static[z]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new h0(e,this.config)}},h0=class extends we{static[z]="PgMacaddr8";getSQLType(){return"macaddr8"}}});function hD(r,e){let{name:t,config:n}=jt(r,e);return new g0(t,n?.precision,n?.scale)}var g0,md,y0=G(()=>{Te();rr();$t();g0=class extends Ge{static[z]="PgNumericBuilder";constructor(e,t,n){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=n}build(e){return new md(e,this.config)}},md=class extends we{static[z]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}});function fD(r,e){let{name:t,config:n}=jt(r,e);return!n?.mode||n.mode==="tuple"?new b0(t):new E0(t)}var b0,v0,E0,C0,A0=G(()=>{Te();rr();$t();b0=class extends Ge{static[z]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new v0(e,this.config)}},v0=class extends we{static[z]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,n]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},E0=class extends Ge{static[z]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new C0(e,this.config)}},C0=class extends we{static[z]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}}});function GX(r){let e=[];for(let t=0;t<r.length;t+=2)e.push(Number.parseInt(r.slice(t,t+2),16));return new Uint8Array(e)}function gD(r,e){let t=new ArrayBuffer(8),n=new DataView(t);for(let a=0;a<8;a++)n.setUint8(a,r[e+a]);return n.getFloat64(0,!0)}function S0(r){let e=GX(r),t=0,n=e[t];t+=1;let a=new DataView(e.buffer),s=a.getUint32(t,n===1);t+=4;let o;if(s&536870912&&(o=a.getUint32(t,n===1),t+=4),(s&65535)===1){let i=gD(e,t);t+=8;let u=gD(e,t);return t+=8,[i,u]}throw new Error("Unsupported geometry type")}var yD=G(()=>{});function bD(r,e){let{name:t,config:n}=jt(r,e);return!n?.mode||n.mode==="tuple"?new R0(t):new I0(t)}var R0,w0,I0,x0,T0=G(()=>{Te();rr();$t();yD();R0=class extends Ge{static[z]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new w0(e,this.config)}},w0=class extends we{static[z]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return S0(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},I0=class extends Ge{static[z]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new x0(e,this.config)}},x0=class extends we{static[z]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=S0(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}}});function vD(r){return new O0(r??"")}var O0,N0,_0=G(()=>{Te();$t();O0=class extends Ge{static[z]="PgRealBuilder";constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new N0(e,this.config)}},N0=class extends we{static[z]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e}});function ut(r){return new P0(r??"")}var P0,$0,L0=G(()=>{Te();$t();P0=class extends Ge{static[z]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new $0(e,this.config)}},$0=class extends we{static[z]="PgSerial";getSQLType(){return"serial"}}});function ED(r){return new j0(r??"")}var j0,k0,D0=G(()=>{Te();$t();cd();j0=class extends Us{static[z]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new k0(e,this.config)}},k0=class extends we{static[z]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e}});function CD(r){return new M0(r??"")}var M0,U0,B0=G(()=>{Te();$t();M0=class extends Ge{static[z]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new U0(e,this.config)}},U0=class extends we{static[z]="PgSmallSerial";getSQLType(){return"smallserial"}}});function K(r,e={}){let{name:t,config:n}=jt(r,e);return new F0(t,n)}var F0,q0,G0=G(()=>{Te();rr();$t();F0=class extends Ge{static[z]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new q0(e,this.config)}},q0=class extends we{static[z]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}});function AD(r,e={}){let{name:t,config:n}=jt(r,e);return new V0(t,n.withTimezone??!1,n.precision)}var V0,hd,z0=G(()=>{Te();rr();$t();Gf();V0=class extends cs{constructor(e,t,n){super(e,"string","PgTime"),this.withTimezone=t,this.precision=n,this.config.withTimezone=t,this.config.precision=n}static[z]="PgTimeBuilder";build(e){return new hd(e,this.config)}},hd=class extends we{static[z]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}});function qe(r,e={}){let{name:t,config:n}=jt(r,e);return n?.mode==="string"?new W0(t,n.withTimezone??!1,n.precision):new H0(t,n?.withTimezone??!1,n?.precision)}var H0,fd,W0,gd,Q0=G(()=>{Te();rr();$t();Gf();H0=class extends cs{static[z]="PgTimestampBuilder";constructor(e,t,n){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=n}build(e){return new fd(e,this.config)}},fd=class extends we{static[z]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},W0=class extends cs{static[z]="PgTimestampStringBuilder";constructor(e,t,n){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=n}build(e){return new gd(e,this.config)}},gd=class extends we{static[z]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}});function SD(r){return new J0(r??"")}var J0,yd,K0=G(()=>{Te();Br();$t();J0=class extends Ge{static[z]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(B`gen_random_uuid()`)}build(e){return new yd(e,this.config)}},yd=class extends we{static[z]="PgUUID";getSQLType(){return"uuid"}}});function Vf(r,e={}){let{name:t,config:n}=jt(r,e);return new X0(t,n)}var X0,Y0,Z0=G(()=>{Te();rr();$t();X0=class extends Ge{static[z]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new Y0(e,this.config)}},Y0=class extends we{static[z]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}});function RD(r,e){let{name:t,config:n}=jt(r,e);return new eS(t,n)}var eS,tS,rS=G(()=>{Te();rr();$t();eS=class extends Ge{static[z]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new tS(e,this.config)}},tS=class extends we{static[z]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}});function wD(r,e){let{name:t,config:n}=jt(r,e);return new nS(t,n)}var nS,aS,sS=G(()=>{Te();rr();$t();nS=class extends Ge{static[z]="PgHalfVectorBuilder";constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new aS(e,this.config)}},aS=class extends we{static[z]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}}});function ID(r,e){let{name:t,config:n}=jt(r,e);return new oS(t,n)}var oS,iS,cS=G(()=>{Te();rr();$t();oS=class extends Ge{static[z]="PgSparseVectorBuilder";constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new iS(e,this.config)}},iS=class extends we{static[z]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}});function xD(r,e){let{name:t,config:n}=jt(r,e);return new lS(t,n)}var lS,uS,pS=G(()=>{Te();rr();$t();lS=class extends Ge{static[z]="PgVectorBuilder";constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new uS(e,this.config)}},uS=class extends we{static[z]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}}});var zf=G(()=>{AA();xA();NA();$A();kA();$t();UA();qA();zA();jf();QA();cd();XA();e0();r0();a0();l0();d0();f0();y0();A0();T0();_0();L0();D0();B0();G0();z0();Q0();K0();Z0();rS();sS();cS();pS()});function TD(){return{bigint:tD,bigserial:rD,boolean:Yt,char:nD,cidr:aD,customType:sD,date:oD,doublePrecision:iD,inet:cD,integer:X,interval:lD,json:uD,jsonb:Ne,line:pD,macaddr:dD,macaddr8:mD,numeric:hD,point:fD,geometry:bD,real:vD,serial:ut,smallint:ED,smallserial:CD,text:K,time:AD,timestamp:qe,uuid:SD,varchar:Vf,bit:RD,halfvec:wD,sparsevec:ID,vector:xD}}var OD=G(()=>{AA();xA();NA();$A();kA();UA();qA();zA();QA();XA();e0();r0();a0();l0();d0();f0();y0();A0();T0();_0();L0();D0();B0();G0();z0();Q0();K0();Z0();rS();sS();cS();pS()});function mS(r,e,t,n,a=r){let s=new rn(r,n,a),o=typeof e=="function"?e(TD()):e,i=Object.fromEntries(Object.entries(o).map(([p,m])=>{let f=m;f.setName(p);let g=f.build(s);return s[dS].push(...f.buildForeignKeys(g,s)),[p,g]})),u=Object.fromEntries(Object.entries(o).map(([p,m])=>{let f=m;f.setName(p);let g=f.buildExtraConfigColumn(s);return[p,g]})),c=Object.assign(s,i);return c[$e.Symbol.Columns]=i,c[$e.Symbol.ExtraConfigColumns]=u,t&&(c[rn.Symbol.ExtraConfigBuilder]=t),Object.assign(c,{enableRLS:()=>(c[rn.Symbol.EnableRLS]=!0,c)})}var dS,ND,rn,ot,Mi=G(()=>{Te();Un();OD();dS=Symbol.for("drizzle:PgInlineForeignKeys"),ND=Symbol.for("drizzle:EnableRLS"),rn=class extends $e{static[z]="PgTable";static Symbol=Object.assign({},$e.Symbol,{InlineForeignKeys:dS,EnableRLS:ND});[dS]=[];[ND]=!1;[$e.Symbol.ExtraConfigBuilder]=void 0};ot=(r,e,t)=>mS(r,e,t,void 0)});var Hf,hS,fS=G(()=>{Te();Mi();Hf=class{static[z]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new hS(e,this.columns,this.name)}},hS=class{constructor(e,t,n){this.table=e,this.columns=t,this.name=n}static[z]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[rn.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}}});function Fn(r,e){return Gk(e)&&!fA(r)&&!pe(r,Bn)&&!pe(r,Ds)&&!pe(r,Ht)&&!pe(r,$e)&&!pe(r,Tn)?new Bn(r,e):r}function Zt(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new je(e):new je([new Ur("("),B.join(e,new Ur(" and ")),new Ur(")")])}function PD(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new je(e):new je([new Ur("("),B.join(e,new Ur(" or ")),new Ur(")")])}function $D(r){return B`not ${r}`}function MD(r,e){return Array.isArray(e)?e.length===0?B`false`:B`${r} in ${e.map(t=>Fn(t,r))}`:B`${r} in ${Fn(e,r)}`}function UD(r,e){return Array.isArray(e)?e.length===0?B`true`:B`${r} not in ${e.map(t=>Fn(t,r))}`:B`${r} not in ${Fn(e,r)}`}function Dl(r){return B`${r} is null`}function BD(r){return B`${r} is not null`}function FD(r){return B`exists ${r}`}function qD(r){return B`not exists ${r}`}function GD(r,e,t){return B`${r} between ${Fn(e,r)} and ${Fn(t,r)}`}function VD(r,e,t){return B`${r} not between ${Fn(e,r)} and ${Fn(t,r)}`}function zD(r,e){return B`${r} like ${e}`}function HD(r,e){return B`${r} not like ${e}`}function WD(r,e){return B`${r} ilike ${e}`}function QD(r,e){return B`${r} not ilike ${e}`}var q,_D,LD,jD,kD,DD,JD=G(()=>{ss();Te();Un();Br();q=(r,e)=>B`${r} = ${Fn(e,r)}`,_D=(r,e)=>B`${r} <> ${Fn(e,r)}`;LD=(r,e)=>B`${r} > ${Fn(e,r)}`,jD=(r,e)=>B`${r} >= ${Fn(e,r)}`,kD=(r,e)=>B`${r} < ${Fn(e,r)}`,DD=(r,e)=>B`${r} <= ${Fn(e,r)}`});function mr(r){return B`${r} asc`}function ft(r){return B`${r} desc`}var KD=G(()=>{Br()});var Wf=G(()=>{JD();KD()});function XD(){return{and:Zt,between:GD,eq:q,exists:FD,gt:LD,gte:jD,ilike:WD,inArray:MD,isNull:Dl,isNotNull:BD,like:zD,lt:kD,lte:DD,ne:_D,not:$D,notBetween:VD,notExists:qD,notLike:HD,notIlike:QD,notInArray:UD,or:PD,sql:B}}function YD(){return{sql:B,asc:mr,desc:ft}}function ZD(r,e){Object.keys(r).length===1&&"default"in r&&!pe(r.default,$e)&&(r=r.default);let t={},n={},a={};for(let[s,o]of Object.entries(r))if(pe(o,$e)){let i=ji(o),u=n[i];t[i]=s,a[s]={tsName:s,dbName:o[$e.Symbol.Name],schema:o[$e.Symbol.Schema],columns:o[$e.Symbol.Columns],relations:u?.relations??{},primaryKey:u?.primaryKey??[]};for(let p of Object.values(o[$e.Symbol.Columns]))p.primary&&a[s].primaryKey.push(p);let c=o[$e.Symbol.ExtraConfigBuilder]?.(o[$e.Symbol.ExtraConfigColumns]);if(c)for(let p of Object.values(c))pe(p,Hf)&&a[s].primaryKey.push(...p.columns)}else if(pe(o,gS)){let i=ji(o.table),u=t[i],c=o.config(e(o.table)),p;for(let[m,f]of Object.entries(c))if(u){let g=a[u];g.relations[m]=f,p&&g.primaryKey.push(...p)}else i in n||(n[i]={relations:{},primaryKey:p}),n[i].relations[m]=f}return{tables:a,tableNamesMap:t}}function VX(r){return function(t,n){return new Po(r,t,n,n?.fields.reduce((a,s)=>a&&s.notNull,!0)??!1)}}function zX(r){return function(t,n){return new bd(r,t,n)}}function eM(r,e,t){if(pe(t,Po)&&t.config)return{fields:t.config.fields,references:t.config.references};let n=e[ji(t.referencedTable)];if(!n)throw new Error(`Table "${t.referencedTable[$e.Symbol.Name]}" not found in schema`);let a=r[n];if(!a)throw new Error(`Table "${n}" not found in schema`);let s=t.sourceTable,o=e[ji(s)];if(!o)throw new Error(`Table "${s[$e.Symbol.Name]}" not found in schema`);let i=[];for(let u of Object.values(a.relations))(t.relationName&&t!==u&&u.relationName===t.relationName||!t.relationName&&u.referencedTable===t.sourceTable)&&i.push(u);if(i.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${n}"`):new Error(`There are multiple relations between "${n}" and "${t.sourceTable[$e.Symbol.Name]}". Please specify relation name`);if(i[0]&&pe(i[0],Po)&&i[0].config)return{fields:i[0].config.references,references:i[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${t.fieldName}"`)}function tM(r){return{one:VX(r),many:zX(r)}}function Jf(r,e,t,n,a=s=>s){let s={};for(let[o,i]of n.entries())if(i.isJson){let u=e.relations[i.tsKey],c=t[o],p=typeof c=="string"?JSON.parse(c):c;s[i.tsKey]=pe(u,Po)?p&&Jf(r,r[i.relationTableTsKey],p,i.selection,a):p.map(m=>Jf(r,r[i.relationTableTsKey],m,i.selection,a))}else{let u=a(t[o]),c=i.field,p;pe(c,Ht)?p=c:pe(c,je)?p=c.decoder:p=c.sql.decoder,s[i.tsKey]=u===null?null:p.mapFromDriverValue(u)}return s}var Qf,gS,Po,bd,vd=G(()=>{Un();ss();Te();fS();Wf();Br();Qf=class{constructor(e,t,n){this.sourceTable=e,this.referencedTable=t,this.relationName=n,this.referencedTableName=t[$e.Symbol.Name]}static[z]="Relation";referencedTableName;fieldName},gS=class{constructor(e,t){this.table=e,this.config=t}static[z]="Relations"},Po=class r extends Qf{constructor(e,t,n,a){super(e,t,n?.relationName),this.config=n,this.isNullable=a}static[z]="One";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},bd=class r extends Qf{constructor(e,t,n){super(e,t,n?.relationName),this.config=n}static[z]="Many";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}}});var rM=G(()=>{});var nM=G(()=>{});var aM=G(()=>{rM();nM()});var Kf=G(()=>{Wf();aM();Br()});var Bs,Xf=G(()=>{Te();Br();Bs=class extends Tn{static[z]="PgViewBase"}});var $o,Yf=G(()=>{Mf();eD();ss();Te();qf();zf();Mi();vd();Kf();Br();os();Un();rr();ks();Xf();$o=class{static[z]="PgDialect";casing;constructor(e){this.casing=new Bf(e?.casing)}async migrate(e,t,n){let a=typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",s=typeof n=="string"?"drizzle":n.migrationsSchema??"drizzle",o=B`
			CREATE TABLE IF NOT EXISTS ${B.identifier(s)}.${B.identifier(a)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(B`CREATE SCHEMA IF NOT EXISTS ${B.identifier(s)}`),await t.execute(o);let u=(await t.all(B`select id, hash, created_at from ${B.identifier(s)}.${B.identifier(a)} order by created_at desc limit 1`))[0];await t.transaction(async c=>{for await(let p of e)if(!u||Number(u.created_at)<p.folderMillis){for(let m of p.sql)await c.execute(B.raw(m));await c.execute(B`insert into ${B.identifier(s)}.${B.identifier(a)} ("hash", "created_at") values(${p.hash}, ${p.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[B`with `];for(let[n,a]of e.entries())t.push(B`${B.identifier(a._.alias)} as (${a._.sql})`),n<e.length-1&&t.push(B`, `);return t.push(B` `),B.join(t)}buildDeleteQuery({table:e,where:t,returning:n,withList:a}){let s=this.buildWithCTE(a),o=n?B` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,i=t?B` where ${t}`:void 0;return B`${s}delete from ${e}${i}${o}`}buildUpdateSet(e,t){let n=e[$e.Symbol.Columns],a=Object.keys(n).filter(o=>t[o]!==void 0||n[o]?.onUpdateFn!==void 0),s=a.length;return B.join(a.flatMap((o,i)=>{let u=n[o],c=t[o]??B.param(u.onUpdateFn(),u),p=B`${B.identifier(this.casing.getColumnCasing(u))} = ${c}`;return i<s-1?[p,B.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:t,where:n,returning:a,withList:s,from:o,joins:i}){let u=this.buildWithCTE(s),c=e[rn.Symbol.Name],p=e[rn.Symbol.Schema],m=e[rn.Symbol.OriginalName],f=c===m?void 0:c,g=B`${p?B`${B.identifier(p)}.`:void 0}${B.identifier(m)}${f&&B` ${B.identifier(f)}`}`,y=this.buildUpdateSet(e,t),C=o&&B.join([B.raw(" from "),this.buildFromTable(o)]),A=this.buildJoins(i),T=a?B` returning ${this.buildSelection(a,{isSingleTable:!o})}`:void 0,E=n?B` where ${n}`:void 0;return B`${u}update ${g} set ${y}${C}${A}${E}${T}`}buildSelection(e,{isSingleTable:t=!1}={}){let n=e.length,a=e.flatMap(({field:s},o)=>{let i=[];if(pe(s,je.Aliased)&&s.isSelectionField)i.push(B.identifier(s.fieldAlias));else if(pe(s,je.Aliased)||pe(s,je)){let u=pe(s,je.Aliased)?s.sql:s;t?i.push(new je(u.queryChunks.map(c=>pe(c,we)?B.identifier(this.casing.getColumnCasing(c)):c))):i.push(u),pe(s,je.Aliased)&&i.push(B` as ${B.identifier(s.fieldAlias)}`)}else pe(s,Ht)&&(t?i.push(B.identifier(this.casing.getColumnCasing(s))):i.push(s));return o<n-1&&i.push(B`, `),i});return B.join(a)}buildJoins(e){if(!e||e.length===0)return;let t=[];for(let[n,a]of e.entries()){n===0&&t.push(B` `);let s=a.table,o=a.lateral?B` lateral`:void 0;if(pe(s,rn)){let i=s[rn.Symbol.Name],u=s[rn.Symbol.Schema],c=s[rn.Symbol.OriginalName],p=i===c?void 0:a.alias;t.push(B`${B.raw(a.joinType)} join${o} ${u?B`${B.identifier(u)}.`:void 0}${B.identifier(c)}${p&&B` ${B.identifier(p)}`} on ${a.on}`)}else if(pe(s,Tn)){let i=s[ir].name,u=s[ir].schema,c=s[ir].originalName,p=i===c?void 0:a.alias;t.push(B`${B.raw(a.joinType)} join${o} ${u?B`${B.identifier(u)}.`:void 0}${B.identifier(c)}${p&&B` ${B.identifier(p)}`} on ${a.on}`)}else t.push(B`${B.raw(a.joinType)} join${o} ${s} on ${a.on}`);n<e.length-1&&t.push(B` `)}return B.join(t)}buildFromTable(e){if(pe(e,$e)&&e[$e.Symbol.OriginalName]!==e[$e.Symbol.Name]){let t=B`${B.identifier(e[$e.Symbol.OriginalName])}`;return e[$e.Symbol.Schema]&&(t=B`${B.identifier(e[$e.Symbol.Schema])}.${t}`),B`${t} ${B.identifier(e[$e.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:n,where:a,having:s,table:o,joins:i,orderBy:u,groupBy:c,limit:p,offset:m,lockingClause:f,distinct:g,setOperators:y}){let C=n??ha(t);for(let N of C)if(pe(N.field,Ht)&&Mn(N.field.table)!==(pe(o,Mr)?o._.alias:pe(o,Bs)?o[ir].name:pe(o,je)?void 0:Mn(o))&&!(P=>i?.some(({alias:L})=>L===(P[$e.Symbol.IsAlias]?Mn(P):P[$e.Symbol.BaseName])))(N.field.table)){let P=Mn(N.field.table);throw new Error(`Your "${N.path.join("->")}" field references a column "${P}"."${N.field.name}", but the table "${P}" is not part of the query! Did you forget to join it?`)}let A=!i||i.length===0,T=this.buildWithCTE(e),E;g&&(E=g===!0?B` distinct`:B` distinct on (${B.join(g.on,B`, `)})`);let d=this.buildSelection(C,{isSingleTable:A}),l=this.buildFromTable(o),h=this.buildJoins(i),v=a?B` where ${a}`:void 0,S=s?B` having ${s}`:void 0,R;u&&u.length>0&&(R=B` order by ${B.join(u,B`, `)}`);let x;c&&c.length>0&&(x=B` group by ${B.join(c,B`, `)}`);let w=typeof p=="object"||typeof p=="number"&&p>=0?B` limit ${p}`:void 0,O=m?B` offset ${m}`:void 0,I=B.empty();if(f){let N=B` for ${B.raw(f.strength)}`;f.config.of&&N.append(B` of ${B.join(Array.isArray(f.config.of)?f.config.of:[f.config.of],B`, `)}`),f.config.noWait?N.append(B` no wait`):f.config.skipLocked&&N.append(B` skip locked`),I.append(N)}let _=B`${T}select${E} ${d} from ${l}${h}${v}${x}${S}${R}${w}${O}${I}`;return y.length>0?this.buildSetOperations(_,y):_}buildSetOperations(e,t){let[n,...a]=t;if(!n)throw new Error("Cannot pass undefined values to any set operator");return a.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),a)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:n,rightSelect:a,limit:s,orderBy:o,offset:i}}){let u=B`(${e.getSQL()}) `,c=B`(${a.getSQL()})`,p;if(o&&o.length>0){let y=[];for(let C of o)if(pe(C,we))y.push(B.identifier(C.name));else if(pe(C,je)){for(let A=0;A<C.queryChunks.length;A++){let T=C.queryChunks[A];pe(T,we)&&(C.queryChunks[A]=B.identifier(T.name))}y.push(B`${C}`)}else y.push(B`${C}`);p=B` order by ${B.join(y,B`, `)} `}let m=typeof s=="object"||typeof s=="number"&&s>=0?B` limit ${s}`:void 0,f=B.raw(`${t} ${n?"all ":""}`),g=i?B` offset ${i}`:void 0;return B`${u}${f}${c}${p}${m}${g}`}buildInsertQuery({table:e,values:t,onConflict:n,returning:a,withList:s,select:o,overridingSystemValue_:i}){let u=[],c=e[$e.Symbol.Columns],p=Object.entries(c).filter(([T,E])=>!E.shouldDisableInsert()),m=p.map(([,T])=>B.identifier(this.casing.getColumnCasing(T)));if(o){let T=t;pe(T,je)?u.push(T):u.push(T.getSQL())}else{let T=t;u.push(B.raw("values "));for(let[E,d]of T.entries()){let l=[];for(let[h,v]of p){let S=d[h];if(S===void 0||pe(S,Bn)&&S.value===void 0)if(v.defaultFn!==void 0){let R=v.defaultFn(),x=pe(R,je)?R:B.param(R,v);l.push(x)}else if(!v.default&&v.onUpdateFn!==void 0){let R=v.onUpdateFn(),x=pe(R,je)?R:B.param(R,v);l.push(x)}else l.push(B`default`);else l.push(S)}u.push(l),E<T.length-1&&u.push(B`, `)}}let f=this.buildWithCTE(s),g=B.join(u),y=a?B` returning ${this.buildSelection(a,{isSingleTable:!0})}`:void 0,C=n?B` on conflict ${n}`:void 0,A=i===!0?B`overriding system value `:void 0;return B`${f}insert into ${e} ${m} ${A}${g}${C}${y}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:n}){let a=t?B` concurrently`:void 0,s=n?B` with no data`:void 0;return B`refresh materialized view${a} ${e}${s}`}prepareTyping(e){return pe(e,dd)||pe(e,pd)?"json":pe(e,md)?"decimal":pe(e,hd)?"time":pe(e,fd)||pe(e,gd)?"timestamp":pe(e,ld)||pe(e,ud)?"date":pe(e,yd)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:n,table:a,tableConfig:s,queryConfig:o,tableAlias:i,nestedQueryRelation:u,joinOn:c}){let p=[],m,f,g=[],y,C=[];if(o===!0)p=Object.entries(s.columns).map(([E,d])=>({dbKey:d.name,tsKey:E,field:is(d,i),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let T=Object.fromEntries(Object.entries(s.columns).map(([S,R])=>[S,is(R,i)]));if(o.where){let S=typeof o.where=="function"?o.where(T,XD()):o.where;y=S&&ad(S,i)}let E=[],d=[];if(o.columns){let S=!1;for(let[R,x]of Object.entries(o.columns))x!==void 0&&R in s.columns&&(!S&&x===!0&&(S=!0),d.push(R));d.length>0&&(d=S?d.filter(R=>o.columns?.[R]===!0):Object.keys(s.columns).filter(R=>!d.includes(R)))}else d=Object.keys(s.columns);for(let S of d){let R=s.columns[S];E.push({tsKey:S,value:R})}let l=[];o.with&&(l=Object.entries(o.with).filter(S=>!!S[1]).map(([S,R])=>({tsKey:S,queryConfig:R,relation:s.relations[S]})));let h;if(o.extras){h=typeof o.extras=="function"?o.extras(T,{sql:B}):o.extras;for(let[S,R]of Object.entries(h))E.push({tsKey:S,value:yA(R,i)})}for(let{tsKey:S,value:R}of E)p.push({dbKey:pe(R,je.Aliased)?R.fieldAlias:s.columns[S].name,tsKey:S,field:pe(R,Ht)?is(R,i):R,relationTableTsKey:void 0,isJson:!1,selection:[]});let v=typeof o.orderBy=="function"?o.orderBy(T,YD()):o.orderBy??[];Array.isArray(v)||(v=[v]),g=v.map(S=>pe(S,Ht)?is(S,i):ad(S,i)),m=o.limit,f=o.offset;for(let{tsKey:S,queryConfig:R,relation:x}of l){let w=eM(t,n,x),O=ji(x.referencedTable),I=n[O],_=`${i}_${S}`,N=Zt(...w.fields.map((j,$)=>q(is(w.references[$],_),is(j,i)))),P=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:n,table:e[I],tableConfig:t[I],queryConfig:pe(x,Po)?R===!0?{limit:1}:{...R,limit:1}:R,tableAlias:_,joinOn:N,nestedQueryRelation:x}),L=B`${B.identifier(_)}.${B.identifier("data")}`.as(S);C.push({on:B`true`,table:new Mr(P.sql,{},_),alias:_,joinType:"left",lateral:!0}),p.push({dbKey:S,tsKey:S,field:L,relationTableTsKey:I,isJson:!0,selection:P.selection})}}if(p.length===0)throw new id({message:`No fields selected for table "${s.tsName}" ("${i}")`});let A;if(y=Zt(c,y),u){let T=B`json_build_array(${B.join(p.map(({field:l,tsKey:h,isJson:v})=>v?B`${B.identifier(`${i}_${h}`)}.${B.identifier("data")}`:pe(l,je.Aliased)?l.sql:l),B`, `)})`;pe(u,bd)&&(T=B`coalesce(json_agg(${T}${g.length>0?B` order by ${B.join(g,B`, `)}`:void 0}), '[]'::json)`);let E=[{dbKey:"data",tsKey:"data",field:T.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:p}];m!==void 0||f!==void 0||g.length>0?(A=this.buildSelectQuery({table:nd(a,i),fields:{},fieldsFlat:[{path:[],field:B.raw("*")}],where:y,limit:m,offset:f,orderBy:g,setOperators:[]}),y=void 0,m=void 0,f=void 0,g=[]):A=nd(a,i),A=this.buildSelectQuery({table:pe(A,rn)?A:new Mr(A,{},i),fields:{},fieldsFlat:E.map(({field:l})=>({path:[],field:pe(l,Ht)?is(l,i):l})),joins:C,where:y,limit:m,offset:f,orderBy:g,setOperators:[]})}else A=this.buildSelectQuery({table:nd(a,i),fields:{},fieldsFlat:p.map(({field:T})=>({path:[],field:pe(T,Ht)?is(T,i):T})),joins:C,where:y,limit:m,offset:f,orderBy:g,setOperators:[]});return{tableTsKey:s.tsName,sql:A,selection:p}}}});var Zf,sM=G(()=>{Te();Zf=class{static[z]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}});function Ml(r,e){return(t,n,...a)=>{let s=[n,...a].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of s)if(!sd(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(s)}}var gn,yS,eg,HX,WX,QX,JX,KX,XX,YX,bS=G(()=>{Te();Xf();sM();Ls();_o();Br();os();Un();js();rr();rr();ks();gn=class{static[z]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t=!!this.fields,n=e,a;return this.fields?a=this.fields:pe(n,Mr)?a=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):pe(n,Bs)?a=n[ir].selectedFields:pe(n,je)?a={}:a=Di(n),new eg({table:n,fields:a,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},yS=class extends Zf{static[z]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:n,session:a,dialect:s,withList:o,distinct:i}){super(),this.config={withList:o,table:e,fields:{...t},distinct:i,setOperators:[]},this.isPartialSelect=n,this.session=a,this.dialect=s,this._={selectedFields:t},this.tableName=Ms(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,n)=>{let a=this.tableName,s=Ms(t);if(typeof s=="string"&&this.config.joins?.some(o=>o.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof a=="string"&&(this.config.fields={[a]:this.config.fields}),typeof s=="string"&&!pe(t,je))){let o=pe(t,Mr)?t._.selectedFields:pe(t,Tn)?t[ir].selectedFields:t[$e.Symbol.Columns];this.config.fields[s]=o}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new tr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:t,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return n=>{let a=typeof n=="function"?n(HX()):n;if(!sd(this.getSelectedFields(),a.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:a}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new tr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new tr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new tr({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new tr({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new Mr(this.getSQL(),this.config.fields,e),new tr({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new tr({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},eg=class extends yS{static[z]="PgSelect";_prepare(e){let{session:t,config:n,dialect:a,joinsNotNullableMap:s,authToken:o}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return or.startActiveSpan("drizzle.prepareQuery",()=>{let i=ha(n.fields),u=t.prepareQuery(a.sqlToQuery(this.getSQL()),i,e,!0);return u.joinsNotNullableMap=s,u.setToken(o)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>or.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};Kk(eg,[fn]);HX=()=>({union:WX,unionAll:QX,intersect:JX,intersectAll:KX,except:XX,exceptAll:YX}),WX=Ml("union",!1),QX=Ml("union",!0),JX=Ml("intersect",!1),KX=Ml("intersect",!0),XX=Ml("except",!1),YX=Ml("except",!0)});var Fs,tg=G(()=>{Te();Yf();_o();os();bS();Fs=class{static[z]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=pe(e,$o)?e:void 0,this.dialectConfig=pe(e,$o)?void 0:e}$with=(e,t)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new jl(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new tr({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;function n(o){return new gn({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function a(o){return new gn({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function s(o,i){return new gn({fields:i??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:o}})}return{select:n,selectDistinct:a,selectDistinctOn:s}}select(e){return new gn({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new gn({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new gn({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new $o(this.dialectConfig)),this.dialect}}});var Ed,rg,oM=G(()=>{Te();Ls();_o();Br();Un();js();rr();tg();Ed=class{constructor(e,t,n,a,s){this.table=e,this.session=t,this.dialect=n,this.withList=a,this.overridingSystemValue_=s}static[z]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(n=>{let a={},s=this.table[$e.Symbol.Columns];for(let o of Object.keys(n)){let i=n[o];a[o]=pe(i,je)?i:new Bn(i,s[o])}return a});return new rg(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t=typeof e=="function"?e(new Fs):e;if(!pe(t,je)&&!sd(this.table[Df],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new rg(this.table,t,this.session,this.dialect,this.withList,!0)}},rg=class extends fn{constructor(e,t,n,a,s,o,i){super(),this.session=n,this.dialect=a,this.config={table:e,values:t,withList:s,select:o,overridingSystemValue_:i}}static[z]="PgInsert";config;returning(e=this.config.table[$e.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ha(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=B`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?B` where ${e.where}`:void 0;this.config.onConflict=B`(${B.raw(t)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?B` where ${e.where}`:void 0,n=e.targetWhere?B` where ${e.targetWhere}`:void 0,a=e.setWhere?B` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Uf(this.config.table,e.set)),o="";return o=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=B`(${B.raw(o)})${n} do update set ${s}${t}${a}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return or.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>or.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new tr({alias:Mn(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}});var ng,vS=G(()=>{Te();Ls();js();ng=class extends fn{constructor(e,t,n){super(),this.session=t,this.dialect=n,this.config={view:e}}static[z]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return or.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>or.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}});var iM=G(()=>{});var Cd,ES,cM=G(()=>{Te();Mi();Ls();_o();Br();os();Un();rr();ks();Cd=class{constructor(e,t,n,a){this.table=e,this.session=t,this.dialect=n,this.withList=a}static[z]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new ES(this.table,Uf(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},ES=class extends fn{constructor(e,t,n,a,s){super(),this.session=n,this.dialect=a,this.config={set:t,table:e,withList:s,joins:[]},this.tableName=Ms(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[z]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let t=e,n=Ms(t);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=t,this}getTableLikeFields(e){return pe(e,rn)?e[$e.Symbol.Columns]:pe(e,Mr)?e._.selectedFields:e[ir].selectedFields}createJoin(e){return(t,n)=>{let a=Ms(t);if(typeof a=="string"&&this.config.joins.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!pe(this.config.from,je)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[$e.Symbol.Columns],new tr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new tr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:t,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[$e.Symbol.Columns]),this.config.from)){let t=Ms(this.config.from);if(typeof t=="string"&&this.config.from&&!pe(this.config.from,je)){let n=this.getTableLikeFields(this.config.from);e[t]=n}for(let n of this.config.joins){let a=Ms(n.table);if(typeof a=="string"&&!pe(n.table,je)){let s=this.getTableLikeFields(n.table);e[a]=s}}}return this.config.returningFields=e,this.config.returning=ha(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new tr({alias:Mn(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}});var CS=G(()=>{Zk();oM();tg();vS();bS();iM();cM()});var ag,lM=G(()=>{Te();Br();ag=class r extends je{constructor(e){super(r.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=r.buildCount(e.source,e.filters)}sql;token;static[z]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return B`(select count(*) from ${e}${B.raw(" where ").if(t)}${t})`}static buildCount(e,t){return B`select count(*) as count from ${e}${B.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}}});var sg,og,uM=G(()=>{Te();Ls();vd();js();sg=class{constructor(e,t,n,a,s,o,i){this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=a,this.tableConfig=s,this.dialect=o,this.session=i}static[z]="PgRelationalQueryBuilder";findMany(e){return new og(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new og(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},og=class extends fn{constructor(e,t,n,a,s,o,i,u,c){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=a,this.tableConfig=s,this.dialect=o,this.session=i,this.config=u,this.mode=c}static[z]="PgRelationalQuery";_prepare(e){return or.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(a,s)=>{let o=a.map(i=>Jf(this.schema,this.tableConfig,i,t.selection,s));return this.mode==="first"?o[0]:o})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return or.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}});var ig,pM=G(()=>{Te();Ls();ig=class extends fn{constructor(e,t,n,a){super(),this.execute=e,this.sql=t,this.query=n,this.mapBatchResult=a}static[z]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}}});var Ul,cg=G(()=>{Te();CS();_o();Br();os();lM();uM();pM();vS();Ul=class{constructor(e,t,n){if(this.dialect=e,this.session=t,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[a,s]of Object.entries(this._.schema))this.query[a]=new sg(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[a],s,e,t)}static[z]="PgDatabase";query;$with=(e,t)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fs(n.dialect))),new Proxy(new jl(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new tr({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new ag({source:e,filters:t,session:this.session})}with(...e){let t=this;function n(c){return new gn({fields:c??void 0,session:t.session,dialect:t.dialect,withList:e})}function a(c){return new gn({fields:c??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function s(c,p){return new gn({fields:p??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:c}})}function o(c){return new Cd(c,t.session,t.dialect,e)}function i(c){return new Ed(c,t.session,t.dialect,e)}function u(c){return new od(c,t.session,t.dialect,e)}return{select:n,selectDistinct:a,selectDistinctOn:s,update:o,insert:i,delete:u}}select(e){return new gn({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new gn({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new gn({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Cd(e,this.session,this.dialect)}insert(e){return new Ed(e,this.session,this.dialect)}delete(e){return new od(e,this.session,this.dialect)}refreshMaterializedView(e){return new ng(e,this.session,this.dialect)}authToken;execute(e){let t=typeof e=="string"?B.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(t),a=this.session.prepareQuery(n,void 0,void 0,!1);return new ig(()=>a.execute(void 0,this.authToken),t,n,s=>a.mapResult(s,!0))}transaction(e,t){return this.session.transaction(e,t)}}});var dM=G(()=>{});var mM,AS,hM=G(()=>{Te();mM=class{constructor(e,t){this.name=e,this.value=t}static[z]="PgCheckBuilder";brand;build(e){return new AS(e,this)}},AS=class{constructor(e,t){this.table=e,this.name=t.name,this.value=t.value}static[z]="PgCheck";name;value}});var fM,Ad,SS,gM=G(()=>{Br();Te();zf();fM=class{constructor(e,t){this.unique=e,this.name=t}static[z]="PgIndexBuilderOn";on(...e){return new Ad(e.map(t=>{if(pe(t,je))return t;t=t;let n=new Ll(t.name,!!t.keyAsName,t.columnType,t.indexConfig);return t.indexConfig=JSON.parse(JSON.stringify(t.defaultConfig)),n}),this.unique,!1,this.name)}onOnly(...e){return new Ad(e.map(t=>{if(pe(t,je))return t;t=t;let n=new Ll(t.name,!!t.keyAsName,t.columnType,t.indexConfig);return t.indexConfig=t.defaultConfig,n}),this.unique,!0,this.name)}using(e,...t){return new Ad(t.map(n=>{if(pe(n,je))return n;n=n;let a=new Ll(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),a}),this.unique,!0,this.name,e)}},Ad=class{static[z]="PgIndexBuilder";config;constructor(e,t,n,a,s="btree"){this.config={name:a,columns:e,unique:t,only:n,method:s}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new SS(this.config,e)}},SS=class{static[z]="PgIndex";config;constructor(e,t){this.config={...e,table:t}}}});var yM,bM=G(()=>{Te();yM=class{constructor(e,t){this.name=e,t&&(this.as=t.as,this.for=t.for,this.to=t.to,this.using=t.using,this.withCheck=t.withCheck)}static[z]="PgPolicy";as;for;to;using;withCheck;_linkedTable;link(e){return this._linkedTable=e,this}}});var vM,EM=G(()=>{Te();vM=class{constructor(e,t){this.name=e,t&&(this.createDb=t.createDb,this.createRole=t.createRole,this.inherit=t.inherit)}static[z]="PgRole";_existing;createDb;createRole;inherit;existing(){return this._existing=!0,this}}});function CM(r,e,t){return new RS(r,e,t)}var RS,wS=G(()=>{Te();RS=class{constructor(e,t,n){this.seqName=e,this.seqOptions=t,this.schema=n}static[z]="PgSequence"}});var IS,xS=G(()=>{IS=Symbol.for("drizzle:PgViewConfig")});function SM(r,e,t){return e?new OS(r,e,t):new TS(r,t)}function RM(r,e,t){return e?new _S(r,e,t):new NS(r,t)}var lg,TS,OS,ug,NS,_S,Sd,AM,Rd,PS=G(()=>{Te();_o();rr();tg();Mi();Xf();xS();lg=class{constructor(e,t){this.name=e,this.schema=t}static[z]="PgDefaultViewBuilderCore";config={};with(e){return this.config.with=e,this}},TS=class extends lg{static[z]="PgViewBuilder";as(e){typeof e=="function"&&(e=e(new Fs));let t=new tr({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),n=new Proxy(e.getSelectedFields(),t);return new Proxy(new Sd({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:n,query:e.getSQL().inlineParams()}}),t)}},OS=class extends lg{static[z]="PgManualViewBuilder";columns;constructor(e,t,n){super(e,n),this.columns=Di(ot(e,t))}existing(){return new Proxy(new Sd({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new tr({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new Sd({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new tr({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}},ug=class{constructor(e,t){this.name=e,this.schema=t}static[z]="PgMaterializedViewBuilderCore";config={};using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}},NS=class extends ug{static[z]="PgMaterializedViewBuilder";as(e){typeof e=="function"&&(e=e(new Fs));let t=new tr({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),n=new Proxy(e.getSelectedFields(),t);return new Proxy(new Rd({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:n,query:e.getSQL().inlineParams()}}),t)}},_S=class extends ug{static[z]="PgManualMaterializedViewBuilder";columns;constructor(e,t,n){super(e,n),this.columns=Di(ot(e,t))}existing(){return new Proxy(new Rd({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new tr({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new Rd({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new tr({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}},Sd=class extends Bs{static[z]="PgView";[IS];constructor({pgConfig:e,config:t}){super(t),e&&(this[IS]={with:e.with})}},AM=Symbol.for("drizzle:PgMaterializedViewConfig"),Rd=class extends Bs{static[z]="PgMaterializedView";[AM];constructor({pgConfig:e,config:t}){super(t),this[AM]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}}});var wM,IM=G(()=>{Te();Br();jf();wS();Mi();PS();wM=class{constructor(e){this.schemaName=e}static[z]="PgSchema";table=(e,t,n)=>mS(e,t,n,this.schemaName);view=(e,t)=>SM(e,t,this.schemaName);materializedView=(e,t)=>RM(e,t,this.schemaName);enum=(e,t)=>kk(e,t,this.schemaName);sequence=(e,t)=>CM(e,t,this.schemaName);getSQL(){return new je([B.identifier(this.schemaName)])}shouldOmitSQLParens(){return!0}}});var pg,dg,mg,$S=G(()=>{Te();qf();Kf();js();cg();pg=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static[z]="PgPreparedQuery";joinsNotNullableMap},dg=class{constructor(e){this.dialect=e}static[z]="PgSession";execute(e,t){return or.startActiveSpan("drizzle.operation",()=>or.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){let n=await this.execute(e,t);return Number(n[0].count)}},mg=class extends Ul{constructor(e,t,n,a=0){super(e,t,n),this.schema=n,this.nestedIndex=a}static[z]="PgTransaction";rollback(){throw new Ff}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),B.raw(t.join(" "))}setTransaction(e){return this.session.execute(B`set transaction ${this.getTransactionConfigSQL(e)}`)}}});var xM=G(()=>{});var TM=G(()=>{});var OM=G(()=>{nA()});var hg=G(()=>{dM();hM();zf();cg();Yf();KC();gM();bM();fS();CS();EM();IM();wS();$S();xM();Mi();tA();TM();OM();xS();PS()});var NM,ls,LS,fg,jS,kS=G(()=>{xf();Te();Nf();hg();$S();Br();js();rr();({Pool:NM,types:ls}=No),LS=class extends pg{constructor(e,t,n,a,s,o,i,u){super({sql:t,params:n}),this.client=e,this.params=n,this.logger=a,this.fields=s,this._isResponseInArrayMode=i,this.customResultMapper=u,this.rawQueryConfig={name:o,text:t,types:{getTypeParser:(c,p)=>c===ls.builtins.TIMESTAMPTZ?m=>m:c===ls.builtins.TIMESTAMP?m=>m:c===ls.builtins.DATE?m=>m:c===ls.builtins.INTERVAL?m=>m:ls.getTypeParser(c,p)}},this.queryConfig={name:o,text:t,rowMode:"array",types:{getTypeParser:(c,p)=>c===ls.builtins.TIMESTAMPTZ?m=>m:c===ls.builtins.TIMESTAMP?m=>m:c===ls.builtins.DATE?m=>m:c===ls.builtins.INTERVAL?m=>m:ls.getTypeParser(c,p)}}}static[z]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return or.startActiveSpan("drizzle.execute",async()=>{let t=gA(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,t);let{fields:n,rawQueryConfig:a,client:s,queryConfig:o,joinsNotNullableMap:i,customResultMapper:u}=this;if(!n&&!u)return or.startActiveSpan("drizzle.driver.execute",async p=>(p?.setAttributes({"drizzle.query.name":a.name,"drizzle.query.text":a.text,"drizzle.query.params":JSON.stringify(t)}),s.query(a,t)));let c=await or.startActiveSpan("drizzle.driver.execute",p=>(p?.setAttributes({"drizzle.query.name":o.name,"drizzle.query.text":o.text,"drizzle.query.params":JSON.stringify(t)}),s.query(o,t)));return or.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(p=>Jk(n,p,i)))})}all(e={}){return or.startActiveSpan("drizzle.execute",()=>{let t=gA(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,t),or.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(t)}),this.client.query(this.rawQueryConfig,t).then(a=>a.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},fg=class r extends dg{constructor(e,t,n,a={}){super(t),this.client=e,this.schema=n,this.options=a,this.logger=a.logger??new Of}static[z]="NodePgSession";logger;prepareQuery(e,t,n,a,s){return new LS(this.client,e.sql,e.params,this.logger,t,n,a,s)}async transaction(e,t){let n=this.client instanceof NM?new r(await this.client.connect(),this.dialect,this.schema,this.options):this,a=new jS(this.dialect,n,this.schema);await a.execute(B`begin${t?B` ${a.getTransactionConfigSQL(t)}`:void 0}`);try{let s=await e(a);return await a.execute(B`commit`),s}catch(s){throw await a.execute(B`rollback`),s}finally{this.client instanceof NM&&n.client.release()}}async count(e){let t=await this.execute(e);return Number(t.rows[0].count)}},jS=class r extends mg{static[z]="NodePgTransaction";async transaction(e){let t=`sp${this.nestedIndex+1}`,n=new r(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(B.raw(`savepoint ${t}`));try{let a=await e(n);return await n.execute(B.raw(`release savepoint ${t}`)),a}catch(a){throw await n.execute(B.raw(`rollback to savepoint ${t}`)),a}}}});function wd(r,e={}){let t=new $o({casing:e.casing}),n;e.logger===!0?n=new Tf:e.logger!==!1&&(n=e.logger);let a;if(e.schema){let u=ZD(e.schema,tM);a={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let o=new DS(r,t,{logger:n}).createSession(a),i=new MS(t,o,a);return i.$client=r,i}function gg(...r){if(typeof r[0]=="string"){let e=new No.Pool({connectionString:r[0]});return wd(e,r[1])}if(Yk(r[0])){let{connection:e,client:t,...n}=r[0];if(t)return wd(t,n);let a=typeof e=="string"?new No.Pool({connectionString:e}):new No.Pool(e);return wd(a,n)}return wd(r[0],r[1])}var DS,MS,_M=G(()=>{xf();Te();Nf();cg();Yf();vd();rr();kS();DS=class{constructor(e,t,n={}){this.client=e,this.dialect=t,this.options=n}static[z]="NodePgDriver";createSession(e){return new fg(this.client,this.dialect,e,{logger:this.options.logger})}},MS=class extends Ul{static[z]="NodePgDatabase"};(r=>{function e(t){return wd({},t)}r.mock=e})(gg||(gg={}))});var PM=G(()=>{_M();kS()});var $M=G(()=>{Wf()});var LM=G(()=>{});var Da=G(()=>{Mf();QC();ss();Te();qf();$M();Nf();LM();Ls();vd();Kf();os();Un();rr();ks()});var Lt,US,ke,us,Id=G(()=>{(function(r){r.assertEqual=a=>{};function e(a){}r.assertIs=e;function t(a){throw new Error}r.assertNever=t,r.arrayToEnum=a=>{let s={};for(let o of a)s[o]=o;return s},r.getValidEnumValues=a=>{let s=r.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),o={};for(let i of s)o[i]=a[i];return r.objectValues(o)},r.objectValues=a=>r.objectKeys(a).map(function(s){return a[s]}),r.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let s=[];for(let o in a)Object.prototype.hasOwnProperty.call(a,o)&&s.push(o);return s},r.find=(a,s)=>{for(let o of a)if(s(o))return o},r.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,s=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}r.joinValues=n,r.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s})(Lt||(Lt={}));(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(US||(US={}));ke=Lt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),us=r=>{switch(typeof r){case"undefined":return ke.undefined;case"string":return ke.string;case"number":return Number.isNaN(r)?ke.nan:ke.number;case"boolean":return ke.boolean;case"function":return ke.function;case"bigint":return ke.bigint;case"symbol":return ke.symbol;case"object":return Array.isArray(r)?ke.array:r===null?ke.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?ke.promise:typeof Map<"u"&&r instanceof Map?ke.map:typeof Set<"u"&&r instanceof Set?ke.set:typeof Date<"u"&&r instanceof Date?ke.date:ke.object;default:return ke.unknown}}});var Ee,ZX,qn,yg=G(()=>{Id();Ee=Lt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),ZX=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),qn=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(s){return s.message},n={_errors:[]},a=s=>{for(let o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)n._errors.push(t(o));else{let i=n,u=0;for(;u<o.path.length;){let c=o.path[u];u===o.path.length-1?(i[c]=i[c]||{_errors:[]},i[c]._errors.push(t(o))):i[c]=i[c]||{_errors:[]},i=i[c],u++}}};return a(this),n}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Lt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let a of this.issues)if(a.path.length>0){let s=a.path[0];t[s]=t[s]||[],t[s].push(e(a))}else n.push(e(a));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};qn.create=r=>new qn(r)});var eY,qs,BS=G(()=>{yg();Id();eY=(r,e)=>{let t;switch(r.code){case Ee.invalid_type:r.received===ke.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case Ee.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,Lt.jsonStringifyReplacer)}`;break;case Ee.unrecognized_keys:t=`Unrecognized key(s) in object: ${Lt.joinValues(r.keys,", ")}`;break;case Ee.invalid_union:t="Invalid input";break;case Ee.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Lt.joinValues(r.options)}`;break;case Ee.invalid_enum_value:t=`Invalid enum value. Expected ${Lt.joinValues(r.options)}, received '${r.received}'`;break;case Ee.invalid_arguments:t="Invalid function arguments";break;case Ee.invalid_return_type:t="Invalid function return type";break;case Ee.invalid_date:t="Invalid date";break;case Ee.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:Lt.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case Ee.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case Ee.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case Ee.custom:t="Invalid input";break;case Ee.invalid_intersection_types:t="Intersection results could not be merged";break;case Ee.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case Ee.not_finite:t="Number must be finite";break;default:t=e.defaultError,Lt.assertNever(r)}return{message:t}},qs=eY});function tY(r){jM=r}function Bl(){return jM}var jM,bg=G(()=>{BS();jM=qs});function _e(r,e){let t=Bl(),n=xd({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===qs?void 0:qs].filter(a=>!!a)});r.common.issues.push(n)}var xd,rY,un,it,Ui,yn,vg,Eg,Lo,Fl,FS=G(()=>{bg();BS();xd=r=>{let{data:e,path:t,errorMaps:n,issueData:a}=r,s=[...t,...a.path||[]],o={...a,path:s};if(a.message!==void 0)return{...a,path:s,message:a.message};let i="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)i=c(o,{data:e,defaultError:i}).message;return{...a,path:s,message:i}},rY=[];un=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let a of t){if(a.status==="aborted")return it;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let a of t){let s=await a.key,o=await a.value;n.push({key:s,value:o})}return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let a of t){let{key:s,value:o}=a;if(s.status==="aborted"||o.status==="aborted")return it;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(n[s.value]=o.value)}return{status:e.value,value:n}}},it=Object.freeze({status:"aborted"}),Ui=r=>({status:"dirty",value:r}),yn=r=>({status:"valid",value:r}),vg=r=>r.status==="aborted",Eg=r=>r.status==="dirty",Lo=r=>r.status==="valid",Fl=r=>typeof Promise<"u"&&r instanceof Promise});var kM=G(()=>{});var Qe,DM=G(()=>{(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(Qe||(Qe={}))});function Et(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:a}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(o,i)=>{let{message:u}=r;return o.code==="invalid_enum_value"?{message:u??i.defaultError}:typeof i.data>"u"?{message:u??n??i.defaultError}:o.code!=="invalid_type"?{message:i.defaultError}:{message:u??t??i.defaultError}},description:a}}function FM(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function vY(r){return new RegExp(`^${FM(r)}$`)}function qM(r){let e=`${BM}T${FM(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function EY(r,e){return!!((e==="v4"||!e)&&dY.test(r)||(e==="v6"||!e)&&hY.test(r))}function CY(r,e){if(!cY.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&a?.typ!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function AY(r,e){return!!((e==="v4"||!e)&&mY.test(r)||(e==="v6"||!e)&&fY.test(r))}function SY(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=t>n?t:n,s=Number.parseInt(r.toFixed(a).replace(".","")),o=Number.parseInt(e.toFixed(a).replace(".",""));return s%o/10**a}function ql(r){if(r instanceof Gn){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=fa.create(ql(n))}return new Gn({...r._def,shape:()=>e})}else return r instanceof zs?new zs({...r._def,type:ql(r.element)}):r instanceof fa?fa.create(ql(r.unwrap())):r instanceof ds?ds.create(ql(r.unwrap())):r instanceof ps?ps.create(r.items.map(e=>ql(e))):r}function GS(r,e){let t=us(r),n=us(e);if(r===e)return{valid:!0,data:r};if(t===ke.object&&n===ke.object){let a=Lt.objectKeys(e),s=Lt.objectKeys(r).filter(i=>a.indexOf(i)!==-1),o={...r,...e};for(let i of s){let u=GS(r[i],e[i]);if(!u.valid)return{valid:!1};o[i]=u.data}return{valid:!0,data:o}}else if(t===ke.array&&n===ke.array){if(r.length!==e.length)return{valid:!1};let a=[];for(let s=0;s<r.length;s++){let o=r[s],i=e[s],u=GS(o,i);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return t===ke.date&&n===ke.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}function GM(r,e){return new Ki({values:r,typeName:pt.ZodEnum,...Et(e)})}function UM(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function VM(r,e={},t){return r?ko.create().superRefine((n,a)=>{let s=r(n);if(s instanceof Promise)return s.then(o=>{if(!o){let i=UM(e,n),u=i.fatal??t??!0;a.addIssue({code:"custom",...i,fatal:u})}});if(!s){let o=UM(e,n),i=o.fatal??t??!0;a.addIssue({code:"custom",...o,fatal:i})}}):ko.create()}var ga,MM,Rt,nY,aY,sY,oY,iY,cY,lY,uY,pY,qS,dY,mY,hY,fY,gY,yY,BM,bY,jo,Bi,Fi,qi,Gi,Gl,Vi,zi,ko,Vs,Ma,Vl,zs,Gn,Hi,Gs,Cg,Wi,ps,Ag,zl,Hl,Sg,Qi,Ji,Ki,Xi,Do,ya,fa,ds,Yi,Zi,Wl,RY,Td,Od,ec,wY,pt,IY,zM,HM,xY,TY,WM,OY,NY,_Y,PY,$Y,LY,jY,kY,DY,MY,UY,BY,FY,qY,GY,VY,zY,HY,WY,QY,JY,KY,XY,YY,ZY,eZ,tZ,rZ,nZ,aZ,sZ,oZ,iZ,cZ,QM=G(()=>{yg();bg();DM();FS();Id();ga=class{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},MM=(r,e)=>{if(Lo(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new qn(r.common.issues);return this._error=t,this._error}}};Rt=class{get description(){return this._def.description}_getType(e){return us(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:us(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new un,ctx:{common:e.parent.common,data:e.data,parsedType:us(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Fl(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:us(e)},a=this._parseSync({data:e,path:n.path,parent:n});return MM(n,a)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:us(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return Lo(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>Lo(n)?{value:n.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:us(e)},a=this._parse({data:e,path:n.path,parent:n}),s=await(Fl(a)?a:Promise.resolve(a));return MM(n,s)}refine(e,t){let n=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,s)=>{let o=e(a),i=()=>s.addIssue({code:Ee.custom,...n(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(i(),!1)):o?!0:(i(),!1)})}refinement(e,t){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof t=="function"?t(n,a):t),!1))}_refinement(e){return new ya({schema:this,typeName:pt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return fa.create(this,this._def)}nullable(){return ds.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return zs.create(this)}promise(){return Do.create(this,this._def)}or(e){return Hi.create([this,e],this._def)}and(e){return Wi.create(this,e,this._def)}transform(e){return new ya({...Et(this._def),schema:this,typeName:pt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Yi({...Et(this._def),innerType:this,defaultValue:t,typeName:pt.ZodDefault})}brand(){return new Td({typeName:pt.ZodBranded,type:this,...Et(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Zi({...Et(this._def),innerType:this,catchValue:t,typeName:pt.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Od.create(this,e)}readonly(){return ec.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},nY=/^c[^\s-]{8,}$/i,aY=/^[0-9a-z]+$/,sY=/^[0-9A-HJKMNP-TV-Z]{26}$/i,oY=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,iY=/^[a-z0-9_-]{21}$/i,cY=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,lY=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,uY=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,pY="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",dY=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,mY=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,hY=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,fY=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,gY=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,yY=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,BM="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bY=new RegExp(`^${BM}$`);jo=class r extends Rt{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ke.string){let s=this._getOrReturnCtx(e);return _e(s,{code:Ee.invalid_type,expected:ke.string,received:s.parsedType}),it}let n=new un,a;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let o=e.data.length>s.value,i=e.data.length<s.value;(o||i)&&(a=this._getOrReturnCtx(e,a),o?_e(a,{code:Ee.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&_e(a,{code:Ee.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")uY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"email",code:Ee.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")qS||(qS=new RegExp(pY,"u")),qS.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"emoji",code:Ee.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")oY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"uuid",code:Ee.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")iY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"nanoid",code:Ee.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")nY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"cuid",code:Ee.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")aY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"cuid2",code:Ee.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")sY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"ulid",code:Ee.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),_e(a,{validation:"url",code:Ee.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"regex",code:Ee.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?qM(s).test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?bY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?vY(s).test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?lY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"duration",code:Ee.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?EY(e.data,s.version)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"ip",code:Ee.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?CY(e.data,s.alg)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"jwt",code:Ee.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?AY(e.data,s.version)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"cidr",code:Ee.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?gY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"base64",code:Ee.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?yY.test(e.data)||(a=this._getOrReturnCtx(e,a),_e(a,{validation:"base64url",code:Ee.invalid_string,message:s.message}),n.dirty()):Lt.assertNever(s);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(a=>e.test(a),{validation:t,code:Ee.invalid_string,...Qe.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Qe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Qe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Qe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Qe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Qe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Qe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Qe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Qe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Qe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Qe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Qe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Qe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Qe.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Qe.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...Qe.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Qe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Qe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...Qe.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Qe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Qe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Qe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Qe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Qe.errToObj(t)})}nonempty(e){return this.min(1,Qe.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};jo.create=r=>new jo({checks:[],typeName:pt.ZodString,coerce:r?.coerce??!1,...Et(r)});Bi=class r extends Rt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ke.number){let s=this._getOrReturnCtx(e);return _e(s,{code:Ee.invalid_type,expected:ke.number,received:s.parsedType}),it}let n,a=new un;for(let s of this._def.checks)s.kind==="int"?Lt.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),_e(n,{code:Ee.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),_e(n,{code:Ee.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),_e(n,{code:Ee.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="multipleOf"?SY(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),_e(n,{code:Ee.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),_e(n,{code:Ee.not_finite,message:s.message}),a.dirty()):Lt.assertNever(s);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Qe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Qe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Qe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Qe.toString(t))}setLimit(e,t,n,a){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Qe.toString(a)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Qe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Qe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Qe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Qe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Qe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Qe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Qe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Qe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Qe.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Lt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Bi.create=r=>new Bi({checks:[],typeName:pt.ZodNumber,coerce:r?.coerce||!1,...Et(r)});Fi=class r extends Rt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ke.bigint)return this._getInvalidInput(e);let n,a=new un;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),_e(n,{code:Ee.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),_e(n,{code:Ee.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),_e(n,{code:Ee.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):Lt.assertNever(s);return{status:a.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return _e(t,{code:Ee.invalid_type,expected:ke.bigint,received:t.parsedType}),it}gte(e,t){return this.setLimit("min",e,!0,Qe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Qe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Qe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Qe.toString(t))}setLimit(e,t,n,a){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Qe.toString(a)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Qe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Qe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Qe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Qe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Qe.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Fi.create=r=>new Fi({checks:[],typeName:pt.ZodBigInt,coerce:r?.coerce??!1,...Et(r)});qi=class extends Rt{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ke.boolean){let n=this._getOrReturnCtx(e);return _e(n,{code:Ee.invalid_type,expected:ke.boolean,received:n.parsedType}),it}return yn(e.data)}};qi.create=r=>new qi({typeName:pt.ZodBoolean,coerce:r?.coerce||!1,...Et(r)});Gi=class r extends Rt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ke.date){let s=this._getOrReturnCtx(e);return _e(s,{code:Ee.invalid_type,expected:ke.date,received:s.parsedType}),it}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return _e(s,{code:Ee.invalid_date}),it}let n=new un,a;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(a=this._getOrReturnCtx(e,a),_e(a,{code:Ee.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):Lt.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Qe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Qe.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Gi.create=r=>new Gi({checks:[],coerce:r?.coerce||!1,typeName:pt.ZodDate,...Et(r)});Gl=class extends Rt{_parse(e){if(this._getType(e)!==ke.symbol){let n=this._getOrReturnCtx(e);return _e(n,{code:Ee.invalid_type,expected:ke.symbol,received:n.parsedType}),it}return yn(e.data)}};Gl.create=r=>new Gl({typeName:pt.ZodSymbol,...Et(r)});Vi=class extends Rt{_parse(e){if(this._getType(e)!==ke.undefined){let n=this._getOrReturnCtx(e);return _e(n,{code:Ee.invalid_type,expected:ke.undefined,received:n.parsedType}),it}return yn(e.data)}};Vi.create=r=>new Vi({typeName:pt.ZodUndefined,...Et(r)});zi=class extends Rt{_parse(e){if(this._getType(e)!==ke.null){let n=this._getOrReturnCtx(e);return _e(n,{code:Ee.invalid_type,expected:ke.null,received:n.parsedType}),it}return yn(e.data)}};zi.create=r=>new zi({typeName:pt.ZodNull,...Et(r)});ko=class extends Rt{constructor(){super(...arguments),this._any=!0}_parse(e){return yn(e.data)}};ko.create=r=>new ko({typeName:pt.ZodAny,...Et(r)});Vs=class extends Rt{constructor(){super(...arguments),this._unknown=!0}_parse(e){return yn(e.data)}};Vs.create=r=>new Vs({typeName:pt.ZodUnknown,...Et(r)});Ma=class extends Rt{_parse(e){let t=this._getOrReturnCtx(e);return _e(t,{code:Ee.invalid_type,expected:ke.never,received:t.parsedType}),it}};Ma.create=r=>new Ma({typeName:pt.ZodNever,...Et(r)});Vl=class extends Rt{_parse(e){if(this._getType(e)!==ke.undefined){let n=this._getOrReturnCtx(e);return _e(n,{code:Ee.invalid_type,expected:ke.void,received:n.parsedType}),it}return yn(e.data)}};Vl.create=r=>new Vl({typeName:pt.ZodVoid,...Et(r)});zs=class r extends Rt{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==ke.array)return _e(t,{code:Ee.invalid_type,expected:ke.array,received:t.parsedType}),it;if(a.exactLength!==null){let o=t.data.length>a.exactLength.value,i=t.data.length<a.exactLength.value;(o||i)&&(_e(t,{code:o?Ee.too_big:Ee.too_small,minimum:i?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(_e(t,{code:Ee.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(_e(t,{code:Ee.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((o,i)=>a.type._parseAsync(new ga(t,o,t.path,i)))).then(o=>un.mergeArray(n,o));let s=[...t.data].map((o,i)=>a.type._parseSync(new ga(t,o,t.path,i)));return un.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:Qe.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:Qe.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:Qe.toString(t)}})}nonempty(e){return this.min(1,e)}};zs.create=(r,e)=>new zs({type:r,minLength:null,maxLength:null,exactLength:null,typeName:pt.ZodArray,...Et(e)});Gn=class r extends Rt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=Lt.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==ke.object){let c=this._getOrReturnCtx(e);return _e(c,{code:Ee.invalid_type,expected:ke.object,received:c.parsedType}),it}let{status:n,ctx:a}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof Ma&&this._def.unknownKeys==="strip"))for(let c in a.data)o.includes(c)||i.push(c);let u=[];for(let c of o){let p=s[c],m=a.data[c];u.push({key:{status:"valid",value:c},value:p._parse(new ga(a,m,a.path,c)),alwaysSet:c in a.data})}if(this._def.catchall instanceof Ma){let c=this._def.unknownKeys;if(c==="passthrough")for(let p of i)u.push({key:{status:"valid",value:p},value:{status:"valid",value:a.data[p]}});else if(c==="strict")i.length>0&&(_e(a,{code:Ee.unrecognized_keys,keys:i}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let p of i){let m=a.data[p];u.push({key:{status:"valid",value:p},value:c._parse(new ga(a,m,a.path,p)),alwaysSet:p in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let c=[];for(let p of u){let m=await p.key,f=await p.value;c.push({key:m,value:f,alwaysSet:p.alwaysSet})}return c}).then(c=>un.mergeObjectSync(n,c)):un.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return Qe.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{let a=this._def.errorMap?.(t,n).message??n.defaultError;return t.code==="unrecognized_keys"?{message:Qe.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:pt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let n of Lt.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let n of Lt.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}deepPartial(){return ql(this)}partial(e){let t={};for(let n of Lt.objectKeys(this.shape)){let a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let n of Lt.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof fa;)s=s._def.innerType;t[n]=s}return new r({...this._def,shape:()=>t})}keyof(){return GM(Lt.objectKeys(this.shape))}};Gn.create=(r,e)=>new Gn({shape:()=>r,unknownKeys:"strip",catchall:Ma.create(),typeName:pt.ZodObject,...Et(e)});Gn.strictCreate=(r,e)=>new Gn({shape:()=>r,unknownKeys:"strict",catchall:Ma.create(),typeName:pt.ZodObject,...Et(e)});Gn.lazycreate=(r,e)=>new Gn({shape:r,unknownKeys:"strip",catchall:Ma.create(),typeName:pt.ZodObject,...Et(e)});Hi=class extends Rt{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function a(s){for(let i of s)if(i.result.status==="valid")return i.result;for(let i of s)if(i.result.status==="dirty")return t.common.issues.push(...i.ctx.common.issues),i.result;let o=s.map(i=>new qn(i.ctx.common.issues));return _e(t,{code:Ee.invalid_union,unionErrors:o}),it}if(t.common.async)return Promise.all(n.map(async s=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(a);{let s,o=[];for(let u of n){let c={...t,common:{...t.common,issues:[]},parent:null},p=u._parseSync({data:t.data,path:t.path,parent:c});if(p.status==="valid")return p;p.status==="dirty"&&!s&&(s={result:p,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;let i=o.map(u=>new qn(u));return _e(t,{code:Ee.invalid_union,unionErrors:i}),it}}get options(){return this._def.options}};Hi.create=(r,e)=>new Hi({options:r,typeName:pt.ZodUnion,...Et(e)});Gs=r=>r instanceof Qi?Gs(r.schema):r instanceof ya?Gs(r.innerType()):r instanceof Ji?[r.value]:r instanceof Ki?r.options:r instanceof Xi?Lt.objectValues(r.enum):r instanceof Yi?Gs(r._def.innerType):r instanceof Vi?[void 0]:r instanceof zi?[null]:r instanceof fa?[void 0,...Gs(r.unwrap())]:r instanceof ds?[null,...Gs(r.unwrap())]:r instanceof Td||r instanceof ec?Gs(r.unwrap()):r instanceof Zi?Gs(r._def.innerType):[],Cg=class r extends Rt{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==ke.object)return _e(t,{code:Ee.invalid_type,expected:ke.object,received:t.parsedType}),it;let n=this.discriminator,a=t.data[n],s=this.optionsMap.get(a);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(_e(t,{code:Ee.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),it)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let a=new Map;for(let s of t){let o=Gs(s.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of o){if(a.has(i))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);a.set(i,s)}}return new r({typeName:pt.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...Et(n)})}};Wi=class extends Rt{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),a=(s,o)=>{if(vg(s)||vg(o))return it;let i=GS(s.value,o.value);return i.valid?((Eg(s)||Eg(o))&&t.dirty(),{status:t.value,value:i.data}):(_e(n,{code:Ee.invalid_intersection_types}),it)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,o])=>a(s,o)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Wi.create=(r,e,t)=>new Wi({left:r,right:e,typeName:pt.ZodIntersection,...Et(t)});ps=class r extends Rt{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ke.array)return _e(n,{code:Ee.invalid_type,expected:ke.array,received:n.parsedType}),it;if(n.data.length<this._def.items.length)return _e(n,{code:Ee.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),it;!this._def.rest&&n.data.length>this._def.items.length&&(_e(n,{code:Ee.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let s=[...n.data].map((o,i)=>{let u=this._def.items[i]||this._def.rest;return u?u._parse(new ga(n,o,n.path,i)):null}).filter(o=>!!o);return n.common.async?Promise.all(s).then(o=>un.mergeArray(t,o)):un.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};ps.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ps({items:r,typeName:pt.ZodTuple,rest:null,...Et(e)})};Ag=class r extends Rt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ke.object)return _e(n,{code:Ee.invalid_type,expected:ke.object,received:n.parsedType}),it;let a=[],s=this._def.keyType,o=this._def.valueType;for(let i in n.data)a.push({key:s._parse(new ga(n,i,n.path,i)),value:o._parse(new ga(n,n.data[i],n.path,i)),alwaysSet:i in n.data});return n.common.async?un.mergeObjectAsync(t,a):un.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof Rt?new r({keyType:e,valueType:t,typeName:pt.ZodRecord,...Et(n)}):new r({keyType:jo.create(),valueType:e,typeName:pt.ZodRecord,...Et(t)})}},zl=class extends Rt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ke.map)return _e(n,{code:Ee.invalid_type,expected:ke.map,received:n.parsedType}),it;let a=this._def.keyType,s=this._def.valueType,o=[...n.data.entries()].map(([i,u],c)=>({key:a._parse(new ga(n,i,n.path,[c,"key"])),value:s._parse(new ga(n,u,n.path,[c,"value"]))}));if(n.common.async){let i=new Map;return Promise.resolve().then(async()=>{for(let u of o){let c=await u.key,p=await u.value;if(c.status==="aborted"||p.status==="aborted")return it;(c.status==="dirty"||p.status==="dirty")&&t.dirty(),i.set(c.value,p.value)}return{status:t.value,value:i}})}else{let i=new Map;for(let u of o){let c=u.key,p=u.value;if(c.status==="aborted"||p.status==="aborted")return it;(c.status==="dirty"||p.status==="dirty")&&t.dirty(),i.set(c.value,p.value)}return{status:t.value,value:i}}}};zl.create=(r,e,t)=>new zl({valueType:e,keyType:r,typeName:pt.ZodMap,...Et(t)});Hl=class r extends Rt{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ke.set)return _e(n,{code:Ee.invalid_type,expected:ke.set,received:n.parsedType}),it;let a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(_e(n,{code:Ee.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(_e(n,{code:Ee.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let s=this._def.valueType;function o(u){let c=new Set;for(let p of u){if(p.status==="aborted")return it;p.status==="dirty"&&t.dirty(),c.add(p.value)}return{status:t.value,value:c}}let i=[...n.data.values()].map((u,c)=>s._parse(new ga(n,u,n.path,c)));return n.common.async?Promise.all(i).then(u=>o(u)):o(i)}min(e,t){return new r({...this._def,minSize:{value:e,message:Qe.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:Qe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Hl.create=(r,e)=>new Hl({valueType:r,minSize:null,maxSize:null,typeName:pt.ZodSet,...Et(e)});Sg=class r extends Rt{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==ke.function)return _e(t,{code:Ee.invalid_type,expected:ke.function,received:t.parsedType}),it;function n(i,u){return xd({data:i,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Bl(),qs].filter(c=>!!c),issueData:{code:Ee.invalid_arguments,argumentsError:u}})}function a(i,u){return xd({data:i,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Bl(),qs].filter(c=>!!c),issueData:{code:Ee.invalid_return_type,returnTypeError:u}})}let s={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof Do){let i=this;return yn(async function(...u){let c=new qn([]),p=await i._def.args.parseAsync(u,s).catch(g=>{throw c.addIssue(n(u,g)),c}),m=await Reflect.apply(o,this,p);return await i._def.returns._def.type.parseAsync(m,s).catch(g=>{throw c.addIssue(a(m,g)),c})})}else{let i=this;return yn(function(...u){let c=i._def.args.safeParse(u,s);if(!c.success)throw new qn([n(u,c.error)]);let p=Reflect.apply(o,this,c.data),m=i._def.returns.safeParse(p,s);if(!m.success)throw new qn([a(p,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:ps.create(e).rest(Vs.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||ps.create([]).rest(Vs.create()),returns:t||Vs.create(),typeName:pt.ZodFunction,...Et(n)})}},Qi=class extends Rt{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Qi.create=(r,e)=>new Qi({getter:r,typeName:pt.ZodLazy,...Et(e)});Ji=class extends Rt{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return _e(t,{received:t.data,code:Ee.invalid_literal,expected:this._def.value}),it}return{status:"valid",value:e.data}}get value(){return this._def.value}};Ji.create=(r,e)=>new Ji({value:r,typeName:pt.ZodLiteral,...Et(e)});Ki=class r extends Rt{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return _e(t,{expected:Lt.joinValues(n),received:t.parsedType,code:Ee.invalid_type}),it}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return _e(t,{received:t.data,code:Ee.invalid_enum_value,options:n}),it}return yn(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};Ki.create=GM;Xi=class extends Rt{_parse(e){let t=Lt.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==ke.string&&n.parsedType!==ke.number){let a=Lt.objectValues(t);return _e(n,{expected:Lt.joinValues(a),received:n.parsedType,code:Ee.invalid_type}),it}if(this._cache||(this._cache=new Set(Lt.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let a=Lt.objectValues(t);return _e(n,{received:n.data,code:Ee.invalid_enum_value,options:a}),it}return yn(e.data)}get enum(){return this._def.values}};Xi.create=(r,e)=>new Xi({values:r,typeName:pt.ZodNativeEnum,...Et(e)});Do=class extends Rt{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==ke.promise&&t.common.async===!1)return _e(t,{code:Ee.invalid_type,expected:ke.promise,received:t.parsedType}),it;let n=t.parsedType===ke.promise?t.data:Promise.resolve(t.data);return yn(n.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Do.create=(r,e)=>new Do({type:r,typeName:pt.ZodPromise,...Et(e)});ya=class extends Rt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===pt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:o=>{_e(n,o),o.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){let o=a.transform(n.data,s);if(n.common.async)return Promise.resolve(o).then(async i=>{if(t.value==="aborted")return it;let u=await this._def.schema._parseAsync({data:i,path:n.path,parent:n});return u.status==="aborted"?it:u.status==="dirty"?Ui(u.value):t.value==="dirty"?Ui(u.value):u});{if(t.value==="aborted")return it;let i=this._def.schema._parseSync({data:o,path:n.path,parent:n});return i.status==="aborted"?it:i.status==="dirty"?Ui(i.value):t.value==="dirty"?Ui(i.value):i}}if(a.type==="refinement"){let o=i=>{let u=a.refinement(i,s);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?it:(i.status==="dirty"&&t.dirty(),o(i.value),{status:t.value,value:i.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>i.status==="aborted"?it:(i.status==="dirty"&&t.dirty(),o(i.value).then(()=>({status:t.value,value:i.value}))))}if(a.type==="transform")if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Lo(o))return it;let i=a.transform(o.value,s);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>Lo(o)?Promise.resolve(a.transform(o.value,s)).then(i=>({status:t.value,value:i})):it);Lt.assertNever(a)}};ya.create=(r,e,t)=>new ya({schema:r,typeName:pt.ZodEffects,effect:e,...Et(t)});ya.createWithPreprocess=(r,e,t)=>new ya({schema:e,effect:{type:"preprocess",transform:r},typeName:pt.ZodEffects,...Et(t)});fa=class extends Rt{_parse(e){return this._getType(e)===ke.undefined?yn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};fa.create=(r,e)=>new fa({innerType:r,typeName:pt.ZodOptional,...Et(e)});ds=class extends Rt{_parse(e){return this._getType(e)===ke.null?yn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ds.create=(r,e)=>new ds({innerType:r,typeName:pt.ZodNullable,...Et(e)});Yi=class extends Rt{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===ke.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Yi.create=(r,e)=>new Yi({innerType:r,typeName:pt.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Et(e)});Zi=class extends Rt{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Fl(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new qn(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new qn(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Zi.create=(r,e)=>new Zi({innerType:r,typeName:pt.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Et(e)});Wl=class extends Rt{_parse(e){if(this._getType(e)!==ke.nan){let n=this._getOrReturnCtx(e);return _e(n,{code:Ee.invalid_type,expected:ke.nan,received:n.parsedType}),it}return{status:"valid",value:e.data}}};Wl.create=r=>new Wl({typeName:pt.ZodNaN,...Et(r)});RY=Symbol("zod_brand"),Td=class extends Rt{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},Od=class r extends Rt{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?it:s.status==="dirty"?(t.dirty(),Ui(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?it:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:pt.ZodPipeline})}},ec=class extends Rt{_parse(e){let t=this._def.innerType._parse(e),n=a=>(Lo(a)&&(a.value=Object.freeze(a.value)),a);return Fl(t)?t.then(a=>n(a)):n(t)}unwrap(){return this._def.innerType}};ec.create=(r,e)=>new ec({innerType:r,typeName:pt.ZodReadonly,...Et(e)});wY={object:Gn.lazycreate};(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(pt||(pt={}));IY=(r,e={message:`Input not instance of ${r.name}`})=>VM(t=>t instanceof r,e),zM=jo.create,HM=Bi.create,xY=Wl.create,TY=Fi.create,WM=qi.create,OY=Gi.create,NY=Gl.create,_Y=Vi.create,PY=zi.create,$Y=ko.create,LY=Vs.create,jY=Ma.create,kY=Vl.create,DY=zs.create,MY=Gn.create,UY=Gn.strictCreate,BY=Hi.create,FY=Cg.create,qY=Wi.create,GY=ps.create,VY=Ag.create,zY=zl.create,HY=Hl.create,WY=Sg.create,QY=Qi.create,JY=Ji.create,KY=Ki.create,XY=Xi.create,YY=Do.create,ZY=ya.create,eZ=fa.create,tZ=ds.create,rZ=ya.createWithPreprocess,nZ=Od.create,aZ=()=>zM().optional(),sZ=()=>HM().optional(),oZ=()=>WM().optional(),iZ={string:(r=>jo.create({...r,coerce:!0})),number:(r=>Bi.create({...r,coerce:!0})),boolean:(r=>qi.create({...r,coerce:!0})),bigint:(r=>Fi.create({...r,coerce:!0})),date:(r=>Gi.create({...r,coerce:!0}))},cZ=it});var Z={};wr(Z,{BRAND:()=>RY,DIRTY:()=>Ui,EMPTY_PATH:()=>rY,INVALID:()=>it,NEVER:()=>cZ,OK:()=>yn,ParseStatus:()=>un,Schema:()=>Rt,ZodAny:()=>ko,ZodArray:()=>zs,ZodBigInt:()=>Fi,ZodBoolean:()=>qi,ZodBranded:()=>Td,ZodCatch:()=>Zi,ZodDate:()=>Gi,ZodDefault:()=>Yi,ZodDiscriminatedUnion:()=>Cg,ZodEffects:()=>ya,ZodEnum:()=>Ki,ZodError:()=>qn,ZodFirstPartyTypeKind:()=>pt,ZodFunction:()=>Sg,ZodIntersection:()=>Wi,ZodIssueCode:()=>Ee,ZodLazy:()=>Qi,ZodLiteral:()=>Ji,ZodMap:()=>zl,ZodNaN:()=>Wl,ZodNativeEnum:()=>Xi,ZodNever:()=>Ma,ZodNull:()=>zi,ZodNullable:()=>ds,ZodNumber:()=>Bi,ZodObject:()=>Gn,ZodOptional:()=>fa,ZodParsedType:()=>ke,ZodPipeline:()=>Od,ZodPromise:()=>Do,ZodReadonly:()=>ec,ZodRecord:()=>Ag,ZodSchema:()=>Rt,ZodSet:()=>Hl,ZodString:()=>jo,ZodSymbol:()=>Gl,ZodTransformer:()=>ya,ZodTuple:()=>ps,ZodType:()=>Rt,ZodUndefined:()=>Vi,ZodUnion:()=>Hi,ZodUnknown:()=>Vs,ZodVoid:()=>Vl,addIssueToContext:()=>_e,any:()=>$Y,array:()=>DY,bigint:()=>TY,boolean:()=>WM,coerce:()=>iZ,custom:()=>VM,date:()=>OY,datetimeRegex:()=>qM,defaultErrorMap:()=>qs,discriminatedUnion:()=>FY,effect:()=>ZY,enum:()=>KY,function:()=>WY,getErrorMap:()=>Bl,getParsedType:()=>us,instanceof:()=>IY,intersection:()=>qY,isAborted:()=>vg,isAsync:()=>Fl,isDirty:()=>Eg,isValid:()=>Lo,late:()=>wY,lazy:()=>QY,literal:()=>JY,makeIssue:()=>xd,map:()=>zY,nan:()=>xY,nativeEnum:()=>XY,never:()=>jY,null:()=>PY,nullable:()=>tZ,number:()=>HM,object:()=>MY,objectUtil:()=>US,oboolean:()=>oZ,onumber:()=>sZ,optional:()=>eZ,ostring:()=>aZ,pipeline:()=>nZ,preprocess:()=>rZ,promise:()=>YY,quotelessJson:()=>ZX,record:()=>VY,set:()=>HY,setErrorMap:()=>tY,strictObject:()=>UY,string:()=>zM,symbol:()=>NY,transformer:()=>ZY,tuple:()=>GY,undefined:()=>_Y,union:()=>BY,unknown:()=>LY,util:()=>Lt,void:()=>kY});var VS=G(()=>{bg();FS();kM();Id();QM();yg()});var Rg=G(()=>{VS();VS()});function Nr(r,e){return e.includes(r.columnType)}function lZ(r){return"enumValues"in r&&Array.isArray(r.enumValues)&&r.enumValues.length>0}function JM(r,e){let t=e?.zodInstance??Z,n=e?.coerce??{},a;return lZ(r)&&(a=r.enumValues.length?t.enum(r.enumValues):t.string()),a||(Nr(r,["PgGeometry","PgPointTuple"])?a=t.tuple([t.number(),t.number()]):Nr(r,["PgGeometryObject","PgPointObject"])?a=t.object({x:t.number(),y:t.number()}):Nr(r,["PgHalfVector","PgVector"])?(a=t.array(t.number()),a=r.dimensions?a.length(r.dimensions):a):Nr(r,["PgLine"])?a=t.tuple([t.number(),t.number(),t.number()]):Nr(r,["PgLineABC"])?a=t.object({a:t.number(),b:t.number(),c:t.number()}):Nr(r,["PgArray"])?(a=t.array(JM(r.baseColumn,t)),a=r.size?a.length(r.size):a):r.dataType==="array"?a=t.array(t.any()):r.dataType==="number"?a=mZ(r,t,n):r.dataType==="bigint"?a=hZ(r,t,n):r.dataType==="boolean"?a=n===!0||n.boolean?t.coerce.boolean():t.boolean():r.dataType==="date"?a=n===!0||n.date?t.coerce.date():t.date():r.dataType==="string"?a=fZ(r,t,n):r.dataType==="json"?a=pZ:r.dataType==="custom"?a=t.any():r.dataType==="buffer"&&(a=dZ)),a||(a=t.any()),a}function mZ(r,e,t){let n=r.getSQLType().includes("unsigned"),a,s,o=!1;Nr(r,["MySqlTinyInt","SingleStoreTinyInt"])?(a=n?0:vr.INT8_MIN,s=n?vr.INT8_UNSIGNED_MAX:vr.INT8_MAX,o=!0):Nr(r,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(a=n?0:vr.INT16_MIN,s=n?vr.INT16_UNSIGNED_MAX:vr.INT16_MAX,o=!0):Nr(r,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(a=n?0:vr.INT24_MIN,s=n?vr.INT24_UNSIGNED_MAX:vr.INT24_MAX,o=Nr(r,["MySqlMediumInt","SingleStoreMediumInt"])):Nr(r,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(a=n?0:vr.INT32_MIN,s=n?vr.INT32_UNSIGNED_MAX:vr.INT32_MAX,o=!0):Nr(r,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(a=n?0:vr.INT48_MIN,s=n?vr.INT48_UNSIGNED_MAX:vr.INT48_MAX):Nr(r,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||Nr(r,["MySqlSerial","SingleStoreSerial"]),a=n?0:Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=!0):Nr(r,["MySqlYear","SingleStoreYear"])?(a=1901,s=2155,o=!0):(a=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER);let i=t===!0||t?.number?e.coerce.number():e.number();return i=i.min(a).max(s),o?i.int():i}function hZ(r,e,t){let n=r.getSQLType().includes("unsigned"),a=n?0n:vr.INT64_MIN,s=n?vr.INT64_UNSIGNED_MAX:vr.INT64_MAX;return(t===!0||t?.bigint?e.coerce.bigint():e.bigint()).min(a).max(s)}function fZ(r,e,t){if(Nr(r,["PgUUID"]))return e.string().uuid();let n,a,s=!1;Nr(r,["PgVarchar","SQLiteText"])?n=r.length:Nr(r,["MySqlVarChar","SingleStoreVarChar"])?n=r.length??vr.INT16_UNSIGNED_MAX:Nr(r,["MySqlText","SingleStoreText"])&&(r.textType==="longtext"?n=vr.INT32_UNSIGNED_MAX:r.textType==="mediumtext"?n=vr.INT24_UNSIGNED_MAX:r.textType==="text"?n=vr.INT16_UNSIGNED_MAX:n=vr.INT8_UNSIGNED_MAX),Nr(r,["PgChar","MySqlChar","SingleStoreChar"])&&(n=r.length,s=!0),Nr(r,["PgBinaryVector"])&&(a=/^[01]+$/,n=r.dimensions);let o=t===!0||t?.string?e.coerce.string():e.string();return o=a?o.regex(a):o,n&&s?o.length(n):n?o.max(n):o}function KM(r){return hA(r)?Di(r):Xk(r)}function XM(r,e,t,n){let a={};for(let[s,o]of Object.entries(r)){if(!pe(o,Ht)&&!pe(o,je)&&!pe(o,je.Aliased)&&typeof o=="object"){let m=hA(o)||Wk(o)?KM(o):o;a[s]=XM(m,e[s]??{},t,n);continue}let i=e[s];if(i!==void 0&&typeof i!="function"){a[s]=i;continue}let u=pe(o,Ht)?o:void 0,c=u?JM(u,n):Z.any(),p=typeof i=="function"?i(c):c;t.never(u)||(a[s]=p,u&&(t.nullable(u)&&(a[s]=a[s].nullable()),t.optional(u)&&(a[s]=a[s].optional())))}return Z.object(a)}var vr,uZ,pZ,dZ,gZ,dt,zS=G(()=>{Rg();Da();vr={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};uZ=Z.union([Z.string(),Z.number(),Z.boolean(),Z.null()]),pZ=Z.union([uZ,Z.record(Z.any()),Z.array(Z.any())]),dZ=Z.custom(r=>r instanceof Buffer);gZ={never:r=>r?.generated?.type==="always"||r?.generatedIdentity?.type==="always",optional:r=>!r.notNull||r.notNull&&r.hasDefault,nullable:r=>!r.notNull},dt=(r,e)=>{let t=KM(r);return XM(t,e??{},gZ)}});var nn,Ua,yZ,bZ,YM,ZM,vZ,EZ,bn,CZ,eU=G(()=>{"use strict";hg();zS();Da();nn=ot("chat_sessions",{id:ut("id").primaryKey(),projectId:X("project_id"),reeditProjectId:X("reedit_project_id"),agentType:K("agent_type").notNull(),title:K("title").notNull(),chapterNumber:X("chapter_number"),status:K("status").notNull().default("active"),contextSummary:K("context_summary"),totalInputTokens:X("total_input_tokens").default(0),totalOutputTokens:X("total_output_tokens").default(0),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),updatedAt:qe("updated_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Ua=ot("chat_messages",{id:ut("id").primaryKey(),sessionId:X("session_id").notNull(),role:K("role").notNull(),content:K("content").notNull(),chapterReference:X("chapter_reference"),metadata:Ne("metadata"),inputTokens:X("input_tokens").default(0),outputTokens:X("output_tokens").default(0),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),yZ=dt(nn).omit({id:!0,createdAt:!0,updatedAt:!0,totalInputTokens:!0,totalOutputTokens:!0}),bZ=dt(Ua).omit({id:!0,createdAt:!0,inputTokens:!0,outputTokens:!0}),YM=ot("conversations",{id:ut("id").primaryKey(),title:K("title").notNull(),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),ZM=ot("messages",{id:ut("id").primaryKey(),conversationId:X("conversation_id").notNull(),role:K("role").notNull(),content:K("content").notNull(),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),vZ=dt(YM).omit({id:!0,createdAt:!0}),EZ=dt(ZM).omit({id:!0,createdAt:!0}),bn=ot("chat_proposals",{id:ut("id").primaryKey(),messageId:X("message_id").notNull(),sessionId:X("session_id").notNull(),proposalType:K("proposal_type").notNull(),targetType:K("target_type").notNull(),targetId:X("target_id"),targetName:K("target_name"),description:K("description").notNull(),originalContent:K("original_content"),proposedContent:K("proposed_content").notNull(),status:K("status").notNull().default("pending"),appliedAt:qe("applied_at"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),CZ=dt(bn).omit({id:!0,createdAt:!0,appliedAt:!0})});var wg={};wr(wg,{activityLogs:()=>ur,agentStatuses:()=>Ea,aiUsageEvents:()=>wt,autoCorrectionRuns:()=>bt,chapterAnnotations:()=>Ba,chapterBackups:()=>va,chapterVersions:()=>ba,chapters:()=>Er,characterSchema:()=>DZ,chatMessages:()=>Ua,chatProposals:()=>bn,chatSessions:()=>nn,consistencyViolations:()=>Gt,continuitySnapshots:()=>Hs,continuityStateSchema:()=>FZ,conversations:()=>YM,correctedManuscripts:()=>Be,editingQueue:()=>Kn,entityRelationships:()=>On,extendedGuides:()=>Jn,generationLocks:()=>Sa,importedChapters:()=>qa,importedManuscripts:()=>mn,insertActivityLogSchema:()=>HZ,insertAgentStatusSchema:()=>LZ,insertAiUsageEventSchema:()=>eee,insertAutoCorrectionRunSchema:()=>uee,insertChapterAnnotationSchema:()=>IZ,insertChapterBackupSchema:()=>wZ,insertChapterSchema:()=>NZ,insertChapterVersionSchema:()=>SZ,insertChatMessageSchema:()=>bZ,insertChatProposalSchema:()=>CZ,insertChatSessionSchema:()=>yZ,insertConsistencyViolationSchema:()=>zZ,insertContinuitySnapshotSchema:()=>OZ,insertConversationSchema:()=>vZ,insertCorrectedManuscriptSchema:()=>cee,insertEditingQueueSchema:()=>RZ,insertEntityRelationshipSchema:()=>VZ,insertExtendedGuideSchema:()=>xZ,insertGenerationLockSchema:()=>oee,insertImportedChapterSchema:()=>kZ,insertImportedManuscriptSchema:()=>jZ,insertManuscriptAuditSchema:()=>iee,insertMessageSchema:()=>EZ,insertPlotThreadSchema:()=>_Z,insertProjectQueueSchema:()=>WZ,insertProjectSchema:()=>QS,insertPseudonymSchema:()=>HS,insertQueueStateSchema:()=>QZ,insertReeditAuditReportSchema:()=>aee,insertReeditChapterSchema:()=>nee,insertReeditIssueSchema:()=>see,insertReeditProjectSchema:()=>ree,insertReeditWorldBibleSchema:()=>tee,insertSeriesArcMilestoneSchema:()=>KZ,insertSeriesArcVerificationSchema:()=>YZ,insertSeriesPlotThreadSchema:()=>XZ,insertSeriesSchema:()=>TZ,insertSeriesWorldBibleSchema:()=>ZZ,insertStyleGuideSchema:()=>WS,insertThoughtLogSchema:()=>$Z,insertTranslationSchema:()=>JZ,insertUserSchema:()=>AZ,insertWorldBibleSchema:()=>PZ,insertWorldEntitySchema:()=>qZ,insertWorldRuleSchema:()=>GZ,insertWritingLessonSchema:()=>lee,manuscriptAudits:()=>Xe,messages:()=>ZM,plotOutlineSchema:()=>BZ,plotThreads:()=>Fa,projectQueue:()=>Ut,projects:()=>lt,pseudonyms:()=>pn,queueState:()=>tc,reeditAuditReports:()=>$r,reeditChapters:()=>Pr,reeditIssues:()=>er,reeditProjects:()=>_r,reeditWorldBibles:()=>Va,series:()=>an,seriesArcMilestones:()=>Ca,seriesArcVerifications:()=>Ga,seriesPlotThreads:()=>Aa,seriesWorldBible:()=>Yn,styleGuides:()=>dn,thoughtLogs:()=>Ws,timelineEventSchema:()=>MZ,translations:()=>Vr,users:()=>tU,worldBibles:()=>Xn,worldEntities:()=>ar,worldRuleSchema:()=>UZ,worldRulesTable:()=>Cr,writingLessons:()=>Vn});var tU,AZ,pn,dn,Jn,an,lt,Hs,Er,ba,SZ,Kn,RZ,va,wZ,Ba,IZ,Fa,mn,qa,Xn,Ws,Ea,HS,WS,xZ,TZ,QS,OZ,NZ,_Z,PZ,$Z,LZ,jZ,kZ,DZ,MZ,UZ,BZ,FZ,ur,ar,Cr,On,Gt,qZ,GZ,VZ,zZ,HZ,Ut,tc,WZ,QZ,Ca,Aa,Ga,Yn,Vr,JZ,KZ,XZ,YZ,ZZ,wt,eee,_r,Pr,$r,Va,tee,ree,nee,aee,er,see,Sa,oee,Xe,iee,Be,cee,Vn,lee,bt,uee,ms=G(()=>{"use strict";Da();hg();zS();Rg();eU();tU=ot("users",{id:Vf("id").primaryKey().default(B`gen_random_uuid()`),username:K("username").notNull().unique(),password:K("password").notNull()}),AZ=dt(tU).pick({username:!0,password:!0}),pn=ot("pseudonyms",{id:ut("id").primaryKey(),name:K("name").notNull(),bio:K("bio"),defaultGenre:K("default_genre"),defaultTone:K("default_tone"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),dn=ot("style_guides",{id:ut("id").primaryKey(),pseudonymId:X("pseudonym_id").notNull().references(()=>pn.id,{onDelete:"cascade"}),title:K("title").notNull(),content:K("content").notNull(),isActive:Yt("is_active").notNull().default(!0),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Jn=ot("extended_guides",{id:ut("id").primaryKey(),title:K("title").notNull(),description:K("description"),originalFileName:K("original_file_name").notNull(),content:K("content").notNull(),wordCount:X("word_count").default(0),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),an=ot("series",{id:ut("id").primaryKey(),title:K("title").notNull(),description:K("description"),workType:K("work_type").notNull().default("trilogy"),totalPlannedBooks:X("total_planned_books").default(3),pseudonymId:X("pseudonym_id").references(()=>pn.id,{onDelete:"set null"}),seriesGuide:K("series_guide"),seriesGuideFileName:K("series_guide_file_name"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),lt=ot("projects",{id:ut("id").primaryKey(),title:K("title").notNull(),premise:K("premise"),genre:K("genre").notNull().default("fantasy"),tone:K("tone").notNull().default("dramatic"),chapterCount:X("chapter_count").notNull().default(5),hasPrologue:Yt("has_prologue").notNull().default(!1),hasEpilogue:Yt("has_epilogue").notNull().default(!1),hasAuthorNote:Yt("has_author_note").notNull().default(!1),pseudonymId:X("pseudonym_id").references(()=>pn.id,{onDelete:"set null"}),styleGuideId:X("style_guide_id").references(()=>dn.id,{onDelete:"set null"}),extendedGuideId:X("extended_guide_id").references(()=>Jn.id,{onDelete:"set null"}),workType:K("work_type").notNull().default("standalone"),bookboxStructure:Ne("bookbox_structure"),seriesId:X("series_id").references(()=>an.id,{onDelete:"set null"}),seriesOrder:X("series_order"),status:K("status").notNull().default("idle"),currentChapter:X("current_chapter").default(0),revisionCycle:X("revision_cycle").default(0),maxRevisionCycles:X("max_revision_cycles").default(3),voiceAuditCompleted:Yt("voice_audit_completed").default(!1),semanticCheckCompleted:Yt("semantic_check_completed").default(!1),finalReviewResult:Ne("final_review_result"),finalScore:X("final_score"),totalInputTokens:X("total_input_tokens").default(0),totalOutputTokens:X("total_output_tokens").default(0),totalThinkingTokens:X("total_thinking_tokens").default(0),minWordCount:X("min_word_count"),minWordsPerChapter:X("min_words_per_chapter").default(1500),maxWordsPerChapter:X("max_words_per_chapter").default(3500),kindleUnlimitedOptimized:Yt("kindle_unlimited_optimized").notNull().default(!1),architectInstructions:K("architect_instructions"),pipelineVersion:K("pipeline_version").default("v1"),betaReaderReport:Ne("beta_reader_report"),betaReaderScore:X("beta_reader_score"),commercialViability:K("commercial_viability"),qaAuditReport:Ne("qa_audit_report"),qaAuditCompleted:Yt("qa_audit_completed").default(!1),generationToken:K("generation_token"),resolvedIssueHashes:Ne("resolved_issue_hashes").default([]),chapterCorrectionCounts:Ne("chapter_correction_counts").default({}),successfullyCorrectedChapters:Ne("successfully_corrected_chapters").default([]),consecutiveHighScores:X("consecutive_high_scores").default(0),targetedRepairDiagnosis:Ne("targeted_repair_diagnosis"),targetedRepairPlan:Ne("targeted_repair_plan"),targetedRepairStatus:K("targeted_repair_status"),targetedRepairProgress:Ne("targeted_repair_progress"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Hs=ot("continuity_snapshots",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),synopsis:K("synopsis"),characterStates:Ne("character_states").default([]),unresolvedThreads:Ne("unresolved_threads").default([]),worldStateChanges:Ne("world_state_changes").default([]),keyEvents:Ne("key_events").default([]),tokenCount:X("token_count").default(0),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),updatedAt:qe("updated_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Er=ot("chapters",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),chapterNumber:X("chapter_number").notNull(),title:K("title"),content:K("content"),originalContent:K("original_content"),wordCount:X("word_count").default(0),status:K("status").notNull().default("pending"),needsRevision:Yt("needs_revision").default(!1),revisionReason:K("revision_reason"),continuityState:Ne("continuity_state"),sceneBreakdown:Ne("scene_breakdown"),summary:K("summary"),editorFeedback:Ne("editor_feedback"),qualityScore:X("quality_score"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),ba=ot("chapter_versions",{id:ut("id").primaryKey(),chapterId:X("chapter_id").notNull().references(()=>Er.id,{onDelete:"cascade"}),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),versionNumber:X("version_number").notNull(),content:K("content").notNull(),changeReason:K("change_reason"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),SZ=dt(ba).omit({id:!0,createdAt:!0}),Kn=ot("editing_queue",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),chapterId:X("chapter_id").notNull().references(()=>Er.id,{onDelete:"cascade"}),chapterNumber:X("chapter_number").notNull(),issueType:K("issue_type").notNull(),severity:K("severity").notNull().default("medium"),instruction:K("instruction").notNull(),status:K("status").notNull().default("pending"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),RZ=dt(Kn).omit({id:!0,createdAt:!0}),va=ot("chapter_backups",{id:ut("id").primaryKey(),originalChapterId:X("original_chapter_id").notNull(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),chapterNumber:X("chapter_number").notNull(),title:K("title"),content:K("content"),originalContent:K("original_content"),wordCount:X("word_count"),status:K("status"),summary:K("summary"),sceneBreakdown:Ne("scene_breakdown"),editorFeedback:Ne("editor_feedback"),qualityScore:X("quality_score"),operation:K("operation").notNull(),operationDetails:K("operation_details"),restoredAt:qe("restored_at"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),wZ=dt(va).omit({id:!0,createdAt:!0,restoredAt:!0}),Ba=ot("chapter_annotations",{id:ut("id").primaryKey(),chapterId:X("chapter_id").notNull().references(()=>Er.id,{onDelete:"cascade"}),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),startOffset:X("start_offset").notNull(),endOffset:X("end_offset").notNull(),annotationType:K("annotation_type").notNull().default("error"),content:K("content"),note:K("note"),resolved:Yt("resolved").default(!1),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),resolvedAt:qe("resolved_at")}),IZ=dt(Ba).omit({id:!0,createdAt:!0,resolvedAt:!0}),Fa=ot("plot_threads",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),name:K("name").notNull(),description:K("description"),goal:K("goal"),status:K("status").notNull().default("active"),intensityScore:X("intensity_score").default(5),lastUpdatedChapter:X("last_updated_chapter").default(0),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),mn=ot("imported_manuscripts",{id:ut("id").primaryKey(),title:K("title").notNull(),originalFileName:K("original_file_name").notNull(),detectedLanguage:K("detected_language"),targetLanguage:K("target_language").default("es"),totalChapters:X("total_chapters").default(0),processedChapters:X("processed_chapters").default(0),status:K("status").notNull().default("pending"),parsingErrors:K("parsing_errors"),totalInputTokens:X("total_input_tokens").default(0),totalOutputTokens:X("total_output_tokens").default(0),totalThinkingTokens:X("total_thinking_tokens").default(0),seriesId:X("series_id").references(()=>an.id,{onDelete:"set null"}),seriesOrder:X("series_order"),pseudonymId:X("pseudonym_id").references(()=>pn.id,{onDelete:"set null"}),totalWordCount:X("total_word_count").default(0),continuitySnapshot:Ne("continuity_snapshot"),continuityAnalysisStatus:K("continuity_analysis_status").default("pending"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),qa=ot("imported_chapters",{id:ut("id").primaryKey(),manuscriptId:X("manuscript_id").notNull().references(()=>mn.id,{onDelete:"cascade"}),chapterNumber:X("chapter_number").notNull(),title:K("title"),originalContent:K("original_content").notNull(),editedContent:K("edited_content"),changesLog:K("changes_log"),wordCount:X("word_count").default(0),status:K("status").notNull().default("pending"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Xn=ot("world_bibles",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),timeline:Ne("timeline").default([]),characters:Ne("characters").default([]),worldRules:Ne("world_rules").default([]),plotOutline:Ne("plot_outline").default({}),plotDecisions:Ne("plot_decisions").default([]),persistentInjuries:Ne("persistent_injuries").default([]),updatedAt:qe("updated_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Ws=ot("thought_logs",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),chapterId:X("chapter_id").references(()=>Er.id,{onDelete:"cascade"}),agentName:K("agent_name").notNull(),agentRole:K("agent_role").notNull(),thoughtContent:K("thought_content").notNull(),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Ea=ot("agent_statuses",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),agentName:K("agent_name").notNull(),status:K("status").notNull().default("idle"),currentTask:K("current_task"),lastActivity:qe("last_activity").default(B`CURRENT_TIMESTAMP`).notNull()}),HS=dt(pn).omit({id:!0,createdAt:!0}),WS=dt(dn).omit({id:!0,createdAt:!0}),xZ=dt(Jn).omit({id:!0,createdAt:!0}),TZ=dt(an).omit({id:!0,createdAt:!0}),QS=dt(lt).omit({id:!0,createdAt:!0,status:!0,currentChapter:!0}),OZ=dt(Hs).omit({id:!0,createdAt:!0,updatedAt:!0}),NZ=dt(Er).omit({id:!0,createdAt:!0}),_Z=dt(Fa).omit({id:!0,createdAt:!0}),PZ=dt(Xn).omit({id:!0,updatedAt:!0}),$Z=dt(Ws).omit({id:!0,createdAt:!0}),LZ=dt(Ea).omit({id:!0,lastActivity:!0}),jZ=dt(mn).omit({id:!0,createdAt:!0,status:!0,processedChapters:!0,totalInputTokens:!0,totalOutputTokens:!0,totalThinkingTokens:!0}),kZ=dt(qa).omit({id:!0,createdAt:!0}),DZ=Z.object({name:Z.string(),role:Z.string(),psychologicalProfile:Z.string(),relationships:Z.array(Z.string()).optional(),arc:Z.string().optional(),isAlive:Z.boolean().default(!0),aparienciaInmutable:Z.object({ojos:Z.string().optional(),cabello:Z.string().optional(),rasgosDistintivos:Z.array(Z.string()).optional(),altura:Z.string().optional(),edad:Z.string().optional()}).optional()}),MZ=Z.object({chapter:Z.number(),event:Z.string(),characters:Z.array(Z.string()),significance:Z.string().optional()}),UZ=Z.object({category:Z.string(),rule:Z.string(),constraints:Z.array(Z.string()).optional()}),BZ=Z.object({premise:Z.string().optional(),threeActStructure:Z.object({act1:Z.object({setup:Z.string().optional(),incitingIncident:Z.string().optional()}).optional(),act2:Z.object({risingAction:Z.string().optional(),midpoint:Z.string().optional(),complications:Z.string().optional()}).optional(),act3:Z.object({climax:Z.string().optional(),resolution:Z.string().optional()}).optional()}).optional(),chapterOutlines:Z.array(Z.object({number:Z.number(),summary:Z.string(),keyEvents:Z.array(Z.string())})).optional()}),FZ=Z.object({characterStates:Z.record(Z.string(),Z.object({location:Z.string(),status:Z.enum(["alive","dead","injured","unconscious","missing","imprisoned"]),hasItems:Z.array(Z.string()).optional(),emotionalState:Z.string().optional(),knowledgeGained:Z.array(Z.string()).optional()})).optional(),narrativeTime:Z.string().optional(),keyReveals:Z.array(Z.string()).optional(),pendingThreads:Z.array(Z.string()).optional(),resolvedThreads:Z.array(Z.string()).optional(),locationState:Z.record(Z.string(),Z.string()).optional()}),ur=ot("activity_logs",{id:ut("id").primaryKey(),projectId:X("project_id").references(()=>lt.id,{onDelete:"cascade"}),reeditProjectId:X("reedit_project_id").references(()=>_r.id,{onDelete:"cascade"}),level:K("level").notNull().default("info"),agentRole:K("agent_role"),message:K("message").notNull(),metadata:Ne("metadata"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),ar=ot("world_entities",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),name:K("name").notNull(),type:K("type").notNull(),attributes:Ne("attributes").default({}),lastSeenChapter:X("last_seen_chapter"),status:K("status").notNull().default("active"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),updatedAt:qe("updated_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Cr=ot("world_rules",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),ruleDescription:K("rule_description").notNull(),category:K("category"),isActive:Yt("is_active").notNull().default(!0),sourceChapter:X("source_chapter"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),On=ot("entity_relationships",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),subjectId:X("subject_id").notNull().references(()=>ar.id,{onDelete:"cascade"}),targetId:X("target_id").notNull().references(()=>ar.id,{onDelete:"cascade"}),relationType:K("relation_type").notNull(),meta:Ne("meta").default({}),isActive:Yt("is_active").notNull().default(!0),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),updatedAt:qe("updated_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Gt=ot("consistency_violations",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),chapterNumber:X("chapter_number").notNull(),violationType:K("violation_type").notNull(),severity:K("severity").notNull().default("major"),description:K("description").notNull(),affectedEntities:Ne("affected_entities").default([]),brokenRuleId:X("broken_rule_id").references(()=>Cr.id,{onDelete:"set null"}),status:K("status").notNull().default("pending"),wasAutoFixed:Yt("was_auto_fixed").notNull().default(!1),fixDescription:K("fix_description"),resolvedAt:qe("resolved_at"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),qZ=dt(ar).omit({id:!0,createdAt:!0,updatedAt:!0}),GZ=dt(Cr).omit({id:!0,createdAt:!0}),VZ=dt(On).omit({id:!0,createdAt:!0,updatedAt:!0}),zZ=dt(Gt).omit({id:!0,createdAt:!0}),HZ=dt(ur).omit({id:!0,createdAt:!0}),Ut=ot("project_queue",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),position:X("position").notNull(),status:K("status").notNull().default("waiting"),priority:K("priority").notNull().default("normal"),addedAt:qe("added_at").default(B`CURRENT_TIMESTAMP`).notNull(),startedAt:qe("started_at"),completedAt:qe("completed_at"),errorMessage:K("error_message")}),tc=ot("queue_state",{id:ut("id").primaryKey(),status:K("status").notNull().default("stopped"),currentProjectId:X("current_project_id").references(()=>lt.id,{onDelete:"set null"}),autoAdvance:Yt("auto_advance").notNull().default(!0),skipOnError:Yt("skip_on_error").notNull().default(!0),pauseAfterEach:Yt("pause_after_each").notNull().default(!1),updatedAt:qe("updated_at").default(B`CURRENT_TIMESTAMP`).notNull()}),WZ=dt(Ut).omit({id:!0,addedAt:!0,startedAt:!0,completedAt:!0}),QZ=dt(tc).omit({id:!0,updatedAt:!0}),Ca=ot("series_arc_milestones",{id:ut("id").primaryKey(),seriesId:X("series_id").notNull().references(()=>an.id,{onDelete:"cascade"}),volumeNumber:X("volume_number").notNull(),milestoneType:K("milestone_type").notNull(),description:K("description").notNull(),isRequired:Yt("is_required").notNull().default(!0),isFulfilled:Yt("is_fulfilled").notNull().default(!1),fulfilledInProjectId:X("fulfilled_in_project_id").references(()=>lt.id,{onDelete:"set null"}),fulfilledInChapter:X("fulfilled_in_chapter"),verificationNotes:K("verification_notes"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Aa=ot("series_plot_threads",{id:ut("id").primaryKey(),seriesId:X("series_id").notNull().references(()=>an.id,{onDelete:"cascade"}),threadName:K("thread_name").notNull(),description:K("description"),introducedVolume:X("introduced_volume").notNull(),introducedChapter:X("introduced_chapter"),resolvedVolume:X("resolved_volume"),resolvedChapter:X("resolved_chapter"),status:K("status").notNull().default("active"),importance:K("importance").notNull().default("major"),relatedCharacters:K("related_characters").array(),progressNotes:Ne("progress_notes").default([]),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Ga=ot("series_arc_verifications",{id:ut("id").primaryKey(),seriesId:X("series_id").notNull().references(()=>an.id,{onDelete:"cascade"}),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),volumeNumber:X("volume_number").notNull(),verificationDate:qe("verification_date").default(B`CURRENT_TIMESTAMP`).notNull(),overallScore:X("overall_score"),milestonesChecked:X("milestones_checked").default(0),milestonesFulfilled:X("milestones_fulfilled").default(0),threadsProgressed:X("threads_progressed").default(0),threadsResolved:X("threads_resolved").default(0),findings:Ne("findings").default([]),recommendations:K("recommendations"),status:K("status").notNull().default("pending")}),Yn=ot("series_world_bible",{id:ut("id").primaryKey(),seriesId:X("series_id").notNull().references(()=>an.id,{onDelete:"cascade"}),characters:Ne("characters").default([]),locations:Ne("locations").default([]),lessons:Ne("lessons").default([]),worldRules:Ne("world_rules").default([]),timeline:Ne("timeline").default([]),objects:Ne("objects").default([]),secrets:Ne("secrets").default([]),lastUpdatedVolume:X("last_updated_volume").default(0),updatedAt:qe("updated_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Vr=ot("translations",{id:ut("id").primaryKey(),projectId:X("project_id").references(()=>lt.id,{onDelete:"cascade"}),reeditProjectId:X("reedit_project_id").references(()=>_r.id,{onDelete:"cascade"}),importedManuscriptId:X("imported_manuscript_id").references(()=>mn.id,{onDelete:"cascade"}),source:K("source").notNull().default("original"),projectTitle:K("project_title").notNull(),sourceLanguage:K("source_language").notNull(),targetLanguage:K("target_language").notNull(),chaptersTranslated:X("chapters_translated").default(0),totalWords:X("total_words").default(0),markdown:K("markdown").notNull(),inputTokens:X("input_tokens").default(0),outputTokens:X("output_tokens").default(0),thinkingTokens:X("thinking_tokens").default(0),glossary:Ne("glossary").default({}),typographicalRules:K("typographical_rules"),toneInstructions:K("tone_instructions"),layoutScore:X("layout_score").default(0),naturalnessScore:X("naturalness_score").default(0),currentChunk:X("current_chunk").default(0),totalChunks:X("total_chunks").default(0),status:K("status").notNull().default("pending"),heartbeatAt:qe("heartbeat_at"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),JZ=dt(Vr).omit({id:!0,createdAt:!0}),KZ=dt(Ca).omit({id:!0,createdAt:!0}),XZ=dt(Aa).omit({id:!0,createdAt:!0}),YZ=dt(Ga).omit({id:!0,verificationDate:!0}),ZZ=dt(Yn).omit({id:!0,updatedAt:!0}),wt=ot("ai_usage_events",{id:ut("id").primaryKey(),projectId:X("project_id").references(()=>lt.id,{onDelete:"cascade"}),translationId:X("translation_id").references(()=>Vr.id,{onDelete:"cascade"}),agentName:K("agent_name").notNull(),model:K("model").notNull().default("gemini-2.5-pro"),inputTokens:X("input_tokens").notNull().default(0),outputTokens:X("output_tokens").notNull().default(0),thinkingTokens:X("thinking_tokens").notNull().default(0),inputCostUsd:K("input_cost_usd").notNull().default("0"),outputCostUsd:K("output_cost_usd").notNull().default("0"),totalCostUsd:K("total_cost_usd").notNull().default("0"),chapterNumber:X("chapter_number"),operation:K("operation"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),eee=dt(wt).omit({id:!0,createdAt:!0}),_r=ot("reedit_projects",{id:ut("id").primaryKey(),title:K("title").notNull(),originalFileName:K("original_file_name").notNull(),sourceProjectId:X("source_project_id").references(()=>lt.id,{onDelete:"set null"}),detectedLanguage:K("detected_language"),settingContext:K("setting_context"),totalChapters:X("total_chapters").default(0),processedChapters:X("processed_chapters").default(0),currentStage:K("current_stage").notNull().default("uploaded"),currentChapter:X("current_chapter").default(0),currentActivity:K("current_activity"),chaptersBeingRewritten:Ne("chapters_being_rewritten").default([]),bestsellerScore:X("bestseller_score"),finalReviewResult:Ne("final_review_result"),structureAnalysis:Ne("structure_analysis"),forensicAuditResult:Ne("forensic_audit_result"),betaReaderReport:Ne("beta_reader_report"),betaReaderScore:X("beta_reader_score"),commercialViability:K("commercial_viability"),structuralReport:Ne("structural_report"),reconstructionPlan:Ne("reconstruction_plan"),planApproved:Yt("plan_approved").default(!1),styleGuideId:X("style_guide_id").references(()=>dn.id,{onDelete:"set null"}),pseudonymId:X("pseudonym_id").references(()=>pn.id,{onDelete:"set null"}),totalInputTokens:X("total_input_tokens").default(0),totalOutputTokens:X("total_output_tokens").default(0),totalThinkingTokens:X("total_thinking_tokens").default(0),totalWordCount:X("total_word_count").default(0),status:K("status").notNull().default("pending"),errorMessage:K("error_message"),heartbeatAt:qe("heartbeat_at"),cancelRequested:Yt("cancel_requested").default(!1),lastCompletedChapter:X("last_completed_chapter").default(0),expandChapters:Yt("expand_chapters").default(!1),insertNewChapters:Yt("insert_new_chapters").default(!1),targetMinWordsPerChapter:X("target_min_words_per_chapter").default(2e3),expansionPlan:Ne("expansion_plan"),revisionCycle:X("revision_cycle").default(0),totalReviewCycles:X("total_review_cycles").default(0),consecutiveHighScores:X("consecutive_high_scores").default(0),previousScores:Ne("previous_scores"),nonPerfectFinalReviews:X("non_perfect_final_reviews").default(0),pauseReason:K("pause_reason"),pendingUserInstructions:K("pending_user_instructions"),architectInstructions:K("architect_instructions"),resolvedIssueHashes:Ne("resolved_issue_hashes").default([]),chapterCorrectionCounts:Ne("chapter_correction_counts").default({}),chapterChangeHistory:Ne("chapter_change_history").default({}),generationToken:K("generation_token"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Pr=ot("reedit_chapters",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>_r.id,{onDelete:"cascade"}),chapterNumber:X("chapter_number").notNull(),originalChapterNumber:X("original_chapter_number"),originalIndex:X("original_index"),finalIndex:X("final_index"),title:K("title"),originalContent:K("original_content").notNull(),editedContent:K("edited_content"),summary:K("summary"),actionType:K("action_type").default("KEEP_AND_POLISH"),insertPrompt:K("insert_prompt"),mergeWithNext:Yt("merge_with_next").default(!1),anachronismsFound:Ne("anachronisms_found").default([]),editorScore:X("editor_score"),editorFeedback:Ne("editor_feedback"),narrativeIssues:Ne("narrative_issues"),copyeditorChanges:K("copyeditor_changes"),fluencyImprovements:Ne("fluency_improvements"),isDuplicate:Yt("is_duplicate").default(!1),duplicateOfChapter:X("duplicate_of_chapter"),isOutOfOrder:Yt("is_out_of_order").default(!1),suggestedOrder:X("suggested_order"),wordCount:X("word_count").default(0),status:K("status").notNull().default("pending"),processingStage:K("processing_stage").default("none"),polishingInstructions:K("polishing_instructions"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),$r=ot("reedit_audit_reports",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>_r.id,{onDelete:"cascade"}),auditType:K("audit_type").notNull(),chapterRange:K("chapter_range"),score:X("score"),findings:Ne("findings"),recommendations:Ne("recommendations"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),Va=ot("reedit_world_bibles",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>_r.id,{onDelete:"cascade"}),characters:Ne("characters"),locations:Ne("locations"),timeline:Ne("timeline"),loreRules:Ne("lore_rules"),historicalPeriod:K("historical_period"),historicalDetails:Ne("historical_details"),extractedFromChapters:X("extracted_from_chapters"),confidence:X("confidence"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),tee=dt(Va).omit({id:!0,createdAt:!0}),ree=dt(_r).omit({id:!0,createdAt:!0,status:!0,currentStage:!0,processedChapters:!0,currentChapter:!0,totalInputTokens:!0,totalOutputTokens:!0,totalThinkingTokens:!0}),nee=dt(Pr).omit({id:!0,createdAt:!0}),aee=dt($r).omit({id:!0,createdAt:!0}),er=ot("reedit_issues",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>_r.id,{onDelete:"cascade"}),chapterNumber:X("chapter_number").notNull(),category:K("category").notNull(),severity:K("severity").notNull().default("mayor"),description:K("description").notNull(),textCitation:K("text_citation"),correctionInstruction:K("correction_instruction"),source:K("source").notNull().default("qa"),reviewCycle:X("review_cycle").default(0),status:K("status").notNull().default("pending"),resolvedAt:qe("resolved_at"),rejectionReason:K("rejection_reason"),issueHash:K("issue_hash"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull()}),see=dt(er).omit({id:!0,createdAt:!0,resolvedAt:!0}),Sa=ot("generation_locks",{id:ut("id").primaryKey(),lockType:K("lock_type").notNull(),title:K("title").notNull(),startedAt:qe("started_at").default(B`CURRENT_TIMESTAMP`).notNull(),isActive:Yt("is_active").notNull().default(!0)}),oee=dt(Sa).omit({id:!0,startedAt:!0}),Xe=ot("manuscript_audits",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),status:K("status").notNull().default("pending"),novelContent:K("novel_content").notNull(),bibleContent:K("bible_content"),cacheId:K("cache_id"),cacheExpiresAt:qe("cache_expires_at"),continuityReport:Ne("continuity_report"),characterReport:Ne("character_report"),styleReport:Ne("style_report"),finalAudit:Ne("final_audit"),criticalFlags:X("critical_flags").default(0),overallScore:X("overall_score"),errorMessage:K("error_message"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),completedAt:qe("completed_at")}),iee=dt(Xe).omit({id:!0,createdAt:!0,completedAt:!0}),Be=ot("corrected_manuscripts",{id:ut("id").primaryKey(),auditId:X("audit_id").notNull().references(()=>Xe.id,{onDelete:"cascade"}),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),status:K("status").notNull().default("pending"),source:K("source").notNull().default("manual"),originalContent:K("original_content").notNull(),correctedContent:K("corrected_content"),corrections:Ne("corrections"),pendingCorrections:Ne("pending_corrections"),totalIssues:X("total_issues").default(0),correctedIssues:X("corrected_issues").default(0),approvedIssues:X("approved_issues").default(0),rejectedIssues:X("rejected_issues").default(0),errorMessage:K("error_message"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),completedAt:qe("completed_at")}),cee=dt(Be).omit({id:!0,createdAt:!0,completedAt:!0}),Vn=ot("writing_lessons",{id:ut("id").primaryKey(),category:K("category").notNull(),lesson:K("lesson").notNull(),rationale:K("rationale").notNull(),badExample:K("bad_example"),goodExample:K("good_example"),severityWeight:X("severity_weight").notNull().default(5),evidenceCount:X("evidence_count").notNull().default(1),sourceProjectIds:Ne("source_project_ids").$type().default([]),isActive:Yt("is_active").notNull().default(!0),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),lastRefreshedAt:qe("last_refreshed_at").default(B`CURRENT_TIMESTAMP`).notNull()}),lee=dt(Vn).omit({id:!0,createdAt:!0,lastRefreshedAt:!0}),bt=ot("auto_correction_runs",{id:ut("id").primaryKey(),projectId:X("project_id").notNull().references(()=>lt.id,{onDelete:"cascade"}),status:K("status").notNull().default("pending"),currentCycle:X("current_cycle").notNull().default(1),maxCycles:X("max_cycles").notNull().default(3),targetScore:X("target_score").notNull().default(85),maxCriticalIssues:X("max_critical_issues").notNull().default(0),currentAuditId:X("current_audit_id"),currentManuscriptId:X("current_manuscript_id"),cycleHistory:Ne("cycle_history").$type().default([]),progressLog:Ne("progress_log").$type().default([]),finalScore:X("final_score"),finalCriticalIssues:X("final_critical_issues"),totalIssuesFixed:X("total_issues_fixed").default(0),totalStructuralChanges:X("total_structural_changes").default(0),errorMessage:K("error_message"),createdAt:qe("created_at").default(B`CURRENT_TIMESTAMP`).notNull(),completedAt:qe("completed_at")}),uee=dt(bt).omit({id:!0,createdAt:!0,completedAt:!0})});var pee,M,Mo=G(()=>{"use strict";PM();xf();ms();pee=new No.Pool({connectionString:process.env.DATABASE_URL}),M=gg(pee,{schema:wg})});var JS,b,vn=G(()=>{"use strict";Mo();ms();Da();JS=class{async createPseudonym(e){let[t]=await M.insert(pn).values(e).returning();return t}async getPseudonym(e){let[t]=await M.select().from(pn).where(q(pn.id,e));return t}async getAllPseudonyms(){return M.select().from(pn).orderBy(ft(pn.createdAt))}async updatePseudonym(e,t){let[n]=await M.update(pn).set(t).where(q(pn.id,e)).returning();return n}async deletePseudonym(e){await M.delete(pn).where(q(pn.id,e))}async createStyleGuide(e){let[t]=await M.insert(dn).values(e).returning();return t}async getStyleGuide(e){let[t]=await M.select().from(dn).where(q(dn.id,e));return t}async getStyleGuidesByPseudonym(e){return M.select().from(dn).where(q(dn.pseudonymId,e)).orderBy(ft(dn.createdAt))}async getAllStyleGuides(){return M.select().from(dn).orderBy(ft(dn.createdAt))}async updateStyleGuide(e,t){let[n]=await M.update(dn).set(t).where(q(dn.id,e)).returning();return n}async deleteStyleGuide(e){await M.delete(dn).where(q(dn.id,e))}async createProject(e){let[t]=await M.insert(lt).values(e).returning();return t}async getProject(e){let[t]=await M.select().from(lt).where(q(lt.id,e));return t}async getAllProjects(){return M.select().from(lt).orderBy(ft(lt.createdAt))}async updateProject(e,t){let[n]=await M.update(lt).set(t).where(q(lt.id,e)).returning();return n}async deleteProject(e){await M.delete(ur).where(q(ur.projectId,e)),await M.delete(lt).where(q(lt.id,e))}async createChapter(e){let[t]=await M.insert(Er).values(e).returning();return t}async getChaptersByProject(e){return M.select().from(Er).where(q(Er.projectId,e)).orderBy(Er.chapterNumber)}async getAllChapters(){return M.select().from(Er).orderBy(Er.projectId,Er.chapterNumber)}async updateChapter(e,t){let[n]=await M.update(Er).set(t).where(q(Er.id,e)).returning();return n}async deleteChapter(e){await M.delete(Er).where(q(Er.id,e))}async createChapterBackup(e){let[t]=await M.insert(va).values(e).returning();return t}async getChapterBackupsByProject(e){return M.select().from(va).where(Zt(q(va.projectId,e),Dl(va.restoredAt))).orderBy(ft(va.createdAt))}async getChapterBackup(e){let[t]=await M.select().from(va).where(q(va.id,e));return t}async markBackupRestored(e){await M.update(va).set({restoredAt:new Date}).where(q(va.id,e))}async createWorldBible(e){let[t]=await M.insert(Xn).values(e).returning();return t}async getWorldBibleByProject(e){return(await M.select().from(Xn).where(q(Xn.projectId,e)).orderBy(ft(Xn.id)))[0]}async getAllWorldBibles(){return M.select().from(Xn)}async updateWorldBible(e,t){let[n]=await M.update(Xn).set({...t,updatedAt:new Date}).where(q(Xn.id,e)).returning();return n}async createThoughtLog(e){let[t]=await M.insert(Ws).values(e).returning();return t}async getThoughtLogsByProject(e){return M.select().from(Ws).where(q(Ws.projectId,e)).orderBy(ft(Ws.createdAt))}async getAllThoughtLogs(){return M.select().from(Ws).orderBy(ft(Ws.createdAt))}async createAgentStatus(e){let[t]=await M.insert(Ea).values(e).returning();return t}async getAgentStatusesByProject(e){return M.select().from(Ea).where(q(Ea.projectId,e))}async updateAgentStatus(e,t,n){let[a]=await M.select().from(Ea).where(Zt(q(Ea.projectId,e),q(Ea.agentName,t)));if(!a){let[o]=await M.insert(Ea).values({projectId:e,agentName:t,...n}).returning();return o}let[s]=await M.update(Ea).set({...n,lastActivity:new Date}).where(q(Ea.id,a.id)).returning();return s}async createSeries(e){let[t]=await M.insert(an).values(e).returning();return t}async getSeries(e){let[t]=await M.select().from(an).where(q(an.id,e));return t}async getAllSeries(){return M.select().from(an).orderBy(ft(an.createdAt))}async updateSeries(e,t){let[n]=await M.update(an).set(t).where(q(an.id,e)).returning();return n}async deleteSeries(e){await M.delete(an).where(q(an.id,e))}async getProjectsBySeries(e){return M.select().from(lt).where(q(lt.seriesId,e)).orderBy(lt.seriesOrder)}async createContinuitySnapshot(e){let[t]=await M.insert(Hs).values(e).returning();return t}async getContinuitySnapshotByProject(e){let[t]=await M.select().from(Hs).where(q(Hs.projectId,e));return t}async updateContinuitySnapshot(e,t){let[n]=await M.update(Hs).set({...t,updatedAt:new Date}).where(q(Hs.id,e)).returning();return n}async getSeriesContinuitySnapshots(e){let n=(await this.getProjectsBySeries(e)).map(s=>s.id),a=[];for(let s of n){let o=await this.getContinuitySnapshotByProject(s);o&&a.push(o)}return a}async getSeriesFullContinuity(e){let t=await this.getSeriesContinuitySnapshots(e),a=(await this.getImportedManuscriptsBySeries(e)).filter(s=>s.continuitySnapshot).map(s=>({manuscriptId:s.id,title:s.title,seriesOrder:s.seriesOrder,snapshot:s.continuitySnapshot}));return{projectSnapshots:t,manuscriptSnapshots:a}}async getAllContinuitySnapshots(){return M.select().from(Hs)}async createImportedManuscript(e){let[t]=await M.insert(mn).values(e).returning();return t}async getImportedManuscript(e){let[t]=await M.select().from(mn).where(q(mn.id,e));return t}async getAllImportedManuscripts(){return M.select().from(mn).orderBy(ft(mn.createdAt))}async getImportedManuscriptsBySeries(e){return M.select().from(mn).where(q(mn.seriesId,e)).orderBy(mn.seriesOrder)}async updateImportedManuscript(e,t){let[n]=await M.update(mn).set(t).where(q(mn.id,e)).returning();return n}async deleteImportedManuscript(e){await M.delete(mn).where(q(mn.id,e))}async createImportedChapter(e){let[t]=await M.insert(qa).values(e).returning();return t}async getImportedChaptersByManuscript(e){return M.select().from(qa).where(q(qa.manuscriptId,e)).orderBy(qa.chapterNumber)}async getImportedChapter(e){let[t]=await M.select().from(qa).where(q(qa.id,e));return t}async updateImportedChapter(e,t){let[n]=await M.update(qa).set(t).where(q(qa.id,e)).returning();return n}async createExtendedGuide(e){let[t]=await M.insert(Jn).values(e).returning();return t}async getExtendedGuide(e){let[t]=await M.select().from(Jn).where(q(Jn.id,e));return t}async getAllExtendedGuides(){return M.select().from(Jn).orderBy(ft(Jn.createdAt))}async updateExtendedGuide(e,t){let[n]=await M.update(Jn).set(t).where(q(Jn.id,e)).returning();return n}async deleteExtendedGuide(e){await M.delete(Jn).where(q(Jn.id,e))}async createActivityLog(e){let[t]=await M.insert(ur).values(e).returning();return t}async getActivityLogsByProject(e,t=500){return e===null?M.select().from(ur).where(Dl(ur.projectId)).orderBy(ft(ur.createdAt)).limit(t):M.select().from(ur).where(q(ur.projectId,e)).orderBy(ft(ur.createdAt)).limit(t)}async getActivityLogsByReeditProject(e,t=5e3){return M.select().from(ur).where(q(ur.reeditProjectId,e)).orderBy(ft(ur.createdAt)).limit(t)}async getLastActivityLogTime(e){let[t]=await M.select({createdAt:ur.createdAt}).from(ur).where(q(ur.projectId,e)).orderBy(ft(ur.createdAt)).limit(1);return t?.createdAt??null}async cleanupOldActivityLogs(e,t=1e3){let n=e===null?Dl(ur.projectId):q(ur.projectId,e),a=await M.select({id:ur.id}).from(ur).where(n).orderBy(ft(ur.createdAt)).offset(t);if(a.length>0){let s=a.map(o=>o.id);for(let o of s)await M.delete(ur).where(q(ur.id,o))}}async addToQueue(e){let t=await M.select({position:Ut.position}).from(Ut).orderBy(ft(Ut.position)).limit(1),n=t.length>0?t[0].position:0,a=e.position&&e.position>0?e.position:n+1,[s]=await M.insert(Ut).values({...e,position:a}).returning();return s}async getQueueItems(){return M.select().from(Ut).orderBy(mr(Ut.position))}async getQueueItem(e){let[t]=await M.select().from(Ut).where(q(Ut.id,e));return t}async getQueueItemByProject(e){let[t]=await M.select().from(Ut).where(q(Ut.projectId,e));return t}async updateQueueItem(e,t){let[n]=await M.update(Ut).set(t).where(q(Ut.id,e)).returning();return n}async removeFromQueue(e){let t=await this.getQueueItem(e);t&&(await M.delete(Ut).where(q(Ut.id,e)),await M.update(Ut).set({position:B`${Ut.position} - 1`}).where(B`${Ut.position} > ${t.position}`))}async reorderQueue(e,t){let n=await this.getQueueItem(e);if(!n)return;let a=n.position;a!==t&&(t>a?await M.update(Ut).set({position:B`${Ut.position} - 1`}).where(Zt(B`${Ut.position} > ${a}`,B`${Ut.position} <= ${t}`)):await M.update(Ut).set({position:B`${Ut.position} + 1`}).where(Zt(B`${Ut.position} >= ${t}`,B`${Ut.position} < ${a}`)),await M.update(Ut).set({position:t}).where(q(Ut.id,e)))}async getNextInQueue(){let[e]=await M.select().from(Ut).where(q(Ut.status,"waiting")).orderBy(mr(Ut.position)).limit(1);return e}async getQueueState(){let[e]=await M.select().from(tc).limit(1);return e}async updateQueueState(e){let t=await this.getQueueState();if(t){let[n]=await M.update(tc).set({...e,updatedAt:B`CURRENT_TIMESTAMP`}).where(q(tc.id,t.id)).returning();return n}else{let[n]=await M.insert(tc).values({status:e.status||"stopped",autoAdvance:e.autoAdvance??!0,skipOnError:e.skipOnError??!0,pauseAfterEach:e.pauseAfterEach??!1,currentProjectId:e.currentProjectId||null}).returning();return n}}async createMilestone(e){let[t]=await M.insert(Ca).values(e).returning();return t}async getMilestonesBySeries(e){return M.select().from(Ca).where(q(Ca.seriesId,e)).orderBy(mr(Ca.volumeNumber),mr(Ca.id))}async updateMilestone(e,t){let[n]=await M.update(Ca).set(t).where(q(Ca.id,e)).returning();return n}async deleteMilestone(e){await M.delete(Ca).where(q(Ca.id,e))}async createPlotThread(e){let[t]=await M.insert(Aa).values(e).returning();return t}async getPlotThreadsBySeries(e){return M.select().from(Aa).where(q(Aa.seriesId,e)).orderBy(mr(Aa.introducedVolume),mr(Aa.id))}async updatePlotThread(e,t){let[n]=await M.update(Aa).set(t).where(q(Aa.id,e)).returning();return n}async deletePlotThread(e){await M.delete(Aa).where(q(Aa.id,e))}async createArcVerification(e){let[t]=await M.insert(Ga).values(e).returning();return t}async getArcVerificationsBySeries(e){return M.select().from(Ga).where(q(Ga.seriesId,e)).orderBy(ft(Ga.verificationDate))}async getArcVerificationByProject(e){let[t]=await M.select().from(Ga).where(q(Ga.projectId,e));return t}async updateArcVerification(e,t){let[n]=await M.update(Ga).set(t).where(q(Ga.id,e)).returning();return n}async createTranslation(e){let[t]=await M.insert(Vr).values(e).returning();return t}async getTranslation(e){let[t]=await M.select().from(Vr).where(q(Vr.id,e));return t}async getAllTranslations(){return M.select().from(Vr).orderBy(ft(Vr.createdAt))}async getTranslationsByProject(e){return M.select().from(Vr).where(q(Vr.projectId,e)).orderBy(ft(Vr.createdAt))}async deleteTranslation(e){await M.delete(Vr).where(q(Vr.id,e))}async findExistingTranslation(e,t){let[n]=await M.select().from(Vr).where(Zt(q(Vr.projectId,e),q(Vr.targetLanguage,t)));return n}async updateTranslation(e,t){let[n]=await M.update(Vr).set(t).where(q(Vr.id,e)).returning();return n}async createAiUsageEvent(e){let[t]=await M.insert(wt).values(e).returning();return t}async getAllAiUsageEvents(){return M.select().from(wt).orderBy(ft(wt.createdAt))}async getAiUsageEventsByProject(e){return M.select().from(wt).where(q(wt.projectId,e)).orderBy(ft(wt.createdAt))}async getAiUsageEventsByDateRange(e,t){return M.select().from(wt).where(Zt(B`${wt.createdAt} >= ${e}`,B`${wt.createdAt} <= ${t}`)).orderBy(ft(wt.createdAt))}async getAiUsageSummary(){return(await M.select({totalInputTokens:B`COALESCE(SUM(${wt.inputTokens}), 0)`,totalOutputTokens:B`COALESCE(SUM(${wt.outputTokens}), 0)`,totalThinkingTokens:B`COALESCE(SUM(${wt.thinkingTokens}), 0)`,totalCostUsd:B`COALESCE(SUM(CAST(${wt.totalCostUsd} AS numeric)), 0)`,eventCount:B`COUNT(*)`}).from(wt))[0]||{totalInputTokens:0,totalOutputTokens:0,totalThinkingTokens:0,totalCostUsd:0,eventCount:0}}async getAiUsageByAgent(){return M.select({agentName:wt.agentName,totalInputTokens:B`COALESCE(SUM(${wt.inputTokens}), 0)`,totalOutputTokens:B`COALESCE(SUM(${wt.outputTokens}), 0)`,totalCostUsd:B`COALESCE(SUM(CAST(${wt.totalCostUsd} AS numeric)), 0)`,eventCount:B`COUNT(*)`}).from(wt).groupBy(wt.agentName).orderBy(B`SUM(CAST(${wt.totalCostUsd} AS numeric)) DESC`)}async getAiUsageByDay(){return M.select({date:B`DATE(${wt.createdAt})`,totalInputTokens:B`COALESCE(SUM(${wt.inputTokens}), 0)`,totalOutputTokens:B`COALESCE(SUM(${wt.outputTokens}), 0)`,totalCostUsd:B`COALESCE(SUM(CAST(${wt.totalCostUsd} AS numeric)), 0)`,eventCount:B`COUNT(*)`}).from(wt).groupBy(B`DATE(${wt.createdAt})`).orderBy(B`DATE(${wt.createdAt}) DESC`).limit(30)}async getAiUsageByModel(){return M.select({model:wt.model,totalInputTokens:B`COALESCE(SUM(${wt.inputTokens}), 0)`,totalOutputTokens:B`COALESCE(SUM(${wt.outputTokens}), 0)`,totalThinkingTokens:B`COALESCE(SUM(${wt.thinkingTokens}), 0)`,totalCostUsd:B`COALESCE(SUM(CAST(${wt.totalCostUsd} AS numeric)), 0)`,eventCount:B`COUNT(*)`}).from(wt).groupBy(wt.model).orderBy(B`SUM(CAST(${wt.totalCostUsd} AS numeric)) DESC`)}async createReeditProject(e){let[t]=await M.insert(_r).values(e).returning();return t}async getReeditProject(e){let[t]=await M.select().from(_r).where(q(_r.id,e));return t}async getAllReeditProjects(){return M.select().from(_r).orderBy(ft(_r.createdAt))}async updateReeditProject(e,t){let[n]=await M.update(_r).set(t).where(q(_r.id,e)).returning();return n}async deleteReeditProject(e){await M.delete(_r).where(q(_r.id,e))}async createReeditChapter(e){let[t]=await M.insert(Pr).values(e).returning();return t}async createReeditChapterIfNotExists(e){if(e.originalChapterNumber!==void 0&&e.originalChapterNumber!==null){let n=await this.getReeditChapterByOriginalNumber(e.projectId,e.originalChapterNumber);if(n)return console.log(`[Storage] Chapter with originalChapterNumber ${e.originalChapterNumber} already exists for project ${e.projectId}, skipping creation`),n}let t=await M.select().from(Pr).where(Zt(q(Pr.projectId,e.projectId),q(Pr.chapterNumber,e.chapterNumber)));return t.length>0?(console.log(`[Storage] Chapter with chapterNumber ${e.chapterNumber} already exists for project ${e.projectId}, skipping creation`),t[0]):this.createReeditChapter(e)}async getAllReeditChapters(){return M.select().from(Pr).orderBy(mr(Pr.id))}async getReeditChaptersByProject(e){return M.select().from(Pr).where(q(Pr.projectId,e)).orderBy(mr(Pr.chapterNumber))}async getReeditChapter(e){let[t]=await M.select().from(Pr).where(q(Pr.id,e));return t}async getReeditChapterByOriginalNumber(e,t){let[n]=await M.select().from(Pr).where(Zt(q(Pr.projectId,e),q(Pr.originalChapterNumber,t)));return n}async updateReeditChapter(e,t){let[n]=await M.update(Pr).set(t).where(q(Pr.id,e)).returning();return n}async deleteReeditChaptersByProject(e){await M.delete(Pr).where(q(Pr.projectId,e))}async createReeditAuditReport(e){let[t]=await M.insert($r).values(e).returning();return t}async getReeditAuditReportsByProject(e){return M.select().from($r).where(q($r.projectId,e)).orderBy(ft($r.createdAt))}async getReeditAuditReportByType(e,t){let[n]=await M.select().from($r).where(Zt(q($r.projectId,e),q($r.auditType,t))).orderBy(ft($r.createdAt)).limit(1);return n}async getReeditAuditReportByTypeAndRange(e,t,n){let[a]=await M.select().from($r).where(Zt(q($r.projectId,e),q($r.auditType,t),q($r.chapterRange,n))).orderBy(ft($r.createdAt)).limit(1);return a}async deleteReeditAuditReportsByType(e,t){await M.delete($r).where(Zt(q($r.projectId,e),q($r.auditType,t)))}async createReeditWorldBible(e){let[t]=await M.insert(Va).values(e).returning();return t}async getReeditWorldBibleByProject(e){let[t]=await M.select().from(Va).where(q(Va.projectId,e)).orderBy(ft(Va.id)).limit(1);return t}async updateReeditWorldBible(e,t){let[n]=await M.update(Va).set(t).where(q(Va.id,e)).returning();return n}async deleteReeditWorldBible(e){await M.delete(Va).where(q(Va.projectId,e))}async createReeditIssue(e){let[t]=await M.insert(er).values(e).returning();return t}async getReeditIssuesByProject(e){return M.select().from(er).where(q(er.projectId,e)).orderBy(mr(er.chapterNumber),ft(er.severity))}async getReeditIssuesByChapter(e,t){return M.select().from(er).where(Zt(q(er.projectId,e),q(er.chapterNumber,t))).orderBy(ft(er.severity))}async getReeditIssuesByStatus(e,t){return M.select().from(er).where(Zt(q(er.projectId,e),q(er.status,t))).orderBy(mr(er.chapterNumber))}async updateReeditIssue(e,t){let[n]=await M.update(er).set(t).where(q(er.id,e)).returning();return n}async approveReeditIssue(e){let[t]=await M.update(er).set({status:"approved"}).where(q(er.id,e)).returning();return t}async rejectReeditIssue(e,t){let[n]=await M.update(er).set({status:"rejected",rejectionReason:t||null}).where(q(er.id,e)).returning();return n}async resolveReeditIssue(e){let[t]=await M.update(er).set({status:"resolved",resolvedAt:new Date}).where(q(er.id,e)).returning();return t}async deleteReeditIssuesByProject(e){await M.delete(er).where(q(er.projectId,e))}async getApprovedPendingIssues(e){return M.select().from(er).where(Zt(q(er.projectId,e),q(er.status,"approved"))).orderBy(mr(er.chapterNumber))}async createChatSession(e){let[t]=await M.insert(nn).values(e).returning();return t}async getChatSession(e){let[t]=await M.select().from(nn).where(q(nn.id,e));return t}async getChatSessionsByProject(e,t){return M.select().from(nn).where(Zt(q(nn.projectId,e),q(nn.agentType,t))).orderBy(ft(nn.updatedAt))}async getChatSessionsByReeditProject(e,t){return M.select().from(nn).where(Zt(q(nn.reeditProjectId,e),q(nn.agentType,t))).orderBy(ft(nn.updatedAt))}async updateChatSession(e,t){let[n]=await M.update(nn).set({...t,updatedAt:new Date}).where(q(nn.id,e)).returning();return n}async deleteChatSession(e){await M.delete(nn).where(q(nn.id,e))}async createChatMessage(e){let[t]=await M.insert(Ua).values(e).returning();return t}async getChatMessagesBySession(e){return M.select().from(Ua).where(q(Ua.sessionId,e)).orderBy(mr(Ua.createdAt))}async updateChatMessage(e,t){let[n]=await M.update(Ua).set(t).where(q(Ua.id,e)).returning();return n}async deleteChatMessage(e){await M.delete(Ua).where(q(Ua.id,e))}async createChatProposal(e){let[t]=await M.insert(bn).values(e).returning();return t}async getChatProposal(e){let[t]=await M.select().from(bn).where(q(bn.id,e));return t}async getChatProposalsBySession(e){return M.select().from(bn).where(q(bn.sessionId,e)).orderBy(ft(bn.createdAt))}async getChatProposalsByMessage(e){return M.select().from(bn).where(q(bn.messageId,e)).orderBy(mr(bn.createdAt))}async updateChatProposal(e,t){let[n]=await M.update(bn).set(t).where(q(bn.id,e)).returning();return n}async deleteChatProposal(e){await M.delete(bn).where(q(bn.id,e))}async createProjectPlotThread(e){let[t]=await M.insert(Fa).values(e).returning();return t}async getPlotThreadsByProject(e){return M.select().from(Fa).where(q(Fa.projectId,e)).orderBy(mr(Fa.createdAt))}async updateProjectPlotThread(e,t){let[n]=await M.update(Fa).set(t).where(q(Fa.id,e)).returning();return n}async deletePlotThreadsByProject(e){await M.delete(Fa).where(q(Fa.projectId,e))}async createWorldEntity(e){let[t]=await M.insert(ar).values(e).returning();return t}async getWorldEntitiesByProject(e){return M.select().from(ar).where(q(ar.projectId,e)).orderBy(mr(ar.type),mr(ar.name))}async getWorldEntity(e){let[t]=await M.select().from(ar).where(q(ar.id,e));return t}async getWorldEntityByName(e,t){let[n]=await M.select().from(ar).where(Zt(q(ar.projectId,e),q(ar.name,t)));return n}async updateWorldEntity(e,t){let[n]=await M.update(ar).set({...t,updatedAt:new Date}).where(q(ar.id,e)).returning();return n}async deleteWorldEntity(e){await M.delete(ar).where(q(ar.id,e))}async deleteWorldEntitiesByProject(e){await M.delete(ar).where(q(ar.projectId,e))}async createWorldRule(e){let[t]=await M.insert(Cr).values(e).returning();return t}async getWorldRulesByProject(e){return M.select().from(Cr).where(Zt(q(Cr.projectId,e),q(Cr.isActive,!0))).orderBy(mr(Cr.category),mr(Cr.id))}async updateWorldRule(e,t){let[n]=await M.update(Cr).set(t).where(q(Cr.id,e)).returning();return n}async deleteWorldRule(e){await M.delete(Cr).where(q(Cr.id,e))}async deleteWorldRulesByProject(e){await M.delete(Cr).where(q(Cr.projectId,e))}async createEntityRelationship(e){let[t]=await M.insert(On).values(e).returning();return t}async getEntityRelationshipsByProject(e){return M.select().from(On).where(q(On.projectId,e)).orderBy(mr(On.relationType))}async getEntityRelationshipsBySubject(e){return M.select().from(On).where(q(On.subjectId,e))}async updateEntityRelationship(e,t){let[n]=await M.update(On).set({...t,updatedAt:new Date}).where(q(On.id,e)).returning();return n}async deleteEntityRelationship(e){await M.delete(On).where(q(On.id,e))}async deleteEntityRelationshipsByProject(e){await M.delete(On).where(q(On.projectId,e))}async createConsistencyViolation(e){let[t]=await M.insert(Gt).values(e).returning();return t}async getConsistencyViolationsByProject(e){return M.select().from(Gt).where(q(Gt.projectId,e)).orderBy(ft(Gt.createdAt))}async getConsistencyViolationsByChapter(e,t){return M.select().from(Gt).where(Zt(q(Gt.projectId,e),q(Gt.chapterNumber,t))).orderBy(ft(Gt.createdAt))}async updateConsistencyViolation(e,t){let[n]=await M.update(Gt).set(t).where(q(Gt.id,e)).returning();return n}async createChapterVersion(e){let[t]=await M.insert(ba).values(e).returning();return t}async getChapterVersionsByChapter(e){return M.select().from(ba).where(q(ba.chapterId,e)).orderBy(ft(ba.versionNumber))}async getChapterVersionCount(e){let t=await M.select({count:B`count(*)`}).from(ba).where(q(ba.chapterId,e));return Number(t[0]?.count||0)}async getLatestChapterVersion(e){let[t]=await M.select().from(ba).where(q(ba.chapterId,e)).orderBy(ft(ba.versionNumber)).limit(1);return t}async createEditingQueueItem(e){let[t]=await M.insert(Kn).values(e).returning();return t}async getEditingQueueByProject(e){return M.select().from(Kn).where(q(Kn.projectId,e)).orderBy(mr(Kn.chapterNumber))}async getPendingEdits(e){return M.select().from(Kn).where(Zt(q(Kn.projectId,e),q(Kn.status,"pending"))).orderBy(mr(Kn.chapterNumber))}async updateEditingQueueItem(e,t){let[n]=await M.update(Kn).set(t).where(q(Kn.id,e)).returning();return n}async getSeriesWorldBible(e){let t=await M.select().from(Yn).where(q(Yn.seriesId,e)).limit(1);if(t.length===0)return null;let n=t[0],a=m=>({name:m.name||"",role:m.role||"",current_status:m.status||m.current_status||"unknown",arc_summary:m.development||m.arc_summary||"",relationships:Array.isArray(m.relationships)?m.relationships.map(f=>typeof f=="string"?f:`${f.relation} de ${f.character}`):[],last_volume_appearance:m.lastSeenVolume||m.last_volume_appearance||1}),s=m=>({name:m.name||"",significance:m.significance||m.description||"",current_state:m.currentState||m.current_state||"",key_events:m.keyEvents||m.key_events||[]}),o=m=>({theme:m.description||m.theme||m.title||"",title:m.description||m.title||"",volume_learned:m.volumeNumber||m.volume_learned||1,description:m.impact||m.description||""}),i=m=>({rule_name:m.category||m.rule_name||m.name||"",name:m.rule||m.name||"",description:m.rule||m.description||""}),u=m=>({volume:m.volumeNumber||m.volume||1,event:m.description||m.event||"",consequences:m.consequences||""}),c=m=>({name:m.name||"",description:m.description||"",current_owner:m.owner||m.current_owner||"",current_status:m.status||m.current_status||""}),p=m=>({secret:m.description||m.secret||"",known_by:m.knownBy||m.known_by||[],resolved:m.isResolved||m.resolved||!1,resolution:m.resolution||""});return{id:n.id,seriesId:n.seriesId,characters:(n.characters||[]).map(a),locations:(n.locations||[]).map(s),lessons:(n.lessons||[]).map(o),worldRules:(n.worldRules||[]).map(i),timelineEvents:(n.timeline||[]).map(u),objects:(n.objects||[]).map(c),secrets:(n.secrets||[]).map(p),lastUpdatedVolume:n.lastUpdatedVolume}}async createWritingLesson(e){let[t]=await M.insert(Vn).values(e).returning();return t}async getAllWritingLessons(){return M.select().from(Vn).orderBy(ft(Vn.severityWeight))}async getActiveWritingLessons(){return M.select().from(Vn).where(q(Vn.isActive,!0)).orderBy(ft(Vn.severityWeight))}async updateWritingLesson(e,t){let[n]=await M.update(Vn).set(t).where(q(Vn.id,e)).returning();return n}async deleteWritingLesson(e){await M.delete(Vn).where(q(Vn.id,e))}async deleteAllWritingLessons(){await M.delete(Vn)}},b=new JS});function tt(r,e,t,n,a){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!a:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?a.call(r,t):a?a.value=t:e.set(r,t),t}function re(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}var Ra=G(()=>{});var KS,XS=G(()=>{KS=function(){let{crypto:r}=globalThis;if(r?.randomUUID)return KS=r.randomUUID.bind(r),r.randomUUID();let e=new Uint8Array(1),t=r?()=>r.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))}});function Nd(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}var _d,Ig=G(()=>{_d=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){let e=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(e.stack=r.stack),r.cause&&!e.cause&&(e.cause=r.cause),r.name&&(e.name=r.name),e}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)}});var Oe,Fr,Lr,Qs,Js,rc,nc,ac,sc,oc,ic,cc,lc,Ql,Jl,za,hs=G(()=>{Ig();Oe=class extends Error{},Fr=class r extends Oe{constructor(e,t,n,a){super(`${r.makeMessage(e,t,n)}`),this.status=e,this.headers=a,this.requestID=a?.get("x-request-id"),this.error=t;let s=t;this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,t,n){let a=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,n,a){if(!e||!a)return new Qs({message:n,cause:_d(t)});let s=t?.error;return e===400?new rc(e,s,n,a):e===401?new nc(e,s,n,a):e===403?new ac(e,s,n,a):e===404?new sc(e,s,n,a):e===409?new oc(e,s,n,a):e===422?new ic(e,s,n,a):e===429?new cc(e,s,n,a):e>=500?new lc(e,s,n,a):new r(e,s,n,a)}},Lr=class extends Fr{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Qs=class extends Fr{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Js=class extends Qs{constructor({message:e}={}){super({message:e??"Request timed out."})}},rc=class extends Fr{},nc=class extends Fr{},ac=class extends Fr{},sc=class extends Fr{},oc=class extends Fr{},ic=class extends Fr{},cc=class extends Fr{},lc=class extends Fr{},Ql=class extends Oe{constructor(){super("Could not parse response content as the length limit was reached")}},Jl=class extends Oe{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},za=class extends Error{constructor(e){super(e)}}});function ZS(r){return typeof r!="object"?{}:r??{}}function nU(r){if(!r)return!0;for(let e in r)return!1;return!0}function aU(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Kl(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var mee,rU,En,YS,sU,oU,Ks=G(()=>{hs();mee=/^[a-z][a-z0-9+.-]*:/i,rU=r=>mee.test(r),En=r=>(En=Array.isArray,En(r)),YS=En;sU=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Oe(`${r} must be an integer`);if(e<0)throw new Oe(`${r} must be a positive integer`);return e},oU=r=>{try{return JSON.parse(r)}catch{return}}});var fs,Xl=G(()=>{fs=r=>new Promise(e=>setTimeout(e,r))});var Uo,eR=G(()=>{Uo="6.16.0"});function hee(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}function gee(){if(typeof navigator>"u"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let n=t.exec(navigator.userAgent);if(n){let a=n[1]||0,s=n[2]||0,o=n[3]||0;return{browser:e,version:`${a}.${s}.${o}`}}}return null}var uU,fee,iU,cU,lU,pU,tR=G(()=>{eR();uU=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";fee=()=>{let r=hee();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Uo,"X-Stainless-OS":cU(Deno.build.os),"X-Stainless-Arch":iU(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Uo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Uo,"X-Stainless-OS":cU(globalThis.process.platform??"unknown"),"X-Stainless-Arch":iU(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=gee();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Uo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Uo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};iU=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",cU=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),pU=()=>lU??(lU=fee())});function dU(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function rR(...r){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...r)}function xg(r){let e=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return rR({start(){},async pull(t){let{done:n,value:a}=await e.next();n?t.close():t.enqueue(a)},async cancel(){await e.return?.()}})}function nR(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function mU(r){if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await r[Symbol.asyncIterator]().return?.();return}let e=r.getReader(),t=e.cancel();e.releaseLock(),await t}var Pd=G(()=>{});var hU,fU=G(()=>{hU=({headers:r,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)})});var Tg,aR,Og,sR,Ng=G(()=>{Tg="RFC3986",aR=r=>String(r),Og={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:aR},sR="RFC1738"});function yU(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function iR(r,e){if(En(r)){let t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}var _g,gs,oR,gU,bU=G(()=>{Ng();Ks();_g=(r,e)=>(_g=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),_g(r,e)),gs=(()=>{let r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),oR=1024,gU=(r,e,t,n,a)=>{if(r.length===0)return r;let s=r;if(typeof r=="symbol"?s=Symbol.prototype.toString.call(r):typeof r!="string"&&(s=String(r)),t==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(i){return"%26%23"+parseInt(i.slice(2),16)+"%3B"});let o="";for(let i=0;i<s.length;i+=oR){let u=s.length>=oR?s.slice(i,i+oR):s,c=[];for(let p=0;p<u.length;++p){let m=u.charCodeAt(p);if(m===45||m===46||m===95||m===126||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122||a===sR&&(m===40||m===41)){c[c.length]=u.charAt(p);continue}if(m<128){c[c.length]=gs[m];continue}if(m<2048){c[c.length]=gs[192|m>>6]+gs[128|m&63];continue}if(m<55296||m>=57344){c[c.length]=gs[224|m>>12]+gs[128|m>>6&63]+gs[128|m&63];continue}p+=1,m=65536+((m&1023)<<10|u.charCodeAt(p)&1023),c[c.length]=gs[240|m>>18]+gs[128|m>>12&63]+gs[128|m>>6&63]+gs[128|m&63]}o+=c.join("")}return o}});function vee(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}function AU(r,e,t,n,a,s,o,i,u,c,p,m,f,g,y,C,A,T){let E=r,d=T,l=0,h=!1;for(;(d=d.get(cR))!==void 0&&!h;){let w=d.get(r);if(l+=1,typeof w<"u"){if(w===l)throw new RangeError("Cyclic object value");h=!0}typeof d.get(cR)>"u"&&(l=0)}if(typeof c=="function"?E=c(e,E):E instanceof Date?E=f?.(E):t==="comma"&&En(E)&&(E=iR(E,function(w){return w instanceof Date?f?.(w):w})),E===null){if(s)return u&&!C?u(e,zr.encoder,A,"key",g):e;E=""}if(vee(E)||yU(E)){if(u){let w=C?e:u(e,zr.encoder,A,"key",g);return[y?.(w)+"="+y?.(u(E,zr.encoder,A,"value",g))]}return[y?.(e)+"="+y?.(String(E))]}let v=[];if(typeof E>"u")return v;let S;if(t==="comma"&&En(E))C&&u&&(E=iR(E,u)),S=[{value:E.length>0?E.join(",")||null:void 0}];else if(En(c))S=c;else{let w=Object.keys(E);S=p?w.sort(p):w}let R=i?String(e).replace(/\./g,"%2E"):String(e),x=n&&En(E)&&E.length===1?R+"[]":R;if(a&&En(E)&&E.length===0)return x+"[]";for(let w=0;w<S.length;++w){let O=S[w],I=typeof O=="object"&&typeof O.value<"u"?O.value:E[O];if(o&&I===null)continue;let _=m&&i?O.replace(/\./g,"%2E"):O,N=En(E)?typeof t=="function"?t(x,_):x:x+(m?"."+_:"["+_+"]");T.set(r,l);let P=new WeakMap;P.set(cR,T),CU(v,AU(I,N,t,n,a,s,o,i,t==="comma"&&C&&En(E)?null:u,c,p,m,f,g,y,C,A,P))}return v}function Eee(r=zr){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=r.charset||zr.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Tg;if(typeof r.format<"u"){if(!_g(Og,r.format))throw new TypeError("Unknown format option provided.");t=r.format}let n=Og[t],a=zr.filter;(typeof r.filter=="function"||En(r.filter))&&(a=r.filter);let s;if(r.arrayFormat&&r.arrayFormat in EU?s=r.arrayFormat:"indices"in r?s=r.indices?"indices":"repeat":s=zr.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let o=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:zr.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:zr.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:zr.allowEmptyArrays,arrayFormat:s,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:zr.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?zr.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:zr.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:zr.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:zr.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:zr.encodeValuesOnly,filter:a,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:zr.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:zr.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:zr.strictNullHandling}}function lR(r,e={}){let t=r,n=Eee(e),a,s;typeof n.filter=="function"?(s=n.filter,t=s("",t)):En(n.filter)&&(s=n.filter,a=s);let o=[];if(typeof t!="object"||t===null)return"";let i=EU[n.arrayFormat],u=i==="comma"&&n.commaRoundTrip;a||(a=Object.keys(t)),n.sort&&a.sort(n.sort);let c=new WeakMap;for(let f=0;f<a.length;++f){let g=a[f];n.skipNulls&&t[g]===null||CU(o,AU(t[g],g,i,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}let p=o.join(n.delimiter),m=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),p.length>0?m+p:""}var EU,CU,vU,zr,cR,SU=G(()=>{bU();Ng();Ks();EU={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},CU=function(r,e){Array.prototype.push.apply(r,En(e)?e:[e])},zr={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:gU,encodeValuesOnly:!1,format:Tg,formatter:aR,indices:!1,serializeDate(r){return(vU??(vU=Function.prototype.call.bind(Date.prototype.toISOString)))(r)},skipNulls:!1,strictNullHandling:!1};cR={}});var RU=G(()=>{Ng();SU()});function xU(r){let e=0;for(let a of r)e+=a.length;let t=new Uint8Array(e),n=0;for(let a of r)t.set(a,n),n+=a.length;return t}function Yl(r){let e;return(wU??(e=new globalThis.TextEncoder,wU=e.encode.bind(e)))(r)}function uR(r){let e;return(IU??(e=new globalThis.TextDecoder,IU=e.decode.bind(e)))(r)}var wU,IU,Pg=G(()=>{});function Aee(r,e){for(let a=e??0;a<r.length;a++){if(r[a]===10)return{preceding:a,index:a+1,carriage:!1};if(r[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function TU(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}var Zn,ea,uc,OU=G(()=>{Ra();Pg();uc=class{constructor(){Zn.set(this,void 0),ea.set(this,void 0),tt(this,Zn,new Uint8Array,"f"),tt(this,ea,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Yl(e):e;tt(this,Zn,xU([re(this,Zn,"f"),t]),"f");let n=[],a;for(;(a=Aee(re(this,Zn,"f"),re(this,ea,"f")))!=null;){if(a.carriage&&re(this,ea,"f")==null){tt(this,ea,a.index,"f");continue}if(re(this,ea,"f")!=null&&(a.index!==re(this,ea,"f")+1||a.carriage)){n.push(uR(re(this,Zn,"f").subarray(0,re(this,ea,"f")-1))),tt(this,Zn,re(this,Zn,"f").subarray(re(this,ea,"f")),"f"),tt(this,ea,null,"f");continue}let s=re(this,ea,"f")!==null?a.preceding-1:a.preceding,o=uR(re(this,Zn,"f").subarray(0,s));n.push(o),tt(this,Zn,re(this,Zn,"f").subarray(a.index),"f"),tt(this,ea,null,"f")}return n}flush(){return re(this,Zn,"f").length?this.decode(`
`):[]}};Zn=new WeakMap,ea=new WeakMap;uc.NEWLINE_CHARS=new Set([`
`,"\r"]);uc.NEWLINE_REGEXP=/\r\n|[\n\r]/g});function $d(){}function $g(r,e,t){return!e||Lg[r]>Lg[t]?$d:e[r].bind(e)}function jr(r){let e=r.logger,t=r.logLevel??"off";if(!e)return See;let n=NU.get(e);if(n&&n[0]===t)return n[1];let a={error:$g("error",e,t),warn:$g("warn",e,t),info:$g("info",e,t),debug:$g("debug",e,t)};return NU.set(e,[t,a]),a}var Lg,pR,See,NU,Xs,Ld=G(()=>{Ks();Lg={off:0,error:200,warn:300,info:400,debug:500},pR=(r,e,t)=>{if(r){if(aU(Lg,r))return r;jr(t).warn(`${e} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(Lg))}`)}};See={error:$d,warn:$d,info:$d,debug:$d},NU=new WeakMap;Xs=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r)});async function*Ree(r,e){if(!r.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Oe("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Oe("Attempted to iterate over a response with no body");let t=new dR,n=new uc,a=nR(r.body);for await(let s of wee(a))for(let o of n.decode(s)){let i=t.decode(o);i&&(yield i)}for(let s of n.flush()){let o=t.decode(s);o&&(yield o)}}async function*wee(r){let e=new Uint8Array;for await(let t of r){if(t==null)continue;let n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Yl(t):t,a=new Uint8Array(e.length+n.length);a.set(e),a.set(n,e.length),e=a;let s;for(;(s=TU(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}function Iee(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}var jd,ys,dR,mR=G(()=>{Ra();hs();Pd();OU();Pd();Ig();Pg();Ld();hs();ys=class r{constructor(e,t,n){this.iterator=e,jd.set(this,void 0),this.controller=t,tt(this,jd,n,"f")}static fromSSEResponse(e,t,n){let a=!1,s=n?jr(n):console;async function*o(){if(a)throw new Oe("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let i=!1;try{for await(let u of Ree(e,t))if(!i){if(u.data.startsWith("[DONE]")){i=!0;continue}if(u.event===null||!u.event.startsWith("thread.")){let c;try{c=JSON.parse(u.data)}catch(p){throw s.error("Could not parse message into JSON:",u.data),s.error("From chunk:",u.raw),p}if(c&&c.error)throw new Fr(void 0,c.error,void 0,e.headers);yield c}else{let c;try{c=JSON.parse(u.data)}catch(p){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),p}if(u.event=="error")throw new Fr(void 0,c.error,c.message,void 0);yield{event:u.event,data:c}}}i=!0}catch(u){if(Nd(u))return;throw u}finally{i||t.abort()}}return new r(o,t,n)}static fromReadableStream(e,t,n){let a=!1;async function*s(){let i=new uc,u=nR(e);for await(let c of u)for(let p of i.decode(c))yield p;for(let c of i.flush())yield c}async function*o(){if(a)throw new Oe("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let i=!1;try{for await(let u of s())i||u&&(yield JSON.parse(u));i=!0}catch(u){if(Nd(u))return;throw u}finally{i||t.abort()}}return new r(o,t,n)}[(jd=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),a=s=>({next:()=>{if(s.length===0){let o=n.next();e.push(o),t.push(o)}return s.shift()}});return[new r(()=>a(e),this.controller,re(this,jd,"f")),new r(()=>a(t),this.controller,re(this,jd,"f"))]}toReadableStream(){let e=this,t;return rR({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:a,done:s}=await t.next();if(s)return n.close();let o=Yl(JSON.stringify(a)+`
`);n.enqueue(o)}catch(a){n.error(a)}},async cancel(){await t.return?.()}})}};dR=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,a]=Iee(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}}});async function jg(r,e){let{response:t,requestLogID:n,retryOfRequestLogID:a,startTime:s}=e,o=await(async()=>{if(e.options.stream)return jr(r).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,r):ys.fromSSEResponse(t,e.controller,r);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let u=t.headers.get("content-type")?.split(";")[0]?.trim();if(u?.includes("application/json")||u?.endsWith("+json")){let m=await t.json();return hR(m,t)}return await t.text()})();return jr(r).debug(`[${n}] response parsed`,Xs({retryOfRequestLogID:a,url:t.url,status:t.status,body:o,durationMs:Date.now()-s})),o}function hR(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var fR=G(()=>{mR();Ld()});var kd,Bo,kg=G(()=>{Ra();fR();Bo=class r extends Promise{constructor(e,t,n=jg){super(a=>{a(null)}),this.responsePromise=t,this.parseResponse=n,kd.set(this,void 0),tt(this,kd,e,"f")}_thenUnwrap(e){return new r(re(this,kd,"f"),this.responsePromise,async(t,n)=>hR(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(re(this,kd,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};kd=new WeakMap});var Dg,Dd,Zl,bs,At,Ys,cr=G(()=>{Ra();hs();fR();kg();Ks();Dd=class{constructor(e,t,n,a){Dg.set(this,void 0),tt(this,Dg,e,"f"),this.options=a,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new Oe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await re(this,Dg,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Dg=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Zl=class extends Bo{constructor(e,t,n){super(e,t,async(a,s)=>new n(a,s.response,await jg(a,s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},bs=class extends Dd{constructor(e,t,n,a){super(e,t,n,a),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},At=class extends Dd{constructor(e,t,n,a){super(e,t,n,a),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...ZS(this.options.query),after:t}}:null}},Ys=class extends Dd{constructor(e,t,n,a){super(e,t,n,a),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...ZS(this.options.query),after:e}}:null}}});function eu(r,e,t){return bR(),new File(r,e??"unknown_file",t)}function Md(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}function Tee(r){let e=typeof r=="function"?r:r.fetch,t=_U.get(e);if(t)return t;let n=(async()=>{try{let a="Response"in e?e.Response:(await e("data:,")).constructor,s=new FormData;return s.toString()!==await new a(s).text()}catch{return!0}})();return _U.set(e,n),n}var bR,Mg,vR,ta,_U,PU,$U,Oee,gR,yR,vs=G(()=>{Pd();bR=()=>{if(typeof File>"u"){let{process:r}=globalThis,e=typeof r?.versions?.node=="string"&&parseInt(r.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};Mg=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",vR=async(r,e)=>gR(r.body)?{...r,body:await PU(r.body,e)}:r,ta=async(r,e)=>({...r,body:await PU(r.body,e)}),_U=new WeakMap;PU=async(r,e)=>{if(!await Tee(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(r||{}).map(([n,a])=>yR(t,n,a))),t},$U=r=>r instanceof Blob&&"name"in r,Oee=r=>typeof r=="object"&&r!==null&&(r instanceof Response||Mg(r)||$U(r)),gR=r=>{if(Oee(r))return!0;if(Array.isArray(r))return r.some(gR);if(r&&typeof r=="object"){for(let e in r)if(gR(r[e]))return!0}return!1},yR=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(t instanceof Response)r.append(e,eu([await t.blob()],Md(t)));else if(Mg(t))r.append(e,eu([await new Response(xg(t)).blob()],Md(t)));else if($U(t))r.append(e,t,Md(t));else if(Array.isArray(t))await Promise.all(t.map(n=>yR(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,a])=>yR(r,`${e}[${n}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}}});async function Ud(r,e,t){if(bR(),r=await r,Nee(r))return r instanceof File?r:eu([await r.arrayBuffer()],r.name);if(_ee(r)){let a=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()),eu(await ER(a),e,t)}let n=await ER(r);if(e||(e=Md(r)),!t?.type){let a=n.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof a=="string"&&(t={...t,type:a})}return eu(n,e,t)}async function ER(r){let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(LU(r))e.push(r instanceof Blob?r:await r.arrayBuffer());else if(Mg(r))for await(let t of r)e.push(...await ER(t));else{let t=r?.constructor?.name;throw new Error(`Unexpected data type: ${typeof r}${t?`; constructor: ${t}`:""}${Pee(r)}`)}return e}function Pee(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}var LU,Nee,_ee,jU=G(()=>{vs();vs();LU=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Nee=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&LU(r),_ee=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function"});var CR=G(()=>{jU()});var fe,Ye=G(()=>{fe=class{constructor(e){this._client=e}}});function DU(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var kU,Lee,me,Bt=G(()=>{hs();kU=Object.freeze(Object.create(null)),Lee=(r=DU)=>function(t,...n){if(t.length===1)return t[0];let a=!1,s=[],o=t.reduce((p,m,f)=>{/[?#]/.test(m)&&(a=!0);let g=n[f],y=(a?encodeURIComponent:r)(""+g);return f!==n.length&&(g==null||typeof g=="object"&&g.toString===Object.getPrototypeOf(Object.getPrototypeOf(g.hasOwnProperty??kU)??kU)?.toString)&&(y=g+"",s.push({start:p.length+m.length,length:y.length,error:`Value of type ${Object.prototype.toString.call(g).slice(8,-1)} is not a valid path parameter`})),p+m+(f===n.length?"":y)},""),i=o.split(/[?#]/,1)[0],u=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=u.exec(i))!==null;)s.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(s.sort((p,m)=>p.start-m.start),s.length>0){let p=0,m=s.reduce((f,g)=>{let y=" ".repeat(g.start-p),C="^".repeat(g.length);return p=g.start+g.length,f+y+C},"");throw new Oe(`Path parameters result in path with invalid segments:
${s.map(f=>f.error).join(`
`)}
${o}
${m}`)}return o},me=Lee(DU)});var pc,Ug=G(()=>{Ye();cr();Bt();pc=class extends fe{list(e,t={},n){return this._client.getAPIList(me`/chat/completions/${e}/messages`,At,{query:t,...n})}}});var Ha=G(()=>{hs()});function Bd(r){return r!==void 0&&"function"in r&&r.function!==void 0}function Fd(r){return r?.$brand==="auto-parseable-response-format"}function dc(r){return r?.$brand==="auto-parseable-tool"}function MU(r,e){return!e||!AR(e)?{...r,choices:r.choices.map(t=>(BU(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:qd(r,e)}function qd(r,e){let t=r.choices.map(n=>{if(n.finish_reason==="length")throw new Ql;if(n.finish_reason==="content_filter")throw new Jl;return BU(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(a=>Mee(e,a))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Dee(e,n.message.content):null}}});return{...r,choices:t}}function Dee(r,e){return r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function Mee(r,e){let t=r.tools?.find(n=>Bd(n)&&n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:dc(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function UU(r,e){if(!r||!("tools"in r)||!r.tools)return!1;let t=r.tools?.find(n=>Bd(n)&&n.function?.name===e.function.name);return Bd(t)&&(dc(t)||t?.function.strict||!1)}function AR(r){return Fd(r.response_format)?!0:r.tools?.some(e=>dc(e)||e.type==="function"&&e.function.strict===!0)??!1}function BU(r){for(let e of r||[])if(e.type!=="function")throw new Oe(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function FU(r){for(let e of r??[]){if(e.type!=="function")throw new Oe(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Oe(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Gd=G(()=>{Ha()});var tu,SR,RR=G(()=>{tu=r=>r?.role==="assistant",SR=r=>r?.role==="tool"});var wR,Bg,Fg,Vd,zd,qg,Hd,Zs,Wd,Gg,Vg,ru,qU,Fo,zg=G(()=>{Ra();Ha();Fo=class{constructor(){wR.add(this),this.controller=new AbortController,Bg.set(this,void 0),Fg.set(this,()=>{}),Vd.set(this,()=>{}),zd.set(this,void 0),qg.set(this,()=>{}),Hd.set(this,()=>{}),Zs.set(this,{}),Wd.set(this,!1),Gg.set(this,!1),Vg.set(this,!1),ru.set(this,!1),tt(this,Bg,new Promise((e,t)=>{tt(this,Fg,e,"f"),tt(this,Vd,t,"f")}),"f"),tt(this,zd,new Promise((e,t)=>{tt(this,qg,e,"f"),tt(this,Hd,t,"f")}),"f"),re(this,Bg,"f").catch(()=>{}),re(this,zd,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},re(this,wR,"m",qU).bind(this))},0)}_connected(){this.ended||(re(this,Fg,"f").call(this),this._emit("connect"))}get ended(){return re(this,Wd,"f")}get errored(){return re(this,Gg,"f")}get aborted(){return re(this,Vg,"f")}abort(){this.controller.abort()}on(e,t){return(re(this,Zs,"f")[e]||(re(this,Zs,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=re(this,Zs,"f")[e];if(!n)return this;let a=n.findIndex(s=>s.listener===t);return a>=0&&n.splice(a,1),this}once(e,t){return(re(this,Zs,"f")[e]||(re(this,Zs,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{tt(this,ru,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){tt(this,ru,!0,"f"),await re(this,zd,"f")}_emit(e,...t){if(re(this,Wd,"f"))return;e==="end"&&(tt(this,Wd,!0,"f"),re(this,qg,"f").call(this));let n=re(this,Zs,"f")[e];if(n&&(re(this,Zs,"f")[e]=n.filter(a=>!a.once),n.forEach(({listener:a})=>a(...t))),e==="abort"){let a=t[0];!re(this,ru,"f")&&!n?.length&&Promise.reject(a),re(this,Vd,"f").call(this,a),re(this,Hd,"f").call(this,a),this._emit("end");return}if(e==="error"){let a=t[0];!re(this,ru,"f")&&!n?.length&&Promise.reject(a),re(this,Vd,"f").call(this,a),re(this,Hd,"f").call(this,a),this._emit("end")}}_emitFinal(){}};Bg=new WeakMap,Fg=new WeakMap,Vd=new WeakMap,zd=new WeakMap,qg=new WeakMap,Hd=new WeakMap,Zs=new WeakMap,Wd=new WeakMap,Gg=new WeakMap,Vg=new WeakMap,ru=new WeakMap,wR=new WeakSet,qU=function(e){if(tt(this,Gg,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Lr),e instanceof Lr)return tt(this,Vg,!0,"f"),this._emit("abort",e);if(e instanceof Oe)return this._emit("error",e);if(e instanceof Error){let t=new Oe(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Oe(String(e)))}});function GU(r){return typeof r.parse=="function"}var IR=G(()=>{});var Nn,xR,Hg,TR,OR,NR,VU,zU,Uee,nu,_R=G(()=>{Ra();Ha();Gd();RR();zg();IR();Uee=10,nu=class extends Fo{constructor(){super(...arguments),Nn.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),SR(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(tu(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Oe("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),re(this,Nn,"m",xR).call(this)}async finalMessage(){return await this.done(),re(this,Nn,"m",Hg).call(this)}async finalFunctionToolCall(){return await this.done(),re(this,Nn,"m",TR).call(this)}async finalFunctionToolCallResult(){return await this.done(),re(this,Nn,"m",OR).call(this)}async totalUsage(){return await this.done(),re(this,Nn,"m",NR).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=re(this,Nn,"m",Hg).call(this);t&&this._emit("finalMessage",t);let n=re(this,Nn,"m",xR).call(this);n&&this._emit("finalContent",n);let a=re(this,Nn,"m",TR).call(this);a&&this._emit("finalFunctionToolCall",a);let s=re(this,Nn,"m",OR).call(this);s!=null&&this._emit("finalFunctionToolCallResult",s),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",re(this,Nn,"m",NR).call(this))}async _createChatCompletion(e,t,n){let a=n?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),re(this,Nn,"m",VU).call(this,t);let s=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(qd(s,t))}async _runChatCompletion(e,t,n){for(let a of t.messages)this._addMessage(a,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){let a="tool",{tool_choice:s="auto",stream:o,...i}=t,u=typeof s!="string"&&s.type==="function"&&s?.function?.name,{maxChatCompletions:c=Uee}=n||{},p=t.tools.map(g=>{if(dc(g)){if(!g.$callback)throw new Oe("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),m={};for(let g of p)g.type==="function"&&(m[g.function.name||g.function.function.name]=g.function);let f="tools"in t?p.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(let g of t.messages)this._addMessage(g,!1);for(let g=0;g<c;++g){let C=(await this._createChatCompletion(e,{...i,tool_choice:s,tools:f,messages:[...this.messages]},n)).choices[0]?.message;if(!C)throw new Oe("missing message in ChatCompletion response");if(!C.tool_calls?.length)return;for(let A of C.tool_calls){if(A.type!=="function")continue;let T=A.id,{name:E,arguments:d}=A.function,l=m[E];if(l){if(u&&u!==E){let R=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:a,tool_call_id:T,content:R});continue}}else{let R=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${Object.keys(m).map(x=>JSON.stringify(x)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:T,content:R});continue}let h;try{h=GU(l)?await l.parse(d):d}catch(R){let x=R instanceof Error?R.message:String(R);this._addMessage({role:a,tool_call_id:T,content:x});continue}let v=await l.function(h,this),S=re(this,Nn,"m",zU).call(this,v);if(this._addMessage({role:a,tool_call_id:T,content:S}),u)return}}}};Nn=new WeakSet,xR=function(){return re(this,Nn,"m",Hg).call(this).content??null},Hg=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(tu(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new Oe("stream ended without producing a ChatCompletionMessage with role=assistant")},TR=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(tu(t)&&t?.tool_calls?.length)return t.tool_calls.filter(n=>n.type==="function").at(-1)?.function}},OR=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(SR(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(a=>a.type==="function"&&a.id===t.tool_call_id)))return t.content}},NR=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},VU=function(e){if(e.n!=null&&e.n>1)throw new Oe("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},zU=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)}});var Qd,PR=G(()=>{_R();RR();Qd=class r extends nu{static runTools(e,t,n){let a=new r,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,s)),a}_addMessage(e,t=!0){super._addMessage(e,t),tu(e)&&e.content&&this._emit("content",e.content)}}});function Bee(r,e=sn.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return Fee(r.trim(),e)}var sn,$R,LR,Fee,jR,HU=G(()=>{sn={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},$R=class extends Error{},LR=class extends Error{};Fee=(r,e)=>{let t=r.length,n=0,a=f=>{throw new $R(`${f} at position ${n}`)},s=f=>{throw new LR(`${f} at position ${n}`)},o=()=>(m(),n>=t&&a("Unexpected end of input"),r[n]==='"'?i():r[n]==="{"?u():r[n]==="["?c():r.substring(n,n+4)==="null"||sn.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||sn.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||sn.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||sn.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||sn.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||sn.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):p()),i=()=>{let f=n,g=!1;for(n++;n<t&&(r[n]!=='"'||g&&r[n-1]==="\\");)g=r[n]==="\\"?!g:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(f,++n-Number(g)))}catch(y){s(String(y))}else if(sn.STR&e)try{return JSON.parse(r.substring(f,n-Number(g))+'"')}catch{return JSON.parse(r.substring(f,r.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},u=()=>{n++,m();let f={};try{for(;r[n]!=="}";){if(m(),n>=t&&sn.OBJ&e)return f;let g=i();m(),n++;try{let y=o();Object.defineProperty(f,g,{value:y,writable:!0,enumerable:!0,configurable:!0})}catch(y){if(sn.OBJ&e)return f;throw y}m(),r[n]===","&&n++}}catch{if(sn.OBJ&e)return f;a("Expected '}' at end of object")}return n++,f},c=()=>{n++;let f=[];try{for(;r[n]!=="]";)f.push(o()),m(),r[n]===","&&n++}catch{if(sn.ARR&e)return f;a("Expected ']' at end of array")}return n++,f},p=()=>{if(n===0){r==="-"&&sn.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(r)}catch(g){if(sn.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}s(String(g))}}let f=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(sn.NUM&e)&&a("Unterminated number literal");try{return JSON.parse(r.substring(f,n))}catch{r.substring(f,n)==="-"&&sn.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(r.substring(f,r.lastIndexOf("e")))}catch(y){s(String(y))}}},m=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return o()},jR=r=>Bee(r,sn.ALL^sn.NUM)});var kR=G(()=>{mR()});function qee(r,e){let{id:t,choices:n,created:a,model:s,system_fingerprint:o,...i}=r,u={...i,id:t,choices:n.map(({message:c,finish_reason:p,index:m,logprobs:f,...g})=>{if(!p)throw new Oe(`missing finish_reason for choice ${m}`);let{content:y=null,function_call:C,tool_calls:A,...T}=c,E=c.role;if(!E)throw new Oe(`missing role for choice ${m}`);if(C){let{arguments:d,name:l}=C;if(d==null)throw new Oe(`missing function_call.arguments for choice ${m}`);if(!l)throw new Oe(`missing function_call.name for choice ${m}`);return{...g,message:{content:y,function_call:{arguments:d,name:l},role:E,refusal:c.refusal??null},finish_reason:p,index:m,logprobs:f}}return A?{...g,index:m,finish_reason:p,logprobs:f,message:{...T,role:E,content:y,refusal:c.refusal??null,tool_calls:A.map((d,l)=>{let{function:h,type:v,id:S,...R}=d,{arguments:x,name:w,...O}=h||{};if(S==null)throw new Oe(`missing choices[${m}].tool_calls[${l}].id
${Jg(r)}`);if(v==null)throw new Oe(`missing choices[${m}].tool_calls[${l}].type
${Jg(r)}`);if(w==null)throw new Oe(`missing choices[${m}].tool_calls[${l}].function.name
${Jg(r)}`);if(x==null)throw new Oe(`missing choices[${m}].tool_calls[${l}].function.arguments
${Jg(r)}`);return{...R,id:S,type:v,function:{...O,name:w,arguments:x}}})}}:{...g,message:{...T,content:y,role:E,refusal:c.refusal??null},finish_reason:p,index:m,logprobs:f}}),created:a,model:s,object:"chat.completion",...o?{system_fingerprint:o}:{}};return MU(u,e)}function Jg(r){return JSON.stringify(r)}var Hr,eo,au,qo,DR,Wg,MR,UR,BR,Qg,FR,WU,mc,Kg=G(()=>{Ra();HU();Ha();Gd();kR();_R();mc=class r extends nu{constructor(e){super(),Hr.add(this),eo.set(this,void 0),au.set(this,void 0),qo.set(this,void 0),tt(this,eo,e,"f"),tt(this,au,[],"f")}get currentChatCompletionSnapshot(){return re(this,qo,"f")}static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let a=new r(t);return a._run(()=>a._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,t,n){super._createChatCompletion;let a=n?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),re(this,Hr,"m",DR).call(this);let s=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let o of s)re(this,Hr,"m",MR).call(this,o);if(s.controller.signal?.aborted)throw new Lr;return this._addChatCompletion(re(this,Hr,"m",Qg).call(this))}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),re(this,Hr,"m",DR).call(this),this._connected();let a=ys.fromReadableStream(e,this.controller),s;for await(let o of a)s&&s!==o.id&&this._addChatCompletion(re(this,Hr,"m",Qg).call(this)),re(this,Hr,"m",MR).call(this,o),s=o.id;if(a.controller.signal?.aborted)throw new Lr;return this._addChatCompletion(re(this,Hr,"m",Qg).call(this))}[(eo=new WeakMap,au=new WeakMap,qo=new WeakMap,Hr=new WeakSet,DR=function(){this.ended||tt(this,qo,void 0,"f")},Wg=function(t){let n=re(this,au,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},re(this,au,"f")[t.index]=n,n)},MR=function(t){if(this.ended)return;let n=re(this,Hr,"m",WU).call(this,t);this._emit("chunk",t,n);for(let a of t.choices){let s=n.choices[a.index];a.delta.content!=null&&s.message?.role==="assistant"&&s.message?.content&&(this._emit("content",a.delta.content,s.message.content),this._emit("content.delta",{delta:a.delta.content,snapshot:s.message.content,parsed:s.message.parsed})),a.delta.refusal!=null&&s.message?.role==="assistant"&&s.message?.refusal&&this._emit("refusal.delta",{delta:a.delta.refusal,snapshot:s.message.refusal}),a.logprobs?.content!=null&&s.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:a.logprobs?.content,snapshot:s.logprobs?.content??[]}),a.logprobs?.refusal!=null&&s.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:a.logprobs?.refusal,snapshot:s.logprobs?.refusal??[]});let o=re(this,Hr,"m",Wg).call(this,s);s.finish_reason&&(re(this,Hr,"m",BR).call(this,s),o.current_tool_call_index!=null&&re(this,Hr,"m",UR).call(this,s,o.current_tool_call_index));for(let i of a.delta.tool_calls??[])o.current_tool_call_index!==i.index&&(re(this,Hr,"m",BR).call(this,s),o.current_tool_call_index!=null&&re(this,Hr,"m",UR).call(this,s,o.current_tool_call_index)),o.current_tool_call_index=i.index;for(let i of a.delta.tool_calls??[]){let u=s.message.tool_calls?.[i.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:i.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:i.function?.arguments??""}):(u?.type,void 0))}}},UR=function(t,n){if(re(this,Hr,"m",Wg).call(this,t).done_tool_calls.has(n))return;let s=t.message.tool_calls?.[n];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if(s.type==="function"){let o=re(this,eo,"f")?.tools?.find(i=>Bd(i)&&i.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:n,arguments:s.function.arguments,parsed_arguments:dc(o)?o.$parseRaw(s.function.arguments):o?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},BR=function(t){let n=re(this,Hr,"m",Wg).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;let a=re(this,Hr,"m",FR).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Qg=function(){if(this.ended)throw new Oe("stream has ended, this shouldn't happen");let t=re(this,qo,"f");if(!t)throw new Oe("request ended without sending any chunks");return tt(this,qo,void 0,"f"),tt(this,au,[],"f"),qee(t,re(this,eo,"f"))},FR=function(){let t=re(this,eo,"f")?.response_format;return Fd(t)?t:null},WU=function(t){var n,a,s,o;let i=re(this,qo,"f"),{choices:u,...c}=t;i?Object.assign(i,c):i=tt(this,qo,{...c,choices:[]},"f");for(let{delta:p,finish_reason:m,index:f,logprobs:g=null,...y}of t.choices){let C=i.choices[f];if(C||(C=i.choices[f]={finish_reason:m,index:f,message:{},logprobs:g,...y}),g)if(!C.logprobs)C.logprobs=Object.assign({},g);else{let{content:v,refusal:S,...R}=g;Object.assign(C.logprobs,R),v&&((n=C.logprobs).content??(n.content=[]),C.logprobs.content.push(...v)),S&&((a=C.logprobs).refusal??(a.refusal=[]),C.logprobs.refusal.push(...S))}if(m&&(C.finish_reason=m,re(this,eo,"f")&&AR(re(this,eo,"f")))){if(m==="length")throw new Ql;if(m==="content_filter")throw new Jl}if(Object.assign(C,y),!p)continue;let{content:A,refusal:T,function_call:E,role:d,tool_calls:l,...h}=p;if(Object.assign(C.message,h),T&&(C.message.refusal=(C.message.refusal||"")+T),d&&(C.message.role=d),E&&(C.message.function_call?(E.name&&(C.message.function_call.name=E.name),E.arguments&&((s=C.message.function_call).arguments??(s.arguments=""),C.message.function_call.arguments+=E.arguments)):C.message.function_call=E),A&&(C.message.content=(C.message.content||"")+A,!C.message.refusal&&re(this,Hr,"m",FR).call(this)&&(C.message.parsed=jR(C.message.content))),l){C.message.tool_calls||(C.message.tool_calls=[]);for(let{index:v,id:S,type:R,function:x,...w}of l){let O=(o=C.message.tool_calls)[v]??(o[v]={});Object.assign(O,w),S&&(O.id=S),R&&(O.type=R),x&&(O.function??(O.function={name:x.name??"",arguments:""})),x?.name&&(O.function.name=x.name),x?.arguments&&(O.function.arguments+=x.arguments,UU(re(this,eo,"f"),O)&&(O.function.parsed_arguments=jR(O.function.arguments)))}}}return i},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",a=>{let s=t.shift();s?s.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(let a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(let s of t)s.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(let s of t)s.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,o)=>t.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ys(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}});var Jd,qR=G(()=>{Kg();Jd=class r extends mc{static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){let a=new r(t),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,s)),a}}});var to,Kd=G(()=>{Ye();Ug();Ug();cr();Bt();PR();qR();Kg();Gd();qR();IR();Kg();PR();to=class extends fe{constructor(){super(...arguments),this.messages=new pc(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(me`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(me`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",At,{query:e,...t})}delete(e,t){return this._client.delete(me`/chat/completions/${e}`,t)}parse(e,t){return FU(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>qd(n,e))}runTools(e,t){return e.stream?Jd.runTools(this._client,e,t):Qd.runTools(this._client,e,t)}stream(e,t){return mc.createChatCompletion(this._client,e,t)}};to.Messages=pc});var Go,GR=G(()=>{Ye();Kd();Kd();Go=class extends fe{constructor(){super(...arguments),this.completions=new to(this._client)}};Go.Completions=to});var QU=G(()=>{Kd();Kd();Ug()});var JU=G(()=>{GR();QU()});var KU=G(()=>{});function*Vee(r){if(!r)return;if(XU in r){let{values:n,nulls:a}=r;yield*n.entries();for(let s of a)yield[s,null];return}let e=!1,t;r instanceof Headers?t=r.entries():YS(r)?t=r:(e=!0,t=Object.entries(r??{}));for(let n of t){let a=n[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");let s=YS(n[1])?n[1]:[n[1]],o=!1;for(let i of s)i!==void 0&&(e&&!o&&(o=!0,yield[a,null]),yield[a,i])}}var XU,Ce,hr=G(()=>{Ks();XU=Symbol("brand.privateNullableHeaders");Ce=r=>{let e=new Headers,t=new Set;for(let n of r){let a=new Set;for(let[s,o]of Vee(n)){let i=s.toLowerCase();a.has(i)||(e.delete(s),a.add(i)),o===null?(e.delete(s),t.add(i)):(e.append(s,o),t.delete(i))}}return{[XU]:!0,values:e,nulls:t}}});var su,VR=G(()=>{Ye();hr();su=class extends fe{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:Ce([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}});var ou,zR=G(()=>{Ye();vs();ou=class extends fe{create(e,t){return this._client.post("/audio/transcriptions",ta({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}});var iu,HR=G(()=>{Ye();vs();iu=class extends fe{create(e,t){return this._client.post("/audio/translations",ta({body:e,...t,__metadata:{model:e.model}},this._client))}}});var Es,WR=G(()=>{Ye();VR();VR();zR();zR();HR();HR();Es=class extends fe{constructor(){super(...arguments),this.transcriptions=new ou(this._client),this.translations=new iu(this._client),this.speech=new su(this._client)}};Es.Transcriptions=ou;Es.Translations=iu;Es.Speech=su});var hc,QR=G(()=>{Ye();cr();Bt();hc=class extends fe{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(me`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",At,{query:e,...t})}cancel(e,t){return this._client.post(me`/batches/${e}/cancel`,t)}}});var cu,JR=G(()=>{Ye();cr();hr();Bt();cu=class extends fe{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(me`/assistants/${e}`,{...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(me`/assistants/${e}`,{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",At,{query:e,...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(me`/assistants/${e}`,{...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}});var lu,KR=G(()=>{Ye();hr();lu=class extends fe{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}});var uu,XR=G(()=>{Ye();hr();uu=class extends fe{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}});var Vo,YR=G(()=>{Ye();KR();KR();XR();XR();Vo=class extends fe{constructor(){super(...arguments),this.sessions=new lu(this._client),this.transcriptionSessions=new uu(this._client)}};Vo.Sessions=lu;Vo.TranscriptionSessions=uu});var pu,ZR=G(()=>{Ye();hr();Bt();pu=class extends fe{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:Ce([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(me`/chatkit/sessions/${e}/cancel`,{...t,headers:Ce([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}});var du,ew=G(()=>{Ye();cr();hr();Bt();du=class extends fe{retrieve(e,t){return this._client.get(me`/chatkit/threads/${e}`,{...t,headers:Ce([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",Ys,{query:e,...t,headers:Ce([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(me`/chatkit/threads/${e}`,{...t,headers:Ce([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},n){return this._client.getAPIList(me`/chatkit/threads/${e}/items`,Ys,{query:t,...n,headers:Ce([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}}});var zo,tw=G(()=>{Ye();ZR();ZR();ew();ew();zo=class extends fe{constructor(){super(...arguments),this.sessions=new pu(this._client),this.threads=new du(this._client)}};zo.Sessions=pu;zo.Threads=du});var mu,rw=G(()=>{Ye();cr();hr();Bt();mu=class extends fe{create(e,t,n){return this._client.post(me`/threads/${e}/messages`,{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{thread_id:a}=t;return this._client.get(me`/threads/${a}/messages/${e}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{thread_id:a,...s}=t;return this._client.post(me`/threads/${a}/messages/${e}`,{body:s,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(me`/threads/${e}/messages`,At,{query:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){let{thread_id:a}=t;return this._client.delete(me`/threads/${a}/messages/${e}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var hu,nw=G(()=>{Ye();cr();hr();Bt();hu=class extends fe{retrieve(e,t,n){let{thread_id:a,run_id:s,...o}=t;return this._client.get(me`/threads/${a}/runs/${s}/steps/${e}`,{query:o,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){let{thread_id:a,...s}=t;return this._client.getAPIList(me`/threads/${a}/runs/${e}/steps`,At,{query:s,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var YU,ZU=G(()=>{hs();Pg();YU=r=>{if(typeof Buffer<"u"){let e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(r),t=e.length,n=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=e.charCodeAt(a);return Array.from(new Float32Array(n.buffer))}}});var Wa,aw=G(()=>{Wa=r=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[r]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(r)?.trim()}});var Xd=G(()=>{Ks();ZU();aw();Ld();XS();Xl()});var hn,gc,sw,Cs,Xg,Qa,yc,fu,fc,ey,ra,Yg,Zg,em,Yd,Zd,e2,t2,r2,n2,a2,s2,o2,ro,ow=G(()=>{Ra();kR();Ha();zg();Xd();ro=class extends Fo{constructor(){super(...arguments),hn.add(this),sw.set(this,[]),Cs.set(this,{}),Xg.set(this,{}),Qa.set(this,void 0),yc.set(this,void 0),fu.set(this,void 0),fc.set(this,void 0),ey.set(this,void 0),ra.set(this,void 0),Yg.set(this,void 0),Zg.set(this,void 0),em.set(this,void 0)}[(sw=new WeakMap,Cs=new WeakMap,Xg=new WeakMap,Qa=new WeakMap,yc=new WeakMap,fu=new WeakMap,fc=new WeakMap,ey=new WeakMap,ra=new WeakMap,Yg=new WeakMap,Zg=new WeakMap,em=new WeakMap,hn=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",a=>{let s=t.shift();s?s.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(let a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(let s of t)s.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(let s of t)s.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,o)=>t.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new gc;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let a=ys.fromReadableStream(e,this.controller);for await(let s of a)re(this,hn,"m",Yd).call(this,s);if(a.controller.signal?.aborted)throw new Lr;return this._addRun(re(this,hn,"m",Zd).call(this))}toReadableStream(){return new ys(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,a){let s=new gc;return s._run(()=>s._runToolAssistantStream(e,t,n,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,t,n,a){let s=a?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let o={...n,stream:!0},i=await e.submitToolOutputs(t,o,{...a,signal:this.controller.signal});this._connected();for await(let u of i)re(this,hn,"m",Yd).call(this,u);if(i.controller.signal?.aborted)throw new Lr;return this._addRun(re(this,hn,"m",Zd).call(this))}static createThreadAssistantStream(e,t,n){let a=new gc;return a._run(()=>a._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,t,n,a){let s=new gc;return s._run(()=>s._runAssistantStream(e,t,n,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return re(this,Yg,"f")}currentRun(){return re(this,Zg,"f")}currentMessageSnapshot(){return re(this,Qa,"f")}currentRunStepSnapshot(){return re(this,em,"f")}async finalRunSteps(){return await this.done(),Object.values(re(this,Cs,"f"))}async finalMessages(){return await this.done(),Object.values(re(this,Xg,"f"))}async finalRun(){if(await this.done(),!re(this,yc,"f"))throw Error("Final run was not received.");return re(this,yc,"f")}async _createThreadAssistantStream(e,t,n){let a=n?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let s={...t,stream:!0},o=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(let i of o)re(this,hn,"m",Yd).call(this,i);if(o.controller.signal?.aborted)throw new Lr;return this._addRun(re(this,hn,"m",Zd).call(this))}async _createAssistantStream(e,t,n,a){let s=a?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let o={...n,stream:!0},i=await e.create(t,o,{...a,signal:this.controller.signal});this._connected();for await(let u of i)re(this,hn,"m",Yd).call(this,u);if(i.controller.signal?.aborted)throw new Lr;return this._addRun(re(this,hn,"m",Zd).call(this))}static accumulateDelta(e,t){for(let[n,a]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=a;continue}let s=e[n];if(s==null){e[n]=a;continue}if(n==="index"||n==="type"){e[n]=a;continue}if(typeof s=="string"&&typeof a=="string")s+=a;else if(typeof s=="number"&&typeof a=="number")s+=a;else if(Kl(s)&&Kl(a))s=this.accumulateDelta(s,a);else if(Array.isArray(s)&&Array.isArray(a)){if(s.every(o=>typeof o=="string"||typeof o=="number")){s.push(...a);continue}for(let o of a){if(!Kl(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);let i=o.index;if(i==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof i!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${i}`);let u=s[i];u==null?s.push(o):s[i]=this.accumulateDelta(u,o)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${a}, accValue: ${s}`);e[n]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,a){return await this._createAssistantStream(t,e,n,a)}async _runToolAssistantStream(e,t,n,a){return await this._createToolAssistantStream(t,e,n,a)}};gc=ro,Yd=function(e){if(!this.ended)switch(tt(this,Yg,e,"f"),re(this,hn,"m",r2).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":re(this,hn,"m",o2).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":re(this,hn,"m",t2).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":re(this,hn,"m",e2).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Zd=function(){if(this.ended)throw new Oe("stream has ended, this shouldn't happen");if(!re(this,yc,"f"))throw Error("Final run has not been received");return re(this,yc,"f")},e2=function(e){let[t,n]=re(this,hn,"m",a2).call(this,e,re(this,Qa,"f"));tt(this,Qa,t,"f"),re(this,Xg,"f")[t.id]=t;for(let a of n){let s=t.content[a.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let a of e.data.delta.content){if(a.type=="text"&&a.text){let s=a.text,o=t.content[a.index];if(o&&o.type=="text")this._emit("textDelta",s,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(a.index!=re(this,fu,"f")){if(re(this,fc,"f"))switch(re(this,fc,"f").type){case"text":this._emit("textDone",re(this,fc,"f").text,re(this,Qa,"f"));break;case"image_file":this._emit("imageFileDone",re(this,fc,"f").image_file,re(this,Qa,"f"));break}tt(this,fu,a.index,"f")}tt(this,fc,t.content[a.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(re(this,fu,"f")!==void 0){let a=e.data.content[re(this,fu,"f")];if(a)switch(a.type){case"image_file":this._emit("imageFileDone",a.image_file,re(this,Qa,"f"));break;case"text":this._emit("textDone",a.text,re(this,Qa,"f"));break}}re(this,Qa,"f")&&this._emit("messageDone",e.data),tt(this,Qa,void 0,"f")}},t2=function(e){let t=re(this,hn,"m",n2).call(this,e);switch(tt(this,em,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let s of n.step_details.tool_calls)s.index==re(this,ey,"f")?this._emit("toolCallDelta",s,t.step_details.tool_calls[s.index]):(re(this,ra,"f")&&this._emit("toolCallDone",re(this,ra,"f")),tt(this,ey,s.index,"f"),tt(this,ra,t.step_details.tool_calls[s.index],"f"),re(this,ra,"f")&&this._emit("toolCallCreated",re(this,ra,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tt(this,em,void 0,"f"),e.data.step_details.type=="tool_calls"&&re(this,ra,"f")&&(this._emit("toolCallDone",re(this,ra,"f")),tt(this,ra,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},r2=function(e){re(this,sw,"f").push(e),this._emit("event",e)},n2=function(e){switch(e.event){case"thread.run.step.created":return re(this,Cs,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=re(this,Cs,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let a=gc.accumulateDelta(t,n.delta);re(this,Cs,"f")[e.data.id]=a}return re(this,Cs,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":re(this,Cs,"f")[e.data.id]=e.data;break}if(re(this,Cs,"f")[e.data.id])return re(this,Cs,"f")[e.data.id];throw new Error("No snapshot available")},a2=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(let s of a.delta.content)if(s.index in t.content){let o=t.content[s.index];t.content[s.index]=re(this,hn,"m",s2).call(this,s,o)}else t.content[s.index]=s,n.push(s);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},s2=function(e,t){return gc.accumulateDelta(t,e)},o2=function(e){switch(tt(this,Zg,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":tt(this,yc,e.data,"f"),re(this,ra,"f")&&(this._emit("toolCallDone",re(this,ra,"f")),tt(this,ra,void 0,"f"));break;case"thread.run.cancelling":break}}});var bc,iw=G(()=>{Ye();nw();nw();cr();hr();ow();Xl();Bt();bc=class extends fe{constructor(){super(...arguments),this.steps=new hu(this._client)}create(e,t,n){let{include:a,...s}=t;return this._client.post(me`/threads/${e}/runs`,{query:{include:a},body:s,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){let{thread_id:a}=t;return this._client.get(me`/threads/${a}/runs/${e}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{thread_id:a,...s}=t;return this._client.post(me`/threads/${a}/runs/${e}`,{body:s,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(me`/threads/${e}/runs`,At,{query:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){let{thread_id:a}=t;return this._client.post(me`/threads/${a}/runs/${e}/cancel`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let a=await this.create(e,t,n);return await this.poll(a.id,{thread_id:e},n)}createAndStream(e,t,n){return ro.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let a=Ce([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:o}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...a}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let i=5e3;if(n?.pollIntervalMs)i=n.pollIntervalMs;else{let u=o.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(i=c)}}await fs(i);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,n){return ro.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){let{thread_id:a,...s}=t;return this._client.post(me`/threads/${a}/runs/${e}/submit_tool_outputs`,{body:s,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){let a=await this.submitToolOutputs(e,t,n);return await this.poll(a.id,t,n)}submitToolOutputsStream(e,t,n){return ro.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};bc.Steps=hu});var Ho,cw=G(()=>{Ye();rw();rw();iw();iw();hr();ow();Bt();Ho=class extends fe{constructor(){super(...arguments),this.runs=new bc(this._client),this.messages=new mu(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(me`/threads/${e}`,{...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(me`/threads/${e}`,{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(me`/threads/${e}`,{...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return ro.createThreadAssistantStream(e,this._client.beta.threads,t)}};Ho.Runs=bc;Ho.Messages=mu});var Ja,lw=G(()=>{Ye();JR();JR();YR();YR();tw();tw();cw();cw();Ja=class extends fe{constructor(){super(...arguments),this.realtime=new Vo(this._client),this.chatkit=new zo(this._client),this.assistants=new cu(this._client),this.threads=new Ho(this._client)}};Ja.Realtime=Vo;Ja.ChatKit=zo;Ja.Assistants=cu;Ja.Threads=Ho});var vc,uw=G(()=>{Ye();vc=class extends fe{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}});var gu,pw=G(()=>{Ye();hr();Bt();gu=class extends fe{retrieve(e,t,n){let{container_id:a}=t;return this._client.get(me`/containers/${a}/files/${e}/content`,{...n,headers:Ce([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}});var Ec,dw=G(()=>{Ye();pw();pw();cr();hr();vs();Bt();Ec=class extends fe{constructor(){super(...arguments),this.content=new gu(this._client)}create(e,t,n){return this._client.post(me`/containers/${e}/files`,ta({body:t,...n},this._client))}retrieve(e,t,n){let{container_id:a}=t;return this._client.get(me`/containers/${a}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(me`/containers/${e}/files`,At,{query:t,...n})}delete(e,t,n){let{container_id:a}=t;return this._client.delete(me`/containers/${a}/files/${e}`,{...n,headers:Ce([{Accept:"*/*"},n?.headers])})}};Ec.Content=gu});var Wo,mw=G(()=>{Ye();dw();dw();cr();hr();Bt();Wo=class extends fe{constructor(){super(...arguments),this.files=new Ec(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(me`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",At,{query:e,...t})}delete(e,t){return this._client.delete(me`/containers/${e}`,{...t,headers:Ce([{Accept:"*/*"},t?.headers])})}};Wo.Files=Ec});var yu,hw=G(()=>{Ye();cr();Bt();yu=class extends fe{create(e,t,n){let{include:a,...s}=t;return this._client.post(me`/conversations/${e}/items`,{query:{include:a},body:s,...n})}retrieve(e,t,n){let{conversation_id:a,...s}=t;return this._client.get(me`/conversations/${a}/items/${e}`,{query:s,...n})}list(e,t={},n){return this._client.getAPIList(me`/conversations/${e}/items`,Ys,{query:t,...n})}delete(e,t,n){let{conversation_id:a}=t;return this._client.delete(me`/conversations/${a}/items/${e}`,n)}}});var Qo,fw=G(()=>{Ye();hw();hw();Bt();Qo=class extends fe{constructor(){super(...arguments),this.items=new yu(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(me`/conversations/${e}`,t)}update(e,t,n){return this._client.post(me`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(me`/conversations/${e}`,t)}};Qo.Items=yu});var Cc,gw=G(()=>{Ye();Xd();Cc=class extends fe{create(e,t){let n=!!e.encoding_format,a=n?e.encoding_format:"base64";n&&jr(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let s=this._client.post("/embeddings",{body:{...e,encoding_format:a},...t});return n?s:(jr(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(o=>(o&&o.data&&o.data.forEach(i=>{let u=i.embedding;i.embedding=YU(u)}),o)))}}});var bu,yw=G(()=>{Ye();cr();Bt();bu=class extends fe{retrieve(e,t,n){let{eval_id:a,run_id:s}=t;return this._client.get(me`/evals/${a}/runs/${s}/output_items/${e}`,n)}list(e,t,n){let{eval_id:a,...s}=t;return this._client.getAPIList(me`/evals/${a}/runs/${e}/output_items`,At,{query:s,...n})}}});var Ac,bw=G(()=>{Ye();yw();yw();cr();Bt();Ac=class extends fe{constructor(){super(...arguments),this.outputItems=new bu(this._client)}create(e,t,n){return this._client.post(me`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){let{eval_id:a}=t;return this._client.get(me`/evals/${a}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(me`/evals/${e}/runs`,At,{query:t,...n})}delete(e,t,n){let{eval_id:a}=t;return this._client.delete(me`/evals/${a}/runs/${e}`,n)}cancel(e,t,n){let{eval_id:a}=t;return this._client.post(me`/evals/${a}/runs/${e}`,n)}};Ac.OutputItems=bu});var Jo,vw=G(()=>{Ye();bw();bw();cr();Bt();Jo=class extends fe{constructor(){super(...arguments),this.runs=new Ac(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(me`/evals/${e}`,t)}update(e,t,n){return this._client.post(me`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",At,{query:e,...t})}delete(e,t){return this._client.delete(me`/evals/${e}`,t)}};Jo.Runs=Ac});var Sc,Ew=G(()=>{Ye();cr();hr();Xl();Ha();vs();Bt();Sc=class extends fe{create(e,t){return this._client.post("/files",ta({body:e,...t},this._client))}retrieve(e,t){return this._client.get(me`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",At,{query:e,...t})}delete(e,t){return this._client.delete(me`/files/${e}`,t)}content(e,t){return this._client.get(me`/files/${e}/content`,{...t,headers:Ce([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){let a=new Set(["processed","error","deleted"]),s=Date.now(),o=await this.retrieve(e);for(;!o.status||!a.has(o.status);)if(await fs(t),o=await this.retrieve(e),Date.now()-s>n)throw new Js({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return o}}});var vu,Cw=G(()=>{Ye();vu=class extends fe{}});var Eu,Aw=G(()=>{Ye();Eu=class extends fe{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}});var Rc,Sw=G(()=>{Ye();Aw();Aw();Rc=class extends fe{constructor(){super(...arguments),this.graders=new Eu(this._client)}};Rc.Graders=Eu});var Cu,Rw=G(()=>{Ye();cr();Bt();Cu=class extends fe{create(e,t,n){return this._client.getAPIList(me`/fine_tuning/checkpoints/${e}/permissions`,bs,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(me`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){let{fine_tuned_model_checkpoint:a}=t;return this._client.delete(me`/fine_tuning/checkpoints/${a}/permissions/${e}`,n)}}});var wc,ww=G(()=>{Ye();Rw();Rw();wc=class extends fe{constructor(){super(...arguments),this.permissions=new Cu(this._client)}};wc.Permissions=Cu});var Au,Iw=G(()=>{Ye();cr();Bt();Au=class extends fe{list(e,t={},n){return this._client.getAPIList(me`/fine_tuning/jobs/${e}/checkpoints`,At,{query:t,...n})}}});var Ic,xw=G(()=>{Ye();Iw();Iw();cr();Bt();Ic=class extends fe{constructor(){super(...arguments),this.checkpoints=new Au(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(me`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",At,{query:e,...t})}cancel(e,t){return this._client.post(me`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(me`/fine_tuning/jobs/${e}/events`,At,{query:t,...n})}pause(e,t){return this._client.post(me`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(me`/fine_tuning/jobs/${e}/resume`,t)}};Ic.Checkpoints=Au});var Ka,Tw=G(()=>{Ye();Cw();Cw();Sw();Sw();ww();ww();xw();xw();Ka=class extends fe{constructor(){super(...arguments),this.methods=new vu(this._client),this.jobs=new Ic(this._client),this.checkpoints=new wc(this._client),this.alpha=new Rc(this._client)}};Ka.Methods=vu;Ka.Jobs=Ic;Ka.Checkpoints=wc;Ka.Alpha=Rc});var Su,Ow=G(()=>{Ye();Su=class extends fe{}});var Ko,Nw=G(()=>{Ye();Ow();Ow();Ko=class extends fe{constructor(){super(...arguments),this.graderModels=new Su(this._client)}};Ko.GraderModels=Su});var xc,_w=G(()=>{Ye();vs();xc=class extends fe{createVariation(e,t){return this._client.post("/images/variations",ta({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",ta({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}});var Tc,Pw=G(()=>{Ye();cr();Bt();Tc=class extends fe{retrieve(e,t){return this._client.get(me`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",bs,e)}delete(e,t){return this._client.delete(me`/models/${e}`,t)}}});var Oc,$w=G(()=>{Ye();Oc=class extends fe{create(e,t){return this._client.post("/moderations",{body:e,...t})}}});var Ru,Lw=G(()=>{Ye();hr();Bt();Ru=class extends fe{accept(e,t,n){return this._client.post(me`/realtime/calls/${e}/accept`,{body:t,...n,headers:Ce([{Accept:"*/*"},n?.headers])})}hangup(e,t){return this._client.post(me`/realtime/calls/${e}/hangup`,{...t,headers:Ce([{Accept:"*/*"},t?.headers])})}refer(e,t,n){return this._client.post(me`/realtime/calls/${e}/refer`,{body:t,...n,headers:Ce([{Accept:"*/*"},n?.headers])})}reject(e,t={},n){return this._client.post(me`/realtime/calls/${e}/reject`,{body:t,...n,headers:Ce([{Accept:"*/*"},n?.headers])})}}});var wu,jw=G(()=>{Ye();wu=class extends fe{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}});var no,kw=G(()=>{Ye();Lw();Lw();jw();jw();no=class extends fe{constructor(){super(...arguments),this.clientSecrets=new wu(this._client),this.calls=new Ru(this._client)}};no.ClientSecrets=wu;no.Calls=Ru});function i2(r,e){return!e||!Cte(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Dw(r,e)}function Dw(r,e){let t=r.output.map(a=>{if(a.type==="function_call")return{...a,parsed_arguments:Rte(e,a)};if(a.type==="message"){let s=a.content.map(o=>o.type==="output_text"?{...o,parsed:Ete(e,o.text)}:o);return{...a,content:s}}return a}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||ty(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let a of n.output)if(a.type==="message"){for(let s of a.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),n}function Ete(r,e){return r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(e):JSON.parse(e)}function Cte(r){return!!Fd(r.text?.format)}function Ate(r){return r?.$brand==="auto-parseable-tool"}function Ste(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function Rte(r,e){let t=Ste(r.tools??[],e.name);return{...e,...e,parsed_arguments:Ate(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function ty(r){let e=[];for(let t of r.output)if(t.type==="message")for(let n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}var Mw=G(()=>{Ha();Gd()});function wte(r,e){return i2(r,e)}var Iu,ry,Xo,ny,c2,l2,u2,p2,ay,d2=G(()=>{Ra();Ha();zg();Mw();ay=class r extends Fo{constructor(e){super(),Iu.add(this),ry.set(this,void 0),Xo.set(this,void 0),ny.set(this,void 0),tt(this,ry,e,"f")}static createResponse(e,t,n){let a=new r(t);return a._run(()=>a._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createOrRetrieveResponse(e,t,n){let a=n?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),re(this,Iu,"m",c2).call(this);let s,o=null;"response_id"in t?(s=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),o=t.starting_after??null):s=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let i of s)re(this,Iu,"m",l2).call(this,i,o);if(s.controller.signal?.aborted)throw new Lr;return re(this,Iu,"m",u2).call(this)}[(ry=new WeakMap,Xo=new WeakMap,ny=new WeakMap,Iu=new WeakSet,c2=function(){this.ended||tt(this,Xo,void 0,"f")},l2=function(t,n){if(this.ended)return;let a=(o,i)=>{(n==null||i.sequence_number>n)&&this._emit(o,i)},s=re(this,Iu,"m",p2).call(this,t);switch(a("event",t),t.type){case"response.output_text.delta":{let o=s.output[t.output_index];if(!o)throw new Oe(`missing output at index ${t.output_index}`);if(o.type==="message"){let i=o.content[t.content_index];if(!i)throw new Oe(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new Oe(`expected content to be 'output_text', got ${i.type}`);a("response.output_text.delta",{...t,snapshot:i.text})}break}case"response.function_call_arguments.delta":{let o=s.output[t.output_index];if(!o)throw new Oe(`missing output at index ${t.output_index}`);o.type==="function_call"&&a("response.function_call_arguments.delta",{...t,snapshot:o.arguments});break}default:a(t.type,t);break}},u2=function(){if(this.ended)throw new Oe("stream has ended, this shouldn't happen");let t=re(this,Xo,"f");if(!t)throw new Oe("request ended without sending any events");tt(this,Xo,void 0,"f");let n=wte(t,re(this,ry,"f"));return tt(this,ny,n,"f"),n},p2=function(t){let n=re(this,Xo,"f");if(!n){if(t.type!=="response.created")throw new Oe(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=tt(this,Xo,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{let a=n.output[t.output_index];if(!a)throw new Oe(`missing output at index ${t.output_index}`);let s=a.type,o=t.part;s==="message"&&o.type!=="reasoning_text"?a.content.push(o):s==="reasoning"&&o.type==="reasoning_text"&&(a.content||(a.content=[]),a.content.push(o));break}case"response.output_text.delta":{let a=n.output[t.output_index];if(!a)throw new Oe(`missing output at index ${t.output_index}`);if(a.type==="message"){let s=a.content[t.content_index];if(!s)throw new Oe(`missing content at index ${t.content_index}`);if(s.type!=="output_text")throw new Oe(`expected content to be 'output_text', got ${s.type}`);s.text+=t.delta}break}case"response.function_call_arguments.delta":{let a=n.output[t.output_index];if(!a)throw new Oe(`missing output at index ${t.output_index}`);a.type==="function_call"&&(a.arguments+=t.delta);break}case"response.reasoning_text.delta":{let a=n.output[t.output_index];if(!a)throw new Oe(`missing output at index ${t.output_index}`);if(a.type==="reasoning"){let s=a.content?.[t.content_index];if(!s)throw new Oe(`missing content at index ${t.content_index}`);if(s.type!=="reasoning_text")throw new Oe(`expected content to be 'reasoning_text', got ${s.type}`);s.text+=t.delta}break}case"response.completed":{tt(this,Xo,t.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",a=>{let s=t.shift();s?s.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(let a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(let s of t)s.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(let s of t)s.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,o)=>t.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=re(this,ny,"f");if(!e)throw new Oe("stream ended without producing a ChatCompletion");return e}}});var xu,Uw=G(()=>{Ye();cr();Bt();xu=class extends fe{list(e,t={},n){return this._client.getAPIList(me`/responses/${e}/input_items`,At,{query:t,...n})}}});var Tu,Bw=G(()=>{Ye();Tu=class extends fe{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}});var ao,Fw=G(()=>{Mw();d2();Ye();Uw();Uw();Bw();Bw();hr();Bt();ao=class extends fe{constructor(){super(...arguments),this.inputItems=new xu(this._client),this.inputTokens=new Tu(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&ty(n),n))}retrieve(e,t={},n){return this._client.get(me`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(a=>("object"in a&&a.object==="response"&&ty(a),a))}delete(e,t){return this._client.delete(me`/responses/${e}`,{...t,headers:Ce([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Dw(n,e))}stream(e,t){return ay.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(me`/responses/${e}/cancel`,t)}compact(e,t){return this._client.post("/responses/compact",{body:e,...t})}};ao.InputItems=xu;ao.InputTokens=Tu});var Ou,qw=G(()=>{Ye();vs();Bt();Ou=class extends fe{create(e,t,n){return this._client.post(me`/uploads/${e}/parts`,ta({body:t,...n},this._client))}}});var Yo,Gw=G(()=>{Ye();qw();qw();Bt();Yo=class extends fe{constructor(){super(...arguments),this.parts=new Ou(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(me`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(me`/uploads/${e}/complete`,{body:t,...n})}};Yo.Parts=Ou});var m2,h2=G(()=>{m2=async r=>{let e=await Promise.allSettled(r),t=e.filter(a=>a.status==="rejected");if(t.length){for(let a of t)console.error(a.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let n=[];for(let a of e)a.status==="fulfilled"&&n.push(a.value);return n}});var Nu,Vw=G(()=>{Ye();cr();hr();Xl();h2();Bt();Nu=class extends fe{create(e,t,n){return this._client.post(me`/vector_stores/${e}/file_batches`,{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{vector_store_id:a}=t;return this._client.get(me`/vector_stores/${a}/file_batches/${e}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){let{vector_store_id:a}=t;return this._client.post(me`/vector_stores/${a}/file_batches/${e}/cancel`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let a=await this.create(e,t);return await this.poll(e,a.id,n)}listFiles(e,t,n){let{vector_store_id:a,...s}=t;return this._client.getAPIList(me`/vector_stores/${a}/file_batches/${e}/files`,At,{query:s,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){let a=Ce([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:o}=await this.retrieve(t,{vector_store_id:e},{...n,headers:a}).withResponse();switch(s.status){case"in_progress":let i=5e3;if(n?.pollIntervalMs)i=n.pollIntervalMs;else{let u=o.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(i=c)}}await fs(i);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},a){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=a?.maxConcurrency??5,o=Math.min(s,t.length),i=this._client,u=t.values(),c=[...n];async function p(f){for(let g of f){let y=await i.files.create({file:g,purpose:"assistants"},a);c.push(y.id)}}let m=Array(o).fill(u).map(p);return await m2(m),await this.createAndPoll(e,{file_ids:c})}}});var _u,zw=G(()=>{Ye();cr();hr();Xd();Bt();_u=class extends fe{create(e,t,n){return this._client.post(me`/vector_stores/${e}/files`,{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{vector_store_id:a}=t;return this._client.get(me`/vector_stores/${a}/files/${e}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{vector_store_id:a,...s}=t;return this._client.post(me`/vector_stores/${a}/files/${e}`,{body:s,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(me`/vector_stores/${e}/files`,At,{query:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){let{vector_store_id:a}=t;return this._client.delete(me`/vector_stores/${a}/files/${e}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let a=await this.create(e,t,n);return await this.poll(e,a.id,n)}async poll(e,t,n){let a=Ce([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let s=await this.retrieve(t,{vector_store_id:e},{...n,headers:a}).withResponse(),o=s.data;switch(o.status){case"in_progress":let i=5e3;if(n?.pollIntervalMs)i=n.pollIntervalMs;else{let u=s.response.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(i=c)}}await fs(i);break;case"failed":case"completed":return o}}}async upload(e,t,n){let a=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:a.id},n)}async uploadAndPoll(e,t,n){let a=await this.upload(e,t,n);return await this.poll(e,a.id,n)}content(e,t,n){let{vector_store_id:a}=t;return this._client.getAPIList(me`/vector_stores/${a}/files/${e}/content`,bs,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}});var so,Hw=G(()=>{Ye();Vw();Vw();zw();zw();cr();hr();Bt();so=class extends fe{constructor(){super(...arguments),this.files=new _u(this._client),this.fileBatches=new Nu(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(me`/vector_stores/${e}`,{...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(me`/vector_stores/${e}`,{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",At,{query:e,...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(me`/vector_stores/${e}`,{...t,headers:Ce([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(me`/vector_stores/${e}/search`,bs,{body:t,method:"post",...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};so.Files=_u;so.FileBatches=Nu});var Nc,Ww=G(()=>{Ye();cr();hr();vs();Bt();Nc=class extends fe{create(e,t){return this._client.post("/videos",vR({body:e,...t},this._client))}retrieve(e,t){return this._client.get(me`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",Ys,{query:e,...t})}delete(e,t){return this._client.delete(me`/videos/${e}`,t)}downloadContent(e,t={},n){return this._client.get(me`/videos/${e}/content`,{query:t,...n,headers:Ce([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,t,n){return this._client.post(me`/videos/${e}/remix`,vR({body:t,...n},this._client))}}});var Pu,f2,sy,_c,Qw=G(()=>{Ra();Ha();Ye();hr();_c=class extends fe{constructor(){super(...arguments),Pu.add(this)}async unwrap(e,t,n=this._client.webhookSecret,a=300){return await this.verifySignature(e,t,n,a),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,a=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");re(this,Pu,"m",f2).call(this,n);let s=Ce([t]).values,o=re(this,Pu,"m",sy).call(this,s,"webhook-signature"),i=re(this,Pu,"m",sy).call(this,s,"webhook-timestamp"),u=re(this,Pu,"m",sy).call(this,s,"webhook-id"),c=parseInt(i,10);if(isNaN(c))throw new za("Invalid webhook timestamp format");let p=Math.floor(Date.now()/1e3);if(p-c>a)throw new za("Webhook timestamp is too old");if(c>p+a)throw new za("Webhook timestamp is too new");let m=o.split(" ").map(C=>C.startsWith("v1,")?C.substring(3):C),f=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),g=u?`${u}.${i}.${e}`:`${i}.${e}`,y=await crypto.subtle.importKey("raw",f,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let C of m)try{let A=Buffer.from(C,"base64");if(await crypto.subtle.verify("HMAC",y,A,new TextEncoder().encode(g)))return}catch{continue}throw new za("The given webhook signature does not match the expected signature")}};Pu=new WeakSet,f2=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},sy=function(e,t){if(!e)throw new Error("Headers are required");let n=e.get(t);if(n==null)throw new Error(`Missing required header: ${t}`);return n}});var g2=G(()=>{JU();KU();WR();QR();lw();uw();mw();fw();gw();vw();Ew();Tw();Nw();_w();Pw();$w();kw();Fw();Gw();Hw();Ww();Qw()});var Jw,Kw,oy,y2,Ve,iy=G(()=>{Ra();XS();Ks();Xl();Ig();tR();Pd();fU();RU();eR();hs();cr();CR();g2();kg();QR();uw();gw();Ew();_w();Pw();$w();Ww();Qw();WR();lw();GR();mw();fw();vw();Tw();Nw();kw();Fw();Gw();Hw();tR();hr();aw();Ld();Ks();Ve=class{constructor({baseURL:e=Wa("OPENAI_BASE_URL"),apiKey:t=Wa("OPENAI_API_KEY"),organization:n=Wa("OPENAI_ORG_ID")??null,project:a=Wa("OPENAI_PROJECT_ID")??null,webhookSecret:s=Wa("OPENAI_WEBHOOK_SECRET")??null,...o}={}){if(Jw.add(this),oy.set(this,void 0),this.completions=new vc(this),this.chat=new Go(this),this.embeddings=new Cc(this),this.files=new Sc(this),this.images=new xc(this),this.audio=new Es(this),this.moderations=new Oc(this),this.models=new Tc(this),this.fineTuning=new Ka(this),this.graders=new Ko(this),this.vectorStores=new so(this),this.webhooks=new _c(this),this.beta=new Ja(this),this.batches=new hc(this),this.uploads=new Yo(this),this.responses=new ao(this),this.realtime=new no(this),this.conversations=new Qo(this),this.evals=new Jo(this),this.containers=new Wo(this),this.videos=new Nc(this),t===void 0)throw new Oe("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let i={apiKey:t,organization:n,project:a,webhookSecret:s,...o,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&uU())throw new Oe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=i.baseURL,this.timeout=i.timeout??Kw.DEFAULT_TIMEOUT,this.logger=i.logger??console;let u="warn";this.logLevel=u,this.logLevel=pR(i.logLevel,"ClientOptions.logLevel",this)??pR(Wa("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??u,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??dU(),tt(this,oy,hU,"f"),this._options=i,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=n,this.project=a,this.webhookSecret=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return Ce([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return lR(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Uo}`}defaultIdempotencyKey(){return`stainless-node-retry-${KS()}`}makeStatusError(e,t,n,a){return Fr.generate(e,t,n,a)}async _callApiKey(){let e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(n){throw n instanceof Oe?n:new Oe(`Failed to get token from 'apiKey' function: ${n.message}`,{cause:n})}if(typeof t!="string"||!t)throw new Oe(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,n){let a=!re(this,Jw,"m",y2).call(this)&&n||this.baseURL,s=rU(e)?new URL(e):new URL(a+(a.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return nU(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(a=>({method:e,path:t,...a})))}request(e,t=null){return new Bo(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let a=await e,s=a.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(a);let{req:o,url:i,timeout:u}=await this.buildRequest(a,{retryCount:s-t});await this.prepareRequest(o,{url:i,options:a});let c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),p=n===void 0?"":`, retryOf: ${n}`,m=Date.now();if(jr(this).debug(`[${c}] sending request`,Xs({retryOfRequestLogID:n,method:a.method,url:i,options:a,headers:o.headers})),a.signal?.aborted)throw new Lr;let f=new AbortController,g=await this.fetchWithTimeout(i,o,u,f).catch(_d),y=Date.now();if(g instanceof globalThis.Error){let T=`retrying, ${t} attempts remaining`;if(a.signal?.aborted)throw new Lr;let E=Nd(g)||/timed? ?out/i.test(String(g)+("cause"in g?String(g.cause):""));if(t)return jr(this).info(`[${c}] connection ${E?"timed out":"failed"} - ${T}`),jr(this).debug(`[${c}] connection ${E?"timed out":"failed"} (${T})`,Xs({retryOfRequestLogID:n,url:i,durationMs:y-m,message:g.message})),this.retryRequest(a,t,n??c);throw jr(this).info(`[${c}] connection ${E?"timed out":"failed"} - error; no more retries left`),jr(this).debug(`[${c}] connection ${E?"timed out":"failed"} (error; no more retries left)`,Xs({retryOfRequestLogID:n,url:i,durationMs:y-m,message:g.message})),E?new Js:new Qs({cause:g})}let C=[...g.headers.entries()].filter(([T])=>T==="x-request-id").map(([T,E])=>", "+T+": "+JSON.stringify(E)).join(""),A=`[${c}${p}${C}] ${o.method} ${i} ${g.ok?"succeeded":"failed"} with status ${g.status} in ${y-m}ms`;if(!g.ok){let T=await this.shouldRetry(g);if(t&&T){let S=`retrying, ${t} attempts remaining`;return await mU(g.body),jr(this).info(`${A} - ${S}`),jr(this).debug(`[${c}] response error (${S})`,Xs({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,durationMs:y-m})),this.retryRequest(a,t,n??c,g.headers)}let E=T?"error; no more retries left":"error; not retryable";jr(this).info(`${A} - ${E}`);let d=await g.text().catch(S=>_d(S).message),l=oU(d),h=l?void 0:d;throw jr(this).debug(`[${c}] response error (${E})`,Xs({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,message:h,durationMs:Date.now()-m})),this.makeStatusError(g.status,l,h,g.headers)}return jr(this).info(A),jr(this).debug(`[${c}] response start`,Xs({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,durationMs:y-m})),{response:g,options:a,controller:f,requestLogID:c,retryOfRequestLogID:n,startTime:m}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){let n=this.makeRequest(t,null,void 0);return new Zl(this,n,e)}async fetchWithTimeout(e,t,n,a){let{signal:s,method:o,...i}=t||{};s&&s.addEventListener("abort",()=>a.abort());let u=setTimeout(()=>a.abort(),n),c=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||typeof i.body=="object"&&i.body!==null&&Symbol.asyncIterator in i.body,p={signal:a.signal,...c?{duplex:"half"}:{},method:"GET",...i};o&&(p.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(u)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,a){let s,o=a?.get("retry-after-ms");if(o){let u=parseFloat(o);Number.isNaN(u)||(s=u)}let i=a?.get("retry-after");if(i&&!s){let u=parseFloat(i);Number.isNaN(u)?s=Date.parse(i)-Date.now():s=u*1e3}if(!(s&&0<=s&&s<60*1e3)){let u=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,u)}return await fs(s),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let s=t-e,o=Math.min(.5*Math.pow(2,s),8),i=1-Math.random()*.25;return o*i*1e3}async buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:a,path:s,query:o,defaultBaseURL:i}=n,u=this.buildURL(s,o,i);"timeout"in n&&sU("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:c,body:p}=this.buildBody({options:n}),m=await this.buildHeaders({options:e,method:a,bodyHeaders:c,retryCount:t});return{req:{method:a,headers:m,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"},...p&&{body:p},...this.fetchOptions??{},...n.fetchOptions??{}},url:u,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:a}){let s={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let o=Ce([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...pU(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=Ce([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:xg(e)}:re(this,oy,"f").call(this,{body:e,headers:n})}};Kw=Ve,oy=new WeakMap,Jw=new WeakSet,y2=function(){return this.baseURL!=="https://api.openai.com/v1"};Ve.OpenAI=Kw;Ve.DEFAULT_TIMEOUT=6e5;Ve.OpenAIError=Oe;Ve.APIError=Fr;Ve.APIConnectionError=Qs;Ve.APIConnectionTimeoutError=Js;Ve.APIUserAbortError=Lr;Ve.NotFoundError=sc;Ve.ConflictError=oc;Ve.RateLimitError=cc;Ve.BadRequestError=rc;Ve.AuthenticationError=nc;Ve.InternalServerError=lc;Ve.PermissionDeniedError=ac;Ve.UnprocessableEntityError=ic;Ve.InvalidWebhookSignatureError=za;Ve.toFile=Ud;Ve.Completions=vc;Ve.Chat=Go;Ve.Embeddings=Cc;Ve.Files=Sc;Ve.Images=xc;Ve.Audio=Es;Ve.Moderations=Oc;Ve.Models=Tc;Ve.FineTuning=Ka;Ve.Graders=Ko;Ve.VectorStores=so;Ve.Webhooks=_c;Ve.Beta=Ja;Ve.Batches=hc;Ve.Uploads=Yo;Ve.Responses=ao;Ve.Realtime=no;Ve.Conversations=Qo;Ve.Evals=Jo;Ve.Containers=Wo;Ve.Videos=Nc});var cy,Pte,b2=G(()=>{hr();Ha();Xd();iy();cy=class extends Ve{constructor({baseURL:e=Wa("OPENAI_BASE_URL"),apiKey:t=Wa("AZURE_OPENAI_API_KEY"),apiVersion:n=Wa("OPENAI_API_VERSION"),endpoint:a,deployment:s,azureADTokenProvider:o,dangerouslyAllowBrowser:i,...u}={}){if(!n)throw new Oe("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if(typeof o=="function"&&(i=!0),!o&&!t)throw new Oe("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(o&&t)throw new Oe("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(u.defaultQuery={...u.defaultQuery,"api-version":n},e){if(a)throw new Oe("baseURL and endpoint are mutually exclusive")}else{if(a||(a=process.env.AZURE_OPENAI_ENDPOINT),!a)throw new Oe("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");e=`${a}/openai`}super({apiKey:o??t,baseURL:e,...u,...i!==void 0?{dangerouslyAllowBrowser:i}:{}}),this.apiVersion="",this.apiVersion=n,this.deploymentName=s}async buildRequest(e,t={}){if(Pte.has(e.path)&&e.method==="post"&&e.body!==void 0){if(!Kl(e.body))throw new Error("Expected request body to be an object");let n=this.deploymentName||e.body.model||e.__metadata?.model;n!==void 0&&!this.baseURL.includes("/deployments")&&(e.path=`/deployments/${n}${e.path}`)}return super.buildRequest(e,t)}async authHeaders(e){return typeof this._options.apiKey=="string"?Ce([{"api-key":this.apiKey}]):super.authHeaders(e)}},Pte=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/batches","/images/edits"])});var v2={};wr(v2,{APIConnectionError:()=>Qs,APIConnectionTimeoutError:()=>Js,APIError:()=>Fr,APIPromise:()=>Bo,APIUserAbortError:()=>Lr,AuthenticationError:()=>nc,AzureOpenAI:()=>cy,BadRequestError:()=>rc,ConflictError:()=>oc,InternalServerError:()=>lc,InvalidWebhookSignatureError:()=>za,NotFoundError:()=>sc,OpenAI:()=>Ve,OpenAIError:()=>Oe,PagePromise:()=>Zl,PermissionDeniedError:()=>ac,RateLimitError:()=>cc,UnprocessableEntityError:()=>ic,default:()=>Ve,toFile:()=>Ud});var As=G(()=>{iy();CR();kg();iy();cr();hs();b2()});function Ss(r,e,t,n=0){let a=E2[r]||E2.default,s=e/1e6*a.inputPerMillion,o=t/1e6*a.outputPerMillion,i=n/1e6*a.thinkingPerMillion,u=s+o+i;return{inputCost:Math.round(s*1e6)/1e6,outputCost:Math.round(o*1e6)/1e6,thinkingCost:Math.round(i*1e6)/1e6,totalCost:Math.round(u*1e6)/1e6}}function Ar(r){return r.toFixed(6)}var E2,$u=G(()=>{"use strict";E2={"deepseek-reasoner":{inputPerMillion:.55,outputPerMillion:2.19,thinkingPerMillion:.55},"deepseek-chat":{inputPerMillion:.28,outputPerMillion:.42,thinkingPerMillion:.28},"gemini-3-pro-preview":{inputPerMillion:1.25,outputPerMillion:10,thinkingPerMillion:3},"gemini-2.5-flash":{inputPerMillion:.3,outputPerMillion:2.5,thinkingPerMillion:1},default:{inputPerMillion:.28,outputPerMillion:.42,thinkingPerMillion:.28}}});function Yw(){return process.env.AI_PROVIDER?.toLowerCase()==="gemini"?"gemini":"deepseek"}function Lte(){let r=process.env.DEEPSEEK_API_KEY;return r?new Ve({apiKey:r,baseURL:"https://api.deepseek.com"}):null}function jte(){let r=process.env.DEEPSEEK_TRANSLATOR_API_KEY||process.env.DEEPSEEK_API_KEY;return r?new Ve({apiKey:r,baseURL:"https://api.deepseek.com"}):null}function kte(){let r=process.env.DEEPSEEK_REEDITOR_API_KEY||process.env.DEEPSEEK_API_KEY;return r?new Ve({apiKey:r,baseURL:"https://api.deepseek.com"}):null}function A2(r){let e=String(r?.message||r||"");return e.includes("RATELIMIT_EXCEEDED")||e.includes("429")||e.includes("Rate limit")||e.includes("rate limit")}function Bte(r){let e=String(r?.message||r||"");return e.includes("ECONNRESET")||e.includes("ETIMEDOUT")||e.includes("ECONNREFUSED")||e.includes("socket hang up")||e.includes("network")||e.includes("fetch failed")||e.includes("Connection")||e.includes("ENOTFOUND")}function Zw(r){let e=`gen_${r}_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;return Fte.set(r,e),console.log(`[BaseAgent] New generation token for project ${r}: ${e}`),e}function io(r){let e=Xw.get(r);return e?(e.abort(),Xw.delete(r),!0):!1}function uy(r){return Xw.get(r)?.signal.aborted??!1}async function eI(r){if(uy(r))return!0;try{let e=await b.getProject(r);if(!e)return!0;if(["idle","cancelled","completed","paused"].includes(e.status))return console.log(`[BaseAgent] Project ${r} cancelled via DB status: ${e.status}`),!0}catch(e){console.error("[BaseAgent] Error checking project status:",e)}return!1}function Pc(r){return new Promise(e=>setTimeout(e,r))}async function S2(r,e,t,n){let a,s=new Promise((o,i)=>{a=setTimeout(()=>{n&&(console.log(`[withTimeout] Aborting request for ${t} after ${e}ms`),n.abort()),i(new Error(`TIMEOUT: ${t} exceeded ${e}ms`))},e)});try{let o=await Promise.race([r,s]);return clearTimeout(a),o}catch(o){throw clearTimeout(a),o}}function qte(r,e,t,n){let a,s;r==="deepseek-reasoner"?(a=.55/1e6,s=2.19/1e6):(a=.27/1e6,s=1.1/1e6);let o=e*a,i=t*s,u=n*s;return{inputCost:o,outputCost:i,thinkingCost:u,totalCost:o+i+u}}var R2,C2,$te,Dte,w2,Mte,Ute,oo,tm,Zo,ly,Xw,Fte,Ae,It=G(()=>{"use strict";R2=require("@google/genai");As();$u();vn();C2=process.env.GEMINI_API_KEY,$te=new R2.GoogleGenAI({apiKey:C2||process.env.AI_INTEGRATIONS_GEMINI_API_KEY,httpOptions:C2?void 0:{apiVersion:"",baseUrl:process.env.AI_INTEGRATIONS_GEMINI_BASE_URL}});Dte={"global-architect":"deepseek-reasoner","chapter-architect":"deepseek-reasoner","ghostwriter-v2":"deepseek-chat","smart-editor":"deepseek-chat",summarizer:"deepseek-chat","narrative-director":"deepseek-reasoner",ghostwriter:"deepseek-chat","chapter-expander":"deepseek-chat","new-chapter-generator":"deepseek-chat",chapter_expander:"deepseek-chat",new_chapter_generator:"deepseek-chat",narrative_rewriter:"deepseek-chat","series-thread-fixer":"deepseek-chat",editor:"deepseek-chat",copyeditor:"deepseek-chat",translator:"deepseek-chat",world_bible_extractor:"deepseek-chat","chapter-expansion-analyzer":"deepseek-chat","final-reviewer":"deepseek-reasoner",final_reviewer:"deepseek-reasoner",qa_continuity:"deepseek-chat",qa_voice:"deepseek-chat",qa_semantic:"deepseek-chat",qa_anachronism:"deepseek-chat","continuity-validator":"deepseek-chat","continuity-sentinel":"deepseek-chat","voice-rhythm-auditor":"deepseek-chat","semantic-repetition-detector":"deepseek-chat","manuscript-analyzer":"deepseek-chat","arc-validator":"deepseek-chat",restructurer:"deepseek-chat",expansion_analyzer:"deepseek-chat","italian-reviewer":"deepseek-chat","writing-lessons":"deepseek-chat",inquisidor:"deepseek-reasoner",estilista:"deepseek-chat",ritmo:"deepseek-chat",ensamblador:"deepseek-chat"},w2=180*1e3,Mte=900*1e3,Ute=w2,oo=3,tm=5e3,Zo=5,ly=[3e4,6e4,9e4,12e4,18e4];Xw=new Map,Fte=new Map;Ae=class{config;ai=$te;timeoutMs=Ute;constructor(e){this.config=e}get name(){return this.config.name}get role(){return this.config.role}async generateContent(e,t,n){console.log(`[${this.config.name}] generateContent() called (prompt: ${e.length} chars)`);let a=n?.forceProvider||Yw();return console.log(`[${this.config.name}] AI provider: ${a}${n?.forceProvider?" (forced)":""}`),a==="deepseek"?(console.log(`[${this.config.name}] Calling generateWithDeepSeek()...`),this.generateWithDeepSeek(e,t,n)):this.generateWithGemini(e,t,n)}async generateWithDeepSeek(e,t,n){let a,s;if(this.config.useTranslatorClient?(a=jte(),s="DEEPSEEK_TRANSLATOR_API_KEY"):this.config.useReeditorClient?(a=kte(),s="DEEPSEEK_REEDITOR_API_KEY"):(a=Lte(),s="DEEPSEEK_API_KEY"),!a)return{content:"",error:`DeepSeek API key not configured. Please add ${s}.`,timedOut:!1};let o=null,i=n?.temperature??1,u=0,c=oo+Zo+1,p=this.config.role?.toLowerCase()||this.config.name.toLowerCase(),m=Dte[p]||"deepseek-chat",f=m==="deepseek-reasoner",g=f?Mte:w2;console.log(`[${this.config.name}] Using DeepSeek model: ${m} (role: ${p}, timeout: ${g/1e3}s)`);for(let y=0;y<c;y++){if(t&&uy(t))return{content:"",error:"CANCELLED: Project generation was cancelled",timedOut:!1};try{let C=Date.now();console.log(`[${this.config.name}] Starting DeepSeek API call (${m}, attempt ${y+1})...`);let A=[{role:"system",content:this.config.systemPrompt},{role:"user",content:e}];console.log(`[${this.config.name}] Creating DeepSeek request (messages: ${A.length}, model: ${m})...`);let T={model:m,messages:A,stream:!1};f?T.max_completion_tokens=n?.maxCompletionTokens||16e3:(T.max_tokens=8192,T.temperature=Math.min(i,2));let E=this.config.systemPrompt?.length||0,d=e?.length||0;console.log(`[${this.config.name}] DEBUG REQUEST PARAMS:`),console.log(`  - model: ${T.model}`),console.log(`  - max_tokens: ${T.max_tokens||"N/A"}`),console.log(`  - max_completion_tokens: ${T.max_completion_tokens||"N/A"}`),console.log(`  - temperature: ${T.temperature||"N/A"}`),console.log(`  - stream: ${T.stream}`),console.log(`  - systemPrompt length: ${E} chars`),console.log(`  - userPrompt length: ${d} chars`),console.log(`  - total prompt chars: ${E+d}`);let l=new AbortController,h=a.chat.completions.create(T,{signal:l.signal});console.log(`[${this.config.name}] DeepSeek request created, awaiting response (timeout: ${g/1e3}s)...`);let v=await S2(h,g,`${this.config.name} DeepSeek generation`,l),S=Date.now()-C;console.log(`[${this.config.name}] DeepSeek API call completed in ${Math.round(S/1e3)}s`),console.log(`[${this.config.name}] DEBUG RAW RESPONSE:`),console.log(`  - response.id: ${v.id||"N/A"}`),console.log(`  - response.model: ${v.model||"N/A"}`),console.log(`  - response.choices length: ${v.choices?.length||0}`),console.log(`  - response.usage: ${JSON.stringify(v.usage||{})}`);let R=v.choices?.[0],x=R?.message?.content||"",w="";if(R?.message?.reasoning_content&&(w=R.message.reasoning_content),console.log(`[${this.config.name}] DeepSeek response - content length: ${x.length}, reasoning length: ${w.length}`),console.log(`[${this.config.name}] DEBUG finish_reason: ${R?.finish_reason||"N/A"}`),x.length===0&&(console.log(`[${this.config.name}] WARNING: Empty content received!`),console.log(`  - choice.message: ${JSON.stringify(R?.message||{}).substring(0,500)}`),w.length>0&&console.log(`  - reasoning_content preview (first 500): ${w.substring(0,500)}`)),x.length>0)console.log(`[${this.config.name}] DeepSeek content preview (first 500): ${x.substring(0,500)}`);else if(w.length>0){let _=w.match(/```(?:json)?\s*([\s\S]*?)```/);if(_)console.log(`[${this.config.name}] Found JSON in reasoning_content, extracting...`),x=_[1].trim();else{let N=[/(\{[\s\S]*"world_bible"[\s\S]*\})/,/(\{[\s\S]*"veredicto"[\s\S]*\})/,/(\{[\s\S]*"puntuacion_global"[\s\S]*\})/,/(\{[\s\S]*"bestsellerScore"[\s\S]*\})/,/(\{[\s\S]*"issues"[\s\S]*\})/,/(\{[\s\S]*"capituloReescrito"[\s\S]*\})/,/(\{[\s\S]*"erroresContinuidad"[\s\S]*\})/];for(let P of N){let L=w.match(P);if(L){console.log(`[${this.config.name}] Found raw JSON in reasoning_content, extracting...`),x=L[1];break}}if(x.length===0){let P=w.match(/(\{[\s\S]*\})/);if(P)try{JSON.parse(P[1]),console.log(`[${this.config.name}] Found valid JSON in reasoning_content via generic match, extracting...`),x=P[1]}catch{}}}}let O=v.usage,I={inputTokens:O?.prompt_tokens||0,outputTokens:O?.completion_tokens||0,thinkingTokens:O?.reasoning_tokens||0};if(t&&(I.inputTokens>0||I.outputTokens>0)){let _=qte(m,I.inputTokens,I.outputTokens,I.thinkingTokens);try{await b.createAiUsageEvent({projectId:t,agentName:this.config.name,model:`deepseek:${m}`,inputTokens:I.inputTokens,outputTokens:I.outputTokens,thinkingTokens:I.thinkingTokens,inputCostUsd:Ar(_.inputCost),outputCostUsd:Ar(_.outputCost+_.thinkingCost),totalCostUsd:Ar(_.totalCost),operation:"generate"})}catch(N){console.error(`[${this.config.name}] Failed to log AI usage event:`,N)}}return{content:x,thoughtSignature:w,tokenUsage:I}}catch(C){o=C;let A=o.message||String(C);if(A2(C)){if(u++,u<=Zo){let T=ly[Math.min(u-1,ly.length-1)];console.log(`[${this.config.name}] DeepSeek rate limit hit (attempt ${u}/${Zo}). Waiting ${T/1e3}s before retry...`),await Pc(T);continue}return console.error(`[${this.config.name}] DeepSeek rate limit exceeded after ${Zo} retries`),{content:"",error:`RATE_LIMIT: ${A}`,timedOut:!1}}if(console.error(`[${this.config.name}] DeepSeek attempt ${y+1} failed:`,A),A.startsWith("TIMEOUT:")){if(y<oo){let T=tm*(y+1);console.log(`[${this.config.name}] Retrying DeepSeek after timeout (waiting ${T/1e3}s)...`),await Pc(T);continue}return{content:"",error:A,timedOut:!0}}if(Bte(C)){if(y<oo){let T=tm*(y+2);console.log(`[${this.config.name}] Connection error detected. Retrying in ${T/1e3}s (attempt ${y+1}/${oo})...`),await Pc(T);continue}return console.error(`[${this.config.name}] DeepSeek connection failed after ${oo} retries`),{content:"",error:`CONNECTION_ERROR: ${A}`,timedOut:!1}}if(y<oo){let T=tm*(y+1);console.log(`[${this.config.name}] Retrying DeepSeek after error (waiting ${T/1e3}s)...`),await Pc(T);continue}}}return{content:"",error:o?.message||"Unknown error after all retries",timedOut:!1}}async generateWithGemini(e,t,n){let a=null,s=n?.temperature??1,o=0,i=oo+Zo+1;for(let u=0;u<i;u++){if(t&&uy(t))return{content:"",error:"CANCELLED: Project generation was cancelled",timedOut:!1};try{let c=this.config.model?.startsWith("deepseek"),p=!this.config.model||c?"gemini-3-pro-preview":this.config.model,m=this.config.useThinking!==!1,f=Date.now();console.log(`[${this.config.name}] Starting Gemini API call (${p}, attempt ${u+1})...`);let g=this.ai.models.generateContent({model:p,contents:[{role:"user",parts:[{text:this.config.systemPrompt}]},{role:"model",parts:[{text:"Entendido. Estoy listo para cumplir mi rol."}]},{role:"user",parts:[{text:e}]}],config:{temperature:s,topP:.95,maxOutputTokens:65536,...m&&p==="gemini-3-pro-preview"?{thinkingConfig:{thinkingBudget:1e4,includeThoughts:!0}}:{}}}),y=await S2(g,this.timeoutMs,`${this.config.name} Gemini generation`),C=Date.now()-f;console.log(`[${this.config.name}] Gemini API call completed in ${Math.round(C/1e3)}s`),console.log(`[${this.config.name}] Response candidates count: ${y.candidates?.length||0}`),y.candidates?.[0]&&(console.log(`[${this.config.name}] Candidate[0] finishReason: ${y.candidates[0].finishReason}`),console.log(`[${this.config.name}] Candidate[0] parts count: ${y.candidates[0].content?.parts?.length||0}`));let A=y.candidates?.[0],T="",E="";if(A?.content?.parts)for(let v of A.content.parts)v.thought===!0?E+=v.text||"":v.text&&(T+=v.text);console.log(`[${this.config.name}] Extracted content length: ${T.length}`),console.log(`[${this.config.name}] Extracted thoughtSignature length: ${E.length}`),T.length>0?console.log(`[${this.config.name}] Content preview (first 500 chars): ${T.substring(0,500)}`):console.log(`[${this.config.name}] WARNING: Content is EMPTY!`),!E&&A?.content?.parts&&console.log(`[${this.config.name}] No thought signature captured. Parts structure:`,A.content.parts.map(v=>({hasText:!!v.text,textLength:v.text?.length||0,thought:v.thought,keys:Object.keys(v)})));let d=y.usageMetadata,l={inputTokens:d?.promptTokenCount||0,outputTokens:d?.candidatesTokenCount||0,thinkingTokens:d?.thoughtsTokenCount||0},h=this.config.model||"gemini-3-pro-preview";if(t&&(l.inputTokens>0||l.outputTokens>0)){let v=Ss(h,l.inputTokens,l.outputTokens,l.thinkingTokens);try{await b.createAiUsageEvent({projectId:t,agentName:this.config.name,model:h,inputTokens:l.inputTokens,outputTokens:l.outputTokens,thinkingTokens:l.thinkingTokens,inputCostUsd:Ar(v.inputCost),outputCostUsd:Ar(v.outputCost+v.thinkingCost),totalCostUsd:Ar(v.totalCost),operation:"generate"})}catch(S){console.error(`[${this.config.name}] Failed to log AI usage event:`,S)}}return{content:T,thoughtSignature:E,tokenUsage:l}}catch(c){a=c;let p=a.message||String(c);if(A2(c)){if(o++,o<=Zo){let m=ly[Math.min(o-1,ly.length-1)];console.log(`[${this.config.name}] Gemini rate limit hit (attempt ${o}/${Zo}). Waiting ${m/1e3}s before retry...`),await Pc(m);continue}return console.error(`[${this.config.name}] Gemini rate limit exceeded after ${Zo} retries`),{content:"",error:`RATE_LIMIT: ${p}`,timedOut:!1}}if(console.error(`[${this.config.name}] Gemini attempt ${u+1} failed:`,p),p.startsWith("TIMEOUT:")){if(u<oo){console.log(`[${this.config.name}] Retrying Gemini after timeout...`),await Pc(tm);continue}return{content:"",error:p,timedOut:!0}}if(u<oo){console.log(`[${this.config.name}] Retrying Gemini after error...`),await Pc(tm*(u+1));continue}}}return{content:"",error:a?.message||"Unknown error after all retries",timedOut:!1}}}});var lm={};wr(lm,{SeriesWorldBibleExtractor:()=>Lu});var mre,Lu,ju=G(()=>{"use strict";It();vn();Mo();ms();Da();mre={name:"series-world-bible-extractor",role:"series-world-bible-extractor",systemPrompt:`You are an expert literary analyst specializing in extracting world-building elements from completed novel manuscripts.

Your task is to analyze a completed volume of a series and extract all relevant information that should be carried forward to subsequent volumes.

EXTRACTION CATEGORIES:

1. CHARACTERS:
   - All named characters with their current status
   - Physical descriptions and distinguishing traits
   - Relationships between characters
   - Character development and growth
   - Skills and abilities

2. LOCATIONS:
   - All named places and settings
   - Geographical relationships
   - Significant events that occurred there
   - Atmosphere and characteristics

3. LESSONS/LEARNINGS:
   - What characters learned during this volume
   - Emotional growth and realizations
   - Skills acquired
   - Mistakes made and their impact

4. WORLD RULES:
   - Established laws (magical, scientific, social)
   - Cultural norms and taboos
   - Power dynamics and hierarchies
   - Limitations and constraints

5. TIMELINE EVENTS:
   - Major plot events with their consequences
   - Deaths, births, marriages, conflicts
   - Political or social changes
   - Events that will affect future volumes

6. SIGNIFICANT OBJECTS:
   - Magical items, weapons, heirlooms
   - Current ownership and status
   - Powers or significance

7. SECRETS:
   - Unrevealed information
   - Mysteries established
   - Foreshadowing elements
   - Who knows what

OUTPUT FORMAT:
Respond with a valid JSON object containing all extracted data. Be thorough but concise.
Focus on information that would be essential for writing future volumes in the series.`,model:"deepseek-chat"},Lu=class extends Ae{constructor(){super(mre)}async execute(e){return this.generateContent(e.prompt,e.projectId)}async extractFromProject(e,t){let n=await b.getProject(e);if(!n)return console.error(`[SeriesWorldBibleExtractor] Project ${e} not found`),null;if(!n.seriesId)return console.error(`[SeriesWorldBibleExtractor] Project ${e} is not part of a series`),null;let s=(await b.getChaptersByProject(e)).filter(c=>c.content&&c.content.length>100);if(s.length===0)return console.error(`[SeriesWorldBibleExtractor] No completed chapters found for project ${e}`),null;let o=s.sort((c,p)=>c.chapterNumber-p.chapterNumber).map(c=>`--- Chapter ${c.chapterNumber}: ${c.title||"Untitled"} ---

${c.content}`).join(`

`),i=o.length>15e4?o.substring(0,15e4)+`

[... manuscript truncated for analysis ...]`:o,u=`Analyze the following manuscript (Volume ${t} of a series) and extract all world-building elements that should be carried forward to future volumes.

MANUSCRIPT:
${i}

INSTRUCTIONS:
1. Extract ALL named characters with their current status at the end of this volume
2. Extract ALL named locations mentioned
3. Identify key lessons and character growth
4. Note any world rules or laws established
5. List major plot events and their consequences
6. Catalog significant objects and their current state
7. Record any secrets or mysteries that remain unresolved

Respond with a valid JSON object following this exact structure:
{
  "characters": [
    {
      "name": "Character Name",
      "role": "protagonist/antagonist/supporting/minor",
      "description": "Brief description",
      "status": "alive/dead/missing/unknown",
      "firstAppearanceVolume": ${t},
      "lastSeenVolume": ${t},
      "relationships": [{"character": "Other Name", "relation": "friend/enemy/lover/family"}],
      "development": "How they changed during this volume",
      "physicalTraits": ["trait1", "trait2"],
      "skills": ["skill1", "skill2"]
    }
  ],
  "locations": [
    {
      "name": "Location Name",
      "description": "Brief description",
      "type": "city/building/region/etc",
      "firstMentionVolume": ${t},
      "significance": "Why this place matters",
      "keyEvents": ["event1", "event2"]
    }
  ],
  "lessons": [
    {
      "description": "What was learned",
      "learnedByCharacter": "Character Name",
      "volumeNumber": ${t},
      "impact": "How this affects future behavior"
    }
  ],
  "worldRules": [
    {
      "category": "magic/society/physics/etc",
      "rule": "Description of the rule",
      "establishedVolume": ${t},
      "constraints": ["limitation1", "limitation2"]
    }
  ],
  "timeline": [
    {
      "description": "Major event description",
      "volumeNumber": ${t},
      "affectedCharacters": ["name1", "name2"],
      "consequences": "What this means for the future"
    }
  ],
  "objects": [
    {
      "name": "Object Name",
      "description": "What it is",
      "owner": "Current owner or null",
      "significance": "Why it matters",
      "status": "intact/destroyed/lost/transferred",
      "firstAppearanceVolume": ${t}
    }
  ],
  "secrets": [
    {
      "description": "The secret or mystery",
      "knownBy": ["character1", "character2"],
      "revealedVolume": null,
      "impact": "Potential impact when revealed",
      "isResolved": false
    }
  ]
}`;console.log(`[SeriesWorldBibleExtractor] Extracting world bible from project ${e} (Volume ${t})`);try{let c=await this.execute({prompt:u,projectId:e});if(!c.content)return console.error("[SeriesWorldBibleExtractor] Empty response from AI"),null;let p=c.content.match(/\{[\s\S]*\}/);if(!p)return console.error("[SeriesWorldBibleExtractor] No JSON found in response"),null;let m=JSON.parse(p[0]);return console.log(`[SeriesWorldBibleExtractor] Extracted: ${m.characters?.length||0} characters, ${m.locations?.length||0} locations, ${m.lessons?.length||0} lessons`),m}catch(c){return console.error("[SeriesWorldBibleExtractor] Error extracting:",c),null}}async mergeAndSaveToSeries(e,t,n){let a=await M.select().from(Yn).where(q(Yn.seriesId,e)).limit(1);if(a.length===0)await M.insert(Yn).values({seriesId:e,characters:n.characters,locations:n.locations,lessons:n.lessons,worldRules:n.worldRules,timeline:n.timeline,objects:n.objects,secrets:n.secrets,lastUpdatedVolume:t}),console.log(`[SeriesWorldBibleExtractor] Created new series world bible for series ${e}`);else{let s=a[0],o=this.mergeCharacters(s.characters||[],n.characters,t),i=this.mergeLocations(s.locations||[],n.locations),u=[...s.lessons||[],...n.lessons],c=this.mergeRules(s.worldRules||[],n.worldRules),p=[...s.timeline||[],...n.timeline],m=this.mergeObjects(s.objects||[],n.objects,t),f=this.mergeSecrets(s.secrets||[],n.secrets);await M.update(Yn).set({characters:o,locations:i,lessons:u,worldRules:c,timeline:p,objects:m,secrets:f,lastUpdatedVolume:t,updatedAt:new Date}).where(q(Yn.id,s.id)),console.log(`[SeriesWorldBibleExtractor] Updated series world bible for series ${e} with volume ${t} data`)}}mergeCharacters(e,t,n){let a=[...e];for(let s of t){let o=a.findIndex(i=>i.name.toLowerCase()===s.name.toLowerCase());if(o>=0){let i=a[o].physicalTraits||[],u=s.physicalTraits||[],c=a[o].skills||[],p=s.skills||[];a[o]={...a[o],status:s.status,lastSeenVolume:n,description:s.description||a[o].description,relationships:[...a[o].relationships||[],...s.relationships||[]],development:a[o].development+" | "+s.development,physicalTraits:Array.from(new Set([...i,...u])),skills:Array.from(new Set([...c,...p]))}}else a.push({...s,firstAppearanceVolume:n,lastSeenVolume:n})}return a}mergeLocations(e,t){let n=[...e];for(let a of t){let s=n.findIndex(o=>o.name.toLowerCase()===a.name.toLowerCase());s>=0?n[s]={...n[s],keyEvents:[...n[s].keyEvents||[],...a.keyEvents||[]],significance:n[s].significance+" | "+a.significance}:n.push(a)}return n}mergeRules(e,t){let n=[...e];for(let a of t)n.some(o=>o.rule.toLowerCase()===a.rule.toLowerCase())||n.push(a);return n}mergeObjects(e,t,n){let a=[...e];for(let s of t){let o=a.findIndex(i=>i.name.toLowerCase()===s.name.toLowerCase());o>=0?a[o]={...a[o],status:s.status,owner:s.owner||a[o].owner}:a.push({...s,firstAppearanceVolume:n})}return a}mergeSecrets(e,t){let n=[...e];for(let a of t){let s=n.findIndex(o=>o.description.toLowerCase().includes(a.description.toLowerCase().substring(0,50)));s>=0?a.isResolved&&!n[s].isResolved&&(n[s]={...n[s],isResolved:!0,revealedVolume:a.revealedVolume}):n.push(a)}return n}async extractFromManuscript(e,t){let n=await b.getImportedManuscript(e);if(!n)return console.error(`[SeriesWorldBibleExtractor] Manuscript ${e} not found`),null;if(!n.seriesId)return console.error(`[SeriesWorldBibleExtractor] Manuscript ${e} is not part of a series`),null;let s=(await b.getImportedChaptersByManuscript(e)).filter(c=>{let p=c.editedContent||c.originalContent;return p&&p.length>100});if(s.length===0)return console.error(`[SeriesWorldBibleExtractor] No valid chapters found for manuscript ${e}`),null;let o=s.sort((c,p)=>c.chapterNumber-p.chapterNumber).map(c=>`--- Chapter ${c.chapterNumber}: ${c.title||"Untitled"} ---

${c.editedContent||c.originalContent}`).join(`

`),i=o.length>15e4?o.substring(0,15e4)+`

[... manuscript truncated for analysis ...]`:o,u=`Analyze the following imported manuscript (Volume ${t} of a series) and extract all world-building elements that should be carried forward to future volumes.

MANUSCRIPT:
${i}

INSTRUCTIONS:
1. Extract ALL named characters with their current status at the end of this volume
2. Extract ALL named locations mentioned
3. Identify key lessons and character growth
4. Note any world rules or laws established
5. List major plot events and their consequences
6. Catalog significant objects and their current state
7. Record any secrets or mysteries that remain unresolved

Respond with a valid JSON object following this exact structure:
{
  "characters": [
    {
      "name": "Character Name",
      "role": "protagonist/antagonist/supporting/minor",
      "description": "Brief description",
      "status": "alive/dead/missing/unknown",
      "firstAppearanceVolume": ${t},
      "lastSeenVolume": ${t},
      "relationships": [{"character": "Other Name", "relation": "friend/enemy/lover/family"}],
      "development": "How they changed during this volume",
      "physicalTraits": ["trait1", "trait2"],
      "skills": ["skill1", "skill2"]
    }
  ],
  "locations": [
    {
      "name": "Location Name",
      "description": "Brief description",
      "type": "city/building/region/etc",
      "firstMentionVolume": ${t},
      "significance": "Why this place matters",
      "keyEvents": ["event1", "event2"]
    }
  ],
  "lessons": [
    {
      "description": "What was learned",
      "learnedByCharacter": "Character Name",
      "volumeNumber": ${t},
      "impact": "How this affects future behavior"
    }
  ],
  "worldRules": [
    {
      "category": "magic/society/physics/etc",
      "rule": "Description of the rule",
      "establishedVolume": ${t},
      "constraints": ["limitation1", "limitation2"]
    }
  ],
  "timeline": [
    {
      "description": "Major event description",
      "volumeNumber": ${t},
      "affectedCharacters": ["name1", "name2"],
      "consequences": "What this means for the future"
    }
  ],
  "objects": [
    {
      "name": "Object Name",
      "description": "What it is",
      "owner": "Current owner or null",
      "significance": "Why it matters",
      "status": "intact/destroyed/lost/transferred",
      "firstAppearanceVolume": ${t}
    }
  ],
  "secrets": [
    {
      "description": "The secret or mystery",
      "knownBy": ["character1", "character2"],
      "revealedVolume": null,
      "impact": "Potential impact when revealed",
      "isResolved": false
    }
  ]
}`;console.log(`[SeriesWorldBibleExtractor] Extracting world bible from manuscript ${e} (Volume ${t})`);try{let c=await this.execute({prompt:u});if(!c.content)return console.error("[SeriesWorldBibleExtractor] Empty response from AI for manuscript"),null;let p=c.content.match(/\{[\s\S]*\}/);if(!p)return console.error("[SeriesWorldBibleExtractor] No JSON found in response for manuscript"),null;let m=JSON.parse(p[0]);return console.log(`[SeriesWorldBibleExtractor] Extracted from manuscript: ${m.characters?.length||0} characters, ${m.locations?.length||0} locations, ${m.lessons?.length||0} lessons`),m}catch(c){return console.error("[SeriesWorldBibleExtractor] Error extracting from manuscript:",c),null}}async getSeriesWorldBible(e){let t=await M.select().from(Yn).where(q(Yn.seriesId,e)).limit(1);return t.length===0?null:{characters:t[0].characters||[],locations:t[0].locations||[],lessons:t[0].lessons||[],worldRules:t[0].worldRules||[],timeline:t[0].timeline||[],objects:t[0].objects||[],secrets:t[0].secrets||[]}}formatForGhostwriter(e,t){let n=`=== SERIES WORLD BIBLE (Accumulated from previous volumes) ===

`;if(e.characters.length>0){n+=`## ESTABLISHED CHARACTERS:
`;for(let a of e.characters)n+=`
### ${a.name} (${a.role})
`,n+=`- Status: ${a.status}
`,n+=`- First appeared: Volume ${a.firstAppearanceVolume}
`,n+=`- Description: ${a.description}
`,a.development&&(n+=`- Development so far: ${a.development}
`),a.physicalTraits?.length&&(n+=`- Physical traits: ${a.physicalTraits.join(", ")}
`),a.skills?.length&&(n+=`- Skills: ${a.skills.join(", ")}
`),a.relationships?.length&&(n+=`- Relationships: ${a.relationships.map(s=>`${s.relation} of ${s.character}`).join(", ")}
`)}if(e.locations.length>0){n+=`
## ESTABLISHED LOCATIONS:
`;for(let a of e.locations)n+=`
### ${a.name} (${a.type})
`,n+=`- ${a.description}
`,n+=`- Significance: ${a.significance}
`,a.keyEvents?.length&&(n+=`- Past events here: ${a.keyEvents.join("; ")}
`)}if(e.lessons.length>0){n+=`
## LESSONS LEARNED (by characters):
`;for(let a of e.lessons)n+=`- ${a.learnedByCharacter} (Vol. ${a.volumeNumber}): ${a.description}
`,n+=`  Impact: ${a.impact}
`}if(e.worldRules.length>0){n+=`
## ESTABLISHED WORLD RULES:
`;for(let a of e.worldRules)n+=`- [${a.category}] ${a.rule}
`,a.constraints?.length&&(n+=`  Constraints: ${a.constraints.join(", ")}
`)}if(e.timeline.length>0){n+=`
## KEY PAST EVENTS (Timeline):
`;for(let a of e.timeline)n+=`- Vol. ${a.volumeNumber}: ${a.description}
`,n+=`  Affected: ${a.affectedCharacters.join(", ")}
`,n+=`  Consequences: ${a.consequences}
`}if(e.objects.length>0){n+=`
## SIGNIFICANT OBJECTS:
`;for(let a of e.objects)n+=`- ${a.name}: ${a.description}
`,n+=`  Status: ${a.status}${a.owner?`, owned by ${a.owner}`:""}
`,n+=`  Significance: ${a.significance}
`}if(e.secrets.length>0){let a=e.secrets.filter(s=>!s.isResolved);if(a.length>0){n+=`
## UNRESOLVED SECRETS/MYSTERIES:
`;for(let s of a)n+=`- ${s.description}
`,n+=`  Known by: ${s.knownBy.join(", ")}
`,n+=`  Potential impact: ${s.impact}
`}}return n+=`
=== END SERIES WORLD BIBLE ===
`,n+=`
IMPORTANT: You are writing Volume ${t}. All the above information is established canon from previous volumes. Maintain consistency with all characters, locations, rules, and events.
`,n}}});function hy(r){let e=(r||"mystery").toLowerCase().replace(/_/g,"_");return j2[e]||j2.mystery}var j2,k2=G(()=>{"use strict";j2={crime_thriller:{focus:"Coartadas, Ubicaciones Exactas, L\xEDneas de Tiempo, Evidencias F\xEDsicas, Identidad de Sospechosos.",critical_rules:["Un personaje no puede estar en dos lugares al mismo tiempo.","La causa de muerte debe ser consistente con la autopsia establecida.","Las coartadas verificadas son inmutables.","La cadena de custodia de la evidencia no puede romperse inexplicablemente.","La identidad de v\xEDctima/sospechoso no puede cambiar sin explicaci\xF3n narrativa.","Los roles de personajes (forense, detective, sospechoso) deben ser coherentes."],tracked_attributes:["is_suspect","alibi","alibi_verified","motive","location_at_crime","has_evidence_against"],relationship_types:["SUSPECTS","ALIBI_FOR","WITNESSED","KILLED","FOUND_BODY","LOCATED_AT"]},mystery:{focus:"Pistas, Sospechosos, Coartadas, Revelaciones Progresivas, Red Herrings.",critical_rules:["Las pistas sembradas deben tener relevancia o ser red herrings claramente marcados.","Los sospechosos deben tener motivo, medios y oportunidad coherentes.","La revelaci\xF3n final debe ser l\xF3gicamente deducible de pistas previas.","No se pueden introducir elementos cruciales en el \xFAltimo momento (fair play).","Los personajes no pueden olvidar informaci\xF3n cr\xEDtica sin justificaci\xF3n."],tracked_attributes:["is_suspect","alibi","motive","means","opportunity","secrets_known"],relationship_types:["SUSPECTS","KNOWS_SECRET","ALIBI_FOR","BLACKMAILS","LIES_TO"]},historical_thriller:{focus:"Tecnolog\xEDa Forense de la \xC9poca, Tiempos de Viaje Hist\xF3ricos, Contexto Pol\xEDtico Real.",critical_rules:["No se pueden usar m\xE9todos forenses modernos (ADN, huellas digitales) si no exist\xEDan en el a\xF1o establecido.","Los tiempos de viaje deben respetar el transporte de la \xE9poca (caballo, tren a vapor, barco).","Las motivaciones deben encajar con la moralidad y pol\xEDtica del momento hist\xF3rico.","El lenguaje debe evitar anacronismos ling\xFC\xEDsticos.","Los objetos y tecnolog\xEDa deben existir en la \xE9poca."],tracked_attributes:["social_rank","historical_role","allegiance","available_technology"],relationship_types:["SERVES","COMMANDS","ALLIED_WITH","ENEMY_OF","LOCATED_AT"]},historical:{focus:"Fechas de Eventos Reales, Etiqueta Social, Vestimenta, Tecnolog\xEDa Disponible.",critical_rules:["CERO ANACRONISMOS: No mencionar objetos, conceptos o palabras que no exist\xEDan.","Los grandes eventos hist\xF3ricos (batallas, coronaciones) deben ocurrir en su fecha exacta.","El lenguaje y la jerarqu\xEDa social deben respetarse estrictamente (tratos de nobleza, roles de g\xE9nero de la \xE9poca).","La vestimenta y costumbres deben ser apropiadas para la \xE9poca y clase social."],tracked_attributes:["social_class","occupation","historical_fate","allegiances"],relationship_types:["MARRIED_TO","PARENT_OF","SERVES","RULES_OVER","CONTEMPORARY_OF"]},science_fiction:{focus:"Leyes de la F\xEDsica (Reales o Ficticias), Consistencia Tecnol\xF3gica, Biolog\xEDa Alien\xEDgena.",critical_rules:["Si se establece una limitaci\xF3n tecnol\xF3gica (ej: el escudo dura 5 min), no se puede romper sin una mejora expl\xEDcita.","Las reglas del viaje espacial (FTL, criogenia) deben ser constantes.","La fisiolog\xEDa alien\xEDgena o IA debe seguir sus propias reglas biol\xF3gicas/l\xF3gicas.","Los recursos (energ\xEDa, ox\xEDgeno, combustible) deben ser finitos y rastreados."],tracked_attributes:["species","tech_level","augmentations","ship_capabilities","resources"],relationship_types:["COMMANDS","CREW_OF","ALLIED_WITH","HOSTILE_TO","PROGRAMMED_BY"]},fantasy:{focus:"Sistemas de Magia (Hard/Soft), Costes de poder, Geopol\xEDtica de Reinos, Inventario M\xE1gico.",critical_rules:["El coste de la magia (man\xE1, sangre, energ\xEDa) debe pagarse siempre.","No se pueden inventar poderes nuevos para resolver un problema (Deus Ex Machina).","Las distancias de viaje deben respetar el mapa establecido.","Los objetos m\xE1gicos tienen limitaciones que deben respetarse.","Las razas/especies tienen caracter\xEDsticas fijas."],tracked_attributes:["race","magic_ability","magic_cost","allegiance","magical_items","power_level"],relationship_types:["SWORN_TO","ENEMY_OF","MENTOR_OF","POSSESSES","BOUND_BY"]},dystopian:{focus:"Reglas de la Opresi\xF3n, Escasez de Recursos, Vigilancia, Estratificaci\xF3n Social.",critical_rules:["El sistema de vigilancia/control del gobierno tiene reglas fijas que no se pueden burlar f\xE1cilmente.","La escasez de recursos (comida, agua, energ\xEDa) es un l\xEDmite duro para los personajes.","Las consecuencias de la desobediencia deben ser consistentes y brutales.","La estratificaci\xF3n social dicta acceso a recursos y libertades."],tracked_attributes:["social_tier","ration_level","surveillance_status","resistance_affiliation"],relationship_types:["CONTROLS","RESISTS","INFORMANT_FOR","PROTECTS","TRADES_WITH"]},romance:{focus:"Niveles de intimidad, Secretos compartidos, Estado emocional, Malentendidos, Obst\xE1culos Externos.",critical_rules:["El nivel de intimidad no puede saltar o retroceder sin un evento narrativo mayor.","Los secretos revelados no pueden ser 'des-conocidos'.","La 'Qu\xEDmica' o tensi\xF3n emocional debe ser monitoreada y mantenida.","Los obst\xE1culos para estar juntos deben ser l\xF3gicos y no simples coincidencias repetitivas."],tracked_attributes:["relationship_status","intimacy_level","secrets_known","emotional_state","obstacles"],relationship_types:["LOVES","ATTRACTED_TO","EX_OF","RIVAL_FOR","CONFIDED_IN","JEALOUS_OF"]},horror:{focus:"Reglas del Monstruo/Entidad, Nivel de Aislamiento, Salud Mental, Recursos de Supervivencia.",critical_rules:["La entidad sobrenatural debe seguir sus propias reglas (ej: no puede cruzar agua, solo sale de noche).","El aislamiento (sin se\xF1al, sin salida) no puede romperse m\xE1gicamente.","Las reacciones de miedo deben ser realistas; los personajes no se vuelven inmunes al terror sin raz\xF3n.","Los recursos de supervivencia (luz, armas, refugio) son finitos."],tracked_attributes:["sanity_level","is_infected","survival_resources","knows_entity_weakness"],relationship_types:["HUNTED_BY","PROTECTS","TRUSTS","SUSPECTS","SACRIFICED"]},adventure:{focus:"Geograf\xEDa, Suministros/Inventario, Estado F\xEDsico/Heridas, El 'Reloj' (Tiempo L\xEDmite).",critical_rules:["Las heridas f\xEDsicas reducen la capacidad del personaje y no sanan instant\xE1neamente.","El inventario es limitado; no pueden sacar objetos que no empacaron.","La geograf\xEDa y el clima dictan la velocidad de movimiento.","Los plazos y fechas l\xEDmite deben respetarse."],tracked_attributes:["physical_condition","injuries","inventory","location","deadline"],relationship_types:["TRAVELLING_WITH","GUIDES","PURSUES","RESCUES","COMPETES_WITH"]},thriller:{focus:"Tensi\xF3n Constante, Amenazas F\xEDsicas, Conspiraciones, Cuenta Regresiva.",critical_rules:["Las heridas tienen consecuencias reales en la capacidad del personaje.","Los antagonistas deben tener motivaciones coherentes y no ser malvados sin raz\xF3n.","La escalada de tensi\xF3n debe ser progresiva y justificada.","Los recursos (munici\xF3n, aliados, tiempo) son finitos.","Las identidades y lealtades establecidas no cambian sin justificaci\xF3n."],tracked_attributes:["allegiance","injuries","resources","known_threats","deadline"],relationship_types:["PURSUES","ALLIED_WITH","BETRAYS","PROTECTS","THREATENS"]}}});var D2={};wr(D2,{UniversalConsistencyAgent:()=>fy,universalConsistencyAgent:()=>co});var fy,co,nI=G(()=>{"use strict";As();k2();fy=class{client;model;constructor(){this.client=new Ve({apiKey:process.env.DEEPSEEK_API_KEY,baseURL:"https://api.deepseek.com"}),this.model="deepseek-chat"}generateConstraints(e,t,n,a,s,o,i){let u=hy(e),c=["ojos","eyes","eye_color","altura","height"],p=["pelo","hair","cabello","barba","beard","peso","weight","build","cicatriz","scar","tatuaje","tattoo","complexion","piel","skin"],m=t.length>0?t.filter(D=>D.type==="CHARACTER").map(D=>{let J=Object.entries(D.attributes||{}),W=J.filter(([oe])=>c.some(ce=>oe.toLowerCase().includes(ce))),de=J.filter(([oe])=>p.some(ce=>oe.toLowerCase().includes(ce))&&!c.some(ce=>oe.toLowerCase().includes(ce))),ne=J.filter(([oe])=>!c.some(ce=>oe.toLowerCase().includes(ce))&&!p.some(ce=>oe.toLowerCase().includes(ce))&&!oe.endsWith("_INMUTABLE")),le=`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`;return le+=`[FICHA] ${D.name.toUpperCase()} (${D.status})`,le+=`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550`,W.length>0&&(le+=`
[INMUTABLE] (no puede cambiar):`,W.forEach(([oe,ce])=>{let se=oe.replace("_INMUTABLE","").replace(/_/g," ");le+=`
   - ${se}: ${ce}`})),de.length>0&&(le+=`
[ACTUAL] (puede cambiar SI SE EXPLICA):`,de.forEach(([oe,ce])=>{let se=oe.replace("_INMUTABLE","").replace(/_/g," ");le+=`
   - ${se}: ${ce}`})),W.length===0&&de.length===0&&(le+=`
[DESCRIPCION FISICA]: (No establecida - puedes describirla, sera registrada)`),ne.length>0&&(le+=`

[PERFIL]:`,ne.forEach(([oe,ce])=>{typeof ce=="string"&&ce.length<200&&(le+=`
   - ${oe}: ${ce}`)})),le}).join(`
`):"(Sin personajes registrados a\xFAn - las descripciones f\xEDsicas ser\xE1n extra\xEDdas autom\xE1ticamente)",f=t.filter(D=>D.type==="LOCATION").length>0?t.filter(D=>D.type==="LOCATION").map(D=>{let J=Object.entries(D.attributes||{}),W=`
[LUGAR] ${D.name.toUpperCase()}`;W+=`
   Estado: ${D.status}`;let de=J.filter(([le])=>["descripcion","description","atmosfera","atmosphere","tipo","type","caracteristicas","features","acceso","access","distancia","distance"].some(oe=>le.toLowerCase().includes(oe)));de.length>0&&de.forEach(([le,oe])=>{let ce=le.replace("_INMUTABLE","").replace(/_/g," ");W+=`
   - ${ce}: ${oe}`});let ne=J.find(([le])=>le.toLowerCase().includes("ocupantes")||le.toLowerCase().includes("occupants"));return ne&&(W+=`
   Ocupantes actuales: ${ne[1]}`),W}).join(`
`):"",g=t.filter(D=>D.type==="CHARACTER"&&D.attributes).map(D=>{let J=D.attributes,W=J.ubicacion_actual||J.current_location||J.location,de=D.lastSeenChapter;return W?`   - ${D.name}: ${W} (desde Cap ${de||"?"})`:null}).filter(Boolean),y=g.length>0?`
[POSICION ACTUAL DE PERSONAJES]:
${g.join(`
`)}
   ADVERTENCIA: Los personajes NO pueden cambiar de ubicacion sin mostrar el desplazamiento`:"",C=n.length>0?n.map(D=>`- [${D.category||"GENERAL"}] ${D.ruleDescription}`).join(`
`):"(Sin reglas establecidas a\xFAn)",A=a.length>0?a.map(D=>`- ${D.subject} --[${D.relationType}]--> ${D.target}`).join(`
`):"(Sin relaciones registradas)",T=t.filter(D=>D.type==="OBJECT"),E=T.length>0?T.map(D=>{let J=D.attributes||{},W=J.propietario||J.owner||J.poseedor||"desconocido",de=J.ubicacion||J.location||"desconocida",ne=J.descripcion||J.description||"";return`   [OBJ] ${D.name}: en posesion de ${W} | ubicacion: ${de}${ne?` | ${ne}`:""}`}).join(`
`):"",d=t.filter(D=>D.type==="CHARACTER"&&D.attributes).map(D=>{let J=D.attributes,W=J.estado_emocional||J.emotional_state||J.emocion,de=J.trauma||J.duelo||J.grief;if(W||de){let ne=`   [EMO] ${D.name}: `;return W&&(ne+=`${W}`),de&&(ne+=` | TRAUMA: ${de}`),ne}return null}).filter(Boolean),l=d.length>0?`
[ESTADOS EMOCIONALES ACTIVOS]:
${d.join(`
`)}
   ADVERTENCIA: Las emociones intensas persisten - no pueden estar felices tras una tragedia sin transicion`:"",h=t.filter(D=>D.type==="SECRET"),v=t.filter(D=>D.type==="CHARACTER"&&D.attributes).map(D=>{let J=D.attributes,W=J.conoce||J.knows||J.sabe,de=J.ignora||J.doesnt_know||J.no_sabe;if(W||de){let ne=`   [INFO] ${D.name}:`;return W&&(ne+=`
      SABE: ${W}`),de&&(ne+=`
      NO SABE: ${de}`),ne}return null}).filter(Boolean),S=h.length>0||v.length>0?`
[SECRETOS Y CONOCIMIENTO]:
${h.map(D=>`   [SECRETO] ${D.name}: ${D.attributes?.descripcion||D.attributes?.description||""} (conocido por: ${D.attributes?.conocido_por||D.attributes?.known_by||"nadie"})`).join(`
`)}${v.length>0?`
`+v.join(`
`):""}
   ADVERTENCIA: Un personaje NO puede actuar sobre informacion que NO posee`:"",R=t.filter(D=>D.type==="NARRATIVE_PROMISE"||D.type==="FORESHADOWING"),x=R.length>0?`
[PROMESAS NARRATIVAS - Chekhov's Gun]:
${R.map(D=>{let J=D.attributes||{};return`   ${J.resuelto||J.resolved?"[OK]":"[PENDIENTE]"} ${D.name}: ${J.descripcion||J.description||""} (Cap ${D.lastSeenChapter||"?"})`}).join(`
`)}
   ADVERTENCIA: Elementos mencionados deben cumplir su proposito narrativo`:"",w=a.filter(D=>["PROMETIO","PROMISE","ACUERDO","AGREEMENT","MINTIO","LIED","JURO","SWORE"].some(J=>D.relationType.toUpperCase().includes(J))),O=w.length>0?`
[ACUERDOS, PROMESAS Y MENTIRAS]:
${w.map(D=>`   ${D.relationType.toUpperCase().includes("MINT")||D.relationType.toUpperCase().includes("LIE")?"[MENTIRA]":"[ACUERDO]"} ${D.subject} -> ${D.target}: ${D.relationType}${D.meta?.detalle?` (${D.meta.detalle})`:""}`).join(`
`)}
   ADVERTENCIA: Las promesas rotas tienen consecuencias. Las mentiras deben mantenerse consistentes.`:"",I=u.critical_rules.map(D=>`- ${D}`).join(`
`),_="";o&&(_=`
[COHERENCIA TEMPORAL] (OBLIGATORIA):
`,o.previous_chapter&&(_+=`- Capitulo anterior: ${o.previous_chapter.day}, ${o.previous_chapter.time_of_day}`,o.previous_chapter.location&&(_+=` en ${o.previous_chapter.location}`),_+=`
`),o.current_chapter&&(_+=`- Este capitulo (${s}): ${o.current_chapter.day}, ${o.current_chapter.time_of_day}`,o.current_chapter.location&&(_+=` en ${o.current_chapter.location}`),_+=`
`),o.travel_times&&o.travel_times.length>0&&(_+=`
[TIEMPOS DE VIAJE] (respetar para transiciones):
`,o.travel_times.slice(0,8).forEach(D=>{let J=[D.by_car&&`coche: ${D.by_car}`,D.by_plane&&`avion: ${D.by_plane}`,D.by_train&&`tren: ${D.by_train}`].filter(Boolean).join(", ");_+=`- ${D.from} -> ${D.to}: ${J}
`})));let N="";i&&i.length>0&&(N=`
[ESTADO FISICO DE PERSONAJES AL INICIO DEL CAPITULO]:
`,i.forEach(D=>{N+=`- ${D.character}:
`,D.current_location&&(N+=`    Ubicacion: ${D.current_location}
`),D.physical_state&&(N+=`    Estado fisico: ${D.physical_state}
`),D.active_injuries&&D.active_injuries.length>0&&(N+=`    [LESIONES ACTIVAS]: ${D.active_injuries.join(", ")}
`,N+=`       -> Estas lesiones LIMITAN sus acciones fisicas
`),D.key_possessions&&D.key_possessions.length>0&&(N+=`    Posesiones: ${D.key_possessions.join(", ")}
`)}));let P=["dead","muerto","fallecido","deceased","killed","asesinado","ejecutado"],L=t.filter(D=>{if(D.type!=="CHARACTER")return!1;let J=(D.status||"").toLowerCase(),W=D.attributes||{},de=(W.estado_vital||W.vital_status||W.status||"").toString().toLowerCase(),ne=W.capitulo_muerte||W.death_chapter;return P.some(le=>J.includes(le)||de.includes(le))||ne}),j="";L.length>0&&(j=`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551  [ALERTA CRITICA] PERSONAJES FALLECIDOS - NO PUEDEN APARECER     \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
`,L.forEach(D=>{let J=D.attributes||{},W=J.capitulo_muerte||J.death_chapter||"?",de=J.causa_muerte||J.death_cause||J.cause_of_death||"no especificada";j+=`\u2551  [MUERTO] ${D.name.toUpperCase().padEnd(20)} | Muri\xF3 Cap ${W} | Causa: ${de.substring(0,30)}
`}),j+=`\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  PROHIBIDO: Estos personajes NO pueden hablar, actuar, aparecer  \u2551
\u2551  NI ser mencionados como si estuvieran vivos despu\xE9s de su       \u2551
\u2551  muerte. Solo pueden aparecer en flashbacks CLARAMENTE marcados. \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
`);let $=[{keywords:["afon\xEDa","afonia","mudo","muda","no puede hablar","no habla","sin voz","aphonia","mute","cannot speak","voiceless","speechless","psic\xF3gena"],type:"SPEECH"},{keywords:["ciego","ciega","ceguera","no puede ver","sin vision","blind","blindness","cannot see"],type:"VISION"},{keywords:["sordo","sorda","sordera","no puede oir","no oye","deaf","deafness","cannot hear"],type:"HEARING"},{keywords:["paralizado","paralizada","paralisis","no puede caminar","silla de ruedas","paralyzed","paralysis","wheelchair","cannot walk"],type:"MOBILITY"},{keywords:["amnesia","no recuerda","perdio la memoria","memory loss","cannot remember"],type:"MEMORY"}],U=D=>{let J=D.toLowerCase();for(let W of $)if(W.keywords.some(de=>J.includes(de)))return W.type;return null},k=["CHARACTER_TRAIT","PHYSICAL_ATTRIBUTE","DISABILITY","CONDICION_FISICA"],V=[];n.forEach(D=>{if(D.category&&k.some(J=>D.category.toUpperCase().includes(J))){let J=U(D.ruleDescription);J&&V.push({rule:D,constraintType:J})}else{let J=U(D.ruleDescription);J&&V.push({rule:D,constraintType:J})}});let Q=["condicion","discapacidad","disability","trait","estado_fisico","physical_state","voz","voice","habla","speech","vision","oido","hearing"],te=[];t.filter(D=>D.type==="CHARACTER").forEach(D=>{let J=D.attributes||{};Object.entries(J).forEach(([W,de])=>{let ne=W.toLowerCase();if(Q.some(le=>ne.includes(le))){let le=U(String(de));le&&te.push({name:D.name,constraint:W.replace(/_/g," ").toUpperCase(),details:String(de),constraintType:le})}})});let F=new Set;V.forEach(D=>F.add(D.constraintType)),te.forEach(D=>F.add(D.constraintType));let ae="";return(V.length>0||te.length>0)&&(ae=`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551  [RESTRICCIONES CRITICAS DE PERSONAJES] - VIOLACION = RECHAZO AUTOMATICO    \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
`,V.forEach(({rule:D})=>{let J=D.ruleDescription.length>75?D.ruleDescription.substring(0,72)+"...":D.ruleDescription;ae+=`\u2551  [!] ${J.padEnd(72)}\u2551
`}),te.forEach(D=>{let J=`${D.name}: ${D.constraint} = ${D.details}`,W=J.length>72?J.substring(0,69)+"...":J;ae+=`\u2551  [!] ${W.padEnd(72)}\u2551
`}),F.has("SPEECH")&&(ae+=`\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  ALTERNATIVAS para personajes que NO PUEDEN HABLAR (afon\xEDa/mudez):          \u2551
\u2551  - Gestos, se\xF1as, lenguaje corporal, expresiones faciales                   \u2551
\u2551  - Comunicacion escrita (notas, mensajes, escribir en superficies)          \u2551
\u2551  - Movimientos de cabeza (asentir, negar), apuntar con el dedo              \u2551
\u2551  - Sonidos no verbales (sollozos, jadeos) - NUNCA palabras articuladas      \u2551
\u2551  PROHIBIDO: Susurros, palabras entrecortadas, "articular", "musitar", "dijo"\u2551
`),F.has("VISION")&&(ae+=`\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  ALTERNATIVAS para personajes CIEGOS:                                       \u2551
\u2551  - Describir otros sentidos (tacto, oido, olfato) - NUNCA "vio", "miro"     \u2551
\u2551  - Orientacion por sonidos, texturas, olores familiares                     \u2551
\u2551  PROHIBIDO: "sus ojos captaron", "observo", "contemplo", "diviso"           \u2551
`),F.has("HEARING")&&(ae+=`\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  ALTERNATIVAS para personajes SORDOS:                                       \u2551
\u2551  - Lectura de labios, lenguaje de signos, vibraciones                       \u2551
\u2551  PROHIBIDO: "escucho", "oyo", referencias a sonidos percibidos              \u2551
`),F.has("MOBILITY")&&(ae+=`\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  ALTERNATIVAS para personajes con MOVILIDAD REDUCIDA:                       \u2551
\u2551  - Silla de ruedas, muletas, ayuda de otros personajes                      \u2551
\u2551  PROHIBIDO: "camino", "corrio", "se levanto" sin asistencia                 \u2551
`),ae+=`\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
`),`
[SISTEMA DE CONSISTENCIA UNIVERSAL ACTIVO] (${e.toUpperCase()})
===================================================================

ESCRIBIENDO CAPITULO ${s}. Debes respetar ESTRICTAMENTE la Base de Datos de Verdad.
El lector notara cualquier contradiccion. Las violaciones causaran RECHAZO AUTOMATICO.

FOCO DEL GENERO: ${u.focus}
${j}
${ae}
${_}
${N}
[FICHAS DE PERSONAJES]:
${m}
${y}
${l}
${f?`
[LOCALIZACIONES CONOCIDAS]:
${f}
`:""}
${E?`
[OBJETOS IMPORTANTES] (Tracking de posesiones):
${E}
   ADVERTENCIA: Un personaje NO puede usar un objeto que no posee
`:""}
[RELACIONES ENTRE PERSONAJES]:
${A}
${O}
${S}
${x}

[HECHOS INMUTABLES ESTABLECIDOS]:
${C}

[REGLAS CRITICAS DEL GENERO] (${e}):
${I}

===================================================================
REGLAS DE CONSISTENCIA NARRATIVA:
- Un personaje NO puede estar en dos lugares al mismo tiempo
- Para cambiar de ubicacion, MOSTRAR el desplazamiento (caminando, en coche, etc.)
- Respetar tiempos de viaje realistas entre ubicaciones
- Las descripciones de lugares deben ser CONSISTENTES en toda la novela
- Si un lugar tiene caracteristicas establecidas (color paredes, distribucion), mantenerlas
- Un personaje NO puede usar informacion que NO tiene
- Los estados emocionales persisten - transiciones realistas
- Las promesas y mentiras deben ser consistentes
- Los objetos no aparecen magicamente - tracking de posesiones

REGLAS DE COHERENCIA TEMPORAL (BLOQUEANTES si se violan):
- Las referencias temporales relativas ("hace X d\xEDas", "ayer") se calculan desde
  el d\xEDa narrativo ACTUAL, no desde la perspectiva del lector
- Si la cronolog\xEDa dice D\xEDa 3, "hace una semana" es IMPOSIBLE si la trama empez\xF3 hace 3 d\xEDas
- Los desplazamientos entre ciudades requieren tiempo proporcional a la distancia
- Las heridas graves (fracturas, quemaduras) NO se curan de un cap\xEDtulo a otro sin elipsis
- Un cap\xEDtulo que termina "de noche" no puede ser seguido por uno que empieza "esa misma ma\xF1ana"
- Los eventos que un personaje recuerda DEBEN haber ocurrido en cap\xEDtulos ANTERIORES
- Las estaciones del a\xF1o deben ser coherentes con el paso del tiempo narrativo
===================================================================
`}async validateChapter(e,t,n,a,s,o,i,u){let c=hy(t),p="";(i||u)&&(p=`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
L\xCDNEA TEMPORAL ACUMULADA (VERIFICACI\xD3N OBLIGATORIA):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`,u&&u.length>0&&(p+=`CRONOLOG\xCDA REAL DE LA NOVELA:
`,u.forEach(f=>{p+=`  Cap ${f.chapter}: ${f.narrativeTime}${f.location?` en ${f.location}`:""}
`}),p+=`
`),i?.current_chapter&&(p+=`ESTE CAP\xCDTULO (${o}) DEBER\xCDA SER: ${i.current_chapter.day}, ${i.current_chapter.time_of_day}${i.current_chapter.location?` en ${i.current_chapter.location}`:""}
`),i?.previous_chapter&&(p+=`CAP\xCDTULO ANTERIOR FUE: ${i.previous_chapter.day}, ${i.previous_chapter.time_of_day}${i.previous_chapter.location?` en ${i.previous_chapter.location}`:""}
`),i?.travel_times&&i.travel_times.length>0&&(p+=`
TIEMPOS DE VIAJE CAN\xD3NICOS:
`,i.travel_times.forEach(f=>{let g=[f.by_car&&`coche: ${f.by_car}`,f.by_plane&&`avi\xF3n: ${f.by_plane}`,f.by_train&&`tren: ${f.by_train}`].filter(Boolean).join(", ");p+=`  ${f.from} \u2192 ${f.to}: ${g}
`})),p+=`
VERIFICA que el texto del cap\xEDtulo NO contradiga esta cronolog\xEDa.
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`);let m=`Act\xFAa como un Supervisor de Continuidad experto en ${t}.
Tu trabajo es detectar errores GRAVES Y EVIDENTES, incluyendo VIOLACIONES TEMPORALES.

PRINCIPIO FUNDAMENTAL: EN CASO DE DUDA, APROBAR. Solo rechazar por errores INEQU\xCDVOCOS.

BASE DE DATOS DE REFERENCIA:

ENTIDADES:
${JSON.stringify(n,null,2)}

REGLAS:
${JSON.stringify(a,null,2)}

RELACIONES:
${JSON.stringify(s,null,2)}
${p}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

CAP\xCDTULO ${o} A EVALUAR:
"""
${e.substring(0,12e3)}
"""
${e.length>12e3?"... (truncado)":""}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

CRITERIOS DE ERROR CR\xCDTICO (estos bloquean):

1. MUERTO QUE ACT\xDAA: Un personaje expl\xEDcitamente muerto aparece vivo y actuando
2. BILOCACI\xD3N: El mismo personaje en DOS lugares F\xCDSICAMENTE al MISMO tiempo
3. CAMBIO FISICO IMPOSIBLE: Ojos azules a verdes, pelo rubio a negro (sin explicacion magica/tinte)
4. CONTRADICCI\xD3N DIRECTA DE TEXTO: El texto dice "A" y luego dice "no-A" sin justificaci\xF3n
5. INCONSISTENCIA DE EDAD: Edad del personaje no coincide con lo establecido
6. OBJETO PERSONAL INCONSISTENTE: Joya/anillo/reloj que estaba presente ahora no lo est\xE1 sin explicaci\xF3n
7. CONOCIMIENTO IMPOSIBLE: Personaje sabe informaci\xF3n que no ha obtenido en ninguna escena anterior
8. VIOLACI\xD3N TEMPORAL GRAVE: El texto contradice la l\xEDnea temporal establecida:
   - "Hace una semana" cuando seg\xFAn la cronolog\xEDa solo han pasado 2 d\xEDas
   - Mencionar que es "lunes por la ma\xF1ana" cuando el cap\xEDtulo anterior termin\xF3 en "mi\xE9rcoles por la noche" sin time skip
   - Eventos que ocurren ANTES de que hayan sucedido en la cronolog\xEDa
   - Personaje viajando 500km instant\xE1neamente sin transici\xF3n temporal
   - Confusi\xF3n de orden d\xEDa/noche dentro del mismo cap\xEDtulo
9. RUPTURA DE HILO NARRATIVO: Un evento clave del cap\xEDtulo anterior (promesa, peligro, herida, descubrimiento) es completamente ignorado sin justificaci\xF3n

IMPORTANTE - NO SON ERRORES CR\xCDTICOS:
- Variaciones de voz/habla (susurros, ronquera, afon\xEDa temporal)
- Cambios emocionales o de comportamiento
- Detalles menores de vestimenta o apariencia
- Interpretaciones ambiguas de reglas
- Evoluci\xF3n natural de personajes
- Diferencias estil\xEDsticas en descripciones
- Peque\xF1as imprecisiones temporales ("amanecer" vs "primera hora")

TAMBI\xC9N EXTRAE (siempre, incluso si el cap\xEDtulo es v\xE1lido):
- Nuevos hechos importantes para futuros cap\xEDtulos
- Nuevas relaciones reveladas
- Cambios de estado (ubicaci\xF3n, heridas, muerte)

EXTRACCI\xD3N DETALLADA (usar entityType correspondiente):

0. [CRITICO] MUERTES DE PERSONAJES: entityType="CHARACTER"
   Si un personaje MUERE en este cap\xEDtulo, OBLIGATORIO registrar:
   update: { 
     "estado_vital": "MUERTO",
     "capitulo_muerte": ${o},
     "causa_muerte": "descripci\xF3n breve de c\xF3mo muri\xF3"
   }
   ADEM\xC1S agregar en newRules:
   { "ruleDescription": "[NOMBRE] est\xE1 MUERTO desde el cap\xEDtulo ${o}. NO puede aparecer vivo en cap\xEDtulos posteriores.", "category": "DEATH_EVENT" }

1. DETALLES F\xCDSICOS: entityType="PHYSICAL_TRAIT"
   Color de ojos, pelo, altura, edad, cicatrices, tatuajes

1b. [NUEVO] EDAD DEL PERSONAJE: entityType="CHARACTER"
   Si se menciona la edad de un personaje, registrar OBLIGATORIAMENTE:
   update: { "edad": n\xFAmero, "capitulo_edad_establecida": ${o} }
   CR\xCDTICO: La edad debe ser consistente en toda la novela (salvo time skips expl\xEDcitos)

1c. [NUEVO] OBJETOS PERSONALES PERSISTENTES: entityType="PERSONAL_ITEM"
   Anillos, relojes, collares, pulseras, joyas que un personaje LLEVA habitualmente
   update: { 
     "propietario": "nombre del personaje",
     "descripcion": "anillo de oro con rub\xED en dedo anular izquierdo",
     "estado": "presente" o "ausente" o "perdido",
     "capitulo_primera_mencion": ${o}
   }
   CR\xCDTICO: Si un personaje lleva un anillo distintivo, debe seguir llev\xE1ndolo (o explicar por qu\xE9 no)

2. LOCALIZACIONES: entityType="LOCATION"
   Incluir: descripcion, atmosfera, caracteristicas

3. CAMBIOS DE UBICACI\xD3N: entityType="CHARACTER"
   update: { "ubicacion_actual": "nuevo lugar" }

4. OBJETOS IMPORTANTES: entityType="OBJECT"
   Armas, llaves, documentos, joyas, evidencias
   update: { "propietario": "qui\xE9n lo tiene", "ubicacion": "d\xF3nde est\xE1", "descripcion": "qu\xE9 es" }

5. ESTADOS EMOCIONALES: entityType="CHARACTER"
   update: { "estado_emocional": "emoci\xF3n actual", "trauma": "si hay duelo/trauma activo" }

6. SECRETOS/INFORMACI\xD3N: entityType="SECRET"
   update: { "descripcion": "el secreto", "conocido_por": "qui\xE9n lo sabe" }
   O para conocimiento de personaje: entityType="CHARACTER"
   update: { "conoce": "qu\xE9 sabe", "ignora": "qu\xE9 NO sabe" }

7. PROMESAS NARRATIVAS (Chekhov): entityType="NARRATIVE_PROMISE"
   Elementos mencionados que deben resolverse
   update: { "descripcion": "qu\xE9 se promete", "resuelto": false }

8. ACUERDOS/MENTIRAS: Usar newRelationships con relationType:
   "PROMETIO_A", "MINTIO_A", "JURO_A", "ACORDO_CON"
   meta: { "detalle": "descripci\xF3n del acuerdo/mentira" }

RESPONDE EN JSON:
{
  "isValid": boolean,
  "criticalError": "Descripci\xF3n del error cr\xEDtico que BLOQUEA la aprobaci\xF3n, o null si no hay",
  "correctionInstructions": "INSTRUCCIONES ESPEC\xCDFICAS Y DETALLADAS para corregir el error. Ejemplo: 'El personaje X tiene afon\xEDa, pero en el texto dice que susurra. SOLUCI\xD3N: Reemplazar el di\xE1logo de X por comunicaci\xF3n no verbal (gestos, escribir notas, asentir). Localizar la frase exacta: [cita del texto problem\xE1tico] y cambiarla por [alternativa correcta].' Si no hay error, dejar null.",
  "warnings": ["Lista de advertencias menores que no bloquean pero deben corregirse"],
  "newFacts": [
    { "entityName": "Nombre", "entityType": "CHARACTER|LOCATION|OBJECT|EVIDENCE", "update": { "atributo": "valor" } }
  ],
  "newRules": [
    { "ruleDescription": "Hecho inmutable establecido en este cap\xEDtulo", "category": "TIMELINE|ALIBI|CAUSE_OF_DEATH|etc" }
  ],
  "newRelationships": [
    { "subject": "Personaje1", "target": "Personaje2", "relationType": "TIPO", "meta": {} }
  ]
}

IMPORTANTE SOBRE correctionInstructions:
- Debe ser MUY ESPEC\xCDFICO: incluir la frase exacta del texto que viola la regla
- Debe proponer una ALTERNATIVA CONCRETA que respete la regla
- Si el personaje no puede hablar, sugerir gestos, se\xF1as, o comunicaci\xF3n escrita
- Si hay inconsistencia f\xEDsica (ej: ojos), indicar el color correcto
- Si hay error temporal/geogr\xE1fico, indicar la correcci\xF3n exacta`;try{let g=(await this.client.chat.completions.create({model:this.model,messages:[{role:"user",content:m}],temperature:.1,response_format:{type:"json_object"}})).choices[0]?.message?.content||"{}",y=JSON.parse(g);return{isValid:y.isValid??!0,criticalError:y.criticalError||void 0,correctionInstructions:y.correctionInstructions||void 0,warnings:y.warnings||[],newFacts:y.newFacts||[],newRules:y.newRules||[],newRelationships:y.newRelationships||[]}}catch(f){return console.error("[UniversalConsistency] Error validando cap\xEDtulo:",f),{isValid:!0,warnings:["Error en validaci\xF3n de consistencia - continuando con fallback optimista"]}}}async extractInitialEntities(e,t,n,a){let s=hy(n),o=[],i=[],u=["eyes","eye_color","ojos","hair","hair_color","cabello","height","altura","skin","piel","build","complexion","age","edad"];for(let c of e){let p={},m=c.name||c.nombre||"Personaje desconocido";c.role&&(p.role=c.role),c.profile&&(p.profile=c.profile);let f=c.appearance||c.aparienciaInmutable||c.apariencia;if(f)if(typeof f=="object"&&f!==null){for(let[g,y]of Object.entries(f))if(y&&typeof y=="string"){let C=g.toLowerCase();u.includes(C)?(p[`${g}_INMUTABLE`]=y,i.push({projectId:a,ruleDescription:`${m} tiene ${g} = "${y}" (INMUTABLE - NUNCA CAMBIAR)`,category:"PHYSICAL_ATTRIBUTE",isActive:!0,sourceChapter:0})):p[g]=y}}else typeof f=="string"&&(p.appearance=f);for(let g of u)c[g]&&!p[`${g}_INMUTABLE`]&&(p[`${g}_INMUTABLE`]=c[g],i.push({projectId:a,ruleDescription:`${m} tiene ${g} = "${c[g]}" (INMUTABLE - NUNCA CAMBIAR)`,category:"PHYSICAL_ATTRIBUTE",isActive:!0,sourceChapter:0}));for(let g of s.tracked_attributes)c[g]!==void 0&&(p[g]=c[g]);o.push({projectId:a,name:m,type:"CHARACTER",attributes:p,status:c.isAlive===!1?"dead":"active",lastSeenChapter:0})}for(let c of t)c.rule&&i.push({projectId:a,ruleDescription:c.rule,category:c.category||"WORLD_RULE",isActive:!0,sourceChapter:0});for(let c of s.critical_rules)i.push({projectId:a,ruleDescription:c,category:"GENRE_RULE",isActive:!0,sourceChapter:null});return{entities:o,rules:i}}formatValidationResultForRewrite(e){if(e.isValid)return"";let t=`[RECHAZO] - INCONSISTENCIA DE CONTINUIDAD

ERROR CR\xCDTICO: ${e.criticalError}

`;return e.warnings&&e.warnings.length>0&&(t+=`ADVERTENCIAS ADICIONALES:
${e.warnings.map(n=>`- ${n}`).join(`
`)}

`),t+=`INSTRUCCIONES DE CORRECCI\xD3N:
1. Lee cuidadosamente el error cr\xEDtico arriba
2. Identifica las l\xEDneas espec\xEDficas que violan la continuidad
3. Reescribe SOLO las secciones problem\xE1ticas, manteniendo el resto
4. Verifica que la correcci\xF3n no introduzca nuevas inconsistencias

NO inventes explicaciones complicadas. Si un personaje estaba en un lugar, debe seguir ah\xED.
Si un personaje muri\xF3, no puede actuar. Si una coartada fue verificada, es inmutable.`,t}},co=new fy});var bre,vre,Ere,M2,Cre,Lc,gy=G(()=>{"use strict";It();bre=`
Eres un LECTOR CONSUMIDOR habitual del g\xE9nero que se te indica. NO eres un editor t\xE9cnico ni un acad\xE9mico literario.
Eres alguien que ha pagado dinero por este libro y quiere disfrutar de una buena historia.

Tu misi\xF3n es evaluar si esta novela MERECE SER COMPRADA, LE\xCDDA DE UNA SENTADA y RECOMENDADA a amigos.
TU OBJETIVO: Asegurar que la novela alcance puntuaci\xF3n 10/10 (OBRA MAESTRA - nivel "no pude parar de leer").

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F4DA} TU PERFIL COMO LECTOR CONSUMIDOR \u{1F4DA}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Imagina que eres:
- Un lector de 35 a\xF1os que lee 2-3 novelas al mes en este g\xE9nero
- Alguien que compra libros en Amazon, Casa del Libro o FNAC
- Un lector que deja rese\xF1as honestas y recomienda libros en redes sociales
- Una persona que abandona libros aburridos despu\xE9s de 50 p\xE1ginas

LO QUE TE IMPORTA COMO LECTOR:
- \xBFMe engancha desde el principio? (Si no me atrapa en el cap\xEDtulo 1-2, lo dejo)
- \xBFMe importan los personajes? (\xBFQuiero que ganen? \xBFMe duele cuando sufren?)
- \xBFQuiero saber qu\xE9 pasa despu\xE9s? (\xBFPaso las p\xE1ginas compulsivamente?)
- \xBFEl final me satisface? (\xBFVali\xF3 la pena el viaje?)

LO QUE NO TE IMPORTA COMO LECTOR:
- Tecnicismos literarios o an\xE1lisis estructural
- Si el autor usa met\xE1foras perfectas
- Si hay alguna repetici\xF3n l\xE9xica ocasional
- Peque\xF1as inconsistencias que no afectan la historia

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F525} CRITERIOS DE UN BESTSELLER - LO QUE HACE QUE RECOMIENDE EL LIBRO \u{1F525}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Para que t\xFA, como lector, des 5 estrellas y recomiendes este libro:

\u2713 HOOK IRRESISTIBLE: "No pude dejar el libro despu\xE9s del primer cap\xEDtulo"
\u2713 GIROS SORPRENDENTES: "\xA1No me lo esperaba! Tuve que releer esa parte"
\u2713 ESCALADA DE TENSI\xD3N: "Cada vez se pon\xEDa mejor, m\xE1s intenso"
\u2713 CLIFFHANGERS EFECTIVOS: "Me qued\xE9 despierto hasta las 3am leyendo"
\u2713 CL\xCDMAX \xC9PICO: "El final me dej\xF3 sin aliento"
\u2713 RESONANCIA EMOCIONAL: "Llor\xE9/re\xED/grit\xE9 en voz alta"

Si ALGUNO de estos falla \u2192 m\xE1ximo 8 (buen libro, pero no lo recomendar\xEDa efusivamente)

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
TU PERSPECTIVA: COMPRADOR DE LIBROS
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Has pagado 18\u20AC por este libro y tienes tiempo limitado para leer. Eval\xFAa como consumidor:

1. ENGANCHE (\xBFQuiero seguir leyendo?)
   - \xBFEl pr\xF3logo/primer cap\xEDtulo me atrapa?
   - \xBFHay un gancho emocional que me hace querer saber m\xE1s?
   - \xBFLos finales de cap\xEDtulo me empujan al siguiente?

2. PERSONAJES (\xBFMe importan?)
   - \xBFEl protagonista tiene profundidad y contradicciones interesantes?
   - \xBFSus motivaciones son cre\xEDbles y humanas?
   - \xBFSufro con sus fracasos y celebro sus victorias?

3. TRAMA (\xBFTiene sentido y me sorprende?)
   - \xBFLos giros son sorprendentes PERO inevitables en retrospectiva?
   - \xBFLas soluciones se GANAN con esfuerzo, inteligencia y sacrificio? (sin deus ex machina)
   - \xBFEl cl\xEDmax es satisfactorio y proporcional al conflicto?
   - \xBFEl antagonista act\xFAa de forma inteligente y coherente, no comete errores convenientes?
   - \xBFCada resoluci\xF3n tiene un COSTO real para el protagonista?

4. ATM\xD3SFERA (\xBFMe transporta?)
   - \xBFSiento que estoy en ese mundo/\xE9poca?
   - \xBFLos detalles sensoriales son inmersivos sin ser excesivos?
   - \xBFEl tono es consistente con el g\xE9nero?

5. RITMO (\xBFFluye bien?)
   - \xBFHay momentos de tensi\xF3n equilibrados con momentos de respiro?
   - \xBFLas escenas de acci\xF3n son claras y emocionantes?
   - \xBFLos di\xE1logos suenan naturales para la \xE9poca/contexto?

6. CUMPLIMIENTO DEL G\xC9NERO
   - Thriller: \xBFHay tensi\xF3n constante y stakes claros?
   - Hist\xF3rico: \xBFLa ambientaci\xF3n es cre\xEDble y evocadora?
   - Rom\xE1ntico: \xBFLa qu\xEDmica entre personajes es palpable?
   - Misterio: \xBFLas pistas son justas y la soluci\xF3n satisfactoria?

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
ESCALA DE PUNTUACI\xD3N ESTRICTA (OBJETIVO: 10/10)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

10: OBRA MAESTRA - CERO issues de cualquier tipo. Perfecci\xF3n total. Hook irresistible, giros brillantes, 
    personajes inolvidables, cl\xEDmax perfecto. \xDANICO nivel que obtiene veredicto APROBADO autom\xE1ticamente.
9: EXCELENTE - Solo 1 issue menor. Muy cerca de la perfecci\xF3n pero falta algo. Veredicto: APROBADO_CON_RESERVAS.
8: MUY BUENO - 2 issues menores o 1 mayor. Publicable pero requiere pulido. Veredicto: REQUIERE_REVISION.
7: CORRECTO - 3+ issues menores o 2 mayores. Cumple pero no destaca. Veredicto: REQUIERE_REVISION.
6: FLOJO - 1 issue cr\xEDtico o 3+ mayores. Errores que sacan de la historia. Veredicto: REQUIERE_REVISION.
5 o menos: NO PUBLICABLE - M\xFAltiples issues cr\xEDticos o problemas graves. Veredicto: REQUIERE_REVISION.

REGLA ABSOLUTA: Solo das 10/10 si NO hay ning\xFAn issue de ning\xFAn tipo.
Cualquier issue (incluso menor) reduce autom\xE1ticamente la puntuaci\xF3n por debajo de 10.

IMPORTANTE - CAPACIDAD DE DAR 10/10:
Cuando un manuscrito ha sido corregido y NO encuentras problemas reales, DEBES dar 10/10.
No busques problemas inexistentes para justificar una puntuaci\xF3n menor.
Si el hook es irresistible, los giros sorprenden, la tensi\xF3n escala, los personajes emocionan,
y el cl\xEDmax satisface - entonces ES un 10/10. No te resistas a darlo.

SE\xD1ALES DE UN 10/10:
- No puedes identificar ning\xFAn issue concreto con evidencia textual
- La experiencia de lectura fue fluida y adictiva
- Todos los arcos est\xE1n cerrados satisfactoriamente
- No hay contradicciones, repeticiones excesivas ni deus ex machina
- El manuscrito cumple o supera las expectativas del g\xE9nero

Si todas estas se\xF1ales est\xE1n presentes, la puntuaci\xF3n DEBE ser 10/10.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F52C} CIRUG\xCDA L\xC1SER: INSTRUCCIONES DE CORRECCI\xD3N ULTRA-ESPEC\xCDFICAS \u{1F52C}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

\u26A0\uFE0F PROBLEMA CR\xCDTICO: El Ghostwriter reescribe cap\xEDtulos enteros si las instrucciones son vagas.
\u26A0\uFE0F TU TRABAJO: Dar instrucciones TAN espec\xEDficas que solo cambie 1-3 frases por issue.

FORMATO OBLIGATORIO PARA CADA ISSUE:

1. **elementos_a_preservar**: Lista TODO lo que funciona bien
   - "El di\xE1logo que empieza con \xAB\u2014No te atrevas a...\xBB es perfecto"
   - "La descripci\xF3n del amanecer en el segundo p\xE1rrafo est\xE1 muy bien"
   - "El flashback de la infancia (p\xE1rrafos 4-7) debe permanecer INTACTO"

2. **instrucciones_correccion**: CITA TEXTUAL + CAMBIO EXACTO
   Formato obligatorio:
   
   BUSCAR: "[cita textual del problema, 10-30 palabras]"
   REEMPLAZAR POR: "[texto corregido exacto]"
   
   O si es inserci\xF3n:
   DESPU\xC9S DE: "[cita de la frase anterior]"
   INSERTAR: "[texto nuevo a a\xF1adir]"
   
   O si es eliminaci\xF3n:
   ELIMINAR: "[cita textual exacta a eliminar]"

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
EJEMPLOS CONCRETOS
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

\u274C EJEMPLO MALO (causa reescritura total):
{
  "instrucciones_correccion": "Mejorar el enganche del final"
}

\u274C EJEMPLO MALO (demasiado vago):
{
  "instrucciones_correccion": "Cambiar el color de ojos de verde a azul"
}

\u2705 EJEMPLO BUENO (cirug\xEDa l\xE1ser):
{
  "elementos_a_preservar": "Todo el cap\xEDtulo est\xE1 bien excepto la frase indicada",
  "instrucciones_correccion": "BUSCAR: \xABSus ojos verdes brillaban bajo la luz de la luna\xBB
REEMPLAZAR POR: \xABSus ojos grises brillaban bajo la luz de la luna\xBB"
}

\u2705 EJEMPLO BUENO (repetici\xF3n l\xE9xica):
{
  "elementos_a_preservar": "El contenido emocional es perfecto, solo hay repetici\xF3n",
  "instrucciones_correccion": "BUSCAR: \xABsinti\xF3 un escalofr\xEDo recorrer su espalda\xBB (aparece 3 veces)
REEMPLAZAR:
- 1\xAA aparici\xF3n: mantener
- 2\xAA aparici\xF3n: \xABla piel se le eriz\xF3\xBB
- 3\xAA aparici\xF3n: \xABun temblor involuntario lo sacudi\xF3\xBB"
}

\u2705 EJEMPLO BUENO (a\xF1adir contexto):
{
  "elementos_a_preservar": "La escena de huida es perfecta, solo falta explicar c\xF3mo escap\xF3",
  "instrucciones_correccion": "DESPU\xC9S DE: \xABLa puerta se cerr\xF3 tras ella.\xBB
INSERTAR: \xABHab\xEDa aprovechado el cambio de guardia para deslizarse por la ventana del s\xF3tano, la misma que hab\xEDa dejado entreabierta tres d\xEDas antes.\xBB"
}

\u2705 EJEMPLO BUENO (cliffhanger):
{
  "elementos_a_preservar": "Todo el cap\xEDtulo. Solo a\xF1adir gancho final.",
  "instrucciones_correccion": "ELIMINAR la \xFAltima frase: \xABDecidi\xF3 que ma\xF1ana tomar\xEDa una decisi\xF3n.\xBB
REEMPLAZAR POR: \xABFue entonces cuando escuch\xF3 el disparo.\xBB"
}

CONSECUENCIA: Si das instrucciones sin CITAS TEXTUALES, el Ghostwriter reescribir\xE1 todo y crear\xE1 NUEVOS problemas. S\xE9 QUIR\xDARGICO con citas exactas.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PROBLEMAS QUE S\xCD AFECTAN LA EXPERIENCIA DEL LECTOR
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

CR\xCDTICOS (Rompen la inmersi\xF3n):
- Deus ex machina obvios que insultan la inteligencia del lector
- Contradicciones flagrantes que confunden (personaje muerto que aparece vivo)
- Resoluciones que no se ganan (el villano muere de un infarto conveniente)
- Personajes que act\xFAan contra su naturaleza establecida sin justificaci\xF3n
- Antagonistas que cometen errores est\xFApidos para facilitar la victoria del protagonista
- Aliados/recursos que aparecen "justo a tiempo" sin haber sido establecidos previamente
- Protagonista que resuelve problemas complejos sin esfuerzo ni consecuencias
- Informaci\xF3n crucial que aparece convenientemente sin haber sido sembrada

MAYORES (Molestan pero no destruyen):
- Repeticiones l\xE9xicas muy evidentes que distraen
- Ritmo irregular (cap\xEDtulos que arrastran sin prop\xF3sito)
- Subtramas abandonadas sin resoluci\xF3n
- Voz narrativa gen\xE9rica que no coincide con la gu\xEDa de estilo del autor
- Coincidencias menores (2\xAA coincidencia afortunada en la novela)
- Rescates parcialmente sembrados pero insuficientemente justificados

MENORES (El lector ni nota):
- Peque\xF1as inconsistencias de detalles secundarios
- Variaciones estil\xEDsticas sutiles

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F534} AN\xC1LISIS CR\xCDTICO MANUSCRITO-COMPLETO (OBLIGATORIO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Debes detectar y reportar estos problemas que SOLO se ven leyendo toda la novela:

1. **DECISIONES DE TRAMA CR\xCDTICAS (plot_decisions)**:
   - \xBFQui\xE9n es realmente el villano/antagonista? \xBFHay confusi\xF3n?
   - \xBFLas revelaciones son coherentes con lo establecido antes?
   - Ejemplo: Si Cap 32 muestra a X como el asesino pero Cap 39 dice que es Y \u2192 INCONSISTENTE
   - Para cada decisi\xF3n cr\xEDtica, indica si es CONSISTENTE o INCONSISTENTE a lo largo del manuscrito

2. **LESIONES PERSISTENTES (persistent_injuries)**:
   - Si un personaje sufre una lesi\xF3n grave (disparo, quemadura, hueso roto), \xBFaparece esa lesi\xF3n en cap\xEDtulos posteriores?
   - Ejemplo: Personaje recibe \xE1cido en el brazo (Cap 25) \u2192 debe mostrar discapacidad en Caps 26-50
   - Si la lesi\xF3n es IGNORADA despu\xE9s, reportar como inconsistencia CR\xCDTICA
   - Opciones de correcci\xF3n: (a) hacer la lesi\xF3n superficial, (b) a\xF1adir referencias a la discapacidad

3. **CAP\xCDTULOS HU\xC9RFANOS (orphan_chapters)**:
   - \xBFHay cap\xEDtulos que no aportan nada a la trama principal?
   - \xBFHay objetos/llaves/pistas introducidos que NUNCA se usan despu\xE9s?
   - Ejemplo: Cap 44 introduce una llave que nunca se usa \u2192 cap\xEDtulo hu\xE9rfano
   - Recomendar: eliminar, reubicar como flashback, o integrar en otro cap\xEDtulo

4. **CREDIBILIDAD NARRATIVA** (categor\xEDas: habilidad_injustificada, recurso_sin_origen, 
   coincidencia_excesiva, conocimiento_imposible, consecuencia_ignorada):
   
   a) HABILIDADES INJUSTIFICADAS:
      - \xBFEl protagonista hace algo que requiere formaci\xF3n especializada sin tenerla?
      - Ejemplo: Protagonista "periodista" hackea un servidor seguro \u2192 CR\xCDTICO
      - Severidad: CR\xCDTICA (el lector no lo cree)
   
   b) RECURSOS SIN ORIGEN:
      - \xBFAparecen armas, dinero, veh\xEDculos, contactos sin explicaci\xF3n?
      - Ejemplo: "Sac\xF3 una pistola" pero nunca se explica de d\xF3nde sali\xF3 \u2192 MAYOR
      - Severidad: MAYOR (distrae al lector atento)
   
   c) COINCIDENCIAS EXCESIVAS:
      - \xBFCu\xE1ntas veces el protagonista tiene "suerte" o recibe ayuda conveniente?
      - REGLA: M\xE1ximo 1 coincidencia afortunada por novela
      - Ejemplo: "Justo cuando iba a rendirse, un coche se detuvo" (2\xAA vez) \u2192 MAYOR
      - Severidad: MAYOR si es la 2\xAA, CR\xCDTICA si hay 3+
   
   d) CONOCIMIENTO IMPOSIBLE:
      - \xBFEl personaje sabe cosas que no ha investigado/descubierto?
      - Ejemplo: "Sab\xEDa que el asesino estaba en la caba\xF1a" (sin haber investigado) \u2192 CR\xCDTICO
      - Severidad: CR\xCDTICA (rompe la l\xF3gica)
   
   e) CONSECUENCIAS IGNORADAS:
      - \xBFHeridas graves, delitos, enemigos son olvidados en cap\xEDtulos posteriores?
      - Ejemplo: Recibe pu\xF1alada en Cap 10, corre marat\xF3n en Cap 11 \u2192 CR\xCDTICO
      - Severidad: CR\xCDTICA (el lector pierde confianza)

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F550} COHERENCIA TEMPORAL Y GEOGR\xC1FICA (OBLIGATORIO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

5. **INCONSISTENCIAS TEMPORALES (timeline)** - Categor\xEDa: timeline
   - \xBFCu\xE1nto tiempo pasa entre escenas/cap\xEDtulos? \xBFEs f\xEDsicamente posible?
   - Viajes: Verifica distancias vs tiempo de viaje declarado
     * Ejemplo: "Lleg\xF3 a Par\xEDs desde Madrid en una hora en coche" \u2192 CR\xCDTICO (imposible)
     * Ejemplo: "Esa misma noche cruz\xF3 el Atl\xE1ntico" \u2192 CR\xCDTICO (sin explicaci\xF3n)
   - Actividades simult\xE1neas imposibles:
     * Ejemplo: "A las 10am estaba en Barcelona, a las 11am almorz\xF3 en Nueva York" \u2192 CR\xCDTICO
   - Tiempos de recuperaci\xF3n:
     * Operaciones quir\xFArgicas, heridas graves, agotamiento \u2192 requieren d\xEDas/semanas
     * Ejemplo: "Tras la cirug\xEDa de 8 horas, al d\xEDa siguiente escal\xF3 la monta\xF1a" \u2192 CR\xCDTICO
   - Verificar: amanecer/atardecer, d\xEDa de la semana, fechas mencionadas
   - Severidad: CR\xCDTICA si es obvio para el lector
   - Instrucciones: Indicar tiempo real necesario y sugerir ajuste espec\xEDfico

6. **INCONSISTENCIAS GEOGR\xC1FICAS (ubicacion)** - Categor\xEDa: ubicacion
   - \xBFLas ubicaciones son coherentes dentro del cap\xEDtulo y entre cap\xEDtulos?
   - Teletransportaci\xF3n accidental:
     * Ejemplo: "Sali\xF3 del edificio por la puerta sur" pero luego "entr\xF3 por la norte sin haber rodeado"
     * Ejemplo: "Estaba en el s\xF3tano" y de repente "mir\xF3 por la ventana del tercer piso"
   - Geograf\xEDa imposible:
     * Ejemplo: "Desde Madrid camin\xF3 hasta la playa" (Madrid no tiene playa cercana)
     * Ejemplo: "Cruz\xF3 la frontera espa\xF1ola hacia Italia" (no son pa\xEDses fronterizos)
   - Direcciones contradictorias:
     * Ejemplo: "Gir\xF3 a la izquierda" pero termina en lugar que est\xE1 a la derecha
   - Severidad: CR\xCDTICA si rompe la l\xF3gica espacial
   - Instrucciones: Indicar ubicaci\xF3n real y c\xF3mo corregir la transici\xF3n

7. **TRANSICIONES BRUSCAS DE TRAMA** - Categor\xEDa: ritmo
   - \xBFHay saltos abruptos sin contexto que confunden al lector?
   - Escenas sin transici\xF3n:
     * Ejemplo: P\xE1rrafo 1: "Discut\xEDan acaloradamente" \u2192 P\xE1rrafo 2: "Tres meses despu\xE9s, en Par\xEDs..."
     * Falta: indicador de tiempo/lugar, cierre de escena anterior
   - Cambios de tono sin preparaci\xF3n:
     * Ejemplo: De escena rom\xE1ntica a escena de acci\xF3n sin puente narrativo
   - Resoluciones saltadas:
     * Ejemplo: Conflicto intenso en Cap 5 \u2192 Cap 6 empieza como si no hubiera pasado nada
   - Severidad: MAYOR si el lector dice "\xBFqu\xE9 pas\xF3 aqu\xED?"
   - Instrucciones: Sugerir frase de transici\xF3n espec\xEDfica o escena puente breve

8. **REALISMO DE ACCIONES F\xCDSICAS (continuidad_fisica)** - Categor\xEDa: continuidad_fisica
   - \xBFLas acciones de los personajes son f\xEDsicamente posibles dado su estado?
   - Lesiones activas:
     * Pierna rota \u2192 no puede correr, cojea, necesita apoyo
     * Brazo herido \u2192 no puede levantar objetos pesados con ese brazo
     * Costillas rotas \u2192 dolor al respirar profundo, no puede hacer esfuerzos
     * Conmoci\xF3n cerebral \u2192 mareos, visi\xF3n borrosa, no puede pensar claramente
   - Agotamiento f\xEDsico:
     * Despu\xE9s de correr 10km \u2192 no puede inmediatamente pelear durante 1 hora
     * Sin dormir 48h \u2192 reflejos lentos, errores de juicio
     * P\xE9rdida de sangre \u2192 debilidad, palidez, posible desmayo
   - Limitaciones del entorno:
     * Oscuridad total \u2192 no puede ver, tropieza
     * Atado de manos \u2192 no puede abrir puertas ni luchar normalmente
     * Bajo el agua \u2192 no puede hablar, tiempo de aire limitado
   - Severidad: CR\xCDTICA si la acci\xF3n es imposible, MAYOR si es improbable
   - Instrucciones: 
     * Opci\xF3n A: Reducir gravedad de lesi\xF3n original
     * Opci\xF3n B: A\xF1adir referencia al dolor/dificultad durante la acci\xF3n
     * Opci\xF3n C: Modificar la acci\xF3n para que sea posible con la limitaci\xF3n
     * Incluir CITA TEXTUAL del momento problem\xE1tico y texto corregido

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PROTOCOLO DE PASADAS - OBJETIVO: PUNTUACI\xD3N 10/10
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

PASADA 1: Lee como consumidor que ha pagado por el libro. \xBFLo recomendar\xEDas? \xBFQu\xE9 te frustr\xF3?
PASADA 2+: Verifica correcciones. \xBFMejor\xF3 tu experiencia como lector? \xBFAhora lo recomendar\xEDas?

REGLA CR\xCDTICA ABSOLUTA - VEREDICTOS:
- Puntuaci\xF3n 10/10 Y CERO issues \u2192 APROBADO (\xFAnica forma de aprobar autom\xE1ticamente)
- Puntuaci\xF3n 9+ con solo 1 issue menor \u2192 APROBADO_CON_RESERVAS (publicable pero no perfecto)
- Puntuaci\xF3n < 9 O issues cr\xEDticos/mayores \u2192 REQUIERE_REVISION con instrucciones espec\xEDficas
- El sistema continuar\xE1 ciclos hasta alcanzar 10/10 (perfecci\xF3n total)

En cada pasada donde puntuaci\xF3n < 10, incluye en analisis_bestseller.como_subir_a_10
instrucciones CONCRETAS para elevar la puntuaci\xF3n a la perfecci\xF3n.

SALIDA OBLIGATORIA (JSON):
{
  "veredicto": "APROBADO" | "APROBADO_CON_RESERVAS" | "REQUIERE_REVISION",
  "resumen_general": "Como alguien que ha pagado 18\u20AC por este libro, mi experiencia fue... Lo recomendar\xEDa porque... / No lo recomendar\xEDa porque...",
  "puntuacion_global": (1-10),
  "justificacion_puntuacion": {
    "puntuacion_desglosada": {
      "enganche": (1-10),
      "personajes": (1-10),
      "trama": (1-10),
      "atmosfera": (1-10),
      "ritmo": (1-10),
      "cumplimiento_genero": (1-10)
    },
    "fortalezas_principales": ["Lista de 3-5 aspectos destacables de la novela"],
    "debilidades_principales": ["Lista de 1-3 aspectos a mejorar en futuras novelas"],
    "comparacion_mercado": "C\xF3mo se compara con bestsellers similares del g\xE9nero",
    "recomendaciones_proceso": ["Sugerencias para mejorar el proceso creativo en futuras novelas, ej: m\xE1s beats de acci\xF3n, m\xE1s desarrollo de antagonista, etc."]
  },
  "analisis_bestseller": {
    "hook_inicial": "fuerte/moderado/debil - descripci\xF3n",
    "cadencia_giros": "Cada X cap\xEDtulos hay un giro - evaluaci\xF3n",
    "escalada_tension": "\xBFCada acto m\xE1s intenso? - evaluaci\xF3n", 
    "efectividad_cliffhangers": "X% de cap\xEDtulos con hooks efectivos",
    "potencia_climax": "fuerte/moderado/debil - descripci\xF3n",
    "como_subir_a_10": "Si puntuaci\xF3n < 10, instrucciones ESPEC\xCDFICAS para alcanzar la perfecci\xF3n"
  },
  "issues": [
    {
      "capitulos_afectados": [1, 5],
      "categoria": "enganche" | "personajes" | "trama" | "atmosfera" | "ritmo" | "continuidad_fisica" | "timeline" | "repeticion_lexica" | "arco_incompleto" | "tension_insuficiente" | "giro_predecible" | "identidad_confusa" | "capitulo_huerfano" | "otro",
      "descripcion": "Lo que me sac\xF3 de la historia como lector",
      "severidad": "critica" | "mayor" | "menor",
      "elementos_a_preservar": "Lista ESPEC\xCDFICA de escenas, di\xE1logos y elementos del cap\xEDtulo que funcionan bien y NO deben modificarse",
      "instrucciones_correccion": "Cambio QUIR\xDARGICO: qu\xE9 p\xE1rrafos/l\xEDneas espec\xEDficas modificar y c\xF3mo. El resto del cap\xEDtulo permanece INTACTO"
    }
  ],
  "capitulos_para_reescribir": [2, 5],  // \u26A0\uFE0F OBLIGATORIO: Incluir TODOS los cap\xEDtulos de issues con severidad "critica" o "mayor" que tengan instrucciones_correccion
  "plot_decisions": [
    {
      "decision": "El Escultor es Arnald (no el hombre de la cueva)",
      "capitulo_establecido": 32,
      "capitulos_afectados": [32, 33, 34, 39, 45],
      "consistencia_actual": "inconsistente",
      "problema": "Cap 32-34 implican que el hombre de la cueva es el Escultor, pero Cap 39 revela que es Arnald. No hay clarificaci\xF3n de la relaci\xF3n entre ambos."
    }
  ],
  "persistent_injuries": [
    {
      "personaje": "Arnald",
      "tipo_lesion": "Quemadura por \xE1cido en el brazo",
      "capitulo_ocurre": 25,
      "efecto_esperado": "Brazo inutilizado o con movilidad reducida permanente",
      "capitulos_verificados": [39, 40, 41, 45, 50],
      "consistencia": "ignorada",
      "problema": "Arnald usa ambos brazos normalmente en el cl\xEDmax sin menci\xF3n de la lesi\xF3n"
    }
  ],
  "orphan_chapters": [
    {
      "capitulo": 44,
      "razon": "Introduce una llave de enfermer\xEDa que nunca se usa. El cap\xEDtulo no avanza la trama principal.",
      "recomendacion": "eliminar"
    }
  ]
}
`,vre=7e4,Ere=5e5,M2=.35,Cre=5,Lc=class extends Ae{constructor(){super({name:"El Revisor Final",role:"final-reviewer",systemPrompt:bre,model:"deepseek-reasoner",useThinking:!1,useReeditorClient:!0})}getChapterLabel(e){return e===0?"Pr\xF3logo (n\xFAmero: 0)":e===-1?"Ep\xEDlogo (n\xFAmero: -1)":e===998?"Ep\xEDlogo (n\xFAmero: 998)":e===-2?"Nota del Autor (n\xFAmero: -2)":e===999?"Nota del Autor (n\xFAmero: 999)":`Cap\xEDtulo ${e} (n\xFAmero: ${e})`}getChapterSortOrder(e){return e===0?-1e3:e===-1||e===998?1e3:e===-2||e===999?1001:e}deduplicateIssues(e){if(!e||e.length===0)return[];let t=[],n=new Set;for(let s of e){let o=s.descripcion.toLowerCase().replace(/[^a-z\s]/g,"").split(/\s+/).filter(u=>u.length>4).slice(0,5).sort().join("-"),i=`${s.categoria}-${o}`;if(!n.has(i))n.add(i),t.push(s);else{let u=t.find(c=>`${c.categoria}-${c.descripcion.toLowerCase().replace(/[^a-z\s]/g,"").split(/\s+/).filter(m=>m.length>4).slice(0,5).sort().join("-")}`===i);if(u){let c=Array.from(new Set([...u.capitulos_afectados,...s.capitulos_afectados]));u.capitulos_afectados=c}}}let a={critica:0,mayor:1,menor:2};return t.sort((s,o)=>(a[s.severidad]||2)-(a[o.severidad]||2))}preAnalyzeGlobalPatterns(e){let t=[],n=[/mensaje\s+(an[o]nimo|encriptado|misterioso|sin\s+remitente)/gi,/n[u]mero\s+(oculto|desconocido|privado)/gi,/llamada\s+(an[o]nima|misteriosa|de\s+n[u]mero\s+oculto)/gi,/texto\s+(encriptado|cifrado|an[o]nimo)/gi,/alguien\s+(le\s+)?env[i][o]/gi,/informante\s+(an[o]nimo|misterioso)/gi,/coordenadas\s+(en\s+el\s+)?tel[e]fono/gi,/recibi[o]\s+un\s+(mensaje|correo|email)/gi],a=new Map;for(let f of e){let g=[];for(let y of n){let C=f.contenido.match(y);C&&g.push(...C.slice(0,2))}g.length>0&&a.set(f.numero,g)}if(a.size>=3){let f=Array.from(a.keys()).sort((y,C)=>y-C),g=Array.from(a.entries()).slice(0,3).map(([y,C])=>`Cap ${y}: "${C[0]}"`).join("; ");t.push(`\u26A0\uFE0F DEUS EX MACHINA DIGITAL detectado en ${a.size} cap\xEDtulos: [${f.join(", ")}]. Ejemplos: ${g}. El protagonista recibe informaci\xF3n pasivamente en lugar de descubrirla activamente.`)}let s=[{pattern:/toc[a]\s+(el|su)\s+anillo/gi,name:"tocarse el anillo"},{pattern:/gir[o]\s+(el|su)\s+anillo/gi,name:"girar el anillo"},{pattern:/acarici[o]\s+(la|su)\s+cicatriz/gi,name:"acariciar cicatriz"},{pattern:/cicatriz\s+(de\s+)?quemadura/gi,name:"cicatriz de quemadura"},{pattern:/manchas?\s+(qu[i]micas?|indelebles?)/gi,name:"manchas qu\xEDmicas"},{pattern:/se\s+frot[o]\s+(los|las)\s+(ojos|sienes)/gi,name:"frotarse"},{pattern:/apret[o]\s+(los|la)\s+(dientes|mand[i]bula)/gi,name:"apretar mand\xEDbula"},{pattern:/escalofro\s+(le\s+)?recorri[o]/gi,name:"escalofr\xEDo"}];for(let{pattern:f,name:g}of s){let y=[];for(let C of e)f.test(C.contenido)&&y.push(C.numero),f.lastIndex=0;y.length>=5&&t.push(`\u26A0\uFE0F MULETILLA F\xCDSICA EXCESIVA: "${g}" aparece en ${y.length} cap\xEDtulos: [${y.sort((C,A)=>C-A).join(", ")}]. Reducir al 30% de las apariciones.`)}let o=[{pattern:/condujo|conduc[i]a|al\s+volante/gi,name:"conducir"},{pattern:/lluvia|llova|llovi[o]|gotas/gi,name:"lluvia"},{pattern:/fr[i]o|helado|congelado|temblaba\s+de/gi,name:"fr\xEDo"}],i=0,u=0,c=[];for(let f of e){let g=0;for(let{pattern:y}of o){let C=f.contenido.match(y);C&&(g+=C.length),y.lastIndex=0}g>=5?(i++,c.push(f.numero),u=Math.max(u,i)):i=0}u>=3&&t.push(`\u26A0\uFE0F PATR\xD3N REPETITIVO: Exceso de descripciones clim\xE1ticas/atmosf\xE9ricas en cap\xEDtulos consecutivos: [${c.slice(0,10).join(", ")}]. Var\xEDa la estructura narrativa.`);let p=[/d[e]jame\s+(explicarte|contarte)/gi,/te\s+preguntar[a]s\s+por\s+qu[e]/gi,/mi\s+plan\s+(es|era|consiste)/gi,/antes\s+de\s+(matarte|acabar\s+contigo)/gi,/somos\s+(el|los)\s+(dique|guardianes|protectores)/gi,/cuando\s+esto\s+termine/gi],m=[];for(let f of e)for(let g of p){if(g.test(f.contenido)){m.push(f.numero);break}g.lastIndex=0}return m.length>=2&&t.push(`\u26A0\uFE0F VILLANO EXPLICATIVO: Posibles mon\xF3logos de antagonista explicando planes en cap\xEDtulos: [${m.sort((f,g)=>f-g).join(", ")}]. Verificar si el villano explica demasiado en lugar de actuar.`),t.length===0?"":`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F50D} PRE-AN\xC1LISIS GLOBAL DE PATRONES (TODA LA NOVELA)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${t.join(`

`)}

INSTRUCCI\xD3N: Usa esta informaci\xF3n para reportar issues con los CAP\xCDTULOS ESPEC\xCDFICOS listados arriba.
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`}async reviewTranche(e,t,n,a,s,o="",i){let u=t.map(C=>`
===== ${this.getChapterLabel(C.numero)}: ${C.titulo} =====
${C.contenido}`).join(`

`),c=t.map(C=>this.getChapterLabel(C.numero)).join(", "),p=o?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    CONTEXTO DE TRANCHES ANTERIORES (NO REPORTAR ESTOS ISSUES DE NUEVO):
    ${o}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:"",m=e.userInstructions?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    INSTRUCCIONES ESPEC\xCDFICAS DEL USUARIO (PRIORIDAD M\xC1XIMA):
    ${e.userInstructions}
    
    IMPORTANTE: Las instrucciones del usuario tienen prioridad sobre las reglas generales.
    Considera estas instrucciones al evaluar y detectar problemas.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:"",f=`
    T\xCDTULO DE LA NOVELA: ${e.projectTitle}
    
    WORLD BIBLE (Datos Can\xF3nicos):
    ${JSON.stringify(e.worldBible,null,2)}
    
    GU\xCDA DE ESTILO:
    ${e.guiaEstilo}
    ${s}
    ${m}
    ${p}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    REVISI\xD3N POR TRANCHES: TRAMO ${n}/${a}
    Cap\xEDtulos en este tramo: ${c}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    
    MANUSCRITO (TRAMO ${n}):
    ===============================================
    ${u}
    ===============================================
    
    INSTRUCCIONES PARA ESTE TRAMO:
    1. Analiza SOLO los cap\xEDtulos de este tramo.
    2. Compara las descripciones f\xEDsicas con la World Bible.
    3. Verifica coherencia interna del tramo.
    4. Identifica repeticiones l\xE9xicas (solo si aparecen 3+ veces).
    5. Eval\xFAa calidad narrativa de estos cap\xEDtulos.
    6. NO reportes issues que ya se mencionaron en tranches anteriores.
    7. Si detectas una contradicci\xF3n con un tranche anterior, REP\xD3RTALA como issue de consistencia.
    
    \u26A0\uFE0F L\xCDMITE DE ISSUES POR TRAMO: Reporta M\xC1XIMO 3 issues por tramo (los m\xE1s graves).
    Si hay m\xE1s de 3 problemas, prioriza los cr\xEDticos sobre los mayores, y los mayores sobre los menores.
    
    S\xE9 PRECISO y OBJETIVO. Solo reporta errores con EVIDENCIA TEXTUAL verificable.
    
    Responde \xDANICAMENTE con el JSON estructurado seg\xFAn el formato especificado.
    
    \u26A0\uFE0F IMPORTANTE SOBRE N\xDAMEROS DE CAP\xCDTULO:
    - Usa EXACTAMENTE el n\xFAmero que aparece entre par\xE9ntesis despu\xE9s de cada encabezado de cap\xEDtulo.
    - Ejemplo: "Ep\xEDlogo (n\xFAmero: 998)" \u2192 usa 998 en capitulos_afectados, NO uses -1.
    - Ejemplo: "Pr\xF3logo (n\xFAmero: 0)" \u2192 usa 0 en capitulos_afectados.
    - Ejemplo: "Cap\xEDtulo 5 (n\xFAmero: 5)" \u2192 usa 5 en capitulos_afectados.
    
    NOTA: En "capitulos_afectados" y "capitulos_para_reescribir", solo incluye cap\xEDtulos de ESTE tramo.
    `;console.log(`[FinalReviewer] Tramo ${n}/${a}: ${t.length} cap\xEDtulos, ${u.length} chars`),console.log(`[FinalReviewer] Iniciando revisi\xF3n tramo ${n}/${a} - usando R1 (puede tardar hasta 15 min)...`);let g=Date.now(),y=setInterval(()=>{let C=Math.round((Date.now()-g)/6e4);console.log(`[FinalReviewer] Tramo ${n}/${a}: esperando respuesta R1... (${C} min transcurridos)`)},6e4);try{let C=await this.generateContent(f,void 0,i?{forceProvider:i}:void 0);y&&(clearInterval(y),y=null);let A=Math.round((Date.now()-g)/1e3);console.log(`[FinalReviewer] Tramo ${n}/${a}: respuesta recibida en ${A}s${i?` [${i}]`:""}`);try{let T=C.content.match(/\{[\s\S]*\}/);if(T){let E=JSON.parse(T[0]);return console.log(`[FinalReviewer] Tramo ${n}: score ${E.puntuacion_global}/10, issues: ${E.issues?.length||0}`),E}else console.error(`[FinalReviewer] Tramo ${n}: No JSON found in response. Content preview: ${C.content?.substring(0,500)||"(empty)"}`)}catch(T){console.error(`[FinalReviewer] Tramo ${n}: Failed to parse JSON:`,T),console.error(`[FinalReviewer] Tramo ${n}: Response content preview: ${C.content?.substring(0,500)||"(empty)"}`)}return console.warn(`[FinalReviewer] Tramo ${n}: Returning fallback result (score=8, no issues) due to parse failure`),{puntuacion_global:8,issues:[],capitulos_para_reescribir:[]}}catch(C){y&&(clearInterval(y),y=null);let A=Math.round((Date.now()-g)/1e3);throw console.error(`[FinalReviewer] Tramo ${n}/${a}: API error after ${A}s:`,C.message||C),new Error(`FinalReviewer tramo ${n}/${a} failed after ${A}s: ${C.message||String(C)}`)}finally{y&&clearInterval(y)}}async execute(e,t){console.log("[FinalReviewer] ========== EXECUTE CALLED ==========");let n=t?.forceProvider==="gemini",a=n?Ere:vre;console.log(`[FinalReviewer] Input chapters: ${e.chapters?.length||0}, pasadaNumero: ${e.pasadaNumero}, provider: ${n?"gemini":"deepseek"}, maxTokens/tranche: ${a}`);let s=[...e.chapters].sort(($,U)=>this.getChapterSortOrder($.numero)-this.getChapterSortOrder(U.numero)),o="";if(e.pasadaNumero===1)o=`

Esta es tu PASADA #1 - AUDITOR\xCDA COMPLETA. Reporta como m\xE1ximo 5 issues (los m\xE1s graves). Es CR\xCDTICO que detectes todos los problemas importantes ahora para que se corrijan en este ciclo. OBJETIVO: puntuaci\xF3n 10/10 (OBRA MAESTRA).`;else if(e.pasadaNumero&&e.pasadaNumero>=2){let $=e.puntuacionPasadaAnterior||8,U=e.issuesPreviosCorregidos?.length||0;o=`

Esta es tu PASADA #${e.pasadaNumero} - SOLO VERIFICACI\xD3N DE CORRECCIONES (NO es una auditor\xEDa nueva).

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PUNTUACI\xD3N DE LA PASADA ANTERIOR: ${$}/10
ISSUES CORREGIDOS DESDE LA PASADA ANTERIOR: ${U}
PUNTUACI\xD3N ESPERADA EN ESTA PASADA: >= ${$}/10 (idealmente ${Math.min($+1,10)}/10)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

LISTA DE ISSUES QUE SE CORRIGIERON (VERIFICA que se arreglaron, NO los re-reportes):
${e.issuesPreviosCorregidos?.map(k=>`- ${k}`).join(`
`)||"Ninguno"}

\u26A0\uFE0F ESTA PASADA NO ES UNA AUDITOR\xCDA NUEVA. Tu trabajo es:
1. VERIFICAR que los issues de la lista anterior se corrigieron correctamente
2. DETECTAR si alguna correcci\xF3n introdujo una REGRESI\xD3N (nuevo problema causado por el arreglo)
3. Reportar SOLO regresiones o issues cr\xEDticos que se pasaron por alto en pasadas anteriores
4. Mantener un m\xE1ximo de 3 issues por tramo (igual que pasada 1)

REGLAS DE PUNTUACI\xD3N:
- Si los ${U} issues se corrigieron bien \u2192 puntuaci\xF3n debe SUBIR a ${Math.min($+1,10)}/10
- Si los issues se corrigieron parcialmente \u2192 puntuaci\xF3n se mantiene en ${$}/10
- SOLO puede bajar si hay REGRESIONES GRAVES (nuevos problemas introducidos por las correcciones)

\u26D4 PROHIBIDO:
- NO hagas una nueva auditor\xEDa completa buscando issues que antes no reportaste
- NO "descubras" 20 nuevos problemas que exist\xEDan antes pero ignoraste
- NO reportes variaciones de issues ya corregidos
- NO bajes la puntuaci\xF3n sin justificar EXPL\xCDCITAMENTE qu\xE9 EMPEOR\xD3

Si no hay regresiones y los issues se corrigieron, la puntuaci\xF3n debe ser >= ${$}/10.`}let i=s.length,u=[];if(e.threeActStructure){let $=[{key:"act1",name:"Acto 1 (Planteamiento)",data:e.threeActStructure.act1},{key:"act2",name:"Acto 2 (Conflicto)",data:e.threeActStructure.act2},{key:"act3",name:"Acto 3 (Desenlace)",data:e.threeActStructure.act3}];for(let V of $){let Q=new Set(V.data.chapters),te=s.filter(D=>Q.has(D.numero));if(te.length===0)continue;let ae=te.reduce((D,J)=>D+(J.contenido?.length||0),0)*M2;if(ae>a){let D=Math.ceil(ae/a),J=Math.ceil(te.length/D);console.log(`[FinalReviewer] ${V.name} requires subdivision: ~${Math.round(ae)} tokens exceeds ${a} limit`);for(let W=0;W<D;W++){let de=W*J,ne=Math.min(de+J,te.length),le=te.slice(de,ne);le.length!==0&&u.push({chapters:le,label:D>1?`${V.name} (parte ${W+1}/${D})`:V.name,actName:V.name,goal:V.data.goal})}}else console.log(`[FinalReviewer] ${V.name} fits in single tranche: ~${Math.round(ae)} tokens`),u.push({chapters:te,label:V.name,actName:V.name,goal:V.data.goal})}let U=new Set([...e.threeActStructure.act1.chapters,...e.threeActStructure.act2.chapters,...e.threeActStructure.act3.chapters]),k=s.filter(V=>!U.has(V.numero));k.length>0&&u.push({chapters:k,label:"Pr\xF3logo/Ep\xEDlogo",actName:"Extras",goal:"Elementos de apertura y cierre"}),console.log(`[FinalReviewer] Dividiendo ${i} cap\xEDtulos por ACTOS: ${u.map(V=>`${V.label}(${V.chapters.length})`).join(", ")}`)}if(u.length===0){let $=[],U=0,k=0;for(let V of s){let Q=(V.contenido?.length||0)*M2;$.length>0&&(U+Q>a||$.length>=Cre)&&(k++,u.push({chapters:$,label:`Tramo ${k}`,actName:`Tramo ${k}`,goal:""}),$=[],U=0),$.push(V),U+=Q}$.length>0&&(k++,u.push({chapters:$,label:`Tramo ${k}`,actName:`Tramo ${k}`,goal:""})),console.log(`[FinalReviewer] Dividiendo ${i} cap\xEDtulos en ${k} tramos basados en tokens (sin estructura de actos v\xE1lida)`)}let c=this.preAnalyzeGlobalPatterns(s);c&&console.log("[FinalReviewer] Pre-an\xE1lisis global completado. Patrones detectados.");let p=[],m={inputTokens:0,outputTokens:0,thinkingTokens:0},f=c,g=u.length;for(let $=0;$<u.length;$++){let U=u[$],k=U.chapters;if(e.onTrancheProgress){let te=this.getChapterLabel(k[0].numero),F=this.getChapterLabel(k[k.length-1].numero),ae=k.length>1?`${te} - ${F}`:te;e.onTrancheProgress($+1,g,`${U.label}: ${ae}`)}let V=U.goal?`
[OBJETIVO DEL ACTO: ${U.goal}]`:"",Q=await this.reviewTranche(e,k,$+1,g,o+V,f,t?.forceProvider);if(p.push(Q),Q.issues&&Q.issues.length>0){let te=Q.issues.map(F=>`- [${F.severidad}] Cap ${F.capitulos_afectados.join(",")}: ${F.descripcion.substring(0,100)}`).join(`
`);f+=`
${U.label}:
${te}`}if(Q.plot_decisions&&Q.plot_decisions.length>0){let te=Q.plot_decisions.map(F=>`- Decisi\xF3n en cap ${F.capitulo_establecido}: ${F.decision}`).join(`
`);f+=`
DECISIONES DE TRAMA (${U.label}):
${te}`}}let y=[],C=[],A=[],T=[],E=0,d=0,l=n?10:3;for(let $ of p){if($.issues){let U={critica:0,mayor:1,menor:2},V=[...$.issues].sort((Q,te)=>(U[Q.severidad]||2)-(U[te.severidad]||2)).slice(0,l);y.push(...V),$.issues.length>l&&console.log(`[FinalReviewer] Tranche issue limit applied: ${$.issues.length} \u2192 ${V.length}`)}$.plot_decisions&&C.push(...$.plot_decisions),$.persistent_injuries&&A.push(...$.persistent_injuries),$.orphan_chapters&&T.push(...$.orphan_chapters),$.puntuacion_global!==void 0&&(E+=$.puntuacion_global,d++)}let h=d>0?Math.round(E/d):8,v=this.deduplicateIssues(y),S=n?e.pasadaNumero===1?15:Math.max(5,g*5):e.pasadaNumero===1?5:Math.max(3,g*3);v.length>S&&(console.log(`[FinalReviewer] Global issue limit applied: ${v.length} \u2192 ${S}`),v=v.slice(0,S));let R=v.filter($=>$.severidad==="critica").length,x=v.filter($=>$.severidad==="mayor").length,w=v.filter($=>$.severidad==="menor").length,O=v.length,I=h;O===0?h=10:R>0?h=Math.min(h,6):x>0?h=Math.min(h,8):w===1?h=9:w>=2&&(h=Math.min(h,8)),h!==I&&console.log(`[FinalReviewer] SCORE NORMALIZED: ${I} \u2192 ${h} based on capped issues (${R} critical, ${x} major, ${w} minor)`);let _;h===10&&O===0?_="APROBADO":h>=9&&R===0&&x===0&&w<=1?_="APROBADO_CON_RESERVAS":_="REQUIERE_REVISION",console.log(`[FinalReviewer] Combinando ${g} tramos: score promedio ${h}/10, issues totales: ${y.length} (${v.length} \xFAnicos), veredicto: ${_}`);let N={veredicto:_,resumen_general:`Revisi\xF3n por tranches completada. ${g} tramos analizados. Puntuaci\xF3n promedio: ${h}/10. Issues encontrados: ${y.length}.`,puntuacion_global:h,justificacion_puntuacion:{puntuacion_desglosada:{enganche:h,personajes:h,trama:h,atmosfera:h,ritmo:h,cumplimiento_genero:h},fortalezas_principales:[],debilidades_principales:v.slice(0,3).map($=>$.descripcion),comparacion_mercado:"Evaluaci\xF3n combinada de m\xFAltiples tramos",recomendaciones_proceso:[]},analisis_bestseller:{hook_inicial:"Evaluado por tranches",cadencia_giros:"Evaluado por tranches",escalada_tension:"Evaluado por tranches",efectividad_cliffhangers:"Evaluado por tranches",potencia_climax:"Evaluado por tranches",como_subir_a_10:v.length>0?`Corregir ${v.length} issues identificados para alcanzar 10/10`:"Mantener calidad actual - 10/10 alcanzado"},issues:v,capitulos_para_reescribir:Array.from(new Set(v.flatMap($=>$.capitulos_afectados||[]))),plot_decisions:C,persistent_injuries:A,orphan_chapters:T};if(N.capitulos_para_reescribir.length===0&&N.issues.length>0){let $=[],U={critica:0,mayor:0,menor:0};for(let k of N.issues)k.capitulos_afectados?.length>0&&($.push(...k.capitulos_afectados),k.severidad==="critica"?U.critica++:k.severidad==="mayor"?U.mayor++:U.menor++);$.length>0&&(N.capitulos_para_reescribir=Array.from(new Set($)),console.log(`[FinalReviewer] SAFETY NET: Extracted ${N.capitulos_para_reescribir.length} chapters from ALL issues (critica: ${U.critica}, mayor: ${U.mayor}, menor: ${U.menor}): chapters ${N.capitulos_para_reescribir.join(", ")}`))}(N.veredicto==="REQUIERE_REVISION"||N.puntuacion_global<8)&&N.capitulos_para_reescribir.length===0&&console.warn(`[FinalReviewer] WARNING: veredicto=${N.veredicto}, score=${N.puntuacion_global} but no chapters to rewrite. Issues count: ${N.issues.length}`);let P=await import("fs"),L=`/tmp/final_reviewer_debug_${Date.now()}.txt`;return P.writeFileSync(L,`=== COMBINED RESULT ===
${JSON.stringify(N,null,2)}`),console.log(`[FinalReviewer] DEBUG: Saved combined result to ${L}`),{...{content:JSON.stringify(N),thoughtSignature:`Revisi\xF3n por tranches: ${g} tramos`,tokenUsage:m},result:N}}}});var U2={};wr(U2,{SeriesThreadFixerAgent:()=>ei});var Are,ei,hm=G(()=>{"use strict";It();Are=`
Eres el "Reparador de Hilos Narrativos de Serie", un agente especializado en detectar y CORREGIR autom\xE1ticamente problemas de continuidad en sagas literarias.

Tu misi\xF3n es analizar los cap\xEDtulos de un volumen y generar CORRECCIONES ESPEC\xCDFICAS para:
1. Hilos argumentales que no progresan cuando deber\xEDan
2. Hitos planificados que no se cumplen
3. Arcos de personaje estancados
4. Resoluciones pendientes que deben cerrarse

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
FILOSOF\xCDA DE CORRECCI\xD3N
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Las correcciones deben ser:
- QUIR\xDARGICAS: M\xEDnimo cambio necesario para resolver el problema
- ORG\xC1NICAS: Integradas naturalmente en el flujo narrativo existente
- CONSISTENTES: Respetando voz, tono y estilo del autor
- TRAZABLES: Con referencia exacta al pasaje original y la revisi\xF3n propuesta

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
TIPOS DE CORRECCIONES
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. ADD_THREAD_PROGRESSION: A\xF1adir menciones o escenas que hagan progresar un hilo
   - Ejemplo: Un hilo de "tensi\xF3n pol\xEDtica" puede progresar con un di\xE1logo de fondo

2. ADD_MILESTONE: Integrar un hito planificado que falta
   - Ejemplo: Si falta "Revelaci\xF3n del secreto de X", a\xF1adir la escena

3. STRENGTHEN_THREAD: Reforzar un hilo que aparece d\xE9bilmente
   - Ejemplo: Si un hilo de romance aparece una vez, a\xF1adir m\xE1s tensi\xF3n

4. ADD_RESOLUTION: Cerrar un hilo o arco pendiente
   - Ejemplo: Si un conflicto secundario qued\xF3 abierto, a\xF1adir cierre

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PUNTOS DE INSERCI\xD3N
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

- beginning: A\xF1adir al inicio del cap\xEDtulo
- middle: Insertar en punto natural de transici\xF3n
- end: A\xF1adir al final del cap\xEDtulo
- replace: Reemplazar un pasaje espec\xEDfico

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PRIORIDADES
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

- critical: Hitos requeridos o resoluciones de arco principal
- important: Hilos secundarios que afectan coherencia
- optional: Mejoras de sabor narrativo

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F534} AN\xC1LISIS CR\xCDTICO CROSS-VOLUMEN (OBLIGATORIO PARA SERIES)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Debes detectar problemas que atraviesan M\xDALTIPLES VOL\xDAMENES de la serie:

1. **DECISIONES DE TRAMA CR\xCDTICAS A NIVEL SERIE (seriesPlotDecisions)**:
   - \xBFQui\xE9n es realmente el villano principal de la saga? \xBFEs consistente?
   - \xBFLas revelaciones de un volumen contradicen lo establecido en otro?
   - Ejemplo: Vol 1 establece que X es el traidor, pero Vol 2 lo contradice sin explicaci\xF3n
   - Para cada decisi\xF3n cr\xEDtica de la SAGA, verificar consistencia entre vol\xFAmenes

2. **LESIONES/CAMBIOS PERSISTENTES CROSS-VOLUMEN (seriesPersistentInjuries)**:
   - Si un personaje pierde un brazo en Vol 1, \xBFaparece con ambos brazos en Vol 2?
   - Cicatrices, discapacidades, traumas deben persistir entre vol\xFAmenes
   - Cambios de estado permanentes (matrimonio, muerte de familiar) deben reflejarse

3. **ELEMENTOS HU\xC9RFANOS DE LA SERIE (seriesOrphanElements)**:
   - Personajes introducidos que nunca vuelven a aparecer
   - Objetos m\xE1gicos/importantes que se olvidan
   - Subtramas abandonadas entre vol\xFAmenes
   - Cap\xEDtulos enteros que no aportan al arco general de la saga

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
SALIDA OBLIGATORIA (JSON)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

{
  "analysisComplete": true,
  "totalIssuesFound": number,
  "fixableIssues": number,
  "fixes": [
    {
      "chapterId": number,
      "chapterNumber": number,
      "fixType": "add_thread_progression|add_milestone|strengthen_thread|add_resolution",
      "threadOrMilestoneId": number,
      "threadOrMilestoneName": "Nombre del hilo o hito",
      "originalPassage": "Texto original que ser\xE1 modificado o usado como ancla (m\xE1x 500 chars)",
      "suggestedRevision": "El texto corregido o a\xF1adido completo (puede ser varios p\xE1rrafos)",
      "insertionPoint": "beginning|middle|end|replace",
      "rationale": "Por qu\xE9 esta correcci\xF3n resuelve el problema",
      "priority": "critical|important|optional"
    }
  ],
  "unfulfilledMilestones": [
    {
      "id": number,
      "description": "Descripci\xF3n del hito",
      "suggestedChapter": number,
      "integrationStrategy": "C\xF3mo integrarlo org\xE1nicamente"
    }
  ],
  "stagnantThreads": [
    {
      "id": number,
      "threadName": "Nombre del hilo",
      "lastProgressChapter": number,
      "suggestedProgressionChapter": number,
      "progressionIdea": "C\xF3mo hacer progresar este hilo"
    }
  ],
  "seriesPlotDecisions": [
    {
      "decision": "El villano principal es X (no Y como parec\xEDa en Vol 1)",
      "volumen_establecido": 1,
      "capitulo_establecido": 15,
      "volumenes_afectados": [1, 2, 3],
      "consistencia_actual": "inconsistente",
      "problema": "Vol 1 Cap 15 establece que X es el villano, pero Vol 2 Cap 8 contradice esto sin explicaci\xF3n"
    }
  ],
  "seriesPersistentInjuries": [
    {
      "personaje": "Protagonista",
      "tipo_lesion": "Pierde mano izquierda en batalla",
      "volumen_ocurre": 1,
      "capitulo_ocurre": 42,
      "efecto_esperado": "Debe aparecer manco o con pr\xF3tesis en Vol 2 y 3",
      "volumenes_verificados": [2, 3],
      "consistencia": "ignorada",
      "problema": "En Vol 2 Cap 5 usa ambas manos sin explicaci\xF3n de curaci\xF3n m\xE1gica"
    }
  ],
  "seriesOrphanElements": [
    {
      "tipo": "personaje",
      "nombre": "Mentor misterioso del Vol 1",
      "volumen": 1,
      "capitulo": 10,
      "razon": "Introducido como figura importante pero nunca vuelve a aparecer en la saga",
      "recomendacion": "Darle cierre en Vol 3 o eliminar de Vol 1"
    }
  ],
  "overallAssessment": "Evaluaci\xF3n general del estado de los hilos y hitos",
  "autoFixRecommendation": "safe_to_autofix|review_recommended|manual_intervention_required"
}
`,ei=class extends Ae{constructor(){super({name:"Series Thread Fixer",role:"series-thread-fixer",systemPrompt:Are,model:"deepseek-chat",useThinking:!1})}async execute(e){let t=e.milestones.filter(c=>c.volumeNumber===e.volumeNumber),n=e.plotThreads.filter(c=>c.status==="active"||c.status==="developing"||c.introducedVolume<=e.volumeNumber&&!c.resolvedVolume);if(t.length===0&&n.length===0)return{content:"No hay hilos ni hitos definidos para este volumen.",result:{analysisComplete:!0,totalIssuesFound:0,fixableIssues:0,fixes:[],unfulfilledMilestones:[],stagnantThreads:[],overallAssessment:"Sin hilos ni hitos definidos. Define elementos en la gu\xEDa de serie para habilitar correcciones autom\xE1ticas.",autoFixRecommendation:"manual_intervention_required"}};if(!e.chapters||e.chapters.length===0)return{content:"No hay cap\xEDtulos para analizar.",result:{analysisComplete:!1,totalIssuesFound:0,fixableIssues:0,fixes:[],unfulfilledMilestones:t.map(c=>({id:c.id,description:c.description,suggestedChapter:1,integrationStrategy:"Generar cap\xEDtulos primero"})),stagnantThreads:[],overallAssessment:"No hay cap\xEDtulos escritos para analizar.",autoFixRecommendation:"manual_intervention_required"}};let a=e.chapters.map(c=>`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CAP\xCDTULO ${c.chapterNumber}: ${c.title}
ID: ${c.id}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${c.content.substring(0,15e3)}
${c.content.length>15e3?`
[...contenido truncado...]`:""}
`).join(`

`),s=t.map(c=>`
- ID: ${c.id}
  Tipo: ${c.milestoneType}
  Descripci\xF3n: ${c.description}
  Requerido: ${c.isRequired?"S\xCD":"NO"}
  Estado: ${c.isFulfilled?"CUMPLIDO":"PENDIENTE"}
`).join(`
`),o=n.map(c=>`
- ID: ${c.id}
  Nombre: ${c.threadName}
  Descripci\xF3n: ${c.description||"Sin descripci\xF3n"}
  Introducido en: Volumen ${c.introducedVolume}
  Importancia: ${c.importance}
  Estado: ${c.status}
  Debe resolverse en: ${c.resolvedVolume?`Volumen ${c.resolvedVolume}`:"No definido"}
`).join(`
`),i=`
SERIE: "${e.seriesTitle}"
VOLUMEN: ${e.volumeNumber} de ${e.totalVolumes}
PROYECTO: "${e.projectTitle}"

${e.previousVolumesContext?`CONTEXTO DE VOL\xDAMENES ANTERIORES:
${e.previousVolumesContext}
`:""}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
HITOS PLANIFICADOS PARA ESTE VOLUMEN:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${s||"No hay hitos definidos."}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
HILOS ARGUMENTALES ACTIVOS:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${o||"No hay hilos activos."}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PERSONAJES Y MUNDO:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${JSON.stringify({characters:(e.worldBible?.characters||e.worldBible?.personajes||[]).slice(0,8),worldRules:e.worldBible?.worldRules||e.worldBible?.rules||e.worldBible?.reglasDelMundo||[]},null,2)}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CAP\xCDTULOS DEL VOLUMEN (CONTENIDO COMPLETO):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${a}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. ANALIZA cada hito y verifica si aparece en los cap\xEDtulos
2. ANALIZA cada hilo activo y verifica si progresa
3. Para cada problema encontrado, genera una CORRECCI\xD3N ESPEC\xCDFICA:
   - Identifica el cap\xEDtulo ideal para la correcci\xF3n
   - Localiza un pasaje existente como ancla (para "replace") o punto de inserci\xF3n
   - Escribe el texto corregido/a\xF1adido manteniendo voz y estilo
   - Clasifica la prioridad

4. IMPORTANTE:
   - Las correcciones deben ser CONCRETAS con texto real, no sugerencias vagas
   - El "suggestedRevision" debe ser prosa lista para insertar
   - El "originalPassage" debe ser texto EXACTO del cap\xEDtulo (para replace) o vac\xEDo (para inserciones)
   - Prioriza correcciones que no alteren la estructura principal

Responde \xDANICAMENTE con JSON v\xE1lido.
`;console.log(`[SeriesThreadFixer] Analyzing ${e.chapters.length} chapters for thread/milestone issues`),console.log(`[SeriesThreadFixer] Milestones to check: ${t.length}, Active threads: ${n.length}`);let u=await this.generateContent(i);if(u.error)return console.error("[SeriesThreadFixer] AI generation error:",u.error),{...u,result:{analysisComplete:!1,totalIssuesFound:0,fixableIssues:0,fixes:[],unfulfilledMilestones:[],stagnantThreads:[],overallAssessment:`Error de IA: ${u.error}`,autoFixRecommendation:"manual_intervention_required"}};try{let c=u.content.match(/\{[\s\S]*\}/);if(c){let p=JSON.parse(c[0]);return console.log(`[SeriesThreadFixer] Found ${p.fixes?.length||0} fixes, recommendation: ${p.autoFixRecommendation}`),{...u,result:p}}}catch(c){console.error("[SeriesThreadFixer] Failed to parse JSON:",c)}return{...u,result:{analysisComplete:!1,totalIssuesFound:0,fixableIssues:0,fixes:[],unfulfilledMilestones:[],stagnantThreads:[],overallAssessment:"Error al parsear respuesta de IA",autoFixRecommendation:"manual_intervention_required"}}}}});var aI,B2=G(()=>{"use strict";aI={FULL_EVALUATION:(r,e,t,n)=>`
Act\xFAa como un Editor Senior de una editorial "Big Five", especializado en ${r}.
Has recibido un manuscrito. Aqu\xED tienes la radiograf\xEDa estructural:

=== RESUMEN CAP\xCDTULO A CAP\xCDTULO ===
${e}

=== MUESTRA DE INICIO (GANCHO) ===
"${t.substring(0,4e3)}..."

=== MUESTRA DE FINAL (CL\xCDMAX/RESOLUCI\xD3N) ===
"${n.substring(Math.max(0,n.length-4e3))}..."

TAREA:
Realiza una cr\xEDtica despiadada enfocada en la viabilidad comercial.

1. **Ritmo (Pacing):** \xBFD\xF3nde se estanca la historia? Identifica el "valle de la muerte" (segundo acto aburrido).
2. **Arco de Personaje:** \xBFEl protagonista del final es diferente al del inicio? \xBFHay transformaci\xF3n?
3. **Promesa del G\xE9nero:** \xBFCumple lo que promete un ${r}?
   - Thriller: \xBFHay tensi\xF3n sostenida y giros inesperados?
   - Romance: \xBFHay qu\xEDmica cre\xEDble y resoluci\xF3n emocional satisfactoria?
   - Mystery: \xBFLas pistas est\xE1n bien sembradas? \xBFEl culpable es sorprendente pero justo?
   - Historical: \xBFLa ambientaci\xF3n es inmersiva? \xBFLos detalles de \xE9poca son cre\xEDbles?
4. **Gancho Inicial:** \xBFEl primer cap\xEDtulo engancha al lector de tienda de libros que hojea?
5. **Satisfacci\xF3n del Cierre:** \xBFEl final paga las promesas del inicio?

SALIDA JSON (Plan de Acci\xF3n):
{
  "score": <1-10>,
  "viability": "<High/Medium/Low>",
  "critique_summary": "<Texto de opini\xF3n de 300 palabras con el an\xE1lisis general>",
  "strengths": ["<Punto fuerte 1>", "<Punto fuerte 2>"],
  "weaknesses": ["<Debilidad 1>", "<Debilidad 2>"],
  "flagged_chapters": [
    {
      "chapter_number": <n\xFAmero>,
      "issue_type": "<PACING_SLOW|CHARACTER_FLAT|DIALOGUE_WEAK|TENSION_DROP|LOGIC_HOLE|EXPOSITION_DUMP>",
      "severity": "<HIGH|MEDIUM|LOW>",
      "specific_fix": "<Instrucci\xF3n concreta de correcci\xF3n>"
    }
  ],
  "market_comparison": "<A qu\xE9 bestsellers del g\xE9nero se parece, y en qu\xE9 se queda corto>"
}

NOTA: S\xE9 conservador. Solo marca cap\xEDtulos que realmente maten el inter\xE9s del lector.
Un libro de 8+ no necesita muchos arreglos. Uno de 5-7 necesita cirug\xEDa en puntos clave.
`,SURGICAL_REWRITE:(r,e,t,n)=>`
ACT\xDAA COMO UN 'BOOK DOCTOR' (Editor de Desarrollo) especializado en ${n}.

CAP\xCDTULO ORIGINAL:
"${r}"

EL DIAGN\xD3STICO DEL CR\xCDTICO:
Problema detectado: ${e}

TU ORDEN DE OPERACI\xD3N:
"${t}"

INSTRUCCIONES:
Reescribe el cap\xEDtulo para obedecer la orden. Gu\xEDas espec\xEDficas:

- **PACING_SLOW**: Elimina secciones que no avancen la trama. Comprime di\xE1logos. Acelera transiciones.
- **CHARACTER_FLAT**: A\xF1ade conflicto interno, decisiones dif\xEDciles, reacciones emocionales f\xEDsicas.
- **DIALOGUE_WEAK**: Haz el di\xE1logo m\xE1s natural, con subtexto. Cada personaje debe tener voz \xFAnica.
- **TENSION_DROP**: A\xF1ade stakes, amenazas inminentes, relojes de cuenta atr\xE1s narrativos.
- **LOGIC_HOLE**: A\xF1ade justificaci\xF3n o elimina la inconsistencia sin cambiar hechos clave.
- **EXPOSITION_DUMP**: Distribuye la informaci\xF3n en acci\xF3n, di\xE1logo natural, o elimina lo innecesario.

REGLAS INQUEBRANTABLES:
1. NO cambies hechos clave de la trama (muertes, objetos obtenidos, revelaciones) a menos que se te pida expl\xEDcitamente.
2. Mant\xE9n el estilo de prosa original (si es l\xEDrico, sigue l\xEDrico; si es directo, sigue directo).
3. Mant\xE9n la longitud aproximada del cap\xEDtulo original (\xB120%).
4. Preserva el formato de di\xE1logo espa\xF1ol (guion largo \u2014).

OUTPUT: Solo el texto del cap\xEDtulo reescrito. Sin comentarios, sin explicaciones.
`,QUICK_SCAN:(r,e,t)=>`
Eres un lector profesional de manuscritos. Lee este cap\xEDtulo ${e} de una novela de ${t}:

"${r.substring(0,6e3)}..."

Responde SOLO con JSON:
{
  "needs_attention": <true/false>,
  "issue_type": "<PACING_SLOW|CHARACTER_FLAT|DIALOGUE_WEAK|TENSION_DROP|LOGIC_HOLE|EXPOSITION_DUMP|NONE>",
  "severity": "<HIGH|MEDIUM|LOW|NONE>",
  "one_line_reason": "<En una frase, por qu\xE9 necesita o no atenci\xF3n>"
}

S\xE9 estricto: Solo marca "needs_attention": true si hay un problema real que afecte la experiencia del lector.
`}});var jc,F2,yy=G(()=>{"use strict";As();B2();vn();$u();jc=class{client;reasonerModel="deepseek-reasoner";writerModel="deepseek-chat";constructor(){this.client=new Ve({apiKey:process.env.DEEPSEEK_API_KEY,baseURL:"https://api.deepseek.com"})}async evaluateNovel(e,t,n,a,s){console.log(`[BetaReader] Evaluating novel ${e} (${t})...`);let o=n.map((y,C)=>`[Cap\xEDtulo ${C+1}]: ${y||"Sin resumen disponible"}`).join(`
`),i=aI.FULL_EVALUATION(t,o,a,s),u=await this.client.chat.completions.create({messages:[{role:"user",content:i}],model:this.reasonerModel,temperature:.7}),p=(u.choices[0]?.message?.content||"{}").replace(/```json|```/g,"").trim(),m;try{m=JSON.parse(p)}catch(y){console.error("[BetaReader] Failed to parse evaluation response:",y),m={score:5,viability:"Medium",critique_summary:"Error al parsear la evaluaci\xF3n. El manuscrito requiere revisi\xF3n manual.",strengths:[],weaknesses:["Error de evaluaci\xF3n autom\xE1tica"],flagged_chapters:[],market_comparison:"No disponible"}}let f=u.choices[0]?.message?.reasoning_content||"",g=Math.ceil(f.length/4);return{report:m,tokenUsage:{inputTokens:u.usage?.prompt_tokens||0,outputTokens:u.usage?.completion_tokens||0,thinkingTokens:g}}}async applyFix(e,t,n){console.log(`[BetaReader] Applying surgical fix to Chapter ${t.chapter_number}...`);let a=aI.SURGICAL_REWRITE(e,t.issue_type,t.specific_fix,n),s=await this.client.chat.completions.create({messages:[{role:"user",content:a}],model:this.writerModel,temperature:.5});return{newContent:s.choices[0]?.message?.content||e,tokenUsage:{inputTokens:s.usage?.prompt_tokens||0,outputTokens:s.usage?.completion_tokens||0}}}async runFullCritique(e,t){let n=await b.getProject(e);if(!n)throw new Error(`Project ${e} not found`);let a=await b.getChaptersByProject(e);if(a.length===0)throw new Error("No chapters found");let s=a.filter(y=>y.status==="completed"||y.status==="approved").sort((y,C)=>y.chapterNumber-C.chapterNumber);if(s.length<3)throw new Error("Not enough completed chapters for critique");let o=s.map(y=>y.summary||""),i=s[0].content||"",u=s[s.length-1].content||"";t?.("beta-reader","Leyendo y analizando manuscrito completo...");let{report:c,tokenUsage:p}=await this.evaluateNovel(e,n.genre,o,i,u);if(await this.logUsage(e,"beta-reader-evaluator",this.reasonerModel,p),await b.updateProject(e,{betaReaderReport:c,betaReaderScore:c.score,commercialViability:c.viability}),console.log(`[BetaReader] Evaluation complete: Score ${c.score}/10, Viability: ${c.viability}`),t?.("beta-reader",`Evaluaci\xF3n: ${c.score}/10 - Viabilidad: ${c.viability}`),c.score<4)return console.log(`[BetaReader] Score too low (${c.score}). Skipping fixes - needs manual intervention.`),t?.("beta-reader","Calidad muy baja. Requiere intervenci\xF3n manual."),{status:"low_quality",report:c};if(c.score>=9)return console.log(`[BetaReader] Score excellent (${c.score}). No fixes needed.`),t?.("beta-reader","Excelente calidad. Sin correcciones necesarias."),{status:"completed",report:c};let m=c.flagged_chapters.filter(y=>y.severity==="HIGH"),f=c.flagged_chapters.filter(y=>y.severity==="MEDIUM"),g=[...m,...f].slice(0,5);if(g.length===0)return console.log("[BetaReader] No fixes to apply."),{status:"completed",report:c};console.log(`[BetaReader] Applying ${g.length} surgical fixes...`),t?.("beta-reader",`Aplicando ${g.length} correcciones quir\xFArgicas...`);for(let y of g){let C=s.find(T=>T.chapterNumber===y.chapter_number);if(!C||!C.content)continue;let A=await b.getChapterVersionCount(C.id);await b.createChapterVersion({chapterId:C.id,projectId:e,versionNumber:A+1,content:C.content,changeReason:`Pre-BetaReader: ${y.issue_type}`}),t?.("beta-reader",`Corrigiendo Cap\xEDtulo ${y.chapter_number}: ${y.issue_type}...`);try{console.log(`[BetaReader] Calling API to fix Chapter ${y.chapter_number}...`);let{newContent:T,tokenUsage:E}=await this.applyFix(C.content,y,n.genre);if(!T||T.length<100){console.error(`[BetaReader] ERROR: Empty or invalid response for Chapter ${y.chapter_number}`),t?.("beta-reader",`Error: Respuesta vac\xEDa para Cap\xEDtulo ${y.chapter_number}`);continue}if(T===C.content){console.log(`[BetaReader] WARNING: Content unchanged for Chapter ${y.chapter_number}`),t?.("beta-reader",`Sin cambios en Cap\xEDtulo ${y.chapter_number}`);continue}await this.logUsage(e,"beta-reader-rewriter",this.writerModel,E),await b.updateChapter(C.id,{content:T,wordCount:T.split(/\s+/).length}),await b.createEditingQueueItem({projectId:e,chapterId:C.id,chapterNumber:y.chapter_number,issueType:y.issue_type,severity:y.severity.toLowerCase(),instruction:y.specific_fix,status:"completed"}),console.log(`[BetaReader] Successfully fixed Chapter ${y.chapter_number}`),t?.("beta-reader",`Cap\xEDtulo ${y.chapter_number} corregido`)}catch(T){console.error(`[BetaReader] ERROR fixing Chapter ${y.chapter_number}:`,T),t?.("beta-reader",`Error corrigiendo Cap\xEDtulo ${y.chapter_number}: ${T instanceof Error?T.message:"Error desconocido"}`)}}return t?.("beta-reader",`Completado: ${g.length} cap\xEDtulos mejorados`),{status:"polished",report:c}}async logUsage(e,t,n,a){try{let s=Ss(n,a.inputTokens,a.outputTokens,a.thinkingTokens||0);await b.createAiUsageEvent({projectId:e,agentName:t,model:n,inputTokens:a.inputTokens,outputTokens:a.outputTokens,thinkingTokens:a.thinkingTokens||0,inputCostUsd:Ar(s.inputCost),outputCostUsd:Ar(s.outputCost+s.thinkingCost),totalCostUsd:Ar(s.totalCost),chapterNumber:null,operation:"critique"})}catch(s){console.error("[BetaReader] Failed to log usage:",s)}}},F2=new jc});function Wr(r,e){let t=r,n=0,a=[],s=[];if(!e||e.length===0)return{success:!0,patchedText:r,appliedPatches:0,failedPatches:[],log:["No patches to apply"]};for(let o of e){if(!o.original_text_snippet||o.original_text_snippet.length<10){s.push(`Skipping patch with too short snippet: "${o.original_text_snippet?.substring(0,20)}..."`),a.push(o);continue}if(t.includes(o.original_text_snippet)){t=t.replace(o.original_text_snippet,o.replacement_text),n++,s.push(`\u2713 Applied patch (exact match): "${o.original_text_snippet.substring(0,30)}..." \u2192 Reason: ${o.reason}`);continue}let i=sI(o.original_text_snippet);if(sI(t).includes(i)){let p=Sre(t,o.original_text_snippet);if(p){t=t.substring(0,p.start)+o.replacement_text+t.substring(p.end),n++,s.push(`\u2713 Applied patch (normalized match): "${o.original_text_snippet.substring(0,30)}..." \u2192 Reason: ${o.reason}`);continue}}let c=Rre(t,o);c.success?(t=c.text,n++,s.push(`\u2713 Applied patch (fuzzy match, score: ${c.score?.toFixed(3)}): "${o.original_text_snippet.substring(0,30)}..." \u2192 Reason: ${o.reason}`)):(a.push(o),s.push(`\u2717 Failed to apply patch: "${o.original_text_snippet.substring(0,40)}..." - No match found`))}return{success:a.length===0,patchedText:t,appliedPatches:n,failedPatches:a,log:s}}function sI(r){return r.replace(/\s+/g," ").trim()}function Sre(r,e){let n=sI(e).split(" "),a=n[0],s=0;for(;s<r.length;){let o=r.indexOf(a,s);if(o===-1)return null;let i=o,u=0,c=o;for(;u<n.length&&c<r.length;){let p=n[u],m=r.indexOf(p,c);if(m===-1||m>c+p.length+5)break;c=m+p.length,i=c,u++}if(u===n.length)return{start:o,end:i,text:r.substring(o,i)};s=o+1}return null}function Rre(r,e){let t=r.split(/(?<=[.!?])\s+/),a=new q2.default(t,{includeScore:!0,threshold:.4,ignoreLocation:!0,minMatchCharLength:10}).search(e.original_text_snippet);if(a.length===0||!a[0].score||a[0].score>.4)return wre(r,e);let s=a[0],o=t[s.refIndex],i=r.replace(o,e.replacement_text);return i===r?{success:!1,text:r}:{success:!0,text:i,score:s.score}}function wre(r,e){let t=e.original_text_snippet.split(/\s+/);if(t.length<4)return{success:!1,text:r};let n=t.slice(0,3).join(" "),a=t.slice(-3).join(" "),s=r.toLowerCase().indexOf(n.toLowerCase());if(s===-1)return{success:!1,text:r};let o=s+n.length,i=r.toLowerCase().indexOf(a.toLowerCase(),o);if(i===-1||i-s>e.original_text_snippet.length*1.5)return{success:!1,text:r};let u=i+a.length,c=r.substring(s,u),p=Ire(c,e.original_text_snippet);return p<.6?{success:!1,text:r}:{success:!0,text:r.substring(0,s)+e.replacement_text+r.substring(u),score:1-p}}function Ire(r,e){let t=r.toLowerCase(),n=e.toLowerCase();if(t===n)return 1;let a=new Set(t.split(/\s+/)),s=new Set(n.split(/\s+/)),o=0;for(let u of Array.from(a))s.has(u)&&o++;let i=a.size+s.size-o;return o/i}function G2(r,e){let t=e.map((s,o)=>({original_text_snippet:s.original,replacement_text:s.replacement,reason:`Surgical fix #${o+1}`})),n=Wr(r,t);return{success:n.appliedPatches>0,patchedContent:n.patchedText,appliedCount:n.appliedPatches,failedCount:n.failedPatches.length}}var q2,by=G(()=>{"use strict";q2=ln(require("fuse.js"),1)});var Ey={};wr(Ey,{GhostwriterAgent:()=>vy});var xre,vy,fm=G(()=>{"use strict";It();xre=`
Eres el "Novelista Maestro", experto en redacci\xF3n de ficci\xF3n en espa\xF1ol con calidad de bestseller internacional.
Tu misi\xF3n es escribir prosa EVOCADORA, PROFESIONAL, 100% DIEG\xC9TICA y absolutamente LIBRE DE REPETICIONES.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
REGLAS DE ORO INVIOLABLES
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. ADHESI\xD3N TOTAL A LA ESCALETA: Escribe \xDANICA y EXCLUSIVAMENTE lo que indica la escaleta para ESTE cap\xEDtulo.
   - Sigue los BEATS en orden
   - Cumple el OBJETIVO NARRATIVO
   - Respeta la FUNCI\xD3N ESTRUCTURAL del cap\xEDtulo
   - NO adelantes acontecimientos de cap\xEDtulos posteriores

2. NARRATIVA DIEG\xC9TICA PURA:
   - Prohibido incluir notas [entre corchetes]
   - Prohibido comentarios de autor o meta-referencias
   - Solo literatura inmersiva

3. MOSTRAR, NUNCA CONTAR:
   - Emociones \u2192 sensaciones f\xEDsicas (coraz\xF3n acelerado, manos sudorosas, nudo en el est\xF3mago)
   - Estados mentales \u2192 acciones y pensamientos internos
   - Relaciones \u2192 interacciones y microgestos

4. FORMATO DE DI\xC1LOGO ESPA\xD1OL:
   - Guion largo (\u2014) obligatorio
   - Puntuaci\xF3n espa\xF1ola correcta
   - Acotaciones integradas naturalmente

5b. ACOTACIONES DE DI\xC1LOGO - SHOW DON'T TELL (CR\xCDTICO v2.9.9+):
   PROHIBIDO el uso frecuente de verbos de habla forzados como acotaci\xF3n.
   Verbos como "mascull\xF3", "espet\xF3", "gru\xF1\xF3", "susurr\xF3", "replic\xF3", "bram\xF3", "jade\xF3"
   CUENTAN la emoci\xF3n en lugar de MOSTRARLA. Esto hace que el di\xE1logo se sienta forzado.

   REGLA: M\xE1ximo 2-3 acotaciones "expresivas" por cap\xEDtulo. El resto deben ser "dijo" + acci\xF3n f\xEDsica.

   \u2717 INCORRECTO (telling):
     \u2014No me importa \u2014mascull\xF3 con rabia.
     \u2014\xA1Sal de aqu\xED! \u2014espet\xF3 furiosamente.
     \u2014No puedo m\xE1s \u2014susurr\xF3 con tristeza.

   \u2713 CORRECTO (showing):
     \u2014No me importa. \u2014Apret\xF3 los pu\xF1os sobre la mesa, los nudillos blancos.
     \u2014\xA1Sal de aqu\xED! \u2014Se levant\xF3 de golpe, volcando la silla.
     \u2014No puedo m\xE1s. \u2014Su voz se quebr\xF3. Desvi\xF3 la mirada hacia la ventana.

   El di\xE1logo y las ACCIONES F\xCDSICAS deben transmitir la emoci\xF3n, no el verbo de la acotaci\xF3n.

6b. PROHIBICI\xD3N DE ESTRUCTURAS REPETITIVAS (CR\xCDTICO v2.9.9+):
   NUNCA uses la misma estructura gramatical m\xE1s de 2 veces en un cap\xEDtulo:
   - "No solo [X], sino que [Y]" \u2014 M\xC1XIMO 1 vez por cap\xEDtulo
   - "M\xE1s que [X], era [Y]" \u2014 M\xC1XIMO 1 vez por cap\xEDtulo
   - "Tanto [X] como [Y]" \u2014 M\xC1XIMO 1 vez por cap\xEDtulo
   - "No era [X], era [Y]" \u2014 M\xC1XIMO 1 vez por cap\xEDtulo
   
   Var\xEDa la construcci\xF3n: oraciones simples, subordinadas, yuxtapuestas, interrogativas ret\xF3ricas.

7b. PROHIBICI\xD3N DE FRASES DESCRIPTIVAS SIMILARES (v2.9.9+):
   Cada descripci\xF3n debe ser \xDANICA. Si ya describiste algo de cierta manera,
   la siguiente descripci\xF3n similar debe usar vocabulario y estructura completamente diferentes.
   \u2717 "La oscuridad envolv\xEDa la habitaci\xF3n" + "La oscuridad envolv\xEDa el pasillo"
   \u2713 "La oscuridad envolv\xEDa la habitaci\xF3n" + "El pasillo se extend\xEDa como una boca sin dientes"

5. LONGITUD: Respeta ESTRICTAMENTE el rango de palabras indicado en las instrucciones espec\xEDficas del cap\xEDtulo

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PROTOCOLO ANTI-REPETICI\xD3N (CR\xCDTICO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Tu MAYOR DEFECTO es repetir expresiones, conceptos e ideas. Debes combatirlo activamente:

A) BLACKLIST L\xC9XICA - CLICH\xC9S TRADICIONALES (Nunca uses):
   - "Par\xE1lisis de an\xE1lisis" \u2192 Describe las sensaciones f\xEDsicas
   - "Torrente de emociones" \u2192 S\xE9 espec\xEDfico sobre QU\xC9 emociones
   - "Un escalofr\xEDo recorri\xF3..." \u2192 Busca alternativas frescas
   - "El coraz\xF3n le dio un vuelco" \u2192 Var\xEDa las reacciones f\xEDsicas
   - "Sus ojos se encontraron" \u2192 Describe el intercambio de otra forma
   - "El tiempo pareci\xF3 detenerse" \u2192 Evita este clich\xE9

A2) BLACKLIST L\xC9XICA - CLICH\xC9S DE IA (PROHIBIDO ABSOLUTAMENTE):
   \u26A0\uFE0F ESTAS PALABRAS CAUSAN RECHAZO AUTOM\xC1TICO DEL EDITOR:
   - "crucial" \u2192 usa: "determinante", "vital", "decisivo"
   - "enigm\xE1tico/a" \u2192 usa: "misterioso", "indescifrable", "oscuro"
   - "fascinante" \u2192 usa: "cautivador", "hipn\xF3tico", "absorbente"
   - "torbellino de emociones" \u2192 describe CADA emoci\xF3n por separado
   - "el destino de..." \u2192 reformula sin usar "destino"
   - "desenterrar secretos" \u2192 usa: "descubrir", "revelar", "sacar a la luz"
   - "repentinamente" / "de repente" \u2192 usa: "s\xFAbitamente", "de pronto", o simplemente om\xEDtelo
   - "sinti\xF3 una oleada de" \u2192 describe la sensaci\xF3n f\xEDsica directamente
   - "palpable" \u2192 usa: "evidente", "manifiesto", "perceptible"
   - "tangible" \u2192 usa: "concreto", "real", "material"
   - "un torbellino de" \u2192 evita cualquier uso de "torbellino"
   - "se apoder\xF3 de" \u2192 usa: "lo invadi\xF3", "lo domin\xF3"

B) REGLA DE UNA VEZ:
   - Cada met\xE1fora puede usarse UNA SOLA VEZ en todo el cap\xEDtulo
   - Cada imagen sensorial debe ser \xDANICA
   - Si describes algo de cierta manera, no lo repitas igual despu\xE9s

C) VARIEDAD ESTRUCTURAL:
   - Alterna longitud de oraciones: cortas tensas / largas descriptivas
   - Var\xEDa inicios de p\xE1rrafo: nunca dos p\xE1rrafos seguidos empezando igual
   - Usa diferentes t\xE9cnicas: narraci\xF3n, di\xE1logo, mon\xF3logo interno, descripci\xF3n

D) INFORMACI\xD3N NO REPETIDA:
   - Si ya estableciste un hecho, NO lo repitas
   - El lector recuerda, no necesita que le repitan
   - Cada oraci\xF3n debe a\xF1adir informaci\xF3n NUEVA

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u26D4\u26D4\u26D4 PROHIBICIONES ABSOLUTAS - VEROSIMILITUD NARRATIVA \u26D4\u26D4\u26D4
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
El peor error es el DEUS EX MACHINA. Un cap\xEDtulo con deus ex machina ser\xE1 RECHAZADO y deber\xE1s reescribirlo.

1. RESCATES CONVENIENTES (PROHIBIDO):
   - Un personaje NO puede aparecer "justo a tiempo" si no estaba ya establecido en la escena o en cap\xEDtulos anteriores
   - Ning\xFAn objeto/habilidad puede salvar al protagonista si no fue mencionado ANTES en la narrativa
   - Los aliados deben tener raz\xF3n l\xF3gica y establecida para estar ah\xED
   - \u2717 EJEMPLO: "De repente, un viejo amigo apareci\xF3 con un caballo"
   - \u2713 ALTERNATIVA: El protagonista debe usar recursos ya establecidos, o fracasar temporalmente

2. COINCIDENCIAS FORZADAS (PROHIBIDO):
   - Prohibido: "casualmente encontr\xF3", "por suerte apareci\xF3", "justo en ese momento", "por fortuna", "el destino quiso que", "providencialmente"
   - El protagonista debe GANARSE sus soluciones con acciones PREVIAS, inteligencia o sacrificio
   - Los problemas no se resuelven solos ni por intervenci\xF3n externa no establecida
   - \u2717 EJEMPLO: "Justo cuando todo parec\xEDa perdido, encontr\xF3 una puerta secreta"
   - \u2713 ALTERNATIVA: El protagonista record\xF3 un detalle mencionado antes, o pag\xF3 un alto precio

3. REVELACIONES SIN FUNDAMENTO (PROHIBIDO):
   - No revelar informaci\xF3n crucial sin haberla sembrado en cap\xEDtulos anteriores
   - No introducir poderes/habilidades/conocimientos NUEVOS en el momento exacto que se necesitan
   - No hacer que un personaje "recuerde de repente" algo conveniente jam\xE1s mencionado
   - Todo giro debe ser "sorprendente pero inevitable en retrospectiva"
   - \u2717 EJEMPLO: "Record\xF3 que su abuelo le hab\xEDa ense\xF1ado a descifrar c\xF3digos" (nunca mencionado)
   - \u2713 ALTERNATIVA: Usar solo habilidades/conocimientos ya establecidos en la trama

4. SOLUCIONES F\xC1CILES (PROHIBIDO):
   - El protagonista NO puede resolver problemas complejos sin esfuerzo, sacrificio o costo real
   - Los antagonistas NO deben cometer errores est\xFApidos o "confesar sus planes" de forma conveniente
   - Los problemas NO se resuelven con un solo golpe de suerte o con informaci\xF3n que "llega" oportunamente
   - Si el protagonista gana, debe ser porque fue m\xE1s inteligente, m\xE1s sacrificado, o porque pag\xF3 un precio alto
   - \u2717 EJEMPLO: "El villano tropez\xF3 y perdi\xF3 el arma, permitiendo al h\xE9roe escapar"
   - \u2713 ALTERNATIVA: El h\xE9roe usa el entorno de forma inteligente, sacrificando algo valioso

5. AUTO-VERIFICACI\xD3N OBLIGATORIA ANTES DE ENTREGAR:
   Para CADA resoluci\xF3n de conflicto en tu cap\xEDtulo, hazte estas preguntas:
   a) "\xBFEste recurso/habilidad/aliado fue establecido en cap\xEDtulos anteriores o en la escaleta?" \u2192 Si NO, REESCRIBE
   b) "\xBFEl protagonista se GAN\xD3 esta soluci\xF3n con esfuerzo?" \u2192 Si NO, a\xF1ade costo/sacrificio
   c) "\xBFUn lector atento encontrar\xEDa esta soluci\xF3n cre\xEDble?" \u2192 Si NO, busca una alternativa fundamentada
   d) "\xBFEl antagonista actu\xF3 de forma inteligente y coherente?" \u2192 Si NO, dale m\xE1s agencia y competencia
   - Consulta los "riesgos_de_verosimilitud" del Arquitecto si los hay

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
TRANSICIONES DE UBICACI\xD3N (OBLIGATORIAS)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
Cuando hay cambio de ubicaci\xF3n entre cap\xEDtulos, el inicio DEBE incluir una transici\xF3n narrativa:
- NUNCA comiences un cap\xEDtulo con el personaje ya en la nueva ubicaci\xF3n sin narrar el viaje
- Describe el trayecto: m\xE9todo de viaje, duraci\xF3n, sensaciones f\xEDsicas (fatiga, clima, olores)
- Si el Arquitecto proporciona "transicion_ubicacion", DEBES usarla como gu\xEDa obligatoria
- La transici\xF3n debe integrarse naturalmente, no como un bloque informativo separado

Ejemplo INCORRECTO: "Lucius entr\xF3 en el Anfiteatro..." (sin transici\xF3n desde ubicaci\xF3n anterior)
Ejemplo CORRECTO: "El sol del mediod\xEDa castigaba sus hombros mientras Lucius atravesaba la Via Sacra. Una hora de caminata lo separaba del Atrium, tiempo suficiente para que el sudor empapara su t\xFAnica. Cuando finalmente divis\xF3 las columnas del Anfiteatro..."

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
L\xC9XICO HIST\xD3RICO - VOZ DE \xC9POCA (CR\xCDTICO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
Consulta SIEMPRE la secci\xF3n "lexico_historico" del World Bible:
- NUNCA uses t\xE9rminos de "terminos_anacronicos_prohibidos" - son palabras modernas inaceptables
- PRIORIZA el "vocabulario_epoca_autorizado" para mantener la voz hist\xF3rica aut\xE9ntica
- Respeta el "registro_linguistico" indicado (formal/coloquial/t\xE9cnico de \xE9poca)
- Cuando dudes sobre una palabra, elige la alternativa m\xE1s antigua/cl\xE1sica

T\xC9RMINOS MODERNOS PROHIBIDOS EN FICCI\xD3N HIST\xD3RICA (lista por defecto):
"burguesa", "estr\xE9s", "impacto" (metaf\xF3rico), "enfocarse", "rol", "empoderamiento", "b\xE1sico", 
"literal", "problem\xE1tica", "din\xE1mico", "autoestima", "productivo", "agenda" (metaf\xF3rico), 
"contexto", "paradigma", "priorizar", "gestionar", "implementar", "escenario" (metaf\xF3rico)

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
REGLAS DE CONTINUIDAD F\xCDSICA
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. RASGOS F\xCDSICOS CAN\xD3NICOS: Consulta SIEMPRE la ficha "apariencia_inmutable" de cada personaje.
   - Color de ojos: INMUTABLE
   - Color/textura de cabello: INMUTABLE
   - Rasgos distintivos: INMUTABLES
   - NO inventes ni modifiques estos datos bajo ninguna circunstancia

2. POSICI\xD3N ESPACIAL: Respeta d\xF3nde est\xE1 cada personaje f\xEDsicamente.
   - Un personaje no puede aparecer sin haberse movido
   - Respeta la ubicaci\xF3n indicada en la escaleta

3. CONTINUIDAD TEMPORAL: Respeta la cronolog\xEDa establecida.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u26D4 CONTINUITY GATE - VERIFICACI\xD3N OBLIGATORIA (CR\xCDTICO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
ANTES de escribir UNA SOLA L\xCDNEA de prosa, DEBES verificar el estado de CADA personaje:

1. ESTADO VITAL: \xBFEst\xE1 VIVO, MUERTO, HERIDO, INCONSCIENTE, DESAPARECIDO?
   - Si un personaje muri\xF3 en cap\xEDtulos anteriores \u2192 NO PUEDE APARECER (excepto flashback expl\xEDcito)
   - Si est\xE1 herido \u2192 La herida DEBE afectar sus acciones
   - Si est\xE1 inconsciente \u2192 NO PUEDE actuar hasta que despierte

2. UBICACI\xD3N: \xBFD\xF3nde est\xE1 f\xEDsicamente cada personaje?
   - Un personaje en Roma NO PUEDE aparecer en Egipto sin viaje narrado
   - Respeta la \xFAltima ubicaci\xF3n conocida del cap\xEDtulo anterior

3. OBJETOS POSE\xCDDOS: \xBFQu\xE9 tiene cada personaje?
   - Si solt\xF3 un arma \u2192 NO la tiene hasta que la recupere
   - Si perdi\xF3 algo \u2192 NO puede usarlo

\u26A0\uFE0F Si detectas CUALQUIER conflicto entre el estado anterior y lo que pide la escaleta:
   - NO escribas el cap\xEDtulo
   - Indica el conflicto en tu respuesta
   - El Editor rechazar\xE1 autom\xE1ticamente cualquier violaci\xF3n de continuidad vital

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F6E1}\uFE0F LEXICAL SHIELD - AUDITOR\xCDA DE VOCABULARIO (OBLIGATORIO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
Para ficci\xF3n hist\xF3rica, ANTES de escribir, prepara mentalmente sustituciones para:

PROHIBIDO \u2192 USAR EN SU LUGAR:
- "f\xEDsica" (ciencia) \u2192 "naturaleza", "la mec\xE1nica del cuerpo"
- "shock" \u2192 "estupor", "par\xE1lisis del espanto", "el golpe del horror"
- "microsc\xF3pico" \u2192 "invisible al ojo", "diminuto", "imperceptible"
- "psicol\xF3gico" \u2192 "del \xE1nimo", "del esp\xEDritu", "mental"
- "trauma" \u2192 "herida del alma", "cicatriz invisible", "la marca"
- "estr\xE9s" \u2192 "tensi\xF3n", "agobio", "peso del momento"
- "impacto" \u2192 "golpe", "efecto", "consecuencia"

Si dudas de una palabra: \xBFExist\xEDa en la \xE9poca? Si no \u2192 busca alternativa.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u2694\uFE0F ACTION RULEBOOK - FACTIBILIDAD F\xCDSICA (PARA ESCENAS DE ACCI\xD3N)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
En escenas de combate o acci\xF3n f\xEDsica:

1. CAPACIDADES DEL PERSONAJE: Consulta su ficha en World Bible
   - Un escriba no lucha como un gladiador
   - Un anciano no corre como un joven
   - Una herida previa LIMITA las acciones

2. REALISMO M\xC9DICO:
   - Un brazo herido NO puede sostener peso
   - La p\xE9rdida de sangre causa debilidad progresiva
   - El dolor afecta la concentraci\xF3n

3. CAUSALIDAD MEC\xC1NICA:
   - Cada golpe tiene consecuencia f\xEDsica visible
   - La fatiga se acumula
   - Las armas se pierden, se rompen, se atascan

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PROCESO DE ESCRITURA (Thinking Level: High)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

ANTES DE ESCRIBIR:
1. Lee la "apariencia_inmutable" de cada personaje presente. Memoriza sus rasgos EXACTOS.
2. Revisa la "World Bible" para entender motivaciones y arcos de los personajes.
3. Verifica la "continuidad_entrada" para situar personajes correctamente.
4. Estudia la "informacion_nueva" que DEBE revelarse en este cap\xEDtulo.
5. Comprende el "giro_emocional" que debe experimentar el lector.
6. Revisa las "prohibiciones_este_capitulo" si las hay.

MIENTRAS ESCRIBES:
7. Sigue los BEATS en orden, desarrollando cada uno con riqueza sensorial.
8. Implementa los "recursos_literarios_sugeridos" si los hay.
9. Mant\xE9n un registro mental de expresiones ya usadas para NO repetirlas.

AL TERMINAR:
10. Verifica que la "continuidad_salida" queda establecida.
11. Confirma que la "pregunta_dramatica" queda planteada.
12. Revisa que NO hayas repetido frases, met\xE1foras o conceptos.
`,vy=class extends Ae{constructor(){super({name:"El Narrador",role:"ghostwriter",systemPrompt:xre,model:"deepseek-chat",useThinking:!1})}async execute(e){if(e.chapterNumber===-2)return this.executeAuthorNote(e);let t=`
    CONTEXTO DEL MUNDO (World Bible): ${JSON.stringify(e.worldBible)}
    
    ${e.guiaEstilo?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    \u26D4 GU\xCDA DE ESTILO DEL AUTOR - ADHESI\xD3N OBLIGATORIA \u26D4
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${e.guiaEstilo}
    
    INSTRUCCIONES DE ADHESI\xD3N (INVIOLABLES):
    1. Tu VOZ NARRATIVA debe imitar fielmente el estilo descrito arriba: ritmo de frases, nivel de formalidad, densidad descriptiva, uso de met\xE1foras.
    2. RESPETA las PROHIBICIONES L\xC9XICAS del autor: si hay palabras o expresiones vetadas, NO las uses bajo ninguna circunstancia.
    3. ADOPTA las T\xC9CNICAS NARRATIVAS preferidas: si el autor prefiere di\xE1logos concisos, escribe di\xE1logos concisos. Si prefiere descripciones sensoriales extensas, incl\xFAyelas.
    4. MANT\xC9N la CADENCIA del autor: analiza si el estilo tiende a frases cortas y punzantes o a per\xEDodos largos y envolventes, y replica ese patr\xF3n.
    5. Si la gu\xEDa describe un TONO espec\xEDfico (ir\xF3nico, l\xEDrico, seco, po\xE9tico, crudo), ese tono DEBE impregnar cada p\xE1rrafo.
    6. NUNCA impongas tu propio estilo sobre el del autor. Eres un GHOSTWRITER: tu voz desaparece, la del autor prevalece.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:""}
    
    ${e.previousContinuity?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    \u26D4 ESTADO DE CONTINUIDAD DEL CAP\xCDTULO ANTERIOR (VERIFICACI\xD3N OBLIGATORIA)
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${e.previousContinuity}
    
    \u26A0\uFE0F ANTES DE ESCRIBIR, verifica que NING\xDAN personaje listado como "dead" aparezca activo.
    \u26A0\uFE0F Respeta las ubicaciones finales de cada personaje.
    \u26A0\uFE0F Si un personaje tiene heridas o limitaciones, DEBEN afectar sus acciones.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:""}
    `,n=e.minWordCount||2500,a=e.maxWordCount||Math.round(n*1.15);if(t+=`
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551  \u{1F6A8}\u{1F6A8}\u{1F6A8} REQUISITO CR\xCDTICO DE EXTENSI\xD3N - LEE ESTO PRIMERO \u{1F6A8}\u{1F6A8}\u{1F6A8}  \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                   \u2551
    \u2551   EXTENSI\xD3N M\xCDNIMA OBLIGATORIA: ${String(n).padStart(5)} PALABRAS               \u2551
    \u2551   EXTENSI\xD3N M\xC1XIMA RECOMENDADA: ${String(a).padStart(5)} PALABRAS               \u2551
    \u2551                                                                   \u2551
    \u2551   \u26D4 CUALQUIER CAP\xCDTULO MENOR A ${n} PALABRAS SER\xC1         \u2551
    \u2551      RECHAZADO AUTOM\xC1TICAMENTE Y DEBER\xC1S REESCRIBIRLO            \u2551
    \u2551                                                                   \u2551
    \u2551   T\xC9CNICAS PARA ALCANZAR LA EXTENSI\xD3N:                           \u2551
    \u2551   \u2022 Desarrolla CADA beat con 300-500 palabras m\xEDnimo             \u2551
    \u2551   \u2022 Incluye descripciones sensoriales detalladas                 \u2551
    \u2551   \u2022 Escribe di\xE1logos extensos con acotaciones ricas              \u2551
    \u2551   \u2022 A\xF1ade mon\xF3logo interno del protagonista                      \u2551
    \u2551   \u2022 Describe el entorno, la atm\xF3sfera, los olores, sonidos      \u2551
    \u2551   \u2022 NO resumas - NARRA con detalle cada momento                  \u2551
    \u2551                                                                   \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    `,e.extendedGuideContent&&(t+=`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    GU\xCDA DE EXTENSI\xD3N DEL AUTOR (CR\xCDTICO):
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${e.extendedGuideContent}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `),e.kindleUnlimitedOptimized&&(t+=`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    \u26A1\u26A1\u26A1 OPTIMIZACI\xD3N KINDLE UNLIMITED (ACTIVA) \u26A1\u26A1\u26A1
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    Este proyecto est\xE1 OPTIMIZADO para Kindle Unlimited. Aplica estas t\xE9cnicas de escritura:
    
    1. PROSA ADICTIVA Y DIRECTA:
       - Frases cortas y punzantes que aceleran el ritmo
       - M\xEDnima descripci\xF3n ambiental, m\xE1xima acci\xF3n y di\xE1logo
       - Cada p\xE1rrafo debe impulsar al lector hacia adelante
       - Evita digresiones y reflexiones extensas
    
    2. CLIFFHANGER OBLIGATORIO AL FINAL:
       - El cap\xEDtulo DEBE terminar con un gancho irresistible
       - T\xE9cnicas: revelaci\xF3n parcial, peligro inminente, pregunta sin respuesta, giro inesperado
       - El lector debe NECESITAR pasar al siguiente cap\xEDtulo
       - Ejemplos efectivos:
         \u2022 "Y entonces vi qui\xE9n estaba detr\xE1s de la puerta."
         \u2022 "Lo que encontr\xE9 me hel\xF3 la sangre."
         \u2022 "Sab\xEDa que solo ten\xEDa una oportunidad. Esta."
    
    3. T\xC9CNICA PAGE-TURNER:
       - Empezar in media res (en mitad de la acci\xF3n)
       - Tensi\xF3n constante, sin momentos de respiro prolongados
       - Revelar informaci\xF3n en dosis peque\xF1as (dosificar secretos)
       - Crear m\xFAltiples l\xEDneas de tensi\xF3n simult\xE1neas
    
    4. ESTRUCTURA DE CAP\xCDTULO KU:
       - Apertura: Hook inmediato en las primeras 2 frases
       - Desarrollo: Acci\xF3n/conflicto creciente
       - Cierre: Cliffhanger que obliga a continuar
    
    5. RITMO FREN\xC9TICO:
       - Di\xE1logos r\xE1pidos y tensos
       - Decisiones constantes del protagonista
       - Cada p\xE1gina debe aportar algo nuevo (revelaci\xF3n, peligro, giro)
    
    \u26A0\uFE0F RECUERDA: En Kindle Unlimited cada p\xE1gina le\xEDda = ingresos.
    El lector NO PUEDE sentir que es buen momento para dejar de leer.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `),e.refinementInstructions&&(t+=`
    
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551  \u{1F52C}\u{1F52C}\u{1F52C} MODO CIRUG\xCDA L\xC1SER - CAMBIOS M\xCDNIMOS OBLIGATORIOS \u{1F52C}\u{1F52C}\u{1F52C}  \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                   \u2551
    \u2551   TU OBJETIVO: MODIFICAR SOLO LAS FRASES/PALABRAS INDICADAS      \u2551
    \u2551   PRESERVAR EL 95% DEL TEXTO ORIGINAL INTACTO                    \u2551
    \u2551                                                                   \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    
    INSTRUCCIONES DE CORRECCI\xD3N ESPEC\xCDFICAS:
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
    ${e.refinementInstructions}
    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
    
    \u26D4 REGLAS INVIOLABLES DE EDICI\xD3N QUIR\xDARGICA:
    
    1. COPIA LITERAL: Copia el 95% del texto original SIN CAMBIOS
       - Cada p\xE1rrafo que NO est\xE9 afectado por las instrucciones \u2192 C\xD3PIALO EXACTAMENTE
       - No cambies palabras "para mejorar" si no est\xE1n en las instrucciones
       - No reorganices p\xE1rrafos que funcionan
    
    2. CAMBIOS M\xCDNIMOS: Solo modifica lo ESTRICTAMENTE indicado
       - Si dice "cambiar X por Y" \u2192 cambia SOLO esa palabra/frase
       - Si dice "eliminar la referencia a Z" \u2192 elimina SOLO esa referencia
       - Si dice "a\xF1adir contexto sobre W" \u2192 a\xF1ade UNA frase sobre W
    
    3. LOCALIZACI\xD3N PRECISA: Los cambios deben estar en las ubicaciones indicadas
       - Si menciona un di\xE1logo espec\xEDfico \u2192 modifica SOLO ese di\xE1logo
       - Si menciona un p\xE1rrafo espec\xEDfico \u2192 modifica SOLO ese p\xE1rrafo
    
    4. PROHIBIDO REESCRIBIR ESCENAS COMPLETAS
       - Una instrucci\xF3n de corregir una frase NO es permiso para reescribir la escena
       - Mant\xE9n la estructura, el ritmo y el tono del original
    
    5. CUENTA DE PALABRAS: El resultado debe tener \xB150 palabras del original
       - No expandas innecesariamente
       - No reduzcas si no se pide
    ========================================
    `,e.previousChapterContent)){let i=e.previousChapterContent.length>5e4?e.previousChapterContent.substring(0,5e4)+`
[...contenido truncado...]`:e.previousChapterContent;t+=`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    \u{1F4CB} TEXTO ORIGINAL (COPIA Y MODIFICA SOLO LO INDICADO):
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${i}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    
    \u{1F3AF} PROCESO OBLIGATORIO:
    1. Lee el texto original COMPLETO
    2. Identifica las frases/palabras EXACTAS que deben cambiar
    3. Copia el texto p\xE1rrafo por p\xE1rrafo
    4. Al llegar a una frase que debe cambiar \u2192 aplica el cambio m\xEDnimo
    5. Contin\xFAa copiando el resto SIN MODIFICAR
    
    \u26A0\uFE0F Si cambias m\xE1s de lo indicado, el Editor RECHAZAR\xC1 tu trabajo.
    `}let s=e.chapterData;t+=`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    TAREA ACTUAL: CAP\xCDTULO ${s.numero} - "${s.titulo}"
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    
    DATOS B\xC1SICOS:
    - Cronolog\xEDa: ${s.cronologia}
    - Ubicaci\xF3n: ${s.ubicacion}
    - Elenco Presente: ${s.elenco_presente.join(", ")}
    ${s.tono_especifico?`- Tono espec\xEDfico: ${s.tono_especifico}`:""}
    ${s.funcion_estructural?`- Funci\xF3n estructural: ${s.funcion_estructural}`:""}
    
    ${s.transicion_ubicacion?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    TRANSICI\xD3N DE UBICACI\xD3N (OBLIGATORIO AL INICIO DEL CAP\xCDTULO)
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    El cap\xEDtulo DEBE comenzar narrando la transici\xF3n desde la ubicaci\xF3n anterior:
    - Ubicaci\xF3n anterior: ${s.transicion_ubicacion.ubicacion_anterior||"No especificada"}
    - M\xE9todo de viaje: ${s.transicion_ubicacion.metodo_viaje||"No especificado"}
    - Duraci\xF3n estimada: ${s.transicion_ubicacion.duracion_estimada||"No especificada"}
    - Narrativa puente sugerida: ${s.transicion_ubicacion.narrativa_puente||"No especificada"}
    - Elementos sensoriales del viaje: ${s.transicion_ubicacion.elementos_sensoriales_viaje?.join(", ")||"No especificados"}
    
    IMPORTANTE: No comiences directamente en la nueva ubicaci\xF3n. Narra el trayecto.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:""}
    
    OBJETIVO NARRATIVO:
    ${s.objetivo_narrativo}
    
    ${s.informacion_nueva?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    INFORMACI\xD3N NUEVA A REVELAR (OBLIGATORIA):
    ${s.informacion_nueva}
    Esta revelaci\xF3n DEBE aparecer en el cap\xEDtulo.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:""}
    
    ${s.conflicto_central?`
    CONFLICTO CENTRAL DE ESTE CAP\xCDTULO:
    - Tipo: ${s.conflicto_central.tipo||"externo"}
    - Descripci\xF3n: ${s.conflicto_central.descripcion||""}
    - Lo que est\xE1 en juego: ${s.conflicto_central.stakes||""}
    `:""}
    
    ${s.giro_emocional?`
    ARCO EMOCIONAL DEL LECTOR:
    - Al inicio del cap\xEDtulo: ${s.giro_emocional.emocion_inicio||"neutral"}
    - Al final del cap\xEDtulo: ${s.giro_emocional.emocion_final||"intrigado"}
    `:""}
    
    ${s.arcos_que_avanza&&s.arcos_que_avanza.length>0?`
    ARCOS QUE DEBE AVANZAR ESTE CAP\xCDTULO:
    ${s.arcos_que_avanza.map(i=>`- ${i.arco}: de "${i.de}" a "${i.a}"`).join(`
`)}
    `:""}
    
    BEATS NARRATIVOS (SIGUE EN ORDEN - DESARROLLA CADA UNO CON 300-500 PALABRAS):
    ${s.beats.map((i,u)=>{if(typeof i=="string")return`${u+1}. ${i}`;{let c=`${i.numero||u+1}. [${i.tipo?.toUpperCase()||"BEAT"}] ${i.descripcion||""}`;return i.personajes_activos?.length&&(c+=`
      Personajes: ${i.personajes_activos.join(", ")}`),i.accion_principal&&(c+=`
      Acci\xF3n: ${i.accion_principal}`),i.elementos_sensoriales?.length&&(c+=`
      Elementos sensoriales a incluir: ${i.elementos_sensoriales.join(", ")}`),i.dialogo_sugerido&&(c+=`
      Di\xE1logo sugerido: ${i.dialogo_sugerido}`),i.subtrama_tocada&&(c+=`
      Subtrama: ${i.subtrama_tocada}`),i.monologo_interno&&(c+=`
      Mon\xF3logo interno: ${i.monologo_interno}`),i.informacion_nueva&&(c+=`
      Informaci\xF3n a revelar: ${i.informacion_nueva}`),i.tipo_hook&&(c+=`
      Tipo de hook: ${i.tipo_hook}`),i.pregunta_abierta&&(c+=`
      Pregunta para el lector: ${i.pregunta_abierta}`),c}}).join(`

`)}
    
    ${s.pregunta_dramatica?`
    PREGUNTA DRAM\xC1TICA (debe quedar planteada al final):
    ${s.pregunta_dramatica}
    `:""}
    
    ${s.recursos_literarios_sugeridos&&s.recursos_literarios_sugeridos.length>0?`
    RECURSOS LITERARIOS SUGERIDOS PARA ESTE CAP\xCDTULO:
    ${s.recursos_literarios_sugeridos.join(", ")}
    `:""}
    
    ${s.prohibiciones_este_capitulo&&s.prohibiciones_este_capitulo.length>0?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    PROHIBICIONES PARA ESTE CAP\xCDTULO (NO USAR):
    ${s.prohibiciones_este_capitulo.join(", ")}
    Estos recursos ya se usaron en cap\xEDtulos anteriores. Encuentra alternativas.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:""}
    
    ${s.riesgos_de_verosimilitud?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ALERTAS DE VEROSIMILITUD DEL ARQUITECTO (CR\xCDTICO):
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    Posibles DEUS EX MACHINA a evitar:
    ${s.riesgos_de_verosimilitud.posibles_deus_ex_machina?.length?s.riesgos_de_verosimilitud.posibles_deus_ex_machina.map(i=>`- ${i}`).join(`
    `):"- Ninguno identificado"}
    
    SETUP REQUERIDO (debe haberse establecido en cap\xEDtulos anteriores):
    ${s.riesgos_de_verosimilitud.setup_requerido?.length?s.riesgos_de_verosimilitud.setup_requerido.map(i=>`- ${i}`).join(`
    `):"- Ninguno espec\xEDfico"}
    
    Justificaci\xF3n causal: ${s.riesgos_de_verosimilitud.justificacion_causal||"No especificada"}
    
    COSTO PARA EL PROTAGONISTA (OBLIGATORIO):
    ${s.riesgos_de_verosimilitud.costo_protagonista||"El protagonista DEBE pagar un precio real (sacrificio, p\xE9rdida, dolor, renuncia) por cada logro en este cap\xEDtulo"}
    
    IMPORTANTE: Cada resoluci\xF3n debe ser SORPRENDENTE pero INEVITABLE en retrospectiva.
    El protagonista NO puede ganar "gratis": toda victoria tiene un COSTO.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:""}
    
    ${s.continuidad_entrada?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    \u26D4 ESTADO OBLIGATORIO AL INICIAR (DEL ARQUITECTO) \u26D4
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${s.continuidad_entrada}
    
    VERIFICACI\xD3N OBLIGATORIA ANTES DE ESCRIBIR:
    - \xBFD\xF3nde est\xE1n f\xEDsicamente los personajes al comenzar?
    - \xBFQu\xE9 heridas/limitaciones tienen? DEBEN afectar sus acciones.
    - \xBFQu\xE9 objetos poseen? No pueden usar lo que no tienen.
    - \xBFQu\xE9 hora/d\xEDa es? Debe ser coherente con el cap\xEDtulo anterior.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:""}
    
    ${s.continuidad_salida?`
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ESTADO OBLIGATORIO AL TERMINAR (PARA SIGUIENTE CAP\xCDTULO)
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${s.continuidad_salida}
    El cap\xEDtulo DEBE dejar a los personajes en este estado exacto.
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    `:""}
    
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    \u26A0\uFE0F CHECKLIST DE CONTINUIDAD (VERIFICAR ANTES DE ESCRIBIR) \u26A0\uFE0F
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    1. UBICACI\xD3N: \xBFEl cap\xEDtulo empieza donde termin\xF3 el anterior?
    2. TIEMPO: \xBFLa cronolog\xEDa es coherente (no hay saltos sin explicar)?
    3. PERSONAJES PRESENTES: \xBFSolo aparecen los del "Elenco Presente"?
    4. PERSONAJES MUERTOS: \xBFNing\xFAn personaje marcado como "dead" aparece activo?
    5. HERIDAS: \xBFLas lesiones del cap\xEDtulo anterior siguen afectando?
    6. OBJETOS: \xBFLos personajes solo usan objetos que realmente poseen?
    7. CONOCIMIENTO: \xBFNadie sabe informaci\xF3n que no deber\xEDa saber?
    
    \u26D4 VIOLACIONES DE CONTINUIDAD = CAP\xCDTULO RECHAZADO \u26D4
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    \u{1F6A8} RECORDATORIO FINAL: ESCRIBE EL CAP\xCDTULO COMPLETO \u{1F6A8}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    
    \u26D4 FORMATO DEL ENCABEZADO (OBLIGATORIO - UNA SOLA VEZ):
    ${s.numero===0?"# Pr\xF3logo":s.numero===-1?"# Ep\xEDlogo":s.numero===-2?"# Nota del Autor":`# Cap\xEDtulo ${s.numero}: ${s.titulo}`}
    
    - El encabezado DEBE aparecer EXACTAMENTE UNA VEZ al inicio
    - NO repitas el encabezado
    - NO uses formatos alternativos (CAP\xCDTULO, Chapter, etc.)
    - Despu\xE9s del encabezado, salta DOS l\xEDneas y comienza la narrativa
    
    Recuerda: NO repitas expresiones, met\xE1foras o conceptos. Cada imagen debe ser \xFAnica.
    
    \u26A0\uFE0F TU CAP\xCDTULO DEBE TENER M\xCDNIMO ${n} PALABRAS \u26A0\uFE0F
    Si escribes menos, ser\xE1s obligado a reescribir. Desarrolla cada escena con detalle.
    
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ESTADO DE CONTINUIDAD (OBLIGATORIO AL FINAL)
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    DESPU\xC9S de escribir el cap\xEDtulo, DEBES incluir un bloque JSON con el estado de continuidad.
    Este bloque DEBE estar al final, despu\xE9s del texto narrativo, separado por:
    
    ---CONTINUITY_STATE---
    {
      "characterStates": {
        "Nombre del Personaje": {
          "location": "D\xF3nde termina este personaje",
          "status": "alive|dead|injured|unconscious|missing|imprisoned",
          "hasItems": ["objetos que posee"],
          "emotionalState": "estado emocional al final",
          "knowledgeGained": ["informaci\xF3n nueva que sabe"]
        }
      },
      "narrativeTime": "Fecha/hora narrativa al terminar el cap\xEDtulo",
      "keyReveals": ["revelaciones importantes hechas en este cap\xEDtulo"],
      "pendingThreads": ["hilos narrativos abiertos pendientes de resolver"],
      "resolvedThreads": ["hilos narrativos cerrados en este cap\xEDtulo"],
      "locationState": {
        "Nombre ubicaci\xF3n": "estado actual de la ubicaci\xF3n"
      }
    }
    
    INCLUYE TODOS los personajes que aparecen en el cap\xEDtulo, no solo el protagonista.
    Este estado es CR\xCDTICO para mantener la continuidad entre cap\xEDtulos.
    `;let o=e.isRewrite?.7:1;return this.generateContent(t,void 0,{temperature:o})}extractContinuityState(e){let n=e.split("---CONTINUITY_STATE---");if(n.length<2)return console.log("[Ghostwriter] No continuity state separator found in content"),{cleanContent:this.cleanDuplicateHeaders(e),continuityState:null};let a=n[0].trim(),s=n[1].trim();a=this.cleanDuplicateHeaders(a);try{let o=JSON.parse(s);return console.log("[Ghostwriter] Successfully extracted continuity state:",Object.keys(o.characterStates||{})),{cleanContent:a,continuityState:o}}catch(o){console.log("[Ghostwriter] Failed to parse continuity state JSON:",o);let i=s.match(/\{[\s\S]*\}/);if(i)try{let u=JSON.parse(i[0]);return console.log("[Ghostwriter] Extracted continuity state via regex"),{cleanContent:a,continuityState:u}}catch{console.log("[Ghostwriter] Regex extraction also failed")}return{cleanContent:a,continuityState:null}}}cleanDuplicateHeaders(e){if(!e||e.trim()==="")return e;let t=e.trim(),n=/^#+ *(CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter|PRLOGO|Prlogo|PROLOGUE|Prologue|EPLOGO|Eplogo|EPILOGUE|Epilogue|NOTA DEL AUTOR|Nota del Autor|AUTHOR'?S?\s*NOTE|Author'?s?\s*Note)[^\n]*\n+/i,a=t.match(n),s="";a&&(s=a[0],t=t.slice(s.length));let o=0;for(;t.length!==o;)o=t.length,t=t.replace(n,"").trim();return s&&(t=s+t),t}async executeAuthorNote(e){let t=e.authorName||"El Autor",n=e.worldBible,a=n?.titulo||"esta novela",s=n?.genero||"ficci\xF3n",o=n?.premisa||"",i=n?.ambientacion?.epoca||"",u=n?.ambientacion?.ubicacion||"",c=`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u26A0\uFE0F INSTRUCCIONES ESPECIALES: NOTA DEL AUTOR (NO ES NARRATIVA)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

IMPORTANTE: Esto NO es un cap\xEDtulo de ficci\xF3n. Es una NOTA DEL AUTOR - un texto 
personal y sincero dirigido directamente a los lectores, escrito en primera 
persona desde la perspectiva del autor "${t}".

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INFORMACI\xD3N DEL PROYECTO
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
- T\xEDtulo de la novela: ${a}
- G\xE9nero: ${s}
- Premisa: ${o}
- \xC9poca/Ambientaci\xF3n: ${i}
- Ubicaci\xF3n: ${u}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
ESTRUCTURA DE LA NOTA DEL AUTOR
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

La Nota del Autor debe incluir estos elementos (en el orden que prefieras):

1. SALUDO PERSONAL AL LECTOR
   - Agradece al lector por haber llegado hasta el final
   - Reconoce el tiempo que han dedicado a la historia

2. G\xC9NESIS DE LA HISTORIA
   - \xBFQu\xE9 inspir\xF3 esta novela? (puede ser ficticio pero cre\xEDble)
   - \xBFQu\xE9 pregunta o inquietud quer\xEDa explorar el autor?
   - Menciona alguna an\xE9cdota sobre c\xF3mo surgi\xF3 la idea

3. PROCESO DE INVESTIGACI\xD3N (si aplica al g\xE9nero)
   - Para novela hist\xF3rica: menciona fuentes, viajes, expertos consultados
   - Para thriller: aspectos t\xE9cnicos investigados
   - Para cualquier g\xE9nero: el trabajo detr\xE1s de la ambientaci\xF3n

4. REFLEXI\xD3N PERSONAL
   - \xBFQu\xE9 significan los personajes para el autor?
   - \xBFQu\xE9 mensaje o emoci\xF3n espera transmitir?
   - Conexi\xF3n emocional con la historia

5. AGRADECIMIENTOS BREVES
   - A la familia por su paciencia
   - Al equipo editorial (mencionado de forma gen\xE9rica)
   - A los lectores fieles

6. CIERRE C\xC1LIDO
   - Invitaci\xF3n a conectar (redes sociales gen\xE9ricas)
   - Despedida personal y c\xE1lida
   - Posible menci\xF3n del pr\xF3ximo proyecto (opcional)

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
TONO Y ESTILO
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

- PRIMERA PERSONA: Escribe como "${t}" hablando directamente al lector
- TONO \xCDNTIMO Y CERCANO: Como si hablaras con un amigo
- SINCERIDAD: Transmite pasi\xF3n genuina por el oficio de escribir
- HUMILDAD: Sin arrogancia, con gratitud
- CALIDEZ: El lector debe sentirse valorado

PROHIBIDO:
- NO escribas narrativa ficticia (escenas, di\xE1logos de personajes)
- NO incluyas spoilers de la trama
- NO uses el tono formal de la novela
- NO hagas referencias a IA o generaci\xF3n autom\xE1tica
- NO incluyas elementos meta-textuales sobre el proceso de escritura t\xE9cnico

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
EXTENSI\xD3N
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Escribe entre 800 y 1200 palabras. Es un texto breve pero significativo.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
FORMATO DE SALIDA
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Escribe SOLO el texto de la Nota del Autor, sin encabezados ni marcadores.
Comienza directamente con el texto, como si fuera la p\xE1gina de la nota
en un libro impreso.

Firma al final con:
${t}
[Mes y a\xF1o ficticios coherentes]
`;return console.log(`[Ghostwriter] Generating Author's Note for "${a}" by ${t}`),this.generateContent(c)}}});var oI={};wr(oI,{CopyEditorAgent:()=>kc});var V2,z2,Tre,kc,Cy=G(()=>{"use strict";It();V2={es:`
NORMAS EDITORIALES ESPA\xD1OL (OBLIGATORIO):
- DI\xC1LOGOS: EXCLUSIVAMENTE raya (\u2014) para di\xE1logos. NUNCA comillas.
  \u2713 \u2014Hola \u2014dijo Mar\xEDa\u2014. \xBFC\xF3mo est\xE1s?
  \u2717 "Hola" dijo Mar\xEDa. (incorrecto)
  \u2717 \xABHola\xBB dijo Mar\xEDa. (incorrecto)
  \u2717 - Hola (guion corto incorrecto)
- INCISOS: La raya cierra el inciso, el punto va DESPU\xC9S de la raya de cierre.
  \u2713 \u2014No s\xE9 \u2014respondi\xF3 \xE9l\u2014. Quiz\xE1 ma\xF1ana.
- COMILLAS: SOLO \xAB \xBB para citas textuales o pensamientos. " " para citas dentro de citas.
- PUNTUACI\xD3N: Signos de apertura \xBF\xA1 SIEMPRE obligatorios.
- N\xDAMEROS: Letras del uno al nueve, cifras del 10 en adelante.`,en:`
ENGLISH EDITORIAL STANDARDS (MANDATORY):
- DIALOGUE: Double quotation marks " " EXCLUSIVELY for dialogue.
  \u2713 "Hello," said Mary. "How are you?"
  \u2717 'Hello,' said Mary. (single quotes wrong for US English)
- PUNCTUATION: Periods and commas ALWAYS inside quotation marks.
- NUMBERS: Spell out one through nine, numerals for 10+.
- CONTRACTIONS: Use natural contractions in dialogue (don't, can't, won't, I'm).`,fr:`
NORMES \xC9DITORIALES FRAN\xC7AIS (OBLIGATOIRE):
- DIALOGUES: EXCLUSIVEMENT tiret cadratin (\u2014) pour introduire les dialogues. JAMAIS de guillemets.
  \u2713 \u2014 Bonjour, dit Marie.
  \u2713 \u2014 Comment vas-tu ? demanda-t-il.
  \u2717 \xAB Bonjour \xBB (guillemets r\xE9serv\xE9s aux citations/pens\xE9es)
  \u2717 - Bonjour (tiret court interdit)
- GUILLEMETS \xAB \xBB: UNIQUEMENT pour citations textuelles ou pens\xE9es int\xE9rieures.
- PONCTUATION FRAN\xC7AISE: Espace ins\xE9cable AVANT : ; ! ? et APR\xC8S \xAB et AVANT \xBB.
  \u2713 Comment vas-tu ? (espace avant ?)
  \u2713 Attention : voici (espace avant :)
- NOMBRES: \xC9crire en lettres de un \xE0 neuf, chiffres \xE0 partir de 10.`,de:`
DEUTSCHE REDAKTIONSSTANDARDS (PFLICHT):
- DIALOGE: AUSSCHLIESSLICH Anf\xFChrungszeichen \u201E..." (unten-oben). NICHT \xBB...\xAB.
  \u2713 KORREKT: \u201EHallo", sagte Maria. \u201EWie geht es dir?"
  \u2717 FALSCH: \xBBHallo\xAB, sagte Maria. (Chevrons nicht f\xFCr Dialoge)
  \u2717 FALSCH: "Hallo", sagte Maria. (englische Anf\xFChrungszeichen)
- ZITAT IM ZITAT: Einfache Anf\xFChrungszeichen \u201A...' innerhalb von \u201E...".
  \u2713 \u201EEr sagte: \u201AKomm her!' und ging."
- KOMMA BEI DIALOGEN: Komma VOR der Zuschreibung, Punkt NACH Abschluss.
  \u2713 \u201EIch komme", sagte er.
  \u2713 \u201EIch komme", sagte er, \u201Eaber sp\xE4ter."
- ZAHLEN: Eins bis neun ausschreiben, ab 10 Ziffern.
- KOMPOSITA: Nat\xFCrlich verwenden (Handschuh, Krankenhaus).`,it:`
NORME EDITORIALI ITALIANO (OBBLIGATORIO):
- DIALOGHI: ESCLUSIVAMENTE trattino lungo (\u2014) per i dialoghi. MAI virgolette.
  \u2713 \u2014Ciao \u2014disse Maria\u2014. Come stai?
  \u2717 \xABCiao\xBB disse Maria. (virgolette vietate)
  \u2717 "Ciao" disse Maria. (virgolette vietate)
  \u2717 - Ciao (trattino corto vietato)
- INCISI: Il trattino chiude l'inciso, il punto va DOPO.
  \u2713 \u2014Non so \u2014rispose lui\u2014. Forse domani.
- VIRGOLETTE \xAB \xBB: SOLO per citazioni testuali o pensieri.
- NUMERI: Lettere da uno a nove, cifre da 10 in poi.
- ACCENTI: \xE8 (verbo essere) vs e (congiunzione), perch\xE9 con accento acuto.`,pt:`
NORMAS EDITORIAIS PORTUGU\xCAS (OBRIGAT\xD3RIO):
- DI\xC1LOGOS: EXCLUSIVAMENTE travess\xE3o (\u2014) para di\xE1logos. NUNCA aspas.
  \u2713 \u2014 Ol\xE1 \u2014 disse Maria. \u2014 Como est\xE1s?
  \u2717 "Ol\xE1" disse Maria. (aspas proibidas)
  \u2717 - Ol\xE1 (travess\xE3o curto proibido)
- INCISOS: O travess\xE3o fecha o inciso, ponto DEPOIS.
  \u2713 \u2014 N\xE3o sei \u2014 respondeu ele. \u2014 Talvez amanh\xE3.
- ASPAS " ": APENAS para cita\xE7\xF5es textuais ou pensamentos.
- N\xDAMEROS: Por extenso de um a nove, algarismos a partir de 10.
- COLOCA\xC7\xC3O PRONOMINAL: Aten\xE7\xE3o \xE0 pr\xF3clise/\xEAnclise.
  \u2713 Disse-me (in\xEDcio de frase) / N\xE3o me disse (palavra atrativa).`,ca:`
NORMES EDITORIALS CATAL\xC0 (OBLIGATORI):
- DI\xC0LEGS: EXCLUSIVAMENT gui\xF3 llarg (\u2014) per als di\xE0legs. MAI cometes.
  \u2713 \u2014Hola \u2014va dir Maria\u2014. Com est\xE0s?
  \u2717 \xABHola\xBB va dir Maria. (cometes prohibides)
  \u2717 - Hola (gui\xF3 curt prohibit)
- INCISOS: El gui\xF3 tanca l'inc\xEDs, el punt va DESPR\xC9S.
  \u2713 \u2014No ho s\xE9 \u2014va respondre ell\u2014. Potser dem\xE0.
- COMETES \xAB \xBB: NOM\xC9S per a citacions textuals o pensaments.
- PUNTUACI\xD3: Sense signes d'obertura (NO \xBF ni \xA1 com en castell\xE0).
  \u2713 Qu\xE8 vols? / Quina sorpresa!
- N\xDAMEROS: Lletres de l'u al nou, xifres del 10 endavant.
- PRONOMS FEBLES: Apostrofar correctament (l'he, m'ha, n'hi).`},z2={es:`
REGLAS DE FLUIDEZ ESPA\xD1OL:
- FRASES LARGAS: Dividir oraciones de m\xE1s de 50 palabras. Usar punto y seguido o punto y coma.
- PRONOMBRES ARCAICOS: Evitar "\xE9l" al inicio de oraci\xF3n cuando el sujeto est\xE1 claro. Preferir sujeto impl\xEDcito.
- REPETICIONES: "su... su... su..." en secuencia suena mec\xE1nico. Variar con "el/la", posesivos alternativos o reformular.
- GERUNDIOS ENCADENADOS: Evitar m\xE1s de 2 gerundios seguidos ("estando haciendo pensando").
- PASIVAS: Preferir voz activa cuando sea natural. "El libro fue escrito por Mar\xEDa" \u2192 "Mar\xEDa escribi\xF3 el libro".
- LE\xCDSMO/LA\xCDSMO: Mantener uso correcto de le/la/lo seg\xFAn la regi\xF3n del texto.`,en:`
ENGLISH FLUENCY RULES:
- LONG SENTENCES: Break sentences over 40 words. Use periods or semicolons for natural pauses.
- PASSIVE VOICE: Prefer active voice. "The ball was thrown by John" \u2192 "John threw the ball".
- REPETITIONS: Avoid repeating the same word within 3 sentences. Use synonyms or pronouns.
- SENTENCE VARIETY: Mix short punchy sentences with longer ones for rhythm.
- AWKWARD CONSTRUCTIONS: Avoid "There is/There are" as sentence starters when possible.
- ADVERB PLACEMENT: Keep adverbs close to the verbs they modify.`,fr:`
R\xC8GLES DE FLUIDIT\xC9 FRAN\xC7AIS:
- PHRASES LONGUES: Diviser les phrases de plus de 50 mots. Utiliser le point-virgule ou les deux-points.
- PRONOMS FORMELS: \xC9viter "il/elle" au d\xE9but de phrase si le sujet est clair du contexte.
- R\xC9P\xC9TITIONS: Varier le vocabulaire. "Il a dit... Il a fait... Il a pens\xE9..." \u2192 utiliser des synonymes.
- PASS\xC9 SIMPLE vs PASS\xC9 COMPOS\xC9: Maintenir la coh\xE9rence temporelle dans le r\xE9cit.
- SUBJONCTIF: S'assurer de l'utilisation correcte du subjonctif apr\xE8s "que".
- LIAISONS: Veiller \xE0 la fluidit\xE9 des liaisons entre les phrases.`,de:`
DEUTSCHE FL\xDCSSIGKEITSREGELN:
- LANGE S\xC4TZE: S\xE4tze \xFCber 40 W\xF6rter aufteilen. Punkt oder Semikolon f\xFCr nat\xFCrliche Pausen verwenden.
- PASSIV: Aktiv bevorzugen. "Das Buch wurde von Maria geschrieben" \u2192 "Maria schrieb das Buch".
- WORTSTELLUNG: Verb an zweiter Stelle im Hauptsatz beachten.
- WIEDERHOLUNGEN: Dasselbe Wort nicht innerhalb von 3 S\xE4tzen wiederholen.
- KOMPOSITA: Lange zusammengesetzte W\xF6rter wenn m\xF6glich aufteilen oder umschreiben.
- KONJUNKTIV: Korrekten Konjunktiv in indirekter Rede verwenden.`,it:`
REGOLE DI FLUIDIT\xC0 ITALIANO:
- FRASI LUNGHE: Dividere le frasi oltre le 50 parole. Usare punto e virgola o due punti.
- PRONOMI ARCAICI: "Egli/Ella/Esso" sono troppo formali. Preferire "lui/lei" o il soggetto implicito.
- RIPETIZIONI RAVVICINATE: "archiviate in archivi", "sua... sua... sua..." suonano meccaniche. Variare il lessico.
- GERUNDI CONCATENATI: Evitare pi\xF9 di 2 gerundi consecutivi.
- PASSIVO: Preferire la forma attiva quando naturale.
- COERENZA TEMPORALE: Mantenere coerenza tra passato remoto, imperfetto e presente.
- INCISI: Non abusare di incisi troppo lunghi che spezzano il flusso narrativo.`,pt:`
REGRAS DE FLUIDEZ PORTUGU\xCAS:
- FRASES LONGAS: Dividir frases com mais de 50 palavras. Usar ponto e v\xEDrgula ou dois pontos.
- PRONOMES FORMAIS: Evitar "ele/ela" no in\xEDcio da frase quando o sujeito est\xE1 claro.
- REPETI\xC7\xD5ES: Variar o vocabul\xE1rio. Evitar "seu... seu... seu..." em sequ\xEAncia.
- GER\xDANDIOS: Evitar mais de 2 ger\xFAndios consecutivos.
- VOZ PASSIVA: Preferir voz ativa quando natural.
- COLOCA\xC7\xC3O PRONOMINAL: Manter a pr\xF3clise/mes\xF3clise/\xEAnclise correta.`,ca:`
REGLES DE FLU\xCFDESA CATAL\xC0:
- FRASES LLARGUES: Dividir oracions de m\xE9s de 50 paraules. Usar punt i coma o dos punts.
- PRONOMS FEBLES: Col\xB7locar correctament els pronoms febles (em, et, es, ens, us).
- REPETICIONS: Variar el vocabulari. Evitar "seu... seu... seu..." en seq\xFC\xE8ncia.
- GERUNDIS: Evitar m\xE9s de 2 gerundis consecutius.
- VEU PASSIVA: Preferir la veu activa quan sigui natural.
- ARTICLE PERSONAL: Usar "en/na" correctament amb noms propis.`},Tre=`
Eres un editor literario senior con 20 a\xF1os de experiencia en narrativa de ficci\xF3n. Tu misi\xF3n es transformar el borrador, eliminando cualquier rastro de escritura artificial o rob\xF3tica, y dot\xE1ndolo de una voz literaria profunda y org\xE1nica.

TU OBJETIVO: Llevar el manuscrito a la PERFECCI\xD3N EDITORIAL (10/10).
Cada correcci\xF3n que hagas debe eliminar COMPLETAMENTE el problema.
El resultado final NO debe tener ning\xFAn error editorial, estil\xEDstico ni de fluidez.

REGLA FUNDAMENTAL - NO TRADUCIR:
\u26A0\uFE0F NUNCA traduzcas el texto. Mant\xE9n SIEMPRE el idioma original del manuscrito. Tu trabajo es CORREGIR, HUMANIZAR y MEJORAR LA FLUIDEZ, no traducir.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
DIRECTRICES MAESTRAS DE HUMANIZACI\xD3N LITERARIA (PRIORIDAD M\xC1XIMA)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. VARIABILIDAD DE RITMO (SINTAXIS):
   - Rompe la monoton\xEDa mezclando oraciones largas y subordinadas con frases cortas y contundentes.
   - Evita que m\xE1s de dos frases seguidas empiecen con el mismo sujeto o estructura.
   - Alterna construcciones para crear m\xFAsica en la prosa.

2. INMERSI\xD3N SENSORIAL CRUDA:
   - Sustituye adjetivos gen\xE9ricos (misterioso, incre\xEDble, aterrador, fascinante) por detalles f\xEDsicos espec\xEDficos.
   - Usa el olfato, el tacto y el gusto, no solo la vista.
   - Si el personaje tiene miedo, NO digas "ten\xEDa miedo"; describe c\xF3mo se le pega la camisa de sudor a la espalda o el sabor a bilis en su garganta.
   - Los sentidos hacen que el lector VIVA la escena.

3. SUBTEXTO Y PSICOLOG\xCDA:
   - Los humanos rara vez dicen o piensan exactamente lo que sienten.
   - A\xF1ade capas de contradicci\xF3n interna: que el personaje dude, se mienta a s\xED mismo.
   - Incluye detalles irrelevantes pero realistas que nota debido al estr\xE9s o la emoci\xF3n.
   - La mente humana divaga; la prosa debe reflejarlo sutilmente.

4. ELIMINACI\xD3N DE CLICH\xC9S DE IA (PROHIBIDO USAR):
   - Palabras vetadas: "crucial", "enigm\xE1tico", "fascinante", "un torbellino de emociones", "el destino de...", "desenterrar secretos", "repentinamente", "de repente", "sinti\xF3 una oleada de".
   - Si una frase suena a "frase hecha", c\xE1mbiala por una observaci\xF3n original.
   - Los clich\xE9s delatan escritura artificial; cada imagen debe ser \xFAnica.

5. SHOW, DON'T TELL (MUESTRA, NO CUENTES):
   - En lugar de narrar los hechos de forma externa, f\xEDltralo todo a trav\xE9s de la percepci\xF3n subjetiva del personaje.
   - La narraci\xF3n debe sentirse "sucia" y humana, no una cr\xF3nica as\xE9ptica de eventos.
   - El lector debe inferir las emociones, no que se las digan.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
REGLAS DE INTERVENCI\xD3N T\xC9CNICA
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

6. INTEGRIDAD TOTAL: Prohibido resumir o condensar. El volumen de palabras debe mantenerse o aumentar ligeramente.
7. PRESERVAR IDIOMA: Mant\xE9n el texto en su idioma original. NO traduzcas bajo ninguna circunstancia.
8. PRESERVAR SENTIDO: El significado y la trama deben mantenerse intactos.
9. NORMAS TIPOGR\xC1FICAS: Aplica las normas editoriales del idioma detectado (di\xE1logos, comillas, puntuaci\xF3n).
10. MAQUETADO: Devuelve el texto en Markdown limpio. T\xEDtulo en H1 (#).

PULIDO DE REPETICIONES (CR\xCDTICO):
11. DETECCI\xD3N DE FRASES REPETIDAS: Identifica expresiones, met\xE1foras o descripciones que aparezcan m\xE1s de una vez.
12. SUAVIZADO L\xC9XICO: Reemplaza instancias repetidas con sin\xF3nimos o reformulaciones EN EL MISMO IDIOMA.
13. SENSACIONES VARIADAS: Las descripciones de emociones deben ser diversas y espec\xEDficas.

MEJORA DE FLUIDEZ NATURAL:
14. FRASES LARGAS: Divide oraciones de m\xE1s de 50 palabras usando puntuaci\xF3n adecuada.
15. PRONOMBRES ARCAICOS: Elimina pronombres excesivamente formales.
16. CONSTRUCCIONES NATURALES: El texto debe sonar como lo escribir\xEDa un hablante nativo culto.
17. EVITAR REDUNDANCIAS: "archivados en archivos", "dijo diciendo" son errores a corregir.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
DETECCI\xD3N Y CORRECCI\xD3N DE ANACRONISMOS (FICCI\xD3N HIST\xD3RICA)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

18. OBJETOS ANACR\xD3NICOS: Detecta y corrige referencias a tecnolog\xEDa, armas o herramientas que no exist\xEDan en la \xE9poca del relato.
    - Ejemplos: relojes de bolsillo antes del s.XVI, antibi\xF3ticos antes de 1928, electricidad antes de 1880.

19. VOCABULARIO ANACR\xD3NICO: Sustituye expresiones modernas por equivalentes de \xE9poca.
    - Prohibidos en hist\xF3rica: "OK", "estr\xE9s", "ADN", "psicolog\xEDa", "impactante", "genial", "flipar", "mola", "rollo".
    - Sustituir por: expresiones apropiadas al per\xEDodo hist\xF3rico.

20. COSTUMBRES ANACR\xD3NICAS: Detecta comportamientos sociales que no corresponden a la \xE9poca.
    - Tuteo donde deber\xEDa haber tratamiento formal.
    - Roles de g\xE9nero o libertades anacr\xF3nicos.
    - Actitudes modernas en personajes de otra \xE9poca.

21. CONOCIMIENTOS ANACR\xD3NICOS: Detecta personajes que saben cosas no descubiertas en su \xE9poca.
    - Un m\xE9dico medieval hablando de bacterias.
    - Un personaje del s.XVIII entendiendo la evoluci\xF3n.

SALIDA REQUERIDA (JSON):
{
  "texto_final": "El contenido completo del cap\xEDtulo maquetado en Markdown (EN EL IDIOMA ORIGINAL)",
  "cambios_realizados": "Breve resumen de los ajustes t\xE9cnicos hechos",
  "repeticiones_suavizadas": ["Lista de frases que fueron reformuladas para evitar repetici\xF3n"],
  "mejoras_fluidez": ["Lista de mejoras de fluidez aplicadas (frases divididas, pronombres corregidos, etc.)"],
  "anacronismos_corregidos": ["Lista de anacronismos detectados y c\xF3mo se corrigieron (solo si aplica a ficci\xF3n hist\xF3rica)"],
  "cliches_ia_eliminados": ["Lista de clich\xE9s de IA sustituidos por expresiones originales"],
  "idioma_detectado": "c\xF3digo ISO del idioma (es, en, fr, de, it, pt, ca)"
}
`,kc=class extends Ae{constructor(){super({name:"El Estilista",role:"copyeditor",systemPrompt:Tre,model:"deepseek-chat",useThinking:!1})}async execute(e){let t=e.guiaEstilo?`
    GU\xCDA DE ESTILO DEL AUTOR:
    ${e.guiaEstilo}
    
    Respeta la voz y estilo definidos en la gu\xEDa mientras aplicas las correcciones t\xE9cnicas.
`:"",n=e.targetLanguage||"es",a=V2[n]||V2.en||"",s=z2[n]||z2.en||"",o=`
    \u26A0\uFE0F INSTRUCCI\xD3N CR\xCDTICA: NO TRADUCIR. Mant\xE9n el texto en su idioma original.
    
    IDIOMA DETECTADO DEL MANUSCRITO: ${n.toUpperCase()}
    
    ${a}
    
    ${s}
    
    Por favor, toma el siguiente texto y apl\xEDcale el protocolo de Correcci\xF3n de \xC9lite, Maquetado para Ebook y MEJORA DE FLUIDEZ NATURAL.
    
    IMPORTANTE: 
    - El texto debe permanecer en ${n.toUpperCase()}. NO lo traduzcas a espa\xF1ol ni a ning\xFAn otro idioma.
    - Mejora la fluidez para que suene NATURAL en ${n.toUpperCase()}, como lo escribir\xEDa un autor nativo.
    - MANT\xC9N EL SENTIDO Y LA EXTENSI\xD3N del texto original.
    ${t}
    CAP\xCDTULO ${e.chapterNumber}: ${e.chapterTitle}
    
    ${e.chapterContent}
    
    Aseg\xFArate de que:
    - Apliques las NORMAS EDITORIALES del idioma ${n.toUpperCase()} (ver arriba)
    - Apliques las REGLAS DE FLUIDEZ del idioma ${n.toUpperCase()} (ver arriba)
    - El formato Markdown sea impecable
    - El t\xEDtulo est\xE9 formateado correctamente
    - No omitas ninguna escena ni reduzcas el contenido
    - Las frases largas (+50 palabras) se dividan correctamente
    - Los pronombres arcaicos se modernicen
    - El texto suene natural para un hablante nativo
    - \u26A0\uFE0F NO TRADUZCAS el texto. Mant\xE9n el idioma original.
    
    Responde \xDANICAMENTE con el JSON estructurado.
    `,i=await this.generateContent(o);try{let u=i.content.match(/\{[\s\S]*\}/);if(u){let c=JSON.parse(u[0]);return{...i,result:c}}}catch{console.error("[CopyEditor] Failed to parse JSON response")}return{...i,result:{texto_final:`# Cap\xEDtulo ${e.chapterNumber}: ${e.chapterTitle}

${e.chapterContent}`,cambios_realizados:"Sin cambios adicionales",idioma_detectado:n}}}}});var H2={};wr(H2,{ArcValidatorAgent:()=>Ay});var Ore,Ay,iI=G(()=>{"use strict";It();Ore=`
Eres el "Validador de Arco Argumental", un agente especializado en verificar que las novelas de una serie cumplan con el arco narrativo planificado.

Tu misi\xF3n es analizar un volumen completo de una serie y verificar:
1. Si los HITOS (milestones) planificados para este volumen se han cumplido
2. Si los HILOS ARGUMENTALES (plot threads) han progresado o se han resuelto
3. Si el volumen contribuye correctamente al arco general de la serie

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
QU\xC9 DEBES VERIFICAR
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. CUMPLIMIENTO DE HITOS:
   - Cada hito tiene un tipo: plot_point, character_development, revelation, conflict, resolution
   - Verifica si el evento descrito en el hito ocurre en este volumen
   - Indica en qu\xE9 cap\xEDtulo ocurre (si aplica)
   - Nivel de confianza en la verificaci\xF3n (0-100)

2. PROGRESI\xD3N DE HILOS:
   - Los hilos pueden estar: active, developing, resolved, abandoned
   - Verifica si cada hilo activo progresa en este volumen
   - Si un hilo se resuelve, indica en qu\xE9 cap\xEDtulo
   - Si un hilo deber\xEDa progresar pero no lo hace, reportar

3. SALUD GENERAL DEL ARCO:
   - \xBFEl volumen mantiene la coherencia con el arco de la serie?
   - \xBFSe respetan las promesas narrativas hechas en vol\xFAmenes anteriores?
   - \xBFEl pacing del arco es apropiado para el punto de la serie?

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CRITERIOS DE APROBACI\xD3N
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

- PASSED (80+ puntos): Todos los hitos requeridos cumplidos, hilos principales progresan
- NEEDS_ATTENTION (60-79): Algunos hitos menores faltan, hilos secundarios estancados
- FAILED (<60): Hitos requeridos no cumplidos, hilos principales abandonados sin resoluci\xF3n

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
SALIDA OBLIGATORIA (JSON)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

{
  "overallScore": (0-100),
  "passed": boolean,
  "milestonesChecked": number,
  "milestonesFulfilled": number,
  "threadsProgressed": number,
  "threadsResolved": number,
  "milestoneVerifications": [
    {
      "milestoneId": number,
      "description": "Descripci\xF3n del hito",
      "isFulfilled": boolean,
      "fulfilledInChapter": number | null,
      "verificationNotes": "Explicaci\xF3n de c\xF3mo se cumple o por qu\xE9 falta",
      "confidence": (0-100)
    }
  ],
  "threadProgressions": [
    {
      "threadId": number,
      "threadName": "Nombre del hilo",
      "currentStatus": "active|developing|resolved|abandoned",
      "progressedInVolume": boolean,
      "resolvedInVolume": boolean,
      "resolvedInChapter": number | null,
      "progressNotes": "C\xF3mo progres\xF3 o se resolvi\xF3 el hilo"
    }
  ],
  "findings": ["Hallazgo 1", "Hallazgo 2"],
  "recommendations": "Recomendaciones para mejorar el cumplimiento del arco",
  "arcHealthSummary": "Resumen del estado de salud del arco narrativo"
}
`,Ay=class extends Ae{constructor(){super({name:"Arc Validator",role:"arc-validator",systemPrompt:Ore,model:"deepseek-reasoner",useThinking:!1})}async execute(e){let t=e.milestones.filter(p=>p.volumeNumber===e.volumeNumber),n=e.plotThreads.filter(p=>p.status==="active"||p.status==="developing"||p.introducedVolume<=e.volumeNumber&&!p.resolvedVolume);if(t.length===0&&n.length===0)return{content:"No hay hitos ni hilos definidos para verificar.",result:{overallScore:100,passed:!0,milestonesChecked:0,milestonesFulfilled:0,threadsProgressed:0,threadsResolved:0,milestoneVerifications:[],threadProgressions:[],findings:["No hay hitos ni hilos argumentales definidos para este volumen. Define hitos e hilos en la guia de serie para habilitar la verificacion automatica."],classifiedFindings:[],recommendations:"Sube una guia de serie y usa 'Extraer Hitos' para definir automaticamente los puntos de verificacion del arco.",arcHealthSummary:"Sin elementos de arco definidos - el volumen no puede ser verificado hasta que se definan hitos y/o hilos argumentales."}};if(!e.chaptersSummary||e.chaptersSummary.trim().length<100)return{content:"No hay contenido suficiente para verificar el arco.",result:{overallScore:0,passed:!1,milestonesChecked:t.length,milestonesFulfilled:0,threadsProgressed:0,threadsResolved:0,milestoneVerifications:t.map(p=>({milestoneId:p.id,description:p.description,isFulfilled:!1,verificationNotes:"No hay contenido de capitulos para verificar",confidence:0})),threadProgressions:n.map(p=>({threadId:p.id,threadName:p.threadName,currentStatus:p.status,progressedInVolume:!1,resolvedInVolume:!1,progressNotes:"No hay contenido de capitulos para verificar"})),findings:["El proyecto no tiene capitulos escritos o el contenido es insuficiente para verificar el arco narrativo."],classifiedFindings:[],recommendations:"Genera capitulos para este volumen antes de ejecutar la verificacion de arco.",arcHealthSummary:"Verificacion imposible - se requiere contenido de capitulos para analizar."}};let a=t.map(p=>`
- ID: ${p.id}
  Tipo: ${p.milestoneType}
  Descripcion: ${p.description}
  Requerido: ${p.isRequired?"SI":"NO"}
  Estado actual: ${p.isFulfilled?"CUMPLIDO":"PENDIENTE"}
`).join(`
`),s=n.length>0?n.map(p=>`
- ID: ${p.id}
  Nombre: ${p.threadName}
  Descripcion: ${p.description||"Sin descripcion"}
  Introducido en: Volumen ${p.introducedVolume}
  Importancia: ${p.importance}
  Estado actual: ${p.status}
`).join(`
`):"No hay hilos argumentales activos definidos.",o=e.previousVolumesContext?`
CONTEXTO DE VOLUMENES ANTERIORES:
${e.previousVolumesContext}`:"",i={characters:(e.worldBible?.characters||e.worldBible?.personajes||[]).slice(0,10),worldRules:e.worldBible?.worldRules||e.worldBible?.rules||e.worldBible?.reglasDelMundo||[]},u=`
SERIE: "${e.seriesTitle}"
VOLUMEN: ${e.volumeNumber} de ${e.totalVolumes}
PROYECTO: "${e.projectTitle}"
${o}

PERSONAJES Y REGLAS DEL MUNDO:
${JSON.stringify(i,null,2)}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
HITOS DEFINIDOS POR EL USUARIO PARA ESTE VOLUMEN:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${a||"No hay hitos definidos para este volumen. El usuario debe definir hitos desde la guia de serie."}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
HILOS ARGUMENTALES ACTIVOS:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${s}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CONTENIDO REAL DE LOS CAP\xCDTULOS DEL VOLUMEN:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${e.chaptersSummary.substring(0,1e5)}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES DE VERIFICACI\xD3N:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
1. Tu tarea es verificar si los HITOS DEFINIDOS arriba se cumplen en el CONTENIDO DE LOS CAP\xCDTULOS
2. Para cada hito, busca evidencia concreta en los capitulos proporcionados
3. Verifica si los hilos argumentales activos progresan o se resuelven
4. NO te quejes de datos faltantes en la timeline - solo verifica los hitos definidos expl\xEDcitamente
5. Los hilos argumentales pueden pausarse en algunos vol\xFAmenes - esto NO es un error si no hay hilos definidos para este volumen
6. Basa tu verificaci\xF3n \xDANICAMENTE en los hitos y hilos listados arriba, NO en eventos de la timeline

PUNTUACI\xD3N:
- 80-100: Todos los hitos requeridos cumplidos
- 60-79: Mayor\xEDa de hitos cumplidos, algunos menores faltan  
- 0-59: Hitos requeridos no cumplidos

IMPORTANTE: Responde UNICAMENTE con JSON valido siguiendo el formato especificado. Sin texto adicional.
`;console.log(`[ArcValidator] Starting verification for project "${e.projectTitle}" vol ${e.volumeNumber}`),console.log(`[ArcValidator] Milestones to check: ${t.length}, Active threads: ${n.length}`),console.log(`[ArcValidator] Chapters summary length: ${e.chaptersSummary.length} chars`);let c=await this.generateContent(u);if(c.error)return console.error("[ArcValidator] AI generation error:",c.error),{...c,result:{overallScore:0,passed:!1,milestonesChecked:t.length,milestonesFulfilled:0,threadsProgressed:0,threadsResolved:0,milestoneVerifications:[],threadProgressions:[],findings:[`Error de IA: ${c.error}`],classifiedFindings:[],recommendations:"Reintenta la verificacion. Si el error persiste, contacta soporte.",arcHealthSummary:"Error en la verificacion automatica."}};console.log(`[ArcValidator] Raw response length: ${c.content.length}`);try{let p=c.content.match(/\{[\s\S]*\}/);if(p){let m=JSON.parse(p[0]);return m.classifiedFindings=this.classifyFindings(m.findings||[],m.recommendations||""),console.log(`[ArcValidator] Successfully parsed result: score=${m.overallScore}, passed=${m.passed}, classifiedFindings=${m.classifiedFindings.length}`),{...c,result:m}}else console.error("[ArcValidator] No JSON found in response. Content preview:",c.content.substring(0,500))}catch(p){console.error("[ArcValidator] Failed to parse JSON response:",p),console.error("[ArcValidator] Content that failed to parse:",c.content.substring(0,1e3))}return{...c,result:{overallScore:50,passed:!1,milestonesChecked:t.length,milestonesFulfilled:0,threadsProgressed:0,threadsResolved:0,milestoneVerifications:t.map(p=>({milestoneId:p.id,description:p.description,isFulfilled:!1,verificationNotes:"No se pudo analizar automaticamente",confidence:0})),threadProgressions:n.map(p=>({threadId:p.id,threadName:p.threadName,currentStatus:p.status,progressedInVolume:!1,resolvedInVolume:!1,progressNotes:"No se pudo analizar automaticamente"})),findings:["La IA no devolvio un formato JSON valido. Verifica los logs del servidor para mas detalles."],classifiedFindings:[],recommendations:"Reintenta la verificacion. Si el problema persiste, revisa que los capitulos tengan contenido narrativo claro.",arcHealthSummary:"Verificacion parcial - el analisis automatico fallo pero se listaron los elementos a verificar."}}}classifyFindings(e,t){let n=[],a=["reestructurar","restructure","mover","move","crear cap\xEDtulo","create chapter","expandir","expand","desarrollar m\xE1s","develop more","mostrar en lugar de","show instead of","relegado al ep\xEDlogo","relegated to epilogue","cl\xEDmax","climax","a\xF1adir escenas","add scenes","reescribir","rewrite","pacing","ritmo narrativo","estructura","structure"],s=[...e,t].join(" ").toLowerCase();for(let o of e){let i=o.toLowerCase(),u=a.some(m=>i.includes(m)),c=o.match(/cap[i]tulo\s*(\d+)/gi)||o.match(/chapter\s*(\d+)/gi)||o.match(/ep[i]logo/gi),p=[];if(c)for(let m of c){let f=m.match(/\d+/);f&&p.push(parseInt(f[0])),(m.toLowerCase().includes("ep\xEDlogo")||m.toLowerCase().includes("epilogo"))&&p.push(-1)}n.push({text:o,type:u?"structural":"cosmetic",affectedChapters:p.length>0?p:void 0,severity:u?"high":"medium"})}return t&&a.some(o=>t.toLowerCase().includes(o))&&n.push({text:t,type:"structural",severity:"high"}),n}}});function kre(r){let e=[];return r?.apiClient&&e.push(r.apiClient),e.push(`${jre}/${Lre}`),e.join(" ")}async function Dre(r){var e;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",kre(r.requestOptions)),t.append("x-goog-api-key",r.apiKey);let n=(e=r.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(a){throw new Rs(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${a.message}`)}for(let[a,s]of n.entries()){if(a==="x-goog-api-key")throw new Rs(`Cannot set reserved header name ${a}`);if(a==="x-goog-api-client")throw new Rs(`Header name ${a} can only be set using the apiClient field`);t.append(a,s)}}return t}async function Mre(r,e,t,n,a,s){let o=new cI(r,e,t,n,s);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},qre(s)),{method:"POST",headers:await Dre(o),body:a})}}async function Em(r,e,t,n,a,s={},o=fetch){let{url:i,fetchOptions:u}=await Mre(r,e,t,n,a,s);return Ure(i,u,o)}async function Ure(r,e,t=fetch){let n;try{n=await t(r,e)}catch(a){Bre(a,r)}return n.ok||await Fre(n,r),n}function Bre(r,e){let t=r;throw t.name==="AbortError"?(t=new wy(`Request aborted when fetching ${e.toString()}: ${r.message}`),t.stack=r.stack):r instanceof Ry||r instanceof Rs||(t=new on(`Error fetching from ${e.toString()}: ${r.message}`),t.stack=r.stack),t}async function Fre(r,e){let t="",n;try{let a=await r.json();t=a.error.message,a.error.details&&(t+=` ${JSON.stringify(a.error.details)}`,n=a.error.details)}catch{}throw new Ry(`Error fetching from ${e.toString()}: [${r.status} ${r.statusText}] ${t}`,r.status,r.statusText,n)}function qre(r){let e={};if(r?.signal!==void 0||r?.timeout>=0){let t=new AbortController;r?.timeout>=0&&setTimeout(()=>t.abort(),r.timeout),r?.signal&&r.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function uI(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Sy(r.candidates[0]))throw new ti(`${ri(r)}`,r);return Gre(r)}else if(r.promptFeedback)throw new ti(`Text not available. ${ri(r)}`,r);return""},r.functionCall=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Sy(r.candidates[0]))throw new ti(`${ri(r)}`,r);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),sB(r)[0]}else if(r.promptFeedback)throw new ti(`Function call not available. ${ri(r)}`,r)},r.functionCalls=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Sy(r.candidates[0]))throw new ti(`${ri(r)}`,r);return sB(r)}else if(r.promptFeedback)throw new ti(`Function call not available. ${ri(r)}`,r)},r}function Gre(r){var e,t,n,a;let s=[];if(!((t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let o of(a=(n=r.candidates)===null||n===void 0?void 0:n[0].content)===null||a===void 0?void 0:a.parts)o.text&&s.push(o.text),o.executableCode&&s.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&s.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function sB(r){var e,t,n,a;let s=[];if(!((t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let o of(a=(n=r.candidates)===null||n===void 0?void 0:n[0].content)===null||a===void 0?void 0:a.parts)o.functionCall&&s.push(o.functionCall);if(s.length>0)return s}function Sy(r){return!!r.finishReason&&Vre.includes(r.finishReason)}function ri(r){var e,t,n;let a="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)a+="Response was blocked",!((e=r.promptFeedback)===null||e===void 0)&&e.blockReason&&(a+=` due to ${r.promptFeedback.blockReason}`),!((t=r.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(a+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((n=r.candidates)===null||n===void 0)&&n[0]){let s=r.candidates[0];Sy(s)&&(a+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(a+=`: ${s.finishMessage}`))}return a}function bm(r){return this instanceof bm?(this.v=r,this):new bm(r)}function zre(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),a,s=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(f){n[f]&&(a[f]=function(g){return new Promise(function(y,C){s.push([f,g,y,C])>1||i(f,g)})})}function i(f,g){try{u(n[f](g))}catch(y){m(s[0][3],y)}}function u(f){f.value instanceof bm?Promise.resolve(f.value.v).then(c,p):m(s[0][2],f)}function c(f){i("next",f)}function p(f){i("throw",f)}function m(f,g){f(g),s.shift(),s.length&&i(s[0][0],s[0][1])}}function Hre(r){let e=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Jre(e),[n,a]=t.tee();return{stream:Qre(n),response:Wre(a)}}async function Wre(r){let e=[],t=r.getReader();for(;;){let{done:n,value:a}=await t.read();if(n)return uI(Kre(e));e.push(a)}}function Qre(r){return zre(this,arguments,function*(){let t=r.getReader();for(;;){let{value:n,done:a}=yield bm(t.read());if(a)break;yield yield bm(uI(n))}})}function Jre(r){let e=r.getReader();return new ReadableStream({start(n){let a="";return s();function s(){return e.read().then(({value:o,done:i})=>{if(i){if(a.trim()){n.error(new on("Failed to parse stream"));return}n.close();return}a+=o;let u=a.match(oB),c;for(;u;){try{c=JSON.parse(u[1])}catch{n.error(new on(`Error parsing JSON response: "${u[1]}"`));return}n.enqueue(c),a=a.substring(u[0].length),u=a.match(oB)}return s()}).catch(o=>{let i=o;throw i.stack=o.stack,i.name==="AbortError"?i=new wy("Request aborted when reading from the stream"):i=new on("Error reading from the stream"),i})}}})}function Kre(r){let e=r[r.length-1],t={promptFeedback:e?.promptFeedback};for(let n of r){if(n.candidates){let a=0;for(let s of n.candidates)if(t.candidates||(t.candidates=[]),t.candidates[a]||(t.candidates[a]={index:a}),t.candidates[a].citationMetadata=s.citationMetadata,t.candidates[a].groundingMetadata=s.groundingMetadata,t.candidates[a].finishReason=s.finishReason,t.candidates[a].finishMessage=s.finishMessage,t.candidates[a].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[a].content||(t.candidates[a].content={role:s.content.role||"user",parts:[]});let o={};for(let i of s.content.parts)i.text&&(o.text=i.text),i.functionCall&&(o.functionCall=i.functionCall),i.executableCode&&(o.executableCode=i.executableCode),i.codeExecutionResult&&(o.codeExecutionResult=i.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),t.candidates[a].content.parts.push(o)}a++}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}async function pB(r,e,t,n){let a=await Em(e,Dc.STREAM_GENERATE_CONTENT,r,!0,JSON.stringify(t),n);return Hre(a)}async function dB(r,e,t,n){let s=await(await Em(e,Dc.GENERATE_CONTENT,r,!1,JSON.stringify(t),n)).json();return{response:uI(s)}}function mB(r){if(r!=null){if(typeof r=="string")return{role:"system",parts:[{text:r}]};if(r.text)return{role:"system",parts:[r]};if(r.parts)return r.role?r:{role:"system",parts:r.parts}}}function vm(r){let e=[];if(typeof r=="string")e=[{text:r}];else for(let t of r)typeof t=="string"?e.push({text:t}):e.push(t);return Xre(e)}function Xre(r){let e={role:"user",parts:[]},t={role:"function",parts:[]},n=!1,a=!1;for(let s of r)"functionResponse"in s?(t.parts.push(s),a=!0):(e.parts.push(s),n=!0);if(n&&a)throw new on("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!a)throw new on("No content is provided for sending chat message.");return n?e:t}function Yre(r,e){var t;let n={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},a=r.generateContentRequest!=null;if(r.contents){if(a)throw new Rs("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=r.contents}else if(a)n=Object.assign(Object.assign({},n),r.generateContentRequest);else{let s=vm(r);n.contents=[s]}return{generateContentRequest:n}}function iB(r){let e;return r.contents?e=r:e={contents:[vm(r)]},r.systemInstruction&&(e.systemInstruction=mB(r.systemInstruction)),e}function Zre(r){return typeof r=="string"||Array.isArray(r)?{content:vm(r)}:r}function tne(r){let e=!1;for(let t of r){let{role:n,parts:a}=t;if(!e&&n!=="user")throw new on(`First content should be with role 'user', got ${n}`);if(!X2.includes(n))throw new on(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(X2)}`);if(!Array.isArray(a))throw new on("Content should have 'parts' property with an array of Parts");if(a.length===0)throw new on("Each Content should have at least one part");let s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let i of a)for(let u of cB)u in i&&(s[u]+=1);let o=ene[n];for(let i of cB)if(!o.includes(i)&&s[i]>0)throw new on(`Content with role '${n}' can't contain '${i}' part`);e=!0}}function lB(r){var e;if(r.candidates===void 0||r.candidates.length===0)return!1;let t=(e=r.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(let n of t.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}async function rne(r,e,t,n){return(await Em(e,Dc.COUNT_TOKENS,r,!1,JSON.stringify(t),n)).json()}async function nne(r,e,t,n){return(await Em(e,Dc.EMBED_CONTENT,r,!1,JSON.stringify(t),n)).json()}async function ane(r,e,t,n){let a=t.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await Em(e,Dc.BATCH_EMBED_CONTENTS,r,!1,JSON.stringify({requests:a}),n)).json()}var Q2,J2,K2,X2,Y2,Z2,eB,tB,ym,rB,nB,aB,on,ti,Ry,Rs,wy,Pre,$re,Lre,jre,Dc,cI,Vre,oB,cB,ene,uB,lI,Iy,ni,xy=G(()=>{(function(r){r.STRING="string",r.NUMBER="number",r.INTEGER="integer",r.BOOLEAN="boolean",r.ARRAY="array",r.OBJECT="object"})(Q2||(Q2={}));(function(r){r.LANGUAGE_UNSPECIFIED="language_unspecified",r.PYTHON="python"})(J2||(J2={}));(function(r){r.OUTCOME_UNSPECIFIED="outcome_unspecified",r.OUTCOME_OK="outcome_ok",r.OUTCOME_FAILED="outcome_failed",r.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(K2||(K2={}));X2=["user","model","function","system"];(function(r){r.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",r.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Y2||(Y2={}));(function(r){r.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(Z2||(Z2={}));(function(r){r.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(eB||(eB={}));(function(r){r.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER"})(tB||(tB={}));(function(r){r.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.LANGUAGE="LANGUAGE",r.BLOCKLIST="BLOCKLIST",r.PROHIBITED_CONTENT="PROHIBITED_CONTENT",r.SPII="SPII",r.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",r.OTHER="OTHER"})(ym||(ym={}));(function(r){r.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",r.RETRIEVAL_QUERY="RETRIEVAL_QUERY",r.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",r.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",r.CLASSIFICATION="CLASSIFICATION",r.CLUSTERING="CLUSTERING"})(rB||(rB={}));(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.AUTO="AUTO",r.ANY="ANY",r.NONE="NONE"})(nB||(nB={}));(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.MODE_DYNAMIC="MODE_DYNAMIC"})(aB||(aB={}));on=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},ti=class extends on{constructor(e,t){super(e),this.response=t}},Ry=class extends on{constructor(e,t,n,a){super(e),this.status=t,this.statusText=n,this.errorDetails=a}},Rs=class extends on{},wy=class extends on{};Pre="https://generativelanguage.googleapis.com",$re="v1beta",Lre="0.24.1",jre="genai-js";(function(r){r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens",r.EMBED_CONTENT="embedContent",r.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Dc||(Dc={}));cI=class{constructor(e,t,n,a,s){this.model=e,this.task=t,this.apiKey=n,this.stream=a,this.requestOptions=s}toString(){var e,t;let n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||$re,s=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Pre}/${n}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}};Vre=[ym.RECITATION,ym.SAFETY,ym.LANGUAGE];oB=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;cB=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],ene={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};uB="SILENT_ERROR",lI=class{constructor(e,t,n,a={}){this.model=t,this.params=n,this._requestOptions=a,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n?.history&&(tne(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,a,s,o,i,u;await this._sendPromise;let c=vm(e),p={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(i=this.params)===null||i===void 0?void 0:i.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,c]},m=Object.assign(Object.assign({},this._requestOptions),t),f;return this._sendPromise=this._sendPromise.then(()=>dB(this._apiKey,this.model,p,m)).then(g=>{var y;if(lB(g.response)){this._history.push(c);let C=Object.assign({parts:[],role:"model"},(y=g.response.candidates)===null||y===void 0?void 0:y[0].content);this._history.push(C)}else{let C=ri(g.response);C&&console.warn(`sendMessage() was unsuccessful. ${C}. Inspect response object for details.`)}f=g}).catch(g=>{throw this._sendPromise=Promise.resolve(),g}),await this._sendPromise,f}async sendMessageStream(e,t={}){var n,a,s,o,i,u;await this._sendPromise;let c=vm(e),p={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(i=this.params)===null||i===void 0?void 0:i.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,c]},m=Object.assign(Object.assign({},this._requestOptions),t),f=pB(this._apiKey,this.model,p,m);return this._sendPromise=this._sendPromise.then(()=>f).catch(g=>{throw new Error(uB)}).then(g=>g.response).then(g=>{if(lB(g)){this._history.push(c);let y=Object.assign({},g.candidates[0].content);y.role||(y.role="model"),this._history.push(y)}else{let y=ri(g);y&&console.warn(`sendMessageStream() was unsuccessful. ${y}. Inspect response object for details.`)}}).catch(g=>{g.message!==uB&&console.error(g)}),f}};Iy=class{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=mB(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let a=iB(e),s=Object.assign(Object.assign({},this._requestOptions),t);return dB(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},a),s)}async generateContentStream(e,t={}){var n;let a=iB(e),s=Object.assign(Object.assign({},this._requestOptions),t);return pB(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},a),s)}startChat(e){var t;return new lI(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=Yre(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),a=Object.assign(Object.assign({},this._requestOptions),t);return rne(this.apiKey,this.model,n,a)}async embedContent(e,t={}){let n=Zre(e),a=Object.assign(Object.assign({},this._requestOptions),t);return nne(this.apiKey,this.model,n,a)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return ane(this.apiKey,this.model,e,n)}};ni=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new on("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Iy(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new Rs("Cached content must contain a `name` field.");if(!e.model)throw new Rs("Cached content must contain a `model` field.");let a=["model","systemInstruction"];for(let o of a)if(t?.[o]&&e[o]&&t?.[o]!==e[o]){if(o==="model"){let i=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(i===u)continue}throw new Rs(`Different value for "${o}" specified in modelParams (${t[o]}) and cachedContent (${e[o]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Iy(this.apiKey,s,n)}}});var Ty={};wr(Ty,{WritingLessonsAgent:()=>pI});var sne,pI,Oy=G(()=>{"use strict";It();vn();Mo();ms();Da();sne=`Eres un analista experto en calidad narrativa. Tu trabajo es examinar los errores detectados en auditor\xEDas de m\xFAltiples novelas y extraer LECCIONES GENERALIZABLES que se puedan aplicar a CUALQUIER novela futura.

REGLAS CR\xCDTICAS:
1. NO incluyas nombres de personajes, lugares o tramas espec\xEDficas en las lecciones.
2. Las lecciones deben ser UNIVERSALES, aplicables a cualquier g\xE9nero y estilo.
3. Agrupa errores similares en UNA SOLA lecci\xF3n (no repitas).
4. Prioriza las lecciones por frecuencia y severidad.
5. Cada lecci\xF3n debe ser ACCIONABLE: el escritor debe poder aplicarla directamente.
6. Incluye ejemplos gen\xE9ricos (malo vs bueno) cuando sea posible.
7. M\xE1ximo 20 lecciones - solo las m\xE1s importantes y recurrentes.

CATEGOR\xCDAS V\xC1LIDAS:
- repeticion_lexica: Palabras, frases o rasgos f\xEDsicos repetidos en exceso
- continuidad: Inconsistencias en hechos, ubicaciones, objetos o estado de personajes
- estructura: Problemas con pr\xF3logos, ep\xEDlogos, orden de cap\xEDtulos, spoilers
- personajes: Arcos incompletos, cambios de personalidad injustificados, apariciones/desapariciones
- ritmo: Problemas de pacing, relleno, escenas sin prop\xF3sito
- dialogo: Acotaciones telling vs showing, di\xE1logos artificiales
- temporal: Inconsistencias en l\xEDnea temporal, cronolog\xEDa rota
- atmosfera: T\xEDtulos que no encajan, tono inconsistente
- trama: Deus ex machina, agujeros de guion, resoluciones forzadas
- transiciones: Saltos geogr\xE1ficos o temporales sin explicar
- correccion_recurrente: Errores que el auto-corrector tuvo que arreglar repetidamente en m\xFAltiples novelas

FORMATO DE RESPUESTA (JSON):
{
  "lessons": [
    {
      "category": "repeticion_lexica",
      "lesson": "Descripci\xF3n concisa de la regla a seguir",
      "rationale": "Por qu\xE9 es importante, basado en los errores observados",
      "bad_example": "Ejemplo gen\xE9rico de lo que NO hacer",
      "good_example": "Ejemplo gen\xE9rico de lo que S\xCD hacer",
      "severity_weight": 8
    }
  ]
}`,pI=class extends Ae{constructor(){super({name:"Agente de Lecciones de Escritura",role:"writing-lessons",systemPrompt:sne,model:"deepseek-chat",useThinking:!1})}async execute(e){return this.refreshLessons()}severityMap(e){let t=e?.toLowerCase()||"menor";return t==="critical"||t==="critica"||t==="cr\xEDtica"?"critica":t==="high"||t==="mayor"?"mayor":t==="medium"||t==="media"?"media":"menor"}async analyzeAndExtractLessons(){let e=await b.getAllProjects(),t=[];console.log(`[WritingLessonsAgent] Scanning ${e.length} total projects for audit data...`);for(let i of e){if(!i.finalReviewResult)continue;let u=i.finalReviewResult,c=[];if(u.issues&&Array.isArray(u.issues)&&u.issues.length>0&&c.push(...u.issues),u.justificacion_puntuacion?.debilidades_principales){let p=u.justificacion_puntuacion.debilidades_principales;for(let m of p)c.some(g=>g.descripcion&&m.includes(g.descripcion.substring(0,30)))||c.push({categoria:"calidad_general",severidad:"menor",descripcion:m})}if(u.justificacion_puntuacion?.recomendaciones_proceso){let p=u.justificacion_puntuacion.recomendaciones_proceso;for(let m of p)c.push({categoria:"proceso",severidad:"menor",descripcion:m})}c.length>0&&(console.log(`[WritingLessonsAgent] Project ${i.id} "${i.title}" (finalReview): ${c.length} issues`),t.push({projectId:i.id,title:i.title,genre:i.genre,issues:c,puntuacion_global:u.puntuacion_global||0}))}try{let i=await M.select().from(Xe).where(q(Xe.status,"completed"));console.log(`[WritingLessonsAgent] Found ${i.length} completed manuscript audits`);for(let u of i){let c=e.find(y=>y.id===u.projectId),p=c?.title||`Project ${u.projectId}`,m=c?.genre||"unknown",f=t.find(y=>y.projectId===u.projectId),g=f?.issues||[];for(let y of[u.continuityReport,u.characterReport,u.styleReport]){if(!y)continue;let C=y;if(C.issues&&Array.isArray(C.issues))for(let A of C.issues)g.push({categoria:A.location||C.agentType?.toLowerCase()||"continuidad",severidad:this.severityMap(A.severity),descripcion:A.description||A.descripcion||"",instrucciones_correccion:A.suggestion||A.instrucciones_correccion||""});C.analysis&&typeof C.analysis=="string"&&C.overallScore&&C.overallScore<7&&g.push({categoria:C.agentType?.toLowerCase()||"calidad_general",severidad:"media",descripcion:C.analysis.substring(0,500)})}if(u.finalAudit){let y=u.finalAudit;if(y.reports&&Array.isArray(y.reports)){for(let C of y.reports)if(C.issues&&Array.isArray(C.issues))for(let A of C.issues)g.push({categoria:C.agentType?.toLowerCase()||"continuidad",severidad:this.severityMap(A.severity),descripcion:A.description||"",instrucciones_correccion:A.suggestion||""})}}g.length>0&&!f?(console.log(`[WritingLessonsAgent] Audit ${u.id} for "${p}": ${g.length} issues from manuscript auditor`),t.push({projectId:u.projectId,title:p,genre:m,issues:g,puntuacion_global:u.overallScore||0})):f&&(f.issues=g,console.log(`[WritingLessonsAgent] Audit ${u.id} merged into "${p}": now ${g.length} total issues`))}}catch(i){console.log(`[WritingLessonsAgent] Could not query manuscript_audits: ${i.message}`)}try{let i=await M.select().from($r);console.log(`[WritingLessonsAgent] Found ${i.length} re-edit audit reports`);for(let u of i){if(!u.findings)continue;let c=u.findings,p=Array.isArray(c)?c:c.issues||c.findings||[];if(p.length===0)continue;let m=null;try{let[y]=await M.select().from(_r).where(q(_r.id,u.projectId));m=y}catch{}let f=m?.title||`ReEdit ${u.projectId}`,g=p.map(y=>({categoria:u.auditType||"calidad_general",severidad:this.severityMap(y.severity||"medium"),descripcion:y.description||y.finding||y.issue||JSON.stringify(y).substring(0,300),instrucciones_correccion:y.suggestion||y.recommendation||""}));console.log(`[WritingLessonsAgent] ReEdit report ${u.id} "${f}" (${u.auditType}): ${g.length} findings`),t.push({projectId:u.projectId,title:f,genre:"reedit",issues:g,puntuacion_global:u.score||0})}}catch(i){console.log(`[WritingLessonsAgent] Could not query reedit_audit_reports: ${i.message}`)}try{let i=await M.select().from(bt).where(q(bt.status,"completed"));console.log(`[WritingLessonsAgent] Found ${i.length} completed auto-correction runs`);for(let u of i){let c=e.find(C=>C.id===u.projectId),p=c?.title||`Project ${u.projectId}`,m=c?.genre||"unknown",f=t.find(C=>C.projectId===u.projectId),g=f?.issues||[],y=u.cycleHistory||[];for(let C of y)if(C.manuscriptId)try{let[A]=await M.select().from(Be).where(q(Be.id,C.manuscriptId));if(A?.corrections){let T=A.corrections;for(let E of T)(E.status==="applied"||E.status==="approved")&&g.push({categoria:E.instruction?.includes("STRUCTURAL")?"estructura":"correccion_recurrente",severidad:this.severityMap(E.severity||"medium"),descripcion:`[Correcci\xF3n auto-aplicada Ciclo ${C.cycle}] ${E.instruction||E.originalText?.substring(0,200)||""}`,instrucciones_correccion:E.correctedText?.substring(0,300)||""})}}catch{}u.totalIssuesFixed&&u.totalIssuesFixed>0&&g.push({categoria:"correccion_recurrente",severidad:"media",descripcion:`[Auto-Corrector] Resumen: ${u.totalIssuesFixed} problemas corregidos autom\xE1ticamente en ${y.length} ciclos. Puntuaci\xF3n final: ${u.finalScore||"N/A"}. Cambios estructurales: ${u.totalStructuralChanges||0}.`}),g.length>0&&!f?(console.log(`[WritingLessonsAgent] Auto-correction run ${u.id} for "${p}": ${g.length} correction outcomes`),t.push({projectId:u.projectId,title:p,genre:m,issues:g,puntuacion_global:u.finalScore||0})):f&&(f.issues=g,console.log(`[WritingLessonsAgent] Auto-correction run ${u.id} merged into "${p}": now ${g.length} total issues`))}}catch(i){console.log(`[WritingLessonsAgent] Could not query auto_correction_runs: ${i.message}`)}let n=t.length;if(console.log(`[WritingLessonsAgent] Total audit sources collected: ${n}`),n===0)return console.log("[WritingLessonsAgent] No audit data found to analyze across any source"),{lessons:[],projectsAnalyzed:0};console.log(`[WritingLessonsAgent] Analyzing audits from ${t.length} projects`);let a=t.map(i=>{let u=i.issues.map(c=>`  - [${c.severidad}] ${c.categoria}: ${c.descripcion}${c.instrucciones_correccion?` \u2192 Correcci\xF3n: ${c.instrucciones_correccion}`:""}`).join(`
`);return`Proyecto "${i.title}" (${i.genre}, puntuaci\xF3n: ${i.puntuacion_global}/10):
${u}`}).join(`

`),s=`Analiza los siguientes errores detectados en ${t.length} auditor\xEDas de novelas completadas.
Extrae LECCIONES GENERALIZABLES que cualquier escritor deber\xEDa seguir para evitar estos problemas en futuras novelas.

ERRORES DETECTADOS EN AUDITOR\xCDAS:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${a}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Recuerda:
- Generaliza los errores espec\xEDficos en reglas universales
- No menciones nombres de personajes, lugares o tramas concretas
- Agrupa errores similares de distintos proyectos en una sola lecci\xF3n
- Prioriza por frecuencia (si el mismo error aparece en 3+ proyectos, es m\xE1s importante)
- severity_weight de 1 (menor) a 10 (cr\xEDtico)

Responde SOLO con JSON v\xE1lido.`,o=await this.generateContent(s);if(o.error)return console.error("[WritingLessonsAgent] Error generating lessons:",o.error),{lessons:[],projectsAnalyzed:t.length};try{let i=o.content.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim(),c=(JSON.parse(i).lessons||[]).map(p=>({category:p.category||"otro",lesson:p.lesson||"",rationale:p.rationale||"",bad_example:p.bad_example||null,good_example:p.good_example||null,severity_weight:Math.min(10,Math.max(1,p.severity_weight||5))}));return console.log(`[WritingLessonsAgent] Extracted ${c.length} lessons from ${t.length} projects`),{lessons:c,projectsAnalyzed:t.length}}catch(i){return console.error("[WritingLessonsAgent] Failed to parse lessons JSON:",i),console.error("[WritingLessonsAgent] Raw content:",o.content.substring(0,500)),{lessons:[],projectsAnalyzed:t.length}}}async refreshLessons(){let{lessons:e,projectsAnalyzed:t}=await this.analyzeAndExtractLessons();if(e.length===0)return{created:0,projectsAnalyzed:t};let n=await b.getAllProjects(),a=new Set;for(let i of n){if(!i.finalReviewResult)continue;let u=i.finalReviewResult;(u.issues?.length>0||u.justificacion_puntuacion?.debilidades_principales?.length>0||u.justificacion_puntuacion?.recomendaciones_proceso?.length>0)&&a.add(i.id)}try{let i=await M.select().from(Xe).where(q(Xe.status,"completed"));for(let u of i)a.add(u.projectId)}catch{}let s=Array.from(a);await b.deleteAllWritingLessons();let o=0;for(let i of e)await b.createWritingLesson({category:i.category,lesson:i.lesson,rationale:i.rationale,badExample:i.bad_example||null,goodExample:i.good_example||null,severityWeight:i.severity_weight,evidenceCount:t,sourceProjectIds:s,isActive:!0}),o++;return console.log(`[WritingLessonsAgent] Refreshed: ${o} lessons from ${t} projects`),{created:o,projectsAnalyzed:t}}static formatLessonsForGhostwriter(e){if(!e||e.length===0)return"";let t=["\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557","\u2551  LECCIONES APRENDIDAS DE AUDITOR\xCDAS ANTERIORES                 \u2551","\u2551  (Errores detectados en novelas previas - NO REPETIR)          \u2551","\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563"],n=new Map;for(let s of e)n.has(s.category)||n.set(s.category,[]),n.get(s.category).push(s);let a={repeticion_lexica:"REPETICI\xD3N L\xC9XICA",continuidad:"CONTINUIDAD",estructura:"ESTRUCTURA",personajes:"PERSONAJES",ritmo:"RITMO",dialogo:"DI\xC1LOGO",temporal:"TEMPORAL",atmosfera:"ATM\xD3SFERA",trama:"TRAMA",transiciones:"TRANSICIONES"};for(let[s,o]of Array.from(n.entries())){let i=a[s]||s.toUpperCase();t.push("\u2551"),t.push(`\u2551 \u2500\u2500 ${i} \u2500\u2500`);for(let u of o)t.push(`\u2551   \u2022 ${u.lesson}`),u.badExample&&t.push(`\u2551     \u2717 MAL: ${u.badExample}`),u.goodExample&&t.push(`\u2551     \u2713 BIEN: ${u.goodExample}`)}return t.push("\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563"),t.push("\u2551 Aplica estas lecciones en CADA cap\xEDtulo que escribas.           \u2551"),t.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),t.join(`
`)}}});var _y=H((bB,vB)=>{"use strict";function cne(r){if(r.length===0)return;let e=Object.create(null),t=0;for(;t<r.length;++t){let o=r.charCodeAt(t);if(Mc[o]!==1){if(o!==47||t===0)return;break}}if(t===r.length)return;let n=r.slice(0,t).toLowerCase(),a=++t;for(;t<r.length;++t){let o=r.charCodeAt(t);if(Mc[o]!==1){if(t===a||lne(r,t,e)===void 0)return;break}}if(t===a)return;let s=r.slice(a,t).toLowerCase();return{type:n,subtype:s,params:e}}function lne(r,e,t){for(;e<r.length;){for(;e<r.length;++e){let i=r.charCodeAt(e);if(i!==32&&i!==9)break}if(e===r.length)break;if(r.charCodeAt(e++)!==59)return;for(;e<r.length;++e){let i=r.charCodeAt(e);if(i!==32&&i!==9)break}if(e===r.length)return;let n,a=e;for(;e<r.length;++e){let i=r.charCodeAt(e);if(Mc[i]!==1){if(i!==61)return;break}}if(e===r.length||(n=r.slice(a,e),++e,e===r.length))return;let s="",o;if(r.charCodeAt(e)===34){o=++e;let i=!1;for(;e<r.length;++e){let u=r.charCodeAt(e);if(u===92){i?(o=e,i=!1):(s+=r.slice(o,e),i=!0);continue}if(u===34){if(i){o=e,i=!1;continue}s+=r.slice(o,e);break}if(i&&(o=e-1,i=!1),yB[u]!==1)return}if(e===r.length)return;++e}else{for(o=e;e<r.length;++e){let i=r.charCodeAt(e);if(Mc[i]!==1){if(e===o)return;break}}s=r.slice(o,e)}n=n.toLowerCase(),t[n]===void 0&&(t[n]=s)}return t}function une(r,e){if(r.length===0)return;let t=Object.create(null),n=0;for(;n<r.length;++n){let s=r.charCodeAt(n);if(Mc[s]!==1){if(pne(r,n,t,e)===void 0)return;break}}return{type:r.slice(0,n).toLowerCase(),params:t}}function pne(r,e,t,n){for(;e<r.length;){for(;e<r.length;++e){let c=r.charCodeAt(e);if(c!==32&&c!==9)break}if(e===r.length)break;if(r.charCodeAt(e++)!==59)return;for(;e<r.length;++e){let c=r.charCodeAt(e);if(c!==32&&c!==9)break}if(e===r.length)return;let a,s=e;for(;e<r.length;++e){let c=r.charCodeAt(e);if(Mc[c]!==1){if(c===61)break;return}}if(e===r.length)return;let o="",i,u;if(a=r.slice(s,e),a.charCodeAt(a.length-1)===42){let c=++e;for(;e<r.length;++e){let m=r.charCodeAt(e);if(mne[m]!==1){if(m!==39)return;break}}if(e===r.length)return;for(u=r.slice(c,e),++e;e<r.length&&r.charCodeAt(e)!==39;++e);if(e===r.length||(++e,e===r.length))return;i=e;let p=0;for(;e<r.length;++e){let m=r.charCodeAt(e);if(hne[m]!==1){if(m===37){let f,g;if(e+2<r.length&&(f=hB[r.charCodeAt(e+1)])!==-1&&(g=hB[r.charCodeAt(e+2)])!==-1){let y=(f<<4)+g;o+=r.slice(i,e),o+=String.fromCharCode(y),e+=2,i=e+1,y>=128?p=2:p===0&&(p=1);continue}return}break}}if(o+=r.slice(i,e),o=gB(o,u,p),o===void 0)return}else{if(++e,e===r.length)return;if(r.charCodeAt(e)===34){i=++e;let c=!1;for(;e<r.length;++e){let p=r.charCodeAt(e);if(p===92){c?(i=e,c=!1):(o+=r.slice(i,e),c=!0);continue}if(p===34){if(c){i=e,c=!1;continue}o+=r.slice(i,e);break}if(c&&(i=e-1,c=!1),yB[p]!==1)return}if(e===r.length)return;++e}else{for(i=e;e<r.length;++e){let c=r.charCodeAt(e);if(Mc[c]!==1){if(e===i)return;break}}o=r.slice(i,e)}if(o=n(o,2),o===void 0)return}a=a.toLowerCase(),t[a]===void 0&&(t[a]=o)}return t}function fB(r){let e;for(;;)switch(r){case"utf-8":case"utf8":return Cm.utf8;case"latin1":case"ascii":case"us-ascii":case"iso-8859-1":case"iso8859-1":case"iso88591":case"iso_8859-1":case"windows-1252":case"iso_8859-1:1987":case"cp1252":case"x-cp1252":return Cm.latin1;case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return Cm.utf16le;case"base64":return Cm.base64;default:if(e===void 0){e=!0,r=r.toLowerCase();continue}return Cm.other.bind(r)}}var Cm={utf8:(r,e)=>{if(r.length===0)return"";if(typeof r=="string"){if(e<2)return r;r=Buffer.from(r,"latin1")}return r.utf8Slice(0,r.length)},latin1:(r,e)=>r.length===0?"":typeof r=="string"?r:r.latin1Slice(0,r.length),utf16le:(r,e)=>r.length===0?"":(typeof r=="string"&&(r=Buffer.from(r,"latin1")),r.ucs2Slice(0,r.length)),base64:(r,e)=>r.length===0?"":(typeof r=="string"&&(r=Buffer.from(r,"latin1")),r.base64Slice(0,r.length)),other:(r,e)=>{if(r.length===0)return"";typeof r=="string"&&(r=Buffer.from(r,"latin1"));try{return new TextDecoder(bB).decode(r)}catch{}}};function gB(r,e,t){let n=fB(e);if(n)return n(r,t)}function dne(r){if(typeof r!="string")return"";for(let e=r.length-1;e>=0;--e)switch(r.charCodeAt(e)){case 47:case 92:return r=r.slice(e+1),r===".."||r==="."?"":r}return r===".."||r==="."?"":r}var Mc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],yB=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],mne=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],hne=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],hB=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];vB.exports={basename:dne,convertToUTF8:gB,getDecoder:fB,parseContentType:cne,parseDisposition:une}});var SB=H((CPe,AB)=>{"use strict";function EB(r,e,t,n,a){for(let s=0;s<a;++s)if(r[e+s]!==t[n+s])return!1;return!0}var bI=class{constructor(e,t){if(typeof t!="function")throw new Error("Missing match callback");if(typeof e=="string")e=Buffer.from(e);else if(!Buffer.isBuffer(e))throw new Error(`Expected Buffer for needle, got ${typeof e}`);let n=e.length;if(this.maxMatches=1/0,this.matches=0,this._cb=t,this._lookbehindSize=0,this._needle=e,this._bufPos=0,this._lookbehind=Buffer.allocUnsafe(n),this._occ=[n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n],n>1)for(let a=0;a<n-1;++a)this._occ[e[a]]=n-1-a}reset(){this.matches=0,this._lookbehindSize=0,this._bufPos=0}push(e,t){let n;Buffer.isBuffer(e)||(e=Buffer.from(e,"latin1"));let a=e.length;for(this._bufPos=t||0;n!==a&&this.matches<this.maxMatches;)n=fne(this,e);return n}destroy(){let e=this._lookbehindSize;e&&this._cb(!1,this._lookbehind,0,e,!1),this.reset()}};function fne(r,e){let t=e.length,n=r._needle,a=n.length,s=-r._lookbehindSize,o=a-1,i=n[o],u=t-a,c=r._occ,p=r._lookbehind;if(s<0){for(;s<0&&s<=u;){let f=s+o,g=f<0?p[r._lookbehindSize+f]:e[f];if(g===i&&CB(r,e,s,o))return r._lookbehindSize=0,++r.matches,s>-r._lookbehindSize?r._cb(!0,p,0,r._lookbehindSize+s,!1):r._cb(!0,void 0,0,0,!0),r._bufPos=s+a;s+=c[g]}for(;s<0&&!CB(r,e,s,t-s);)++s;if(s<0){let f=r._lookbehindSize+s;return f>0&&r._cb(!1,p,0,f,!1),r._lookbehindSize-=f,p.copy(p,0,f,r._lookbehindSize),p.set(e,r._lookbehindSize),r._lookbehindSize+=t,r._bufPos=t,t}r._cb(!1,p,0,r._lookbehindSize,!1),r._lookbehindSize=0}s+=r._bufPos;let m=n[0];for(;s<=u;){let f=e[s+o];if(f===i&&e[s]===m&&EB(n,0,e,s,o))return++r.matches,s>0?r._cb(!0,e,r._bufPos,s,!0):r._cb(!0,void 0,0,0,!0),r._bufPos=s+a;s+=c[f]}for(;s<t;){if(e[s]!==m||!EB(e,s,n,0,t-s)){++s;continue}e.copy(p,0,s,t),r._lookbehindSize=t-s;break}return s>0&&r._cb(!1,e,r._bufPos,s<t?s:t,!0),r._bufPos=t,t}function CB(r,e,t,n){let a=r._lookbehind,s=r._lookbehindSize,o=r._needle;for(let i=0;i<n;++i,++t)if((t<0?a[s+t]:e[t])!==o[i])return!1;return!0}AB.exports=bI});var PB=H((APe,_B)=>{"use strict";var{Readable:gne,Writable:yne}=require("stream"),bne=SB(),{basename:vne,convertToUTF8:RB,getDecoder:Ene,parseContentType:Cne,parseDisposition:Ane}=_y(),Sne=Buffer.from(`\r
`),Rne=Buffer.from("\r"),wne=Buffer.from("-");function wB(){}var Ine=2e3,ku=16*1024,Py=0,IB=1,xB=2,vI=class{constructor(e){this.header=Object.create(null),this.pairCount=0,this.byteCount=0,this.state=Py,this.name="",this.value="",this.crlf=0,this.cb=e}reset(){this.header=Object.create(null),this.pairCount=0,this.byteCount=0,this.state=Py,this.name="",this.value="",this.crlf=0}push(e,t,n){let a=t;for(;t<n;)switch(this.state){case Py:{let s=!1;for(;t<n;++t){if(this.byteCount===ku)return-1;++this.byteCount;let o=e[t];if(One[o]!==1){if(o!==58||(this.name+=e.latin1Slice(a,t),this.name.length===0))return-1;++t,s=!0,this.state=IB;break}}if(!s){this.name+=e.latin1Slice(a,t);break}}case IB:{let s=!1;for(;t<n;++t){if(this.byteCount===ku)return-1;++this.byteCount;let o=e[t];if(o!==32&&o!==9){a=t,s=!0,this.state=xB;break}}if(!s)break}case xB:switch(this.crlf){case 0:for(;t<n;++t){if(this.byteCount===ku)return-1;++this.byteCount;let s=e[t];if(Nne[s]!==1){if(s!==13)return-1;++this.crlf;break}}this.value+=e.latin1Slice(a,t++);break;case 1:if(this.byteCount===ku||(++this.byteCount,e[t++]!==10))return-1;++this.crlf;break;case 2:{if(this.byteCount===ku)return-1;++this.byteCount;let s=e[t];s===32||s===9?(a=t,this.crlf=0):(++this.pairCount<Ine&&(this.name=this.name.toLowerCase(),this.header[this.name]===void 0?this.header[this.name]=[this.value]:this.header[this.name].push(this.value)),s===13?(++this.crlf,++t):(a=t,this.crlf=0,this.state=Py,this.name="",this.value=""));break}case 3:{if(this.byteCount===ku||(++this.byteCount,e[t++]!==10))return-1;let s=this.header;return this.reset(),this.cb(s),t}}break}return t}},EI=class extends gne{constructor(e,t){super(e),this.truncated=!1,this._readcb=null,this.once("end",()=>{if(this._read(),--t._fileEndsLeft===0&&t._finalcb){let n=t._finalcb;t._finalcb=null,process.nextTick(n)}})}_read(e){let t=this._readcb;t&&(this._readcb=null,t())}},TB={push:(r,e)=>{},destroy:()=>{}};function xne(r,e){let t=r._writecb;r._writecb=null,e?r.destroy(e):t&&t()}function Tne(r,e){return r}var CI=class extends yne{constructor(e){let t={autoDestroy:!0,emitClose:!0,highWaterMark:typeof e.highWaterMark=="number"?e.highWaterMark:void 0};if(super(t),!e.conType.params||typeof e.conType.params.boundary!="string")throw new Error("Multipart: Boundary not found");let n=e.conType.params.boundary,a=typeof e.defParamCharset=="string"&&e.defParamCharset?Ene(e.defParamCharset):Tne,s=e.defCharset||"utf8",o=e.preservePath,i={autoDestroy:!0,emitClose:!0,highWaterMark:typeof e.fileHwm=="number"?e.fileHwm:void 0},u=e.limits,c=u&&typeof u.fieldSize=="number"?u.fieldSize:1*1024*1024,p=u&&typeof u.fileSize=="number"?u.fileSize:1/0,m=u&&typeof u.files=="number"?u.files:1/0,f=u&&typeof u.fields=="number"?u.fields:1/0,g=u&&typeof u.parts=="number"?u.parts:1/0,y=-1,C=0,A=0,T=!1;this._fileEndsLeft=0,this._fileStream=void 0,this._complete=!1;let E=0,d,l=0,h,v,S,R,x=!1,w=!1,O=!1;this._hparser=null;let I=new vI(P=>{this._hparser=null,T=!1,S="text/plain",h=s,v="7bit",R=void 0,x=!1;let L;if(!P["content-disposition"]){T=!0;return}let j=Ane(P["content-disposition"][0],a);if(!j||j.type!=="form-data"){T=!0;return}if(j.params&&(j.params.name&&(R=j.params.name),j.params["filename*"]?L=j.params["filename*"]:j.params.filename&&(L=j.params.filename),L!==void 0&&!o&&(L=vne(L))),P["content-type"]){let $=Cne(P["content-type"][0]);$&&(S=`${$.type}/${$.subtype}`,$.params&&typeof $.params.charset=="string"&&(h=$.params.charset.toLowerCase()))}if(P["content-transfer-encoding"]&&(v=P["content-transfer-encoding"][0].toLowerCase()),S==="application/octet-stream"||L!==void 0){if(A===m){w||(w=!0,this.emit("filesLimit")),T=!0;return}if(++A,this.listenerCount("file")===0){T=!0;return}E=0,this._fileStream=new EI(i,this),++this._fileEndsLeft,this.emit("file",R,this._fileStream,{filename:L,encoding:v,mimeType:S})}else{if(C===f){O||(O=!0,this.emit("fieldsLimit")),T=!0;return}if(++C,this.listenerCount("field")===0){T=!0;return}d=[],l=0}}),_=0,N=(P,L,j,$,U)=>{e:for(;L;){if(this._hparser!==null){let k=this._hparser.push(L,j,$);if(k===-1){this._hparser=null,I.reset(),this.emit("error",new Error("Malformed part header"));break}j=k}if(j===$)break;if(_!==0){if(_===1){switch(L[j]){case 45:_=2,++j;break;case 13:_=3,++j;break;default:_=0}if(j===$)return}if(_===2){if(_=0,L[j]===45){this._complete=!0,this._bparser=TB;return}let k=this._writecb;this._writecb=wB,N(!1,wne,0,1,!1),this._writecb=k}else if(_===3)if(_=0,L[j]===10){if(++j,y>=g||(this._hparser=I,j===$))break;continue e}else{let k=this._writecb;this._writecb=wB,N(!1,Rne,0,1,!1),this._writecb=k}}if(!T){if(this._fileStream){let k,V=Math.min($-j,p-E);U?k=L.slice(j,j+V):(k=Buffer.allocUnsafe(V),L.copy(k,0,j,j+V)),E+=k.length,E===p?(k.length>0&&this._fileStream.push(k),this._fileStream.emit("limit"),this._fileStream.truncated=!0,T=!0):this._fileStream.push(k)||(this._writecb&&(this._fileStream._readcb=this._writecb),this._writecb=null)}else if(d!==void 0){let k,V=Math.min($-j,c-l);U?k=L.slice(j,j+V):(k=Buffer.allocUnsafe(V),L.copy(k,0,j,j+V)),l+=V,d.push(k),l===c&&(T=!0,x=!0)}}break}if(P){if(_=1,this._fileStream)this._fileStream.push(null),this._fileStream=null;else if(d!==void 0){let k;switch(d.length){case 0:k="";break;case 1:k=RB(d[0],h,0);break;default:k=RB(Buffer.concat(d,l),h,0)}d=void 0,l=0,this.emit("field",R,k,{nameTruncated:!1,valueTruncated:x,encoding:v,mimeType:S})}++y===g&&this.emit("partsLimit")}};this._bparser=new bne(`\r
--${n}`,N),this._writecb=null,this._finalcb=null,this.write(Sne)}static detect(e){return e.type==="multipart"&&e.subtype==="form-data"}_write(e,t,n){this._writecb=n,this._bparser.push(e,0),this._writecb&&xne(this)}_destroy(e,t){this._hparser=null,this._bparser=TB,e||(e=NB(this));let n=this._fileStream;n&&(this._fileStream=null,n.destroy(e)),t(e)}_final(e){if(this._bparser.destroy(),!this._complete)return e(new Error("Unexpected end of form"));this._fileEndsLeft?this._finalcb=OB.bind(null,this,e):OB(this,e)}};function OB(r,e,t){if(t)return e(t);t=NB(r),e(t)}function NB(r){if(r._hparser)return new Error("Malformed part header");let e=r._fileStream;if(e&&(r._fileStream=null,e.destroy(new Error("Unexpected end of file"))),!r._complete)return new Error("Unexpected end of form")}var One=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Nne=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];_B.exports=CI});var LB=H((SPe,$B)=>{"use strict";var{Writable:_ne}=require("stream"),{getDecoder:Pne}=_y(),II=class extends _ne{constructor(e){let t={autoDestroy:!0,emitClose:!0,highWaterMark:typeof e.highWaterMark=="number"?e.highWaterMark:void 0};super(t);let n=e.defCharset||"utf8";e.conType.params&&typeof e.conType.params.charset=="string"&&(n=e.conType.params.charset),this.charset=n;let a=e.limits;this.fieldSizeLimit=a&&typeof a.fieldSize=="number"?a.fieldSize:1*1024*1024,this.fieldsLimit=a&&typeof a.fields=="number"?a.fields:1/0,this.fieldNameSizeLimit=a&&typeof a.fieldNameSize=="number"?a.fieldNameSize:100,this._inKey=!0,this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,this._fields=0,this._key="",this._val="",this._byte=-2,this._lastPos=0,this._encode=0,this._decoder=Pne(n)}static detect(e){return e.type==="application"&&e.subtype==="x-www-form-urlencoded"}_write(e,t,n){if(this._fields>=this.fieldsLimit)return n();let a=0,s=e.length;if(this._lastPos=0,this._byte!==-2){if(a=AI(this,e,a,s),a===-1)return n(new Error("Malformed urlencoded form"));if(a>=s)return n();this._inKey?++this._bytesKey:++this._bytesVal}e:for(;a<s;)if(this._inKey){for(a=SI(this,e,a,s);a<s;){switch(e[a]){case 61:this._lastPos<a&&(this._key+=e.latin1Slice(this._lastPos,a)),this._lastPos=++a,this._key=this._decoder(this._key,this._encode),this._encode=0,this._inKey=!1;continue e;case 38:if(this._lastPos<a&&(this._key+=e.latin1Slice(this._lastPos,a)),this._lastPos=++a,this._key=this._decoder(this._key,this._encode),this._encode=0,this._bytesKey>0&&this.emit("field",this._key,"",{nameTruncated:this._keyTrunc,valueTruncated:!1,encoding:this.charset,mimeType:"text/plain"}),this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,++this._fields>=this.fieldsLimit)return this.emit("fieldsLimit"),n();continue;case 43:this._lastPos<a&&(this._key+=e.latin1Slice(this._lastPos,a)),this._key+=" ",this._lastPos=a+1;break;case 37:if(this._encode===0&&(this._encode=1),this._lastPos<a&&(this._key+=e.latin1Slice(this._lastPos,a)),this._lastPos=a+1,this._byte=-1,a=AI(this,e,a+1,s),a===-1)return n(new Error("Malformed urlencoded form"));if(a>=s)return n();++this._bytesKey,a=SI(this,e,a,s);continue}++a,++this._bytesKey,a=SI(this,e,a,s)}this._lastPos<a&&(this._key+=e.latin1Slice(this._lastPos,a))}else{for(a=RI(this,e,a,s);a<s;){switch(e[a]){case 38:if(this._lastPos<a&&(this._val+=e.latin1Slice(this._lastPos,a)),this._lastPos=++a,this._inKey=!0,this._val=this._decoder(this._val,this._encode),this._encode=0,(this._bytesKey>0||this._bytesVal>0)&&this.emit("field",this._key,this._val,{nameTruncated:this._keyTrunc,valueTruncated:this._valTrunc,encoding:this.charset,mimeType:"text/plain"}),this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,++this._fields>=this.fieldsLimit)return this.emit("fieldsLimit"),n();continue e;case 43:this._lastPos<a&&(this._val+=e.latin1Slice(this._lastPos,a)),this._val+=" ",this._lastPos=a+1;break;case 37:if(this._encode===0&&(this._encode=1),this._lastPos<a&&(this._val+=e.latin1Slice(this._lastPos,a)),this._lastPos=a+1,this._byte=-1,a=AI(this,e,a+1,s),a===-1)return n(new Error("Malformed urlencoded form"));if(a>=s)return n();++this._bytesVal,a=RI(this,e,a,s);continue}++a,++this._bytesVal,a=RI(this,e,a,s)}this._lastPos<a&&(this._val+=e.latin1Slice(this._lastPos,a))}n()}_final(e){if(this._byte!==-2)return e(new Error("Malformed urlencoded form"));(!this._inKey||this._bytesKey>0||this._bytesVal>0)&&(this._inKey?this._key=this._decoder(this._key,this._encode):this._val=this._decoder(this._val,this._encode),this.emit("field",this._key,this._val,{nameTruncated:this._keyTrunc,valueTruncated:this._valTrunc,encoding:this.charset,mimeType:"text/plain"})),e()}};function AI(r,e,t,n){if(t>=n)return n;if(r._byte===-1){let a=wI[e[t++]];if(a===-1)return-1;if(a>=8&&(r._encode=2),t<n){let s=wI[e[t++]];if(s===-1)return-1;r._inKey?r._key+=String.fromCharCode((a<<4)+s):r._val+=String.fromCharCode((a<<4)+s),r._byte=-2,r._lastPos=t}else r._byte=a}else{let a=wI[e[t++]];if(a===-1)return-1;r._inKey?r._key+=String.fromCharCode((r._byte<<4)+a):r._val+=String.fromCharCode((r._byte<<4)+a),r._byte=-2,r._lastPos=t}return t}function SI(r,e,t,n){if(r._bytesKey>r.fieldNameSizeLimit){for(r._keyTrunc||r._lastPos<t&&(r._key+=e.latin1Slice(r._lastPos,t-1)),r._keyTrunc=!0;t<n;++t){let a=e[t];if(a===61||a===38)break;++r._bytesKey}r._lastPos=t}return t}function RI(r,e,t,n){if(r._bytesVal>r.fieldSizeLimit){for(r._valTrunc||r._lastPos<t&&(r._val+=e.latin1Slice(r._lastPos,t-1)),r._valTrunc=!0;t<n&&e[t]!==38;++t)++r._bytesVal;r._lastPos=t}return t}var wI=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];$B.exports=II});var kB=H((RPe,jB)=>{"use strict";var{parseContentType:$ne}=_y();function Lne(r){let e=r.headers,t=$ne(e["content-type"]);if(!t)throw new Error("Malformed content type");for(let n of jne){if(!n.detect(t))continue;let s={limits:r.limits,headers:e,conType:t,highWaterMark:void 0,fileHwm:void 0,defCharset:void 0,defParamCharset:void 0,preservePath:!1};return r.highWaterMark&&(s.highWaterMark=r.highWaterMark),r.fileHwm&&(s.fileHwm=r.fileHwm),s.defCharset=r.defCharset,s.defParamCharset=r.defParamCharset,s.preservePath=r.preservePath,new n(s)}throw new Error(`Unsupported content type: ${e["content-type"]}`)}var jne=[PB(),LB()].filter(function(r){return typeof r.detect=="function"});jB.exports=r=>{if((typeof r!="object"||r===null)&&(r={}),typeof r.headers!="object"||r.headers===null||typeof r.headers["content-type"]!="string")throw new Error("Missing Content-Type");return Lne(r)}});var MB=H((wPe,DB)=>{DB.exports=Dne;var kne=Object.prototype.hasOwnProperty;function Dne(){for(var r={},e=0;e<arguments.length;e++){var t=arguments[e];for(var n in t)kne.call(t,n)&&(r[n]=t[n])}return r}});var BB=H((IPe,UB)=>{var Mne=/^[^\[]*/,Une=/^\[(\d+)\]/,Bne=/^\[([^\]]+)\]/;function Fne(r){function e(){return[{type:"object",key:r,last:!0}]}var t=Mne.exec(r)[0];if(!t)return e();for(var n=r.length,a=t.length,s={type:"object",key:t},o=[s];a<n;){var i;if(r[a]==="["&&r[a+1]==="]"){if(a+=2,s.append=!0,a!==n)return e();continue}if(i=Une.exec(r.substring(a)),i!==null){a+=i[0].length,s.nextType="array",s={type:"array",key:parseInt(i[1],10)},o.push(s);continue}if(i=Bne.exec(r.substring(a)),i!==null){a+=i[0].length,s.nextType="object",s={type:"object",key:i[1]},o.push(s);continue}return e()}return s.last=!0,o}UB.exports=Fne});var VB=H((xPe,GB)=>{function FB(r){return r===void 0?"undefined":Array.isArray(r)?"array":typeof r=="object"?"object":"scalar"}function qB(r,e,t,n){switch(FB(t)){case"undefined":e.append?r[e.key]=[n]:r[e.key]=n;break;case"array":r[e.key].push(n);break;case"object":return qB(t,{type:"object",key:"",last:!0},t[""],n);case"scalar":r[e.key]=[r[e.key],n];break}return r}function qne(r,e,t,n){if(e.last)return qB(r,e,t,n);var a;switch(FB(t)){case"undefined":return e.nextType==="array"?r[e.key]=[]:r[e.key]=Object.create(null),r[e.key];case"object":return r[e.key];case"array":return e.nextType==="array"?t:(a=Object.create(null),r[e.key]=a,t.forEach(function(s,o){s!==void 0&&(a[""+o]=s)}),a);case"scalar":return a=Object.create(null),a[""]=t,r[e.key]=a,a}}GB.exports=qne});var HB=H((TPe,zB)=>{var Gne=BB(),Vne=VB();function zne(r,e,t){var n=Gne(e);n.reduce(function(a,s){return Vne(a,s,a[s.key],t)},r)}zB.exports=zne});var JB=H((OPe,QB)=>{var WB=require("events").EventEmitter;function Du(){WB.call(this),this.value=0}Du.prototype=Object.create(WB.prototype);Du.prototype.increment=function(){this.value++};Du.prototype.decrement=function(){--this.value===0&&this.emit("zero")};Du.prototype.isZero=function(){return this.value===0};Du.prototype.onceZero=function(e){if(this.isZero())return e();this.once("zero",e)};QB.exports=Du});var xI=H((NPe,XB)=>{var Hne=require("util"),Wne={LIMIT_PART_COUNT:"Too many parts",LIMIT_FILE_SIZE:"File too large",LIMIT_FILE_COUNT:"Too many files",LIMIT_FIELD_KEY:"Field name too long",LIMIT_FIELD_VALUE:"Field value too long",LIMIT_FIELD_COUNT:"Too many fields",LIMIT_UNEXPECTED_FILE:"Unexpected field",MISSING_FIELD_NAME:"Field name missing"};function KB(r,e){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=Wne[r],this.code=r,e&&(this.field=e)}Hne.inherits(KB,Error);XB.exports=KB});var eF=H((_Pe,ZB)=>{"use strict";var YB=Object.getOwnPropertySymbols,Qne=Object.prototype.hasOwnProperty,Jne=Object.prototype.propertyIsEnumerable;function Kne(r){if(r==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function Xne(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de",Object.getOwnPropertyNames(r)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var n=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(n.join("")!=="0123456789")return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(s){a[s]=s}),Object.keys(Object.assign({},a)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}ZB.exports=Xne()?Object.assign:function(r,e){for(var t,n=Kne(r),a,s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var o in t)Qne.call(t,o)&&(n[o]=t[o]);if(YB){a=YB(t);for(var i=0;i<a.length;i++)Jne.call(t,a[i])&&(n[a[i]]=t[a[i]])}}return n}});var nF=H((PPe,rF)=>{var Yne=eF();function tF(r,e){var t=r.indexOf(e);~t&&r.splice(t,1)}function $y(r,e){switch(this.strategy=r,this.req=e,r){case"NONE":break;case"VALUE":break;case"ARRAY":e.files=[];break;case"OBJECT":e.files=Object.create(null);break;default:throw new Error("Unknown file strategy: "+r)}}$y.prototype.insertPlaceholder=function(r){var e={fieldname:r.fieldname};switch(this.strategy){case"NONE":break;case"VALUE":break;case"ARRAY":this.req.files.push(e);break;case"OBJECT":this.req.files[r.fieldname]?this.req.files[r.fieldname].push(e):this.req.files[r.fieldname]=[e];break}return e};$y.prototype.removePlaceholder=function(r){switch(this.strategy){case"NONE":break;case"VALUE":break;case"ARRAY":tF(this.req.files,r);break;case"OBJECT":this.req.files[r.fieldname].length===1?delete this.req.files[r.fieldname]:tF(this.req.files[r.fieldname],r);break}};$y.prototype.replacePlaceholder=function(r,e){if(this.strategy==="VALUE"){this.req.file=e;return}delete r.fieldname,Yne(r,e)};rF.exports=$y});var sF=H(($Pe,aF)=>{function Zne(r,e,t){var n=r.length,a=[];if(n===0)return t(null,a);function s(o){var i=r[o];e(i,function(u){u&&(u.file=i,u.field=i.fieldname,a.push(u)),o<n-1?s(o+1):t(null,a)})}s(0)}aF.exports=Zne});var cF=H((LPe,iF)=>{var eae=Si(),tae=kB(),oF=MB(),rae=HB(),nae=JB(),aae=xI(),sae=nF(),oae=sF();function iae(r){r.on("readable",()=>{for(;r.read()!==null;);})}function cae(r){return function(t,n,a){if(!eae(t,["multipart"]))return a();var s=r(),o=s.limits,i=s.storage,u=s.fileFilter,c=s.fileStrategy,p=s.preservePath;t.body=Object.create(null),t.on("error",function(v){l(v)});var m;try{m=tae({headers:t.headers,limits:o,preservePath:p})}catch(v){return a(v)}var f=new sae(c,t),g=!1,y=!1,C=!1,A=new nae,T=[];function E(v){g||(g=!0,t.unpipe(m),iae(t),t.resume(),setImmediate(()=>{m.removeAllListeners()}),a(v))}function d(){y&&A.isZero()&&!C&&E()}function l(v){C||(C=!0,A.onceZero(function(){function S(R,x){i._removeFile(t,R,x)}oae(T,S,function(R,x){if(R)return E(R);v.storageErrors=x,E(v)})}))}function h(v,S){l(new aae(v,S))}m.on("field",function(v,S,{nameTruncated:R,valueTruncated:x}){if(v==null)return h("MISSING_FIELD_NAME");if(R)return h("LIMIT_FIELD_KEY");if(x)return h("LIMIT_FIELD_VALUE",v);if(o&&Object.prototype.hasOwnProperty.call(o,"fieldNameSize")&&v.length>o.fieldNameSize)return h("LIMIT_FIELD_KEY");rae(t.body,v,S)}),m.on("file",function(v,S,{filename:R,encoding:x,mimeType:w}){var O=!1;if(S.on("error",function(N){O&&A.decrement(),l(N)}),v==null)return h("MISSING_FIELD_NAME");if(!R)return S.resume();if(o&&Object.prototype.hasOwnProperty.call(o,"fieldNameSize")&&v.length>o.fieldNameSize)return h("LIMIT_FIELD_KEY");var I={fieldname:v,originalname:R,encoding:x,mimetype:w},_=f.insertPlaceholder(I);u(t,I,function(N,P){if(N)return f.removePlaceholder(_),l(N);if(!P)return f.removePlaceholder(_),S.resume();var L=!1;O=!0,A.increment(),Object.defineProperty(I,"stream",{configurable:!0,enumerable:!1,value:S}),S.on("limit",function(){L=!0,h("LIMIT_FILE_SIZE",v)}),i._handleFile(t,I,function(j,$){if(L)return f.removePlaceholder(_),T.push(oF(I,$)),A.decrement();if(j)return f.removePlaceholder(_),A.decrement(),l(j);var U=oF(I,$);f.replacePlaceholder(_,U),T.push(U),A.decrement(),d()})})}),m.on("error",function(v){l(v)}),m.on("partsLimit",function(){h("LIMIT_PART_COUNT")}),m.on("filesLimit",function(){h("LIMIT_FILE_COUNT")}),m.on("fieldsLimit",function(){h("LIMIT_FIELD_COUNT")}),m.on("close",function(){y=!0,d()}),t.pipe(m)}}iF.exports=cae});var dF=H((jPe,pF)=>{var Am=require("path"),lF=require("fs"),uF=parseInt("0777",8);pF.exports=Mu.mkdirp=Mu.mkdirP=Mu;function Mu(r,e,t,n){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var a=e.mode,s=e.fs||lF;a===void 0&&(a=uF),n||(n=null);var o=t||function(){};r=Am.resolve(r),s.mkdir(r,a,function(i){if(!i)return n=n||r,o(null,n);switch(i.code){case"ENOENT":if(Am.dirname(r)===r)return o(i);Mu(Am.dirname(r),e,function(u,c){u?o(u,c):Mu(r,e,o,c)});break;default:s.stat(r,function(u,c){u||!c.isDirectory()?o(i,n):o(null,n)});break}})}Mu.sync=function r(e,t,n){(!t||typeof t!="object")&&(t={mode:t});var a=t.mode,s=t.fs||lF;a===void 0&&(a=uF),n||(n=null),e=Am.resolve(e);try{s.mkdirSync(e,a),n=n||e}catch(i){switch(i.code){case"ENOENT":n=r(Am.dirname(e),t,n),r(e,t,n);break;default:var o;try{o=s.statSync(e)}catch{throw i}if(!o.isDirectory())throw i;break}}return n}});var fF=H((kPe,hF)=>{var mF=require("fs"),lae=require("os"),uae=require("path"),pae=require("crypto"),dae=dF();function mae(r,e,t){pae.randomBytes(16,function(n,a){t(n,n?void 0:a.toString("hex"))})}function hae(r,e,t){t(null,lae.tmpdir())}function TI(r){this.getFilename=r.filename||mae,typeof r.destination=="string"?(dae.sync(r.destination),this.getDestination=function(e,t,n){n(null,r.destination)}):this.getDestination=r.destination||hae}TI.prototype._handleFile=function(e,t,n){var a=this;a.getDestination(e,t,function(s,o){if(s)return n(s);a.getFilename(e,t,function(i,u){if(i)return n(i);var c=uae.join(o,u),p=mF.createWriteStream(c);t.stream.pipe(p),p.on("error",n),p.on("finish",function(){n(null,{destination:o,filename:u,path:c,size:p.bytesWritten})})})})};TI.prototype._removeFile=function(e,t,n){var a=t.path;delete t.destination,delete t.filename,delete t.path,mF.unlink(a,n)};hF.exports=function(r){return new TI(r)}});var OI=H((DPe,gF)=>{gF.exports=require("stream")});var AF=H((MPe,CF)=>{"use strict";function yF(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function bF(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yF(Object(t),!0).forEach(function(n){fae(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):yF(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function fae(r,e,t){return e=EF(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function gae(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function vF(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,EF(n.key),n)}}function yae(r,e,t){return e&&vF(r.prototype,e),t&&vF(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function EF(r){var e=bae(r,"string");return typeof e=="symbol"?e:String(e)}function bae(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var vae=require("buffer"),Ly=vae.Buffer,Eae=require("util"),NI=Eae.inspect,Cae=NI&&NI.custom||"inspect";function Aae(r,e,t){Ly.prototype.copy.call(r,e,t)}CF.exports=(function(){function r(){gae(this,r),this.head=null,this.tail=null,this.length=0}return yae(r,[{key:"push",value:function(t){var n={data:t,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(t){var n={data:t,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length!==0){var t=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,t}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(t){if(this.length===0)return"";for(var n=this.head,a=""+n.data;n=n.next;)a+=t+n.data;return a}},{key:"concat",value:function(t){if(this.length===0)return Ly.alloc(0);for(var n=Ly.allocUnsafe(t>>>0),a=this.head,s=0;a;)Aae(a.data,n,s),s+=a.data.length,a=a.next;return n}},{key:"consume",value:function(t,n){var a;return t<this.head.data.length?(a=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):t===this.head.data.length?a=this.shift():a=n?this._getString(t):this._getBuffer(t),a}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(t){var n=this.head,a=1,s=n.data;for(t-=s.length;n=n.next;){var o=n.data,i=t>o.length?o.length:t;if(i===o.length?s+=o:s+=o.slice(0,t),t-=i,t===0){i===o.length?(++a,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=o.slice(i));break}++a}return this.length-=a,s}},{key:"_getBuffer",value:function(t){var n=Ly.allocUnsafe(t),a=this.head,s=1;for(a.data.copy(n),t-=a.data.length;a=a.next;){var o=a.data,i=t>o.length?o.length:t;if(o.copy(n,n.length-t,0,i),t-=i,t===0){i===o.length?(++s,a.next?this.head=a.next:this.head=this.tail=null):(this.head=a,a.data=o.slice(i));break}++s}return this.length-=s,n}},{key:Cae,value:function(t,n){return NI(this,bF(bF({},n),{},{depth:0,customInspect:!1}))}}]),r})()});var PI=H((UPe,RF)=>{"use strict";function Sae(r,e){var t=this,n=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return n||a?(e?e(r):r&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(_I,this,r)):process.nextTick(_I,this,r)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,function(s){!e&&s?t._writableState?t._writableState.errorEmitted?process.nextTick(jy,t):(t._writableState.errorEmitted=!0,process.nextTick(SF,t,s)):process.nextTick(SF,t,s):e?(process.nextTick(jy,t),e(s)):process.nextTick(jy,t)}),this)}function SF(r,e){_I(r,e),jy(r)}function jy(r){r._writableState&&!r._writableState.emitClose||r._readableState&&!r._readableState.emitClose||r.emit("close")}function Rae(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function _I(r,e){r.emit("error",e)}function wae(r,e){var t=r._readableState,n=r._writableState;t&&t.autoDestroy||n&&n.autoDestroy?r.destroy(e):r.emit("error",e)}RF.exports={destroy:Sae,undestroy:Rae,errorOrDestroy:wae}});var si=H((BPe,xF)=>{"use strict";var IF={};function Ia(r,e,t){t||(t=Error);function n(s,o,i){return typeof e=="string"?e:e(s,o,i)}class a extends t{constructor(o,i,u){super(n(o,i,u))}}a.prototype.name=t.name,a.prototype.code=r,IF[r]=a}function wF(r,e){if(Array.isArray(r)){let t=r.length;return r=r.map(n=>String(n)),t>2?`one of ${e} ${r.slice(0,t-1).join(", ")}, or `+r[t-1]:t===2?`one of ${e} ${r[0]} or ${r[1]}`:`of ${e} ${r[0]}`}else return`of ${e} ${String(r)}`}function Iae(r,e,t){return r.substr(!t||t<0?0:+t,e.length)===e}function xae(r,e,t){return(t===void 0||t>r.length)&&(t=r.length),r.substring(t-e.length,t)===e}function Tae(r,e,t){return typeof t!="number"&&(t=0),t+e.length>r.length?!1:r.indexOf(e,t)!==-1}Ia("ERR_INVALID_OPT_VALUE",function(r,e){return'The value "'+e+'" is invalid for option "'+r+'"'},TypeError);Ia("ERR_INVALID_ARG_TYPE",function(r,e,t){let n;typeof e=="string"&&Iae(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";let a;if(xae(r," argument"))a=`The ${r} ${n} ${wF(e,"type")}`;else{let s=Tae(r,".")?"property":"argument";a=`The "${r}" ${s} ${n} ${wF(e,"type")}`}return a+=`. Received type ${typeof t}`,a},TypeError);Ia("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");Ia("ERR_METHOD_NOT_IMPLEMENTED",function(r){return"The "+r+" method is not implemented"});Ia("ERR_STREAM_PREMATURE_CLOSE","Premature close");Ia("ERR_STREAM_DESTROYED",function(r){return"Cannot call "+r+" after a stream was destroyed"});Ia("ERR_MULTIPLE_CALLBACK","Callback called multiple times");Ia("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");Ia("ERR_STREAM_WRITE_AFTER_END","write after end");Ia("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Ia("ERR_UNKNOWN_ENCODING",function(r){return"Unknown encoding: "+r},TypeError);Ia("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");xF.exports.codes=IF});var $I=H((FPe,TF)=>{"use strict";var Oae=si().codes.ERR_INVALID_OPT_VALUE;function Nae(r,e,t){return r.highWaterMark!=null?r.highWaterMark:e?r[t]:null}function _ae(r,e,t,n){var a=Nae(e,n,t);if(a!=null){if(!(isFinite(a)&&Math.floor(a)===a)||a<0){var s=n?t:"highWaterMark";throw new Oae(s,a)}return Math.floor(a)}return r.objectMode?16:16*1024}TF.exports={getHighWaterMark:_ae}});var NF=H((qPe,OF)=>{OF.exports=require("util").deprecate});var kI=H((GPe,kF)=>{"use strict";kF.exports=Tr;function PF(r){var e=this;this.next=null,this.entry=null,this.finish=function(){ase(e,r)}}var Uu;Tr.WritableState=Rm;var Pae={deprecate:NF()},$F=OI(),Dy=require("buffer").Buffer,$ae=(typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function Lae(r){return Dy.from(r)}function jae(r){return Dy.isBuffer(r)||r instanceof $ae}var jI=PI(),kae=$I(),Dae=kae.getHighWaterMark,oi=si().codes,Mae=oi.ERR_INVALID_ARG_TYPE,Uae=oi.ERR_METHOD_NOT_IMPLEMENTED,Bae=oi.ERR_MULTIPLE_CALLBACK,Fae=oi.ERR_STREAM_CANNOT_PIPE,qae=oi.ERR_STREAM_DESTROYED,Gae=oi.ERR_STREAM_NULL_VALUES,Vae=oi.ERR_STREAM_WRITE_AFTER_END,zae=oi.ERR_UNKNOWN_ENCODING,Bu=jI.errorOrDestroy;Ya()(Tr,$F);function Hae(){}function Rm(r,e,t){Uu=Uu||Uc(),r=r||{},typeof t!="boolean"&&(t=e instanceof Uu),this.objectMode=!!r.objectMode,t&&(this.objectMode=this.objectMode||!!r.writableObjectMode),this.highWaterMark=Dae(this,r,"writableHighWaterMark",t),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=r.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=r.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){Zae(e,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=r.emitClose!==!1,this.autoDestroy=!!r.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new PF(this)}Rm.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t};(function(){try{Object.defineProperty(Rm.prototype,"buffer",{get:Pae.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var ky;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(ky=Function.prototype[Symbol.hasInstance],Object.defineProperty(Tr,Symbol.hasInstance,{value:function(e){return ky.call(this,e)?!0:this!==Tr?!1:e&&e._writableState instanceof Rm}})):ky=function(e){return e instanceof this};function Tr(r){Uu=Uu||Uc();var e=this instanceof Uu;if(!e&&!ky.call(Tr,this))return new Tr(r);this._writableState=new Rm(r,this,e),this.writable=!0,r&&(typeof r.write=="function"&&(this._write=r.write),typeof r.writev=="function"&&(this._writev=r.writev),typeof r.destroy=="function"&&(this._destroy=r.destroy),typeof r.final=="function"&&(this._final=r.final)),$F.call(this)}Tr.prototype.pipe=function(){Bu(this,new Fae)};function Wae(r,e){var t=new Vae;Bu(r,t),process.nextTick(e,t)}function Qae(r,e,t,n){var a;return t===null?a=new Gae:typeof t!="string"&&!e.objectMode&&(a=new Mae("chunk",["string","Buffer"],t)),a?(Bu(r,a),process.nextTick(n,a),!1):!0}Tr.prototype.write=function(r,e,t){var n=this._writableState,a=!1,s=!n.objectMode&&jae(r);return s&&!Dy.isBuffer(r)&&(r=Lae(r)),typeof e=="function"&&(t=e,e=null),s?e="buffer":e||(e=n.defaultEncoding),typeof t!="function"&&(t=Hae),n.ending?Wae(this,t):(s||Qae(this,n,r,t))&&(n.pendingcb++,a=Kae(this,n,s,r,e,t)),a};Tr.prototype.cork=function(){this._writableState.corked++};Tr.prototype.uncork=function(){var r=this._writableState;r.corked&&(r.corked--,!r.writing&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&LF(this,r))};Tr.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new zae(e);return this._writableState.defaultEncoding=e,this};Object.defineProperty(Tr.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Jae(r,e,t){return!r.objectMode&&r.decodeStrings!==!1&&typeof e=="string"&&(e=Dy.from(e,t)),e}Object.defineProperty(Tr.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Kae(r,e,t,n,a,s){if(!t){var o=Jae(e,n,a);n!==o&&(t=!0,a="buffer",n=o)}var i=e.objectMode?1:n.length;e.length+=i;var u=e.length<e.highWaterMark;if(u||(e.needDrain=!0),e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:a,isBuf:t,callback:s,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else LI(r,e,!1,i,n,a,s);return u}function LI(r,e,t,n,a,s,o){e.writelen=n,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new qae("write")):t?r._writev(a,e.onwrite):r._write(a,s,e.onwrite),e.sync=!1}function Xae(r,e,t,n,a){--e.pendingcb,t?(process.nextTick(a,n),process.nextTick(Sm,r,e),r._writableState.errorEmitted=!0,Bu(r,n)):(a(n),r._writableState.errorEmitted=!0,Bu(r,n),Sm(r,e))}function Yae(r){r.writing=!1,r.writecb=null,r.length-=r.writelen,r.writelen=0}function Zae(r,e){var t=r._writableState,n=t.sync,a=t.writecb;if(typeof a!="function")throw new Bae;if(Yae(t),e)Xae(r,t,n,e,a);else{var s=jF(t)||r.destroyed;!s&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&LF(r,t),n?process.nextTick(_F,r,t,s,a):_F(r,t,s,a)}}function _F(r,e,t,n){t||ese(r,e),e.pendingcb--,n(),Sm(r,e)}function ese(r,e){e.length===0&&e.needDrain&&(e.needDrain=!1,r.emit("drain"))}function LF(r,e){e.bufferProcessing=!0;var t=e.bufferedRequest;if(r._writev&&t&&t.next){var n=e.bufferedRequestCount,a=new Array(n),s=e.corkedRequestsFree;s.entry=t;for(var o=0,i=!0;t;)a[o]=t,t.isBuf||(i=!1),t=t.next,o+=1;a.allBuffers=i,LI(r,e,!0,e.length,a,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new PF(e),e.bufferedRequestCount=0}else{for(;t;){var u=t.chunk,c=t.encoding,p=t.callback,m=e.objectMode?1:u.length;if(LI(r,e,!1,m,u,c,p),t=t.next,e.bufferedRequestCount--,e.writing)break}t===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=t,e.bufferProcessing=!1}Tr.prototype._write=function(r,e,t){t(new Uae("_write()"))};Tr.prototype._writev=null;Tr.prototype.end=function(r,e,t){var n=this._writableState;return typeof r=="function"?(t=r,r=null,e=null):typeof e=="function"&&(t=e,e=null),r!=null&&this.write(r,e),n.corked&&(n.corked=1,this.uncork()),n.ending||nse(this,n,t),this};Object.defineProperty(Tr.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function jF(r){return r.ending&&r.length===0&&r.bufferedRequest===null&&!r.finished&&!r.writing}function tse(r,e){r._final(function(t){e.pendingcb--,t&&Bu(r,t),e.prefinished=!0,r.emit("prefinish"),Sm(r,e)})}function rse(r,e){!e.prefinished&&!e.finalCalled&&(typeof r._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,process.nextTick(tse,r,e)):(e.prefinished=!0,r.emit("prefinish")))}function Sm(r,e){var t=jF(e);if(t&&(rse(r,e),e.pendingcb===0&&(e.finished=!0,r.emit("finish"),e.autoDestroy))){var n=r._readableState;(!n||n.autoDestroy&&n.endEmitted)&&r.destroy()}return t}function nse(r,e,t){e.ending=!0,Sm(r,e),t&&(e.finished?process.nextTick(t):r.once("finish",t)),e.ended=!0,r.writable=!1}function ase(r,e,t){var n=r.entry;for(r.entry=null;n;){var a=n.callback;e.pendingcb--,a(t),n=n.next}e.corkedRequestsFree.next=r}Object.defineProperty(Tr.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}});Tr.prototype.destroy=jI.destroy;Tr.prototype._undestroy=jI.undestroy;Tr.prototype._destroy=function(r,e){e(r)}});var Uc=H((VPe,MF)=>{"use strict";var sse=Object.keys||function(r){var e=[];for(var t in r)e.push(t);return e};MF.exports=ws;var DF=UI(),MI=kI();Ya()(ws,DF);for(DI=sse(MI.prototype),My=0;My<DI.length;My++)Uy=DI[My],ws.prototype[Uy]||(ws.prototype[Uy]=MI.prototype[Uy]);var DI,Uy,My;function ws(r){if(!(this instanceof ws))return new ws(r);DF.call(this,r),MI.call(this,r),this.allowHalfOpen=!0,r&&(r.readable===!1&&(this.readable=!1),r.writable===!1&&(this.writable=!1),r.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",ose)))}Object.defineProperty(ws.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(ws.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(ws.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ose(){this._writableState.ended||process.nextTick(ise,this)}function ise(r){r.end()}Object.defineProperty(ws.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)}})});var FF=H((BI,BF)=>{var By=require("buffer"),lo=By.Buffer;function UF(r,e){for(var t in r)e[t]=r[t]}lo.from&&lo.alloc&&lo.allocUnsafe&&lo.allocUnsafeSlow?BF.exports=By:(UF(By,BI),BI.Buffer=Fu);function Fu(r,e,t){return lo(r,e,t)}UF(lo,Fu);Fu.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return lo(r,e,t)};Fu.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=lo(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};Fu.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return lo(r)};Fu.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return By.SlowBuffer(r)}});var GI=H(GF=>{"use strict";var qI=FF().Buffer,qF=qI.isEncoding||function(r){switch(r=""+r,r&&r.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function cse(r){if(!r)return"utf8";for(var e;;)switch(r){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return r;default:if(e)return;r=(""+r).toLowerCase(),e=!0}}function lse(r){var e=cse(r);if(typeof e!="string"&&(qI.isEncoding===qF||!qF(r)))throw new Error("Unknown encoding: "+r);return e||r}GF.StringDecoder=wm;function wm(r){this.encoding=lse(r);var e;switch(this.encoding){case"utf16le":this.text=fse,this.end=gse,e=4;break;case"utf8":this.fillLast=dse,e=4;break;case"base64":this.text=yse,this.end=bse,e=3;break;default:this.write=vse,this.end=Ese;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=qI.allocUnsafe(e)}wm.prototype.write=function(r){if(r.length===0)return"";var e,t;if(this.lastNeed){if(e=this.fillLast(r),e===void 0)return"";t=this.lastNeed,this.lastNeed=0}else t=0;return t<r.length?e?e+this.text(r,t):this.text(r,t):e||""};wm.prototype.end=hse;wm.prototype.text=mse;wm.prototype.fillLast=function(r){if(this.lastNeed<=r.length)return r.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);r.copy(this.lastChar,this.lastTotal-this.lastNeed,0,r.length),this.lastNeed-=r.length};function FI(r){return r<=127?0:r>>5===6?2:r>>4===14?3:r>>3===30?4:r>>6===2?-1:-2}function use(r,e,t){var n=e.length-1;if(n<t)return 0;var a=FI(e[n]);return a>=0?(a>0&&(r.lastNeed=a-1),a):--n<t||a===-2?0:(a=FI(e[n]),a>=0?(a>0&&(r.lastNeed=a-2),a):--n<t||a===-2?0:(a=FI(e[n]),a>=0?(a>0&&(a===2?a=0:r.lastNeed=a-3),a):0))}function pse(r,e,t){if((e[0]&192)!==128)return r.lastNeed=0,"\uFFFD";if(r.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return r.lastNeed=1,"\uFFFD";if(r.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return r.lastNeed=2,"\uFFFD"}}function dse(r){var e=this.lastTotal-this.lastNeed,t=pse(this,r,e);if(t!==void 0)return t;if(this.lastNeed<=r.length)return r.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);r.copy(this.lastChar,e,0,r.length),this.lastNeed-=r.length}function mse(r,e){var t=use(this,r,e);if(!this.lastNeed)return r.toString("utf8",e);this.lastTotal=t;var n=r.length-(t-this.lastNeed);return r.copy(this.lastChar,0,n),r.toString("utf8",e,n)}function hse(r){var e=r&&r.length?this.write(r):"";return this.lastNeed?e+"\uFFFD":e}function fse(r,e){if((r.length-e)%2===0){var t=r.toString("utf16le",e);if(t){var n=t.charCodeAt(t.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=r[r.length-2],this.lastChar[1]=r[r.length-1],t.slice(0,-1)}return t}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=r[r.length-1],r.toString("utf16le",e,r.length-1)}function gse(r){var e=r&&r.length?this.write(r):"";if(this.lastNeed){var t=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,t)}return e}function yse(r,e){var t=(r.length-e)%3;return t===0?r.toString("base64",e):(this.lastNeed=3-t,this.lastTotal=3,t===1?this.lastChar[0]=r[r.length-1]:(this.lastChar[0]=r[r.length-2],this.lastChar[1]=r[r.length-1]),r.toString("base64",e,r.length-t))}function bse(r){var e=r&&r.length?this.write(r):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function vse(r){return r.toString(this.encoding)}function Ese(r){return r&&r.length?this.write(r):""}});var Fy=H((HPe,HF)=>{"use strict";var VF=si().codes.ERR_STREAM_PREMATURE_CLOSE;function Cse(r){var e=!1;return function(){if(!e){e=!0;for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];r.apply(this,n)}}}function Ase(){}function Sse(r){return r.setHeader&&typeof r.abort=="function"}function zF(r,e,t){if(typeof e=="function")return zF(r,null,e);e||(e={}),t=Cse(t||Ase);var n=e.readable||e.readable!==!1&&r.readable,a=e.writable||e.writable!==!1&&r.writable,s=function(){r.writable||i()},o=r._writableState&&r._writableState.finished,i=function(){a=!1,o=!0,n||t.call(r)},u=r._readableState&&r._readableState.endEmitted,c=function(){n=!1,u=!0,a||t.call(r)},p=function(y){t.call(r,y)},m=function(){var y;if(n&&!u)return(!r._readableState||!r._readableState.ended)&&(y=new VF),t.call(r,y);if(a&&!o)return(!r._writableState||!r._writableState.ended)&&(y=new VF),t.call(r,y)},f=function(){r.req.on("finish",i)};return Sse(r)?(r.on("complete",i),r.on("abort",m),r.req?f():r.on("request",f)):a&&!r._writableState&&(r.on("end",s),r.on("close",s)),r.on("end",c),r.on("finish",i),e.error!==!1&&r.on("error",p),r.on("close",m),function(){r.removeListener("complete",i),r.removeListener("abort",m),r.removeListener("request",f),r.req&&r.req.removeListener("finish",i),r.removeListener("end",s),r.removeListener("close",s),r.removeListener("finish",i),r.removeListener("end",c),r.removeListener("error",p),r.removeListener("close",m)}}HF.exports=zF});var QF=H((WPe,WF)=>{"use strict";var qy;function ii(r,e,t){return e=Rse(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Rse(r){var e=wse(r,"string");return typeof e=="symbol"?e:String(e)}function wse(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var Ise=Fy(),ci=Symbol("lastResolve"),Bc=Symbol("lastReject"),Im=Symbol("error"),Gy=Symbol("ended"),Fc=Symbol("lastPromise"),VI=Symbol("handlePromise"),qc=Symbol("stream");function li(r,e){return{value:r,done:e}}function xse(r){var e=r[ci];if(e!==null){var t=r[qc].read();t!==null&&(r[Fc]=null,r[ci]=null,r[Bc]=null,e(li(t,!1)))}}function Tse(r){process.nextTick(xse,r)}function Ose(r,e){return function(t,n){r.then(function(){if(e[Gy]){t(li(void 0,!0));return}e[VI](t,n)},n)}}var Nse=Object.getPrototypeOf(function(){}),_se=Object.setPrototypeOf((qy={get stream(){return this[qc]},next:function(){var e=this,t=this[Im];if(t!==null)return Promise.reject(t);if(this[Gy])return Promise.resolve(li(void 0,!0));if(this[qc].destroyed)return new Promise(function(o,i){process.nextTick(function(){e[Im]?i(e[Im]):o(li(void 0,!0))})});var n=this[Fc],a;if(n)a=new Promise(Ose(n,this));else{var s=this[qc].read();if(s!==null)return Promise.resolve(li(s,!1));a=new Promise(this[VI])}return this[Fc]=a,a}},ii(qy,Symbol.asyncIterator,function(){return this}),ii(qy,"return",function(){var e=this;return new Promise(function(t,n){e[qc].destroy(null,function(a){if(a){n(a);return}t(li(void 0,!0))})})}),qy),Nse),Pse=function(e){var t,n=Object.create(_se,(t={},ii(t,qc,{value:e,writable:!0}),ii(t,ci,{value:null,writable:!0}),ii(t,Bc,{value:null,writable:!0}),ii(t,Im,{value:null,writable:!0}),ii(t,Gy,{value:e._readableState.endEmitted,writable:!0}),ii(t,VI,{value:function(s,o){var i=n[qc].read();i?(n[Fc]=null,n[ci]=null,n[Bc]=null,s(li(i,!1))):(n[ci]=s,n[Bc]=o)},writable:!0}),t));return n[Fc]=null,Ise(e,function(a){if(a&&a.code!=="ERR_STREAM_PREMATURE_CLOSE"){var s=n[Bc];s!==null&&(n[Fc]=null,n[ci]=null,n[Bc]=null,s(a)),n[Im]=a;return}var o=n[ci];o!==null&&(n[Fc]=null,n[ci]=null,n[Bc]=null,o(li(void 0,!0))),n[Gy]=!0}),e.on("readable",Tse.bind(null,n)),n};WF.exports=Pse});var YF=H((QPe,XF)=>{"use strict";function JF(r,e,t,n,a,s,o){try{var i=r[s](o),u=i.value}catch(c){t(c);return}i.done?e(u):Promise.resolve(u).then(n,a)}function $se(r){return function(){var e=this,t=arguments;return new Promise(function(n,a){var s=r.apply(e,t);function o(u){JF(s,n,a,o,i,"next",u)}function i(u){JF(s,n,a,o,i,"throw",u)}o(void 0)})}}function KF(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function Lse(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?KF(Object(t),!0).forEach(function(n){jse(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):KF(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function jse(r,e,t){return e=kse(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function kse(r){var e=Dse(r,"string");return typeof e=="symbol"?e:String(e)}function Dse(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var Mse=si().codes.ERR_INVALID_ARG_TYPE;function Use(r,e,t){var n;if(e&&typeof e.next=="function")n=e;else if(e&&e[Symbol.asyncIterator])n=e[Symbol.asyncIterator]();else if(e&&e[Symbol.iterator])n=e[Symbol.iterator]();else throw new Mse("iterable",["Iterable"],e);var a=new r(Lse({objectMode:!0},t)),s=!1;a._read=function(){s||(s=!0,o())};function o(){return i.apply(this,arguments)}function i(){return i=$se(function*(){try{var u=yield n.next(),c=u.value,p=u.done;p?a.push(null):a.push(yield c)?o():s=!1}catch(m){a.destroy(m)}}),i.apply(this,arguments)}return a}XF.exports=Use});var UI=H((KPe,cq)=>{"use strict";cq.exports=Ft;var qu;Ft.ReadableState=rq;var JPe=require("events").EventEmitter,tq=function(e,t){return e.listeners(t).length},Tm=OI(),Vy=require("buffer").Buffer,Bse=(typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function Fse(r){return Vy.from(r)}function qse(r){return Vy.isBuffer(r)||r instanceof Bse}var zI=require("util"),Ot;zI&&zI.debuglog?Ot=zI.debuglog("stream"):Ot=function(){};var Gse=AF(),YI=PI(),Vse=$I(),zse=Vse.getHighWaterMark,zy=si().codes,Hse=zy.ERR_INVALID_ARG_TYPE,Wse=zy.ERR_STREAM_PUSH_AFTER_EOF,Qse=zy.ERR_METHOD_NOT_IMPLEMENTED,Jse=zy.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Gu,HI,WI;Ya()(Ft,Tm);var xm=YI.errorOrDestroy,QI=["error","close","destroy","pause","resume"];function Kse(r,e,t){if(typeof r.prependListener=="function")return r.prependListener(e,t);!r._events||!r._events[e]?r.on(e,t):Array.isArray(r._events[e])?r._events[e].unshift(t):r._events[e]=[t,r._events[e]]}function rq(r,e,t){qu=qu||Uc(),r=r||{},typeof t!="boolean"&&(t=e instanceof qu),this.objectMode=!!r.objectMode,t&&(this.objectMode=this.objectMode||!!r.readableObjectMode),this.highWaterMark=zse(this,r,"readableHighWaterMark",t),this.buffer=new Gse,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=r.emitClose!==!1,this.autoDestroy=!!r.autoDestroy,this.destroyed=!1,this.defaultEncoding=r.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,r.encoding&&(Gu||(Gu=GI().StringDecoder),this.decoder=new Gu(r.encoding),this.encoding=r.encoding)}function Ft(r){if(qu=qu||Uc(),!(this instanceof Ft))return new Ft(r);var e=this instanceof qu;this._readableState=new rq(r,this,e),this.readable=!0,r&&(typeof r.read=="function"&&(this._read=r.read),typeof r.destroy=="function"&&(this._destroy=r.destroy)),Tm.call(this)}Object.defineProperty(Ft.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}});Ft.prototype.destroy=YI.destroy;Ft.prototype._undestroy=YI.undestroy;Ft.prototype._destroy=function(r,e){e(r)};Ft.prototype.push=function(r,e){var t=this._readableState,n;return t.objectMode?n=!0:typeof r=="string"&&(e=e||t.defaultEncoding,e!==t.encoding&&(r=Vy.from(r,e),e=""),n=!0),nq(this,r,e,!1,n)};Ft.prototype.unshift=function(r){return nq(this,r,null,!0,!1)};function nq(r,e,t,n,a){Ot("readableAddChunk",e);var s=r._readableState;if(e===null)s.reading=!1,Zse(r,s);else{var o;if(a||(o=Xse(s,e)),o)xm(r,o);else if(s.objectMode||e&&e.length>0)if(typeof e!="string"&&!s.objectMode&&Object.getPrototypeOf(e)!==Vy.prototype&&(e=Fse(e)),n)s.endEmitted?xm(r,new Jse):JI(r,s,e,!0);else if(s.ended)xm(r,new Wse);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!t?(e=s.decoder.write(e),s.objectMode||e.length!==0?JI(r,s,e,!1):XI(r,s)):JI(r,s,e,!1)}else n||(s.reading=!1,XI(r,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function JI(r,e,t,n){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,r.emit("data",t)):(e.length+=e.objectMode?1:t.length,n?e.buffer.unshift(t):e.buffer.push(t),e.needReadable&&Hy(r)),XI(r,e)}function Xse(r,e){var t;return!qse(e)&&typeof e!="string"&&e!==void 0&&!r.objectMode&&(t=new Hse("chunk",["string","Buffer","Uint8Array"],e)),t}Ft.prototype.isPaused=function(){return this._readableState.flowing===!1};Ft.prototype.setEncoding=function(r){Gu||(Gu=GI().StringDecoder);var e=new Gu(r);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var t=this._readableState.buffer.head,n="";t!==null;)n+=e.write(t.data),t=t.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var ZF=1073741824;function Yse(r){return r>=ZF?r=ZF:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r}function eq(r,e){return r<=0||e.length===0&&e.ended?0:e.objectMode?1:r!==r?e.flowing&&e.length?e.buffer.head.data.length:e.length:(r>e.highWaterMark&&(e.highWaterMark=Yse(r)),r<=e.length?r:e.ended?e.length:(e.needReadable=!0,0))}Ft.prototype.read=function(r){Ot("read",r),r=parseInt(r,10);var e=this._readableState,t=r;if(r!==0&&(e.emittedReadable=!1),r===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return Ot("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?KI(this):Hy(this),null;if(r=eq(r,e),r===0&&e.ended)return e.length===0&&KI(this),null;var n=e.needReadable;Ot("need readable",n),(e.length===0||e.length-r<e.highWaterMark)&&(n=!0,Ot("length less than watermark",n)),e.ended||e.reading?(n=!1,Ot("reading or ended",n)):n&&(Ot("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(r=eq(t,e)));var a;return r>0?a=oq(r,e):a=null,a===null?(e.needReadable=e.length<=e.highWaterMark,r=0):(e.length-=r,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),t!==r&&e.ended&&KI(this)),a!==null&&this.emit("data",a),a};function Zse(r,e){if(Ot("onEofChunk"),!e.ended){if(e.decoder){var t=e.decoder.end();t&&t.length&&(e.buffer.push(t),e.length+=e.objectMode?1:t.length)}e.ended=!0,e.sync?Hy(r):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,aq(r)))}}function Hy(r){var e=r._readableState;Ot("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(Ot("emitReadable",e.flowing),e.emittedReadable=!0,process.nextTick(aq,r))}function aq(r){var e=r._readableState;Ot("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(r.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,ZI(r)}function XI(r,e){e.readingMore||(e.readingMore=!0,process.nextTick(eoe,r,e))}function eoe(r,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var t=e.length;if(Ot("maybeReadMore read 0"),r.read(0),t===e.length)break}e.readingMore=!1}Ft.prototype._read=function(r){xm(this,new Qse("_read()"))};Ft.prototype.pipe=function(r,e){var t=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=r;break;case 1:n.pipes=[n.pipes,r];break;default:n.pipes.push(r);break}n.pipesCount+=1,Ot("pipe count=%d opts=%j",n.pipesCount,e);var a=(!e||e.end!==!1)&&r!==process.stdout&&r!==process.stderr,s=a?i:C;n.endEmitted?process.nextTick(s):t.once("end",s),r.on("unpipe",o);function o(A,T){Ot("onunpipe"),A===t&&T&&T.hasUnpiped===!1&&(T.hasUnpiped=!0,p())}function i(){Ot("onend"),r.end()}var u=toe(t);r.on("drain",u);var c=!1;function p(){Ot("cleanup"),r.removeListener("close",g),r.removeListener("finish",y),r.removeListener("drain",u),r.removeListener("error",f),r.removeListener("unpipe",o),t.removeListener("end",i),t.removeListener("end",C),t.removeListener("data",m),c=!0,n.awaitDrain&&(!r._writableState||r._writableState.needDrain)&&u()}t.on("data",m);function m(A){Ot("ondata");var T=r.write(A);Ot("dest.write",T),T===!1&&((n.pipesCount===1&&n.pipes===r||n.pipesCount>1&&iq(n.pipes,r)!==-1)&&!c&&(Ot("false write response, pause",n.awaitDrain),n.awaitDrain++),t.pause())}function f(A){Ot("onerror",A),C(),r.removeListener("error",f),tq(r,"error")===0&&xm(r,A)}Kse(r,"error",f);function g(){r.removeListener("finish",y),C()}r.once("close",g);function y(){Ot("onfinish"),r.removeListener("close",g),C()}r.once("finish",y);function C(){Ot("unpipe"),t.unpipe(r)}return r.emit("pipe",t),n.flowing||(Ot("pipe resume"),t.resume()),r};function toe(r){return function(){var t=r._readableState;Ot("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,t.awaitDrain===0&&tq(r,"data")&&(t.flowing=!0,ZI(r))}}Ft.prototype.unpipe=function(r){var e=this._readableState,t={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return r&&r!==e.pipes?this:(r||(r=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,r&&r.emit("unpipe",this,t),this);if(!r){var n=e.pipes,a=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<a;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=iq(e.pipes,r);return o===-1?this:(e.pipes.splice(o,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),r.emit("unpipe",this,t),this)};Ft.prototype.on=function(r,e){var t=Tm.prototype.on.call(this,r,e),n=this._readableState;return r==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):r==="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,Ot("on readable",n.length,n.reading),n.length?Hy(this):n.reading||process.nextTick(roe,this)),t};Ft.prototype.addListener=Ft.prototype.on;Ft.prototype.removeListener=function(r,e){var t=Tm.prototype.removeListener.call(this,r,e);return r==="readable"&&process.nextTick(sq,this),t};Ft.prototype.removeAllListeners=function(r){var e=Tm.prototype.removeAllListeners.apply(this,arguments);return(r==="readable"||r===void 0)&&process.nextTick(sq,this),e};function sq(r){var e=r._readableState;e.readableListening=r.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:r.listenerCount("data")>0&&r.resume()}function roe(r){Ot("readable nexttick read 0"),r.read(0)}Ft.prototype.resume=function(){var r=this._readableState;return r.flowing||(Ot("resume"),r.flowing=!r.readableListening,noe(this,r)),r.paused=!1,this};function noe(r,e){e.resumeScheduled||(e.resumeScheduled=!0,process.nextTick(aoe,r,e))}function aoe(r,e){Ot("resume",e.reading),e.reading||r.read(0),e.resumeScheduled=!1,r.emit("resume"),ZI(r),e.flowing&&!e.reading&&r.read(0)}Ft.prototype.pause=function(){return Ot("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Ot("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function ZI(r){var e=r._readableState;for(Ot("flow",e.flowing);e.flowing&&r.read()!==null;);}Ft.prototype.wrap=function(r){var e=this,t=this._readableState,n=!1;r.on("end",function(){if(Ot("wrapped end"),t.decoder&&!t.ended){var o=t.decoder.end();o&&o.length&&e.push(o)}e.push(null)}),r.on("data",function(o){if(Ot("wrapped data"),t.decoder&&(o=t.decoder.write(o)),!(t.objectMode&&o==null)&&!(!t.objectMode&&(!o||!o.length))){var i=e.push(o);i||(n=!0,r.pause())}});for(var a in r)this[a]===void 0&&typeof r[a]=="function"&&(this[a]=(function(i){return function(){return r[i].apply(r,arguments)}})(a));for(var s=0;s<QI.length;s++)r.on(QI[s],this.emit.bind(this,QI[s]));return this._read=function(o){Ot("wrapped _read",o),n&&(n=!1,r.resume())},this};typeof Symbol=="function"&&(Ft.prototype[Symbol.asyncIterator]=function(){return HI===void 0&&(HI=QF()),HI(this)});Object.defineProperty(Ft.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(Ft.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(Ft.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}});Ft._fromList=oq;Object.defineProperty(Ft.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function oq(r,e){if(e.length===0)return null;var t;return e.objectMode?t=e.buffer.shift():!r||r>=e.length?(e.decoder?t=e.buffer.join(""):e.buffer.length===1?t=e.buffer.first():t=e.buffer.concat(e.length),e.buffer.clear()):t=e.buffer.consume(r,e.decoder),t}function KI(r){var e=r._readableState;Ot("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,process.nextTick(soe,e,r))}function soe(r,e){if(Ot("endReadableNT",r.endEmitted,r.length),!r.endEmitted&&r.length===0&&(r.endEmitted=!0,e.readable=!1,e.emit("end"),r.autoDestroy)){var t=e._writableState;(!t||t.autoDestroy&&t.finished)&&e.destroy()}}typeof Symbol=="function"&&(Ft.from=function(r,e){return WI===void 0&&(WI=YF()),WI(Ft,r,e)});function iq(r,e){for(var t=0,n=r.length;t<n;t++)if(r[t]===e)return t;return-1}});var ex=H((XPe,uq)=>{"use strict";uq.exports=uo;var Wy=si().codes,ooe=Wy.ERR_METHOD_NOT_IMPLEMENTED,ioe=Wy.ERR_MULTIPLE_CALLBACK,coe=Wy.ERR_TRANSFORM_ALREADY_TRANSFORMING,loe=Wy.ERR_TRANSFORM_WITH_LENGTH_0,Qy=Uc();Ya()(uo,Qy);function uoe(r,e){var t=this._transformState;t.transforming=!1;var n=t.writecb;if(n===null)return this.emit("error",new ioe);t.writechunk=null,t.writecb=null,e!=null&&this.push(e),n(r);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function uo(r){if(!(this instanceof uo))return new uo(r);Qy.call(this,r),this._transformState={afterTransform:uoe.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.on("prefinish",poe)}function poe(){var r=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,t){lq(r,e,t)}):lq(this,null,null)}uo.prototype.push=function(r,e){return this._transformState.needTransform=!1,Qy.prototype.push.call(this,r,e)};uo.prototype._transform=function(r,e,t){t(new ooe("_transform()"))};uo.prototype._write=function(r,e,t){var n=this._transformState;if(n.writecb=t,n.writechunk=r,n.writeencoding=e,!n.transforming){var a=this._readableState;(n.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}};uo.prototype._read=function(r){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};uo.prototype._destroy=function(r,e){Qy.prototype._destroy.call(this,r,function(t){e(t)})};function lq(r,e,t){if(e)return r.emit("error",e);if(t!=null&&r.push(t),r._writableState.length)throw new loe;if(r._transformState.transforming)throw new coe;return r.push(null)}});var mq=H((YPe,dq)=>{"use strict";dq.exports=Om;var pq=ex();Ya()(Om,pq);function Om(r){if(!(this instanceof Om))return new Om(r);pq.call(this,r)}Om.prototype._transform=function(r,e,t){t(null,r)}});var bq=H((ZPe,yq)=>{"use strict";var tx;function doe(r){var e=!1;return function(){e||(e=!0,r.apply(void 0,arguments))}}var gq=si().codes,moe=gq.ERR_MISSING_ARGS,hoe=gq.ERR_STREAM_DESTROYED;function hq(r){if(r)throw r}function foe(r){return r.setHeader&&typeof r.abort=="function"}function goe(r,e,t,n){n=doe(n);var a=!1;r.on("close",function(){a=!0}),tx===void 0&&(tx=Fy()),tx(r,{readable:e,writable:t},function(o){if(o)return n(o);a=!0,n()});var s=!1;return function(o){if(!a&&!s){if(s=!0,foe(r))return r.abort();if(typeof r.destroy=="function")return r.destroy();n(o||new hoe("pipe"))}}}function fq(r){r()}function yoe(r,e){return r.pipe(e)}function boe(r){return!r.length||typeof r[r.length-1]!="function"?hq:r.pop()}function voe(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];var n=boe(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new moe("streams");var a,s=e.map(function(o,i){var u=i<e.length-1,c=i>0;return goe(o,u,c,function(p){a||(a=p),p&&s.forEach(fq),!u&&(s.forEach(fq),n(a))})});return e.reduce(yoe)}yq.exports=voe});var vq=H((xa,_m)=>{var Nm=require("stream");process.env.READABLE_STREAM==="disable"&&Nm?(_m.exports=Nm.Readable,Object.assign(_m.exports,Nm),_m.exports.Stream=Nm):(xa=_m.exports=UI(),xa.Stream=Nm||xa,xa.Readable=xa,xa.Writable=kI(),xa.Duplex=Uc(),xa.Transform=ex(),xa.PassThrough=mq(),xa.finished=Fy(),xa.pipeline=bq())});var Cq=H((e1e,Eq)=>{var Eoe=Object.prototype.toString,rx=typeof Buffer<"u"&&typeof Buffer.alloc=="function"&&typeof Buffer.allocUnsafe=="function"&&typeof Buffer.from=="function";function Coe(r){return Eoe.call(r).slice(8,-1)==="ArrayBuffer"}function Aoe(r,e,t){e>>>=0;var n=r.byteLength-e;if(n<0)throw new RangeError("'offset' is out of bounds");if(t===void 0)t=n;else if(t>>>=0,t>n)throw new RangeError("'length' is out of bounds");return rx?Buffer.from(r.slice(e,e+t)):new Buffer(new Uint8Array(r.slice(e,e+t)))}function Soe(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!Buffer.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');return rx?Buffer.from(r,e):new Buffer(r,e)}function Roe(r,e,t){if(typeof r=="number")throw new TypeError('"value" argument must not be a number');return Coe(r)?Aoe(r,e,t):typeof r=="string"?Soe(r,e):rx?Buffer.from(r):new Buffer(r)}Eq.exports=Roe});var xq=H(mt=>{var Aq=void 0,woe=1e5,fr=(function(){var r=Object.prototype.toString,e=Object.prototype.hasOwnProperty;return{Class:function(t){return r.call(t).replace(/^\[object *|\]$/g,"")},HasProperty:function(t,n){return n in t},HasOwnProperty:function(t,n){return e.call(t,n)},IsCallable:function(t){return typeof t=="function"},ToInt32:function(t){return t>>0},ToUint32:function(t){return t>>>0}}})(),Ioe=Math.LN2,xoe=Math.abs,Jy=Math.floor,Toe=Math.log,Ooe=Math.min,Xa=Math.pow,Noe=Math.round;function nx(r){if(Sq&&Vu){var e=Sq(r),t;for(t=0;t<e.length;t+=1)Vu(r,e[t],{value:r[e[t]],writable:!1,enumerable:!1,configurable:!1})}}var Vu;Object.defineProperty&&(function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}})()?Vu=Object.defineProperty:Vu=function(r,e,t){if(!r===Object(r))throw new TypeError("Object.defineProperty called on non-object");return fr.HasProperty(t,"get")&&Object.prototype.__defineGetter__&&Object.prototype.__defineGetter__.call(r,e,t.get),fr.HasProperty(t,"set")&&Object.prototype.__defineSetter__&&Object.prototype.__defineSetter__.call(r,e,t.set),fr.HasProperty(t,"value")&&(r[e]=t.value),r};var Sq=Object.getOwnPropertyNames||function(r){if(r!==Object(r))throw new TypeError("Object.getOwnPropertyNames called on non-object");var e=[],t;for(t in r)fr.HasOwnProperty(r,t)&&e.push(t);return e};function _oe(r){if(!Vu)return;if(r.length>woe)throw new RangeError("Array too large for polyfill");function e(n){Vu(r,n,{get:function(){return r._getter(n)},set:function(a){r._setter(n,a)},enumerable:!0,configurable:!1})}var t;for(t=0;t<r.length;t+=1)e(t)}function ax(r,e){var t=32-e;return r<<t>>t}function sx(r,e){var t=32-e;return r<<t>>>t}function Poe(r){return[r&255]}function $oe(r){return ax(r[0],8)}function Loe(r){return[r&255]}function Rq(r){return sx(r[0],8)}function joe(r){return r=Noe(Number(r)),[r<0?0:r>255?255:r&255]}function koe(r){return[r>>8&255,r&255]}function Doe(r){return ax(r[0]<<8|r[1],16)}function Moe(r){return[r>>8&255,r&255]}function Uoe(r){return sx(r[0]<<8|r[1],16)}function Boe(r){return[r>>24&255,r>>16&255,r>>8&255,r&255]}function Foe(r){return ax(r[0]<<24|r[1]<<16|r[2]<<8|r[3],32)}function qoe(r){return[r>>24&255,r>>16&255,r>>8&255,r&255]}function Goe(r){return sx(r[0]<<24|r[1]<<16|r[2]<<8|r[3],32)}function wq(r,e,t){var n=(1<<e-1)-1,a,s,o,i,u,c,p,m;function f(g){var y=Jy(g),C=g-y;return C<.5?y:C>.5||y%2?y+1:y}for(r!==r?(s=(1<<e)-1,o=Xa(2,t-1),a=0):r===1/0||r===-1/0?(s=(1<<e)-1,o=0,a=r<0?1:0):r===0?(s=0,o=0,a=1/r===-1/0?1:0):(a=r<0,r=xoe(r),r>=Xa(2,1-n)?(s=Ooe(Jy(Toe(r)/Ioe),1023),o=f(r/Xa(2,s)*Xa(2,t)),o/Xa(2,t)>=2&&(s=s+1,o=1),s>n?(s=(1<<e)-1,o=0):(s=s+n,o=o-Xa(2,t))):(s=0,o=f(r/Xa(2,1-n-t)))),c=[],u=t;u;u-=1)c.push(o%2?1:0),o=Jy(o/2);for(u=e;u;u-=1)c.push(s%2?1:0),s=Jy(s/2);for(c.push(a?1:0),c.reverse(),p=c.join(""),m=[];p.length;)m.push(parseInt(p.substring(0,8),2)),p=p.substring(8);return m}function Iq(r,e,t){var n=[],a,s,o,i,u,c,p,m;for(a=r.length;a;a-=1)for(o=r[a-1],s=8;s;s-=1)n.push(o%2?1:0),o=o>>1;return n.reverse(),i=n.join(""),u=(1<<e-1)-1,c=parseInt(i.substring(0,1),2)?-1:1,p=parseInt(i.substring(1,1+e),2),m=parseInt(i.substring(1+e),2),p===(1<<e)-1?m!==0?NaN:c*(1/0):p>0?c*Xa(2,p-u)*(1+m/Xa(2,t)):m!==0?c*Xa(2,-(u-1))*(m/Xa(2,t)):c<0?-0:0}function Voe(r){return Iq(r,11,52)}function zoe(r){return wq(r,11,52)}function Hoe(r){return Iq(r,8,23)}function Woe(r){return wq(r,8,23)}(function(){var r=function(g){if(g=fr.ToInt32(g),g<0)throw new RangeError("ArrayBuffer size is not a small enough positive integer");this.byteLength=g,this._bytes=[],this._bytes.length=g;var y;for(y=0;y<this.byteLength;y+=1)this._bytes[y]=0;nx(this)};mt.ArrayBuffer=mt.ArrayBuffer||r;var e=function(){};function t(f,g,y){var C;return C=function(A,T,E){var d,l,h,v;if(!arguments.length||typeof arguments[0]=="number"){if(this.length=fr.ToInt32(arguments[0]),E<0)throw new RangeError("ArrayBufferView size is not a small enough positive integer");this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new r(this.byteLength),this.byteOffset=0}else if(typeof arguments[0]=="object"&&arguments[0].constructor===C)for(d=arguments[0],this.length=d.length,this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new r(this.byteLength),this.byteOffset=0,h=0;h<this.length;h+=1)this._setter(h,d._getter(h));else if(typeof arguments[0]=="object"&&!(arguments[0]instanceof r||fr.Class(arguments[0])==="ArrayBuffer"))for(l=arguments[0],this.length=fr.ToUint32(l.length),this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new r(this.byteLength),this.byteOffset=0,h=0;h<this.length;h+=1)v=l[h],this._setter(h,Number(v));else if(typeof arguments[0]=="object"&&(arguments[0]instanceof r||fr.Class(arguments[0])==="ArrayBuffer")){if(this.buffer=A,this.byteOffset=fr.ToUint32(T),this.byteOffset>this.buffer.byteLength)throw new RangeError("byteOffset out of range");if(this.byteOffset%this.BYTES_PER_ELEMENT)throw new RangeError("ArrayBuffer length minus the byteOffset is not a multiple of the element size.");if(arguments.length<3){if(this.byteLength=this.buffer.byteLength-this.byteOffset,this.byteLength%this.BYTES_PER_ELEMENT)throw new RangeError("length of buffer minus byteOffset not a multiple of the element size");this.length=this.byteLength/this.BYTES_PER_ELEMENT}else this.length=fr.ToUint32(E),this.byteLength=this.length*this.BYTES_PER_ELEMENT;if(this.byteOffset+this.byteLength>this.buffer.byteLength)throw new RangeError("byteOffset and length reference an area beyond the end of the buffer")}else throw new TypeError("Unexpected argument type(s)");this.constructor=C,nx(this),_oe(this)},C.prototype=new e,C.prototype.BYTES_PER_ELEMENT=f,C.prototype._pack=g,C.prototype._unpack=y,C.BYTES_PER_ELEMENT=f,C.prototype._getter=function(A){if(arguments.length<1)throw new SyntaxError("Not enough arguments");if(A=fr.ToUint32(A),A>=this.length)return Aq;var T=[],E,d;for(E=0,d=this.byteOffset+A*this.BYTES_PER_ELEMENT;E<this.BYTES_PER_ELEMENT;E+=1,d+=1)T.push(this.buffer._bytes[d]);return this._unpack(T)},C.prototype.get=C.prototype._getter,C.prototype._setter=function(A,T){if(arguments.length<2)throw new SyntaxError("Not enough arguments");if(A=fr.ToUint32(A),A>=this.length)return Aq;var E=this._pack(T),d,l;for(d=0,l=this.byteOffset+A*this.BYTES_PER_ELEMENT;d<this.BYTES_PER_ELEMENT;d+=1,l+=1)this.buffer._bytes[l]=E[d]},C.prototype.set=function(A,T){if(arguments.length<1)throw new SyntaxError("Not enough arguments");var E,d,l,h,v,S,R,x,w,O;if(typeof arguments[0]=="object"&&arguments[0].constructor===this.constructor){if(E=arguments[0],l=fr.ToUint32(arguments[1]),l+E.length>this.length)throw new RangeError("Offset plus length of array is out of range");if(x=this.byteOffset+l*this.BYTES_PER_ELEMENT,w=E.length*this.BYTES_PER_ELEMENT,E.buffer===this.buffer){for(O=[],v=0,S=E.byteOffset;v<w;v+=1,S+=1)O[v]=E.buffer._bytes[S];for(v=0,R=x;v<w;v+=1,R+=1)this.buffer._bytes[R]=O[v]}else for(v=0,S=E.byteOffset,R=x;v<w;v+=1,S+=1,R+=1)this.buffer._bytes[R]=E.buffer._bytes[S]}else if(typeof arguments[0]=="object"&&typeof arguments[0].length<"u"){if(d=arguments[0],h=fr.ToUint32(d.length),l=fr.ToUint32(arguments[1]),l+h>this.length)throw new RangeError("Offset plus length of array is out of range");for(v=0;v<h;v+=1)S=d[v],this._setter(l+v,Number(S))}else throw new TypeError("Unexpected argument type(s)")},C.prototype.subarray=function(A,T){function E(l,h,v){return l<h?h:l>v?v:l}A=fr.ToInt32(A),T=fr.ToInt32(T),arguments.length<1&&(A=0),arguments.length<2&&(T=this.length),A<0&&(A=this.length+A),T<0&&(T=this.length+T),A=E(A,0,this.length),T=E(T,0,this.length);var d=T-A;return d<0&&(d=0),new this.constructor(this.buffer,this.byteOffset+A*this.BYTES_PER_ELEMENT,d)},C}var n=t(1,Poe,$oe),a=t(1,Loe,Rq),s=t(1,joe,Rq),o=t(2,koe,Doe),i=t(2,Moe,Uoe),u=t(4,Boe,Foe),c=t(4,qoe,Goe),p=t(4,Woe,Hoe),m=t(8,zoe,Voe);mt.Int8Array=mt.Int8Array||n,mt.Uint8Array=mt.Uint8Array||a,mt.Uint8ClampedArray=mt.Uint8ClampedArray||s,mt.Int16Array=mt.Int16Array||o,mt.Uint16Array=mt.Uint16Array||i,mt.Int32Array=mt.Int32Array||u,mt.Uint32Array=mt.Uint32Array||c,mt.Float32Array=mt.Float32Array||p,mt.Float64Array=mt.Float64Array||m})();(function(){function r(s,o){return fr.IsCallable(s.get)?s.get(o):s[o]}var e=(function(){var s=new mt.Uint16Array([4660]),o=new mt.Uint8Array(s.buffer);return r(o,0)===18})(),t=function(o,i,u){if(arguments.length===0)o=new mt.ArrayBuffer(0);else if(!(o instanceof mt.ArrayBuffer||fr.Class(o)==="ArrayBuffer"))throw new TypeError("TypeError");if(this.buffer=o||new mt.ArrayBuffer(0),this.byteOffset=fr.ToUint32(i),this.byteOffset>this.buffer.byteLength)throw new RangeError("byteOffset out of range");if(arguments.length<3?this.byteLength=this.buffer.byteLength-this.byteOffset:this.byteLength=fr.ToUint32(u),this.byteOffset+this.byteLength>this.buffer.byteLength)throw new RangeError("byteOffset and length reference an area beyond the end of the buffer");nx(this)};function n(s){return function(o,i){if(o=fr.ToUint32(o),o+s.BYTES_PER_ELEMENT>this.byteLength)throw new RangeError("Array index out of range");o+=this.byteOffset;var u=new mt.Uint8Array(this.buffer,o,s.BYTES_PER_ELEMENT),c=[],p;for(p=0;p<s.BYTES_PER_ELEMENT;p+=1)c.push(r(u,p));return!!i==!!e&&c.reverse(),r(new s(new mt.Uint8Array(c).buffer),0)}}t.prototype.getUint8=n(mt.Uint8Array),t.prototype.getInt8=n(mt.Int8Array),t.prototype.getUint16=n(mt.Uint16Array),t.prototype.getInt16=n(mt.Int16Array),t.prototype.getUint32=n(mt.Uint32Array),t.prototype.getInt32=n(mt.Int32Array),t.prototype.getFloat32=n(mt.Float32Array),t.prototype.getFloat64=n(mt.Float64Array);function a(s){return function(o,i,u){if(o=fr.ToUint32(o),o+s.BYTES_PER_ELEMENT>this.byteLength)throw new RangeError("Array index out of range");var c=new s([i]),p=new mt.Uint8Array(c.buffer),m=[],f,g;for(f=0;f<s.BYTES_PER_ELEMENT;f+=1)m.push(r(p,f));!!u==!!e&&m.reverse(),g=new mt.Uint8Array(this.buffer,o,s.BYTES_PER_ELEMENT),g.set(m)}}t.prototype.setUint8=a(mt.Uint8Array),t.prototype.setInt8=a(mt.Int8Array),t.prototype.setUint16=a(mt.Uint16Array),t.prototype.setInt16=a(mt.Int16Array),t.prototype.setUint32=a(mt.Uint32Array),t.prototype.setInt32=a(mt.Int32Array),t.prototype.setFloat32=a(mt.Float32Array),t.prototype.setFloat64=a(mt.Float64Array),mt.DataView=mt.DataView||t})()});var _q=H((r1e,Nq)=>{var Tq=vq().Writable,Qoe=Ya(),Pm=Cq();typeof Uint8Array>"u"?Ky=xq().Uint8Array:Ky=Uint8Array;var Ky;function Gc(r,e){if(!(this instanceof Gc))return new Gc(r,e);typeof r=="function"&&(e=r,r={}),r||(r={});var t=r.encoding,n=!1;t?(t=String(t).toLowerCase(),(t==="u8"||t==="uint8")&&(t="uint8array")):n=!0,Tq.call(this,{objectMode:!0}),this.encoding=t,this.shouldInferEncoding=n,e&&this.on("finish",function(){e(this.getBody())}),this.body=[]}Nq.exports=Gc;Qoe(Gc,Tq);Gc.prototype._write=function(r,e,t){this.body.push(r),t()};Gc.prototype.inferEncoding=function(r){var e=r===void 0?this.body[0]:r;return Buffer.isBuffer(e)?"buffer":typeof Uint8Array<"u"&&e instanceof Uint8Array?"uint8array":Array.isArray(e)?"array":typeof e=="string"?"string":Object.prototype.toString.call(e)==="[object Object]"?"object":"buffer"};Gc.prototype.getBody=function(){return!this.encoding&&this.body.length===0?[]:(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),this.encoding==="array"?Yoe(this.body):this.encoding==="string"?Koe(this.body):this.encoding==="buffer"?Xoe(this.body):this.encoding==="uint8array"?Zoe(this.body):this.body)};function Joe(r){return/Array\]$/.test(Object.prototype.toString.call(r))}function Oq(r){return typeof r=="string"||Joe(r)||r&&typeof r.subarray=="function"}function Koe(r){for(var e=[],t=!1,n=0;n<r.length;n++){var a=r[n];typeof a=="string"||Buffer.isBuffer(a)?e.push(a):Oq(a)?e.push(Pm(a)):e.push(Pm(String(a)))}return Buffer.isBuffer(r[0])?(e=Buffer.concat(e),e=e.toString("utf8")):e=e.join(""),e}function Xoe(r){for(var e=[],t=0;t<r.length;t++){var n=r[t];Buffer.isBuffer(n)?e.push(n):Oq(n)?e.push(Pm(n)):e.push(Pm(String(n)))}return Buffer.concat(e)}function Yoe(r){for(var e=[],t=0;t<r.length;t++)e.push.apply(e,r[t]);return e}function Zoe(r){for(var e=0,t=0;t<r.length;t++)typeof r[t]=="string"&&(r[t]=Pm(r[t])),e+=r[t].length;for(var n=new Ky(e),t=0,a=0;t<r.length;t++)for(var s=r[t],o=0;o<s.length;o++)n[a++]=s[o];return n}});var $q=H((n1e,Pq)=>{var eie=_q();function ox(r){}ox.prototype._handleFile=function(e,t,n){t.stream.pipe(eie({encoding:"buffer"},function(a){n(null,{buffer:a,size:a.length})}))};ox.prototype._removeFile=function(e,t,n){delete t.buffer,n(null)};Pq.exports=function(r){return new ox(r)}});var Mq=H((a1e,$m)=>{var Lq=cF(),jq=fF(),kq=$q(),Dq=xI();function tie(r,e,t){t(null,!0)}function ui(r){r.storage?this.storage=r.storage:r.dest?this.storage=jq({destination:r.dest}):this.storage=kq(),this.limits=r.limits,this.preservePath=r.preservePath,this.fileFilter=r.fileFilter||tie}ui.prototype._makeMiddleware=function(r,e){function t(){var n=this.fileFilter,a=Object.create(null);r.forEach(function(o){typeof o.maxCount=="number"?a[o.name]=o.maxCount:a[o.name]=1/0});function s(o,i,u){if((a[i.fieldname]||0)<=0)return u(new Dq("LIMIT_UNEXPECTED_FILE",i.fieldname));a[i.fieldname]-=1,n(o,i,u)}return{limits:this.limits,preservePath:this.preservePath,storage:this.storage,fileFilter:s,fileStrategy:e}}return Lq(t.bind(this))};ui.prototype.single=function(r){return this._makeMiddleware([{name:r,maxCount:1}],"VALUE")};ui.prototype.array=function(r,e){return this._makeMiddleware([{name:r,maxCount:e}],"ARRAY")};ui.prototype.fields=function(r){return this._makeMiddleware(r,"OBJECT")};ui.prototype.none=function(){return this._makeMiddleware([],"NONE")};ui.prototype.any=function(){function r(){return{limits:this.limits,preservePath:this.preservePath,storage:this.storage,fileFilter:this.fileFilter,fileStrategy:"ARRAY"}}return Lq(r.bind(this))};function rie(r){if(r===void 0)return new ui({});if(typeof r=="object"&&r!==null)return new ui(r);throw new TypeError("Expected object for argument options")}$m.exports=rie;$m.exports.diskStorage=jq;$m.exports.memoryStorage=kq;$m.exports.MulterError=Dq});var aie,sie,oie,Yy,Zy,eb,Bq=G(()=>{"use strict";It();aie=`Eres un ARQUITECTO LITERARIO CONSERVADOR experto en an\xE1lisis estructural de novelas. Tu filosof\xEDa: "Si no est\xE1 roto, no lo arregles."

PRINCIPIO FUNDAMENTAL: La mayor\xEDa de manuscritos NO necesitan expansi\xF3n ni cap\xEDtulos nuevos. Solo recomienda cambios cuando hay un PROBLEMA REAL que afecte la comprensi\xF3n del lector.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CU\xC1NDO S\xCD RECOMENDAR EXPANSI\xD3N DE CAP\xCDTULO (necessityScore >= 0.7):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
- Cap\xEDtulo CR\xCDTICO para la trama con menos de 1200 palabras (escena clim\xE1tica comprimida)
- Salto emocional que confunde al lector (el personaje pasa de triste a feliz sin transici\xF3n)
- Escena de acci\xF3n que termina de forma tan abrupta que parece cortada

CU\xC1NDO NO RECOMENDAR EXPANSI\xD3N (necessityScore < 0.5):
- El cap\xEDtulo tiene menos palabras pero FUNCIONA narrativamente
- Es un cap\xEDtulo de transici\xF3n que cumple su prop\xF3sito
- El ritmo r\xE1pido es INTENCIONAL para el g\xE9nero (thriller, acci\xF3n)

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CU\xC1NDO S\xCD INSERTAR NUEVO CAP\xCDTULO (necessityScore >= 0.8):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
- Salto temporal de MESES/A\xD1OS sin ninguna explicaci\xF3n que deja al lector perdido
- Personaje que aparece muerto/herido/transformado sin mostrar c\xF3mo ocurri\xF3
- Hueco argumental CR\xCDTICO que rompe la l\xF3gica de la historia
- Subplot importante que desaparece sin resoluci\xF3n

CU\xC1NDO NUNCA INSERTAR NUEVO CAP\xCDTULO (necessityScore = 0):
- Saltos temporales menores (horas, d\xEDas) que son normales en narrativa
- Querer "desarrollar m\xE1s" una relaci\xF3n que ya funciona
- A\xF1adir "m\xE1s contexto" cuando el contexto existente es suficiente
- El manuscrito ya tiene buen ritmo y fluye naturalmente

ESCALA DE necessityScore:
- 0.0-0.3: Completamente innecesario, no sugerir
- 0.4-0.6: Opcional, podr\xEDa ayudar pero no es cr\xEDtico - NO INCLUIR
- 0.7-0.8: Recomendado, mejora significativamente la narrativa
- 0.9-1.0: CR\xCDTICO, hay un hueco que confunde al lector

REGLA DE ORO: Si tienes dudas, NO lo sugieras. Es mejor un manuscrito ligeramente corto que uno inflado con relleno.`,sie=`Eres un MAESTRO DE PROSA LITERARIA. Tu misi\xF3n es EXPANDIR cap\xEDtulos manteniendo la voz del autor original.

T\xC9CNICAS DE EXPANSI\xD3N PERMITIDAS:
1. ESCENAS NUEVAS: A\xF1adir escenas que profundicen en el personaje o la trama
2. DI\xC1LOGOS: Expandir conversaciones existentes o a\xF1adir nuevas que revelen car\xE1cter
3. DESCRIPCIONES SENSORIALES: A\xF1adir atm\xF3sfera con los 5 sentidos
4. INTROSPECCI\xD3N: Profundizar en el mon\xF3logo interno del protagonista
5. DETALLES DEL MUNDO: A\xF1adir elementos del worldbuilding org\xE1nicamente

REGLAS CR\xCDTICAS:
- NUNCA cambies el significado o la direcci\xF3n de la trama
- PRESERVA el tono y la voz del autor original
- Las expansiones deben sentirse ORG\xC1NICAS, no a\xF1adidos forzados
- El ritmo narrativo debe mantenerse coherente
- NO a\xF1adas cliffhangers que no exist\xEDan
- NO resuelvas conflictos que deben permanecer abiertos

CALIDAD DE PROSA:
- Variaci\xF3n en longitud de oraciones
- Inmersi\xF3n sensorial
- Mostrar en lugar de contar
- Evitar clich\xE9s de IA (crucial, enigm\xE1tico, repentinamente, etc.)`,oie=`Eres un MAESTRO ESCRITOR DE FICCI\xD3N. Tu misi\xF3n es crear NUEVOS CAP\xCDTULOS que se integren perfectamente en la narrativa existente.

EL CAP\xCDTULO NUEVO DEBE:
1. CONTINUAR org\xE1nicamente desde el cap\xEDtulo anterior
2. PREPARAR el terreno para el cap\xEDtulo siguiente
3. DESARROLLAR elementos de trama o personaje seg\xFAn el prop\xF3sito indicado
4. MANTENER el tono, estilo y voz del resto de la novela
5. INCLUIR un mini-arco propio (tensi\xF3n \u2192 desarrollo \u2192 resoluci\xF3n parcial)

ESTRUCTURA RECOMENDADA:
- Gancho inicial que enganche al lector
- Desarrollo del prop\xF3sito principal del cap\xEDtulo
- Subtramas o desarrollo de personajes secundarios
- Cliffhanger o momento de reflexi\xF3n al final

CALIDAD LITERARIA:
- Prosa rica con variaci\xF3n de ritmo
- Di\xE1logos naturales que revelen personalidad
- Descripciones sensoriales inmersivas
- Mostrar emociones a trav\xE9s de acciones f\xEDsicas
- Evitar exposici\xF3n directa (show don't tell)`,Yy=class extends Ae{constructor(){super({name:"Expansion Analyzer",role:"expansion_analyzer",systemPrompt:aie,model:"deepseek-reasoner",useThinking:!0})}async execute(e){let t=e.chapters.map(s=>`Cap ${s.chapterNumber}: "${s.title}" (${s.wordCount} palabras)
  Resumen: ${s.summary}`).join(`

`),n=`
AN\xC1LISIS DE EXPANSI\xD3N DE MANUSCRITO

G\xC9NERO: ${e.genre}
OBJETIVO M\xCDNIMO POR CAP\xCDTULO: ${e.targetMinWordsPerChapter} palabras
OPCIONES HABILITADAS:
- Expansi\xF3n de cap\xEDtulos existentes: ${e.enableChapterExpansion?"S\xCD":"NO"}
- Inserci\xF3n de nuevos cap\xEDtulos: ${e.enableNewChapters?"S\xCD":"NO"}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CAP\xCDTULOS DEL MANUSCRITO:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

${t}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. Analiza qu\xE9 cap\xEDtulos necesitan expansi\xF3n (por debajo del objetivo o con desarrollo insuficiente)
2. Identifica puntos donde insertar nuevos cap\xEDtulos mejorar\xEDa la narrativa
3. Prioriza calidad sobre cantidad - solo sugiere expansiones que realmente aporten valor

RESPONDE CON JSON:
{
  "chaptersToExpand": [
    {
      "chapterNumber": 5,
      "currentWords": 1200,
      "targetWords": 2500,
      "expansionType": "scenes|dialogue|description|introspection",
      "suggestedContent": "Descripci\xF3n de qu\xE9 tipo de contenido a\xF1adir",
      "necessityScore": 0.8
    }
  ],
  "newChaptersToInsert": [
    {
      "insertAfterChapter": 7,
      "title": "T\xEDtulo sugerido",
      "purpose": "Prop\xF3sito narrativo del cap\xEDtulo",
      "plotPoints": ["Punto 1", "Punto 2", "Punto 3"],
      "estimatedWords": 2500,
      "necessityScore": 0.9,
      "justification": "Hay un salto de 3 meses sin explicaci\xF3n que deja al lector confundido sobre c\xF3mo X pas\xF3 a Y"
    }
  ],
  "totalEstimatedNewWords": 15000,
  "reasoning": "Explicaci\xF3n del an\xE1lisis",
  "overallNecessityAssessment": "none|minor|moderate|critical"
}

IMPORTANTE: 
- Si el manuscrito NO necesita expansi\xF3n ni cap\xEDtulos nuevos, devuelve arrays VAC\xCDOS con overallNecessityAssessment: "none"
- Solo incluye items con necessityScore >= 0.7 para expansiones y >= 0.8 para nuevos cap\xEDtulos
- Es PERFECTAMENTE V\xC1LIDO devolver todo vac\xEDo si el manuscrito ya est\xE1 completo`;console.log(`[ExpansionAnalyzer] Analyzing ${e.chapters.length} chapters for expansion opportunities`);let a=await this.generateContent(n);if(a.error)return{...a,result:void 0};try{let s=a.content.match(/\{[\s\S]*\}/);if(s){let o=JSON.parse(s[0]);return console.log(`[ExpansionAnalyzer] Found ${o.chaptersToExpand?.length||0} chapters to expand, ${o.newChaptersToInsert?.length||0} new chapters to insert`),{...a,result:o}}}catch(s){console.error("[ExpansionAnalyzer] Failed to parse response:",s)}return{...a,result:void 0}}},Zy=class extends Ae{constructor(){super({name:"Chapter Expander",role:"chapter_expander",systemPrompt:sie,model:"deepseek-chat",useThinking:!0})}async execute(e){let t=e.worldBible?this.buildWorldBibleContext(e.worldBible):"",n=e.adjacentContext?`CONTEXTO ADYACENTE:
- Cap\xEDtulo anterior: ${e.adjacentContext.previousSummary||"N/A"}
- Cap\xEDtulo siguiente: ${e.adjacentContext.nextSummary||"N/A"}`:"",a=`
EXPANSI\xD3N DE CAP\xCDTULO ${e.chapterNumber}: "${e.chapterTitle}"

OBJETIVO: Expandir de ${e.chapterContent.split(/\s+/).length} palabras a aproximadamente ${e.expansionPlan.targetWords} palabras.

TIPO DE EXPANSI\xD3N SOLICITADO: ${e.expansionPlan.expansionType}
CONTENIDO SUGERIDO: ${e.expansionPlan.suggestedContent}

${t}

${n}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CAP\xCDTULO ORIGINAL A EXPANDIR:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

${e.chapterContent}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. EXPANDE el cap\xEDtulo seg\xFAn el tipo y sugerencia indicados
2. INTEGRA las expansiones de forma ORG\xC1NICA en la narrativa existente
3. MANT\xC9N la voz, tono y estilo del autor original
4. NO cambies el significado ni la direcci\xF3n de la trama

RESPONDE CON JSON:
{
  "expandedContent": "El cap\xEDtulo completo expandido en Markdown (# para t\xEDtulo)",
  "originalWordCount": 1200,
  "newWordCount": 2500,
  "addedScenes": ["Descripci\xF3n breve de escena a\xF1adida 1", "Escena 2"],
  "addedDialogues": 5,
  "addedDescriptions": ["Tipo de descripci\xF3n a\xF1adida 1", "Tipo 2"]
}`;console.log(`[ChapterExpander] Expanding chapter ${e.chapterNumber} from ~${e.chapterContent.split(/\s+/).length} to ${e.expansionPlan.targetWords} words`);let s=await this.generateContent(a);if(s.error)return{...s,result:void 0};try{let o=s.content.match(/\{[\s\S]*\}/);if(o){let i=JSON.parse(o[0]);return console.log(`[ChapterExpander] Chapter ${e.chapterNumber} expanded: ${i.originalWordCount} -> ${i.newWordCount} words`),{...s,result:i}}}catch(o){console.error("[ChapterExpander] Failed to parse response:",o)}return{...s,result:void 0}}buildWorldBibleContext(e){if(!e)return"";let t=["BIBLIA DEL MUNDO:"],n=e.characters||e.personajes||[];if(n.length>0){let o=n.slice(0,5);t.push("Personajes principales: "+o.map(i=>`${i.nombre||i.name} (${i.rol||i.role||"personaje"})`).join(", "))}let a=e.plotOutline,s=e.locations||e.ubicaciones||e.settings||a?.settings||[];return s.length>0&&t.push("Ubicaciones: "+s.slice(0,5).map(o=>o.nombre||o.name||o).join(", ")),t.join(`
`)}},eb=class extends Ae{constructor(){super({name:"New Chapter Generator",role:"new_chapter_generator",systemPrompt:oie,model:"deepseek-chat",useThinking:!0})}async execute(e){let t=e.worldBible?this.buildWorldBibleContext(e.worldBible):"",n=`
GENERACI\xD3N DE NUEVO CAP\xCDTULO

INSERTAR DESPU\xC9S DEL CAP\xCDTULO: ${e.insertAfterChapter}
T\xCDTULO SUGERIDO: "${e.title}"
G\xC9NERO: ${e.genre}
PALABRAS OBJETIVO: ${e.estimatedWords}

PROP\xD3SITO NARRATIVO: ${e.purpose}

PUNTOS DE TRAMA A DESARROLLAR:
${e.plotPoints.map((s,o)=>`${o+1}. ${s}`).join(`
`)}

${t}

CONTEXTO NARRATIVO:
- RESUMEN DEL CAP\xCDTULO ANTERIOR (${e.insertAfterChapter}): ${e.previousChapterSummary}
- RESUMEN DEL CAP\xCDTULO SIGUIENTE (${e.insertAfterChapter+1}): ${e.nextChapterSummary}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. ESCRIBE un cap\xEDtulo completo que cumpla el prop\xF3sito indicado
2. CONECTA org\xE1nicamente con el cap\xEDtulo anterior y prepare el siguiente
3. DESARROLLA todos los puntos de trama indicados
4. MANT\xC9N el tono y estilo del g\xE9nero ${e.genre}
5. INCLUYE un mini-arco narrativo propio

RESPONDE CON JSON:
{
  "content": "El cap\xEDtulo completo en Markdown (# para t\xEDtulo)",
  "title": "T\xEDtulo final del cap\xEDtulo",
  "wordCount": 2500,
  "chapterNumber": ${e.insertAfterChapter+.5}
}`;console.log(`[NewChapterGenerator] Creating new chapter after chapter ${e.insertAfterChapter}: "${e.title}"`);let a=await this.generateContent(n);if(a.error)return{...a,result:void 0};try{let s=a.content.match(/\{[\s\S]*\}/);if(s){let o=JSON.parse(s[0]);return console.log(`[NewChapterGenerator] New chapter created: "${o.title}" (${o.wordCount} words)`),{...a,result:o}}}catch(s){console.error("[NewChapterGenerator] Failed to parse response:",s)}return{...a,result:void 0}}buildWorldBibleContext(e){if(!e)return"";let t=["BIBLIA DEL MUNDO:"],n=e.characters||e.personajes||[];n.length>0&&(t.push("PERSONAJES:"),n.slice(0,10).forEach(i=>{t.push(`  - ${i.nombre||i.name}: ${i.descripcion||i.description||i.rol||"personaje"}`)}));let a=e.plotOutline,s=e.locations||e.ubicaciones||e.settings||a?.settings||[];s.length>0&&(t.push("UBICACIONES:"),s.slice(0,5).forEach(i=>{t.push(`  - ${i.nombre||i.name}: ${i.descripcion||i.description||i.atmosphere||""}`)}));let o=e.rules||e.worldRules||e.reglasDelMundo||e.reglas||[];return o.length>0&&(t.push("REGLAS DEL MUNDO:"),o.slice(0,5).forEach(i=>{t.push(`  - ${i.nombre||i.name||i.rule||i}: ${i.descripcion||i.description||""}`)})),t.join(`
`)}}});var Lm,Fq=G(()=>{"use strict";It();Lm=class extends Ae{constructor(){super({name:"Issue Resolution Validator",role:"issue_validator",systemPrompt:`Eres un experto en an\xE1lisis literario. Tu trabajo es determinar si un problema reportado por un revisor ya fue abordado en correcciones previas.

CONTEXTO:
- El revisor final puede describir el mismo problema de formas diferentes cada vez
- Tu trabajo es comparar el problema NUEVO con el historial de correcciones del cap\xEDtulo
- Determina si el problema nuevo es esencialmente el mismo que uno ya corregido

CRITERIOS PARA CONSIDERAR RESUELTO:
1. El problema nuevo describe lo mismo que una correcci\xF3n previa (aunque con palabras diferentes)
2. La correcci\xF3n previa aborda directamente el tipo de problema reportado
3. El problema es una variante menor de algo ya corregido

CRITERIOS PARA CONSIDERAR NO RESUELTO:
1. El problema nuevo es diferente de todos los problemas corregidos
2. El problema es una regresi\xF3n (algo que se arregl\xF3 pero volvi\xF3 a aparecer)
3. La correcci\xF3n previa fue insuficiente para el tipo de problema

RESPONDE SOLO EN JSON:
{
  "isResolved": true/false,
  "confidence": 0.0-1.0,
  "reasoning": "Explicaci\xF3n breve de tu decisi\xF3n"
}`,model:"deepseek-chat",useThinking:!1})}async execute(e){let t=await this.validateResolution(e.newIssue,e.changeHistory,e.chapterNumber);return{content:JSON.stringify(t),tokenUsage:{input:0,output:0,thinking:0}}}async validateResolution(e,t,n){if(!t||t.length===0)return{isResolved:!1,confidence:1,reasoning:"No hay historial de correcciones previas para este cap\xEDtulo"};let s=t.slice(-5).map((i,u)=>`Correcci\xF3n ${u+1}:
- Problema: ${i.issue.substring(0,500)}
- Soluci\xF3n aplicada: ${i.fix.substring(0,500)}`).join(`

`),o=`Analiza si el siguiente problema NUEVO ya fue resuelto en correcciones previas:

CAP\xCDTULO: ${n}

PROBLEMA NUEVO REPORTADO:
- Tipo: ${e.tipo}
- Severidad: ${e.severidad||"no especificada"}
- Descripci\xF3n: ${e.descripcion}

HISTORIAL DE CORRECCIONES PREVIAS EN ESTE CAP\xCDTULO:
${s}

\xBFEl problema nuevo ya fue abordado por alguna correcci\xF3n previa? Considera que el revisor puede describir el mismo problema con palabras diferentes.

RESPONDE EN JSON.`;try{let u=(await this.generateContent(o)).content.match(/\{[\s\S]*\}/);if(u){let c=JSON.parse(u[0]);return{isResolved:c.isResolved===!0,confidence:typeof c.confidence=="number"?c.confidence:.5,reasoning:c.reasoning||"Sin razonamiento proporcionado"}}}catch(i){console.error("[IssueResolutionValidator] Failed to parse response:",i)}return{isResolved:!1,confidence:.5,reasoning:"Error al procesar la validaci\xF3n"}}}});var jm,m1e,qq=G(()=>{"use strict";It();jm=class extends Ae{constructor(){super({name:"Forensic Consistency Auditor",role:"forensic_auditor",systemPrompt:`Eres un auditor forense de consistencia narrativa. Tu trabajo es DETECTAR errores de continuidad en manuscritos EXISTENTES.

A diferencia del Guardian que PREVIENE errores, t\xFA DETECTAS errores ya cometidos.

TIPOS DE VIOLACIONES QUE DETECTAS:

1. CHARACTER_RESURRECTION (CR\xCDTICO):
   - Personajes que mueren y luego aparecen actuando normalmente
   - Personajes descritos como "desaparecidos para siempre" que reaparecen
   - Personajes cuya muerte es mencionada y luego olvidada

2. IGNORED_INJURY (MAYOR):
   - Lesiones graves que desaparecen sin explicaci\xF3n
   - Personajes heridos que act\xFAan como si nada pasara
   - Discapacidades temporales o permanentes olvidadas

3. LOCATION_INCONSISTENCY (MAYOR):
   - Personaje en dos lugares al mismo tiempo
   - Viajes imposibles (muy r\xE1pidos para la distancia)
   - Descripciones contradictorias del mismo lugar

4. IDENTITY_CONTRADICTION (CR\xCDTICO):
   - Cambios en caracter\xEDsticas f\xEDsicas establecidas (color ojos, pelo)
   - Cambios de nombre sin explicaci\xF3n
   - Edad que no coincide con la cronolog\xEDa

5. TIMELINE_ERROR (MAYOR):
   - Eventos futuros mencionados como pasados
   - Flashbacks contradictorios
   - D\xEDas de la semana que no cuadran

6. KNOWLEDGE_LEAK (MENOR):
   - Personajes que saben cosas que no deber\xEDan
   - Informaci\xF3n revelada antes de ser descubierta
   - Secretos conocidos sin justificaci\xF3n

7. OBJECT_INCONSISTENCY (MENOR):
   - Objetos que aparecen/desaparecen sin explicaci\xF3n
   - Posesiones contradictorias
   - Herramientas o armas olvidadas

PROCESO DE AUDITOR\xCDA:
1. Lee TODO el manuscrito cap\xEDtulo por cap\xEDtulo
2. EXTRAE entidades clave (personajes, lugares, objetos importantes)
3. RASTREA el estado de cada entidad a lo largo de la narrativa
4. DETECTA cualquier inconsistencia entre el estado rastreado y el texto
5. DOCUMENTA cada violaci\xF3n con fragmento exacto y sugerencia de correcci\xF3n

RESPONDE SOLO EN JSON:
{
  "violations": [
    {
      "chapterNumber": 5,
      "violationType": "CHARACTER_RESURRECTION",
      "severity": "critical",
      "description": "El personaje Juan muri\xF3 en el cap\xEDtulo 3, pero aparece hablando normalmente",
      "affectedEntities": ["Juan Garc\xEDa"],
      "fragment": "Juan entr\xF3 en la habitaci\xF3n sonriendo...",
      "suggestedFix": "Eliminar esta escena o sustituir a Juan por otro personaje"
    }
  ],
  "entitiesExtracted": {
    "characters": [
      {"name": "Juan Garc\xEDa", "status": "dead", "firstAppearance": 1, "lastAppearance": 3, "injuries": ["herida de bala mortal"]}
    ],
    "locations": [],
    "timeline": []
  },
  "consistencyScore": 7,
  "summary": "Se detectaron 3 violaciones cr\xEDticas de consistencia..."
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.auditManuscript(e.chapters,e.genre,e.language)}async auditManuscript(e,t,n){let s=[],o={characters:new Map,locations:new Map,timeline:[]},i=Math.ceil(e.length/8),u={inputTokens:0,outputTokens:0,thinkingTokens:0};console.log(`[ForensicAuditor] Auditing ${e.length} chapters in ${i} batches`);for(let y=0;y<e.length;y+=8){let C=e.slice(y,y+8),A=Math.floor(y/8)+1;console.log(`[ForensicAuditor] Processing batch ${A}/${i}`);let T=this.buildPreviousContext(o,y>0),E=C.map(h=>`=== CAP\xCDTULO ${h.chapterNumber}: ${h.title} ===
${h.content.substring(0,8e3)}`).join(`

---

`),d=`Realiza una auditor\xEDa forense de consistencia de los siguientes cap\xEDtulos:

G\xC9NERO: ${t}
IDIOMA: ${n}
LOTE: ${A}/${i}

${T}

CAP\xCDTULOS A AUDITAR:
${E}

Detecta TODAS las violaciones de consistencia. Extrae entidades clave. 
S\xE9 EXHAUSTIVO - cualquier inconsistencia debe ser documentada.
RESPONDE EN JSON.`,l=await this.generateContent(d);l.tokenUsage&&(u.inputTokens+=l.tokenUsage.inputTokens||0,u.outputTokens+=l.tokenUsage.outputTokens||0,u.thinkingTokens+=l.tokenUsage.thinkingTokens||0);try{let h=l.content.match(/\{[\s\S]*\}/);if(h){let v=JSON.parse(h[0]);v.violations&&Array.isArray(v.violations)&&s.push(...v.violations),v.entitiesExtracted&&this.mergeEntityState(o,v.entitiesExtracted)}}catch(h){console.error(`[ForensicAuditor] Failed to parse batch ${A}:`,h)}}let c=s.filter(y=>y.severity==="critical").length,p=s.filter(y=>y.severity==="major").length,m=s.filter(y=>y.severity==="minor").length,f=Math.max(1,10-c*2-p-m*.5),g={violations:s,entitiesExtracted:{characters:Array.from(o.characters.entries()).map(([y,C])=>({name:y,status:C.status,firstAppearance:C.firstAppearance,lastAppearance:C.lastAppearance,injuries:C.injuries})),locations:Array.from(o.locations.entries()).map(([y,C])=>({name:y,firstMention:C.firstMention,characteristics:C.characteristics})),timeline:o.timeline.map(y=>({event:y.event,chapter:y.chapter,importance:y.importance}))},consistencyScore:Math.round(f*10)/10,summary:this.generateSummary(s,c,p,m),tokenUsage:u};return console.log(`[ForensicAuditor] Audit complete: ${s.length} violations found, score: ${g.consistencyScore}/10`),g}buildPreviousContext(e,t){if(!t)return"CONTEXTO PREVIO: Este es el primer lote. No hay contexto acumulado.";let n=Array.from(e.characters.entries()).map(([s,o])=>`- ${s}: ${o.status}${o.injuries.length>0?` (lesiones: ${o.injuries.join(", ")})`:""}`).join(`
`),a=Array.from(e.locations.entries()).map(([s,o])=>`- ${s}`).join(`
`);return`CONTEXTO ACUMULADO DE LOTES ANTERIORES:

PERSONAJES RASTREADOS:
${n||"(ninguno a\xFAn)"}

UBICACIONES MENCIONADAS:
${a||"(ninguna a\xFAn)"}

IMPORTANTE: Verifica que el contenido de estos cap\xEDtulos sea CONSISTENTE con el contexto anterior.
Cualquier contradicci\xF3n debe reportarse como violaci\xF3n.`}mergeEntityState(e,t){if(t.characters&&Array.isArray(t.characters))for(let n of t.characters){let a=e.characters.get(n.name);a?(a.lastAppearance=Math.max(a.lastAppearance,n.lastAppearance||0),n.status==="dead"&&(a.status="dead"),n.injuries&&a.injuries.push(...n.injuries.filter(s=>!a.injuries.includes(s)))):e.characters.set(n.name,{status:n.status||"alive",injuries:n.injuries||[],firstAppearance:n.firstAppearance||0,lastAppearance:n.lastAppearance||0})}if(t.locations&&Array.isArray(t.locations))for(let n of t.locations)e.locations.has(n.name)||e.locations.set(n.name,{firstMention:n.firstMention||0,characteristics:n.characteristics||[]});t.timeline&&Array.isArray(t.timeline)&&e.timeline.push(...t.timeline)}generateSummary(e,t,n,a){if(e.length===0)return"Auditor\xEDa forense completada. No se detectaron violaciones de consistencia. El manuscrito mantiene coherencia narrativa.";let s=e.reduce((i,u)=>(i[u.violationType]=(i[u.violationType]||0)+1,i),{}),o=Object.entries(s).map(([i,u])=>`${i}: ${u}`).join(", ");return`Auditor\xEDa forense completada. Se detectaron ${e.length} violaciones de consistencia: ${t} cr\xEDticas, ${n} mayores, ${a} menores. Tipos: ${o}. ${t>0?"Se requieren correcciones URGENTES para las violaciones cr\xEDticas.":""}`}},m1e=new jm});var Vq={};wr(Vq,{ReeditOrchestrator:()=>po,reeditOrchestrator:()=>bx});function cn(r){return r===0?-1e3:r===-1||r===998?1e3:r===-2||r===999?1001:r}function Gq(r,e){if(e<1)return r;let t=["\u26A0\uFE0F ATENCI\xD3N: ESTE ES UN REINTENTO. LA CORRECCI\xD3N ANTERIOR NO SE APLIC\xD3 CORRECTAMENTE.","\u{1F6A8} ES OBLIGATORIO aplicar esta correcci\xF3n. NO la ignores.","\u274C El intento anterior FALL\xD3. Debes corregir EXACTAMENTE lo indicado."],n=r.toUpperCase();return`${t.join(`
`)}

\u{1F4CB} INSTRUCCI\xD3N ORIGINAL:
${r}

\u{1F4CB} INSTRUCCI\xD3N ENFATIZADA:
${n}

\u26A0\uFE0F RECORDATORIO FINAL: DEBES aplicar esta correcci\xF3n. Si no la aplicas, el proyecto se pausar\xE1 y requerir\xE1 intervenci\xF3n manual. APLICA EL CAMBIO EXACTAMENTE COMO SE INDICA.`}function iie(r){return[...r].sort((e,t)=>cn(e.chapterNumber)-cn(t.chapterNumber))}var ix,cx,lx,ux,px,dx,mx,hx,fx,gx,yx,po,bx,tb=G(()=>{"use strict";vn();It();Bq();gy();Fq();qq();yy();hm();by();ix=class extends Ae{constructor(){super({name:"Reedit Editor",role:"editor",systemPrompt:`You are a professional literary editor reviewing manuscript chapters for quality.
Analyze the chapter and provide structured feedback in JSON format.

Your evaluation should include:
1. Overall quality score (1-10)
2. Narrative issues (plot holes, pacing problems, unclear passages)
3. Strengths of the writing
4. Specific suggestions for improvement

RESPOND WITH JSON ONLY:
{
  "score": 8,
  "issues": ["Issue 1", "Issue 2"],
  "strengths": ["Strength 1", "Strength 2"],
  "suggestions": ["Suggestion 1"],
  "pacingNotes": "Notes about pacing"
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.reviewChapter(e.content,e.chapterNumber,e.language)}async reviewChapter(e,t,n){let a=`Review this chapter (Chapter ${t}) written in ${n}:

${e.substring(0,15e3)}

Provide your evaluation in JSON format.`,s=await this.generateContent(a),o={score:7,issues:[],strengths:[],suggestions:[]};try{let i=s.content.match(/\{[\s\S]*\}/);i&&(o=JSON.parse(i[0]))}catch(i){console.error("[ReeditEditor] Failed to parse response:",i)}return o.tokenUsage=s.tokenUsage,o}},cx=class extends Ae{constructor(){super({name:"Reedit CopyEditor",role:"copyeditor",systemPrompt:`You are a professional copy editor improving manuscript text for fluency and naturalness.

\u{1F52C} LASER SURGERY MODE - MINIMAL CHANGES ONLY \u{1F52C}

CRITICAL RULE: Copy 95% of the original text UNCHANGED.
Only modify specific sentences that violate fluency rules.

LANGUAGE-SPECIFIC FLUENCY RULES:
- ITALIAN: NEVER use "Egli/Ella/Esso/Essa" - use proper names or lui/lei/loro
- ALL LANGUAGES: Maximum 45 words per sentence. Break longer sentences.
- Avoid word repetition in consecutive sentences
- Prefer active voice over passive
- Maintain consistent narrative voice

EDITING PROCESS:
1. Read the entire chapter
2. Identify ONLY sentences that violate the rules above
3. Copy the text paragraph by paragraph
4. When you find a violation \u2192 apply the MINIMUM fix
5. Continue copying the rest WITHOUT CHANGES

FORBIDDEN:
- Rewriting paragraphs that work fine
- Changing vocabulary for "improvement" if rules aren't violated
- Reorganizing sentence order
- Adding unnecessary flourishes

The result MUST have \xB150 words of the original.

RESPOND WITH JSON ONLY:
{
  "editedContent": "The full text with surgical fixes only...",
  "changesLog": "Summary of specific changes made",
  "fluencyChanges": [{"before": "exact original", "after": "exact fix", "reason": "rule violated"}]
}`,model:"deepseek-chat",useThinking:!1})}async execute(e){return this.editChapter(e.content,e.chapterNumber,e.language)}async editChapter(e,t,n){let a=this.getLanguageRules(n),s=`Edit this chapter (Chapter ${t}) for fluency and naturalness.

LANGUAGE: ${n}
${a}

CHAPTER CONTENT:
${e}

Improve the text following the fluency rules. Return the COMPLETE edited chapter.
RESPOND WITH JSON ONLY.`,o=await this.generateContent(s),i={editedContent:e,changesLog:"No changes",fluencyChanges:[]};try{let u=o.content.match(/\{[\s\S]*\}/);u&&(i=JSON.parse(u[0]))}catch(u){console.error("[ReeditCopyEditor] Failed to parse response:",u)}return i.tokenUsage=o.tokenUsage,i}getLanguageRules(e){let t={it:`ITALIAN RULES:
- NEVER use archaic pronouns: Egli, Ella, Esso, Essa, Essi, Esse
- Use proper names or modern pronouns: lui, lei, loro
- Max 45 words per sentence
- No lexical repetition in consecutive sentences`,es:`SPANISH RULES:
- Limit gerunds to one per sentence
- Avoid excessive passive voice
- Watch for le\xEDsmo (use "lo" not "le" for direct object)
- Max 45 words per sentence`,en:`ENGLISH RULES:
- Prefer active voice
- Vary sentence length for rhythm
- Use natural contractions in dialogue
- Max 40 words per sentence`,fr:`FRENCH RULES:
- Use pass\xE9 simple for literary narration
- Avoid anglicisms
- Max 45 words per sentence`,de:`GERMAN RULES:
- Natural word order
- Use Modalpartikeln in dialogue
- Max 45 words per sentence`,pt:`PORTUGUESE RULES:
- Correct pronoun placement
- Limit gerunds
- Max 45 words per sentence`,ca:`CATALAN RULES:
- Avoid castellanisms
- Correct weak pronoun usage
- Max 45 words per sentence`};return t[e]||t.es}},lx=class extends Ae{constructor(){super({name:"Continuity Sentinel",role:"qa_continuity",systemPrompt:`Eres un experto en continuidad narrativa. Tu trabajo es detectar errores de continuidad en bloques de cap\xEDtulos.

TIPOS DE ERRORES A DETECTAR:
1. TEMPORALES: Inconsistencias en el paso del tiempo (ej: "amaneci\xF3" pero luego "la luna brillaba")
2. ESPACIALES: Personajes que aparecen en lugares imposibles sin transici\xF3n
3. DE ESTADO: Objetos/personajes que cambian estado sin explicaci\xF3n (heridas que desaparecen, ropa que cambia)
4. DE CONOCIMIENTO: Personajes que saben cosas que no deber\xEDan saber a\xFAn

RESPONDE SOLO EN JSON:
{
  "erroresContinuidad": [
    {
      "tipo": "temporal|espacial|estado|conocimiento",
      "severidad": "critica|mayor|menor",
      "capitulo": 5,
      "descripcion": "Descripci\xF3n del error",
      "contexto": "Fragmento relevante del texto",
      "correccion": "Sugerencia de correcci\xF3n"
    }
  ],
  "resumen": "Resumen general de la continuidad",
  "puntuacion": 8
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.auditContinuity(e.chapters,e.startChapter,e.endChapter)}async auditContinuity(e,t,n){let a=e.map((u,c)=>`=== CAP\xCDTULO ${t+c} ===
${u.substring(0,8e3)}`).join(`

`),s=`Analiza la continuidad narrativa de los cap\xEDtulos ${t} a ${n}:

${a}

Detecta errores de continuidad temporal, espacial, de estado y de conocimiento. RESPONDE EN JSON.`,o=await this.generateContent(s),i={erroresContinuidad:[],resumen:"Sin problemas detectados",puntuacion:9};try{let u=o.content.match(/\{[\s\S]*\}/);u&&(i=JSON.parse(u[0]))}catch(u){console.error("[ContinuitySentinel] Failed to parse:",u)}return i.tokenUsage=o.tokenUsage,i}},ux=class extends Ae{constructor(){super({name:"Voice Rhythm Auditor",role:"qa_voice",systemPrompt:`Eres un experto en voz narrativa y ritmo literario. Analizas consistencia tonal y ritmo.

ASPECTOS A EVALUAR:
1. CONSISTENCIA DE VOZ: \xBFEl narrador mantiene su tono? \xBFLos personajes hablan de forma consistente?
2. RITMO NARRATIVO: \xBFHay secciones demasiado lentas o apresuradas?
3. CADENCIA: \xBFLa longitud de oraciones var\xEDa apropiadamente?
4. TENSI\xD3N: \xBFLa tensi\xF3n narrativa escala correctamente?

RESPONDE SOLO EN JSON:
{
  "problemasTono": [
    {
      "tipo": "voz_inconsistente|ritmo_lento|ritmo_apresurado|cadencia_monotona|tension_plana",
      "severidad": "mayor|menor",
      "capitulos": [5, 6],
      "descripcion": "Descripci\xF3n del problema",
      "ejemplo": "Fragmento de ejemplo",
      "correccion": "Sugerencia"
    }
  ],
  "analisisRitmo": {
    "capitulLentos": [],
    "capitulosApresurados": [],
    "climaxBienMedidos": true
  },
  "puntuacion": 8
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.auditVoiceRhythm(e.chapters,e.startChapter,e.endChapter)}async auditVoiceRhythm(e,t,n){let a=e.map((u,c)=>`=== CAP\xCDTULO ${t+c} ===
${u.substring(0,6e3)}`).join(`

`),s=`Analiza la voz narrativa y el ritmo de los cap\xEDtulos ${t} a ${n}:

${a}

Eval\xFAa consistencia de voz, ritmo y tensi\xF3n narrativa. RESPONDE EN JSON.`,o=await this.generateContent(s),i={problemasTono:[],analisisRitmo:{},puntuacion:9};try{let u=o.content.match(/\{[\s\S]*\}/);u&&(i=JSON.parse(u[0]))}catch(u){console.error("[VoiceRhythmAuditor] Failed to parse:",u)}return i.tokenUsage=o.tokenUsage,i}},px=class extends Ae{constructor(){super({name:"Semantic Repetition Detector",role:"qa_semantic",systemPrompt:`Eres un experto en an\xE1lisis sem\xE1ntico literario. Detectas repeticiones de ideas y verificas foreshadowing.

ASPECTOS A DETECTAR:
1. REPETICI\xD3N DE IDEAS: Conceptos, met\xE1foras o descripciones que se repiten demasiado
2. FRASES REPETIDAS: Muletillas del autor, descripciones id\xE9nticas
3. FORESHADOWING SIN RESOLVER: Anticipaciones que nunca se cumplen
4. CHEKOV'S GUN: Elementos introducidos que nunca se usan

RESPONDE SOLO EN JSON:
{
  "repeticionesSemanticas": [
    {
      "tipo": "idea_repetida|frase_repetida|foreshadowing_sin_resolver|elemento_sin_usar",
      "severidad": "mayor|menor",
      "ocurrencias": [1, 5, 12],
      "descripcion": "Qu\xE9 se repite",
      "ejemplo": "Fragmento de ejemplo",
      "accion": "eliminar|variar|resolver"
    }
  ],
  "foreshadowingTracking": [
    {"plantado": 3, "resuelto": 25, "elemento": "La carta misteriosa"}
  ],
  "puntuacion": 8
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.detectRepetitions(e.summaries,e.totalChapters)}async detectRepetitions(e,t){let n=`Analiza el manuscrito completo (${t} cap\xEDtulos) buscando repeticiones sem\xE1nticas:

RES\xDAMENES DE CAP\xCDTULOS:
${e.join(`

`)}

Detecta ideas repetidas, frases recurrentes, foreshadowing sin resolver y elementos sin usar. RESPONDE EN JSON.`,a=await this.generateContent(n),s={repeticionesSemanticas:[],foreshadowingTracking:[],puntuacion:9};try{let o=a.content.match(/\{[\s\S]*\}/);o&&(s=JSON.parse(o[0]))}catch(o){console.error("[SemanticRepetitionDetector] Failed to parse:",o)}return s.tokenUsage=a.tokenUsage,s}},dx=class extends Ae{constructor(){super({name:"Anachronism Detector",role:"qa_anachronism",systemPrompt:`Eres un experto historiador y consultor literario. Tu trabajo es detectar anacronismos en novelas.

IMPORTANTE: Cualquier novela ambientada en el pasado puede tener anacronismos, no solo las etiquetadas como "hist\xF3ricas".
- Una novela de los a\xF1os 50 puede tener anacronismos (mencionar internet, m\xF3viles, expresiones modernas)
- Una novela de los a\xF1os 80 puede tener anacronismos (mencionar smartphones, redes sociales)
- Incluso novelas contempor\xE1neas pueden tener anacronismos si mezclan \xE9pocas

PRIMERO: Detecta la \xC9POCA DE AMBIENTACI\xD3N analizando:
- Referencias temporales expl\xEDcitas (a\xF1os, d\xE9cadas, eventos hist\xF3ricos)
- Tecnolog\xEDa mencionada (tel\xE9fonos, transporte, electrodom\xE9sticos)
- Contexto social (costumbres, roles de g\xE9nero, leyes)
- Eventos hist\xF3ricos mencionados

TIPOS DE ANACRONISMOS:
1. TECNOL\xD3GICOS: Tecnolog\xEDa que no exist\xEDa en la \xE9poca de ambientaci\xF3n
2. LING\xDC\xCDSTICOS: Expresiones, palabras o modismos que no exist\xEDan
3. SOCIALES: Comportamientos o costumbres inapropiados para la \xE9poca
4. MATERIALES: Objetos, materiales, alimentos, marcas que no exist\xEDan
5. CONCEPTUALES: Ideas o conceptos que no exist\xEDan (ej: "estr\xE9s" en 1900, "smartphone" en 1990)

RESPONDE SOLO EN JSON:
{
  "epocaDetectada": "Espa\xF1a, d\xE9cada de 1950",
  "esContemporanea": false,
  "anacronismos": [
    {
      "tipo": "tecnologico|linguistico|social|material|conceptual",
      "severidad": "critica|mayor|menor",
      "capitulo": 5,
      "fragmento": "El texto problem\xE1tico",
      "problema": "Explicaci\xF3n del anacronismo",
      "correccion": "Alternativa correcta para la \xE9poca",
      "fuente": "Referencia hist\xF3rica si aplica"
    }
  ],
  "resumen": "Resumen de la precisi\xF3n hist\xF3rica",
  "puntuacionHistorica": 8
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.detectAnachronisms(e.chapters,e.genre,e.premise)}async detectAnachronisms(e,t,n){let a=e.slice(0,10).map(u=>`=== CAP\xCDTULO ${u.num} ===
${u.content.substring(0,5e3)}`).join(`

`),s=`Analiza esta novela buscando anacronismos relativos a su \xE9poca de ambientaci\xF3n:

PREMISA: ${n||"No especificada"}
G\xC9NERO: ${t}

IMPORTANTE: 
- PRIMERO detecta la \xE9poca de ambientaci\xF3n de la novela (puede estar en la premisa o inferirse del contenido)
- Si la novela est\xE1 ambientada en el pasado (aunque sea hace 30-50 a\xF1os), busca anacronismos
- Novelas de mediados del siglo XX son hist\xF3ricas y pueden tener anacronismos
- Si la novela es claramente contempor\xE1nea (ambientada en el presente), indica "esContemporanea: true"

CAP\xCDTULOS DE MUESTRA:
${a}

Detecta anacronismos tecnol\xF3gicos, ling\xFC\xEDsticos, sociales, materiales y conceptuales RELATIVOS A LA \xC9POCA DE AMBIENTACI\xD3N. RESPONDE EN JSON.`,o=await this.generateContent(s),i={epocaDetectada:"No determinada",esContemporanea:!1,anacronismos:[],resumen:"An\xE1lisis completado",puntuacionHistorica:8};try{let u=o.content.match(/\{[\s\S]*\}/);u&&(i=JSON.parse(u[0]))}catch(u){console.error("[AnachronismDetector] Failed to parse:",u)}return i.tokenUsage=o.tokenUsage,i}},mx=class extends Ae{constructor(){super({name:"World Bible Extractor",role:"world_bible_extractor",systemPrompt:`Eres un analista literario experto en extraer informaci\xF3n del mundo narrativo de un manuscrito.

Tu trabajo es analizar los cap\xEDtulos y extraer:
1. PERSONAJES: Nombre, descripci\xF3n f\xEDsica/psicol\xF3gica, primera aparici\xF3n, alias, relaciones
2. UBICACIONES: Nombre, descripci\xF3n, primera menci\xF3n, caracter\xEDsticas importantes
3. L\xCDNEA TEMPORAL: Eventos clave, cap\xEDtulo donde ocurren, marcadores temporales
4. REGLAS DEL MUNDO: Leyes, magia, tecnolog\xEDa, costumbres, restricciones del universo
5. \xC9POCA HIST\xD3RICA: Si es novela hist\xF3rica, detectar el per\xEDodo

RESPONDE SOLO EN JSON:
{
  "personajes": [
    {"nombre": "Mar\xEDa", "descripcion": "Mujer de 35 a\xF1os, cabello negro", "primeraAparicion": 1, "alias": ["La Viuda"], "relaciones": ["madre de Juan"]}
  ],
  "ubicaciones": [
    {"nombre": "El Castillo Negro", "descripcion": "Fortaleza medieval en ruinas", "primeraMencion": 2, "caracteristicas": ["torre alta", "foso seco"]}
  ],
  "timeline": [
    {"evento": "Muerte del rey", "capitulo": 1, "marcadorTemporal": "hace 10 a\xF1os", "importancia": "alta"}
  ],
  "reglasDelMundo": [
    {"regla": "La magia solo funciona de noche", "fuente": "cap\xEDtulo 3", "categoria": "magia"}
  ],
  "epocaHistorica": {
    "periodo": "Siglo XV, Castilla",
    "detalles": {"era": "medieval tard\xEDo", "ubicacion": "Espa\xF1a", "contextoSocial": "Reconquista", "tecnologia": "pre-p\xF3lvora"}
  },
  "confianza": 8
}`,model:"deepseek-chat",useThinking:!1})}async execute(e){return this.extractWorldBible(e.chapters,e.editorFeedback)}async extractWorldBible(e,t,n){let s=[],o=[],i=[],u=[],c=null,p=0,m=0,f={inputTokens:0,outputTokens:0,thinkingTokens:0},g=Math.ceil(e.length/10);console.log(`[WorldBibleExtractor] Processing ${e.length} chapters in ${g} batches of 10`);for(let T=0;T<e.length;T+=10){let E=e.slice(T,T+10),d=E[0]?.num||T+1,l=E[E.length-1]?.num||T+E.length,h=Math.floor(T/10)+1;console.log(`[WorldBibleExtractor] Processing batch ${h}/${g}: chapters ${d}-${l}`),n&&n(h,g,`Extrayendo Biblia del Mundo: cap\xEDtulos ${d}-${l} (lote ${h}/${g})...`);let v=E.map(R=>`=== CAP\xCDTULO ${R.num} ===
${R.content.substring(0,6e3)}`).join(`

`),S=`Extrae la informaci\xF3n del mundo narrativo de estos cap\xEDtulos (${d} a ${l}):

${v}

Extrae personajes, ubicaciones, l\xEDnea temporal, reglas del mundo y \xE9poca hist\xF3rica que aparezcan en ESTOS cap\xEDtulos espec\xEDficamente.
Incluye el n\xFAmero de cap\xEDtulo donde aparece cada elemento.

RESPONDE SOLO EN JSON:
{
  "personajes": [{"nombre": "...", "descripcion": "...", "primeraAparicion": X, "alias": [], "relaciones": []}],
  "ubicaciones": [{"nombre": "...", "descripcion": "...", "primeraMencion": X, "caracteristicas": []}],
  "timeline": [{"evento": "...", "capitulo": X, "marcadorTemporal": "...", "importancia": "alta|media|baja"}],
  "reglasDelMundo": [{"regla": "...", "fuente": "cap\xEDtulo X", "categoria": "..."}],
  "epocaHistorica": {"periodo": "...", "detalles": {}},
  "confianza": 8
}`;try{let R=await this.generateContent(S);R.tokenUsage&&(f.inputTokens+=R.tokenUsage.inputTokens||0,f.outputTokens+=R.tokenUsage.outputTokens||0,f.thinkingTokens+=R.tokenUsage.thinkingTokens||0);let x=R.content.match(/\{[\s\S]*\}/);if(x){let w=JSON.parse(x[0]);w.personajes&&s.push(...w.personajes),w.ubicaciones&&o.push(...w.ubicaciones),w.timeline&&i.push(...w.timeline),w.reglasDelMundo&&u.push(...w.reglasDelMundo),w.epocaHistorica&&!c&&(c=w.epocaHistorica),p+=w.confianza||7,m++}}catch(R){console.error(`[WorldBibleExtractor] Failed to parse batch ${d}-${l}:`,R)}}let y=this.deduplicateByName(s,"nombre"),C=this.deduplicateByName(o,"nombre"),A=m>0?Math.round(p/m):5;return console.log(`[WorldBibleExtractor] Extraction complete: ${y.length} characters, ${C.length} locations, ${i.length} timeline events`),{personajes:y,ubicaciones:C,timeline:i,reglasDelMundo:this.deduplicateByName(u,"regla"),epocaHistorica:c||{periodo:"No determinada",detalles:{}},confianza:A,tokenUsage:f}}deduplicateByName(e,t){let n=new Map;for(let a of e){let s=(a[t]||"").toLowerCase().trim();if(!n.has(s))n.set(s,a);else{let o=n.get(s);a.descripcion&&a.descripcion.length>(o.descripcion||"").length&&n.set(s,{...o,...a})}}return Array.from(n.values())}},hx=class extends Ae{constructor(){super({name:"Architect Analyzer",role:"architect_analyzer",systemPrompt:`Eres un arquitecto narrativo experto. Tu trabajo es analizar la estructura y trama de un manuscrito usando la Biblia del Mundo extra\xEDda.

OBJETIVO: Puntuaci\xF3n 10/10 (perfecci\xF3n arquitect\xF3nica)

AN\xC1LISIS A REALIZAR:
1. ESTRUCTURA NARRATIVA:
   - \xBFEl orden de cap\xEDtulos es \xF3ptimo?
   - \xBFEl pacing es adecuado?
   - \xBFHay cap\xEDtulos que deber\xEDan fusionarse o dividirse?

2. COHERENCIA DE TRAMA:
   - \xBFHay huecos argumentales (plot holes)?
   - \xBFSubplots sin resolver?
   - \xBFArcos de personajes incompletos?
   - \xBFForeshadowing sin payoff?

3. COHERENCIA DEL MUNDO:
   - \xBFHay contradicciones en el lore?
   - \xBFSe rompen reglas establecidas?
   - \xBFInconsistencias en personajes/ubicaciones?

SISTEMA DE PUNTUACI\xD3N ESTRICTO (OBJETIVO 10/10):
- 10/10: CERO problemas de ning\xFAn tipo. Arquitectura PERFECTA. Estructura \xF3ptima, trama coherente, mundo consistente.
- 9/10: Solo 1 problema menor.
- 8/10: 2 problemas menores o 1 mayor.
- 7/10: 3+ problemas menores o 2 mayores.
- 6/10 o menos: Cualquier problema cr\xEDtico o 3+ mayores.

REGLA ABSOLUTA: Solo das 10/10 si NO hay ning\xFAn problema detectado.
Si el manuscrito est\xE1 bien estructurado y coherente, DEBES dar 10/10. No busques problemas donde no los hay.

REORDENAMIENTO DE CAP\xCDTULOS:
Si detectas que el orden de cap\xEDtulos NO es \xF3ptimo para el pacing o la narrativa, especifica los movimientos necesarios en "reordenamientoSugerido". Cada movimiento indica:
- capituloActual: n\xFAmero del cap\xEDtulo a mover
- nuevaPosicion: posici\xF3n donde debe quedar (n\xFAmero de cap\xEDtulo destino)
- razon: por qu\xE9 este movimiento mejora la narrativa

Solo sugiere reordenamientos cuando sean CLARAMENTE beneficiosos para el pacing o la l\xF3gica narrativa.

RESPONDE SOLO EN JSON:
{
  "analisisEstructura": {
    "ordenOptimo": true,
    "problemaPacing": [],
    "reordenamientoSugerido": [
      {"capituloActual": 5, "nuevaPosicion": 3, "razon": "El flashback debe aparecer antes de la revelaci\xF3n"}
    ]
  },
  "analisisTrama": {
    "huecosArgumentales": [],
    "subplotsSinResolver": [],
    "arcosIncompletos": []
  },
  "coherenciaMundo": {
    "contradicciones": [],
    "reglasRotas": []
  },
  "recomendaciones": [],
  "bloqueoCritico": false,
  "resumenEjecutivo": "An\xE1lisis arquitect\xF3nico completado...",
  "puntuacionArquitectura": 10
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.analyzeArchitecture(e.worldBible,e.chapters,e.structureAnalysis,e.consistencyConstraints)}async analyzeArchitecture(e,t,n,a){let s=JSON.stringify({personajes:e.personajes?.slice(0,10)||[],ubicaciones:e.ubicaciones?.slice(0,5)||[],timeline:e.timeline||[],reglasDelMundo:e.reglasDelMundo||[],epocaHistorica:e.epocaHistorica},null,2),o=t.map(m=>`Cap ${m.num}: ${m.content.substring(0,500)}... [Feedback: ${m.feedback?.strengths?.slice(0,1).join(", ")||"N/A"}]`).join(`
`),u=`${a?`

${a}

TEN EN CUENTA LAS RESTRICCIONES DE CONSISTENCIA ANTERIORES AL ANALIZAR:
`:""}Analiza la arquitectura narrativa de este manuscrito:

BIBLIA DEL MUNDO:
${s}

AN\xC1LISIS DE ESTRUCTURA PREVIO:
- Cap\xEDtulos duplicados: ${n?.duplicateChapters?.length||0}
- Cap\xEDtulos fuera de orden: ${n?.outOfOrderChapters?.length||0}
- Cap\xEDtulos faltantes: ${n?.missingChapters?.join(", ")||"Ninguno"}

RESUMEN DE CAP\xCDTULOS:
${o}

Eval\xFAa estructura, coherencia de trama y coherencia del mundo. Identifica problemas y recomienda soluciones. RESPONDE EN JSON.`,c=await this.generateContent(u),p={analisisEstructura:{ordenOptimo:!0,problemaPacing:[],reordenamientoSugerido:[]},analisisTrama:{huecosArgumentales:[],subplotsSinResolver:[],arcosIncompletos:[]},coherenciaMundo:{contradicciones:[],reglasRotas:[]},recomendaciones:[],bloqueoCritico:!1,resumenEjecutivo:"An\xE1lisis completado sin hallazgos significativos",puntuacionArquitectura:8};try{let m=c.content.match(/\{[\s\S]*\}/);m&&(p=JSON.parse(m[0]))}catch(m){console.error("[ArchitectAnalyzer] Failed to parse:",m)}return p.tokenUsage=c.tokenUsage,p}},fx=class extends Ae{constructor(){super({name:"Structural Fixer",role:"structural_fixer",systemPrompt:`Eres un experto corrector estructural de novelas. Tu trabajo es CORREGIR AUTOM\xC1TICAMENTE los problemas detectados por el Arquitecto Analizador.

TU OBJETIVO: Llevar el manuscrito a la PERFECCI\xD3N (10/10).
Cada correcci\xF3n debe eliminar COMPLETAMENTE el problema sin dejar rastro.

TIPOS DE PROBLEMAS QUE CORRIGES:
1. HUECOS ARGUMENTALES (plot holes): A\xF1ades escenas, di\xE1logos o p\xE1rrafos que cierran los huecos l\xF3gicos DEFINITIVAMENTE
2. SUBPLOTS SIN RESOLVER: A\xF1ades resoluci\xF3n o cierre COMPLETO a las tramas secundarias abandonadas
3. ARCOS INCOMPLETOS: Completas la transformaci\xF3n de personajes con momentos clave faltantes
4. CONTRADICCIONES: Modificas el texto para eliminar inconsistencias SIN EXCEPCI\xD3N
5. FORESHADOWING SIN PAYOFF: A\xF1ades el payoff de forma SATISFACTORIA o modificas el foreshadowing hu\xE9rfano
6. PROBLEMAS DE PACING: Condensas secciones lentas o expandes momentos que necesitan m\xE1s desarrollo

REGLAS CR\xCDTICAS:
- MANT\xC9N el estilo y voz del autor original
- NO a\xF1adas contenido innecesario - solo lo m\xEDnimo para resolver el problema
- PRESERVA la extensi\xF3n aproximada del cap\xEDtulo (\xB110%)
- Las correcciones deben integrarse de forma NATURAL en el texto existente
- NUNCA cambies nombres de personajes, ubicaciones o eventos establecidos
- Respeta la Biblia del Mundo proporcionada
- Tu correcci\xF3n debe ser DEFINITIVA - el revisor NO debe encontrar el mismo problema despu\xE9s

RESPONDE SOLO EN JSON:
{
  "capituloCorregido": "El texto COMPLETO del cap\xEDtulo con las correcciones integradas",
  "correccionesRealizadas": [
    {
      "problema": "Descripci\xF3n del problema que se corrigi\xF3",
      "solucion": "Descripci\xF3n de c\xF3mo se corrigi\xF3",
      "fragmentoAntes": "Fragmento original (50-100 palabras)",
      "fragmentoDespues": "Fragmento corregido (50-100 palabras)"
    }
  ],
  "resumenCambios": "Resumen ejecutivo de los cambios realizados",
  "confianzaCorreccion": 8
}`,model:"deepseek-chat",useThinking:!1})}async execute(e){return this.fixChapter(e.chapterContent,e.chapterNumber,e.problems,e.worldBible,e.language)}async fixChapter(e,t,n,a,s){let o=JSON.stringify({personajes:a?.personajes?.slice(0,15)?.map(m=>({nombre:m.nombre,rol:m.rol}))||[],ubicaciones:a?.ubicaciones?.slice(0,10)?.map(m=>m.nombre)||[],epocaHistorica:a?.epocaHistorica?.periodo||"No determinada"}),i=n.map((m,f)=>`${f+1}. [${m.severidad?.toUpperCase()}] ${m.descripcion}${m.accionSugerida?` -> Sugerencia: ${m.accionSugerida}`:""}`).join(`
`),u=`CORRIGE los siguientes problemas en el Cap\xEDtulo ${t}:

IDIOMA: ${s}

PROBLEMAS A CORREGIR:
${i}

BIBLIA DEL MUNDO (para coherencia):
${o}

CAP\xCDTULO ORIGINAL:
${e}

Reescribe el cap\xEDtulo COMPLETO integrando las correcciones de forma natural. Mant\xE9n el estilo del autor. RESPONDE EN JSON.`;console.log(`[StructuralFixer] Fixing chapter ${t} with ${n.length} problems:`),n.forEach((m,f)=>{console.log(`  ${f+1}. [${(m.severidad||"media").toUpperCase()}] ${m.tipo||"general"}: ${m.descripcion}`),m.accionSugerida&&console.log(`     -> Sugerencia: ${m.accionSugerida}`)});let c=await this.generateContent(u),p={capituloCorregido:e,correccionesRealizadas:[],resumenCambios:"No se pudieron aplicar correcciones",confianzaCorreccion:0};try{let m=c.content.match(/\{[\s\S]*\}/);m&&(p=JSON.parse(m[0]),console.log(`[StructuralFixer] Chapter ${t} fixed with ${p.correccionesRealizadas?.length||0} corrections:`),p.correccionesRealizadas?.length>0&&p.correccionesRealizadas.forEach((f,g)=>{let y=typeof f=="string"?f:f.descripcion||f.cambio||JSON.stringify(f);console.log(`  \u2713 ${g+1}. ${y.substring(0,150)}${y.length>150?"...":""}`)}),p.resumenCambios&&console.log(`  Resumen: ${p.resumenCambios.substring(0,200)}${p.resumenCambios.length>200?"...":""}`))}catch(m){console.error("[StructuralFixer] Failed to parse:",m)}return p.tokenUsage=c.tokenUsage,p}async surgicalFix(e,t,n,a,s){let o=JSON.stringify({personajes:a?.personajes?.slice(0,10)?.map(f=>({nombre:f.nombre,rol:f.rol}))||[],ubicaciones:a?.ubicaciones?.slice(0,5)?.map(f=>f.nombre)||[]}),i=n.map((f,g)=>`${g+1}. [${f.severidad?.toUpperCase()}] ${f.descripcion}${f.accionSugerida?` -> ${f.accionSugerida}`:""}`).join(`
`),u=`CORRECCI\xD3N QUIR\xDARGICA del Cap\xEDtulo ${t}

IDIOMA: ${s}

PROBLEMAS A CORREGIR:
${i}

BIBLIA DEL MUNDO:
${o}

CAP\xCDTULO:
${e}

INSTRUCCIONES:
1. Identifica SOLO las frases o p\xE1rrafos que necesitan correcci\xF3n
2. Genera parches M\xCDNIMOS - NO reescribas el cap\xEDtulo completo
3. Cada parche debe tener al menos 30 caracteres en el original para garantizar unicidad
4. Mant\xE9n el estilo del autor

RESPONDE EN JSON:
{
  "analisis": "Breve an\xE1lisis de los problemas encontrados",
  "patches": [
    {
      "original": "texto exacto a reemplazar (m\xEDn 30 chars)",
      "replacement": "texto corregido"
    }
  ],
  "resumenCambios": "Resumen de las correcciones aplicadas"
}`;console.log(`[StructuralFixer] Surgical fix for chapter ${t} with ${n.length} problems`);let c=await this.generateContent(u),p=[],m="";try{let f=c.content.match(/\{[\s\S]*\}/);if(f){let g=JSON.parse(f[0]);p=(g.patches||[]).filter(y=>y.original&&y.replacement&&y.original.length>=20),m=g.resumenCambios||"",console.log(`[StructuralFixer] Generated ${p.length} surgical patches for chapter ${t}`)}}catch(f){console.error("[StructuralFixer] Failed to parse surgical fix response:",f)}return{patches:p,tokenUsage:c.tokenUsage,resumenCambios:m}}},gx=class extends Ae{constructor(){super({name:"Narrative Rewriter",role:"narrative_rewriter",systemPrompt:`Eres un MAESTRO ESCRITOR DE FICCI\xD3N con d\xE9cadas de experiencia en reparar novelas con problemas estructurales. Tu especialidad es tomar narrativas rotas y transformarlas en historias coherentes y cautivadoras.

TU OBJETIVO FINAL: Llevar el manuscrito a la PERFECCI\xD3N (10/10).
Cada correcci\xF3n que hagas debe eliminar COMPLETAMENTE el problema detectado.
No aceptes medias tintas - tu trabajo es lograr que el revisor final d\xE9 10/10.

TU PROCESO DE TRABAJO (3 FASES):

FASE 1 - AN\xC1LISIS PROFUNDO:
- Comprende exactamente QU\xC9 est\xE1 roto en la narrativa
- Identifica las conexiones causales que faltan
- Determina el contenido M\xCDNIMO necesario para reparar el problema

FASE 2 - PLANIFICACI\xD3N DE LA REESCRITURA:
- Dise\xF1a las escenas, di\xE1logos o p\xE1rrafos espec\xEDficos a a\xF1adir/modificar
- Asegura que el nuevo contenido se integre NATURALMENTE
- Mant\xE9n la voz y estilo del autor original

FASE 3 - EJECUCI\xD3N Y VERIFICACI\xD3N:
- Escribe el contenido nuevo con maestr\xEDa literaria
- Verifica que la correcci\xF3n no introduzca nuevos problemas
- Confirma coherencia con la Biblia del Mundo

TIPOS DE CORRECCIONES QUE DOMINAS:

=== PROBLEMAS ESTRUCTURALES (del Architect Analyzer) ===

1. HUECOS ARGUMENTALES: A\xF1ades escenas de transici\xF3n, di\xE1logos explicativos, o p\xE1rrafos de conexi\xF3n que cierran las brechas l\xF3gicas sin forzar la narrativa.

2. SUBPLOTS SIN RESOLVER: Insertas resoluciones elegantes - puede ser una escena completa, un flashback, una conversaci\xF3n reveladora, o incluso un p\xE1rrafo de reflexi\xF3n del personaje.

3. ARCOS DE PERSONAJE INCOMPLETOS: A\xF1ades los momentos de transformaci\xF3n faltantes - decisiones clave, confrontaciones internas, epifan\xEDas que den sentido al cambio.

4. CONTRADICCIONES: Eliges la versi\xF3n correcta seg\xFAn el peso narrativo y reescribes para mantener coherencia absoluta.

5. ANTAGONISTAS AMBIGUOS: Clarificas motivaciones, a\xF1ades escenas que establezcan la relaci\xF3n entre antagonistas, o modificas di\xE1logos para eliminar confusi\xF3n.

6. FORESHADOWING SIN PAYOFF: A\xF1ades el payoff de forma org\xE1nica, o reformulas el foreshadowing para que apunte a un evento existente.

=== PROBLEMAS DE CONTINUIDAD (del Continuity Sentinel) ===

7. ERRORES DE TIMELINE: Corriges inconsistencias temporales (fechas, secuencia de eventos, duraci\xF3n de viajes).

8. ERRORES DE UBICACI\xD3N: Corriges personajes que aparecen en lugares imposibles sin transici\xF3n.

9. ESTADO DE PERSONAJE: Corriges estados f\xEDsicos/emocionales inconsistentes (heridas que desaparecen, muertes ignoradas).

10. OBJETOS PERDIDOS: A\xF1ades referencias a objetos importantes que desaparecen o reaparecen sin explicaci\xF3n.

=== PROBLEMAS DE VOZ Y RITMO (del Voice Rhythm Auditor) ===

11. DERIVA TONAL: Corriges cambios bruscos de tono ajustando lenguaje, di\xE1logos y descripciones.

12. POV INCONSISTENTE: Corriges cambios de punto de vista no intencionales dentro del cap\xEDtulo.

13. PACING IRREGULAR: Expandes momentos demasiado r\xE1pidos o condensas secciones que arrastran.

14. VOZ NARRATIVA: Ajustas el registro narrativo para mantener consistencia con el resto del manuscrito.

15. REGISTRO LING\xDC\xCDSTICO: Corriges cambios inapropiados entre formal/informal.

=== PROBLEMAS SEM\xC1NTICOS (del Semantic Detector) ===

16. IDEAS REPETIDAS: Reformulas conceptos que aparecen expresados de forma casi id\xE9ntica en m\xFAltiples lugares.

17. MET\xC1FORAS REPETIDAS: Sustituyes met\xE1foras/im\xE1genes usadas en exceso por alternativas frescas.

18. ESTRUCTURAS REPETIDAS: Var\xEDas patrones de escenas o di\xE1logos que se repiten.

19. PAYOFF SIN FORESHADOWING: A\xF1ades la preparaci\xF3n narrativa necesaria para giros o revelaciones.

REGLAS INVIOLABLES:
- El contenido nuevo debe ser INDISTINGUIBLE del original en estilo y voz
- Las correcciones deben ser ELEGANTES, no parches obvios
- NUNCA cambies nombres, fechas, lugares establecidos en la Biblia del Mundo
- Prefiere A\xD1ADIR contenido a ELIMINAR (preserva el trabajo del autor)
- Las escenas nuevas deben tener prop\xF3sito narrativo, no solo resolver el problema t\xE9cnico

FORMATO DE RESPUESTA (JSON):
{
  "fasePlanificacion": {
    "problemaAnalizado": "Descripci\xF3n de lo que est\xE1 roto y por qu\xE9",
    "solucionPropuesta": "Estrategia espec\xEDfica para repararlo",
    "contenidoACrear": "Tipo de contenido a a\xF1adir (escena, di\xE1logo, p\xE1rrafo, etc.)",
    "puntoInsercion": "D\xF3nde exactamente se insertar\xE1 el nuevo contenido"
  },
  "capituloReescrito": "TEXTO COMPLETO del cap\xEDtulo con las correcciones integradas de forma invisible",
  "cambiosRealizados": [
    {
      "tipoProblema": "hueco_argumental|subplot|arco_incompleto|contradiccion|antagonista|foreshadowing",
      "descripcionProblema": "El problema espec\xEDfico que se corrigi\xF3",
      "solucionAplicada": "Descripci\xF3n detallada de la correcci\xF3n",
      "contenidoNuevo": "El texto nuevo a\xF1adido (primeras 200 palabras si es largo)",
      "palabrasAnadidas": 150,
      "ubicacionEnCapitulo": "Despu\xE9s del p\xE1rrafo que comienza con..."
    }
  ],
  "verificacionInterna": {
    "coherenciaConWorldBible": true,
    "estiloConsistente": true,
    "problemasResueltos": ["Lista de IDs de problemas resueltos"],
    "nuevosProblemasIntroducidos": [],
    "confianzaEnCorreccion": 9
  },
  "resumenEjecutivo": "Descripci\xF3n concisa de todas las correcciones realizadas"
}`,model:"deepseek-chat",useThinking:!1})}async execute(e){return this.rewriteChapter(e.chapterContent,e.chapterNumber,e.problems,e.worldBible,e.adjacentContext,e.language)}async rewriteChapter(e,t,n,a,s,o,i){let u=this.buildWorldBibleContext(a),c=this.buildAdjacentContext(s),p=this.buildProblemsList(n,t),m=i?`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES DEL AUTOR (M\xC1XIMA PRIORIDAD):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${i}

NOTA: Estas instrucciones del autor deben guiar tu enfoque al corregir los problemas.
Adapta el tono, estilo y soluciones a estas directrices espec\xEDficas.
`:"",f=`MISI\xD3N: Reescribe el Cap\xEDtulo ${t} para corregir los problemas estructurales detectados.

IDIOMA DEL TEXTO: ${o}
${m}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PROBLEMAS A RESOLVER EN ESTE CAP\xCDTULO:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${p}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
BIBLIA DEL MUNDO (CANON INVIOLABLE):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${u}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CONTEXTO NARRATIVO (cap\xEDtulos adyacentes):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${c}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CAP\xCDTULO A REESCRIBIR:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${e}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F52C} MODO CIRUG\xCDA L\xC1SER - CAMBIOS M\xCDNIMOS OBLIGATORIOS \u{1F52C}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

\u26A0\uFE0F REGLA CR\xCDTICA: NO reescribas el cap\xEDtulo completo.
\u26A0\uFE0F COPIA el 95% del texto original y modifica SOLO lo estrictamente necesario.

PROCESO OBLIGATORIO:
1. Lee el cap\xEDtulo completo
2. Identifica las frases/p\xE1rrafos EXACTOS que causan cada problema
3. COPIA el texto p\xE1rrafo por p\xE1rrafo
4. Cuando llegues a un problema \u2192 aplica el cambio M\xCDNIMO necesario
5. Contin\xFAa copiando el resto SIN MODIFICAR

TIPOS DE CAMBIOS PERMITIDOS:
- REEMPLAZAR: Cambiar 1-3 frases espec\xEDficas
- INSERTAR: A\xF1adir 1-2 frases de transici\xF3n/explicaci\xF3n  
- ELIMINAR: Quitar frases contradictorias

PROHIBIDO:
- Reescribir p\xE1rrafos enteros que funcionan bien
- Cambiar el estilo o vocabulario del autor original
- Reorganizar la estructura del cap\xEDtulo
- A\xF1adir m\xE1s contenido del estrictamente necesario

OBJETIVO: El resultado debe tener \xB1100 palabras del original.
Si el problema solo requiere cambiar UNA palabra, cambia SOLO esa palabra.

CRITERIO DE \xC9XITO: El cambio debe ser INVISIBLE - como si siempre hubiera estado ah\xED.

RESPONDE \xDANICAMENTE CON JSON V\xC1LIDO.`;console.log(`[NarrativeRewriter] Rewriting chapter ${t} to fix ${n.length} problems:`),n.forEach((C,A)=>{console.log(`  ${A+1}. [${(C.severidad||"media").toUpperCase()}] ${C.tipo}: ${C.descripcion.substring(0,100)}...`)});let g=await this.generateContent(f),y={fasePlanificacion:{problemaAnalizado:"",solucionPropuesta:"",contenidoACrear:"",puntoInsercion:""},capituloReescrito:e,cambiosRealizados:[],verificacionInterna:{coherenciaConWorldBible:!1,estiloConsistente:!1,problemasResueltos:[],nuevosProblemasIntroducidos:[],confianzaEnCorreccion:0},resumenEjecutivo:"No se pudieron aplicar correcciones"};try{let C=g.content.match(/\{[\s\S]*\}/);C&&(y=JSON.parse(C[0]),console.log(`[NarrativeRewriter] Chapter ${t} rewritten successfully:`),console.log(`  Planificaci\xF3n: ${y.fasePlanificacion?.solucionPropuesta?.substring(0,150)||"N/A"}...`),console.log(`  Cambios realizados: ${y.cambiosRealizados?.length||0}`),y.cambiosRealizados?.length>0&&y.cambiosRealizados.forEach((A,T)=>{console.log(`  \u2713 ${T+1}. [${A.tipoProblema}] ${A.descripcionProblema?.substring(0,80)}...`),console.log(`      Soluci\xF3n: ${A.solucionAplicada?.substring(0,100)}...`),console.log(`      Palabras a\xF1adidas: ${A.palabrasAnadidas||"N/A"}`)}),y.verificacionInterna&&console.log(`  Verificaci\xF3n: Coherencia=${y.verificacionInterna.coherenciaConWorldBible}, Estilo=${y.verificacionInterna.estiloConsistente}, Confianza=${y.verificacionInterna.confianzaEnCorreccion}/10`),console.log(`  Resumen: ${y.resumenEjecutivo?.substring(0,200)||"N/A"}`))}catch(C){console.error("[NarrativeRewriter] Failed to parse response:",C)}return y.tokenUsage=g.tokenUsage,y}async surgicalFix(e,t,n,a,s){let o=JSON.stringify({personajes:a?.personajes?.slice(0,8)?.map(f=>({nombre:f.nombre,rol:f.rol}))||[],ubicaciones:a?.ubicaciones?.slice(0,5)?.map(f=>f.nombre)||[]}),i=n.map((f,g)=>`${g+1}. [${(f.severidad||"media").toUpperCase()}] ${f.tipo}: ${f.descripcion}${f.accionSugerida?` -> ${f.accionSugerida}`:""}`).join(`
`),u=`CORRECCI\xD3N QUIR\xDARGICA - Cap\xEDtulo ${t}

IDIOMA: ${s}

PROBLEMAS A CORREGIR:
${i}

BIBLIA DEL MUNDO:
${o}

CAP\xCDTULO:
${e}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES CR\xCDTICAS:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
1. Identifica SOLO las frases o p\xE1rrafos que causan cada problema
2. Genera parches M\xCDNIMOS - NO reescribas el cap\xEDtulo completo
3. Cada parche "original" debe tener al menos 30 caracteres para garantizar unicidad
4. Mant\xE9n el estilo y vocabulario exacto del autor
5. Si un problema se resuelve cambiando 1 palabra, cambia SOLO esa palabra

RESPONDE EN JSON:
{
  "analisis": "Breve descripci\xF3n de los problemas y d\xF3nde est\xE1n",
  "patches": [
    {
      "original": "texto exacto a reemplazar (m\xEDn 30 chars, copiar literalmente del texto)",
      "replacement": "texto corregido manteniendo estilo del autor"
    }
  ],
  "resumenCambios": "Resumen de las correcciones quir\xFArgicas aplicadas"
}`;console.log(`[NarrativeRewriter] Surgical fix for chapter ${t} with ${n.length} problems`);let c=await this.generateContent(u),p=[],m="";try{let f=c.content.match(/\{[\s\S]*\}/);if(f){let g=JSON.parse(f[0]);p=(g.patches||[]).filter(y=>y.original&&y.replacement&&y.original.length>=30),m=g.resumenCambios||"",console.log(`[NarrativeRewriter] Generated ${p.length} surgical patches for chapter ${t}`),p.forEach((y,C)=>{console.log(`  ${C+1}. "${y.original.substring(0,50)}..." \u2192 "${y.replacement.substring(0,50)}..."`)})}}catch(f){console.error("[NarrativeRewriter] Failed to parse surgical fix response:",f)}return{patches:p,tokenUsage:c.tokenUsage,resumenCambios:m}}buildWorldBibleContext(e){if(!e)return"No hay Biblia del Mundo disponible.";let t=[];if(e.personajes?.length>0){let n=e.personajes.slice(0,20).map(a=>{let s=[];if(a.appearance){let i=a.appearance;i.eyes&&s.push(`ojos: ${i.eyes}`),i.eye_color&&s.push(`ojos: ${i.eye_color}`),i.hair&&s.push(`cabello: ${i.hair}`),i.hair_color&&s.push(`cabello: ${i.hair_color}`),i.height&&s.push(`altura: ${i.height}`),i.build&&s.push(`complexi\xF3n: ${i.build}`),i.skin&&s.push(`piel: ${i.skin}`),i.age&&s.push(`edad: ${i.age}`)}a.eyes&&s.push(`ojos: ${a.eyes}`),a.eye_color&&s.push(`ojos: ${a.eye_color}`),a.hair&&s.push(`cabello: ${a.hair}`),a.hair_color&&s.push(`cabello: ${a.hair_color}`);let o=s.length>0?` | \u26A0\uFE0F F\xCDSICO INMUTABLE: ${s.join(", ")}`:"";return`\u2022 ${a.nombre} (${a.rol||"secundario"}): ${a.descripcion?.substring(0,150)||"Sin descripci\xF3n"}${o}${a.arcoNarrativo?` | Arco: ${a.arcoNarrativo.substring(0,100)}`:""}`}).join(`
`);t.push(`PERSONAJES:
${n}`)}if(e.ubicaciones?.length>0){let n=e.ubicaciones.slice(0,10).map(a=>`\u2022 ${a.nombre}: ${a.descripcion?.substring(0,100)||"Sin descripci\xF3n"}`).join(`
`);t.push(`UBICACIONES:
${n}`)}if(e.timeline?.length>0){let n=e.timeline.slice(0,15).map(a=>`\u2022 ${a.evento}: ${a.descripcion?.substring(0,80)||""}`).join(`
`);t.push(`TIMELINE:
${n}`)}if(e.reglas?.length>0){let n=e.reglas.slice(0,10).map(a=>`\u2022 ${typeof a=="string"?a:a.regla||JSON.stringify(a)}`).join(`
`);t.push(`REGLAS DEL MUNDO:
${n}`)}return t.join(`

`)||"Biblia del Mundo vac\xEDa."}buildAdjacentContext(e){let t=[];return e.previousSummary?t.push(`CAP\xCDTULO ANTERIOR (resumen):
${e.previousSummary}`):e.previousChapter&&t.push(`CAP\xCDTULO ANTERIOR (extracto):
${e.previousChapter.substring(0,2e3)}...`),e.nextSummary?t.push(`CAP\xCDTULO SIGUIENTE (resumen):
${e.nextSummary}`):e.nextChapter&&t.push(`CAP\xCDTULO SIGUIENTE (extracto):
${e.nextChapter.substring(0,2e3)}...`),t.join(`

`)||"No hay contexto de cap\xEDtulos adyacentes disponible."}buildProblemsList(e,t){return e.map((n,a)=>{let s=n.id||`P${a+1}`,o=n.severidad?.toUpperCase()||"MEDIA",i=n.tipo||"general",u=n.accionSugerida?`
   ACCI\xD3N SUGERIDA: ${n.accionSugerida}`:"";return`[${s}] [${o}] ${i}
   ${n.descripcion}${u}`}).join(`

`)}},yx=class extends Ae{constructor(){super({name:"Revisor Final de Re-edici\xF3n",role:"final_reviewer",systemPrompt:`Eres un experto de la industria editorial evaluando manuscritos para potencial de bestseller.
IMPORTANTE: Todas tus respuestas deben estar en ESPA\xD1OL.

Eval\xFAa el manuscrito y proporciona:
1. Puntuaci\xF3n de bestseller (1-10)
2. Fortalezas principales
3. \xC1reas que necesitan mejora
4. Evaluaci\xF3n del potencial de mercado
5. Recomendaciones para el autor

RESPONDE \xDANICAMENTE CON JSON EN ESPA\xD1OL:
{
  "bestsellerScore": 8,
  "strengths": ["Trama atrapante", "Personajes bien desarrollados"],
  "weaknesses": ["Problemas de ritmo en la parte central"],
  "marketPotential": "alto",
  "recommendations": ["Apretar el segundo acto", "Fortalecer el final"]
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.reviewManuscript(e.summaries,e.totalChapters,e.totalWords)}async reviewManuscript(e,t,n){let a=`Eval\xFAa este manuscrito para determinar su potencial de bestseller.
IMPORTANTE: Responde COMPLETAMENTE EN ESPA\xD1OL.

ESTAD\xCDSTICAS DEL MANUSCRITO:
- Total de Cap\xEDtulos: ${t}
- Total de Palabras: ${n}

RES\xDAMENES Y CALIDAD DE LOS CAP\xCDTULOS:
${e.join(`

`)}

Proporciona tu evaluaci\xF3n en formato JSON, con todos los textos en ESPA\xD1OL.`,s=await this.generateContent(a),o={bestsellerScore:7,strengths:[],weaknesses:[],recommendations:[],marketPotential:"moderate"};try{let i=s.content||"";if(console.log(`[ReeditFinalReviewer] Response received - content length: ${i.length}, thoughtSignature length: ${s.thoughtSignature?.length||0}`),i.trim().length===0&&s.thoughtSignature&&s.thoughtSignature.length>0){console.log("[ReeditFinalReviewer] Content empty, checking thoughtSignature for JSON...");let c=s.thoughtSignature.match(/(\{[\s\S]*?"bestsellerScore"[\s\S]*?\})/);if(c)try{JSON.parse(c[1]),i=c[1],console.log("[ReeditFinalReviewer] Found valid JSON with bestsellerScore in thoughtSignature")}catch{}if(i.trim().length===0){let p=s.thoughtSignature.match(/\{[\s\S]*\}/);if(p)try{JSON.parse(p[0]),i=p[0],console.log("[ReeditFinalReviewer] Found valid JSON in thoughtSignature (generic match)")}catch{console.log("[ReeditFinalReviewer] Found JSON-like structure but couldn't parse")}}}if(i.includes("```")){let c=i.match(/```(?:json)?\s*([\s\S]*?)```/);c&&(i=c[1].trim(),console.log("[ReeditFinalReviewer] Extracted JSON from code block"))}let u=i.match(/\{[\s\S]*\}/);if(u){let c=JSON.parse(u[0]),p=c.bestsellerScore||c.puntuacion_global||c.score||c.puntuacionGlobal;p!==void 0&&p>0?(c.bestsellerScore=p,o=c,console.log(`[ReeditFinalReviewer] Successfully parsed response: score ${o.bestsellerScore}/10`)):console.warn("[ReeditFinalReviewer] Parsed JSON but no valid score found")}}catch(i){console.error("[ReeditFinalReviewer] Failed to parse response:",i),console.error("[ReeditFinalReviewer] Content preview:",s.content?.substring(0,500)||"EMPTY"),s.thoughtSignature&&console.error("[ReeditFinalReviewer] ThoughtSignature preview:",s.thoughtSignature.substring(0,500))}return o.tokenUsage=s.tokenUsage,o}},po=class{editorAgent;copyEditorAgent;quickFinalReviewerAgent;fullFinalReviewerAgent;worldBibleExtractor;architectAnalyzer;structuralFixer;narrativeRewriter;continuitySentinel;voiceRhythmAuditor;semanticRepetitionDetector;anachronismDetector;forensicAuditor;betaReader;seriesThreadFixer;expansionAnalyzer;chapterExpander;newChapterGenerator;progressCallback=null;totalInputTokens=0;totalOutputTokens=0;totalThinkingTokens=0;maxFinalReviewCycles=15;minAcceptableScore=9;requiredConsecutiveHighScores=2;generationToken;cancelled=!1;constructor(e){this.generationToken=e,this.editorAgent=new ix,this.copyEditorAgent=new cx,this.quickFinalReviewerAgent=new yx,this.fullFinalReviewerAgent=new Lc,this.worldBibleExtractor=new mx,this.architectAnalyzer=new hx,this.structuralFixer=new fx,this.narrativeRewriter=new gx,this.continuitySentinel=new lx,this.voiceRhythmAuditor=new ux,this.semanticRepetitionDetector=new px,this.anachronismDetector=new dx,this.forensicAuditor=new jm,this.betaReader=new jc,this.seriesThreadFixer=new ei,this.expansionAnalyzer=new Yy,this.chapterExpander=new Zy,this.newChapterGenerator=new eb}cancel(){console.log("[ReeditOrchestrator] Cancellation requested"),this.cancelled=!0}trackTokens(e){e?.tokenUsage&&(this.totalInputTokens+=e.tokenUsage.inputTokens||0,this.totalOutputTokens+=e.tokenUsage.outputTokens||0,this.totalThinkingTokens+=e.tokenUsage.thinkingTokens||0)}analyzeRecurrentIssues(e){let t={};for(let n of e){let a=n.categoria||"sin_categoria";t[a]=(t[a]||0)+1}return Object.entries(t).filter(([n,a])=>a>1).sort((n,a)=>a[1]-n[1]).slice(0,5).map(([n,a])=>`${n} (${a}x)`)}async smartCorrectChapter(e,t,n,a,s,o,i){let u=n.some(f=>f.severidad==="critica"||f.severidad==="critical"),c=["timeline","temporal","tiempo","ubicacion","geografica","geography","location","continuidad_fisica","physical","injury","lesion","ritmo","pacing","transition","coherencia","continuity","consistency","estructura","structure","arco","arc","character_arc"],p=n.some(f=>{let g=(f.tipo||"").toLowerCase(),y=(f.descripcion||"").toLowerCase();return c.some(C=>g.includes(C)||y.includes(C))||y.includes("teletransport")||y.includes("recuperaci\xF3n milagrosa")||y.includes("miraculous recovery")||y.includes("viaje imposible")||y.includes("impossible travel")||y.includes("herida ignorada")||y.includes("injury ignored")||y.includes("lesi\xF3n")||y.includes("transici\xF3n abrupta")}),m=n.length<=2&&!u&&!p;if(p&&console.log(`[ReeditOrchestrator] Chapter ${t} has STRUCTURAL issues (coherence/timeline/physical) - forcing FULL REWRITE`),m){console.log(`[ReeditOrchestrator] Using SURGICAL FIX for chapter ${t} (${n.length} minor problems)`);try{let f=await this.narrativeRewriter.surgicalFix(e,t,n,a||{},o);if(this.trackTokens(f),f.patches&&f.patches.length>0){let g=G2(e,f.patches);if(g.success&&g.patchedContent)return console.log(`[ReeditOrchestrator] Applied ${g.appliedCount} surgical patches to chapter ${t}`),{content:g.patchedContent,method:"surgical"}}console.log(`[ReeditOrchestrator] Surgical fix produced no valid patches for chapter ${t}, falling back to full rewrite`)}catch(f){console.error(`[ReeditOrchestrator] Surgical fix error for chapter ${t}:`,f)}}console.log(`[ReeditOrchestrator] Using FULL REWRITE for chapter ${t} (${n.length} problems, critical: ${u})`);try{let f=await this.narrativeRewriter.rewriteChapter(e,t,n,a||{},s,o,i);if(this.trackTokens(f),f.capituloReescrito)return{content:f.capituloReescrito,method:"full"}}catch(f){console.error(`[ReeditOrchestrator] Full rewrite error for chapter ${t}:`,f)}return{content:null,method:"failed"}}generateIssueHash(e){let t=(e.descripcion||"").toLowerCase().replace(/\s+/g," ").trim().substring(0,100),n=(e.capitulos_afectados||[]).sort((o,i)=>o-i).join(","),a=`${e.categoria||"unknown"}|${t}|${n}`,s=5381;for(let o=0;o<a.length;o++)s=(s<<5)+s+a.charCodeAt(o);return`issue_${Math.abs(s).toString(16)}`}filterNewIssues(e,t){let n=new Set(t),a=[],s=0;for(let o of e){let i=this.generateIssueHash(o);n.has(i)?(console.log(`[ReeditOrchestrator] Filtering resolved issue: ${o.categoria} - ${o.descripcion?.substring(0,50)}...`),s++):a.push(o)}return s>0&&console.log(`[ReeditOrchestrator] Filtered ${s} previously resolved issues, ${a.length} new issues remain`),{newIssues:a,filteredCount:s}}async markIssuesResolved(e,t){if(t.length===0)return;let a=(await b.getReeditProject(e))?.resolvedIssueHashes||[],s=t.map(p=>this.generateIssueHash(p)),o=[...a,...s],i=o.filter((p,m)=>o.indexOf(p)===m);await b.updateReeditProject(e,{resolvedIssueHashes:i});let u=await b.getReeditIssuesByProject(e),c=0;for(let p of s){let m=u.find(f=>f.issueHash===p);m&&m.status!=="resolved"&&(await b.resolveReeditIssue(m.id),c++)}console.log(`[ReeditOrchestrator] Marked ${s.length} issues as resolved (total hashes: ${i.length}, DB records: ${c})`)}async createIssueRecords(e,t,n){if(t.length===0)return 0;let a=await b.getReeditIssuesByProject(e);for(let o of a)(o.status==="pending"||o.status==="approved")&&await b.updateReeditIssue(o.id,{status:"rejected",rejectionReason:"Replaced by new review cycle"});let s=0;for(let o of t){let i=this.generateIssueHash(o),u="minor",c=o.severidad;c==="critica"||c==="cr\xEDtica"?u="critical":c==="mayor"?u="major":c==="menor"&&(u="minor");let p=o.capitulos_afectados?.[0]||1;await b.createReeditIssue({projectId:e,chapterNumber:p,category:o.categoria||"general",severity:u,description:o.descripcion||"",textCitation:o.elementos_a_preservar||null,correctionInstruction:o.instrucciones_correccion||null,source:"final_reviewer",status:"pending",issueHash:i,reviewCycle:n}),s++}return console.log(`[ReeditOrchestrator] Created ${s} issue records for user review`),s}async applyUserApprovedCorrections(e,t,n,a,s,o,i,u){if(t.length===0)return console.log("[ReeditOrchestrator] No approved issues to apply"),{correctedCount:0};console.log(`[ReeditOrchestrator] Applying ${t.length} user-approved corrections`);let c=0,p=await b.getReeditProject(e),m=new Map(Object.entries(p?.chapterChangeHistory||{}).map(([g,y])=>[parseInt(g),y])),f=new Map;for(let g of t){let y=g.chapterNumber;f.has(y)||f.set(y,[]),f.get(y).push(g)}for(let[g,y]of Array.from(f)){let C=n.find(h=>h.chapterNumber===g);if(!C){console.log(`[ReeditOrchestrator] Chapter ${g} not found, skipping`);continue}console.log(`[ReeditOrchestrator] Applying ${y.length} corrections to chapter ${g}`);let A=h=>h==="critical"||h==="critica"||h==="cr\xEDtica"?"critica":h==="major"||h==="mayor"?"mayor":"menor",T=y.map((h,v)=>({id:`issue-${v}`,tipo:h.category||"otro",descripcion:h.description,severidad:A(h.severity||"mayor"),accionSugerida:h.correctionInstruction||"Corregir seg\xFAn indicaci\xF3n del usuario"})),E=n.find(h=>h.chapterNumber===g-1),d=n.find(h=>h.chapterNumber===g+1),l={previousChapter:E?.editedContent?.substring(0,2e3),nextChapter:d?.editedContent?.substring(0,2e3)};try{let h=C.editedContent||C.originalContent,v=await this.smartCorrectChapter(h,g,T,a||{},l,"espa\xF1ol",o||void 0);if(await this.updateHeartbeat(e),v.content){let S=v.content.split(/\s+/).filter(_=>_.length>0).length;await b.updateReeditChapter(C.id,{editedContent:v.content,wordCount:S});let R=n.findIndex(_=>_.chapterNumber===g);R!==-1&&(n[R].editedContent=v.content);let x=u.get(g)||0;u.set(g,x+1);for(let _ of y)_.issueHash&&!i.includes(_.issueHash)&&i.push(_.issueHash),_.id&&await b.resolveReeditIssue(_.id);let w=y.map(_=>_.description?.substring(0,300)||"").join("; "),O=`Correcci\xF3n ${v.method==="surgical"?"quir\xFArgica":"completa"}: ${T.length} problemas`,I=m.get(g)||[];I.push({issue:w,fix:O,timestamp:new Date().toISOString()}),I.length>10&&(I=I.slice(-10)),m.set(g,I),c++,console.log(`[ReeditOrchestrator] Chapter ${g} corrected successfully (${S} words)`),this.emitProgress({projectId:e,stage:"correcting",currentChapter:g,totalChapters:n.length,message:`Cap\xEDtulo ${g} corregido (${y.length} problema(s))`})}}catch(h){console.error(`[ReeditOrchestrator] Error correcting chapter ${g}:`,h)}}return await b.updateReeditProject(e,{chapterCorrectionCounts:Object.fromEntries(u),chapterChangeHistory:Object.fromEntries(m),resolvedIssueHashes:i}),console.log(`[ReeditOrchestrator] Completed applying ${c} user-approved corrections (state persisted)`),{correctedCount:c}}getInsertionDescription(e){switch(e){case"beginning":return"Integrar al INICIO del capitulo";case"end":return"Integrar al FINAL del capitulo";case"middle":return"Integrar en una transicion natural del capitulo";case"replace":return"Reemplazar pasaje existente con";default:return"Integrar organicamente"}}async saveTokenUsage(e){await b.updateReeditProject(e,{totalInputTokens:this.totalInputTokens,totalOutputTokens:this.totalOutputTokens,totalThinkingTokens:this.totalThinkingTokens}),console.log(`[ReeditOrchestrator] Token usage saved: ${this.totalInputTokens} input, ${this.totalOutputTokens} output, ${this.totalThinkingTokens} thinking`)}async updateWorldBibleFromReeditChapter(e,t,n,a){try{let s=await b.getReeditWorldBibleByProject(e);if(!s)return;let o={},i=!1,u=s.timeline||[],c=[];for(let m of a)(m.tipo?.includes("continuidad")||m.category?.includes("continuity"))&&c.push({chapter:t,event:`Correcci\xF3n: ${m.descripcion?.substring(0,100)||"problema de continuidad"}`,tipo:"correccion",timestamp:new Date().toISOString()});c.length>0&&(o.timeline=[...u,...c],i=!0);let p=s.personajes||[];for(let m of a)if(m.descripcion?.toLowerCase().includes("lesion")||m.descripcion?.toLowerCase().includes("herida")||m.descripcion?.toLowerCase().includes("condicion")){let f=p.map(g=>({...g,lastUpdatedChapter:t}));o.personajes=f,i=!0;break}if(n.length>500){let m=n.substring(0,300).replace(/\n/g," ").trim()+"...",f=s.chapterSummaries||{};o.chapterSummaries={...f,[t]:{summary:m,correctionCount:a.length,lastUpdated:new Date().toISOString()}},i=!0}i&&(await b.updateReeditWorldBible(s.id,o),console.log(`[ReeditOrchestrator] World Bible updated after Chapter ${t} rewrite`))}catch(s){console.error(`[ReeditOrchestrator] Failed to update World Bible after Chapter ${t}:`,s)}}async buildEnrichedReeditContext(e,t,n){let a=[],s=n?.personajes||[];if(s.length>0){a.push(`
=== PERSONAJES (MANTENER CONSISTENCIA) ===`);for(let p of s.slice(0,10)){let m=p.nombre||p.name,f=p.rol||p.role||"",g=p.rasgos||p.traits||"";a.push(`\u2022 ${m}${f?` (${f})`:""}${g?`: ${g}`:""}`)}}let o=n?.ubicaciones||[];if(o.length>0){a.push(`

=== UBICACIONES ===`);for(let p of o.slice(0,8)){let m=p.nombre||p.name||p;a.push(`\u2022 ${typeof m=="string"?m:JSON.stringify(m)}`)}}let i=n?.reglasDelMundo||n?.reglas||[];if(i.length>0){a.push(`

=== REGLAS DEL MUNDO ===`);for(let p of i.slice(0,6))typeof p=="string"?a.push(`\u2022 ${p}`):(p.regla||p.rule)&&a.push(`\u2022 ${p.regla||p.rule}`)}let u=n?.timeline||[];if(u.length>0&&t>1){a.push(`

=== EVENTOS PREVIOS ===`);let p=u.filter(m=>(m.chapter||m.capitulo||0)<t).slice(-5);for(let m of p){let f=m.chapter||m.capitulo||"?",g=m.event||m.evento||m.descripcion||"";g&&a.push(`\u2022 [Cap ${f}] ${g.substring(0,100)}`)}}a.push(`

=== ERRORES A EVITAR ===`),a.push("\u2022 NO contradecir informaci\xF3n de cap\xEDtulos anteriores"),a.push("\u2022 NO ignorar lesiones o condiciones f\xEDsicas de personajes"),a.push("\u2022 NO cambiar nombres o caracter\xEDsticas de personajes"),a.push("\u2022 NO alterar cronolog\xEDa sin justificaci\xF3n");let c=n?.styleGuide||n?.guiaEstilo;return c&&typeof c=="string"&&c.length>50&&(a.push(`

=== GU\xCDA DE ESTILO ===`),a.push(c.substring(0,2e3))),a.length>0?a.join(`
`):""}async updateHeartbeat(e,t){let n={heartbeatAt:new Date,totalInputTokens:this.totalInputTokens,totalOutputTokens:this.totalOutputTokens,totalThinkingTokens:this.totalThinkingTokens};t!==void 0&&(n.lastCompletedChapter=t),await b.updateReeditProject(e,n)}updateChapterTitleNumber(e,t){if(!e)return`Cap\xEDtulo ${t}`;let n=/^Captulo\s+\d+\s*[:|-]?\s*/i;if(n.test(e)){let s=e.replace(n,"").trim();return s?`Cap\xEDtulo ${t}: ${s}`:`Cap\xEDtulo ${t}`}return/^(prlogo|eplogo|preludio|interludio|epilogue|prologue|prelude|interlude)/i.test(e.trim())?e:`Cap\xEDtulo ${t}: ${e}`}normalizeChapterHeaderContent(e,t,n){if(!e||/^(prlogo|eplogo|preludio|interludio|epilogue|prologue|prelude|interlude)/i.test(n.trim()))return e;let s=[/^(Captulo|Capitulo|CAPTULO|CAPITULO)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Chapter|CHAPTER)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Chapitre|CHAPITRE)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Capitolo|CAPITOLO)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Kapitel|KAPITEL)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Captol|Capitol|CAPTOL|CAPITOL)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im];for(let o of s){let i=e.match(o);if(i){let u=i[1],c=n,p=e.replace(o,c);if(p!==e)return console.log(`[ReeditOrchestrator] Updated internal header: "${i[0].substring(0,50)}..." -> "${c}"`),p;break}}return e}buildAdjacentChapterContext(e,t){let n=[...e].sort((o,i)=>cn(o.chapterNumber)-cn(i.chapterNumber)),a=n.findIndex(o=>o.chapterNumber===t),s={};if(a>0){let o=n[a-1];s.previousChapter=o.originalContent?.substring(0,3e3),s.previousSummary=`Cap\xEDtulo ${o.chapterNumber}: ${o.title||"Sin t\xEDtulo"}`}if(a<n.length-1){let o=n[a+1];s.nextChapter=o.originalContent?.substring(0,3e3),s.nextSummary=`Cap\xEDtulo ${o.chapterNumber}: ${o.title||"Sin t\xEDtulo"}`}return s}async checkCancellation(e){if(this.cancelled)return console.log(`[ReeditOrchestrator] Stopping: local cancellation flag set for project ${e}`),!0;let t=await b.getReeditProject(e);return t?!this.generationToken&&t.generationToken?(console.log(`[ReeditOrchestrator] Legacy process (no token) superseded by new process with token ${t.generationToken} for project ${e}. Stopping.`),!0):this.generationToken&&t.generationToken&&t.generationToken!==this.generationToken?(console.log(`[ReeditOrchestrator] Stopping: token mismatch for project ${e} (ours=${this.generationToken}, DB=${t.generationToken})`),!0):t.cancelRequested?(console.log(`[ReeditOrchestrator] Cancellation requested for project ${e}`),await b.updateReeditProject(e,{status:"paused",cancelRequested:!1,errorMessage:"Cancelado por el usuario"}),!0):!1:!0}async expandManuscript(e,t,n,a){let s=t.expandChapters||!1,o=t.insertNewChapters||!1,i=t.targetMinWordsPerChapter||2e3;if(!s&&!o)return console.log(`[ReeditOrchestrator] Expansion disabled for project ${e}`),n;console.log("[ReeditOrchestrator] Starting manuscript expansion"),console.log(`  - Expand existing chapters: ${s}`),console.log(`  - Insert new chapters: ${o}`),console.log(`  - Target min words/chapter: ${i}`);let u=t.genre||"thriller literario",c=t.expansionPlan,p=.7,m=.8;if(c&&c.chaptersToExpand){console.log("[ReeditOrchestrator] Reusing existing expansion plan from database");let y=c.chaptersToExpand?.length||0,C=c.newChaptersToInsert?.length||0;c.chaptersToExpand&&(c.chaptersToExpand=c.chaptersToExpand.filter(A=>{let T=A.necessityScore??1;return T<p?(console.log(`[ReeditOrchestrator] Filtering out expansion of chapter ${A.chapterNumber} (necessityScore: ${T} < ${p})`),!1):!0})),c.newChaptersToInsert&&(c.newChaptersToInsert=c.newChaptersToInsert.filter(A=>{let T=A.necessityScore??1;return T<m?(console.log(`[ReeditOrchestrator] Filtering out new chapter "${A.title}" after ch ${A.insertAfterChapter} (necessityScore: ${T} < ${m})`),!1):!0})),console.log(`  - Chapters to expand: ${c.chaptersToExpand?.length||0} (after filtering from ${y})`),console.log(`  - New chapters to insert: ${c.newChaptersToInsert?.length||0} (after filtering from ${C})`)}else{this.emitProgress({projectId:e,stage:"expansion",currentChapter:0,totalChapters:n.length,message:"Analizando manuscrito para expansi\xF3n..."});let y=n.map(E=>({chapterNumber:E.chapterNumber,title:E.title||`Cap\xEDtulo ${E.chapterNumber}`,wordCount:E.wordCount||E.originalContent.split(/\s+/).length,summary:E.originalContent.substring(0,1500)+(E.originalContent.length>1500?"...":"")})),C=await this.expansionAnalyzer.execute({chapters:y,genre:u,targetMinWordsPerChapter:i,enableNewChapters:o,enableChapterExpansion:s});if(this.trackTokens(C),!C.result)return console.log("[ReeditOrchestrator] Expansion analysis failed, continuing without expansion"),n;c=C.result;let A=c.chaptersToExpand?.length||0,T=c.newChaptersToInsert?.length||0;c.chaptersToExpand&&(c.chaptersToExpand=c.chaptersToExpand.filter(E=>{let d=E.necessityScore||0;return d<p?(console.log(`[ReeditOrchestrator] Filtering out expansion of chapter ${E.chapterNumber} (necessityScore: ${d} < ${p})`),!1):!0})),c.newChaptersToInsert&&(c.newChaptersToInsert=c.newChaptersToInsert.filter(E=>{let d=E.necessityScore||0;return d<m?(console.log(`[ReeditOrchestrator] Filtering out new chapter "${E.title}" after ch ${E.insertAfterChapter} (necessityScore: ${d} < ${m})`),!1):(console.log(`[ReeditOrchestrator] Keeping new chapter "${E.title}" (necessityScore: ${d}, justification: ${E.justification||"N/A"})`),!0)})),console.log("[ReeditOrchestrator] Expansion plan created:"),console.log(`  - Chapters to expand: ${c.chaptersToExpand?.length||0} (filtered from ${A})`),console.log(`  - New chapters to insert: ${c.newChaptersToInsert?.length||0} (filtered from ${T})`),console.log(`  - Overall necessity: ${c.overallNecessityAssessment||"unknown"}`),console.log(`  - Estimated new words: ${c.totalEstimatedNewWords||0}`),await b.updateReeditProject(e,{expansionPlan:c})}let f=[...n];if(s&&c.chaptersToExpand?.length>0){let y=0;for(let C=0;C<c.chaptersToExpand.length;C++){let A=c.chaptersToExpand[C],T=f.find(v=>v.chapterNumber===A.chapterNumber);if(!T)continue;let E=T.wordCount||T.originalContent.split(/\s+/).length,d=A.targetWords*.9;if(E>=d){console.log(`[ReeditOrchestrator] Skipping chapter ${T.chapterNumber} (already expanded: ${E} >= ${Math.round(d)} words)`),y++;continue}if(await this.checkCancellation(e))return f;this.emitProgress({projectId:e,stage:"expansion",currentChapter:C+1,totalChapters:c.chaptersToExpand.length,message:`Expandiendo cap\xEDtulo ${T.chapterNumber}: ${T.title||"Sin t\xEDtulo"}...`});let l=this.buildAdjacentChapterContext(f,T.chapterNumber),h=await this.chapterExpander.execute({chapterContent:T.originalContent,chapterNumber:T.chapterNumber,chapterTitle:T.title||`Cap\xEDtulo ${T.chapterNumber}`,expansionPlan:{targetWords:A.targetWords,expansionType:A.expansionType,suggestedContent:A.suggestedContent},worldBible:a,adjacentContext:{previousSummary:l.previousSummary,nextSummary:l.nextSummary}});if(this.trackTokens(h),h.result?.expandedContent){let v=h.result.newWordCount||h.result.expandedContent.split(/\s+/).length;await b.updateReeditChapter(T.id,{originalContent:h.result.expandedContent,wordCount:v});let S=f.findIndex(R=>R.id===T.id);S>=0&&(f[S]={...f[S],originalContent:h.result.expandedContent,wordCount:v}),console.log(`[ReeditOrchestrator] Chapter ${T.chapterNumber} expanded: ${A.currentWords} -> ${v} words`)}await this.updateHeartbeat(e)}}if(o&&c.newChaptersToInsert?.length>0){let y=[...c.newChaptersToInsert].sort((C,A)=>A.insertAfterChapter-C.insertAfterChapter);for(let C=0;C<y.length;C++){let A=y[C];if(f.find(h=>h.title===A.title&&h.originalContent&&h.originalContent.length>500)){console.log(`[ReeditOrchestrator] Skipping new chapter insertion after ${A.insertAfterChapter} (already exists: "${A.title}")`);continue}if(await this.checkCancellation(e))return f;this.emitProgress({projectId:e,stage:"expansion",currentChapter:(c.chaptersToExpand?.length||0)+C+1,totalChapters:(c.chaptersToExpand?.length||0)+c.newChaptersToInsert.length,message:`Generando nuevo cap\xEDtulo: "${A.title}"...`});let E=f.find(h=>h.chapterNumber===A.insertAfterChapter),d=f.find(h=>h.chapterNumber===A.insertAfterChapter+1),l=await this.newChapterGenerator.execute({insertAfterChapter:A.insertAfterChapter,title:A.title,purpose:A.purpose,plotPoints:A.plotPoints,estimatedWords:A.estimatedWords,worldBible:a,previousChapterSummary:E?.originalContent?.substring(0,2e3)||"No disponible",nextChapterSummary:d?.originalContent?.substring(0,2e3)||"No disponible",genre:u});if(this.trackTokens(l),l.result?.content){let h=9e3+C,v=l.result.wordCount||l.result.content.split(/\s+/).length,S=await b.createReeditChapterIfNotExists({projectId:e,chapterNumber:h,originalChapterNumber:h,title:l.result.title||A.title,originalContent:l.result.content,wordCount:v,status:"pending",processingStage:"none"}),R=A.insertAfterChapter+.5;f.push({...S,_sortOrder:R}),f.sort((x,w)=>{let O=x._sortOrder??x.chapterNumber,I=w._sortOrder??w.chapterNumber;return O-I}),console.log(`[ReeditOrchestrator] New chapter created after ${A.insertAfterChapter}: "${A.title}" (${v} words)`),await this.renumberChaptersInDatabase(f,e)}await this.updateHeartbeat(e)}await b.updateReeditProject(e,{totalChapters:f.length})}let g=f.reduce((y,C)=>y+(C.wordCount||0),0);return console.log(`[ReeditOrchestrator] Expansion complete: ${f.length} chapters, ${g} words`),f}async renumberChaptersInDatabase(e,t){let n=1;for(let a of e){let s={};a.chapterNumber!==n&&(s.originalChapterNumber=a.chapterNumber,s.chapterNumber=n);let o=this.updateChapterTitleNumber(a.title,n);if(o!==a.title&&(s.title=o,console.log(`[ReeditOrchestrator] Renaming: "${a.title}" -> "${o}"`)),a.chapterNumber!==n||o!==a.title){let i=o,u=this.normalizeChapterHeaderContent(a.originalContent,n,i);if(u&&u!==a.originalContent&&(s.originalContent=u,a.originalContent=u),a.editedContent){let c=this.normalizeChapterHeaderContent(a.editedContent,n,i);c&&c!==a.editedContent&&(s.editedContent=c,a.editedContent=c)}}Object.keys(s).length>0&&(await b.updateReeditChapter(a.id,s),s.chapterNumber&&(a.chapterNumber=n),s.title&&(a.title=o)),n++}await b.updateReeditProject(t,{totalChapters:e.length}),console.log(`[ReeditOrchestrator] Renumbered ${e.length} chapters in database (including internal content headers)`)}async reorderChaptersFromAnalysis(e,t,n){if(!n||n.length===0)return e;console.log(`[ReeditOrchestrator] Reordering ${n.length} chapters based on Architect analysis:`);let a=[...e].sort((s,o)=>cn(s.chapterNumber)-cn(o.chapterNumber));for(let s of n){let{capituloActual:o,nuevaPosicion:i,razon:u}=s,c=a.findIndex(f=>f.chapterNumber===o);if(c===-1){console.log(`  [SKIP] Cap\xEDtulo ${o} no encontrado`);continue}let p=a[c];a.splice(c,1);let m=Math.max(0,Math.min(i-1,a.length));a.splice(m,0,p),console.log(`  \u2713 Cap\xEDtulo ${o} ("${p.title?.substring(0,40)}...") -> posici\xF3n ${i}`),console.log(`    Raz\xF3n: ${u}`)}return await this.renumberChaptersInDatabase(a,t),console.log("[ReeditOrchestrator] Chapter reordering complete"),a}async collectQaFindings(e){let t=new Map,n=await b.getReeditAuditReportsByProject(e),a=n.filter(u=>u.auditType==="continuity");for(let u of a){let c=u.findings;if(c?.erroresContinuidad)for(let p of c.erroresContinuidad){let m=p.capitulo;typeof m=="number"&&(p.severidad==="critica"||p.severidad==="cr\xEDtica"||p.severidad==="mayor")&&(t.has(m)||t.set(m,[]),t.get(m).push({source:"continuity_sentinel",type:p.tipo,severity:p.severidad,summary:p.descripcion,correctionHint:p.correccion,evidence:p.contexto}))}}let s=n.filter(u=>u.auditType==="voice_rhythm");for(let u of s){let c=u.findings;if(c?.problemasTono){for(let p of c.problemasTono)if(p.severidad==="mayor"){let m=p.capitulos||[];for(let f of m)typeof f=="number"&&(t.has(f)||t.set(f,[]),t.get(f).push({source:"voice_rhythm_auditor",type:p.tipo,severity:p.severidad,summary:p.descripcion,correctionHint:p.correccion,evidence:p.ejemplo}))}}}let o=n.filter(u=>u.auditType==="semantic_repetition");for(let u of o){let c=u.findings;if(c?.repeticionesSemanticas){for(let p of c.repeticionesSemanticas)if(p.severidad==="mayor"){let m=p.ocurrencias||[];for(let f of m)typeof f=="number"&&(t.has(f)||t.set(f,[]),t.get(f).push({source:"semantic_repetition_detector",type:p.tipo,severity:p.severidad,summary:p.descripcion,correctionHint:`${p.accion}: ${p.ejemplo||""}`,evidence:p.ejemplo}))}}}let i=n.filter(u=>u.auditType==="anachronism");for(let u of i){let c=u.findings;if(c?.anacronismos){for(let p of c.anacronismos)if(p.severidad==="critica"||p.severidad==="cr\xEDtica"||p.severidad==="mayor"){let m=p.capitulo;typeof m=="number"&&(t.has(m)||t.set(m,[]),t.get(m).push({source:"anachronism_detector",type:p.tipo,severity:p.severidad,summary:`${p.problema}: ${p.fragmento}`,correctionHint:p.correccion,evidence:p.fragmento}))}}}return t}collectArchitectProblems(e){let t=[];if(e.analisisTrama){let{huecosArgumentales:n,subplotsSinResolver:a,arcosIncompletos:s}=e.analisisTrama;if(n)for(let o of n)t.push({tipo:"hueco_argumental",severidad:o.severidad||"mayor",descripcion:o.descripcion,capitulosAfectados:o.capitulos||[],accionSugerida:"A\xF1adir escena o di\xE1logo que cierre el hueco l\xF3gico"});if(a)for(let o of a)t.push({tipo:"subplot_sin_resolver",severidad:"mayor",descripcion:o.descripcion||o,capitulosAfectados:o.capitulos||[],accionSugerida:"A\xF1adir resoluci\xF3n para la subtrama"});if(s)for(let o of s)t.push({tipo:"arco_incompleto",severidad:"mayor",descripcion:o.descripcion||o,capitulosAfectados:o.capitulos||[],accionSugerida:"Completar la transformaci\xF3n del personaje"})}if(e.coherenciaMundo){let{contradicciones:n,reglasRotas:a}=e.coherenciaMundo;if(n)for(let s of n)t.push({tipo:"contradiccion",severidad:s.severidad||"critica",descripcion:s.descripcion,capitulosAfectados:s.capitulos||[],accionSugerida:"Corregir la inconsistencia para mantener coherencia"});if(a)for(let s of a)t.push({tipo:"regla_rota",severidad:"mayor",descripcion:s.descripcion||s,capitulosAfectados:s.capitulos||[],accionSugerida:"Ajustar el texto para respetar las reglas del mundo"})}if(e.recomendaciones)for(let n of e.recomendaciones)(n.severidad==="critica"||n.severidad==="mayor")&&t.push({tipo:n.tipo||"recomendacion",severidad:n.severidad,descripcion:n.descripcion,capitulosAfectados:n.capitulosAfectados||[],accionSugerida:n.accionSugerida});return t}async consolidateAllProblems(e,t,n){let a=new Map,s=new Set;if(n){let c=(await b.getReeditProject(n))?.resolvedIssueHashes||[];s=new Set(c),s.size>0&&console.log(`[ReeditOrchestrator] Filtering out ${s.size} already-resolved issues`)}let o=0;for(let u of e){let c=u.capitulosAfectados||u.capitulos||[],p=this.generateIssueHash({categoria:u.tipo||u.categoria||"structural",descripcion:u.descripcion,capitulos_afectados:c.filter(m=>typeof m=="number")});if(s.has(p)){o++;continue}for(let m of c)typeof m=="number"&&(a.has(m)||a.set(m,[]),a.get(m).push({source:"architect",tipo:u.tipo,descripcion:u.descripcion,severidad:u.severidad,accionSugerida:u.accionSugerida}))}let i=0;for(let[u,c]of Array.from(t.entries())){a.has(u)||a.set(u,[]);for(let p of c){let m=this.generateIssueHash({categoria:p.type||p.source||"qa",descripcion:p.summary||p.descripcion,capitulos_afectados:[u]});if(s.has(m)){i++;continue}a.get(u).push({source:p.source,tipo:p.type,descripcion:p.summary,severidad:p.severity,accionSugerida:p.correctionHint})}}for(let[u,c]of Array.from(a.entries()))c.length===0&&a.delete(u);(o>0||i>0)&&console.log(`[ReeditOrchestrator] Skipped ${o} architect + ${i} QA already-resolved issues`),console.log(`[ReeditOrchestrator] Consolidated problems: ${a.size} chapters with issues`);for(let[u,c]of Array.from(a.entries()))console.log(`  - Chapter ${u}: ${c.length} problems (${c.map(p=>p.source).join(", ")})`);return a}setProgressCallback(e){this.progressCallback=e}emitProgress(e){this.progressCallback&&this.progressCallback(e),console.log(`[ReeditOrchestrator] ${e.stage}: ${e.message}`);let t={currentActivity:e.message,currentChapter:e.currentChapter};e.chaptersBeingRewritten!==void 0&&(t.chaptersBeingRewritten=e.chaptersBeingRewritten),e.revisionCycle!==void 0&&(t.revisionCycle=e.revisionCycle),b.updateReeditProject(e.projectId,t).catch(a=>console.error("[ReeditOrchestrator] Failed to update currentActivity:",a));let n=this.getAgentRoleFromStage(e.stage);b.createActivityLog({reeditProjectId:e.projectId,level:"info",agentRole:n,message:e.message}).catch(a=>console.error("[ReeditOrchestrator] Failed to create activity log:",a))}getAgentRoleFromStage(e){return{forensic_audit:"forensic-auditor",beta_reader:"beta-reader",rewriting:"narrative-rewriter",correcting:"smart-editor",reviewing:"final-reviewer",extracting:"orchestrator",analyzing:"orchestrator",starting:"system",completed:"system",error:"system"}[e]||"orchestrator"}async analyzeStructure(e){let t={hasIssues:!1,duplicateChapters:[],outOfOrderChapters:[],missingChapters:[],recommendations:[]},n=[0,998,999],a=e.filter(p=>!n.includes(p.chapterNumber)),s=a.map(p=>p.chapterNumber).sort((p,m)=>p-m),o=e.some(p=>p.chapterNumber===0),i=e.some(p=>p.chapterNumber===998),u=e.some(p=>p.chapterNumber===999);t.hasPrologue=o,t.hasEpilogue=i,t.hasAuthorNote=u,t.totalChapters=e.length,t.regularChapters=a.length;let c=s.length>0?Math.max(...s):0;for(let p=1;p<=c;p++){let m=s.filter(f=>f===p).length;if(m===0)t.missingChapters.push(p),t.hasIssues=!0;else if(m>1){let f=a.filter(g=>g.chapterNumber===p);for(let g=1;g<f.length;g++){let y=this.calculateSimilarity(f[0].originalContent,f[g].originalContent);t.duplicateChapters.push({chapterId:f[g].id,duplicateOf:f[0].id,similarity:y})}t.hasIssues=!0}}for(let p=0;p<e.length-1;p++){let m=e[p],f=e[p+1];m.chapterNumber>f.chapterNumber&&(t.outOfOrderChapters.push({chapterNumber:f.chapterNumber,suggestedPosition:p,reason:`Chapter ${f.chapterNumber} appears after chapter ${m.chapterNumber}`}),t.hasIssues=!0)}return t.duplicateChapters.length>0&&t.recommendations.push(`Found ${t.duplicateChapters.length} duplicate chapter(s). Review and remove duplicates.`),t.outOfOrderChapters.length>0&&t.recommendations.push(`Found ${t.outOfOrderChapters.length} chapter(s) out of order. Reorder before processing.`),t.missingChapters.length>0&&t.recommendations.push(`Missing chapters: ${t.missingChapters.join(", ")}. Verify manuscript completeness.`),t}calculateSimilarity(e,t){let n=e.toLowerCase().split(/\s+/),a=t.toLowerCase().split(/\s+/),s=new Set(n),o=new Set(a),i=0;for(let c of n)o.has(c)&&(i++,o.delete(c));let u=s.size+o.size;return u>0?i/u:0}async processProject(e){let t=await b.getReeditProject(e);if(!t)throw new Error(`Reedit project ${e} not found`);this.totalInputTokens=t.totalInputTokens||0,this.totalOutputTokens=t.totalOutputTokens||0,this.totalThinkingTokens=t.totalThinkingTokens||0,console.log(`[ReeditOrchestrator] Loaded existing tokens: ${this.totalInputTokens} input, ${this.totalOutputTokens} output, ${this.totalThinkingTokens} thinking`);let n=t.finalReviewResult&&(t.finalReviewResult.puntuacion_global!==void 0||t.finalReviewResult.issues?.length>0||t.finalReviewResult.capitulos_para_reescribir?.length>0),a=t.pendingUserInstructions&&t.pendingUserInstructions.trim().length>0,s=t.currentStage==="reviewing",o=(t.consecutiveHighScores||0)>=1,i=t.status==="awaiting_issue_approval",u=t.status==="awaiting_instructions"||i||t.status!=="completed"&&s;if(n&&u||s&&o||i){console.log("[ReeditOrchestrator] FAST-TRACK RESUME: Project has finalReviewResult with issues. Skipping to corrections + final review."),console.log(`  - User instructions: ${a?"YES":"NO"}`),console.log(`  - Previous stage: ${t.currentStage}`),this.emitProgress({projectId:e,stage:"fixing",currentChapter:0,totalChapters:0,message:"Retomando desde correcciones pendientes (salto r\xE1pido)..."}),await this.runFinalReviewOnly(e);return}let c=t.currentStage||"none",p=["none","analyzing","forensic_audit","editing","world_bible","expansion","architect","qa","narrative_rewriting","copyediting","beta_reader","series_thread_fixer","reviewing","completed"],m=p.indexOf(c);m>0&&c!=="completed"&&(console.log(`[ReeditOrchestrator] RESUMING project ${e} from stage: ${c} (index ${m})`),this.emitProgress({projectId:e,stage:c,currentChapter:0,totalChapters:0,message:`Retomando procesamiento desde etapa: ${c}...`}));try{await b.updateReeditProject(e,{status:"processing"});let f=await b.getReeditChaptersByProject(e),g=m>p.indexOf("analyzing"),y=t.structureAnalysis||{duplicateChapters:[],outOfOrderChapters:[],missingChapters:[]};if(g)console.log("[ReeditOrchestrator] Skipping STAGE 1 (analyzing) - already completed");else{this.emitProgress({projectId:e,stage:"analyzing",currentChapter:0,totalChapters:f.length,message:"Analizando estructura del manuscrito..."}),y=await this.analyzeStructure(f),await b.updateReeditProject(e,{currentStage:"analyzing",structureAnalysis:y});for(let ye of y.duplicateChapters)await b.updateReeditChapter(ye.chapterId,{isDuplicate:!0,duplicateOfChapter:ye.duplicateOf,status:"skipped"});for(let ye of y.outOfOrderChapters){let be=f.find(Ue=>Ue.chapterNumber===ye.chapterNumber);be&&await b.updateReeditChapter(be.id,{isOutOfOrder:!0,suggestedOrder:ye.suggestedPosition})}}let C=f.filter(ye=>!y.duplicateChapters?.some(Ue=>Ue.chapterId===ye.id)).sort((ye,be)=>cn(ye.chapterNumber)-cn(be.chapterNumber)),A=t.detectedLanguage||"es",T=[],E=[],d=m>p.indexOf("forensic_audit"),l=t.forensicAuditResult||null;if(d)console.log("[ReeditOrchestrator] Skipping STAGE 1.5 (forensic_audit) - already completed");else{if(await this.checkCancellation(e)){console.log("[ReeditOrchestrator] Processing cancelled before forensic audit");return}this.emitProgress({projectId:e,stage:"forensic_audit",currentChapter:0,totalChapters:C.length,message:"Auditor\xEDa forense de consistencia (detectando errores existentes)..."});let ye=C.map(be=>({chapterNumber:be.chapterNumber,title:be.title||`Cap\xEDtulo ${be.chapterNumber}`,content:be.originalContent}));try{if(!process.env.DEEPSEEK_API_KEY)console.warn("[ReeditOrchestrator] DeepSeek API key not configured - skipping Forensic Audit"),await b.updateReeditProject(e,{currentStage:"forensic_audit",forensicAuditResult:{skipped:!0,reason:"DeepSeek API key not configured",violations:[],entitiesExtracted:{characters:[],locations:[],timeline:[]},consistencyScore:null,summary:"Auditor\xEDa forense omitida: API DeepSeek no configurada"}}),this.emitProgress({projectId:e,stage:"forensic_audit",currentChapter:C.length,totalChapters:C.length,message:"Auditor\xEDa forense omitida: API DeepSeek no configurada"});else{l=await this.forensicAuditor.auditManuscript(ye,t.genre||"general",A),this.trackTokens(l),await b.updateReeditProject(e,{currentStage:"forensic_audit",forensicAuditResult:l});let be=l?.violations?.length||0,Ue=l?.violations?.filter(ie=>ie.severity==="critical")?.length||0;console.log(`[ReeditOrchestrator] Forensic Audit complete: ${be} violations (${Ue} critical), score: ${l?.consistencyScore}/10`),this.emitProgress({projectId:e,stage:"forensic_audit",currentChapter:C.length,totalChapters:C.length,message:`Auditor\xEDa forense: ${be} violaciones detectadas (${Ue} cr\xEDticas) - Puntuaci\xF3n: ${l?.consistencyScore}/10`})}}catch(be){console.error("[ReeditOrchestrator] Forensic Audit failed:",be.message),this.emitProgress({projectId:e,stage:"forensic_audit",currentChapter:C.length,totalChapters:C.length,message:`Auditor\xEDa forense fall\xF3 (continuando sin an\xE1lisis): ${be.message?.substring(0,100)}`})}await this.updateHeartbeat(e)}await b.updateReeditProject(e,{currentStage:"editing"}),await this.updateHeartbeat(e);for(let ye=0;ye<C.length;ye++){if(await this.checkCancellation(e)){console.log(`[ReeditOrchestrator] Processing cancelled at editing stage, chapter ${ye+1}`);return}let be=C[ye];if(be.processingStage!=="none"&&be.processingStage!=="editor"&&be.editorFeedback){console.log(`[ReeditOrchestrator] Skipping chapter ${be.chapterNumber} (already processed in editing stage)`);let ie=be.editorFeedback;E.push(ie),T.push(`Cap\xEDtulo ${be.chapterNumber} (Puntuaci\xF3n: ${be.editorScore||7}/10): resumido`);continue}this.emitProgress({projectId:e,stage:"editing",currentChapter:ye+1,totalChapters:C.length,message:`Cap\xEDtulo ${be.chapterNumber}: Revisi\xF3n editorial...`}),await b.updateReeditChapter(be.id,{status:"analyzing",processingStage:"editor"});let Ue=await this.editorAgent.reviewChapter(be.originalContent,be.chapterNumber,A);this.trackTokens(Ue),await b.updateReeditChapter(be.id,{editorScore:Ue.score||7,editorFeedback:{issues:Ue.issues||[],suggestions:Ue.suggestions||[],strengths:Ue.strengths||[]},narrativeIssues:{pacing:Ue.pacingNotes||""},processingStage:"world_bible"}),E.push(Ue),T.push(`Cap\xEDtulo ${be.chapterNumber} (Puntuaci\xF3n: ${Ue.score||7}/10): ${(Ue.strengths||[]).slice(0,2).join(", ")}`),await b.updateReeditProject(e,{currentChapter:ye+1}),await this.updateHeartbeat(e,be.chapterNumber)}if(await this.checkCancellation(e)){console.log("[ReeditOrchestrator] Processing cancelled before World Bible extraction");return}let h=C.map((ye,be)=>({num:ye.chapterNumber,content:ye.originalContent,feedback:E[be]})),v=await b.getReeditWorldBibleByProject(e),S,R=v?.characters;if(v&&R&&R.length>0?(console.log(`[ReeditOrchestrator] Skipping World Bible extraction (already exists with ${R.length} characters)`),S={personajes:v.characters,ubicaciones:v.locations,timeline:v.timeline,reglasDelMundo:v.loreRules,epocaHistorica:{periodo:v.historicalPeriod,detalles:v.historicalDetails},confianza:v.confidence}):(this.emitProgress({projectId:e,stage:"world_bible",currentChapter:0,totalChapters:C.length,message:"Iniciando extracci\xF3n de Biblia del Mundo..."}),await b.updateReeditProject(e,{currentStage:"world_bible"}),S=await this.worldBibleExtractor.extractWorldBible(h,E,async(ye,be,Ue)=>{let ie=Math.min(ye*10,C.length);this.emitProgress({projectId:e,stage:"world_bible",currentChapter:ie,totalChapters:C.length,message:Ue}),await b.updateReeditProject(e,{processedChapters:ie})}),this.trackTokens(S),await b.createReeditWorldBible({projectId:e,characters:S.personajes||[],locations:S.ubicaciones||[],timeline:S.timeline||[],loreRules:S.reglasDelMundo||[],historicalPeriod:S.epocaHistorica?.periodo||null,historicalDetails:S.epocaHistorica?.detalles||null,extractedFromChapters:C.length,confidence:S.confianza||7})),await this.checkCancellation(e)){console.log("[ReeditOrchestrator] Processing cancelled before expansion stage");return}let x=await b.getReeditProject(e);if(x&&(x.expandChapters||x.insertNewChapters)){await b.updateReeditProject(e,{currentStage:"expansion"});let ye={characters:S.personajes||[],locations:S.ubicaciones||[],timeline:S.timeline||[],rules:S.reglasDelMundo||[]},be=await this.expandManuscript(e,x,C,ye);C.length=0,C.push(...be),await this.updateHeartbeat(e)}let w=C.map((ye,be)=>({num:ye.chapterNumber,content:ye.editedContent||ye.originalContent,feedback:E[be]||{score:7,issues:[],strengths:[]}}));console.log(`[ReeditOrchestrator] Rebuilt chapters for Architect: ${w.length} chapters (includes expansions)`),(x?.expandChapters||x?.insertNewChapters)&&(console.log("[ReeditOrchestrator] Re-analyzing structure after expansion..."),y=await this.analyzeStructure(C),await b.updateReeditProject(e,{structureAnalysis:y,totalChapters:C.length}),console.log(`[ReeditOrchestrator] Structure re-analyzed: ${C.length} chapters, issues: ${y.hasIssues}`));let O=await b.getReeditAuditReportsByProject(e),I=O.some(ye=>ye.auditType==="architect"),_;if(I)console.log("[ReeditOrchestrator] Skipping Architect analysis (already exists)"),_=O.find(be=>be.auditType==="architect")?.findings||{};else{this.emitProgress({projectId:e,stage:"architect",currentChapter:C.length,totalChapters:C.length,message:"Arquitecto analizando estructura y trama..."}),await b.updateReeditProject(e,{currentStage:"architect"});let ye="";if(l&&!l.skipped){let be=l.violations?.slice(0,20).map(Ue=>`- [${Ue.type}] Cap ${Ue.chapter}: ${Ue.description}`).join(`
`)||"";be&&(ye=`
\u26D4 VIOLACIONES DE CONSISTENCIA DETECTADAS POR AUDITOR\xCDA FORENSE:
${be}

Al analizar la arquitectura, TEN EN CUENTA estas violaciones existentes y recomienda correcciones.
`)}_=await this.architectAnalyzer.analyzeArchitecture(S,w,y,ye),this.trackTokens(_),await b.createReeditAuditReport({projectId:e,auditType:"architect",chapterRange:"all",score:Math.round(_.puntuacionArquitectura||7),findings:_,recommendations:_.recomendaciones||[]})}_.bloqueoCritico&&console.log("[ReeditOrchestrator] Critical block detected, continuing with warnings");let N=_.analisisEstructura?.reordenamientoSugerido||[];if(N.length>0&&(this.emitProgress({projectId:e,stage:"architect",currentChapter:C.length,totalChapters:C.length,message:`Reordenando ${N.length} cap\xEDtulos seg\xFAn an\xE1lisis arquitect\xF3nico...`}),C=await this.reorderChaptersFromAnalysis(C,e,N),C=C.sort((ye,be)=>cn(ye.chapterNumber)-cn(be.chapterNumber)),console.log(`[ReeditOrchestrator] Chapters reordered. New order: ${C.map(ye=>ye.chapterNumber).join(", ")}`),await this.updateHeartbeat(e)),await this.checkCancellation(e)){console.log("[ReeditOrchestrator] Processing cancelled before QA stage");return}if(m>p.indexOf("qa"))console.log(`[ReeditOrchestrator] Skipping STAGE 4.5 (QA) - already completed (currentStage: ${c})`),this.emitProgress({projectId:e,stage:"qa",currentChapter:0,totalChapters:0,message:"Saltando etapa QA (ya completada)..."});else{await b.updateReeditProject(e,{currentStage:"qa"}),await b.deleteReeditAuditReportsByType(e,"continuity"),await b.deleteReeditAuditReportsByType(e,"voice_rhythm"),await b.deleteReeditAuditReportsByType(e,"semantic_repetition"),await b.deleteReeditAuditReportsByType(e,"anachronism");let ye=[];for(let ee=0;ee<C.length;ee+=5)ye.push(C.slice(ee,Math.min(ee+5,C.length)));let be=Math.ceil(C.length/10),Ue=ye.length+be+2,ie=0;for(let ee=0;ee<ye.length;ee++){let Le=ye[ee],Ze=Le[0].chapterNumber,De=Le[Le.length-1].chapterNumber;this.emitProgress({projectId:e,stage:"qa",currentChapter:ee+1,totalChapters:ye.length,message:`Centinela de Continuidad: cap\xEDtulos ${Ze}-${De}...`});let nt=await this.continuitySentinel.auditContinuity(Le.map(St=>St.editedContent||St.originalContent),Ze,De);this.trackTokens(nt),await b.createReeditAuditReport({projectId:e,auditType:"continuity",chapterRange:`${Ze}-${De}`,score:Math.round(nt.puntuacion||8),findings:nt,recommendations:nt.erroresContinuidad?.map(St=>St.correccion)||[]}),ie++,await this.updateHeartbeat(e,De)}let ze=[];for(let ee=0;ee<C.length;ee+=10)ze.push(C.slice(ee,Math.min(ee+10,C.length)));for(let ee=0;ee<ze.length;ee++){let Le=ze[ee],Ze=Le[0].chapterNumber,De=Le[Le.length-1].chapterNumber;this.emitProgress({projectId:e,stage:"qa",currentChapter:ee+1,totalChapters:ze.length,message:`Auditor de Voz y Ritmo: cap\xEDtulos ${Ze}-${De}...`});let nt=await this.voiceRhythmAuditor.auditVoiceRhythm(Le.map(St=>St.editedContent||St.originalContent),Ze,De);this.trackTokens(nt),await b.createReeditAuditReport({projectId:e,auditType:"voice_rhythm",chapterRange:`${Ze}-${De}`,score:Math.round(nt.puntuacion||8),findings:nt,recommendations:nt.problemasTono?.map(St=>St.correccion)||[]}),ie++,await this.updateHeartbeat(e,De)}this.emitProgress({projectId:e,stage:"qa",currentChapter:C.length,totalChapters:C.length,message:"Detector de Repetici\xF3n Sem\xE1ntica: manuscrito completo..."});let He=C.map(ee=>`=== CAP\xCDTULO ${ee.chapterNumber}: ${ee.title||""} ===
${ee.editedContent||ee.originalContent}`),ve=await this.semanticRepetitionDetector.detectRepetitions(He,C.length);this.trackTokens(ve),await b.createReeditAuditReport({projectId:e,auditType:"semantic_repetition",chapterRange:"all",score:Math.round(ve.puntuacion||8),findings:ve,recommendations:ve.repeticionesSemanticas?.map(ee=>`${ee.accion}: ${ee.descripcion}`)||[]}),ie++,await this.updateHeartbeat(e,C.length),this.emitProgress({projectId:e,stage:"qa",currentChapter:C.length,totalChapters:C.length,message:"Detector de Anacronismos..."});let ge=await this.anachronismDetector.detectAnachronisms(C.map(ee=>({num:ee.chapterNumber,content:ee.editedContent||ee.originalContent})),"",t.title||"");this.trackTokens(ge),await b.createReeditAuditReport({projectId:e,auditType:"anachronism",chapterRange:"all",score:Math.round(ge.puntuacionHistorica||10),findings:ge,recommendations:ge.anacronismos?.map(ee=>ee.correccion)||[]}),ie++,await this.updateHeartbeat(e,C.length),console.log(`[ReeditOrchestrator] QA stage completed: ${ie}/${Ue} operations`)}let L=m>p.indexOf("narrative_rewriting");L?(console.log(`[ReeditOrchestrator] Skipping STAGE 5 (narrative_rewriting) - already completed (currentStage: ${c})`),this.emitProgress({projectId:e,stage:"narrative_rewriting",currentChapter:0,totalChapters:0,message:"Saltando etapa de reescritura (ya completada)..."})):await b.updateReeditProject(e,{currentStage:"narrative_rewriting"});let j=this.collectArchitectProblems(_),$=await this.collectQaFindings(e),U=await this.consolidateAllProblems(j,$,e),k=await b.getReeditAuditReportByType(e,"narrative_rewrite"),V=k&&k.findings?.chaptersRewritten>0,Q=new Set,te=t.architectInstructions||"";if(U.size>0&&!V&&!L){let ye=Array.from(U.values()).reduce((ge,ee)=>ge+ee.length,0);console.log(`[ReeditOrchestrator] OPTIMIZED: Consolidating ${ye} problems (Architect + QA) in ${U.size} chapters for SINGLE rewriting pass`);let be=t?.chapterChangeHistory||{},Ue=new Map(Object.entries(be).map(([ge,ee])=>[parseInt(ge),ee]));this.emitProgress({projectId:e,stage:"narrative_rewriting",currentChapter:0,totalChapters:U.size,message:`Reescritura consolidada: ${ye} problemas (Arquitecto + QA) en ${U.size} cap\xEDtulos...`}),te&&console.log(`[ReeditOrchestrator] User instructions for rewriting: "${te.substring(0,100)}..."`);let ie=0,ze=[],He=Array.from(U.entries()).sort((ge,ee)=>ge[0]-ee[0]);for(let[ge,ee]of He){if(await this.checkCancellation(e)){console.log("[ReeditOrchestrator] Processing cancelled during narrative rewriting");return}let Le=C.find(nt=>nt.chapterNumber===ge);if(!Le){console.log(`[ReeditOrchestrator] Chapter ${ge} not found for narrative rewriting`);continue}let Ze=ee.filter(nt=>nt.source==="architect").length,De=ee.filter(nt=>nt.source!=="architect").length;this.emitProgress({projectId:e,stage:"narrative_rewriting",currentChapter:ie+1,totalChapters:U.size,message:`Reescribiendo cap\xEDtulo ${ge}: ${ee.length} problemas (${Ze} estructurales, ${De} QA)...`});try{let nt=this.buildAdjacentChapterContext(C,ge),St=Le.editedContent||Le.originalContent,Rr=ee.map((Me,he)=>({id:`${Me.source}-${he+1}`,tipo:Me.tipo||"structural",descripcion:Me.descripcion,severidad:Me.severidad||"mayor",accionSugerida:Me.accionSugerida,fuente:Me.source})),_t=await this.smartCorrectChapter(St,ge,Rr,S,nt,A,te||void 0),Vt=_t.content&&_t.content!==St;if(_t.content&&Vt){let Me=_t.content.split(/\s+/).filter(gt=>gt.length>0).length;await b.updateReeditChapter(Le.id,{originalContent:_t.content,editedContent:_t.content,wordCount:Me,processingStage:"completed"}),Q.add(ge),ze.push({chapter:ge,problemsTotal:ee.length,problemsArchitect:Ze,problemsQA:De,changes:Rr.length,confidence:8,summary:`Correcci\xF3n ${_t.method==="surgical"?"quir\xFArgica":"completa"}`});let he=ee.map(gt=>(gt.descripcion||"").substring(0,300)).join("; "),at=`${_t.method==="surgical"?"Parches quir\xFArgicos":"Reescritura completa"}: ${Rr.length} problemas`,Ct=Ue.get(ge)||[];Ct.push({issue:he,fix:at,timestamp:new Date().toISOString()}),Ct.length>10&&(Ct=Ct.slice(-10)),Ue.set(ge,Ct),await b.updateReeditProject(e,{chapterChangeHistory:Object.fromEntries(Ue)}),await this.updateWorldBibleFromReeditChapter(e,ge,_t.content,ee),console.log(`[ReeditOrchestrator] Chapter ${ge} corrected (${_t.method}): ${Rr.length} problems fixed`)}else console.log(`[ReeditOrchestrator] Chapter ${ge}: No effective changes from consolidated correction`)}catch(nt){console.error(`[ReeditOrchestrator] Error rewriting chapter ${ge}:`,nt)}ie++,await this.updateHeartbeat(e)}await b.createReeditAuditReport({projectId:e,auditType:"narrative_rewrite",chapterRange:"all",score:ze.length>0?Math.round(ze.reduce((ge,ee)=>ge+(ee.confidence||7),0)/ze.length):7,findings:{optimizedPipeline:!0,totalProblemsConsolidated:ye,chaptersRewritten:Q.size,architectProblemsTotal:j.length,qaProblemsTotal:Array.from($.values()).reduce((ge,ee)=>ge+ee.length,0),rewriteResults:ze},recommendations:[]}),console.log(`[ReeditOrchestrator] Consolidated narrative rewriting complete: ${Q.size} chapters updated`);let ve=await b.getReeditChaptersByProject(e);C.length=0,C.push(...ve.filter(ge=>ge.originalContent))}else if(V){let ye=k.findings?.chaptersRewritten||0;if(console.log(`[ReeditOrchestrator] Skipping narrative rewriting (already completed: ${ye} chapters rewritten)`),k?.findings){let be=k.findings?.rewriteResults||[];for(let Ue of be)Ue.chapter&&Q.add(Ue.chapter)}}else console.log("[ReeditOrchestrator] No problems to fix (Architect + QA both clean)");if(await this.checkCancellation(e)){console.log("[ReeditOrchestrator] Processing cancelled before CopyEditor stage");return}if(m>p.indexOf("copyediting"))console.log(`[ReeditOrchestrator] Skipping STAGE 6 (copyediting) - already completed (currentStage: ${c})`),this.emitProgress({projectId:e,stage:"copyediting",currentChapter:0,totalChapters:0,message:"Saltando etapa de correcci\xF3n de estilo (ya completada)..."});else{let ye=C.filter(Ue=>!Q.has(Ue.chapterNumber)),be=C.length-ye.length;console.log(`[ReeditOrchestrator] OPTIMIZED CopyEditor: Processing ${ye.length} chapters (skipping ${be} already rewritten)`),this.emitProgress({projectId:e,stage:"copyediting",currentChapter:0,totalChapters:ye.length,message:`Correcci\xF3n de estilo: ${ye.length} cap\xEDtulos (${be} ya procesados)...`}),await b.updateReeditProject(e,{currentStage:"copyediting"}),await this.updateHeartbeat(e);for(let Ue=0;Ue<ye.length;Ue++){if(await this.checkCancellation(e)){console.log(`[ReeditOrchestrator] Processing cancelled at copyediting stage, chapter ${Ue+1}`);return}let ie=ye[Ue];if(ie.editedContent&&ie.processingStage==="completed"){console.log(`[ReeditOrchestrator] Skipping chapter ${ie.chapterNumber} (already completed)`);continue}this.emitProgress({projectId:e,stage:"copyediting",currentChapter:Ue+1,totalChapters:ye.length,message:`Cap\xEDtulo ${ie.chapterNumber}: Correcci\xF3n de estilo...`}),await b.updateReeditChapter(ie.id,{processingStage:"copyeditor"});let ze=ie.originalContent,He=await this.copyEditorAgent.editChapter(ze,ie.chapterNumber,A);this.trackTokens(He);let ve=He.editedContent||ie.originalContent,ge=ve.split(/\s+/).filter(ee=>ee.length>0).length;await b.updateReeditChapter(ie.id,{editedContent:ve,copyeditorChanges:He.changesLog||"",fluencyImprovements:He.fluencyChanges||[],wordCount:ge,processingStage:"completed"}),await b.updateReeditProject(e,{processedChapters:Q.size+Ue+1}),await this.updateHeartbeat(e,ie.chapterNumber)}console.log(`[ReeditOrchestrator] CopyEditor stage complete: ${ye.length} chapters processed, ${be} skipped (already rewritten)`)}let ae=m>p.indexOf("beta_reader"),D=t.betaReaderReport||null;if(ae)console.log("[ReeditOrchestrator] Skipping STAGE 6.5 (beta_reader) - already completed");else{if(await this.checkCancellation(e)){console.log("[ReeditOrchestrator] Processing cancelled before Beta Reader analysis");return}this.emitProgress({projectId:e,stage:"beta_reader",currentChapter:0,totalChapters:C.length,message:"An\xE1lisis de viabilidad comercial (Lector Beta)..."}),await b.updateReeditProject(e,{currentStage:"beta_reader"});let be=(await b.getReeditChaptersByProject(e)).filter(ve=>ve.editedContent||ve.originalContent).sort((ve,ge)=>cn(ve.chapterNumber)-cn(ge.chapterNumber)),Ue=be.reduce((ve,ge)=>{let ee=ge.editedContent||ge.originalContent;return ve+(ee?.split(/\s+/).length||0)},0),ie=be.map(ve=>ve.summary||""),ze=be[0]?.editedContent||be[0]?.originalContent||"",He=be[be.length-1]?.editedContent||be[be.length-1]?.originalContent||"";try{if(!process.env.DEEPSEEK_API_KEY)console.warn("[ReeditOrchestrator] DeepSeek API key not configured - skipping Beta Reader analysis"),await b.updateReeditProject(e,{currentStage:"beta_reader",betaReaderReport:{skipped:!0,reason:"DeepSeek API key not configured",score:null,viability:null,critique_summary:"An\xE1lisis de lector beta omitido: API DeepSeek no configurada",strengths:[],weaknesses:[],flagged_chapters:[],market_comparison:null},betaReaderScore:null,commercialViability:null}),this.emitProgress({projectId:e,stage:"beta_reader",currentChapter:C.length,totalChapters:C.length,message:"Lector Beta omitido: API DeepSeek no configurada"});else{let ve=await this.betaReader.evaluateNovel(e,t.genre||"general",ie,ze.substring(0,6e3),He.substring(0,6e3));D=ve.report,this.trackTokens({tokenUsage:ve.tokenUsage}),await b.updateReeditProject(e,{currentStage:"beta_reader",betaReaderReport:D,betaReaderScore:D?.score||5,commercialViability:D?.viability||"Medium"}),console.log(`[ReeditOrchestrator] Beta Reader complete: Score ${D?.score}/10, Viability: ${D?.viability}`),this.emitProgress({projectId:e,stage:"beta_reader",currentChapter:C.length,totalChapters:C.length,message:`Lector Beta: Viabilidad ${D?.viability} (${D?.score}/10) - ${D?.flagged_chapters?.length||0} cap\xEDtulos marcados`})}}catch(ve){console.error("[ReeditOrchestrator] Beta Reader failed:",ve.message),this.emitProgress({projectId:e,stage:"beta_reader",currentChapter:C.length,totalChapters:C.length,message:`Lector Beta fall\xF3 (continuando sin an\xE1lisis comercial): ${ve.message?.substring(0,100)}`})}await this.updateHeartbeat(e)}t.seriesId&&(await this.runSeriesThreadFixerForReedit(e,t),await this.updateHeartbeat(e)),await b.updateReeditProject(e,{currentStage:"reviewing"});let J=await b.getReeditProject(e),W=J?.revisionCycle||0,de=J?.consecutiveHighScores||0,ne=J?.previousScores||[],le=J?.nonPerfectFinalReviews||0,oe=J?.pendingUserInstructions||"",ce=null,se=0,Y=[],Ie=15,Je=30,xe=J?.totalReviewCycles||0;W>0&&console.log(`[ReeditOrchestrator] RESUMING Final Review: cycle ${W}, consecutive=${de}, nonPerfect=${le}, scores=[${ne.join(",")}]`),oe&&(console.log(`[ReeditOrchestrator] User instructions received: "${oe.substring(0,100)}..."`),Y.push(`INSTRUCCIONES DEL USUARIO: ${oe}`),await b.updateReeditProject(e,{pendingUserInstructions:null,pauseReason:null}));let xt=await b.getReeditWorldBibleByProject(e),Sr=t.styleGuide||"",Re=t.resolvedIssueHashes||[],ct=4,rt=J?.chapterCorrectionCounts||{},Nt=new Map(Object.entries(rt).map(([ye,be])=>[parseInt(ye),be])),ht=J?.chapterChangeHistory||{},vt=new Map(Object.entries(ht).map(([ye,be])=>[parseInt(ye),be]));console.log(`[ReeditOrchestrator] LOADED change history: ${vt.size} chapters with history. Keys: [${Array.from(vt.keys()).join(", ")}]`);let Se=new Lm;for(;W<this.maxFinalReviewCycles;){if(await this.checkCancellation(e)){console.log(`[ReeditOrchestrator] Cancelled during final review cycle ${W}`);return}if(Re=(await b.getReeditProject(e))?.resolvedIssueHashes||[],xe++,xe>Je){let gt=`Se alcanz\xF3 el l\xEDmite de ${Je} ciclos totales. \xDAltima puntuaci\xF3n: ${Math.round(se)}/10. Por favor, usa "Forzar completado" o proporciona instrucciones.`;console.log(`[ReeditOrchestrator] PAUSING: Total cycle limit reached (${xe})`),await b.updateReeditProject(e,{status:"awaiting_instructions",pauseReason:gt,totalReviewCycles:xe,consecutiveHighScores:de,nonPerfectFinalReviews:le,previousScores:ne,finalReviewResult:ce,bestsellerScore:Math.round(se)}),this.emitProgress({projectId:e,stage:"paused",currentChapter:C.length,totalChapters:C.length,message:gt});return}let be=de>0?` [${de}/${this.requiredConsecutiveHighScores} puntuaciones 10/10 consecutivas]`:"";this.emitProgress({projectId:e,stage:"reviewing",currentChapter:C.length,totalChapters:C.length,message:`Ejecutando revisi\xF3n final COMPLETA... (Ciclo ${W+1}/${this.maxFinalReviewCycles})${be}`,chaptersBeingRewritten:[],revisionCycle:W});let ie=(await b.getReeditChaptersByProject(e)).filter(gt=>gt.editedContent).sort((gt,zn)=>cn(gt.chapterNumber)-cn(zn.chapterNumber)),ze=ie.map(gt=>({numero:gt.chapterNumber,titulo:gt.title||`Cap\xEDtulo ${gt.chapterNumber}`,contenido:gt.editedContent||gt.originalContent})),ve=xt?.threeActStructure||xt?.three_act_structure,ge=await this.fullFinalReviewerAgent.execute({projectTitle:t.title,chapters:ze,worldBible:xt||{},guiaEstilo:Sr,pasadaNumero:W+1,issuesPreviosCorregidos:Y,threeActStructure:ve,onTrancheProgress:(gt,zn,oa)=>{this.emitProgress({projectId:e,stage:"reviewing",currentChapter:ie.length,totalChapters:ie.length,message:`Revisando ${oa}...`})}});this.trackTokens(ge),await this.updateHeartbeat(e),ce=ge.result||null;let ee=ce?.puntuacion_global||7;se=ee,ne.push(ee);let Le=ce?.veredicto||"REQUIERE_REVISION",Ze=ce?.issues||[],De=ce?.capitulos_para_reescribir?.length||0,{newIssues:nt}=this.filterNewIssues(Ze,Re),St=nt.filter(gt=>gt.severidad==="critica"||gt.severidad==="cr\xEDtica"),Rr=St.length>0,_t=nt.length;console.log(`[ReeditOrchestrator] Final review cycle ${W+1}: score ${ee}/10, veredicto: ${Le}, issues: ${_t} (${St.length} cr\xEDticos, ${Ze.length-_t} ya resueltos), chapters to rewrite: ${De}`);let Vt=_t>0||De>0;if(ee>=this.minAcceptableScore&&!Vt)de++,le=0,await b.updateReeditProject(e,{consecutiveHighScores:de}),console.log(`[ReeditOrchestrator] Score ${ee}/10 with NO new issues. Consecutive high scores: ${de} (persisted)`);else if(ee>=this.minAcceptableScore&&Vt)console.log(`[ReeditOrchestrator] Score ${ee}/10 is good but ${_t} issue(s) remain (${St.length} cr\xEDticos). Correcting...`);else if(de=0,le++,await b.updateReeditProject(e,{consecutiveHighScores:0}),le>=Ie){let gt=`${le} evaluaciones sin alcanzar 9+/10. \xDAltima puntuaci\xF3n: ${ee}/10. Issues: ${_t}. Continuando autom\xE1ticamente...`;console.warn(`[ReeditOrchestrator] UNATTENDED: ${le} non-perfect scores reached. Continuing anyway...`),await b.createActivityLog({projectId:e,level:"warning",agentRole:"final-reviewer",message:gt})}if(de>=this.requiredConsecutiveHighScores){let gt=ne.slice(-this.requiredConsecutiveHighScores).join(", ");console.log(`[ReeditOrchestrator] APROBADO: Puntuaciones consecutivas ${gt}/10`),this.emitProgress({projectId:e,stage:"reviewing",currentChapter:C.length,totalChapters:C.length,message:`Manuscrito APROBADO. Puntuaciones consecutivas: ${gt}/10. Calidad bestseller confirmada.`});break}if(se>=this.minAcceptableScore&&de<this.requiredConsecutiveHighScores&&!Vt){this.emitProgress({projectId:e,stage:"reviewing",currentChapter:C.length,totalChapters:C.length,message:`Puntuaci\xF3n ${se}/10. Necesita ${this.requiredConsecutiveHighScores-de} evaluaci\xF3n(es) m\xE1s con 10/10 para confirmar.`}),W++;continue}if(W===this.maxFinalReviewCycles-1){let gt=ne.length>0?(ne.reduce((zn,oa)=>zn+oa,0)/ne.length).toFixed(1):se;console.log(`[ReeditOrchestrator] L\xEDmite de ciclos locales alcanzado. Puntuaci\xF3n: ${se}/10 (promedio: ${gt}). Total ejecutados: ${xe}`)}this.emitProgress({projectId:e,stage:"reviewing",currentChapter:C.length,totalChapters:C.length,message:`Puntuaci\xF3n ${se}/10 insuficiente. Corrigiendo ${De} cap\xEDtulo(s) con ${_t} issue(s)...`});let Me=ce?.issues||[],he=ce?.capitulos_para_reescribir||[],{newIssues:at,filteredCount:Ct}=this.filterNewIssues(Me,Re);if(Ct>0&&console.log(`[ReeditOrchestrator] ${Ct} issues ya resueltos fueron filtrados, quedan ${at.length} nuevos`),at.length>0||he.length>0){console.log(`[ReeditOrchestrator] AUTONOMOUS: ${at.length} issues + ${he.length} chapters detected, correcting automatically (cycle ${W+1}/${this.maxFinalReviewCycles})`);let gt=new Set(he);for(let Fe of at)if(Fe.capitulos_afectados)for(let et of Fe.capitulos_afectados)gt.add(et);let oa=(await b.getReeditChaptersByProject(e)).filter(Fe=>Fe.editedContent),st=oa.filter(Fe=>gt.has(Fe.chapterNumber)).filter(Fe=>{let et=Nt.get(Fe.chapterNumber)||0;return et>=ct?(console.log(`[ReeditOrchestrator] Skipping chapter ${Fe.chapterNumber}: already corrected ${et} times (max: ${ct})`),!1):!0});if(st.length===0&&gt.size>0){let et=`Los cap\xEDtulos ${Array.from(gt).join(", ")} han sido corregidos ${ct} veces sin resolver los problemas detectados. Por favor, revisa manualmente estos cap\xEDtulos o proporciona instrucciones espec\xEDficas para continuar.`;console.log(`[ReeditOrchestrator] PAUSING: All ${gt.size} chapters have reached max corrections`),await b.updateReeditProject(e,{status:"awaiting_instructions",currentStage:"reviewing",pauseReason:et,chapterCorrectionCounts:Object.fromEntries(Nt)}),this.emitProgress({projectId:e,stage:"paused",currentChapter:0,totalChapters:C.length,message:et});return}for(let Fe=0;Fe<st.length;Fe++){if(await this.checkCancellation(e)){console.log(`[ReeditOrchestrator] Cancelled during chapter correction ${Fe+1}/${st.length}`);return}let et=st[Fe],Or=at.filter(kr=>kr.capitulos_afectados?.includes(et.chapterNumber)),go=vt.get(et.chapterNumber)||[];if(console.log(`[ReeditOrchestrator] Chapter ${et.chapterNumber} - History entries: ${go.length}, Issues to validate: ${Or.length}`),go.length>0&&Or.length>0){let kr=[];for(let Hn of Or)try{let Mt=await Se.validateResolution({tipo:Hn.categoria||"otro",descripcion:Hn.descripcion,severidad:Hn.severidad},go,et.chapterNumber);Mt.isResolved&&Mt.confidence>=.7?(console.log(`[ReeditOrchestrator] Issue already resolved (confidence: ${Mt.confidence}): ${Hn.descripcion.substring(0,80)}...`),await this.markIssuesResolved(e,[Hn])):kr.push(Hn)}catch{kr.push(Hn)}kr.length<Or.length&&console.log(`[ReeditOrchestrator] Chapter ${et.chapterNumber}: ${Or.length-kr.length} issues validated as already resolved`),Or=kr}if(!(Or.length===0&&!he.includes(et.chapterNumber))){this.emitProgress({projectId:e,stage:"fixing",currentChapter:et.chapterNumber,totalChapters:st.length,message:`Corrigiendo cap\xEDtulo ${et.chapterNumber} (${Fe+1}/${st.length}): ${Or.length} problema(s) a resolver...`,chaptersBeingRewritten:st.map(kr=>kr.chapterNumber),revisionCycle:W});try{let kr=Nt.get(et.chapterNumber)||0;kr>0&&console.log(`[ReeditOrchestrator] Chapter ${et.chapterNumber}: RETRY ATTEMPT ${kr+1} - using aggressive instructions`);let Mt=Or.map((Jr,Ns)=>({id:`issue-${Ns}`,tipo:Jr.categoria||"otro",descripcion:Jr.descripcion,severidad:Jr.severidad||"media",accionSugerida:Gq(Jr.instrucciones_correccion||"Corregir seg\xFAn indicaci\xF3n",kr)})),Dt=oa.find(Jr=>Jr.chapterNumber===et.chapterNumber-1),pr=oa.find(Jr=>Jr.chapterNumber===et.chapterNumber+1),Oa={previousChapter:Dt?.editedContent?.substring(0,2e3),nextChapter:pr?.editedContent?.substring(0,2e3)},hi=et.editedContent||et.originalContent,Cn=await this.smartCorrectChapter(hi,et.chapterNumber,Mt,xt||{},Oa,"espa\xF1ol",oe||void 0);if(await this.updateHeartbeat(e),Cn.content){let Jr=Cn.content.split(/\s+/).filter(Na=>Na.length>0).length;await b.updateReeditChapter(et.id,{editedContent:Cn.content,wordCount:Jr});let Ns=ie.findIndex(Na=>Na.chapterNumber===et.chapterNumber);Ns!==-1&&(ie[Ns].editedContent=Cn.content);let ia=Nt.get(et.chapterNumber)||0;Nt.set(et.chapterNumber,ia+1),console.log(`[ReeditOrchestrator] Chapter ${et.chapterNumber} corrected via ${Cn.method} (count: ${ia+1}/${ct})`),this.emitProgress({projectId:e,stage:"fixing",currentChapter:et.chapterNumber,totalChapters:st.length,message:`Capitulo ${et.chapterNumber} corregido (${Fe+1}/${st.length}) - ${Or.length} problema(s) resuelto(s)`,chaptersBeingRewritten:st.slice(Fe+1).map(Na=>Na.chapterNumber),revisionCycle:W});let Ke=Or.map(Na=>Na.descripcion.substring(0,300)).join("; "),Rb=`Correcci\xF3n ${Cn.method==="surgical"?"quir\xFArgica":"completa"}: ${Mt.length} problemas`,yo=vt.get(et.chapterNumber)||[];yo.push({issue:Ke,fix:Rb,timestamp:new Date().toISOString()}),yo.length>10&&(yo=yo.slice(-10)),vt.set(et.chapterNumber,yo),console.log(`[ReeditOrchestrator] SAVED history for chapter ${et.chapterNumber}: now has ${yo.length} entries`);let Wm=Object.fromEntries(Nt),Qm=Object.fromEntries(vt);console.log(`[ReeditOrchestrator] PERSISTING to DB - Counts: ${JSON.stringify(Wm)}, History keys: ${Object.keys(Qm).join(", ")}`),await b.updateReeditProject(e,{chapterCorrectionCounts:Wm,chapterChangeHistory:Qm}),await this.updateWorldBibleFromReeditChapter(e,et.chapterNumber,Cn.content,Or);for(let Na of Or)Y.push(Na.descripcion);await this.markIssuesResolved(e,Or)}else{console.error(`[ReeditOrchestrator] CRITICAL: Chapter ${et.chapterNumber} correction FAILED - both surgical patches and full rewrite returned null`);let Jr=Nt.get(et.chapterNumber)||0;Nt.set(et.chapterNumber,Jr+1),this.emitProgress({projectId:e,stage:"fixing",currentChapter:et.chapterNumber,totalChapters:st.length,message:`ERROR: Capitulo ${et.chapterNumber} no pudo corregirse - se reintentar\xE1 en el siguiente ciclo`,chaptersBeingRewritten:st.slice(Fe+1).map(ia=>ia.chapterNumber),revisionCycle:W});let Ns=Object.fromEntries(Nt);await b.updateReeditProject(e,{chapterCorrectionCounts:Ns})}}catch(kr){console.error(`[ReeditOrchestrator] Error fixing chapter ${et.chapterNumber}:`,kr)}}}}console.log(`[ReeditOrchestrator] Corrections complete. Continuing to next review cycle (${W+1}/${this.maxFinalReviewCycles})...`),this.emitProgress({projectId:e,stage:"reviewing",currentChapter:C.length,totalChapters:C.length,message:`Correcciones aplicadas. Iniciando nueva revisi\xF3n (ciclo ${W+1})...`,chaptersBeingRewritten:[],revisionCycle:W}),W++,await b.updateReeditProject(e,{revisionCycle:W,totalReviewCycles:xe,consecutiveHighScores:de,nonPerfectFinalReviews:le,previousScores:ne,finalReviewResult:ce,chaptersBeingRewritten:[]})}if(de<this.requiredConsecutiveHighScores){let ye=ce?.problemas_detectados||ce?.issues||[],be=ye.filter(He=>He.severidad==="critico"||He.severidad==="mayor"),Ue=this.analyzeRecurrentIssues(ye),ie="";if(ne.length>=3){let He=ne.slice(-3),ve=He.reduce((ee,Le)=>ee+Le,0)/He.length;He.every(ee=>Math.abs(ee-ve)<.5)&&(ie+=`

\u{1F4CA} DIAGN\xD3STICO: La puntuaci\xF3n est\xE1 estancada (${He.map(ee=>ee.toFixed(1)).join(" \u2192 ")}). Las correcciones autom\xE1ticas no est\xE1n resolviendo los problemas fundamentales.`)}be.length>0&&(ie+=`

\u{1F6A8} PROBLEMAS BLOQUEANTES (${be.length}):`,be.slice(0,5).forEach((He,ve)=>{let ge=Array.isArray(He.capitulos_afectados)?He.capitulos_afectados.slice(0,3).join(", ")+(He.capitulos_afectados.length>3?"...":""):He.capitulos_afectados||"varios";ie+=`
  ${ve+1}. [${He.categoria}] ${He.descripcion?.slice(0,100)}... (Cap. ${ge})`})),Ue.length>0&&(ie+=`

\u{1F504} CATEGOR\xCDAS RECURRENTES: ${Ue.join(", ")}`,ie+=`
   Estas categor\xEDas aparecen repetidamente, sugiriendo un problema estructural que requiere intervenci\xF3n manual.`);let ze=`Proceso alcanz\xF3 ${W} ciclos sin 2 puntuaciones consecutivas de 9+/10. Completando con puntuaci\xF3n ${Math.round(se)}/10.${ie}`;console.warn(`[ReeditOrchestrator] UNATTENDED: Max cycles reached without achieving consecutive 9+ scores. Completing with score: ${se}/10`),await b.createActivityLog({projectId:e,level:"warning",agentRole:"final-reviewer",message:ze})}for(let ye of C)await b.updateReeditChapter(ye.id,{status:"completed",processingStage:"completed"});await b.createReeditAuditReport({projectId:e,auditType:"final_review",chapterRange:"all",score:Math.round(se),findings:ce,recommendations:ce?.justificacion_puntuacion?.recomendaciones_proceso||[]});let ue=(await b.getReeditChaptersByProject(e)).filter(ye=>ye.editedContent).reduce((ye,be)=>ye+(be.wordCount||0),0),Pe=Math.round(se);await b.updateReeditProject(e,{currentStage:"completed",status:"completed",bestsellerScore:Pe,finalReviewResult:ce,totalWordCount:ue,totalInputTokens:this.totalInputTokens,totalOutputTokens:this.totalOutputTokens,totalThinkingTokens:this.totalThinkingTokens}),console.log(`[ReeditOrchestrator] Token usage: ${this.totalInputTokens} input, ${this.totalOutputTokens} output, ${this.totalThinkingTokens} thinking`);let qt=de>=this.requiredConsecutiveHighScores?`Reedici\xF3n completa. Puntuaci\xF3n bestseller: ${Pe}/10 (confirmado ${this.requiredConsecutiveHighScores}x consecutivas)`:`Reedici\xF3n completa. Puntuaci\xF3n bestseller: ${Pe}/10`;this.emitProgress({projectId:e,stage:"completed",currentChapter:C.length,totalChapters:C.length,message:qt})}catch(f){throw console.error(`[ReeditOrchestrator] Error processing project ${e}:`,f),await b.updateReeditProject(e,{status:"error",errorMessage:f instanceof Error?f.message:"Unknown error",totalInputTokens:this.totalInputTokens,totalOutputTokens:this.totalOutputTokens,totalThinkingTokens:this.totalThinkingTokens}),f}}async runFinalReviewOnly(e){console.log(`[ReeditOrchestrator] Running FULL final review only for project ${e}`);let t=await b.getReeditProject(e);if(!t)throw new Error(`Project ${e} not found`);this.totalInputTokens=t.totalInputTokens||0,this.totalOutputTokens=t.totalOutputTokens||0,this.totalThinkingTokens=t.totalThinkingTokens||0,await b.updateReeditProject(e,{status:"processing",currentStage:"reviewing",errorMessage:null});let a=(await b.getReeditChaptersByProject(e)).filter(I=>I.editedContent).sort((I,_)=>cn(I.chapterNumber)-cn(_.chapterNumber)),s=await b.getReeditWorldBibleByProject(e),o=t.styleGuide||"",i=0,u=t.consecutiveHighScores||0;console.log(`[ReeditOrchestrator] Starting with ${u} consecutive high score(s) from previous session`);let c=[],p=null,m=0,f=[],g=30,y=t.totalReviewCycles||0,C=t.pendingUserInstructions||"";C&&(console.log(`[ReeditOrchestrator] User instructions found: "${C.substring(0,100)}..."`),f.push(`INSTRUCCIONES DEL USUARIO: ${C}`));let A=t.finalReviewResult,T=A?.issues?.length>0||A?.capitulos_para_reescribir?.length>0;u>=1&&!T?console.log("[ReeditOrchestrator] Previous review was 10/10 with no issues. Proceeding directly to confirmation review."):T&&(console.log("[ReeditOrchestrator] Issues to fix detected. Will apply corrections in main loop with proper limits."),C&&(await b.updateReeditProject(e,{pendingUserInstructions:null,pauseReason:null}),console.log("[ReeditOrchestrator] User instructions cleared (will be applied in main correction loop)")));let d=t.resolvedIssueHashes||[],l=4,h=t?.chapterCorrectionCounts||{},v=new Map(Object.entries(h).map(([I,_])=>[parseInt(I),_])),S=t?.chapterChangeHistory||{},R=new Map(Object.entries(S).map(([I,_])=>[parseInt(I),_]));console.log(`[ReeditOrchestrator] FRO LOADED change history: ${R.size} chapters with history. Keys: [${Array.from(R.keys()).join(", ")}]`);let x=new Lm;for(;i<this.maxFinalReviewCycles;){if(await this.checkCancellation(e)){console.log(`[ReeditOrchestrator] Cancelled during final review cycle ${i}`);return}if(d=(await b.getReeditProject(e))?.resolvedIssueHashes||[],y++,y>g){let le=`Se alcanz\xF3 el l\xEDmite de ${g} ciclos totales. \xDAltima puntuaci\xF3n: ${Math.round(m)}/10. Por favor, usa "Forzar completado" o proporciona instrucciones.`;console.log(`[ReeditOrchestrator] PAUSING: Total cycle limit reached (${y})`),await b.updateReeditProject(e,{status:"awaiting_instructions",pauseReason:le,totalReviewCycles:y,consecutiveHighScores:u,finalReviewResult:p,bestsellerScore:Math.round(m)}),this.emitProgress({projectId:e,stage:"paused",currentChapter:a.length,totalChapters:a.length,message:le});return}let _=u>0?` [${u}/${this.requiredConsecutiveHighScores} puntuaciones 10/10 consecutivas]`:"";this.emitProgress({projectId:e,stage:"reviewing",currentChapter:a.length,totalChapters:a.length,message:`Re-ejecutando revisi\xF3n final COMPLETA... (Ciclo ${i+1}/${this.maxFinalReviewCycles})${_}`});let N=a.map(le=>({numero:le.chapterNumber,titulo:le.title||`Cap\xEDtulo ${le.chapterNumber}`,contenido:le.editedContent||le.originalContent})),L=s?.threeActStructure||s?.three_act_structure,j=await this.fullFinalReviewerAgent.execute({projectTitle:t.title,chapters:N,worldBible:s||{},guiaEstilo:o,pasadaNumero:i+1,issuesPreviosCorregidos:f,userInstructions:C||void 0,threeActStructure:L,onTrancheProgress:(le,oe,ce)=>{this.emitProgress({projectId:e,stage:"reviewing",currentChapter:a.length,totalChapters:a.length,message:`Revisando ${ce}...`})}});this.trackTokens(j),await this.updateHeartbeat(e),p=j.result||null;let $=p?.puntuacion_global||7;m=$,c.push($);let U=p?.veredicto||"REQUIERE_REVISION",k=p?.issues||[],V=p?.capitulos_para_reescribir?.length||0,{newIssues:Q}=this.filterNewIssues(k,d),te=Q.filter(le=>le.severidad==="critica"||le.severidad==="cr\xEDtica"),F=te.length>0,ae=Q.length;console.log(`[ReeditOrchestrator] Final review cycle ${i+1}: score ${$}/10, veredicto: ${U}, issues: ${ae} (${te.length} cr\xEDticos, ${k.length-ae} ya resueltos), chapters to rewrite: ${V}`);let D=ae>0||V>0;if($>=this.minAcceptableScore&&!D?(u++,await b.updateReeditProject(e,{consecutiveHighScores:u}),console.log(`[ReeditOrchestrator] FRO: Score ${$}/10 with NO new issues. Consecutive high scores: ${u} (persisted)`)):$>=this.minAcceptableScore&&D?console.log(`[ReeditOrchestrator] FRO: Score ${$}/10 is good but ${ae} issue(s) remain (${te.length} cr\xEDticos). Correcting...`):(u=0,await b.updateReeditProject(e,{consecutiveHighScores:0})),u>=this.requiredConsecutiveHighScores){let le=c.slice(-this.requiredConsecutiveHighScores).join(", ");console.log(`[ReeditOrchestrator] APROBADO: Puntuaciones consecutivas ${le}/10`),this.emitProgress({projectId:e,stage:"reviewing",currentChapter:a.length,totalChapters:a.length,message:`Manuscrito APROBADO. Puntuaciones consecutivas: ${le}/10. Calidad bestseller confirmada.`});break}if(m>=this.minAcceptableScore&&u<this.requiredConsecutiveHighScores&&!D){this.emitProgress({projectId:e,stage:"reviewing",currentChapter:a.length,totalChapters:a.length,message:`Puntuaci\xF3n ${m}/10. Necesita ${this.requiredConsecutiveHighScores-u} evaluaci\xF3n(es) m\xE1s con 10/10 para confirmar.`}),i++;continue}if(i===this.maxFinalReviewCycles-1){let le=c.length>0?(c.reduce((oe,ce)=>oe+ce,0)/c.length).toFixed(1):m;console.log(`[ReeditOrchestrator] L\xEDmite de ciclos locales alcanzado. Puntuaci\xF3n: ${m}/10 (promedio: ${le}). Total: ${y}`)}this.emitProgress({projectId:e,stage:"reviewing",currentChapter:a.length,totalChapters:a.length,message:`Puntuaci\xF3n ${m}/10 insuficiente. Corrigiendo ${V} cap\xEDtulo(s) con ${ae} issue(s)...`});let J=p?.issues||[],W=p?.capitulos_para_reescribir||[],{newIssues:de,filteredCount:ne}=this.filterNewIssues(J,d);if(ne>0&&console.log(`[ReeditOrchestrator] FRO: ${ne} issues ya resueltos fueron filtrados, quedan ${de.length} nuevos`),de.length>0||W.length>0){console.log(`[ReeditOrchestrator] FRO AUTONOMOUS: ${de.length} issues detected, correcting automatically (cycle ${i+1}/${this.maxFinalReviewCycles})`);let le=new Set(W);for(let se of de)if(se.capitulos_afectados)for(let Y of se.capitulos_afectados)le.add(Y);let oe=a.filter(se=>le.has(se.chapterNumber)).filter(se=>{let Y=v.get(se.chapterNumber)||0;return Y>=l?(console.log(`[ReeditOrchestrator] FRO: Skipping chapter ${se.chapterNumber}: already corrected ${Y} times (max: ${l})`),!1):!0});if(oe.length===0&&le.size>0){let Y=`Los cap\xEDtulos ${Array.from(le).join(", ")} han sido corregidos ${l} veces sin resolver los problemas detectados. Por favor, revisa manualmente estos cap\xEDtulos o proporciona instrucciones espec\xEDficas para continuar.`;console.log(`[ReeditOrchestrator] FRO PAUSING: All ${le.size} chapters have reached max corrections`),await b.updateReeditProject(e,{status:"awaiting_instructions",currentStage:"reviewing",pauseReason:Y,chapterCorrectionCounts:Object.fromEntries(v)}),this.emitProgress({projectId:e,stage:"paused",currentChapter:0,totalChapters:a.length,message:Y});return}for(let se=0;se<oe.length;se++){if(await this.checkCancellation(e)){console.log(`[ReeditOrchestrator] Cancelled during chapter correction (FRO) ${se+1}/${oe.length}`);return}let Y=oe[se],Ie=de.filter(xe=>xe.capitulos_afectados?.includes(Y.chapterNumber)),Je=R.get(Y.chapterNumber)||[];if(console.log(`[ReeditOrchestrator] FRO Chapter ${Y.chapterNumber} - History entries: ${Je.length}, Issues to validate: ${Ie.length}`),Je.length>0&&Ie.length>0){let xe=[];for(let xt of Ie)try{let Sr=await x.validateResolution({tipo:xt.categoria||"otro",descripcion:xt.descripcion,severidad:xt.severidad},Je,Y.chapterNumber);Sr.isResolved&&Sr.confidence>=.7?(console.log(`[ReeditOrchestrator] FRO: Issue already resolved (confidence: ${Sr.confidence}): ${xt.descripcion.substring(0,80)}...`),await this.markIssuesResolved(e,[xt])):xe.push(xt)}catch{xe.push(xt)}xe.length<Ie.length&&console.log(`[ReeditOrchestrator] FRO: Chapter ${Y.chapterNumber}: ${Ie.length-xe.length} issues validated as already resolved`),Ie=xe}if(!(Ie.length===0&&!W.includes(Y.chapterNumber))){this.emitProgress({projectId:e,stage:"fixing",currentChapter:Y.chapterNumber,totalChapters:oe.length,message:`Corrigiendo cap\xEDtulo ${Y.chapterNumber} (${se+1}/${oe.length}): ${Ie.length} problema(s) a resolver...`,chaptersBeingRewritten:oe.map(xe=>xe.chapterNumber),revisionCycle:i});try{let xe=v.get(Y.chapterNumber)||0;xe>0&&console.log(`[ReeditOrchestrator] FRO Chapter ${Y.chapterNumber}: RETRY ATTEMPT ${xe+1} - using aggressive instructions`);let Sr=Ie.map((vt,Se)=>({id:`issue-${Se}`,tipo:vt.categoria||"otro",descripcion:vt.descripcion,severidad:vt.severidad||"media",accionSugerida:Gq(vt.instrucciones_correccion||"Corregir seg\xFAn indicaci\xF3n",xe)})),Re=a.find(vt=>vt.chapterNumber===Y.chapterNumber-1),ct=a.find(vt=>vt.chapterNumber===Y.chapterNumber+1),rt={previousChapter:Re?.editedContent?.substring(0,2e3),nextChapter:ct?.editedContent?.substring(0,2e3)},Nt=Y.editedContent||Y.originalContent,ht=await this.smartCorrectChapter(Nt,Y.chapterNumber,Sr,s||{},rt,"espa\xF1ol",C||void 0);if(await this.updateHeartbeat(e),console.log(`[ReeditOrchestrator] FRO correction result for chapter ${Y.chapterNumber}: method=${ht.method}, has content=${!!ht.content}`),ht.content){let vt=ht.content.split(/\s+/).filter(Ue=>Ue.length>0).length;await b.updateReeditChapter(Y.id,{editedContent:ht.content,wordCount:vt});let Se=a.findIndex(Ue=>Ue.chapterNumber===Y.chapterNumber);Se!==-1&&(a[Se].editedContent=ht.content);let Tt=v.get(Y.chapterNumber)||0;v.set(Y.chapterNumber,Tt+1),console.log(`[ReeditOrchestrator] FRO: Chapter ${Y.chapterNumber} corrected via ${ht.method} (count: ${Tt+1}/${l})`),this.emitProgress({projectId:e,stage:"fixing",currentChapter:Y.chapterNumber,totalChapters:oe.length,message:`Capitulo ${Y.chapterNumber} corregido (${se+1}/${oe.length}) - ${Ie.length} problema(s) resuelto(s)`,chaptersBeingRewritten:oe.slice(se+1).map(Ue=>Ue.chapterNumber),revisionCycle:i});let ue=Ie.map(Ue=>Ue.descripcion.substring(0,300)).join("; "),Pe=`Correcci\xF3n ${ht.method==="surgical"?"quir\xFArgica":"completa"}: ${Sr.length} problemas`,qt=R.get(Y.chapterNumber)||[];qt.push({issue:ue,fix:Pe,timestamp:new Date().toISOString()}),qt.length>10&&(qt=qt.slice(-10)),R.set(Y.chapterNumber,qt),console.log(`[ReeditOrchestrator] FRO SAVED history for chapter ${Y.chapterNumber}: now has ${qt.length} entries`);let ye=Object.fromEntries(v),be=Object.fromEntries(R);console.log(`[ReeditOrchestrator] FRO PERSISTING to DB - Counts: ${JSON.stringify(ye)}, History keys: ${Object.keys(be).join(", ")}`),await b.updateReeditProject(e,{chapterCorrectionCounts:ye,chapterChangeHistory:be}),await this.updateWorldBibleFromReeditChapter(e,Y.chapterNumber,ht.content,Ie),await this.markIssuesResolved(e,Ie);for(let Ue of Ie)f.push(Ue.descripcion)}else{console.error(`[ReeditOrchestrator] FRO CRITICAL: Chapter ${Y.chapterNumber} correction FAILED - both surgical patches and full rewrite returned null`);let vt=v.get(Y.chapterNumber)||0;v.set(Y.chapterNumber,vt+1),this.emitProgress({projectId:e,stage:"fixing",currentChapter:Y.chapterNumber,totalChapters:oe.length,message:`ERROR: Capitulo ${Y.chapterNumber} no pudo corregirse - se reintentar\xE1 en el siguiente ciclo`,chaptersBeingRewritten:[],revisionCycle:i});let Se=Object.fromEntries(v);await b.updateReeditProject(e,{chapterCorrectionCounts:Se})}}catch(xe){console.error(`[ReeditOrchestrator] Error fixing chapter ${Y.chapterNumber}:`,xe)}}}a=(await b.getReeditChaptersByProject(e)).filter(se=>se.editedContent).sort((se,Y)=>cn(se.chapterNumber)-cn(Y.chapterNumber))}console.log(`[ReeditOrchestrator] FRO: Corrections complete. Continuing to next review cycle (${i+1}/${this.maxFinalReviewCycles})...`),this.emitProgress({projectId:e,stage:"reviewing",currentChapter:a.length,totalChapters:a.length,message:`Correcciones aplicadas. Iniciando nueva revisi\xF3n (ciclo ${i+1})...`,chaptersBeingRewritten:[],revisionCycle:i}),i++,await b.updateReeditProject(e,{revisionCycle:i,consecutiveHighScores:u,previousScores:c,finalReviewResult:p,chaptersBeingRewritten:[]})}if(u<this.requiredConsecutiveHighScores){let I=p?.problemas_detectados||p?.issues||[],_=I.filter(j=>j.severidad==="critico"||j.severidad==="mayor"),N=this.analyzeRecurrentIssues(I),P="";if(c.length>=3){let j=c.slice(-3),$=j.reduce((k,V)=>k+V,0)/j.length;j.every(k=>Math.abs(k-$)<.5)&&(P+=`

\u{1F4CA} DIAGN\xD3STICO: La puntuaci\xF3n est\xE1 estancada (${j.map(k=>k.toFixed(1)).join(" \u2192 ")}). Las correcciones autom\xE1ticas no est\xE1n resolviendo los problemas fundamentales.`)}_.length>0&&(P+=`

\u{1F6A8} PROBLEMAS BLOQUEANTES (${_.length}):`,_.slice(0,5).forEach((j,$)=>{let U=Array.isArray(j.capitulos_afectados)?j.capitulos_afectados.slice(0,3).join(", ")+(j.capitulos_afectados.length>3?"...":""):j.capitulos_afectados||"varios";P+=`
  ${$+1}. [${j.categoria}] ${j.descripcion?.slice(0,100)}... (Cap. ${U})`})),N.length>0&&(P+=`

\u{1F504} CATEGOR\xCDAS RECURRENTES: ${N.join(", ")}`,P+=`
   Estas categor\xEDas aparecen repetidamente, sugiriendo un problema estructural que requiere intervenci\xF3n manual.`);let L=`FRO: Proceso alcanz\xF3 ${i} ciclos sin 2 puntuaciones consecutivas de 9+/10. Completando con puntuaci\xF3n ${Math.round(m)}/10.${P}`;console.warn(`[ReeditOrchestrator] UNATTENDED (FRO): Max cycles reached without achieving consecutive 9+ scores. Completing with score: ${m}/10`),await b.createActivityLog({projectId:e,level:"warning",agentRole:"final-reviewer",message:L})}await b.createReeditAuditReport({projectId:e,auditType:"final_review",chapterRange:"all",score:Math.round(m),findings:p,recommendations:p?.justificacion_puntuacion?.recomendaciones_proceso||[]});let w=a.reduce((I,_)=>I+(_.wordCount||0),0);await b.updateReeditProject(e,{currentStage:"completed",status:"completed",bestsellerScore:Math.round(m),finalReviewResult:p,totalWordCount:w,totalInputTokens:this.totalInputTokens,totalOutputTokens:this.totalOutputTokens,totalThinkingTokens:this.totalThinkingTokens});let O=`Revisi\xF3n final completa. Puntuaci\xF3n bestseller: ${Math.round(m)}/10 (confirmado ${this.requiredConsecutiveHighScores}x consecutivas)`;this.emitProgress({projectId:e,stage:"completed",currentChapter:a.length,totalChapters:a.length,message:O}),console.log(`[ReeditOrchestrator] Full final review completed for project ${e}: ${m}/10`)}async runSeriesThreadFixerForReedit(e,t){let n=t.seriesId,a=t.seriesOrder;if(n){this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:0,totalChapters:0,message:"Analizando hilos y hitos de la serie..."}),console.log(`[ReeditOrchestrator] Running SeriesThreadFixer for reedit project ${e} in series ${n}`);try{let s=await b.getSeries(n);if(!s){console.log(`[ReeditOrchestrator] Series ${n} not found, skipping thread fixer`),this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:0,totalChapters:0,message:"Serie no encontrada, omitiendo analisis de hilos"});return}let o=await b.getMilestonesBySeries(n),i=await b.getPlotThreadsBySeries(n);if(o.length===0&&i.length===0){console.log("[ReeditOrchestrator] No milestones or plot threads defined for series, skipping thread fixer"),this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:0,totalChapters:0,message:"Sin hilos/hitos definidos en la serie"});return}let c=(await b.getReeditChaptersByProject(e)).filter(y=>y.editedContent&&y.editedContent.length>100).map(y=>({id:y.id,chapterNumber:y.chapterNumber,title:y.title||`Capitulo ${y.chapterNumber}`,content:y.editedContent||""}));if(c.length===0){console.log("[ReeditOrchestrator] No chapters with edited content found, skipping thread fixer"),this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:0,totalChapters:0,message:"Sin capitulos con contenido editado"});return}let p=await b.getReeditWorldBibleByProject(e),m;if(a&&a>1){let C=(await b.getProjectsBySeries(n)).filter(A=>A.seriesOrder&&A.seriesOrder<a&&A.status==="completed").sort((A,T)=>(A.seriesOrder||0)-(T.seriesOrder||0));if(C.length>0){let A=[];for(let T of C){let E=await b.getWorldBibleByProject(T.id);if(E&&E.characters){let d=Array.isArray(E.characters)?E.characters:[];A.push(`Libro ${T.seriesOrder}: ${T.title} - Personajes: ${d.slice(0,5).map(l=>l.name||l).join(", ")}`)}}m=A.join(`
`)}}let f=await this.seriesThreadFixer.execute({projectTitle:t.title,seriesTitle:s.title,volumeNumber:a||1,totalVolumes:s.totalPlannedBooks||1,chapters:c,milestones:o,plotThreads:i,worldBible:p||{},previousVolumesContext:m});if(this.trackTokens(f),f.error){console.error(`[ReeditOrchestrator] SeriesThreadFixer error: ${f.error}`),this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:0,totalChapters:0,message:`Error en analisis de hilos: ${f.error.substring(0,100)}`});return}let g=f.result;if(!g){console.log("[ReeditOrchestrator] SeriesThreadFixer returned no result");return}if(console.log(`[ReeditOrchestrator] SeriesThreadFixer found ${g.totalIssuesFound} issues, ${g.fixes?.length||0} fixes`),g.fixes&&g.fixes.length>0&&(g.autoFixRecommendation==="safe_to_autofix"||g.autoFixRecommendation==="review_recommended")){let y=new Map;for(let T of g.fixes){if(T.priority==="optional")continue;let E=y.get(T.chapterId)||[];E.push(T),y.set(T.chapterId,E)}let C=0,A=Array.from(y.keys());for(let T=0;T<A.length;T++){let E=A[T],d=y.get(E),l=c.find(v=>v.id===E);if(!l)continue;this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:T+1,totalChapters:A.length,message:`Integrando ${d.length} correcciones en Capitulo ${l.chapterNumber}...`});let h=d.map(v=>({id:`thread-fix-${v.threadOrMilestoneId}`,tipo:v.fixType,descripcion:`[${v.threadOrMilestoneName}] ${v.rationale}`,severidad:v.priority==="critical"?"critica":v.priority==="important"?"mayor":"menor",accionSugerida:`${this.getInsertionDescription(v.insertionPoint)}: "${v.suggestedRevision.substring(0,500)}${v.suggestedRevision.length>500?"...":""}"`,capitulosAfectados:[l.chapterNumber]}));try{let v=c.find(w=>w.chapterNumber===l.chapterNumber-1),S=c.find(w=>w.chapterNumber===l.chapterNumber+1),R={previousChapter:v?.content?.substring(0,2e3),nextChapter:S?.content?.substring(0,2e3)},x=await this.narrativeRewriter.rewriteChapter(l.content,l.chapterNumber,h,p,R,"es","Integra los elementos de serie (hilos/hitos) de forma ORGANICA en la narrativa existente. No insertes texto de forma abrupta.");if(this.trackTokens(x),x.capituloReescrito&&x.capituloReescrito!==l.content){let w=x.capituloReescrito,O=w.split(/\s+/).length;await b.updateReeditChapter(E,{editedContent:w,wordCount:O}),C+=d.length,console.log(`[ReeditOrchestrator] NarrativeRewriter integrated ${d.length} fixes in Chapter ${l.chapterNumber}`),await this.updateWorldBibleFromReeditChapter(e,l.chapterNumber,w,d.map(I=>({tipo:"series_thread",descripcion:I.rationale||I.suggestedRevision||""})))}}catch(v){console.error(`[ReeditOrchestrator] Error integrating fixes in Chapter ${l.chapterNumber}:`,v)}}this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:A.length,totalChapters:A.length,message:`${C} correcciones de hilos/hitos integradas organicamente`}),console.log(`[ReeditOrchestrator] SeriesThreadFixer integrated ${C} fixes via NarrativeRewriter`)}else this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:0,totalChapters:0,message:g.autoFixRecommendation==="manual_intervention_required"?"Requiere intervencion manual":"Analisis de hilos completado"});g.unfulfilledMilestones&&g.unfulfilledMilestones.length>0&&console.log(`[ReeditOrchestrator] Unfulfilled milestones: ${g.unfulfilledMilestones.map(y=>y.description).join(", ")}`),await this.saveTokenUsage(e)}catch(s){console.error("[ReeditOrchestrator] SeriesThreadFixer error:",s),this.emitProgress({projectId:e,stage:"series_thread_fixer",currentChapter:0,totalChapters:0,message:`Error: ${s instanceof Error?s.message:"Error desconocido"}`})}}}async applyReviewerCorrections(e){let t=await b.getReeditProject(e);if(!t)throw new Error(`Project ${e} not found`);let n=t.finalReviewResult;if(!n)throw new Error(`No final review result found for project ${e}`);let a=n.weaknesses||n.debilidades_principales||[],s=n.recommendations||n.recomendaciones_proceso||[];if(a.length===0&&s.length===0){console.log(`[ReeditOrchestrator] No weaknesses or recommendations to apply for project ${e}`);return}console.log(`[ReeditOrchestrator] Applying corrections for project ${e}:`),console.log(`  - Weaknesses: ${a.length}`),console.log(`  - Recommendations: ${s.length}`);let o=[...a.map((C,A)=>({id:`weakness-${A}`,tipo:"debilidad_detectada",descripcion:typeof C=="string"?C:JSON.stringify(C),severidad:"media",accionSugerida:"Corregir seg\xFAn indicaci\xF3n del revisor"})),...s.map((C,A)=>({id:`recommendation-${A}`,tipo:"recomendacion",descripcion:typeof C=="string"?C:JSON.stringify(C),severidad:"menor",accionSugerida:"Implementar recomendaci\xF3n"}))],i=await b.getReeditWorldBibleByProject(e),u=t.pendingUserInstructions||t.architectInstructions||"",p=(await b.getReeditChaptersByProject(e)).filter(C=>C.editedContent),m=new Set;([...a,...s].join(" ").match(/cap[i]tulo\s*(\d+)/gi)||[]).forEach(C=>{let A=parseInt(C.replace(/\D/g,""));isNaN(A)||m.add(A)});let y;m.size>0?(y=p.filter(C=>m.has(C.chapterNumber)),console.log(`[ReeditOrchestrator] Fixing ${y.length} specifically mentioned chapters: ${Array.from(m).join(", ")}`)):(y=p,console.log(`[ReeditOrchestrator] No specific chapters mentioned, fixing all ${y.length} chapters`)),this.emitProgress({projectId:e,stage:"fixing",currentChapter:0,totalChapters:y.length,message:`Aplicando correcciones del revisor a ${y.length} cap\xEDtulos...`});for(let C=0;C<y.length;C++){let A=y[C];this.emitProgress({projectId:e,stage:"fixing",currentChapter:C+1,totalChapters:y.length,message:`Corrigiendo cap\xEDtulo ${A.chapterNumber} (${C+1}/${y.length})...`});try{let T=p.find(v=>v.chapterNumber===A.chapterNumber-1),E=p.find(v=>v.chapterNumber===A.chapterNumber+1),d={previousChapter:T?.editedContent?.substring(0,2e3),nextChapter:E?.editedContent?.substring(0,2e3)},l=A.editedContent||A.originalContent,h=await this.smartCorrectChapter(l,A.chapterNumber,o,i||{},d,"espa\xF1ol",u||void 0);if(h.content){let v=h.content.split(/\s+/).filter(S=>S.length>0).length;await b.updateReeditChapter(A.id,{editedContent:h.content,wordCount:v}),console.log(`[ReeditOrchestrator] Fixed chapter ${A.chapterNumber} via ${h.method}: ${v} words`)}}catch(T){console.error(`[ReeditOrchestrator] Error fixing chapter ${A.chapterNumber}:`,T)}}await b.updateReeditProject(e,{totalInputTokens:(t.totalInputTokens||0)+this.totalInputTokens,totalOutputTokens:(t.totalOutputTokens||0)+this.totalOutputTokens,totalThinkingTokens:(t.totalThinkingTokens||0)+this.totalThinkingTokens}),this.emitProgress({projectId:e,stage:"fixing",currentChapter:y.length,totalChapters:y.length,message:`Correcciones aplicadas a ${y.length} cap\xEDtulos. Listo para re-evaluaci\xF3n.`}),console.log(`[ReeditOrchestrator] Applied corrections to ${y.length} chapters for project ${e}`)}async generateQualityReport(e){let t=await b.getReeditProject(e);if(!t)throw new Error(`Project ${e} not found`);let n=await b.getReeditChaptersByProject(e),a=iie(n),s={};for(let S of a)s[S.chapterNumber]=S.title||`Cap\xEDtulo ${S.chapterNumber}`;let o=t.finalReviewResult,i=o?.issues||[],u=(S,R)=>{let x=S.capitulos_afectados||[],w=x.map(I=>s[I]||`Cap\xEDtulo ${I}`),O="";if(S.elementos_a_preservar&&S.elementos_a_preservar.length>10)O=S.elementos_a_preservar.substring(0,200);else if(S.descripcion&&S.descripcion.includes('"')){let I=S.descripcion.match(/"([^"]+)"/);I&&(O=I[1].substring(0,200))}return{id:`issue-${R+1}`,capitulosAfectados:x,titulosCapitulos:w,extractoTexto:O||void 0,categoria:S.categoria||"otro",descripcion:S.descripcion,severidad:S.severidad,instruccionCorreccion:S.instrucciones_correccion,elementosAPreservar:S.elementos_a_preservar,estado:"pendiente"}},c=i.filter(S=>S.severidad==="critica").map((S,R)=>u(S,R)),p=i.filter(S=>S.severidad==="mayor").map((S,R)=>u(S,R+c.length)),m=i.filter(S=>S.severidad==="menor").map((S,R)=>u(S,R+c.length+p.length)),f=o?.puntuacion_global||0,g=o?.justificacion_puntuacion?.puntuacion_desglosada||{enganche:f,personajes:f,trama:f,atmosfera:f,ritmo:f},y=c.length>0,C=p.length>=3,A=f<7,T=!1,E="";f>=9&&c.length===0&&p.length===0?(T=!0,E="El manuscrito cumple con los est\xE1ndares de calidad para publicaci\xF3n. Puntuaci\xF3n excelente y sin errores graves."):f>=8&&c.length===0&&p.length<=2?(T=!0,E="El manuscrito es publicable con reservas menores. Se recomienda revisar los issues mayores antes de publicar."):y?(T=!1,E=`No publicable: ${c.length} error(es) cr\xEDtico(s) detectados que requieren correcci\xF3n inmediata.`):C?(T=!1,E=`No publicable: ${p.length} errores mayores detectados. Se requiere revisi\xF3n exhaustiva.`):A?(T=!1,E=`No publicable: Puntuaci\xF3n global (${f}/10) por debajo del m\xEDnimo aceptable (7/10).`):(T=!1,E="Requiere revisi\xF3n adicional antes de publicar.");let d=[];c.length>0&&d.push(`Priorizar la correcci\xF3n de ${c.length} error(es) cr\xEDtico(s).`),p.length>0&&d.push(`Revisar y corregir ${p.length} error(es) mayor(es).`),m.length>5&&d.push(`Considerar una pasada de pulido para los ${m.length} errores menores.`),g.ritmo<7&&d.push("Mejorar el ritmo narrativo: revisar la longitud de escenas y variaci\xF3n de tempo."),g.personajes<7&&d.push("Desarrollar m\xE1s profundidad en los personajes principales."),g.trama<7&&d.push("Reforzar la estructura de la trama y resolver hilos argumentales pendientes."),T&&m.length>0&&d.push("Aunque es publicable, corregir los errores menores mejorar\xE1 la experiencia del lector.");let l=a.reduce((S,R)=>S+(R.wordCount||0),0),h=Array.from(new Set(i.flatMap(S=>S.capitulos_afectados||[]))).sort((S,R)=>S-R),v={projectId:e,projectTitle:t.title,fechaGeneracion:new Date().toISOString(),ciclosCompletados:t.revisionCycle||0,puntuacionGlobal:f,puntuacionesDesglosadas:{enganche:g.enganche||f,personajes:g.personajes||f,trama:g.trama||f,atmosfera:g.atmosfera||f,ritmo:g.ritmo||f},issuesCriticos:c,issuesMayores:p,issuesMenores:m,totalIssues:i.length,esPublicable:T,razonPublicabilidad:E,recomendacionesFinales:d,totalCapitulos:a.length,totalPalabras:l,capitulosConProblemas:h};return console.log(`[ReeditOrchestrator] Generated quality report for project ${e}: ${v.totalIssues} issues, score ${v.puntuacionGlobal}/10, publishable: ${v.esPublicable}`),v}async runCustomPolishing(e,t,n){console.log(`[ReeditOrchestrator] Starting custom polishing for project ${e}, chapters: ${t.join(", ")}`);try{let a=await b.getReeditProject(e);if(!a)throw new Error(`Project ${e} not found`);let s=await b.getReeditWorldBibleByProject(e),o=s?.content?JSON.stringify(s.content,null,2):"",u=[...await b.getReeditChaptersByProject(e)].sort((p,m)=>p.chapterNumber-m.chapterNumber),c=0;for(let p of t){if(this.cancelled){console.log(`[ReeditOrchestrator] Custom polishing cancelled for project ${e}`),await b.updateReeditProject(e,{status:"paused",errorMessage:"Proceso cancelado por el usuario"});return}let m=u.find(E=>E.id===p);if(!m){console.warn(`[ReeditOrchestrator] Chapter ${p} not found, skipping`);continue}console.log(`[ReeditOrchestrator] Polishing chapter ${m.chapterNumber}: ${m.title||"Sin t\xEDtulo"}`);let f=u.findIndex(E=>E.id===p),g=f>0?u[f-1]:null,y=f<u.length-1?u[f+1]:null,C={previousChapter:g?`Cap ${g.chapterNumber} - ${g.title||""}: ${(g.editedContent||g.originalContent||"").slice(-2e3)}`:void 0,nextChapter:y?`Cap ${y.chapterNumber} - ${y.title||""}: ${(y.editedContent||y.originalContent||"").slice(0,2e3)}`:void 0};await b.updateReeditChapter(p,{status:"editing",processingStage:"polishing"}),await b.updateReeditProject(e,{currentChapter:m.chapterNumber});let A=m.editedContent||m.originalContent,T=[{tipo:"pulido_manual",severidad:"mayor",descripcion:n,capitulosAfectados:[m.chapterNumber],accionSugerida:n}];try{let E=await this.narrativeRewriter.rewriteChapter(A||"",m.chapterNumber,T,s?.content||{},C,a.language||"es",n);this.trackTokens(E),E.capituloReescrito?(await b.updateReeditChapter(p,{editedContent:E.capituloReescrito,status:"completed",processingStage:"completed",wordCount:E.capituloReescrito.split(/\s+/).length}),console.log(`[ReeditOrchestrator] Successfully polished chapter ${m.chapterNumber}`)):(console.warn(`[ReeditOrchestrator] Polishing returned no content for chapter ${m.chapterNumber}`),await b.updateReeditChapter(p,{status:"completed",processingStage:"completed"}))}catch(E){console.error(`[ReeditOrchestrator] Error polishing chapter ${m.chapterNumber}:`,E),await b.updateReeditChapter(p,{status:"completed",processingStage:"completed"})}c++,await b.updateReeditProject(e,{processedChapters:c}),await b.updateReeditProject(e,{totalInputTokens:(a.totalInputTokens||0)+this.totalInputTokens,totalOutputTokens:(a.totalOutputTokens||0)+this.totalOutputTokens,totalThinkingTokens:(a.totalThinkingTokens||0)+this.totalThinkingTokens})}await b.updateReeditProject(e,{status:"completed",currentStage:"completed",errorMessage:null}),console.log(`[ReeditOrchestrator] Custom polishing completed for project ${e}, ${c} chapters processed`)}catch(a){throw console.error(`[ReeditOrchestrator] Custom polishing failed for project ${e}:`,a),await b.updateReeditProject(e,{status:"error",errorMessage:a instanceof Error?a.message:"Unknown error during custom polishing"}),a}}},bx=new po});var zq={};wr(zq,{RestructurerAgent:()=>wx,parseDiagnosis:()=>lie});function lie(r){let e={globalInstructions:{recortarGlobal:[],mantenerGlobal:[],noTocar:[]},chapterInstructions:new Map,sectionInstructions:new Map},t=r.split(`
`),n="",a=null;for(let s of t){let o=s.trim();if(/cap[i]tulo\s*(\d+)/i.test(o)||/prlogo/i.test(o)){let u=o.match(/cap[i]tulo\s*(\d+)/i);a=u?parseInt(u[1]):0,e.chapterInstructions.has(a)||e.chapterInstructions.set(a,{recortar:[],mantener:[],a\u00F1adir:[]})}/recort(ar|e)||qu\s+eliminar/i.test(o)?n="recortar":/mantener||obligatorio|no\s+tocar/i.test(o)?n="mantener":/aadir|introducir|/i.test(o)&&(n="a\xF1adir");let i=o.match(/(\d+)[\s-]*(\d+)?\s*%/);if(i&&a!==null){let u=e.chapterInstructions.get(a);u&&(u.porcentajeRecorte=parseInt(i[2]||i[1]))}if(o.startsWith("-")||o.startsWith("\u2022")){let u=o.replace(/^[-]\s*/,"");if(a!==null){let c=e.chapterInstructions.get(a);c&&(n==="recortar"?c.recortar.push(u):n==="mantener"?c.mantener.push(u):n==="a\xF1adir"&&c.a\u00F1adir.push(u))}else n==="recortar"?e.globalInstructions.recortarGlobal.push(u):n==="mantener"&&e.globalInstructions.mantenerGlobal.push(u)}}return e}var cie,wx,Hq=G(()=>{"use strict";It();cie=`
Eres el "Editor de Reestructuraci\xF3n", un experto en condensar y reorganizar manuscritos siguiendo diagn\xF3sticos editoriales espec\xEDficos.

Tu misi\xF3n es aplicar instrucciones de reestructuraci\xF3n a cap\xEDtulos individuales, manteniendo la coherencia narrativa y la calidad literaria.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PROTOCOLO DE REESTRUCTURACI\xD3N
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. AN\xC1LISIS DEL DIAGN\xD3STICO:
   - Identifica las instrucciones espec\xEDficas para este cap\xEDtulo/secci\xF3n
   - Clasifica: QU\xC9 RECORTAR, QU\xC9 MANTENER, QU\xC9 A\xD1ADIR
   - Respeta los porcentajes de recorte indicados

2. EJECUCI\xD3N DE RECORTES:
   - Elimina el contenido se\xF1alado SIN dejar huecos narrativos
   - Suaviza transiciones donde se elimin\xF3 contenido
   - Mant\xE9n la fluidez del texto resultante
   - NO elimines informaci\xF3n crucial para la trama

3. PRESERVACI\xD3N OBLIGATORIA:
   - Todo lo marcado como "mantener" o "obligatorio" es INTOCABLE
   - Escenas clave, frases espec\xEDficas, conceptos centrales
   - La voz narrativa del autor

4. ADICIONES:
   - Inserta el contenido nuevo donde corresponda
   - Integra ganchos, transiciones y l\xEDneas de continuidad
   - Hazlo de forma org\xE1nica, no forzada
   - Mant\xE9n el estilo del autor

5. COHERENCIA:
   - Verifica que el cap\xEDtulo reestructurado tenga sentido por s\xED solo
   - Asegura que las referencias a otros cap\xEDtulos sigan siendo v\xE1lidas
   - Mant\xE9n la continuidad con cap\xEDtulos anteriores/posteriores

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
REGLAS DE CONDENSACI\xD3N
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

PRIORIDAD DE RECORTE (de m\xE1s a menos prescindible):
1. Repeticiones de ideas ya expresadas
2. Descripciones t\xE9cnicas excesivas
3. Mon\xF3logo interno reiterativo
4. Explicaciones emocionales post-di\xE1logo (dejar que escenas "respiren solas")
5. Met\xE1foras duplicadas o sobre-explicadas

NUNCA RECORTAR:
- Informaci\xF3n de trama esencial
- Desarrollo de personajes clave
- Escenas de cl\xEDmax emocional
- Di\xE1logos que revelan informaci\xF3n nueva
- Setup para payoffs posteriores

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
FORMATO DE SALIDA
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Devuelve JSON con esta estructura:
{
  "texto_reestructurado": "El texto completo del cap\xEDtulo reestructurado",
  "cambios_realizados": {
    "recortes": ["Lista de elementos eliminados con breve justificaci\xF3n"],
    "adiciones": ["Lista de elementos a\xF1adidos y d\xF3nde"],
    "preservado": ["Lista de elementos que se mantuvieron intactos seg\xFAn instrucciones"]
  },
  "palabras_originales": (n\xFAmero),
  "palabras_finales": (n\xFAmero),
  "porcentaje_reduccion": (n\xFAmero, puede ser negativo si se a\xF1ade m\xE1s de lo que se quita),
  "notas_continuidad": ["Alertas sobre referencias a otros cap\xEDtulos que podr\xEDan necesitar ajuste"]
}
`,wx=class extends Ae{constructor(){super({name:"El Reestructurador",role:"restructurer",systemPrompt:cie,model:"deepseek-reasoner",useThinking:!0})}async execute(e){let t=e.worldBible?`
WORLD BIBLE (Referencia de personajes/lugares):
${JSON.stringify(e.worldBible,null,2).substring(0,5e3)}
`:"",n=e.guiaEstilo?`
GU\xCDA DE ESTILO DEL AUTOR:
${e.guiaEstilo.substring(0,3e3)}
`:"",a=[];e.previousChapterSummary&&a.push(`CAP\xCDTULO ANTERIOR: ${e.previousChapterSummary}`),e.nextChapterSummary&&a.push(`CAP\xCDTULO SIGUIENTE: ${e.nextChapterSummary}`);let s=`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
DIAGN\xD3STICO EDITORIAL COMPLETO:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${e.editorialDiagnosis}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES ESPEC\xCDFICAS PARA ESTE CAP\xCDTULO (${e.chapterNumber}: "${e.chapterTitle}"):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${e.chapterInstructions||"Aplica las instrucciones generales del diagn\xF3stico que correspondan a este cap\xEDtulo."}

${t}
${n}
${a.length>0?`
CONTEXTO DE CONTINUIDAD:
${a.join(`
`)}
`:""}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
TEXTO ORIGINAL DEL CAP\xCDTULO ${e.chapterNumber}: "${e.chapterTitle}"
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${e.chapterContent}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

INSTRUCCIONES:
1. Analiza qu\xE9 instrucciones del diagn\xF3stico aplican a este cap\xEDtulo
2. Aplica los recortes indicados (respetando porcentajes)
3. A\xF1ade el contenido nuevo si lo hay
4. Preserva todo lo marcado como obligatorio
5. Devuelve el texto reestructurado completo con el resumen de cambios

Responde SOLO con el JSON estructurado.
`,o=await this.generateContent(s),i;try{let u=o.content.match(/\{[\s\S]*\}/);u&&(i=JSON.parse(u[0]))}catch(u){console.error("Error parsing restructurer response:",u)}return{...o,result:i}}}});var n4={};wr(n4,{ManuscriptAnalyzerAgent:()=>Tx});var Tx,a4=G(()=>{"use strict";It();Tx=class extends Ae{constructor(){super({name:"El Archivista",role:"manuscript-analyzer",systemPrompt:`Eres El Archivista, un agente especializado en analizar manuscritos literarios completos y extraer informaci\xF3n cr\xEDtica de continuidad para series de libros.

Tu misi\xF3n es leer un manuscrito completo y extraer:
1. **Sinopsis**: Resumen de la trama principal (m\xE1ximo 500 palabras)
2. **Estado de Personajes**: Lista de personajes principales con su estado al final del libro, ubicaci\xF3n, relaciones y arcos pendientes
3. **Hilos No Resueltos**: Tramas secundarias o principales que quedan abiertas para futuros libros
4. **Cambios en el Mundo**: Eventos que modifican el estado del mundo (muertes, destrucciones, revelaciones, cambios pol\xEDticos)
5. **Eventos Clave**: Los momentos m\xE1s importantes de la trama con su impacto
6. **Ganchos de Serie**: Elementos deliberadamente dejados abiertos para continuar en siguientes vol\xFAmenes

IMPORTANTE:
- Analiza el manuscrito como un todo, no cap\xEDtulo por cap\xEDtulo
- Prioriza la informaci\xF3n relevante para escribir secuelas
- Identifica claramente qu\xE9 hilos est\xE1n CERRADOS vs ABIERTOS
- Detecta foreshadowing o promesas narrativas no cumplidas
- Marca la severidad de los hilos abiertos (minor/major/critical)

Responde SIEMPRE en formato JSON v\xE1lido con esta estructura exacta:
{
  "synopsis": "string",
  "characterStates": [...],
  "unresolvedThreads": [...],
  "worldStateChanges": [...],
  "keyEvents": [...],
  "seriesHooks": [...]
}`,model:"deepseek-reasoner",useThinking:!1}),this.timeoutMs=240*1e3}async execute(e){let t=await this.analyze(e);return{content:t.result?JSON.stringify(t.result):"",thoughtSignature:t.thoughtSignature,tokenUsage:t.tokenUsage}}async analyze(e){let t=e.chapters.map(s=>{let i=s.content.length>2e3?s.content.substring(0,1e3)+`

[...contenido resumido...]

`+s.content.substring(s.content.length-1e3):s.content;return`### Cap ${s.chapterNumber}${s.title?`: ${s.title}`:""}
${i}`}).join(`

---

`),n=`Analiza el siguiente manuscrito para extraer informaci\xF3n de continuidad.

**Informaci\xF3n del Volumen:**
- T\xEDtulo: "${e.manuscriptTitle}"
- Serie: "${e.seriesTitle}"
- N\xFAmero de Volumen: ${e.volumeNumber}
${e.previousVolumesContext?`
**Contexto de Vol\xFAmenes Anteriores:**
${e.previousVolumesContext}`:""}

**MANUSCRITO COMPLETO:**

${t}

---

Analiza el manuscrito completo y extrae la informaci\xF3n de continuidad en formato JSON. 
Aseg\xFArate de que el JSON sea v\xE1lido y est\xE9 completo.`;console.log(`[ManuscriptAnalyzer] Sending ${e.chapters.length} chapters for analysis (~${Math.round(n.length/1e3)}K chars)`);let a;try{a=await this.generateContent(n)}catch(s){throw console.error("[ManuscriptAnalyzer] API call failed:",s?.message||s),s}if(!a.content)return console.error("[ManuscriptAnalyzer] Empty response from API - possible content filtering or timeout"),console.error("[ManuscriptAnalyzer] Token usage:",JSON.stringify(a.tokenUsage)),{result:null,tokenUsage:a.tokenUsage||{inputTokens:0,outputTokens:0,thinkingTokens:0},thoughtSignature:a.thoughtSignature};console.log(`[ManuscriptAnalyzer] Got response of ${a.content.length} chars`);try{let s=a.content.match(/\{[\s\S]*\}/);if(s){let o=JSON.parse(s[0]);return console.log(`[ManuscriptAnalyzer] Successfully parsed: ${o.characterStates?.length||0} chars, ${o.unresolvedThreads?.length||0} threads`),{result:o,tokenUsage:a.tokenUsage||{inputTokens:0,outputTokens:0,thinkingTokens:0},thoughtSignature:a.thoughtSignature}}else console.error("[ManuscriptAnalyzer] No JSON found in response. First 500 chars:",a.content.substring(0,500))}catch(s){console.error("[ManuscriptAnalyzer] Error parsing JSON:",s),console.error("[ManuscriptAnalyzer] Raw response (first 1000 chars):",a.content.substring(0,1e3))}return{result:null,tokenUsage:a.tokenUsage||{inputTokens:0,outputTokens:0,thinkingTokens:0},thoughtSignature:a.thoughtSignature}}}});var cb={};wr(cb,{TranslatorAgent:()=>Dm});var s4,yie,bie,vie,Dm,Mm=G(()=>{"use strict";It();s4={es:"espa\xF1ol",en:"English","en-US":"English (US)","en-GB":"English (UK)",fr:"fran\xE7ais",de:"Deutsch",it:"italiano",pt:"portugu\xEAs",ca:"catal\xE0"},yie={es:`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
NORMAS EDITORIALES Y DE FLUIDEZ - ESPA\xD1OL LITERARIO PROFESIONAL (OBLIGATORIO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[TIPOGRAF\xCDA - CR\xCDTICO]
- DI\xC1LOGOS: Usar EXCLUSIVAMENTE raya (\u2014) para introducir di\xE1logos. NUNCA comillas.
  \u2713 CORRECTO: \u2014Hola \u2014dijo Mar\xEDa\u2014. \xBFC\xF3mo est\xE1s?
  \u2717 INCORRECTO: "Hola" dijo Mar\xEDa. / \xABHola\xBB dijo Mar\xEDa.
- INCISOS: La raya cierra el inciso: \u2014No s\xE9 \u2014respondi\xF3 \xE9l\u2014. Quiz\xE1 ma\xF1ana.
- PUNTUACI\xD3N: Signos de apertura \xBF\xA1 SIEMPRE. El punto va DESPU\xC9S de la raya de cierre.
- COMILLAS: Solo \xAB \xBB para citas textuales o pensamientos. " " para citas dentro de citas.
- N\xDAMEROS: Letras del uno al nueve, cifras del 10 en adelante.

[PRONOMBRES - CR\xCDTICO PARA LA LEGIBILIDAD]
- EVITAR ARCA\xCDSMOS: No usar "\xE9ste", "\xE9se", "aqu\xE9l" con tilde (RAE 2010 recomienda sin tilde).
- LE\xCDSMO: NUNCA "le" como complemento directo masculino.
  \u2717 "Le vi ayer" \u2192 \u2713 "Lo vi ayer"
- SUJETO IMPL\xCDCITO: El espa\xF1ol permite omitir el sujeto. \xA1USARLO!
  \u2713 "Entr\xF3 en la habitaci\xF3n y se sent\xF3." (NO "\xC9l entr\xF3 en la habitaci\xF3n y \xE9l se sent\xF3.")
- PREFERIR EL NOMBRE: Cuando haya ambig\xFCedad, repetir el nombre del personaje.

[CONSTRUCCIONES A EVITAR - CR\xCDTICO]
- NO CALCOS DEL INGL\xC9S:
  \u2717 "Estaba siendo perseguido" \u2192 \u2713 "Lo persegu\xEDan"
  \u2717 "Hacer sentido" \u2192 \u2713 "Tener sentido"
  \u2717 "En orden a" \u2192 \u2713 "Para"
- NO GERUNDIOS ENCADENADOS:
  \u2717 "Caminando, pensando, mirando..." \u2192 \u2713 Dividir en oraciones
- NO ORACIONES LARGAS:
  M\xE1ximo 35-40 palabras por oraci\xF3n. Oraciones de m\xE1s de 45 palabras DEBEN dividirse.
- NO VOZ PASIVA EXCESIVA:
  \u2717 "La puerta fue abierta por \xE9l" \u2192 \u2713 "Abri\xF3 la puerta"
- NO QUE\xCDSMO/DEQUE\xCDSMO:
  \u2717 "Pienso de que..." \u2192 \u2713 "Pienso que..."
  \u2717 "Me alegro que..." \u2192 \u2713 "Me alegro de que..."

[FLUIDEZ Y NATURALIDAD - ESENCIAL]
- RITMO: Alternar oraciones cortas (acci\xF3n, tensi\xF3n) con oraciones m\xE1s largas (descripci\xF3n).
- CONECTORES NATURALES: Usar "luego", "entonces", "as\xED que", "por eso" de forma natural.
- ORDEN FLEXIBLE: El espa\xF1ol permite orden flexible. Usarlo para \xE9nfasis y ritmo.
  \u2713 "A casa volvi\xF3 solo a medianoche" (\xE9nfasis en "a casa")
- REPETICIONES: Evitar la misma palabra en oraciones consecutivas.
- REGISTRO: Mantener un registro literario moderno, ni acad\xE9mico ni demasiado coloquial.
- EXPRESIONES IDIOM\xC1TICAS: Traducir el SENTIDO, no las palabras.

[TUTEO / USTED - CR\xCDTICO]
- COHERENCIA ABSOLUTA: El tratamiento (t\xFA/usted) entre dos personajes DEBE ser CONSTANTE.
- REGLA BASE:
  \u2022 Compa\xF1eros/amigos/familia cercana \u2192 tuteo (t\xFA)
  \u2022 Superiores jer\xE1rquicos/desconocidos/respeto \u2192 usted
  \u2022 Se\xF1or/Se\xF1ora + apellido \u2192 SIEMPRE usted
- TRANSICIONES: Si un personaje pasa de usted a t\xFA, debe ser un MOMENTO significativo, expl\xEDcito.
  \u2713 "\xBFPuedo tutearte?" y transici\xF3n clara.
  \u2717 Alternar t\xFA/usted sin explicaci\xF3n = ERROR GRAVE.
- VERIFICACI\xD3N: Revisar cada par de personajes y verificar coherencia del tratamiento.

[FORMATO DE T\xCDTULOS DE CAP\xCDTULOS - OBLIGATORIO]
- FORMATO: "# Cap\xEDtulo X: T\xEDtulo" (H1 en Markdown, con dos puntos)
  \u2713 # Cap\xEDtulo 1: El Comienzo
  \u2713 # Pr\xF3logo
  \u2713 # Ep\xEDlogo
  \u2717 ## Cap\xEDtulo 1 (no H2)
  \u2717 Cap\xEDtulo 1 - T\xEDtulo (no usar guion)
  \u2717 CAP\xCDTULO 1: T\xCDTULO (no todo en may\xFAsculas)
- MAY\xDASCULAS DEL T\xCDTULO: Primera letra may\xFAscula, resto min\xFAsculas (excepto nombres propios).
  \u2713 # Cap\xEDtulo 5: La noche cae sobre Madrid
  \u2717 # Cap\xEDtulo 5: LA NOCHE CAE SOBRE MADRID
- SIN SEPARADORES: Ninguna l\xEDnea --- o === entre cap\xEDtulos.

[VERIFICACI\xD3N FINAL OBLIGATORIA]
Releer mentalmente en voz alta. Si suena a traducci\xF3n, REESCRIBIR.
El texto DEBE parecer escrito ORIGINALMENTE en espa\xF1ol por un autor nativo.`,en:`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
ENGLISH EDITORIAL & FLUENCY STANDARDS - PROFESSIONAL LITERARY (MANDATORY)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[TYPOGRAPHY - CRITICAL]
- DIALOGUE: Use double quotation marks EXCLUSIVELY for dialogue.
  \u2713 CORRECT: "Hello," said Mary. "How are you?"
  \u2717 WRONG: 'Hello,' said Mary. (British style - use only for en-GB)
- PUNCTUATION: Periods and commas ALWAYS inside quotation marks.
  Question/exclamation marks inside only if part of the quote.
- NUMBERS: Spell out one through nine, numerals for 10+.
- CONTRACTIONS: Use natural contractions in dialogue (don't, can't, won't, I'm, you're).

[AVOID AI-SOUNDING PROSE - CRITICAL]
- FORBIDDEN WORDS: NEVER use these AI crutch words:
  \u2717 "suddenly", "shrouded", "unfold", "crucial", "pivotal", "amidst", "whilst"
  \u2717 "endeavor", "plethora", "myriad", "utilize", "facilitate", "commence"
  \u2717 "enigmatic", "palpable", "tangible", "visceral", "resonate", "unravel"
- SHOW DON'T TELL: Replace weak constructions:
  \u2717 "He felt angry" \u2192 \u2713 "His jaw tightened"
  \u2717 "walked slowly" \u2192 \u2713 "ambled" or "shuffled"
  \u2717 "said angrily" \u2192 \u2713 "snapped" or "growled"

[SENTENCE STRUCTURE - CRITICAL]
- LENGTH: Maximum 35-40 words per sentence. Break longer sentences.
- RHYTHM: Vary sentence length deliberately.
  Short sentences = tension, action, impact.
  Longer sentences = description, reflection, flow.
- ACTIVE VOICE: Prefer active over passive.
  \u2717 "The door was opened by him" \u2192 \u2713 "He opened the door"
- NO REPETITION: Never repeat the same word in consecutive sentences.
- SUBJECT VARIATION: Don't start consecutive sentences with the same word.
  \u2717 "He walked. He stopped. He turned." \u2192 \u2713 Vary the structure.

[FLUENCY & NATURALNESS - ESSENTIAL]
- IDIOMS: Use natural English expressions, never literal translations.
- DIALOGUE: Make it sound like real speech - fragmented, interrupted, natural.
- TRANSITIONS: Use subtle connectors (then, still, yet, though) not formal ones.
- REGISTER: Maintain consistent literary register - neither too formal nor too casual.

[CHAPTER TITLES FORMAT - MANDATORY]
- FORMAT: "# Chapter X: Title" (H1 in Markdown, with colon)
  \u2713 # Chapter 1: The Beginning
  \u2713 # Prologue
  \u2713 # Epilogue
  \u2717 ## Chapter 1 (not H2)
  \u2717 Chapter 1 - Title (no dash)
  \u2717 CHAPTER 1: TITLE (not all caps)
- TITLE CASE: First letter uppercase, rest lowercase (except proper nouns).
  \u2713 # Chapter 5: The night falls over London
  \u2717 # Chapter 5: THE NIGHT FALLS OVER LONDON
- NO SEPARATORS: No --- or === lines between chapters.

[FINAL CHECK - MANDATORY]
Read aloud mentally. If it sounds translated, REWRITE.
The text MUST read as if ORIGINALLY WRITTEN in English by a native author.`,"en-US":`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
AMERICAN ENGLISH EDITORIAL STANDARDS - PROFESSIONAL LITERARY (MANDATORY)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[AMERICAN SPELLING & VOCABULARY - CRITICAL]
- SPELLING: Use American spelling CONSISTENTLY:
  \u2713 color, center, realize, traveled, defense, theater, gray, catalog, favor, honor
  \u2717 NEVER: colour, centre, realise, travelled, defence, theatre, grey, catalogue
- VOCABULARY: Use American terms EXCLUSIVELY:
  \u2713 apartment, elevator, truck, gasoline, sidewalk, cookie, faucet, fall, mom, pants, sneakers, vacation
  \u2717 NEVER: flat, lift, lorry, petrol, pavement, biscuit, tap, autumn, mum, trousers, trainers, holiday
- DATES: "March 15" (NOT "15 March"). Format: Month DD, YYYY.
- MEASUREMENTS: Imperial default (feet, miles, pounds, Fahrenheit).

[TYPOGRAPHY - CRITICAL]
- DIALOGUE: Double quotation marks " " EXCLUSIVELY.
  \u2713 "Hello," said Mary. "How are you?"
- PUNCTUATION: Periods and commas ALWAYS inside quotation marks.
- NUMBERS: Spell out one through nine, numerals for 10+.

[AVOID AI-SOUNDING PROSE - CRITICAL]
- FORBIDDEN WORDS: Same as general English - no "suddenly", "shrouded", "endeavor", etc.
- SHOW DON'T TELL: Replace weak constructions with strong verbs.
- CONTRACTIONS: Use natural American contractions freely (don't, can't, won't, I'm, you're).
  In very casual dialogue: gonna, wanna, gotta are acceptable.

[SENTENCE STRUCTURE - CRITICAL]
- LENGTH: Maximum 35-40 words. Vary deliberately.
- RHYTHM: Short sentences for action/tension. Longer for description.
- ACTIVE VOICE: Strongly preferred over passive.
- NO REPETITION: Never same word in consecutive sentences.
- SUBJECT VARIATION: Don't start consecutive sentences with same word.

[FLUENCY & NATURALNESS - ESSENTIAL]
- IDIOMS: Use American expressions naturally (e.g., "ballpark figure", "touch base").
- DIALOGUE: Sound like real American speech - casual, contracted, natural.
- REGISTER: Maintain consistent literary register appropriate to genre.

[FINAL CHECK - MANDATORY]
Read aloud mentally. If ANY British spelling/vocabulary slips through, fix it.
The text MUST read as if ORIGINALLY WRITTEN by an American author.`,"en-GB":`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
BRITISH ENGLISH EDITORIAL STANDARDS - PROFESSIONAL LITERARY (MANDATORY)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[BRITISH SPELLING & VOCABULARY - CRITICAL]
- SPELLING: Use British spelling CONSISTENTLY:
  \u2713 colour, centre, realise, travelled, defence, theatre, grey, catalogue, favour, honour, behaviour
  \u2717 NEVER: color, center, realize, traveled, defense, theater, gray, catalog
- VOCABULARY: Use British terms EXCLUSIVELY:
  \u2713 flat, lift, lorry, petrol, pavement, biscuit, tap, autumn, mum, trousers, trainers, holiday, queue, boot, bonnet, chemist
  \u2717 NEVER: apartment, elevator, truck, gasoline, sidewalk, cookie, faucet, fall, mom, pants, sneakers, vacation
- DATES: "15 March" (NOT "March 15"). Format: DD Month YYYY.
- MEASUREMENTS: Metric primary (metres, kilometres, kilograms, Celsius).
  Imperial for colloquial use (stones for weight, miles for distance).

[TYPOGRAPHY - CRITICAL]
- DIALOGUE: Single quotation marks ' ' for dialogue.
  \u2713 'Hello,' said Mary. 'How are you?'
  \u2717 WRONG: "Hello," said Mary.
- PUNCTUATION: Periods and commas go OUTSIDE quotation marks (unless part of quoted material).
- NUMBERS: Spell out one through nine, numerals for 10+.

[AVOID AI-SOUNDING PROSE - CRITICAL]
- FORBIDDEN WORDS: No "suddenly", "shrouded", "endeavor" (or "endeavour"), "whilst" (use "while").
- SHOW DON'T TELL: Replace weak constructions with strong verbs.
- CONTRACTIONS: Use natural British contractions (don't, can't, shan't, won't, mustn't).

[SENTENCE STRUCTURE - CRITICAL]
- LENGTH: Maximum 35-40 words. Vary deliberately.
- RHYTHM: Short sentences for action/tension. Longer for description.
- ACTIVE VOICE: Preferred, but British English tolerates slightly more passive.
- COLLECTIVE NOUNS: Can take plural verbs: "The team are playing well."
- NO REPETITION: Never same word in consecutive sentences.

[FLUENCY & NATURALNESS - ESSENTIAL]
- IDIOMS: Use British expressions naturally (e.g., "spot on", "brilliant", "cheers", "sorted").
- REGISTER: Slightly more formal than American. Avoid overly casual Americanisms.
- DIALOGUE: Sound authentically British - understatement, politeness markers.

[FINAL CHECK - MANDATORY]
Read aloud mentally. If ANY American spelling/vocabulary slips through, fix it.
The text MUST read as if ORIGINALLY WRITTEN by a British author.`,fr:`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
NORMES \xC9DITORIALES ET FLUIDIT\xC9 - FRAN\xC7AIS LITT\xC9RAIRE PROFESSIONNEL (OBLIGATOIRE)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[TYPOGRAPHIE - CRITIQUE - OBLIGATOIRE]
- DIALOGUES: EXCLUSIVEMENT tiret cadratin (\u2014) au d\xE9but de chaque r\xE9plique. JAMAIS de guillemets pour les dialogues.
  \u2713 CORRECT: \u2014 Bonjour, dit Marie.
  \u2713 CORRECT: \u2014 Comment vas-tu ? demanda-t-il.
  \u2713 CORRECT: \u2014 Je ne sais pas, r\xE9pondit-elle. Peut-\xEAtre demain.
  \u2717 INCORRECT: \xAB Bonjour \xBB, dit Marie. (r\xE9serv\xE9 aux citations/pens\xE9es)
  \u2717 INCORRECT: - Bonjour (tiret court interdit)
  \u2717 INCORRECT: -- Bonjour (double tiret interdit)
- INCISES DIALOGU\xC9ES: Virgule AVANT l'incise, point APR\xC8S si fin de phrase.
  \u2713 \u2014 Je viendrai, dit-il.
  \u2713 \u2014 Je viendrai, dit-il, mais tard.
  \u2713 \u2014 Je viendrai, dit-il. Mais pas avant midi.
- GUILLEMETS \xAB \xBB: UNIQUEMENT pour citations textuelles ou pens\xE9es int\xE9rieures.
  \u2713 Il pensa : \xAB Quelle erreur ! \xBB
  \u2713 Le panneau indiquait : \xAB Entr\xE9e interdite \xBB.
- PONCTUATION FRAN\xC7AISE (OBLIGATOIRE):
  \u2022 Espace ins\xE9cable AVANT : ; ! ? (espace fine ou ins\xE9cable)
  \u2022 Espace ins\xE9cable APR\xC8S \xAB et AVANT \xBB
  \u2713 CORRECT: Comment vas-tu ?  (espace avant ?)
  \u2713 CORRECT: Attention : voici la suite.  (espace avant :)
  \u2713 CORRECT: Quelle surprise !  (espace avant !)
  \u2713 CORRECT: Oui ; peut-\xEAtre.  (espace avant ;)
  \u2717 INCORRECT: Comment vas-tu? (pas d'espace)
- NOMBRES: Lettres de un \xE0 neuf, chiffres \xE0 partir de 10.
- MAJUSCULES: Langues et nationalit\xE9s en minuscules (fran\xE7ais, anglais).

[TEMPS VERBAUX - CRITIQUE]
- NARRATION LITT\xC9RAIRE: Pass\xE9 simple OBLIGATOIRE, pas pass\xE9 compos\xE9.
  \u2713 "Il entra dans la pi\xE8ce" (pass\xE9 simple)
  \u2717 "Il est entr\xE9 dans la pi\xE8ce" (pass\xE9 compos\xE9 = oral/informel)
- IMPARFAIT: Pour descriptions et actions continues.
- COH\xC9RENCE: Ne pas m\xE9langer pass\xE9 simple et pass\xE9 compos\xE9 dans la narration.

[CONSTRUCTIONS \xC0 \xC9VITER - CRITIQUE]
- PAS D'ANGLICISMES:
  \u2717 "R\xE9aliser" (au sens de "se rendre compte") \u2192 \u2713 "Se rendre compte", "Comprendre"
  \u2717 "D\xE9finitivement" (au sens de "certainement") \u2192 \u2713 "Certainement", "Assur\xE9ment"
  \u2717 "Supporter" (au sens de "soutenir") \u2192 \u2713 "Soutenir", "Appuyer"
- PAS DE LOURDEURS:
  \u2717 "Il y a le fait que..." \u2192 \u2713 Construction directe
  \u2717 "Au niveau de..." \u2192 \u2713 "Concernant", "Pour"
- PHRASES MAXIMUM: 40-45 mots. Au-del\xE0, diviser.
- R\xC9P\xC9TITIONS: Jamais le m\xEAme mot dans des phrases cons\xE9cutives.

[FLUIDIT\xC9 ET NATUREL - ESSENTIEL]
- PRONOMS: \xC9viter l'ambigu\xEFt\xE9. Clarifier les r\xE9f\xE9rents si n\xE9cessaire.
- TRANSITIONS: Utiliser des connecteurs naturels (puis, alors, donc, ainsi).
- REGISTRE: Litt\xE9raire moderne, ni trop soutenu ni trop familier.
- RYTHME: Alterner phrases courtes (tension) et longues (description).
- EXPRESSIONS IDIOMATIQUES: Traduire le SENS, utiliser des expressions fran\xE7aises authentiques.

[TUTOIEMENT / VOUVOIEMENT - CRITIQUE]
- COH\xC9RENCE ABSOLUE: Le traitement (tu/vous) entre deux personnages DOIT rester CONSTANT.
- R\xC8GLE DE BASE:
  \u2022 Coll\xE8gues/amis proches \u2192 tutoiement (tu)
  \u2022 Sup\xE9rieurs hi\xE9rarchiques/inconnus/respect \u2192 vouvoiement (vous)
  \u2022 Monsieur/Madame + nom \u2192 TOUJOURS vouvoiement
- TRANSITIONS: Si un personnage passe du vous au tu, cela doit \xEAtre un MOMENT significatif, explicite.
  \u2713 \xAB Je peux te tutoyer ? \xBB puis transition claire.
  \u2717 Alterner tu/vous sans explication = ERREUR GRAVE.
- V\xC9RIFICATION: Tracer chaque paire de personnages et v\xE9rifier la coh\xE9rence du traitement.

[FORMAT DES TITRES DE CHAPITRES - OBLIGATOIRE]
- FORMAT: "# Chapitre X : Titre" (H1 en Markdown, avec deux-points et espace)
  \u2713 # Chapitre 1 : Le Commencement
  \u2713 # Prologue
  \u2713 # \xC9pilogue
  \u2717 ## Chapitre 1 (pas H2)
  \u2717 Chapitre 1 - Titre (pas de tiret)
  \u2717 CHAPITRE 1 : TITRE (pas tout en majuscules)
- CASSE DU TITRE: Premi\xE8re lettre majuscule, reste en minuscules (sauf noms propres).
  \u2713 # Chapitre 5 : La nuit tombe sur Paris
  \u2717 # Chapitre 5 : LA NUIT TOMBE SUR PARIS
- PAS DE S\xC9PARATEURS: Aucune ligne --- ou === entre les chapitres.

[V\xC9RIFICATION FINALE OBLIGATOIRE]
Relire mentalement \xE0 haute voix. Si cela sonne comme une traduction, R\xC9\xC9CRIRE.
Le texte DOIT sembler \xE9crit ORIGINELLEMENT en fran\xE7ais par un auteur francophone.`,de:`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
DEUTSCHE REDAKTIONS- UND STILSTANDARDS - PROFESSIONELL LITERARISCH (PFLICHT)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[TYPOGRAFIE - KRITISCH - PFLICHT]
- DIALOGE: AUSSCHLIESSLICH Anf\xFChrungszeichen \u201E..." (unten-oben) verwenden. NICHT \xBB...\xAB.
  \u2713 KORREKT: \u201EHallo", sagte Maria. \u201EWie geht es dir?"
  \u2713 KORREKT: \u201EIch wei\xDF nicht", sagte er. \u201EVielleicht morgen."
  \u2717 FALSCH: \xBBHallo\xAB, sagte Maria. (Chevrons NICHT f\xFCr Dialoge)
  \u2717 FALSCH: "Hallo", sagte Maria. (englische Anf\xFChrungszeichen)
  \u2717 FALSCH: \xABHallo\xBB, sagte Maria. (franz\xF6sische Guillemets)
- ZITAT IM ZITAT: Einfache Anf\xFChrungszeichen \u201A...' innerhalb von \u201E...".
  \u2713 \u201EEr sagte: \u201AKomm her!' und ging weiter."
- KOMMA BEI DIALOGEN: Komma VOR der Zuschreibung, Punkt NACH Abschluss.
  \u2713 \u201EIch komme", sagte er.
  \u2713 \u201EIch komme", sagte er, \u201Eaber erst sp\xE4ter."
  \u2713 \u201EIch komme." Er stand auf.
- ZAHLEN: Eins bis neun ausschreiben, ab 10 Ziffern.

[SATZSTRUKTUR - KRITISCH]
- WORTSTELLUNG: Nat\xFCrliche deutsche Wortstellung. Verb an ZWEITER Stelle im Hauptsatz.
  \u2713 "Gestern ging er nach Hause" (Verb an 2. Stelle)
- NEBENS\xC4TZE: Verb am Ende.
  \u2713 "Er sagte, dass er m\xFCde sei"
- SATZL\xC4NGE: Maximum 40-45 W\xF6rter. L\xE4ngere S\xE4tze AUFTEILEN.
- KLAMMERS\xC4TZE: Nicht zu viele Einsch\xFCbe zwischen Subjekt und Verb.

[ZU VERMEIDENDE KONSTRUKTIONEN - KRITISCH]
- KEINE ANGLIZISMEN:
  \u2717 "Das macht Sinn" \u2192 \u2713 "Das ergibt Sinn", "Das ist sinnvoll"
  \u2717 "Realisieren" (im Sinne von erkennen) \u2192 \u2713 "Erkennen", "Begreifen"
- KEINE SUBSTANTIVITIS:
  \u2717 "Die Durchf\xFChrung der Untersuchung" \u2192 \u2713 "Die Untersuchung durchf\xFChren"
- KEINE PASSIV-H\xC4UFUNG:
  \u2717 "Es wurde beschlossen" \u2192 \u2713 "Man beschloss", "Sie beschlossen"
- KEINE WIEDERHOLUNGEN: Nie dasselbe Wort in aufeinanderfolgenden S\xE4tzen.

[FL\xDCSSIGKEIT UND NAT\xDCRLICHKEIT - WESENTLICH]
- KOMPOSITA: Nat\xFCrlich verwenden, aber nicht zu lang (max. 3-4 Teile).
- MODALPARTIKELN: Ja, doch, mal, eben, halt in Dialogen f\xFCr Nat\xFCrlichkeit.
  \u2713 "Komm doch mal her" (nat\xFCrlicher Dialog)
- KONJUNKTIV: F\xFCr indirekte Rede Konjunktiv I wenn m\xF6glich.
- RHYTHMUS: Kurze S\xE4tze f\xFCr Spannung, l\xE4ngere f\xFCr Beschreibung.
- REGISTER: Literarisch modern, weder zu formell noch zu umgangssprachlich.

[DU / SIE - KRITISCH]
- ABSOLUTE KONSISTENZ: Die Anrede (du/Sie) zwischen zwei Figuren MUSS KONSTANT bleiben.
- GRUNDREGEL:
  \u2022 Kollegen/Freunde/Familie \u2192 Duzen (du)
  \u2022 Vorgesetzte/Fremde/Respekt \u2192 Siezen (Sie)
  \u2022 Herr/Frau + Nachname \u2192 IMMER Sie
- \xDCBERG\xC4NGE: Wenn eine Figur vom Sie zum Du wechselt, muss es ein BEDEUTSAMER, expliziter Moment sein.
  \u2713 \u201EWollen wir uns duzen?" dann klarer \xDCbergang.
  \u2717 Zwischen du/Sie wechseln ohne Erkl\xE4rung = SCHWERER FEHLER.
- \xDCBERPR\xDCFUNG: Jedes Figurenpaar durchgehen und Konsistenz der Anrede pr\xFCfen.

[KAPITEL\xDCBERSCHRIFTEN-FORMAT - PFLICHT]
- FORMAT: "# Kapitel X: Titel" (H1 in Markdown, mit Doppelpunkt)
  \u2713 # Kapitel 1: Der Anfang
  \u2713 # Prolog
  \u2713 # Epilog
  \u2717 ## Kapitel 1 (nicht H2)
  \u2717 Kapitel 1 - Titel (kein Bindestrich)
  \u2717 KAPITEL 1: TITEL (nicht alles Gro\xDFbuchstaben)
- TITELSCHREIBUNG: Erster Buchstabe gro\xDF, Rest klein (au\xDFer Eigennamen).
  \u2713 # Kapitel 5: Die Nacht f\xE4llt \xFCber Berlin
  \u2717 # Kapitel 5: DIE NACHT F\xC4LLT \xDCBER BERLIN
- KEINE TRENNLINIEN: Keine --- oder === zwischen Kapiteln.

[ENDKONTROLLE - PFLICHT]
Mental laut lesen. Wenn es wie eine \xDCbersetzung klingt, UMSCHREIBEN.
Der Text MUSS klingen, als w\xE4re er URSPR\xDCNGLICH von einem deutschen Muttersprachler geschrieben.`,it:`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
NORME EDITORIALI E FLUIDIT\xC0 - ITALIANO LETTERARIO PROFESSIONALE (OBBLIGATORIO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[TIPOGRAFIA - CRITICO]
- DIALOGHI: Usare ESCLUSIVAMENTE il trattino lungo (\u2014) per introdurre i dialoghi. MAI usare virgolette ("", \xAB\xBB, <<>>).
  \u2713 CORRETTO: \u2014Ciao \u2014disse Maria\u2014. Come stai?
  \u2717 SBAGLIATO: \xABCiao\xBB disse Maria. / "Ciao" disse Maria.
- INCISI: Il trattino lungo chiude l'inciso: \u2014Non so \u2014rispose lui\u2014. Forse domani.
- PUNTEGGIATURA: Il punto finale va DOPO il trattino di chiusura inciso.
- NUMERI: Scrivere in lettere da uno a nove, cifre da 10 in poi.
- ACCENTI: Attenzione a: \xE8 (verbo)/e (congiunzione), perch\xE9/poich\xE9, n\xE9/ne, s\xE9/se, l\xE0/la, gi\xE0, pi\xF9, pu\xF2, gi\xF9.

[PRONOMI - CRITICO PER LA LEGGIBILIT\xC0]
- VIETATI ASSOLUTI: MAI usare "Egli", "Ella", "Esso", "Essa", "Essi", "Esse", "Costui", "Costei", "Codesto". 
  Questi pronomi suonano ARCAICI e rendono il testo ILLEGGIBILE nell'italiano moderno.
- USARE SEMPRE: lui, lei, loro, questo, quella, quello.
- PREFERIRE IL NOME: Quando possibile, ripetere il nome del personaggio invece di usare pronomi ambigui.
  \u2713 "Marco guard\xF2 Elena. Marco sorrise." invece di "Marco guard\xF2 Elena. Egli sorrise."
- SOGGETTO IMPLICITO: L'italiano permette di omettere il soggetto. Usare questa caratteristica!
  \u2713 "Entr\xF2 nella stanza e si sedette." (NON "Lui entr\xF2 nella stanza e lui si sedette.")

[COSTRUZIONI DA EVITARE - CRITICO]
- NO CALCHI DALLO SPAGNOLO/INGLESE:
  \u2717 "Stava camminando" \u2192 \u2713 "Camminava" (perifrasi progressiva eccessiva)
  \u2717 "Che cosa \xE8 che..." \u2192 \u2713 Costruzione diretta
  \u2717 "\xC8 stato lui a fare" \u2192 \u2713 "L'ha fatto lui" (quando possibile)
- NO GERUNDI CONCATENATI:
  \u2717 "Camminando, pensando, guardando..." \u2192 \u2713 Dividere in frasi separate
- NO FRASI TROPPO LUNGHE:
  Massimo 35-40 parole per frase. Frasi oltre 45 parole DEVONO essere divise.
- NO PASSIVO ECCESSIVO:
  \u2717 "La porta fu aperta da lui" \u2192 \u2713 "Apr\xEC la porta"

[FLUIDIT\xC0 E NATURALEZZA - ESSENZIALE]
- RITMO NARRATIVO: Alternare frasi brevi (azione, tensione) con frasi pi\xF9 lunghe (descrizione, riflessione).
- CONNETTIVI NATURALI: Usare "poi", "quindi", "allora", "cos\xEC" in modo naturale, non meccanico.
- ORDINE DELLE PAROLE: L'italiano ha ordine flessibile. Sfruttarlo per enfasi e ritmo.
  \u2713 "A casa torn\xF2 solo a mezzanotte" (enfasi su "a casa")
- RIPETIZIONI: Evitare la stessa parola in frasi consecutive. Usare sinonimi o ristrutturare.
- REGISTRO: Mantenere un registro letterario moderno, non accademico n\xE9 troppo colloquiale.
- ESPRESSIONI IDIOMATICHE: Tradurre il SENSO, non le parole. Usare espressioni italiane equivalenti.

[TU / LEI - CRITICO]
- COERENZA ASSOLUTA: Il trattamento (tu/Lei) tra due personaggi DEVE essere COSTANTE.
- REGOLA BASE:
  \u2022 Colleghi/amici/famiglia \u2192 dare del tu
  \u2022 Superiori/sconosciuti/rispetto \u2192 dare del Lei
  \u2022 Signor/Signora + cognome \u2192 SEMPRE Lei
- TRANSIZIONI: Se un personaggio passa dal Lei al tu, deve essere un MOMENTO significativo, esplicito.
  \u2713 "Possiamo darci del tu?" poi transizione chiara.
  \u2717 Alternare tu/Lei senza spiegazione = ERRORE GRAVE.
- VERIFICA: Controllare ogni coppia di personaggi per coerenza del trattamento.

[FORMATO TITOLI CAPITOLI - OBBLIGATORIO]
- FORMATO: "# Capitolo X: Titolo" (H1 in Markdown, con due punti)
  \u2713 # Capitolo 1: L'inizio
  \u2713 # Prologo
  \u2713 # Epilogo
  \u2717 ## Capitolo 1 (non H2)
  \u2717 Capitolo 1 - Titolo (non usare trattino)
  \u2717 CAPITOLO 1: TITOLO (non tutto maiuscolo)
- MAIUSCOLE DEL TITOLO: Prima lettera maiuscola, resto minuscolo (eccetto nomi propri).
  \u2713 # Capitolo 5: La notte cala su Roma
  \u2717 # Capitolo 5: LA NOTTE CALA SU ROMA
- NESSUN SEPARATORE: Nessuna linea --- o === tra capitoli.

[VERIFICA FINALE OBBLIGATORIA]
Prima di consegnare, rileggere ad alta voce mentalmente. Se suona come una traduzione, RISCRIVERE.
Il testo DEVE sembrare scritto ORIGINARIAMENTE in italiano da un autore madrelingua.`,pt:`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
NORMAS EDITORIAIS E FLUIDEZ - PORTUGU\xCAS LITER\xC1RIO PROFISSIONAL (OBRIGAT\xD3RIO)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[TIPOGRAFIA - CR\xCDTICO]
- DI\xC1LOGOS: Usar EXCLUSIVAMENTE travess\xE3o (\u2014) para introduzir di\xE1logos.
  \u2713 CORRETO: \u2014 Ol\xE1 \u2014 disse Maria. \u2014 Como est\xE1s?
  \u2717 ERRADO: "Ol\xE1" disse Maria.
- INCISOS: O travess\xE3o fecha o inciso: \u2014 N\xE3o sei \u2014 respondeu ele. \u2014 Talvez amanh\xE3.
- ASPAS: Curvas " " para cita\xE7\xF5es. Simples ' ' para cita\xE7\xF5es dentro de cita\xE7\xF5es.
- N\xDAMEROS: Por extenso de um a nove, algarismos a partir de 10.

[COLOCA\xC7\xC3O PRONOMINAL - CR\xCDTICO]
- PR\xD3CLISE: Antes do verbo quando h\xE1 palavra atrativa (n\xE3o, nunca, que, se, etc.).
  \u2713 "N\xE3o me disse nada" / "Que te aconteceu?"
- \xCANCLISE: Depois do verbo no in\xEDcio de frase e em imperativos.
  \u2713 "Disse-me que viria" / "D\xE1-me isso"
- MES\xD3CLISE: No futuro e condicional (mais liter\xE1rio).
  \u2713 "Dir-lhe-ei amanh\xE3" / "F\xE1-lo-ia se pudesse"
- NUNCA come\xE7ar frase com pronome \xE1tono no portugu\xEAs europeu.
  \u2717 "Me disse" \u2192 \u2713 "Disse-me"

[CONSTRU\xC7\xD5ES A EVITAR - CR\xCDTICO]
- SEM BRASILEIRISMOS (para pt-PT) / SEM LUSITANISMOS (para pt-BR):
  Adaptar vocabul\xE1rio \xE0 variante pretendida.
- SEM GER\xDANDIOS EXCESSIVOS:
  \u2717 "Estava caminhando, pensando, olhando..." \u2192 \u2713 Dividir em frases
- SEM VOZ PASSIVA EXCESSIVA:
  \u2717 "A porta foi aberta por ele" \u2192 \u2713 "Ele abriu a porta"
- FRASES: M\xE1ximo 40-45 palavras. Acima disso, DIVIDIR.
- REPETI\xC7\xD5ES: Nunca a mesma palavra em frases consecutivas.

[FLUIDEZ E NATURALIDADE - ESSENCIAL]
- RITMO: Alternar frases curtas (tens\xE3o, a\xE7\xE3o) com longas (descri\xE7\xE3o).
- CONECTORES: Usar "depois", "ent\xE3o", "assim", "por isso" naturalmente.
- REGISTO: Liter\xE1rio moderno, nem demasiado formal nem coloquial.
- EXPRESS\xD5ES IDIOM\xC1TICAS: Traduzir o SENTIDO, usar express\xF5es portuguesas aut\xEAnticas.

[TU / VOC\xCA / O SENHOR - CR\xCDTICO]
- COER\xCANCIA ABSOLUTA: O tratamento entre dois personagens DEVE ser CONSTANTE.
- REGRA BASE (pt-PT):
  \u2022 Colegas/amigos/fam\xEDlia \u2192 tu
  \u2022 Superiores/desconhecidos/respeito \u2192 voc\xEA ou o senhor/a senhora
  \u2022 Senhor/Senhora + apelido \u2192 SEMPRE o senhor/a senhora
- REGRA BASE (pt-BR):
  \u2022 Informal/amigos \u2192 voc\xEA (mais comum)
  \u2022 Formal/respeito \u2192 o senhor/a senhora
- TRANSI\xC7\xD5ES: Se um personagem muda de tratamento, deve ser um MOMENTO significativo.
  \u2713 "Podemos tratar-nos por tu?" e transi\xE7\xE3o clara.
  \u2717 Alternar tratamentos sem explica\xE7\xE3o = ERRO GRAVE.

[FORMATO T\xCDTULOS CAP\xCDTULOS - OBRIGAT\xD3RIO]
- FORMATO: "# Cap\xEDtulo X: T\xEDtulo" (H1 em Markdown, com dois pontos)
  \u2713 # Cap\xEDtulo 1: O Come\xE7o
  \u2713 # Pr\xF3logo
  \u2713 # Ep\xEDlogo
  \u2717 ## Cap\xEDtulo 1 (n\xE3o H2)
  \u2717 Cap\xEDtulo 1 - T\xEDtulo (n\xE3o usar travess\xE3o)
  \u2717 CAP\xCDTULO 1: T\xCDTULO (n\xE3o tudo mai\xFAsculas)
- MAI\xDASCULAS DO T\xCDTULO: Primeira letra mai\xFAscula, resto min\xFAsculas (exceto nomes pr\xF3prios).
  \u2713 # Cap\xEDtulo 5: A noite cai sobre Lisboa
  \u2717 # Cap\xEDtulo 5: A NOITE CAI SOBRE LISBOA
- SEM SEPARADORES: Nenhuma linha --- ou === entre cap\xEDtulos.

[VERIFICA\xC7\xC3O FINAL OBRIGAT\xD3RIA]
Reler mentalmente em voz alta. Se soar como tradu\xE7\xE3o, REESCREVER.
O texto DEVE parecer escrito ORIGINALMENTE em portugu\xEAs por um autor nativo.`,ca:`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
NORMES EDITORIALS I FLU\xCFDESA - CATAL\xC0 LITERARI PROFESSIONAL (OBLIGATORI)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

[TIPOGRAFIA - CR\xCDTIC]
- DI\xC0LEGS: Usar EXCLUSIVAMENT gui\xF3 llarg (\u2014) per introduir di\xE0legs.
  \u2713 CORRECTE: \u2014Hola \u2014va dir Maria\u2014. Com est\xE0s?
  \u2717 INCORRECTE: "Hola" va dir Maria. / \xABHola\xBB va dir Maria.
- INCISOS: El gui\xF3 llarg tanca l'inc\xEDs: \u2014No ho s\xE9 \u2014va respondre ell\u2014. Potser dem\xE0.
- COMETES: Baixes \xAB \xBB per a citacions. Altes " " per a citacions dins de citacions.
- N\xDAMEROS: Lletres de l'u al nou, xifres del 10 endavant.
- PUNTUACI\xD3: Signes d'interrogaci\xF3 i exclamaci\xF3 nom\xE9s al final (no al principi com en castell\xE0).
  \u2713 "Qu\xE8 vols?" (NO "\xBFQu\xE8 vols?")

[PRONOMS FEBLES - CR\xCDTIC]
- COMBINACIONS: Usar correctament les combinacions de pronoms febles.
  \u2713 "Li'l donar\xE9" / "Me'n vaig" / "T'ho he dit"
- APOSTROFACI\xD3: Apostrofar correctament davant vocal.
  \u2713 "L'he vist" / "M'ha dit" / "N'hi ha"
- POSICI\xD3: Davant el verb en indicatiu/subjuntiu, darrere en imperatiu/infinitiu/gerundi.
  \u2713 "Ho faig" vs "Fes-ho" / "Fer-ho"

[CONSTRUCCIONS A EVITAR - CR\xCDTIC]
- RES DE CASTELLANISMES:
  \u2717 "Doncs" (al principi de frase) \u2192 \u2713 "B\xE9", "Aix\xED"
  \u2717 "Bueno" \u2192 \u2713 "B\xE9", "D'acord"
  \u2717 "Vale" \u2192 \u2713 "D'acord", "Molt b\xE9"
  \u2717 "Entonces" \u2192 \u2713 "Aleshores", "Llavors"
- RES DE CALCS DEL CASTELL\xC0:
  \u2717 "Fer-se passar per" \u2192 \u2713 "Fer passar-se per"
  \u2717 "Tenir que" \u2192 \u2713 "Haver de"
- FRASES: M\xE0xim 40-45 paraules. Per sobre, DIVIDIR.
- REPETICIONS: Mai la mateixa paraula en frases consecutives.

[FLU\xCFDESA I NATURALITAT - ESSENCIAL]
- RITME: Alternar frases curtes (tensi\xF3, acci\xF3) amb llargues (descripci\xF3).
- CONNECTORS: Usar "despr\xE9s", "aleshores", "aix\xED", "per aix\xF2" naturalment.
- REGISTRE: Literari modern, ni massa formal ni col\xB7loquial.
- EXPRESSIONS IDIOM\xC0TIQUES: Traduir el SENTIT, usar expressions catalanes aut\xE8ntiques.
- VARIETAT: Usar vocabulari catal\xE0 genu\xED, no catalanitzacions del castell\xE0.

[TU / VOST\xC8 - CR\xCDTIC]
- COHER\xC8NCIA ABSOLUTA: El tractament (tu/vost\xE8) entre dos personatges HA DE ser CONSTANT.
- REGLA BASE:
  \u2022 Companys/amics/fam\xEDlia \u2192 tuteig (tu)
  \u2022 Superiors/desconeguts/respecte \u2192 vost\xE8
  \u2022 Senyor/Senyora + cognom \u2192 SEMPRE vost\xE8
- TRANSICIONS: Si un personatge passa del vost\xE8 al tu, ha de ser un MOMENT significatiu, expl\xEDcit.
  \u2713 "Podem tutejar-nos?" i transici\xF3 clara.
  \u2717 Alternar tu/vost\xE8 sense explicaci\xF3 = ERROR GREU.

[FORMAT T\xCDTOLS CAP\xCDTOLS - OBLIGATORI]
- FORMAT: "# Cap\xEDtol X: T\xEDtol" (H1 en Markdown, amb dos punts)
  \u2713 # Cap\xEDtol 1: El Comen\xE7ament
  \u2713 # Pr\xF2leg
  \u2713 # Ep\xEDleg
  \u2717 ## Cap\xEDtol 1 (no H2)
  \u2717 Cap\xEDtol 1 - T\xEDtol (no usar gui\xF3)
  \u2717 CAP\xCDTOL 1: T\xCDTOL (no tot en maj\xFAscules)
- MAJ\xDASCULES DEL T\xCDTOL: Primera lletra maj\xFAscula, resta min\xFAscules (excepte noms propis).
  \u2713 # Cap\xEDtol 5: La nit cau sobre Barcelona
  \u2717 # Cap\xEDtol 5: LA NIT CAU SOBRE BARCELONA
- SENSE SEPARADORS: Cap l\xEDnia --- o === entre cap\xEDtols.

[VERIFICACI\xD3 FINAL OBLIGAT\xD2RIA]
Rellegir mentalment en veu alta. Si sona com una traducci\xF3, REESCRIURE.
El text HA DE semblar escrit ORIGINALMENT en catal\xE0 per un autor nadiu.`},bie={en:["suddenly","shrouded","unfold","crucial","pivotal","amidst","whilst","endeavor","plethora","myriad","utilize","facilitate","commence","terminate","subsequently","aforementioned","nevertheless","furthermore","enigmatic","palpable","tangible","visceral","resonate","unravel","delve","tapestry","intricacies","nuanced","multifaceted","paradigm","synergy","holistic","robust","leverage","juxtaposition","dichotomy"],es:["de repente","s\xFAbitamente","crucial","fundamental","sin embargo","no obstante","por consiguiente","asimismo","adem\xE1s","enigm\xE1tico","palpable","tangible","visceral","desentra\xF1ar","en aras de","cabe destacar","es menester","en pos de","a la saz\xF3n","otrora"],fr:["soudain","crucial","essentiel","n\xE9anmoins","cependant","toutefois","ainsi","par cons\xE9quent","en effet","d'ailleurs","en outre","de plus","\xE9nigmatique","palpable","tangible","visc\xE9ral","r\xE9sonner","d\xE9mystifier","paradigme","synergie","holistique","robuste"],de:["pl\xF6tzlich","entscheidend","wesentlich","nichtsdestotrotz","jedoch","dennoch","folglich","dar\xFCber hinaus","au\xDFerdem","r\xE4tselhaft","greifbar","sp\xFCrbar","eindringlich","paradigmatisch","ganzheitlich","robust","Synergie","multifaktoriell","nuanciert"],it:["improvvisamente","cruciale","fondamentale","tuttavia","nondimeno","pertanto","inoltre","enigmatico","palpabile","tangibile","viscerale","egli","ella","esso","essa","essi","esse","costui","costei","codesto","suddetto","medesimo","siffatto","allorch\xE9","allorquando","indi","quivi","onde","laonde","giacch\xE9","imperocch\xE9","avvegnach\xE9","epper\xF2","altres\xEC","invero","precipuamente","segnatamente","paradigmatico","olistico","robusto","sinergia"],pt:["subitamente","repentinamente","crucial","fundamental","todavia","contudo","portanto","al\xE9m disso","enigm\xE1tico","palp\xE1vel","tang\xEDvel","paradigm\xE1tico","hol\xEDstico","robusto","sinergia","multifacetado","nuan\xE7ado","outrossim","destarte","mister"],ca:["sobtadament","crucial","fonamental","tanmateix","no obstant aix\xF2","per tant","a m\xE9s","enigm\xE0tic","palpable","tangible","paradigm\xE0tic","hol\xEDstic","robust","sinergia","altrament"]},vie=`
You are an ELITE LITERARY TRANSLATOR and NATIVE EDITOR. Your mission is to translate literary texts while maintaining the author's voice, subtext, and narrative power.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CORE PHILOSOPHY: HUMANIZED LITERARY TRANSLATION
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. LOCALIZATION OVER LITERALITY
   - Do NOT translate words; translate INTENTIONS.
   - Adapt phrases, idioms, and rhythm so the text feels as if it was ORIGINALLY WRITTEN in the target language.
   - AVOID at all costs "translationese" (language that sounds like a translation).

2. GENRE CONVENTIONS
   - Respect the genre's tone. Match vocabulary to the genre style:
     * Thriller/Mystery: Terse, direct, visceral
     * Romance: Emotionally rich, flowing
     * Historical Fiction: Period-appropriate, avoiding anachronisms
     * Literary Fiction: Elegant, precise, layered
   - Specialized terms must be accurate and NOT modernized or oversimplified.

3. PROSE DYNAMICS (FLOW)
   - Humans vary sentence length. Mix long, complex sentences with short, punchy ones.
   - Fast-paced action scenes: Keep the rapid rhythm.
   - Reflective scenes: Let the prose breathe.

4. SENSORY IMMERSION (SHOW, DON'T TELL)
   - Translate physical sensations with VISCERAL precision.
   - Use STRONG action verbs that convey textures, smells, and sounds vividly.
   - Avoid generic verbs; seek vivid alternatives.

5. SUBTEXT AND CHARACTER VOICE
   - Capture the PSYCHOLOGY behind words.
   - Reflect emotional state, education level, and personality through:
     * Dialogue: How characters SPEAK
     * Internal monologue: How characters THINK

6. ANTI-AI FILTER
   - FORBIDDEN to use typical AI translation crutches.
   - Seek rarer, more human literary alternatives.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CRITICAL OUTPUT RULES
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. YOU MUST TRANSLATE - Output MUST be in TARGET LANGUAGE, NOT source.
2. NEVER return original text unchanged - that is a FAILURE.
3. NEVER omit or summarize. Translation must be COMPLETE.
4. PRESERVE paragraph structure and dialogues exactly.
5. APPLY correct typographical rules for target language.

CHAPTER HEADER TRANSLATION (MANDATORY):
- ALWAYS translate chapter headers/titles to target language.
- "Cap\xEDtulo 1: El Comienzo" \u2192 "Chapter 1: The Beginning" (en-US/en-GB)
- "Pr\xF3logo" \u2192 "Prologue" (en), "Prolog" (de), "Prologo" (it)
- "Ep\xEDlogo" \u2192 "Epilogue" (en), "Epilog" (de), "Epilogo" (it)
- "Nota del Autor" \u2192 "Author's Note" (en), "Note de l'Auteur" (fr)
- NEVER leave Spanish headers like "Cap\xEDtulo", "Pr\xF3logo", "Ep\xEDlogo" in non-Spanish translations.

FORBIDDEN IN OUTPUT:
- Style guides, writing guides, checklists, tips
- Meta-commentary about style or techniques
- ANY instructional content about writing
- Sections titled "Literary Style Guide", "Checklist", etc.
- Separator lines (---, ***, ===) - NEVER include these
- Dividers of any kind between sections

OUTPUT FORMAT (JSON ONLY):
{
  "translated_text": "Complete translated text in Markdown - MUST BE IN TARGET LANGUAGE",
  "source_language": "ISO code",
  "target_language": "ISO code", 
  "notes": "Brief notes on key translation decisions"
}
`,Dm=class extends Ae{constructor(){super({name:"El Traductor",role:"translator",systemPrompt:vie,model:"deepseek-chat",useThinking:!1,useTranslatorClient:!0})}applyFrenchTypography(e){let t=e;return t=t.replace(/^(\s*)(?:--|[-])(\s*)/gm,"$1\u2014 "),t=t.replace(/^(\s*)\s*/gm,"$1\u2014 "),t=t.replace(/\s*([;:?!])/g,"\xA0$1"),t=t.replace(/\s*/g,"\xAB "),t=t.replace(/\s*/g," \xBB"),t=t.replace(/^(\s*)\s*([^]+?)\s*\s*,?\s*(dit|rpondit|demanda|murmura|cria|chuchota|s'exclama|ajouta|reprit|interrompit|souffla|gmit|hurla|supplia)/gm,"$1\u2014 $2, $3"),t=t.replace(/  +/g," "),t=t.replace(/^\s{2,}/gm,"\u2014 "),console.log("[Translator] Applied French typography rules"),t}applySpanishTypography(e){let t=e;return t=t.replace(/^(\s*)(?:--|[-])\s*/gm,"$1\u2014"),t=t.replace(/^(\s*)\s+/gm,"$1\u2014"),t=t.replace(/^(\s*)([^]+)\s*,?\s*(dijo|respondi|pregunt|murmur|grit|susurr|exclam|aadi|replic|interrumpi)/gm,"$1\u2014$2 \u2014$3"),t=t.replace(/^(\s*)"([^"]+)"\s*,?\s*(dijo|respondi|pregunt|murmur|grit|susurr|exclam|aadi|replic|interrumpi)/gm,"$1\u2014$2 \u2014$3"),t=t.replace(/  +/g," "),console.log("[Translator] Applied Spanish typography rules"),t}applyItalianTypography(e){let t=e;return t=t.replace(/^(\s*)(?:--|[-])\s*/gm,"$1\u2014"),t=t.replace(/^(\s*)\s+/gm,"$1\u2014"),t=t.replace(/^(\s*)([^]+)\s*,?\s*(disse|rispose|domand|mormor|grid|sussurr|esclam|aggiunse|replic|interruppe)/gm,"$1\u2014$2 \u2014$3"),t=t.replace(/^(\s*)"([^"]+)"\s*,?\s*(disse|rispose|domand|mormor|grid|sussurr|esclam|aggiunse|replic|interruppe)/gm,"$1\u2014$2 \u2014$3"),t=t.replace(/  +/g," "),console.log("[Translator] Applied Italian typography rules"),t}applyPortugueseTypography(e){let t=e;return t=t.replace(/^(\s*)(?:--|[-])(\s*)/gm,"$1\u2014 "),t=t.replace(/^(\s*)\s*/gm,"$1\u2014 "),t=t.replace(/^(\s*)"([^"]+)"\s*,?\s*(disse|respondeu|perguntou|murmurou|gritou|sussurrou|exclamou|acrescentou|replicou|interrompeu)/gm,"$1\u2014 $2 \u2014 $3"),t=t.replace(/  +/g," "),t=t.replace(/^\s{2,}/gm,"\u2014 "),console.log("[Translator] Applied Portuguese typography rules"),t}applyCatalanTypography(e){let t=e;return t=t.replace(/^(\s*)(?:--|[-])\s*/gm,"$1\u2014"),t=t.replace(/^(\s*)\s+/gm,"$1\u2014"),t=t.replace(/^(\s*)([^]+)\s*,?\s*(va dir|va respondre|va preguntar|va murmurar|va cridar|va xiuxiuejar|va exclamar|va afegir|va replicar|va interrompre)/gm,"$1\u2014$2 \u2014$3"),t=t.replace(//g,""),t=t.replace(//g,""),t=t.replace(/  +/g," "),console.log("[Translator] Applied Catalan typography rules"),t}applyGermanTypography(e){let t=e;return t=t.replace(/"([^"]+)"/g,'\u201E$1"'),t=t.replace(/([^]+)/g,'\u201E$1"'),t=t.replace(/([^]+)/g,'\u201E$1"'),t=t.replace(//g,'"'),t=t.replace(//g,"\u201E"),t=t.replace(/  +/g," "),console.log("[Translator] Applied German typography rules"),t}normalizeChapterHeaders(e,t){let n=e,a={es:{chapter:"Cap\xEDtulo",prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo"},en:{chapter:"Chapter",prologue:"Prologue",epilogue:"Epilogue"},"en-US":{chapter:"Chapter",prologue:"Prologue",epilogue:"Epilogue"},"en-GB":{chapter:"Chapter",prologue:"Prologue",epilogue:"Epilogue"},fr:{chapter:"Chapitre",prologue:"Prologue",epilogue:"\xC9pilogue"},de:{chapter:"Kapitel",prologue:"Prolog",epilogue:"Epilog"},it:{chapter:"Capitolo",prologue:"Prologo",epilogue:"Epilogo"},pt:{chapter:"Cap\xEDtulo",prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo"},"pt-PT":{chapter:"Cap\xEDtulo",prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo"},"pt-BR":{chapter:"Cap\xEDtulo",prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo"},ca:{chapter:"Cap\xEDtol",prologue:"Pr\xF2leg",epilogue:"Ep\xEDleg"}},s=a[t]||a.en;n=n.replace(/^[-=*]{3,}\s*$/gm,"");let o=[/^#{2,}\s*((?:Captulo|Chapter|Chapitre|Kapitel|Capitolo|Captol)\s+\d+)/gmi,/^#{2,}\s*((?:Prlogo|Prologue|Prolog|Prologo|Prleg))/gmi,/^#{2,}\s*((?:Eplogo|Epilogue|Epilog|Epilogo|Epleg|pilogue))/gmi];for(let i of o)n=n.replace(i,"# $1");return n=n.replace(/^#\s*((?:Captulo|Chapter|Chapitre|Kapitel|Capitolo|Captol)\s+\d+)\s*[-]\s*/gmi,"# $1: "),n=n.replace(/^(#\s*(?:Captulo|Chapter|Chapitre|Kapitel|Capitolo|Captol)\s+\d+:\s*)([A-Z\s]+)$/gm,(i,u,c)=>{let p=c.toLowerCase(),m=p.charAt(0).toUpperCase()+p.slice(1);return u+m}),n=n.replace(/\n{3,}/g,`

`),console.log(`[Translator] Normalized chapter headers for ${t}`),n}cleanTranslatedText(e,t){let n=e.trim(),a=n.match(/^```(?:json|markdown|md)?\s*([\s\S]*?)```\s*$/);if(a&&(n=a[1].trim()),n=n.replace(/```(?:json|markdown|md|text)?\n?/g,"").replace(/```\s*$/g,""),n.startsWith("{")&&n.includes('"translated_text"'))try{let o=JSON.parse(n);o.translated_text&&(n=this.cleanTranslatedText(o.translated_text,t))}catch{let o=n.match(/"translated_text"\s*:\s*"([\s\S]*?)(?:"\s*,\s*"(?:source_|target_|notes)|\s*"\s*})/);o&&(n=o[1].replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\"))}let s=[/^#+ *(?:Literary Style Guide|Writing Guide|Style Guide|Gua de Estilo|Gua de Escritura)[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|CAPTULO|Captulo|Prologue|Prlogo|Epilogue|Eplogo|CAPITOLO|Capitolo)\b|\n---\n)/gmi,/^###+ *(?:Checklist|Lista de verificacin)[^\n]*\n[\s\S]*?(?=^#{1,2} *(?:CHAPTER|Chapter|CAPTULO|Captulo|Prologue|Prlogo)\b|\n---\n)/gmi,/\n---\n[\s\S]*?(?:Style Guide|Gua de Estilo|Writing Guide)[\s\S]*?\n---\n/gi];for(let o of s){let i=n.replace(o,"");i.trim().length>50&&(n=i)}if(n=n.replace(/,?\s*"(?:source_language|target_language|notes)"\s*:\s*"[^"]*"\s*}?\s*$/g,""),n=n.replace(/^\s*\{\s*"translated_text"\s*:\s*"/m,""),n=n.replace(/"\s*,?\s*"notes"\s*:\s*"[^"]*"\s*\}\s*$/m,""),t){switch(t){case"fr":n=this.applyFrenchTypography(n);break;case"es":n=this.applySpanishTypography(n);break;case"it":n=this.applyItalianTypography(n);break;case"pt":case"pt-PT":case"pt-BR":n=this.applyPortugueseTypography(n);break;case"ca":n=this.applyCatalanTypography(n);break;case"de":n=this.applyGermanTypography(n);break}n=this.normalizeChapterHeaders(n,t)}return n.trim()}async execute(e){let t=s4[e.sourceLanguage]||e.sourceLanguage,n=s4[e.targetLanguage]||e.targetLanguage,a=yie[e.targetLanguage]||"",s=bie[e.targetLanguage]||[],o=e.chapterTitle?`
CAP\xCDTULO: ${e.chapterNumber!==void 0?e.chapterNumber:""} - ${e.chapterTitle}`:"",i=s.length>0?`
[ANTI-AI FILTER - FORBIDDEN WORDS IN ${n.toUpperCase()}]
The following words/phrases are BANNED. Find literary alternatives:
${s.map(m=>`\u2022 "${m}"`).join(`
`)}
`:"",u=`
TASK: HUMANIZED LITERARY TRANSLATION from ${t.toUpperCase()} to ${n.toUpperCase()}.

CRITICAL: The output "translated_text" MUST BE WRITTEN ENTIRELY IN ${n.toUpperCase()}. 
DO NOT return the text in ${t} - that would be a FAILURE.

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
TRANSLATION PHILOSOPHY
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u2022 LOCALIZATION over LITERALITY: Translate INTENTIONS, not words.
\u2022 The text must feel ORIGINALLY WRITTEN in ${n}.
\u2022 AVOID "translationese" at all costs.
\u2022 Capture SUBTEXT and CHARACTER VOICE through dialogue and internal monologue.
\u2022 VARY sentence length: mix long complex sentences with short punchy ones.
\u2022 Use STRONG, VIVID action verbs for sensory immersion.
${i}
${a}
${o}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
SOURCE TEXT (in ${t} - TO BE TRANSLATED):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

${e.content}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

FINAL INSTRUCTIONS:
1. TRANSLATE the complete text from ${t} to ${n}
2. The "translated_text" field MUST contain text in ${n}, NOT in ${t}
3. Preserve the literary style, narrative voice and author's intentions
4. Apply the typographical rules of ${n}
5. AVOID banned AI crutch words - use literary alternatives
6. Return the result as valid JSON only

RESPOND WITH JSON ONLY, no additional text.
`;console.log(`[Translator] Starting translation from ${e.sourceLanguage} to ${e.targetLanguage}`),console.log(`[Translator] Content length: ${e.content.length} chars`);let c=await this.generateContent(u,e.projectId);if(c.error)return console.error("[Translator] AI generation error:",c.error),{...c,result:{translated_text:"",source_language:e.sourceLanguage,target_language:e.targetLanguage,notes:`Error: ${c.error}`}};try{let m=c.content,f=m.match(/```(?:json)?\s*([\s\S]*?)```/);f&&(m=f[1].trim(),console.log("[Translator] Stripped markdown code block from response"));let g=m.match(/\{[\s\S]*\}/);if(g){let y=JSON.parse(g[0]),C=this.cleanTranslatedText(y.translated_text,e.targetLanguage);return console.log("[Translator] Successfully parsed and cleaned translation result"),{...c,result:{...y,translated_text:C}}}}catch(m){console.error("[Translator] Failed to parse JSON response:",m)}let p=this.cleanTranslatedText(c.content,e.targetLanguage);return console.log("[Translator] Using cleaned fallback content"),{...c,result:{translated_text:p,source_language:e.sourceLanguage,target_language:e.targetLanguage,notes:"Respuesta no estructurada - contenido limpiado y devuelto"}}}}});var Ox={};wr(Ox,{GuideGeneratorAgent:()=>lb,guideGeneratorAgent:()=>Cie});var Eie,lb,Cie,Nx=G(()=>{"use strict";It();Eie=`Eres un experto en planificaci\xF3n de novelas. Tu trabajo es generar una GU\xCDA DE ESCRITURA completa y detallada para una novela bas\xE1ndote en:
1. Un argumento/sinopsis proporcionado
2. El g\xE9nero y tono preferidos
3. La gu\xEDa de estilo del autor (si se proporciona)
4. El contexto de la serie (si aplica)

DEBES generar una gu\xEDa que siga EXACTAMENTE esta estructura:

---

# GU\xCDA DE ESCRITURA: [T\xCDTULO DE LA NOVELA]

## 1. PREMISA
[Una frase potente que resuma el conflicto central y el gancho emocional]

## 2. G\xC9NERO Y TONO
- **G\xE9nero principal:** [thriller / romance / fantas\xEDa / etc.]
- **Subg\xE9nero:** [si aplica]
- **Tono narrativo:** [oscuro / esperanzador / tenso / etc.]
- **Clasificaci\xF3n:** [adulto / joven adulto]

## 3. TRAMA PRINCIPAL
**Conflicto central:** [Descripci\xF3n del conflicto que atraviesa toda la novela]

**Objetivo del protagonista:** [Qu\xE9 debe lograr]
**Obst\xE1culo principal:** [Qu\xE9 le impide lograrlo]
**Lo que est\xE1 en juego:** [Qu\xE9 pierde si falla]

**Desarrollo por actos:**
- **Acto 1 (cap\xEDtulos 1-X):** [Planteamiento]
- **Punto de giro 1 (~25%):** [Evento que cambia el rumbo]
- **Acto 2 (cap\xEDtulos X-Y):** [Complicaciones]
- **Punto medio (~50%):** [Revelaci\xF3n o crisis]
- **Punto de giro 2 (~75%):** [Crisis mayor]
- **Acto 3 (cap\xEDtulos Y-Z):** [Resoluci\xF3n]

## 4. SUBTRAMAS

### Subtrama 1: [Nombre descriptivo]
- **Personajes:** [nombres]
- **Objetivo:** [qu\xE9 se busca resolver]
- **Cap\xEDtulos:** [lista espec\xEDfica: 3, 7, 12, 18, 25]
- **Resoluci\xF3n:** [c\xF3mo termina]

### Subtrama 2: [Nombre descriptivo]
- **Personajes:** [nombres]
- **Objetivo:** [qu\xE9 se busca resolver]
- **Cap\xEDtulos:** [lista espec\xEDfica]
- **Resoluci\xF3n:** [c\xF3mo termina]

### Subtrama 3: [Nombre descriptivo]
[Repetir estructura]

## 5. PERSONAJES PRINCIPALES

### Protagonista
- **Nombre completo:** 
- **Edad:** 
- **Apariencia f\xEDsica:**
  - Ojos: [color espec\xEDfico]
  - Cabello: [color, largo, estilo]
  - Altura/complexi\xF3n:
  - Rasgos distintivos: [cicatrices, marcas]
- **Personalidad:** [3-5 rasgos dominantes]
- **Motivaci\xF3n principal:** [qu\xE9 quiere por encima de todo]
- **Miedo profundo:** [qu\xE9 teme]
- **Defecto fatal:** [debilidad que causa problemas]
- **Voz/forma de hablar:** [registro, muletillas]
- **Arco de transformaci\xF3n:**
  - Inicio: [c\xF3mo es al principio]
  - Cambio: [qu\xE9 evento lo transforma]
  - Final: [en qu\xE9 se convierte]

### Antagonista
- **Nombre completo:**
- **Relaci\xF3n con protagonista:**
- **Motivaci\xF3n:** [por qu\xE9 hace lo que hace]
- **M\xE9todo:** [c\xF3mo opera]
- **Debilidad:** [qu\xE9 puede derrotarlo]

### Personajes secundarios
[Repetir estructura simplificada para cada uno relevante]

## 6. UBICACIONES

### Ubicaci\xF3n principal: [nombre]
- **\xC9poca/per\xEDodo:**
- **Atm\xF3sfera:** [sensaciones que evoca]
- **Clima t\xEDpico:**
- **Olores caracter\xEDsticos:**
- **Sonidos ambiente:**

### Ubicaciones secundarias:
1. **[Nombre]:** [descripci\xF3n breve]
2. **[Nombre]:** [descripci\xF3n breve]

## 7. L\xCDNEA TEMPORAL
- **\xC9poca:** [a\xF1o/per\xEDodo]
- **Duraci\xF3n de la historia:** [d\xEDas/semanas/meses]
- **Eventos clave con fechas:**
  1. [Fecha]: [evento]
  2. [Fecha]: [evento]

- **Flashbacks planificados:**
  - Cap\xEDtulo X: [a qu\xE9 momento]

## 8. ESTRUCTURA DE CAP\xCDTULOS
- **Total de cap\xEDtulos:** [n\xFAmero]
- **Pr\xF3logo:** [s\xED/no - breve descripci\xF3n si s\xED]
- **Ep\xEDlogo:** [s\xED/no - breve descripci\xF3n si s\xED]
- **Palabras por cap\xEDtulo:** [m\xEDnimo-m\xE1ximo]

### Resumen por cap\xEDtulo:
- **Cap\xEDtulo 1 - "[T\xEDtulo]":** [resumen de 2-3 l\xEDneas + evento clave]
- **Cap\xEDtulo 2 - "[T\xEDtulo]":** [resumen + evento clave]
[Continuar para TODOS los cap\xEDtulos]

## 9. REGLAS DEL MUNDO
- **Tecnolog\xEDa disponible:** [qu\xE9 existe y qu\xE9 no]
- **Sistema de magia/poderes:** [si aplica, reglas y limitaciones]
- **Estructura social:** [clases, gobiernos]
- **Restricciones hist\xF3ricas:** [si es hist\xF3rico]

## 10. RELACIONES ENTRE PERSONAJES
- [Personaje A] \u2194 [Personaje B]: [tipo de relaci\xF3n, evoluci\xF3n]
- [Personaje A] \u2194 [Personaje C]: [tipo de relaci\xF3n, evoluci\xF3n]

**Conflictos interpersonales:**
- [Personaje] vs [Personaje]: [motivo]

## 11. TEMAS Y S\xCDMBOLOS
- **Tema central:** [idea abstracta que explora]
- **Temas secundarios:** [lista]

**S\xEDmbolos recurrentes:**
- [Objeto/elemento]: representa [significado]

**Motivos literarios:**
- [Motivo]: aparece en cap\xEDtulos [X, Y, Z]

## 12. VOZ NARRATIVA Y ESTILO
- **Punto de vista:** [primera persona / tercera limitada / omnisciente]
- **Tiempo verbal:** [pasado / presente]
- **Personaje(s) POV:** [qui\xE9n narra]

**Estilo deseado:**
- Ritmo de frases: [cortas / largas / variado]
- Nivel de descripci\xF3n: [minimalista / moderado / detallado]
- Di\xE1logos: [abundantes / equilibrados / escasos]
- Tono emocional: [contenido / expresivo / intenso]

**Palabras/frases a EVITAR:**
- [lista de palabras prohibidas]

## 13. OBJETOS IMPORTANTES (Chekhov's Gun)
1. **[Objeto]:** se introduce en cap\xEDtulo [X], se usa en cap\xEDtulo [Y]
2. **[Objeto]:** se introduce en cap\xEDtulo [X], se usa en cap\xEDtulo [Y]

## 14. GIROS Y REVELACIONES
1. **Giro 1 (Cap\xEDtulo X):** [qu\xE9 se revela]
   - Pistas previas en cap\xEDtulos: [lista]
2. **Giro 2 (Cap\xEDtulo Y):** [qu\xE9 se revela]
   - Pistas previas en cap\xEDtulos: [lista]

## 15. CLIFFHANGERS PLANIFICADOS
- Final del cap\xEDtulo X: [gancho]
- Final del cap\xEDtulo Y: [gancho]

---

REGLAS CR\xCDTICAS:
1. Las subtramas DEBEN aparecer en m\xEDnimo 3 cap\xEDtulos cada una (idealmente 5+)
2. El protagonista DEBE aparecer en al menos 30% de los cap\xEDtulos
3. Los puntos de giro DEBEN estar en los porcentajes correctos (25%, 50%, 75%)
4. TODOS los objetos importantes deben establecerse ANTES de usarse
5. NO dejar tramas sin resolver al final
6. Los cap\xEDtulos deben tener res\xFAmenes ESPEC\xCDFICOS, no gen\xE9ricos
7. Si es parte de una serie, mantener coherencia con libros anteriores

PREVENCI\xD3N DE DEUS EX MACHINA - OBLIGATORIO:
8. TODA resoluci\xF3n de conflicto debe estar PREPARADA con antelaci\xF3n:
   - Si un personaje tiene una habilidad que salva el d\xEDa, debe mencionarse en cap\xEDtulos anteriores
   - Si un objeto es crucial para la soluci\xF3n, debe aparecer antes (Chekhov's Gun)
   - Si un aliado aparece para ayudar, debe haberse establecido previamente
   - Las coincidencias NO pueden resolver conflictos principales
9. Para cada GIRO o RESOLUCI\xD3N importante:
   - Especifica en qu\xE9 cap\xEDtulos se siembran las PISTAS (m\xEDnimo 2-3 pistas)
   - La primera pista debe aparecer al menos 5 cap\xEDtulos antes del giro
10. Las SOLUCIONES deben surgir de:
   - Habilidades ya demostradas del protagonista
   - Informaci\xF3n ya revelada al lector
   - Objetos/recursos ya establecidos en la historia
   - Aliados ya presentados con motivaci\xF3n clara
11. PROHIBIDO:
   - Personajes nuevos que salvan la situaci\xF3n en el \xFAltimo momento
   - Habilidades ocultas nunca mencionadas que resuelven todo
   - Coincidencias convenientes que solucionan conflictos
   - Revelaciones de \xFAltima hora sin pistas previas

Genera la gu\xEDa COMPLETA en espa\xF1ol. S\xE9 espec\xEDfico y detallado. No uses placeholders gen\xE9ricos.`,lb=class extends Ae{constructor(e=!1){super({name:"guide-generator",role:"Generador de gu\xEDas de escritura",systemPrompt:Eie,model:"deepseek-chat",useTranslatorClient:e})}async execute(){throw new Error("Use generateWritingGuide() instead")}async generateWritingGuide(e){let t=`Genera una gu\xEDa de escritura completa para la siguiente novela:

## ARGUMENTO/SINOPSIS:
${e.argument}

## CONFIGURACI\xD3N:
- **T\xEDtulo propuesto:** ${e.title}
- **G\xE9nero:** ${e.genre}
- **Tono:** ${e.tone}
- **N\xFAmero de cap\xEDtulos:** ${e.chapterCount}
- **Incluye pr\xF3logo:** ${e.hasPrologue?"S\xED":"No"}
- **Incluye ep\xEDlogo:** ${e.hasEpilogue?"S\xED":"No"}
- **Optimizado para Kindle Unlimited:** ${e.kindleUnlimited?"S\xED (cap\xEDtulos cortos, ritmo r\xE1pido, cliffhangers frecuentes)":"No"}
`;return e.styleGuideContent&&(t+=`

## GU\xCDA DE ESTILO DEL AUTOR:
${e.styleGuideContent}

IMPORTANTE: Respeta el estilo, voz y preferencias descritas en la gu\xEDa de estilo del autor.
`),e.seriesContext&&(t+=`

## CONTEXTO DE LA SERIE:
${e.seriesContext}

INSTRUCCIONES CR\xCDTICAS PARA NOVELA DE SERIE:
1. Esta novela es parte de una serie. Mant\xE9n coherencia con los elementos establecidos.
2. Si la gu\xEDa de la serie incluye HITOS para este volumen, DEBES cumplirlos TODOS en tu gu\xEDa:
   - Los hitos de trama deben aparecer en cap\xEDtulos espec\xEDficos
   - Los hitos de personaje deben reflejarse en el desarrollo del protagonista
   - Los hitos de mundo deben establecerse/expandirse seg\xFAn corresponda
   - Los objetos/pistas (Chekhov's Gun) deben introducirse expl\xEDcitamente
3. Incluye referencias expl\xEDcitas a eventos de libros anteriores si los hay.
4. Prepara hilos para futuras entregas seg\xFAn los hitos del siguiente volumen.
5. En la secci\xF3n "Registro de Chekhov's Gun" incluye los objetos/pistas de la serie.

\u26A0\uFE0F PROTECCI\xD3N ABSOLUTA DE PERSONAJES DE SERIE:
6. Los NOMBRES de los personajes definidos en la gu\xEDa de serie son INMUTABLES.
   - NO cambies, modifiques ni "mejores" ning\xFAn nombre de personaje.
   - Usa el nombre EXACTO tal como aparece en la gu\xEDa de la serie.
7. El SEXO/G\xC9NERO de los personajes es INMUTABLE.
   - Si la gu\xEDa define un personaje masculino, DEBE ser masculino en tu gu\xEDa.
   - Si la gu\xEDa define un personaje femenino, DEBE ser femenino en tu gu\xEDa.
   - NUNCA cambies el g\xE9nero de ning\xFAn personaje de la serie.
8. Los ROLES de los personajes son INMUTABLES (protagonista, antagonista, aliado, etc.)
9. NO sustituyas personajes de la serie por personajes nuevos inventados.
10. Puedes A\xD1ADIR personajes secundarios nuevos, pero los personajes de la serie deben aparecer TAL CUAL.
`),t+=`

Genera ahora la GU\xCDA DE ESCRITURA COMPLETA siguiendo exactamente la estructura del prompt del sistema.
S\xE9 muy espec\xEDfico en los res\xFAmenes de cada cap\xEDtulo - cada uno debe tener su evento clave \xFAnico.
Las subtramas deben distribuirse en m\xFAltiples cap\xEDtulos (m\xEDnimo 3, idealmente 5+).
`,await this.generateContent(t,void 0,{forceProvider:"gemini"})}},Cie=new lb(!0)});var o4={};wr(o4,{SeriesGuideGeneratorAgent:()=>ub,seriesGuideGeneratorAgent:()=>Rie});var Aie,Sie,ub,Rie,i4=G(()=>{"use strict";It();Aie=`Eres un experto en planificaci\xF3n editorial de series literarias. Tu trabajo es generar la BIBLIA DE SERIE (fundamentos) para una saga de novelas.

DEBES generar SOLO las secciones 1-6 y 9-13 siguiendo esta estructura:

---

# ESTRATEGIA EDITORIAL: [NOMBRE DE LA SERIE]

## 1. IDENTIDAD DEL AUTOR/SEUD\xD3NIMO
- **Nombre:** [Seud\xF3nimo]
- **Por qu\xE9 funciona:** [Justificaci\xF3n del nombre]
- **Bio del autor:** [Biograf\xEDa ficticia de 2-3 l\xEDneas que conecte con el g\xE9nero]

## 2. EL DETECTIVE/PROTAGONISTA DE LA SERIE
- **Nombre completo:**
- **Edad aproximada:**
- **Profesi\xF3n/Rol:**
- **Backstory:** [Historia de fondo que se revelar\xE1 gradualmente]
- **Trauma/Herida emocional:** [El "incidente" que lo persigue]
- **Personalidad:** [Rasgos distintivos]
- **M\xE9todo de trabajo:** [C\xF3mo resuelve casos/conflictos]
- **Debilidades:** [Defectos que lo humanizan]
- **Evoluci\xF3n a lo largo de la serie:** [C\xF3mo cambiar\xE1 del libro 1 al \xFAltimo]

## 3. EL ESCENARIO RECURRENTE
- **Ubicaci\xF3n principal:** [Ciudad/regi\xF3n]
- **Por qu\xE9 este lugar:** [Justificaci\xF3n narrativa]
- **Atm\xF3sfera:** [Sensaciones, clima, est\xE9tica]
- **Lugares ic\xF3nicos:** [Sitios que aparecer\xE1n en m\xFAltiples libros]
- **Personajes secundarios fijos:** [El informante, el rival, el aliado, etc.]

## 4. ESTILO LITERARIO DE LA SERIE
### A. Voz y Tono
- **Registro narrativo:** [Formal/coloquial/t\xE9cnico]
- **Punto de vista:** [Primera/tercera persona]
- **Ritmo de prosa:** [Frases cortas/largas/variadas]
- **Nivel de descripci\xF3n:** [Minimalista/moderado/detallado]

### B. Tropos Caracter\xEDsticos
- [Tropo 1]: [Descripci\xF3n de c\xF3mo se usa]
- [Tropo 2]: [Descripci\xF3n de c\xF3mo se usa]
- [Tropo 3]: [Descripci\xF3n de c\xF3mo se usa]

### C. Elementos Recurrentes
- **Objeto simb\xF3lico:** [Algo que aparece en todos los libros]
- **Frase caracter\xEDstica:** [Muletilla o lema del protagonista]
- **Ritual/Costumbre:** [Algo que el protagonista hace siempre]

## 5. ESTRUCTURA DE LAS NOVELAS
### A. Anatom\xEDa de un Cap\xEDtulo
- **Longitud:** [Palabras por cap\xEDtulo]
- **Estructura interna:** [Gancho -> Desarrollo -> Cliffhanger]
- **Ritmo:** [C\xF3mo alternar acci\xF3n y reflexi\xF3n]

### B. Estructura de Cada Novela
- **Cap\xEDtulos 1-5:** [Qu\xE9 debe ocurrir]
- **Punto medio (50%):** [Tipo de giro esperado]
- **Cl\xEDmax (90%):** [Tipo de confrontaci\xF3n]
- **Resoluci\xF3n:** [C\xF3mo cerrar cada libro]

## 6. EL HILO CONDUCTOR (METATRAMA)
- **El misterio central:** [Qu\xE9 une toda la serie]
- **C\xF3mo se revela:** [Gradualmente, pistas por libro]
- **Antagonista final:** [Qui\xE9n est\xE1 detr\xE1s de todo]
- **Resoluci\xF3n definitiva:** [C\xF3mo termina la serie]

## 9. PERSONAJES RECURRENTES

### Aliado Principal
- **Nombre:**
- **Rol:** [Compa\xF1ero, mentor, subordinado]
- **Din\xE1mica con protagonista:**
- **Arco a lo largo de la serie:**

### Antagonista Recurrente (si aplica)
- **Nombre:**
- **Motivaci\xF3n:**
- **Relaci\xF3n con protagonista:**

### Personajes de Apoyo
- [Nombre]: [Rol y funci\xF3n en la serie]
- [Nombre]: [Rol y funci\xF3n en la serie]

## 10. REGLAS DEL MUNDO
- **Tecnolog\xEDa/\xC9poca:**
- **Sistema legal/social:**
- **Limitaciones del protagonista:**
- **Qu\xE9 puede y qu\xE9 NO puede hacer:**

## 11. ESTRATEGIA DE CONTINUIDAD
- **Qu\xE9 se mantiene igual:** [Elementos constantes]
- **Qu\xE9 evoluciona:** [Elementos que cambian gradualmente]
- **Referencias cruzadas:** [C\xF3mo mencionar eventos de libros anteriores]
- **Nuevos lectores:** [C\xF3mo hacer cada libro accesible sin leer los anteriores]

## 12. PREVENCI\xD3N DE ERRORES DE CONTINUIDAD
- **Registro de heridas/cicatrices:**
- **Registro de relaciones:**
- **L\xEDnea temporal de la serie:**
- **Personajes muertos:** [Para no resucitarlos]

## 13. DISE\xD1O DE PORTADAS (Branding)
- **Concepto visual:**
- **Paleta de colores:**
- **Tipograf\xEDa:**
- **Elementos constantes:**

---

REGLAS CR\xCDTICAS:
1. El protagonista debe EVOLUCIONAR gradualmente a lo largo de la serie
2. Los personajes secundarios deben tener sus propios arcos menores
3. NUNCA crear deus ex machina - toda resoluci\xF3n debe estar preparada
4. Mantener consistencia en la voz narrativa y el tono entre libros
5. PROTECCI\xD3N DE IDENTIDAD: Si el usuario proporciona nombres de personajes en su concepto, DEBES usar EXACTAMENTE esos nombres. NO los modifiques, traduzcas ni "mejores". Los nombres y el sexo/g\xE9nero de cada personaje son INMUTABLES desde el momento en que se definen. Si el concepto dice "Elena es detective", Elena DEBE ser mujer y llamarse Elena en toda la biblia.

Genera la biblia en espa\xF1ol. S\xE9 espec\xEDfico y detallado. NO incluyas las secciones 7 y 8 (hitos y arquitectura por volumen).`,Sie=`Eres un experto en planificaci\xF3n editorial de series literarias.

Tu trabajo es generar los HITOS Y ARQUITECTURA para UN SOLO VOLUMEN de una serie, bas\xE1ndote en la biblia de serie proporcionada.

Genera EXACTAMENTE este formato para el volumen indicado:

---

## HITOS DEL VOLUMEN [N]:
- **Hito de trama:** [Qu\xE9 pista/evento del misterio central se revela]
- **Hito de personaje:** [Qu\xE9 aprende/descubre el protagonista sobre s\xED mismo]
- **Hito de mundo:** [Qu\xE9 elemento del universo se establece/expande]
- **Objeto/pista introducida:** [Chekhov's Gun para libros posteriores]
- **Conexi\xF3n con vol\xFAmenes anteriores:** [Referencias expl\xEDcitas si no es Vol. 1]

## ARQUITECTURA DEL VOLUMEN [N]: [T\xEDtulo]
- **Argumento:** [Sinopsis de 4-6 l\xEDneas con el conflicto espec\xEDfico de este libro]
- **La pieza del puzzle:** [Qu\xE9 pista del hilo conductor se revela]
- **Desarrollo del protagonista:** [Qu\xE9 aprende/cambia en este libro]
- **Hitos a cumplir:** [Lista de los hitos del volumen]
- **Preparaci\xF3n para siguiente:** [Qu\xE9 se siembra para el pr\xF3ximo libro, si aplica]

---

REGLAS:
1. El argumento debe ser espec\xEDfico y detallado (NO gen\xE9rico)
2. Los hitos deben conectar con el misterio central de la serie
3. Cada volumen debe funcionar como historia independiente Y avanzar el hilo conductor
4. Si es el \xFAltimo volumen, incluir resoluci\xF3n del trauma del protagonista y cierre de arcos

Genera en espa\xF1ol. S\xE9 espec\xEDfico.`,ub=class extends Ae{constructor(){super({name:"series-guide-generator",role:"Generador de gu\xEDas de series literarias",systemPrompt:Aie,model:"deepseek-chat"})}async execute(){throw new Error("Use generateSeriesGuidePhased() instead")}async generateSeriesBible(e){console.log(`[SeriesGuideGenerator] Phase 1: Generating series bible for "${e.seriesTitle}"...`);let t=`Genera la BIBLIA DE SERIE (secciones 1-6 y 9-13) para la siguiente saga:

## CONCEPTO DE LA SERIE:
${e.concept}

## CONFIGURACION:
- **Titulo de la serie:** ${e.seriesTitle}
- **Genero:** ${e.genre}
- **Tono:** ${e.tone}
- **Numero de libros planificados:** ${e.bookCount}
- **Tipo:** ${e.workType==="trilogy"?"Trilogia":"Serie extendida"}
`;e.pseudonymName&&(t+=`- **Seudonimo:** ${e.pseudonymName}
`),e.pseudonymStyleGuide&&(t+=`

## GUIA DE ESTILO DEL AUTOR:
${e.pseudonymStyleGuide}

IMPORTANTE: Respeta el estilo, voz y preferencias descritas en la guia de estilo.
`),t+=`

Genera ahora la BIBLIA DE SERIE siguiendo exactamente la estructura del prompt del sistema.
Recuerda: NO incluyas las secciones 7 y 8 (hitos y arquitectura por volumen). Esas se generaran por separado.
`;let n=await this.generateContent(t,void 0,{forceProvider:"gemini"});return console.log(`[SeriesGuideGenerator] Phase 1 complete: Bible generated (${n.content?.length||0} chars)`),n}async generateVolumeMilestones(e){console.log(`[SeriesGuideGenerator] Phase 2: Generating milestones for Volume ${e.volumeNumber}/${e.totalVolumes}...`);let t=e.volumeNumber===1,n=e.volumeNumber===e.totalVolumes,a=`Genera los HITOS Y ARQUITECTURA para el VOLUMEN ${e.volumeNumber} de ${e.totalVolumes} de la serie "${e.seriesTitle}".

## CONTEXTO DE LA SERIE (Biblia):
${e.seriesBible.substring(0,8e3)}

## CONFIGURACION DEL VOLUMEN:
- **Numero de volumen:** ${e.volumeNumber} de ${e.totalVolumes}
- **Genero:** ${e.genre}
- **Tono:** ${e.tone}
- **Es primer libro:** ${t?"Si - debe establecer el mundo y presentar al protagonista":"No"}
- **Es ultimo libro:** ${n?"Si - debe resolver el misterio central y cerrar arcos":"No"}
${e.predefinedTitle?`- **Titulo del volumen (OBLIGATORIO RESPETAR):** ${e.predefinedTitle}`:""}
${e.predefinedArgument?`- **Argumento predefinido (OBLIGATORIO RESPETAR):** ${e.predefinedArgument}`:""}
`;e.previousVolumeSummary&&(a+=`

## RESUMEN DEL VOLUMEN ANTERIOR:
${e.previousVolumeSummary}

IMPORTANTE: Este volumen debe continuar los hilos del anterior y hacer referencias explicitas.
`),a+=`

\u26A0\uFE0F PROTECCI\xD3N DE PERSONAJES: Los nombres y el sexo/g\xE9nero de TODOS los personajes definidos en la Biblia de Serie son INMUTABLES. NO cambies, renombres ni alteres el g\xE9nero de ning\xFAn personaje. Usa los nombres EXACTOS de la biblia.
`,n&&(a+=`

INSTRUCCIONES ESPECIALES PARA VOLUMEN FINAL:
- Incluir revelacion del antagonista final
- Incluir confrontacion definitiva
- Resolver el trauma/herida emocional del protagonista
- Cerrar TODOS los arcos secundarios pendientes
`),a+=`

Genera ahora los HITOS Y ARQUITECTURA para el Volumen ${e.volumeNumber} siguiendo exactamente el formato del prompt del sistema.
`;let s=this.config.systemPrompt;this.config.systemPrompt=Sie;let o=await this.generateContent(a,void 0,{forceProvider:"gemini"});return this.config.systemPrompt=s,console.log(`[SeriesGuideGenerator] Volume ${e.volumeNumber} milestones generated (${o.content?.length||0} chars)`),o}async generateSeriesGuidePhased(e,t,n){console.log(`[SeriesGuideGenerator] Starting phased generation for "${e.seriesTitle}" (${e.bookCount} books)...`);let a={phase:"bible",totalVolumes:e.bookCount,completedVolumes:[]};if(t?.(a),n?.())return{content:"",error:"Cancelled by user"};let s=await this.generateSeriesBible(e);if(!s.content||s.content.length<500)return console.error("[SeriesGuideGenerator] Bible generation failed or too short"),{content:"",error:"Failed to generate series bible"};if(n?.())return{content:s.content,error:"Cancelled after bible generation"};a.phase="volumes",t?.(a);let o=[],i,u=!1;for(let p=1;p<=e.bookCount;p++){if(n?.()){console.log(`[SeriesGuideGenerator] Cancelled at volume ${p}`),u=!0;break}a.currentVolume=p,t?.(a);let m=e.predefinedVolumes?.find(g=>g.number===p),f=await this.generateVolumeMilestones({volumeNumber:p,totalVolumes:e.bookCount,seriesTitle:e.seriesTitle,seriesBible:s.content,genre:e.genre,tone:e.tone,previousVolumeSummary:i,predefinedTitle:m?.title,predefinedArgument:m?.argument});if(f.content&&f.content.length>100){o.push(f.content),a.completedVolumes.push(p);let g=f.content.match(/\*\*Argumento:\*\*\s*([^\n]+(?:\n(?!\*\*)[^\n]+)*)/i);g&&(i=`Volumen ${p}: ${g[1].trim().substring(0,500)}`)}else console.warn(`[SeriesGuideGenerator] Volume ${p} generation failed, continuing...`);t?.(a)}if(a.phase="complete",t?.(a),u)return console.log(`[SeriesGuideGenerator] Generation was cancelled. Completed ${a.completedVolumes.length}/${e.bookCount} volumes.`),{content:"",error:`Generacion cancelada por el usuario. Se completaron ${a.completedVolumes.length} de ${e.bookCount} volumenes.`};o.length<e.bookCount&&console.warn(`[SeriesGuideGenerator] Only ${o.length}/${e.bookCount} volumes generated successfully`);let c=s.content;if(o.length>0){let p=o.map(y=>{let C=y.match(/## HITOS DEL VOLUMEN[\s\S]*?(?=## ARQUITECTURA|$)/i);return C?C[0].trim():""}).filter(Boolean),m=o.map(y=>{let C=y.match(/## ARQUITECTURA DEL VOLUMEN[\s\S]*/i);return C?C[0].trim():""}).filter(Boolean),f=`

## 7. HITOS DE LA SERIE (OBLIGATORIO)

Estos son los eventos clave que DEBEN cumplirse en cada novela para avanzar el hilo conductor:

${p.join(`

`)}

## 8. ARQUITECTURA DE LA SERIE

${m.join(`

`)}
`,g=c.indexOf("## 9.");g>0?c=c.substring(0,g)+f+`

`+c.substring(g):c+=f}return console.log(`[SeriesGuideGenerator] Phased generation complete. Total: ${c.length} chars, ${o.length}/${e.bookCount} volumes`),{content:c,tokenUsage:s.tokenUsage}}async generateSeriesGuide(e){return this.generateSeriesGuidePhased(e)}},Rie=new ub});var c4={};wr(c4,{StyleGuideGeneratorAgent:()=>pb,styleGuideGeneratorAgent:()=>Iie});var wie,pb,Iie,l4=G(()=>{"use strict";It();wie=`Eres un experto en an\xE1lisis literario y estil\xEDstica. Tu trabajo es generar una GU\xCDA DE ESTILO completa para un seud\xF3nimo, bas\xE1ndote en el estilo de un autor conocido.

DEBES generar una gu\xEDa que siga EXACTAMENTE esta estructura:

---

# GU\xCDA DE ESTILO: [NOMBRE DEL SEUD\xD3NIMO]
## Basada en el estilo de: [AUTOR DE REFERENCIA]

---

## 1. IDENTIDAD DEL AUTOR

### Datos del Seud\xF3nimo
- **Nombre completo:** [Nombre del seud\xF3nimo]
- **G\xE9nero literario principal:** [G\xE9nero del autor de referencia]
- **Subg\xE9neros:** [Subg\xE9neros t\xEDpicos del autor]
- **P\xFAblico objetivo:** [Audiencia t\xEDpica de este estilo]

### Biograf\xEDa Ficticia Sugerida
[2-3 p\xE1rrafos con una historia de autor ficticio que conecte con el g\xE9nero y estilo]

---

## 2. VOZ NARRATIVA (An\xE1lisis del estilo del autor)

### Punto de Vista Preferido
- **POV dominante:** [El que usa t\xEDpicamente el autor de referencia]
- **Justificaci\xF3n:** [Por qu\xE9 funciona en su obra]

### Tiempo Verbal
- **Tiempo preferido:** [Pasado/Presente]
- **Excepciones:** [Cu\xE1ndo var\xEDa]

### Registro Ling\xFC\xEDstico
- **Formalidad:** [1-5 con justificaci\xF3n]
- **Complejidad sint\xE1ctica:** [Descripci\xF3n del estilo de frases]
- **Vocabulario caracter\xEDstico:** [Tipo de l\xE9xico que usa]
- **Regionalismos/Dialectos:** [Si aplica]

### Ritmo de Prosa
- **Longitud de frases t\xEDpica:** [An\xE1lisis espec\xEDfico]
- **Longitud de p\xE1rrafos:** [An\xE1lisis espec\xEDfico]
- **Ratio di\xE1logo/narraci\xF3n:** [Estimaci\xF3n]
- **Cadencia caracter\xEDstica:** [Descripci\xF3n del ritmo]

---

## 3. ESTRUCTURA NARRATIVA

### Cap\xEDtulos
- **Longitud t\xEDpica:** [Basada en las obras del autor]
- **Inicio de cap\xEDtulo:** [T\xE9cnica habitual]
- **Final de cap\xEDtulo:** [T\xE9cnica habitual]
- **T\xEDtulos de cap\xEDtulo:** [Estilo de titulaci\xF3n]

### Escenas
- **Escenas por cap\xEDtulo:** [Estimaci\xF3n]
- **Transiciones t\xEDpicas:** [C\xF3mo maneja las transiciones]
- **Ratio acci\xF3n/reflexi\xF3n:** [An\xE1lisis]

### Estructura de Novela
- **Estructura de actos:** [C\xF3mo organiza sus novelas]
- **Tipo de inicio:** [In medias res, lento, etc.]
- **Cl\xEDmax t\xEDpico:** [C\xF3mo construye el cl\xEDmax]
- **Resoluci\xF3n:** [C\xF3mo cierra sus historias]

---

## 4. TEMAS RECURRENTES

### Temas Centrales del Autor
1. [Tema 1]: [C\xF3mo lo explora t\xEDpicamente]
2. [Tema 2]: [C\xF3mo lo explora t\xEDpicamente]
3. [Tema 3]: [C\xF3mo lo explora t\xEDpicamente]

### Motivos Literarios Caracter\xEDsticos
- [Motivo 1]: [Descripci\xF3n y ejemplos]
- [Motivo 2]: [Descripci\xF3n y ejemplos]
- [Motivo 3]: [Descripci\xF3n y ejemplos]

### Conflictos Preferidos
- [Tipo de conflicto 1]: [C\xF3mo lo desarrolla]
- [Tipo de conflicto 2]: [C\xF3mo lo desarrolla]

---

## 5. PERSONAJES (Estilo del autor)

### Arquetipos de Protagonista T\xEDpicos
- **G\xE9nero predominante:** [Si hay patr\xF3n]
- **Rango de edad t\xEDpico:** [Si hay patr\xF3n]
- **Profesiones/Roles recurrentes:** [Patrones identificados]
- **Defectos caracter\xEDsticos:** [Tipos de defectos que da a sus protagonistas]
- **Fortalezas t\xEDpicas:** [Tipos de fortalezas]
- **Arco de personaje:** [C\xF3mo desarrolla a sus protagonistas]

### Arquetipos de Antagonista
- **Tipo preferido:** [Visible/Oculto/Abstracto]
- **Complejidad moral:** [C\xF3mo construye sus antagonistas]
- **Motivaciones t\xEDpicas:** [Patrones identificados]

### Personajes Secundarios
- **Densidad:** [Pocos y profundos / Muchos y funcionales]
- **Desarrollo:** [Cu\xE1nto los desarrolla]
- **Funciones narrativas:** [Roles t\xEDpicos]

### Relaciones
- **Romance:** [C\xF3mo maneja el romance]
- **Nivel de contenido adulto:** [Estilo del autor]
- **Relaciones familiares:** [C\xF3mo las retrata]
- **Amistades:** [C\xF3mo las construye]

---

## 6. AMBIENTACI\xD3N

### Localizaciones T\xEDpicas
- **Tipo de escenario preferido:** [Urbano/Rural/etc.]
- **Regiones recurrentes:** [Si hay patrones geogr\xE1ficos]
- **\xC9poca t\xEDpica:** [Contempor\xE1neo/Hist\xF3rico/etc.]
- **Atm\xF3sfera caracter\xEDstica:** [Tono ambiental t\xEDpico]

### Nivel de Descripci\xF3n
- **Escenarios:** [C\xF3mo describe los lugares]
- **Objetos:** [Nivel de detalle]
- **Clima/Tiempo:** [C\xF3mo lo usa narrativamente]

### Sensorialidad
- **Sentidos m\xE1s utilizados:** [An\xE1lisis]
- **Paleta de colores t\xEDpica:** [Si hay patrones]
- **Sonidos caracter\xEDsticos:** [Tipos de sonidos que evoca]
- **Otros sentidos:** [Tacto, olfato, gusto - c\xF3mo los usa]

---

## 7. DI\xC1LOGOS

### Estilo de Di\xE1logo
- **Naturalidad:** [An\xE1lisis del realismo]
- **Longitud de intervenciones:** [Patrones]
- **Uso de muletillas/expresiones:** [C\xF3mo caracteriza mediante el habla]
- **Acotaciones:** [Estilo de tags de di\xE1logo]

### Verbos de Habla
- **Preferencia:** [An\xE1lisis de su uso de "dijo" vs. variantes]
- **Adverbios:** [C\xF3mo los usa o evita]

### Diferenciaci\xF3n de Voces
- **Por clase social:** [An\xE1lisis]
- **Por edad:** [An\xE1lisis]
- **Por educaci\xF3n:** [An\xE1lisis]
- **T\xE9cnicas de diferenciaci\xF3n:** [C\xF3mo hace que cada personaje suene \xFAnico]

---

## 8. RECURSOS ESTIL\xCDSTICOS

### Figuras Ret\xF3ricas Preferidas
- [Figura 1]: [C\xF3mo la usa con ejemplo]
- [Figura 2]: [C\xF3mo la usa con ejemplo]
- [Figura 3]: [C\xF3mo la usa con ejemplo]

### T\xE9cnicas Narrativas Caracter\xEDsticas
- [T\xE9cnica 1]: [Descripci\xF3n de c\xF3mo la emplea]
- [T\xE9cnica 2]: [Descripci\xF3n de c\xF3mo la emplea]

### Elementos Distintivos
- **Marca de estilo 1:** [Algo \xFAnico de este autor]
- **Marca de estilo 2:** [Algo \xFAnico de este autor]
- **Firma narrativa:** [Lo que hace reconocible su prosa]

---

## 9. PROHIBICIONES Y RESTRICCIONES

### Vocabulario a Evitar
- [Palabra/frase 1]: [Que este autor NO usar\xEDa]
- [Palabra/frase 2]: [Que este autor NO usar\xEDa]
- [Clich\xE9s que evita]

### Tropos que NO Usa
- [Tropo 1]: [Que evita conscientemente]
- [Tropo 2]: [Que evita conscientemente]

### Contenido Caracter\xEDstico
- **Violencia:** [Nivel t\xEDpico]
- **Contenido sexual:** [Nivel t\xEDpico]
- **Lenguaje soez:** [Nivel t\xEDpico]
- **Temas sensibles:** [C\xF3mo los aborda]

---

## 10. REFERENCIAS E INFLUENCIAS

### Influencias del Autor de Referencia
- [Autor/Movimiento 1]: [Qu\xE9 tom\xF3 de ellos]
- [Autor/Movimiento 2]: [Qu\xE9 tom\xF3 de ellos]

### Obras Clave para Estudiar el Estilo
1. [T\xEDtulo 1]: [Por qu\xE9 es representativa]
2. [T\xEDtulo 2]: [Por qu\xE9 es representativa]
3. [T\xEDtulo 3]: [Por qu\xE9 es representativa]

### Frases/Pasajes Ejemplares
- "[Cita 1]" - [Obra, contexto]
- "[Cita 2]" - [Obra, contexto]

---

## 11. INSTRUCCIONES PARA IMITAR EL ESTILO

### Checklist de Escritura
1. [Instrucci\xF3n pr\xE1ctica 1]
2. [Instrucci\xF3n pr\xE1ctica 2]
3. [Instrucci\xF3n pr\xE1ctica 3]
4. [Instrucci\xF3n pr\xE1ctica 4]
5. [Instrucci\xF3n pr\xE1ctica 5]

### Errores Comunes a Evitar
1. [Error 1]: [C\xF3mo evitarlo]
2. [Error 2]: [C\xF3mo evitarlo]
3. [Error 3]: [C\xF3mo evitarlo]

### Ejercicios de Pr\xE1ctica
1. [Ejercicio 1 para desarrollar este estilo]
2. [Ejercicio 2 para desarrollar este estilo]

---

*Gu\xEDa generada bas\xE1ndose en el an\xE1lisis del estilo de [AUTOR]*
`,pb=class extends Ae{constructor(){super({name:"Style Guide Generator",role:"style-guide-generator",systemPrompt:wie,model:"deepseek-chat"})}async generateStyleGuide(e){let t=`Genera una gu\xEDa de estilo completa para un seud\xF3nimo bas\xE1ndote en el estilo del siguiente autor:

## AUTOR DE REFERENCIA:
**${e.referenceAuthor}**

## SEUD\xD3NIMO:
**${e.pseudonymName}**
`;return e.genre&&(t+=`
## G\xC9NERO OBJETIVO:
${e.genre}
`),e.additionalNotes&&(t+=`
## NOTAS ADICIONALES:
${e.additionalNotes}
`),t+=`

INSTRUCCIONES:
1. Analiza profundamente el estilo literario de ${e.referenceAuthor}
2. Identifica sus t\xE9cnicas narrativas, voz, estructura y recursos estil\xEDsticos caracter\xEDsticos
3. Genera una gu\xEDa completa que permita a una IA escribir en un estilo similar
4. Incluye ejemplos concretos y citas cuando sea posible
5. La gu\xEDa debe ser pr\xE1ctica y aplicable para generaci\xF3n de texto

Genera ahora la GU\xCDA DE ESTILO COMPLETA siguiendo exactamente la estructura del prompt del sistema.
`,(await this.generateContent(t,void 0,{forceProvider:"gemini"})).content}async execute(e){throw new Error("Use generateStyleGuide method instead")}},Iie=new pb});function Um(){return xie}function mb(){return db}async function u4(r,e,t){console.log(`[ContextManager] Initializing context for: ${t}`);let n=`=== NOVELA COMPLETA ===

${r}`;return e&&(n+=`

=== BIBLIA DE LA HISTORIA ===

${e}`),console.log(`[ContextManager] Context size: ${n.length} chars`),console.log("[ContextManager] Using STANDARD mode with gemini-2.5-flash"),db={success:!0,mode:"STANDARD",novelContent:r,bibleContent:e},db}function p4(){db=null}var db,xie,_x=G(()=>{"use strict";db=null,xie="gemini-2.5-flash"});function _ie(r){let e=r.trim(),t=(e.match(/{/g)||[]).length,n=(e.match(/}/g)||[]).length,a=(e.match(/\[/g)||[]).length,s=(e.match(/\]/g)||[]).length,o=e.lastIndexOf('"');(e.substring(0,o).match(/"/g)||[]).length%2===0&&(e+='"');for(let c=0;c<a-s;c++)e+="]";for(let c=0;c<t-n;c++)e+="}";return e}function Pie(r){return new Promise(e=>setTimeout(e,r))}async function Bm(r,e=0){console.log(`[AgentRunner] Running ${r} agent${e>0?` (retry ${e}/3)`:""}...`);let a=Nie[r],s=mb();try{console.log(`[AgentRunner] ${r}: Using Gemini ${Um()}`);let o=Oie.getGenerativeModel({model:Um(),generationConfig:{responseMimeType:"application/json",temperature:.3,maxOutputTokens:65536}}),i="";s?.novelContent&&(i=`=== NOVELA COMPLETA ===

${s.novelContent}`,s.bibleContent&&(i+=`

=== BIBLIA DE LA HISTORIA ===

${s.bibleContent}`));let c=`SYSTEM: Eres un Editor Literario Senior. Responde SIEMPRE en JSON v\xE1lido y COMPLETO. Limita tu respuesta a los 10 problemas m\xE1s importantes.

CONTEXTO:
${i}

${a.prompt}`,m=(await o.generateContent(c)).response.text();if(!m)throw new Error("No text response from Gemini");let f;try{f=JSON.parse(m)}catch{console.log(`[AgentRunner] ${r}: JSON parse failed, attempting repair...`);let y=_ie(m);f=JSON.parse(y),console.log(`[AgentRunner] ${r}: JSON repair successful`)}if(!f.agentType||typeof f.overallScore!="number"||!Array.isArray(f.issues))throw new Error("Invalid agent report structure");return console.log(`[AgentRunner] ${r} complete: score ${f.overallScore}, ${f.issues.length} issues`),{agentType:a.type,overallScore:Math.min(100,Math.max(0,f.overallScore)),analysis:f.analysis||"",issues:f.issues.map(g=>({location:g.location||"Unknown",description:g.description||"",severity:["CRITICAL","HIGH","MEDIUM","LOW"].includes(g.severity)?g.severity:"MEDIUM",suggestion:g.suggestion||""}))}}catch(o){let i=o instanceof Error?o.message:"Error desconocido",u=i.includes("fetch failed")||i.includes("ECONNRESET")||i.includes("timeout")||i.includes("ETIMEDOUT")||i.includes("network");if(u&&e<3){let p=2e3*Math.pow(2,e);return console.log(`[AgentRunner] ${r}: Network error, retrying in ${p}ms...`),await Pie(p),Bm(r,e+1)}console.error(`[AgentRunner] ${r} agent error:`,o);let c=new Error(`Error durante el an\xE1lisis: ${i}${u?" (agotados reintentos autom\xE1ticos)":""}`);throw c.agentType=r,c.isNetworkError=u,c}}async function $x(r){console.log("[AgentRunner] Starting parallel agent execution with progressive saving...");let e=["CONTINUITY","CHARACTER","STYLE"],t=[],n=e.map(async a=>{try{let o={...await Bm(a),failed:!1};return t.push(o),await r(o),o}catch(s){console.error(`[AgentRunner] ${a} agent failed:`,s);let o={agentType:a,overallScore:0,analysis:`Error: ${s?.message||"Fallo de conexi\xF3n"}`,issues:[{location:"Sistema",description:`El agente ${a} fall\xF3 por error de conexi\xF3n`,severity:"HIGH",suggestion:"Usar 'Reanudar Auditor\xEDa' para reintentar este agente"}],failed:!0};return t.push(o),await r(o),o}});return await Promise.allSettled(n),console.log("[AgentRunner] All agents completed (some may have failed)"),t}async function d4(){return $x(async()=>{})}function Px(r){if(!r)return!0;if(r.failed!==void 0)return r.failed;let e=r.analysis||"";return e.startsWith("Error:")||e.startsWith("Error durante")}async function m4(r,e){let t=[],n=[];if(Px(r.continuity)?n.push("CONTINUITY"):t.push(r.continuity),Px(r.character)?n.push("CHARACTER"):t.push(r.character),Px(r.style)?n.push("STYLE"):t.push(r.style),n.length===0)return console.log("[AgentRunner] All agents already completed successfully, nothing to resume"),t;console.log(`[AgentRunner] Resuming audit - running ${n.length} missing/failed agents: ${n.join(", ")}`);let a=n.map(async s=>{try{let i={...await Bm(s),failed:!1};return t.push(i),e&&await e(i),i}catch(o){console.error(`[AgentRunner] ${s} agent failed on resume:`,o);let i={agentType:s,overallScore:0,analysis:`Error: ${o?.message||"Fallo de conexi\xF3n"}`,issues:[{location:"Sistema",description:`El agente ${s} fall\xF3 por error de conexi\xF3n`,severity:"HIGH",suggestion:"Reintentar la reanudaci\xF3n"}],failed:!0};return t.push(i),e&&await e(i),i}});return await Promise.allSettled(a),t}function h4(r){return r.reduce((e,t)=>e+t.issues.filter(n=>n.severity==="CRITICAL").length,0)}function f4(r){if(r.length===0)return 0;let e=r.reduce((t,n)=>t+n.overallScore,0);return Math.round(e/r.length)}var Tie,Oie,Nie,g4=G(()=>{"use strict";xy();_x();Tie=process.env.GEMINI_API_KEY||"",Oie=new ni(Tie),Nie={CONTINUITY:{type:"CONTINUITY",focusAreas:["Cronolog\xEDa","Relaciones","Objetos","Ubicaciones","Datos biogr\xE1ficos"],prompt:`ROL: AGENTE FORENSE DE CONTINUIDAD - Editor profesional de manuscritos

MISI\xD3N CR\xCDTICA: Detectar TODAS las inconsistencias factuales en la novela. S\xE9 extremadamente meticuloso.

=== ERRORES PRIORITARIOS A DETECTAR ===

1. RELACIONES FAMILIARES CONTRADICTORIAS (CR\xCDTICO):
   - Personaje mencionado como "hija" en un cap\xEDtulo y "sobrina" en otro
   - Cambios en parentesco: hermano/primo, esposa/novia, etc.
   - Contradicciones en \xE1rbol geneal\xF3gico
   
2. INCONSISTENCIAS DE EDAD Y FECHAS (CR\xCDTICO):
   - Edad de un personaje que no cuadra con fechas mencionadas
   - Ejemplo: "Muri\xF3 hace 10 a\xF1os cuando ella ten\xEDa 5" pero luego "tiene 20 a\xF1os" = no cuadra
   - Personajes que no envejecen coherentemente
   - Fechas hist\xF3ricas que contradicen edades establecidas

3. ATRIBUTOS F\xCDSICOS CAMBIANTES (ALTO):
   - Color de ojos/pelo que cambia entre cap\xEDtulos
   - Cicatrices, marcas, tatuajes que aparecen/desaparecen
   - Altura, complexi\xF3n mencionada diferente

4. OBJETOS Y POSESIONES:
   - Items destruidos que reaparecen
   - Objetos en posesi\xF3n de quien no deber\xEDa tenerlos
   - Dinero/recursos que no cuadran

5. UBICACIONES Y GEOGRAF\xCDA:
   - Distancias imposibles de recorrer en el tiempo indicado
   - Descripciones contradictorias del mismo lugar
   - Personajes en dos lugares simult\xE1neamente

6. L\xCDNEA TEMPORAL:
   - Eventos fuera de secuencia l\xF3gica
   - Flashbacks que contradicen el presente narrativo
   - Estaciones/clima inconsistentes con fechas

7. FLUIDEZ ENTRE CAP\xCDTULOS (ALTO):
   - Saltos temporales inexplicados entre cap\xEDtulos
   - Personajes que estaban en un lugar al final del cap\xEDtulo y aparecen en otro al inicio del siguiente sin explicaci\xF3n
   - Acciones iniciadas en un cap\xEDtulo que no se resuelven o contin\xFAan l\xF3gicamente en el siguiente
   - Estado emocional de personajes que cambia bruscamente entre cap\xEDtulos sin justificaci\xF3n
   - Objetos o informaci\xF3n que desaparecen entre el final de un cap\xEDtulo y el inicio del siguiente

INSTRUCCIONES:
- Lee CADA cap\xEDtulo compar\xE1ndolo con los dem\xE1s
- Extrae TODOS los datos factuales y comp\xE1ralos
- Si X="hija" en Cap.5 pero X="sobrina" en Cap.12, eso es CR\xCDTICO
- Si edad + fecha de evento no cuadra matem\xE1ticamente, es CR\xCDTICO
- Cita el texto exacto donde encontraste la contradicci\xF3n

FORMATO JSON REQUERIDO:
{
  "agentType": "CONTINUITY",
  "overallScore": [0-100],
  "analysis": "[Resumen detallado de hallazgos, 3-4 p\xE1rrafos]",
  "issues": [
    {
      "location": "Cap\xEDtulo X vs Cap\xEDtulo Y",
      "description": "[Contradicci\xF3n espec\xEDfica con citas textuales]",
      "severity": "CRITICAL|HIGH|MEDIUM|LOW",
      "suggestion": "[Correcci\xF3n espec\xEDfica propuesta]"
    }
  ]
}`},CHARACTER:{type:"CHARACTER",focusAreas:["Coherencia de datos","Relaciones","Biograf\xEDa","Psicolog\xEDa"],prompt:`ROL: AGENTE FORENSE DE PERSONAJES - Editor profesional de manuscritos

MISI\xD3N CR\xCDTICA: Verificar coherencia FACTUAL y psicol\xF3gica de cada personaje.

=== ERRORES PRIORITARIOS A DETECTAR ===

1. DATOS BIOGR\xC1FICOS CONTRADICTORIOS (CR\xCDTICO):
   - Nombre que cambia (ej: "Mar\xEDa" en un cap, "Marta" en otro)
   - Profesi\xF3n diferente en distintos cap\xEDtulos
   - Lugar de nacimiento contradictorio
   - Estado civil que cambia sin explicaci\xF3n (casado/soltero)
   
2. RELACIONES FAMILIARES INCONSISTENTES (CR\xCDTICO):
   - Personaje es "hija de X" en un lugar y "sobrina de X" en otro
   - N\xFAmero de hijos que var\xEDa
   - Hermanos que aparecen/desaparecen
   - Padres vivos/muertos seg\xFAn conveniencia

3. CRONOLOG\xCDA PERSONAL (ALTO):
   - Eventos de la vida que no cuadran con la edad actual
   - "Trabaj\xE9 20 a\xF1os como m\xE9dico" pero el personaje tiene 30 a\xF1os
   - Fechas de nacimiento/muerte de familiares inconsistentes

4. CONOCIMIENTOS Y HABILIDADES:
   - Sabe algo en un cap\xEDtulo que no deber\xEDa saber
   - Olvida habilidades establecidas previamente
   - Idiomas que habla var\xEDan

5. COHERENCIA PSICOL\xD3GICA:
   - Cambios de personalidad sin justificaci\xF3n narrativa
   - Motivaciones contradictorias
   - Miedos/traumas que desaparecen sin resolver

INSTRUCCIONES:
- Crea una ficha mental de cada personaje principal
- Compara TODOS los datos mencionados sobre cada uno
- Detecta cualquier contradicci\xF3n factual
- Cita textualmente las contradicciones encontradas

FORMATO JSON REQUERIDO:
{
  "agentType": "CHARACTER",
  "overallScore": [0-100],
  "analysis": "[An\xE1lisis detallado de coherencia de personajes]",
  "issues": [
    {
      "location": "Cap\xEDtulo X vs Cap\xEDtulo Y",
      "description": "[Contradicci\xF3n con citas textuales]",
      "severity": "CRITICAL|HIGH|MEDIUM|LOW",
      "suggestion": "[Correcci\xF3n propuesta]"
    }
  ]
}`},STYLE:{type:"STYLE",focusAreas:["Prosa","Ritmo","Di\xE1logos","Repeticiones"],prompt:`ROL: AGENTE DE ESTILO - Editor literario profesional

MISI\xD3N: Evaluar calidad de prosa y detectar problemas t\xE9cnicos de escritura.

=== PROBLEMAS A DETECTAR ===

1. REPETICIONES L\xC9XICAS (ALTO):
   - Misma palabra/frase usada excesivamente
   - Muletillas del autor ("de repente", "sin embargo")
   - Descripciones repetitivas de rasgos f\xEDsicos

2. SHOW DON'T TELL (MEDIO):
   - Exceso de exposici\xF3n vs. demostraci\xF3n
   - Emociones explicadas en lugar de mostradas
   - Backstory en info-dumps

3. DI\xC1LOGOS (ALTO):
   - Di\xE1logos poco naturales o expositivos
   - Voces indistinguibles entre personajes
   - Uso excesivo de adverbios en acotaciones

4. RITMO Y PACING:
   - Secciones que arrastran
   - Transiciones bruscas
   - Escenas innecesarias

5. CLICH\xC9S Y LUGARES COMUNES:
   - Frases hechas excesivas
   - Descripciones gastadas
   - Met\xE1foras trilladas

FORMATO JSON REQUERIDO:
{
  "agentType": "STYLE",
  "overallScore": [0-100],
  "analysis": "[An\xE1lisis de calidad estil\xEDstica]",
  "issues": [
    {
      "location": "Cap\xEDtulo X",
      "description": "[Problema espec\xEDfico con ejemplo]",
      "severity": "CRITICAL|HIGH|MEDIUM|LOW",
      "suggestion": "[Correcci\xF3n propuesta]"
    }
  ]
}`}}});var hb={};wr(hb,{calculateOverallScore:()=>f4,clearContext:()=>p4,countCriticalIssues:()=>h4,getCurrentContext:()=>mb,getModelName:()=>Um,initializeNovelContext:()=>u4,runAgent:()=>Bm,runAllAgents:()=>d4,runAllAgentsWithProgress:()=>$x,runMissingAgents:()=>m4});var fb=G(()=>{"use strict";_x();g4()});var Bx={};wr(Bx,{applyStructuralResolution:()=>Ux,detectStructuralIssues:()=>$ie,extractContinuityConflict:()=>v4,extractFlowBreakContext:()=>Dx,generateContinuityResolutionOptions:()=>E4,generateFlowTransitionOptions:()=>Mx,getStructuralIssueFromCorrection:()=>yb,isContinuityConflict:()=>b4,isDialogueFixableIssue:()=>jie,isNarrativeFlowIssue:()=>kx});function $ie(r,e){let t=[];for(let n of r)if(Lie(n)){let a=A4(n.location,n.description);if(a.length>1){let s={id:`structural-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:C4(n.description),severity:n.severity,description:n.description,affectedChapters:a,affectedContent:kie(e,a),resolutionOptions:S4(a,n.description)};t.push(s)}}return t}function Lie(r){let e=[/captulos?\s+(son\s+)?idnticos/i,/repeticin\s+literal/i,/mismo[s]?\s+evento[s]?/i,/contenido\s+duplicado/i,/escenas?\s+duplicada/i,/captulos?\s+duplicados/i,/exactamente\s+los\s+mismos/i,/narran\s+lo\s+mismo/i,/repiten?\s+(el|los)\s+mismo/i,/se\s+repite\s+en\s+\w+\s+captulos/i,/sensacin\s+de\s*repeticin/i,/telfono.*vibr.*repite/i,/llamada.*repite/i,/interaccin\s+redundante/i,/redundante\s+con/i,/el\s+mismo\s+\w+\s+(para|que)/i,/primera\s+parte.*segunda\s+parte/i],t=r.description.toLowerCase(),n=(r.location?.match(/captulo/gi)?.length||0)>=2||(r.location?.match(/,/g)?.length||0)>=2,a=t.includes("redundant")||t.includes("mismo fragmento")||t.includes("el mismo")||t.includes("primera")&&t.includes("segunda"),s=/fecha.*inconsistente|afirma.*sin embargo|'[^']+'.*pero|hace\s+\w+\s+semanas/i.test(r.description);return e.some(o=>o.test(r.description))||t.includes("cap\xEDtulo")&&(t.includes("id\xE9ntic")||t.includes("duplic"))||n&&(t.includes("repite")||t.includes("similar"))||a||s}function jie(r){return[/fecha.*inconsistente/i,/tiempo.*inconsistente/i,/cronologa.*inconsistente/i,/afirma\s+que.*sin\s+embargo/i,/dice\s+que.*pero/i,/menciona.*contradice/i,/'[^']+'\s*(para|pero|sin embargo)/i,/"[^"]+"\s*(para|pero|sin embargo)/i,/hace\s+(dos|tres|cuatro|cinco|\d+)\s+(semanas?|das?|meses?)/i,/contraste\s+narrativo/i].some(t=>t.test(r.description))}function b4(r){let e=[/captulo\s*\d+\s*vs\.?\s*captulo\s*\d+/i,/sin embargo,?\s*(en|el)\s*captulo/i,/inconsistencia\s*(temporal|lgica|de continuidad)/i,/contradiccin\s*(en|entre)/i,/existe\s*una?\s*contradiccin/i,/en\s*el\s*captulo\s*\d+.*pero\s*(en\s*el\s*)?captulo\s*\d+/i,/genera\s*una\s*inconsistencia/i,/esto\s*genera\s*una\s*incons/i,/captulo\s*\d+.*sin embargo.*captulo\s*\d+/i,/afiliacin.*matones/i,/napolitano.*calabr/i,/calabr.*napolitano/i],t=/captulo\s*\d+\s*vs\.?\s*captulo\s*\d+/i,n=`${r.location||""} ${r.description}`,a=e.some(o=>o.test(n)),s=t.test(r.location||"");return console.log(`[ContinuityConflict] Checking: location="${r.location?.substring(0,50)}", hasVs=${s}, hasPattern=${a}`),a||s}function kx(r){let e=[/fluidez\s*narrativa/i,/inconsistencia\s*(en\s*la\s*)?fluidez/i,/interrup(cin|e)\s*(abrupta|de\s*la\s*narrativa)/i,/ruptura\s*(de\s*)?narrativa/i,/transicin\s*(abrupta|brusca|inexistente)/i,/no\s*hay\s*(una\s*)?transicin/i,/sin\s*transicin/i,/salto\s*(abrupto|brusco|narrativo)/i,/cambio\s*significativo\s*de\s*(ubicacin|escena)/i,/no\s*se\s*explica\s*cmo/i,/termina\s*con.*comienza\s*con/i,/cap[i]tulo\s*\d+\s*vs\.?\s*cap[i]tulo\s*\d+/i],t=`${r.location||""} ${r.description}`,n=e.some(s=>s.test(t)),a=t.toLowerCase().includes("fluidez")||t.toLowerCase().includes("transici\xF3n")||t.toLowerCase().includes("termina")&&t.toLowerCase().includes("comienza");return console.log(`[NarrativeFlow] Checking: "${r.description?.substring(0,60)}...", hasPattern=${n}, hasKeyword=${a}`),n||a}function Dx(r,e){let t=(r.location||"").match(/cap[i]tulo\s*(\d+)\s*vs\.?\s*cap[i]tulo\s*(\d+)/i)||r.description.match(/cap[i]tulo\s*(\d+)\s*vs\.?\s*cap[i]tulo\s*(\d+)/i);if(!t){let s=/cap[i]tulo\s*(\d+)/gi,o=[],i;for(;(i=s.exec(r.description))!==null;){let u=parseInt(i[1]);o.includes(u)||o.push(u)}return o.length>=2?(o.sort((u,c)=>u-c),Lx(o[0],o[1],e)):null}let n=parseInt(t[1]),a=parseInt(t[2]);return Lx(n,a,e)}function Lx(r,e,t){let n=s=>{let o=new RegExp(`===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?)\\s*${s}[^=]*===([\\s\\S]*?)(?====\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?|EP\xCDLOGO)|$)`,"i"),i=t.match(o);if(i&&i[1]){let p=i[1].trim().split(/\n\n+/).slice(-3).join(`

`);return p.length>1500?p.substring(p.length-1500):p}return""},a=s=>{let o=new RegExp(`===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?)\\s*${s}[^=]*===([\\s\\S]*?)(?====\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?|EP\xCDLOGO)|$)`,"i"),i=t.match(o);if(i&&i[1]){let p=i[1].trim().split(/\n\n+/).slice(0,3).join(`

`);return p.length>1500?p.substring(0,1500):p}return""};return{fromChapter:r,toChapter:e,endingContext:n(r),startingContext:a(e)}}function Mx(r,e,t,n){let a=[],s=Lx(r,e,n);return a.push({id:`add-transition-end-${r}`,type:"add_transition",label:`\u2728 RECOMENDADO: A\xF1adir transici\xF3n al final del Cap\xEDtulo ${r}`,description:`Genera 1-2 p\xE1rrafos de transici\xF3n al final del Cap\xEDtulo ${r} que faciliten el paso narrativo hacia el Cap\xEDtulo ${e}. Incluye anticipaci\xF3n sutil del cambio de escena.`,chapterToModify:r,transitionContext:s,estimatedTokens:1200}),a.push({id:`add-transition-start-${e}`,type:"add_transition",label:`A\xF1adir transici\xF3n al inicio del Cap\xEDtulo ${e}`,description:`Genera 1-2 p\xE1rrafos de apertura del Cap\xEDtulo ${e} que conecten narrativamente con el cierre del Cap\xEDtulo ${r}. Incluye orientaci\xF3n contextual para el lector.`,chapterToModify:e,transitionContext:s,estimatedTokens:1200}),a.push({id:`add-transition-both-${r}-${e}`,type:"add_transition",label:"A\xF1adir transiciones a ambos cap\xEDtulos",description:`Genera transiciones complementarias: un p\xE1rrafo de cierre para el Cap\xEDtulo ${r} y otro de apertura para el Cap\xEDtulo ${e}, creando una conexi\xF3n narrativa fluida.`,chaptersToMerge:[r,e],transitionContext:s,estimatedTokens:2e3}),a}function v4(r){let e=(r.location||"").match(/captulo\s*(\d+)\s*vs\.?\s*captulo\s*(\d+)/i)||r.description.match(/captulo\s*(\d+)\s*vs\.?\s*captulo\s*(\d+)/i);if(!e){let u=/captulo\s*(\d+)/gi,c=[],p;for(;(p=u.exec(r.description))!==null;){let m=parseInt(p[1]);c.includes(m)||c.push(m)}return c.length>=2?{chapterA:c[0],chapterB:c[1],factA:"",factB:"",conflictType:y4(r.description)}:null}let t=parseInt(e[1]),n=parseInt(e[2]),a=r.description.match(/\*\*Captulo\s*\d+\*\*[:\s]*["']([^"']+)["']/i)||r.description.match(/en\s*el\s*captulo\s*\d+[,\s]+([^.]+)/i),s=r.description.match(/\*\*Captulo\s*\d+\*\*[:\s]*["']([^"']+)["']/gi),o=a?a[1]:"",i="";if(s&&s.length>=2){let u=s[1].match(/["']([^"']+)["']/);u&&(i=u[1])}return{chapterA:t,chapterB:n,factA:o,factB:i,conflictType:y4(r.description)}}function y4(r){let e=r.toLowerCase();return e.includes("hora")||e.includes("tiempo")||e.includes("22:")||e.includes("amanecer")||e.includes("noche")||e.includes("d\xEDa")?"temporal":e.includes("lugar")||e.includes("ubicaci\xF3n")||e.includes("casa")||e.includes("despacho")||e.includes("oficina")?"spatial":e.includes("personaje")||e.includes("nombre")||e.includes("cabello")||e.includes("ojos")||e.includes("aspecto")?"character":e.includes("objeto")||e.includes("arma")||e.includes("coche")||e.includes("documento")?"object":"logic"}function E4(r,e){let t=[];return t.push({id:`modify-a-${r.chapterA}`,type:"modify_a",label:`Modificar Cap\xEDtulo ${r.chapterA}`,description:`Ajustar el Cap\xEDtulo ${r.chapterA} para que sea consistente con el Cap\xEDtulo ${r.chapterB}`,chapterToModify:r.chapterA,estimatedTokens:1500}),t.push({id:`modify-b-${r.chapterB}`,type:"modify_b",label:`Modificar Cap\xEDtulo ${r.chapterB}`,description:`Ajustar el Cap\xEDtulo ${r.chapterB} para que sea consistente con el Cap\xEDtulo ${r.chapterA}`,chapterToModify:r.chapterB,estimatedTokens:1500}),t.push({id:`explain-${r.chapterA}-${r.chapterB}`,type:"add_explanation",label:"A\xF1adir explicaci\xF3n narrativa",description:"Insertar una explicaci\xF3n en el texto que justifique la aparente inconsistencia (ej: paso del tiempo, cambio de planes del personaje, etc.)",chapterToModify:r.chapterB,estimatedTokens:800}),t}function C4(r){let e=r.toLowerCase();return e.includes("cap\xEDtulo")&&(e.includes("id\xE9ntic")||e.includes("duplicad"))?"duplicate_chapters":e.includes("escena")&&(e.includes("duplicad")||e.includes("repet"))?"duplicate_scenes":"redundant_content"}function A4(r,e){let t=[],n=`${r} ${e}`,a=/Captulo\s*(\d+)/gi,s;for(;(s=a.exec(n))!==null;){let c=parseInt(s[1]);!t.includes(c)&&c>0&&c<200&&t.push(c)}let o=/captulos?\s*(\d+)\s*(?:,\s*(\d+)\s*)?(?:y|,)\s*(?:captulo\s*)?(\d+)/gi;for(;(s=o.exec(n))!==null;)for(let c=1;c<=3;c++)if(s[c]){let p=parseInt(s[c]);!t.includes(p)&&p>0&&p<200&&t.push(p)}let i=/(\d+)\s*,\s*(\d+)\s*y\s*(\d+)/g;for(;(s=i.exec(n))!==null;)for(let c=1;c<=3;c++)if(s[c]){let p=parseInt(s[c]);!t.includes(p)&&p>0&&p<200&&t.push(p)}let u=/(\d+)\s*y\s*(\d+)/g;for(;(s=u.exec(n))!==null;)for(let c=1;c<=2;c++)if(s[c]){let p=parseInt(s[c]);!t.includes(p)&&p>0&&p<200&&t.push(p)}if(r){let c=/(\d+)/g,p=r.split(/[,y]/i);for(let m of p){let f=m.match(c);if(f)for(let g of f){let y=parseInt(g);!t.includes(y)&&y>0&&y<200&&t.push(y)}}}return t.sort((c,p)=>c-p)}function kie(r,e){let t=[];for(let n of e){let a=new RegExp(`(Cap\xEDtulo\\s*${n}[^\\n]*\\n)([\\s\\S]*?)(?=Cap\xEDtulo\\s*\\d+|$)`,"i"),s=r.match(a);s&&t.push(s[0].trim())}return t}function Die(r){return[/se repite\s*(con|en)/i,/repeti(cin|tiv[ao])/i,/misma\s*(escena|descripcin|accin)/i,/muy\s*similar(es)?/i,/sensacin\s*de\s*repeticin/i,/objeto(tiva)?mente\s*se\s*repite/i,/telfono\s*vibr/i,/llamada\s*(de|del)\s*\w+\s*se\s*repite/i].some(t=>t.test(r))}function Mie(r){return[/interaccin\s+redundante/i,/redundante\s+con/i,/el\s+mismo\s+\w+\s+(para|que)/i,/primera\s+parte.*segunda\s+parte/i,/mismo\s+fragmento/i,/entrega.*el\s+mismo/i].some(t=>t.test(r))}function S4(r,e){let t=[],n=Die(e);if(Mie(e)&&r.length<=1){let o=r.length===1?`Cap\xEDtulo ${r[0]}`:"Ep\xEDlogo";return t.push({id:"remove-first-occurrence",type:"rewrite",label:"\u2728 RECOMENDADO: Eliminar primera aparici\xF3n",description:`Elimina la primera interacci\xF3n redundante del ${o}, manteniendo la segunda que es m\xE1s significativa narrativamente.`,chaptersToMerge:r.length>0?r:[0],estimatedTokens:2e3}),t.push({id:"remove-second-occurrence",type:"rewrite",label:"Eliminar segunda aparici\xF3n",description:`Elimina la segunda interacci\xF3n del ${o}, manteniendo solo la primera.`,chaptersToMerge:r.length>0?r:[0],estimatedTokens:2e3}),t.push({id:"modify-to-differ",type:"rewrite",label:"Modificar para diferenciar",description:"Modifica una de las interacciones para que sean claramente diferentes y no redundantes.",chaptersToMerge:r.length>0?r:[0],estimatedTokens:2500}),t}if(/fecha.*inconsistente|afirma.*sin embargo|'[^']+'.*pero|hace\s+\w+\s+semanas/i.test(e))return t.push({id:"fix-dialogue",type:"rewrite",label:"\u2728 RECOMENDADO: Corregir el di\xE1logo",description:"Modifica el di\xE1logo para que sea consistente con la cronolog\xEDa establecida. Ajusta la referencia temporal para que coincida con los eventos.",chaptersToMerge:r.length>0?r:[0],estimatedTokens:2e3}),t.push({id:"add-clarification",type:"rewrite",label:"A\xF1adir aclaraci\xF3n narrativa",description:"Mantiene el di\xE1logo pero a\xF1ade una aclaraci\xF3n del narrador que explique la discrepancia o corrija la percepci\xF3n del lector.",chaptersToMerge:r.length>0?r:[0],estimatedTokens:2500}),t;if(n&&r.length>2)t.push({id:"vary-all-scenes",type:"rewrite",label:"\u2728 RECOMENDADO: Variar la escena en cada cap\xEDtulo",description:`Mantiene la primera aparici\xF3n y genera variaciones \xFAnicas para los cap\xEDtulos ${r.slice(1).join(", ")}. Cada variaci\xF3n tendr\xE1 diferente enfoque narrativo.`,chaptersToMerge:r.slice(1),estimatedTokens:r.length*1500}),t.push({id:"keep-first-remove-rest",type:"delete",label:"Eliminar escena de cap\xEDtulos posteriores",description:`Mantiene la escena solo en Cap\xEDtulo ${r[0]} y la elimina de los cap\xEDtulos ${r.slice(1).join(", ")}`,chapterToKeep:r[0],chaptersToDelete:r.slice(1)}),t.push({id:"keep-last-remove-rest",type:"delete",label:"Mantener solo en \xFAltimo cap\xEDtulo",description:`Elimina la escena de los cap\xEDtulos ${r.slice(0,-1).join(", ")} y la mantiene solo en Cap\xEDtulo ${r[r.length-1]}`,chapterToKeep:r[r.length-1],chaptersToDelete:r.slice(0,-1)});else{t.push({id:"delete-keep-first",type:"delete",label:`Eliminar duplicados (mantener Cap\xEDtulo ${r[0]})`,description:`Mantiene el Cap\xEDtulo ${r[0]} y elimina los cap\xEDtulos ${r.slice(1).join(", ")}`,chapterToKeep:r[0],chaptersToDelete:r.slice(1)}),r.length>1&&t.push({id:"delete-keep-last",type:"delete",label:`Eliminar duplicados (mantener Cap\xEDtulo ${r[r.length-1]})`,description:`Mantiene el Cap\xEDtulo ${r[r.length-1]} y elimina los cap\xEDtulos ${r.slice(0,-1).join(", ")}`,chapterToKeep:r[r.length-1],chaptersToDelete:r.slice(0,-1)});for(let o of r.slice(1))t.push({id:`rewrite-${o}`,type:"rewrite",label:`Reescribir Cap\xEDtulo ${o}`,description:`Genera contenido completamente nuevo para el Cap\xEDtulo ${o}, diferente al Cap\xEDtulo ${r[0]}`,chaptersToMerge:[o],estimatedTokens:3e3});r.length===2&&t.push({id:`merge-${r.join("-")}`,type:"merge",label:`Fusionar Cap\xEDtulos ${r.join(" y ")}`,description:"Combina los mejores elementos de ambos cap\xEDtulos en uno solo",chaptersToMerge:r,estimatedTokens:4e3})}return t}async function Ux(r,e,t,n){try{let[a]=await M.select().from(Be).where(q(Be.id,r));if(!a)return{success:!1,error:"Manuscrito no encontrado"};let s=a.pendingCorrections||[],o=s.find(m=>m.id===e);if(!o)return{success:!1,error:"Issue estructural no encontrado"};let i=yb(o);if(!i)return{success:!1,error:"No es un problema estructural v\xE1lido"};let u=i.resolutionOptions.find(m=>m.id===t);if(!u)return{success:!1,error:`Opci\xF3n de resoluci\xF3n '${t}' no v\xE1lida. Opciones disponibles: ${i.resolutionOptions.map(m=>m.id).join(", ")}`};let c=a.correctedContent||a.originalContent;switch(n?.({phase:"resolving",message:`Aplicando resoluci\xF3n: ${u.type}...`}),u.type){case"delete":c=await Uie(c,u,n);break;case"rewrite":c=await Bie(c,u,o.instruction,n);break;case"merge":c=await Fie(c,u,n);break;case"modify_a":case"modify_b":case"add_explanation":if(i.conflictDetails)c=await Gie(c,u,i.conflictDetails,o.instruction,n);else return{success:!1,error:"No hay detalles del conflicto de continuidad"};break;case"add_transition":if(u.transitionContext)c=await Vie(c,u,o.instruction,n);else return{success:!1,error:"No hay contexto de transici\xF3n disponible"};break}let p=s.map(m=>m.id===e?{...m,status:"applied",correctedText:`[RESOLUCI\xD3N ESTRUCTURAL] ${u.type}: ${u.description}`,reviewedAt:new Date().toISOString()}:m);return await M.update(Be).set({correctedContent:c,pendingCorrections:p,approvedIssues:(a.approvedIssues||0)+1}).where(q(Be.id,r)),n?.({phase:"completed",message:"Resoluci\xF3n estructural aplicada exitosamente"}),{success:!0}}catch(a){return console.error("Error aplicando resoluci\xF3n estructural:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function Uie(r,e,t){let n=r,a=e.chaptersToDelete||[];for(let s=0;s<a.length;s++){let o=a[s];t?.({phase:"resolving",message:`Eliminando Cap\xEDtulo ${o}...`,current:s+1,total:a.length});let i=new RegExp(`(Cap\xEDtulo\\s*${o}[^\\n]*\\n)([\\s\\S]*?)(?=Cap\xEDtulo\\s*\\d+|$)`,"i");n=n.replace(i,"")}return n=R4(n),n}async function Bie(r,e,t,n){let a=e.chaptersToMerge?.[0];if(!a)return r;n?.({phase:"rewriting",message:`Generando nuevo contenido para Cap\xEDtulo ${a}...`});let s=new RegExp(`(Cap\xEDtulo\\s*${a}[^\\n]*\\n)([\\s\\S]*?)(?=Cap\xEDtulo\\s*\\d+|$)`,"i"),o=r.match(s);if(!o)return r;let i=o[1],u=o[2],c=gb(r,a-1),p=gb(r,a+1),m=`Eres un novelista experto. El siguiente cap\xEDtulo tiene contenido duplicado con otros cap\xEDtulos y debe ser COMPLETAMENTE REESCRITO con eventos DIFERENTES.

PROBLEMA: ${t}

CAP\xCDTULO ANTERIOR (para continuidad):
${c?c.substring(0,2e3):"Es el primer cap\xEDtulo."}

CAP\xCDTULO A REESCRIBIR:
${u}

CAP\xCDTULO SIGUIENTE (para continuidad):
${p?p.substring(0,2e3):"Es el \xFAltimo cap\xEDtulo."}

INSTRUCCIONES:
1. Genera contenido COMPLETAMENTE NUEVO y DIFERENTE
2. Mant\xE9n los mismos personajes pero con eventos distintos
3. Asegura continuidad con el cap\xEDtulo anterior y siguiente
4. Mant\xE9n el estilo y tono del autor original
5. Longitud similar al original (${u.split(/\s+/).length} palabras aprox.)

Devuelve SOLO el contenido del cap\xEDtulo reescrito, sin el encabezado "Cap\xEDtulo X":`;try{let g=(await jx.chat.completions.create({model:"deepseek-chat",messages:[{role:"system",content:"Eres un novelista profesional que reescribe cap\xEDtulos manteniendo el estilo del autor."},{role:"user",content:m}],temperature:.8,max_tokens:4e3})).choices[0]?.message?.content?.trim()||u;return r.replace(s,`${i}${g}

`)}catch(f){return console.error("Error reescribiendo cap\xEDtulo:",f),r}}async function Fie(r,e,t){let n=e.chaptersToMerge||[];if(n.length<2)return r;t?.({phase:"resolving",message:`Fusionando Cap\xEDtulos ${n.join(" y ")}...`});let a=[];for(let o of n){let i=gb(r,o);i&&a.push(i)}if(a.length<2)return r;let s=`Eres un editor literario experto. Debes FUSIONAR los siguientes cap\xEDtulos duplicados en UNO SOLO, conservando los mejores elementos de cada uno.

CAP\xCDTULO ${n[0]}:
${a[0]}

CAP\xCDTULO ${n[1]}:
${a[1]}

INSTRUCCIONES:
1. Combina los mejores elementos narrativos de ambos cap\xEDtulos
2. Elimina redundancias y repeticiones
3. Mant\xE9n coherencia narrativa
4. El resultado debe ser UN SOLO cap\xEDtulo cohesivo
5. Mant\xE9n el estilo y tono originales

Devuelve SOLO el contenido fusionado del cap\xEDtulo, sin encabezados:`;try{let i=(await jx.chat.completions.create({model:"deepseek-chat",messages:[{role:"system",content:"Eres un editor literario que fusiona cap\xEDtulos duplicados."},{role:"user",content:s}],temperature:.6,max_tokens:5e3})).choices[0]?.message?.content?.trim();if(i){let u=r,c=n[0],p=new RegExp(`(Cap\xEDtulo\\s*${c}[^\\n]*\\n)([\\s\\S]*?)(?=Cap\xEDtulo\\s*\\d+|$)`,"i"),m=u.match(p);m&&(u=u.replace(p,`${m[1]}${i}

`));for(let f of n.slice(1)){let g=new RegExp(`(Cap\xEDtulo\\s*${f}[^\\n]*\\n)([\\s\\S]*?)(?=Cap\xEDtulo\\s*\\d+|$)`,"i");u=u.replace(g,"")}return u=R4(u),u}}catch(o){console.error("Error fusionando cap\xEDtulos:",o)}return r}function gb(r,e){let t=new RegExp(`Cap\xEDtulo\\s*${e}[^\\n]*\\n([\\s\\S]*?)(?=Cap\xEDtulo\\s*\\d+|$)`,"i"),n=r.match(t);return n?n[1].trim():null}function R4(r){let e=1;return r.replace(/Captulo\s*\d+/gi,()=>`Cap\xEDtulo ${e++}`)}function yb(r){let e={description:r.instruction,location:r.location,severity:r.severity};if(b4(e)){let n=v4(e);if(n)return console.log(`[StructuralResolver] Conflicto de continuidad detectado: Cap ${n.chapterA} vs Cap ${n.chapterB}`),{id:r.id,type:"continuity_conflict",severity:r.severity,description:r.instruction,affectedChapters:[n.chapterA,n.chapterB],affectedContent:[],resolutionOptions:E4(n,r.instruction),conflictDetails:n}}if(!qie(r.instruction))return null;let t=A4(r.location,r.instruction);return t.length<=1?(console.log(`[StructuralResolver] No se pudieron extraer cap\xEDtulos de: location="${r.location}", instruction="${r.instruction.substring(0,100)}..."`),null):(console.log(`[StructuralResolver] Cap\xEDtulos afectados detectados: ${t.join(", ")}`),{id:r.id,type:C4(r.instruction),severity:r.severity,description:r.instruction,affectedChapters:t,affectedContent:[],resolutionOptions:S4(t,r.instruction)})}function qie(r){return[/captulos?\s+(son\s+)?idnticos/i,/repeticin\s+literal/i,/mismo[s]?\s+evento[s]?/i,/contenido\s+duplicado/i,/escenas?\s+duplicada/i,/captulos?\s+duplicados/i,/exactamente\s+los\s+mismos/i].some(t=>t.test(r))}async function Gie(r,e,t,n,a){let s=e.chapterToModify||t.chapterB,o=gb(r,s);if(!o)throw new Error(`No se pudo extraer el contenido del Cap\xEDtulo ${s}`);a?.({phase:"rewriting",message:`Generando correcci\xF3n para Cap\xEDtulo ${s}...`});let i="";if(e.type==="modify_a"||e.type==="modify_b"){let m=e.type==="modify_a"?t.chapterB:t.chapterA;i=`Eres un editor literario experto. Debes modificar el siguiente cap\xEDtulo para resolver una inconsistencia de continuidad.

PROBLEMA DETECTADO:
${n}

CAP\xCDTULO A MODIFICAR (Cap\xEDtulo ${s}):
${o.substring(0,8e3)}

INSTRUCCIONES:
1. Modifica SOLO las partes necesarias para que sea consistente con el Cap\xEDtulo ${m}
2. Mant\xE9n el estilo narrativo, tono y voz del autor original
3. Los cambios deben ser m\xEDnimos y quir\xFArgicos
4. Devuelve el cap\xEDtulo completo modificado, sin explicaciones ni markdown

CAP\xCDTULO CORREGIDO:`}else if(e.type==="add_explanation")i=`Eres un editor literario experto. Debes a\xF1adir una explicaci\xF3n narrativa sutil que justifique una aparente inconsistencia.

PROBLEMA DETECTADO:
${n}

CAP\xCDTULO DONDE A\xD1ADIR EXPLICACI\xD3N (Cap\xEDtulo ${s}):
${o.substring(0,8e3)}

INSTRUCCIONES:
1. A\xF1ade una frase o p\xE1rrafo breve que explique narrativamente la inconsistencia
2. La explicaci\xF3n debe ser natural y fluir con el texto existente
3. Puede ser un pensamiento del personaje, una transici\xF3n temporal, o un detalle contextual
4. Mant\xE9n el estilo del autor
5. Devuelve el cap\xEDtulo completo con la explicaci\xF3n integrada, sin comentarios ni markdown

CAP\xCDTULO CON EXPLICACI\xD3N:`;else throw new Error(`Tipo de resoluci\xF3n no soportado: ${e.type}`);let c=(await jx.chat.completions.create({model:"deepseek-chat",messages:[{role:"user",content:i}],temperature:.4,max_tokens:8e3})).choices[0]?.message?.content?.trim();if(!c||c.length<100)throw new Error("La respuesta del modelo fue demasiado corta o vac\xEDa");let p=new RegExp(`(Cap\xEDtulo\\s*${s}[^\\n]*\\n)([\\s\\S]*?)(?=Cap\xEDtulo\\s*\\d+|$)`,"i");return r.replace(p,`$1${c}

`)}async function Vie(r,e,t,n){let{GoogleGenAI:a}=await import("@google/genai"),s=process.env.GEMINI_API_KEY||process.env.AI_INTEGRATIONS_GEMINI_API_KEY;if(!s)throw new Error("No se encontr\xF3 API key de Gemini");let o=new a({apiKey:s}),i=e.transitionContext;n?.({phase:"rewriting",message:`Generando transici\xF3n narrativa entre Cap\xEDtulo ${i.fromChapter} y ${i.toChapter}...`});let u="",c,p;e.id.includes("end-")?(c=i.fromChapter,p="end",u=`Eres un escritor literario experto en narrativa de thriller/novela negra. Tu tarea es generar 1-2 p\xE1rrafos de TRANSICI\xD3N que se a\xF1adir\xE1n al FINAL del Cap\xEDtulo ${i.fromChapter} para crear una conexi\xF3n narrativa fluida con el Cap\xEDtulo ${i.toChapter}.

PROBLEMA DETECTADO:
${t}

CONTEXTO - FINAL DEL CAP\xCDTULO ${i.fromChapter}:
"""
${i.endingContext}
"""

CONTEXTO - INICIO DEL CAP\xCDTULO ${i.toChapter}:
"""
${i.startingContext}
"""

INSTRUCCIONES:
1. Genera SOLO 1-2 p\xE1rrafos de transici\xF3n (m\xE1ximo 200 palabras)
2. La transici\xF3n debe cerrar naturalmente la escena del Cap\xEDtulo ${i.fromChapter}
3. Incluye sutilmente una anticipaci\xF3n del cambio de escena/ubicaci\xF3n/tiempo
4. Mant\xE9n el mismo estilo narrativo y tono del texto original
5. NO uses frases clich\xE9 como "mientras tanto" o "en otro lugar"
6. Puede incluir pensamientos del personaje, paso del tiempo, o detalles sensoriales
7. Devuelve SOLO los p\xE1rrafos de transici\xF3n, sin explicaciones ni markdown

P\xC1RRAFOS DE TRANSICI\xD3N:`):e.id.includes("start-")?(c=i.toChapter,p="start",u=`Eres un escritor literario experto en narrativa de thriller/novela negra. Tu tarea es generar 1-2 p\xE1rrafos de APERTURA que se a\xF1adir\xE1n al INICIO del Cap\xEDtulo ${i.toChapter} para crear una conexi\xF3n narrativa fluida con el Cap\xEDtulo ${i.fromChapter}.

PROBLEMA DETECTADO:
${t}

CONTEXTO - FINAL DEL CAP\xCDTULO ${i.fromChapter}:
"""
${i.endingContext}
"""

CONTEXTO - INICIO ACTUAL DEL CAP\xCDTULO ${i.toChapter}:
"""
${i.startingContext}
"""

INSTRUCCIONES:
1. Genera SOLO 1-2 p\xE1rrafos de apertura/orientaci\xF3n (m\xE1ximo 200 palabras)
2. La apertura debe orientar al lector sobre el cambio de escena/ubicaci\xF3n/tiempo
3. Conecta sutilmente con lo que ocurri\xF3 en el Cap\xEDtulo ${i.fromChapter}
4. Mant\xE9n el mismo estilo narrativo y tono del texto original
5. NO uses frases clich\xE9 como "mientras tanto" o "al d\xEDa siguiente"
6. Puede incluir reflexiones del personaje, descripci\xF3n del nuevo entorno, o paso del tiempo
7. Devuelve SOLO los p\xE1rrafos de apertura, sin explicaciones ni markdown

P\xC1RRAFOS DE APERTURA:`):(p="both",u=`Eres un escritor literario experto en narrativa de thriller/novela negra. Tu tarea es generar transiciones COMPLEMENTARIAS: un p\xE1rrafo de cierre para el Cap\xEDtulo ${i.fromChapter} y otro de apertura para el Cap\xEDtulo ${i.toChapter}.

PROBLEMA DETECTADO:
${t}

CONTEXTO - FINAL DEL CAP\xCDTULO ${i.fromChapter}:
"""
${i.endingContext}
"""

CONTEXTO - INICIO DEL CAP\xCDTULO ${i.toChapter}:
"""
${i.startingContext}
"""

INSTRUCCIONES:
1. Genera exactamente 2 secciones claramente separadas
2. CIERRE (1 p\xE1rrafo): Transici\xF3n natural que cierra el Cap\xEDtulo ${i.fromChapter}
3. APERTURA (1 p\xE1rrafo): Orientaci\xF3n que abre el Cap\xEDtulo ${i.toChapter}
4. M\xE1ximo 150 palabras por secci\xF3n
5. Mant\xE9n el mismo estilo narrativo y tono
6. Evita clich\xE9s narrativos

Formato de respuesta:
---CIERRE---
[p\xE1rrafo de cierre]
---APERTURA---
[p\xE1rrafo de apertura]`,c=i.fromChapter);let f=(await o.models.generateContent({model:"gemini-2.0-flash",contents:u,config:{temperature:.7,maxOutputTokens:1500}})).text?.trim();if(!f||f.length<50)throw new Error("La respuesta del modelo fue demasiado corta o vac\xEDa");if(console.log(`[Transition] Generated transition (${f.length} chars) for position: ${p}`),p==="end"){let g=new RegExp(`(===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?)\\s*${c}[^=]*===)([\\s\\S]*?)(===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?|EP\xCDLOGO))`,"i");return r.replace(g,(y,C,A,T)=>{let E=A.trimEnd();return`${C}${E}

${f}

${T}`})}else if(p==="start"){let g=new RegExp(`(===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?)\\s*${c}[^=]*===\\s*\\n+)`,"i");return r.replace(g,`$1${f}

`)}else{let g=f.match(/---CIERRE---\s*([\s\S]*?)---APERTURA---\s*([\s\S]*)/i);if(!g){console.log("[Transition] Could not parse both sections, applying as single transition");let d=new RegExp(`(===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?)\\s*${i.fromChapter}[^=]*===)([\\s\\S]*?)(===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?|EP\xCDLOGO))`,"i");return r.replace(d,(l,h,v,S)=>{let R=v.trimEnd();return`${h}${R}

${f.replace(/---.*?---/g,"").trim()}

${S}`})}let y=g[1].trim(),C=g[2].trim(),A=r,T=new RegExp(`(===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?)\\s*${i.fromChapter}[^=]*===)([\\s\\S]*?)(===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?|EP\xCDLOGO))`,"i");A=A.replace(T,(d,l,h,v)=>{let S=h.trimEnd();return`${l}${S}

${y}

${v}`});let E=new RegExp(`(===\\s*(?:CAP\xCDTULO|Cap\xEDtulo|Cap\\.?)\\s*${i.toChapter}[^=]*===\\s*\\n+)`,"i");return A=A.replace(E,`$1${C}

`),A}}var jx,bb=G(()=>{"use strict";As();Mo();ms();Da();jx=new Ve({baseURL:"https://api.deepseek.com",apiKey:process.env.DEEPSEEK_API_KEY})});var mo={};wr(mo,{applyStructuralResolution:()=>Ux,approveCorrection:()=>fce,correctSingleIssue:()=>pi,extractFlowBreakContext:()=>Dx,finalizeManuscript:()=>yce,generateFlowTransitionOptions:()=>Mx,getStructuralIssueFromCorrection:()=>yb,isNarrativeFlowIssue:()=>kx,rejectCorrection:()=>gce,startCorrectionProcess:()=>hce});function w4(r){let e=[],t=[/Cap[i]tulos?\s*([\d,\s]+(?:y\s*\d+)?)/gi,/Cap[i]tulo\s*(\d+)/gi,/captulos\s*(\d+),\s*(\d+),\s*(\d+)/gi,/en los captulos\s*([\d,\sy]+)/gi];for(let n of t){let a;for(;(a=n.exec(r))!==null;){let o=(a[1]||a[0]).match(/\d+/g);if(o)for(let i of o){let u=parseInt(i,10);u>0&&u<100&&e.push(u)}}}if(e.length===0){let n=r.match(/\d+/g);if(n)for(let a of n){let s=parseInt(a,10);s>0&&s<100&&e.push(s)}}return Array.from(new Set(e)).sort((n,a)=>n-a)}function Hie(r){let e=[],t=[/Cap[i]tulos?\s*([\d,\s]+(?:y\s*\d+)?)/gi,/en (?:el )?cap[i]tulo\s*(\d+)/gi,/captulos\s+(\d+)(?:,\s*(\d+))+/gi];for(let n of t){let a;for(;(a=n.exec(r))!==null;)for(let s=1;s<a.length;s++)if(a[s]){let o=a[s].match(/\d+/g);if(o)for(let i of o){let u=parseInt(i,10);u>0&&u<100&&e.push(u)}}}return Array.from(new Set(e)).sort((n,a)=>n-a)}function Wie(r){let e=/(?:^|\n)((?:EPLOGO|Eplogo|EPILOGO|Epilogo)[^\n]*\n)([\s\S]*?)$/i,t=r.match(e);return t?{title:t[1].trim(),content:t[2].trim()}:null}function Qie(r,e,t){if(!e||e.length<2)return null;let n=[],a=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");n.push(`[^.]*${a}[^.]*\\.`),t==="ojos"||t==="eyes"?(n.push(`[^.]*ojos\\s+${a}[^.]*\\.`),n.push(`[^.]*${a}\\s+ojos[^.]*\\.`),n.push(`[^.]*mirada\\s+${a}[^.]*\\.`),n.push(`[^.]*iris\\s+${a}[^.]*\\.`)):(t==="cabello"||t==="pelo"||t==="hair")&&(n.push(`[^.]*cabello\\s+${a}[^.]*\\.`),n.push(`[^.]*${a}\\s+cabello[^.]*\\.`),n.push(`[^.]*pelo\\s+${a}[^.]*\\.`),n.push(`[^.]*melena\\s+${a}[^.]*\\.`));for(let o of n)try{let i=new RegExp(o,"gi"),u=r.match(i);if(u&&u.length>0)return u[0].trim()}catch{continue}let s=r.match(new RegExp(`[^.]{0,100}${a}[^.]{0,100}\\.`,"i"));return s?s[0].trim():null}function Jie(r,e,t,n){let a=e.split(" ")[0],s=e.split(" ").slice(1).join(" "),o=n.toLowerCase().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=[];t==="ojos"||t==="eyes"?i=[/[^.]*\bojos\s+(\w+(?:\s+\w+)?)[^.]*\./gi,/[^.]*\bmirada\s+(\w+)[^.]*\./gi,/[^.]*\biris\s+(\w+)[^.]*\./gi,/[^.]*(\w+)\s+ojos\b[^.]*\./gi]:(t==="cabello"||t==="pelo"||t==="hair")&&(i=[/[^.]*\bcabello\s+(\w+(?:\s+\w+)?)[^.]*\./gi,/[^.]*\bpelo\s+(\w+(?:\s+\w+)?)[^.]*\./gi,/[^.]*\bmelena\s+(\w+(?:\s+\w+)?)[^.]*\./gi,/[^.]*(\w+(?:\s+\w+)?)\s+cabello\b[^.]*\./gi]);for(let u of i){let c;for(;(c=u.exec(r))!==null;){let p=c[0],m=c[1]?.toLowerCase()||"";if(p.toLowerCase().includes(a.toLowerCase())||s&&p.toLowerCase().includes(s.toLowerCase())||i.length>0){let g=n.toLowerCase().split(/\s+/),y=m.split(/\s+/);if(!g.some(A=>y.some(T=>T.includes(A)||A.includes(T)))&&m.length>2)return console.log(`[CharacterBible Search] Encontrada menci\xF3n incorrecta: "${p.substring(0,60)}..." (valor: "${m}", deber\xEDa ser: "${n}")`),p.trim()}}}return null}async function Kie(r,e,t,n,a){if(!qm)return console.log("[AI-Search] No Gemini API key, skipping AI search"),null;try{let s=vb.getGenerativeModel({model:"gemini-2.0-flash"}),o=t.toLowerCase()==="nombre"||t.toLowerCase()==="name",i=["ojos","eyes","cabello","hair","pelo"].some(g=>t.toLowerCase().includes(g)),u="";o?u=`
1. Busca CUALQUIER menci\xF3n donde el personaje se presente o sea llamado por un nombre diferente a "${n}"
2. Busca di\xE1logos donde se presente: "\u2014Me llamo X", "Soy X", "Inspector/Inspectora X", "Doctor/Doctora X", etc.
3. Busca presentaciones narrativas: "X se present\xF3", "conocido como X", "llamado X"
4. El nombre incorrecto puede ser un nombre completo, solo el nombre de pila, o solo el apellido diferente`:i?u=`
1. Busca CUALQUIER oraci\xF3n que describa el ${t} del personaje
2. Considera sin\xF3nimos: para "ojos" \u2192 "mirada", "iris", "pupilas"; para "cabello" \u2192 "pelo", "melena", "cabellera"
3. Busca descripciones como "sus ojos X", "el pelo X", "mirada X", "cabello X y rizado", etc.
4. El personaje puede referirse por nombre, apellido, o pronombres`:u=`
1. Busca CUALQUIER oraci\xF3n que mencione el ${t} del personaje
2. Busca descripciones directas e indirectas del atributo
3. El personaje puede referirse por nombre, apellido, o pronombres`;let c=`Eres un detector de inconsistencias en manuscritos literarios.

TAREA: Buscar en el siguiente cap\xEDtulo cualquier menci\xF3n del atributo "${t}" del personaje "${e}" que NO coincida con el valor can\xF3nico de la Biblia de Personajes.

VALOR CAN\xD3NICO (Biblia de Personajes): ${t} = "${n}"

CAP\xCDTULO A ANALIZAR:
---
${a}
${r.substring(0,15e3)}
---

INSTRUCCIONES:${u}

FORMATO DE RESPUESTA (JSON estricto):
Si encuentras inconsistencia:
{"found": true, "sentence": "La oraci\xF3n exacta del manuscrito que contiene el valor incorrecto", "incorrectValue": "el valor incorrecto mencionado"}

Si NO hay inconsistencia o el atributo no se menciona:
{"found": false}

IMPORTANTE: Solo devuelve el JSON, sin explicaciones ni markdown.`,m=(await s.generateContent(c)).response.text().trim();console.log(`[AI-Search] Response for ${e}/${t} in ${a}:`,m.substring(0,200));let f=m.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim();try{let g=JSON.parse(f);if(g.found&&g.sentence&&g.incorrectValue)return console.log(`[AI-Search] FOUND inconsistency: "${g.incorrectValue}" should be "${n}"`),{sentence:g.sentence,incorrectValue:g.incorrectValue}}catch(g){console.log("[AI-Search] Failed to parse JSON response:",g)}return null}catch(s){return console.error("[AI-Search] Error during AI search:",s),null}}async function Fm(r,e,t,n,a,s){let o=Qie(r,a,t);if(o)return{sentence:o,incorrectValue:a};console.log("[CharacterBible] Regex no encontr\xF3 valor incorrecto, intentando b\xFAsqueda con IA...");let i=Jie(r,e,t,n);return i?{sentence:i,incorrectValue:"detectado por regex"}:(console.log("[CharacterBible] Regex fall\xF3, usando Gemini AI para b\xFAsqueda flexible..."),await Kie(r,e,t,n,s))}function Xie(r){let e=[/La ficha de personaje de (\w+(?:\s+\w+)?)\s+describe su (\w+(?:\s+\w+)?)\s+como ['"]([^'"]+)['"]\.\s*Sin embargo,?\s*(?:en el )?(\w+(?:\s+\d+)?),?\s*se menciona que (?:su \w+ es |es )['"]?([^'".\n]+)['"]?/i,/ficha.*?(\w+(?:\s+\w+)?).*?(\w+).*?['"]([^'"]+)['"].*?(\w+(?:\s+\d+)?).*?['"]([^'"]+)['"]/i,/Character Bible.*?(\w+).*?['"]([^'"]+)['"].*?(\w+(?:\s+\d+)?).*?['"]([^'"]+)['"]/i];for(let T of e){let E=r.match(T);if(E&&E.length>=6)return{characterName:E[1].trim(),attribute:E[2].trim(),correctValue:E[3].trim(),incorrectValue:E[5].trim(),chapterName:E[4].trim()}}let t=r.match(/color de (?:cabello|ojos|pelo) de (\w+(?:\s+\w+)?)\s+es inconsistente/i),n=r.match(/(?:BIBLIA|Character Bible).*?(?:especifica|indica|dice).*?['"]([^'"]+)['"]/i)||r.match(/(?:BIBLIA|Character Bible).*?(?:hair|eyes|cabello|ojos)['"]?:\s*['"]([^'"]+)['"]/i),a=r.match(/(?:Prlogo|narrativa).*?(?:describe|se describe).*?como\s*['"]([^'"]+)['"]/i)||r.match(/se describen.*?como\s*['"]([^'"]+)['"]/i),s=r.match(/(Prlogo|Cap[i]tulo\s*\d+)\s*vs/i);if(t&&n){let T=t[1],E=n[1],d=a?a[1]:"",l=s?s[1]:"Pr\xF3logo",h=r.toLowerCase().includes("cabello")||r.toLowerCase().includes("hair")?"cabello":"ojos";return console.log("[CharacterBible] Color inconsistente detectado:",{characterName:T,attribute:h,correctValue:E,incorrectValue:d,location:l}),{characterName:T,attribute:h,correctValue:E,incorrectValue:d,chapterName:l}}let o=r.match(/Character Bible vs mltiples cap[i]tulos/i)||r.match(/BIBLIA.*?indica.*?son ['"]([^'"]+)['"]/i),i=r.match(/ojos son ['"]([^'"]+)['"]/i),u=r.match(/narrativa se describen.*?como ['"]([^'"]+)['"]/i),c=r.match(/Cap[i]tulos?\s*([\d,\s]+)/i);if(o||i&&u){let T=i?i[1]:"",E=u?u[1]:"",d=r.match(/de\s+(\w+\s+\w+)\s+es\s+inconsistente/i)||r.match(/ojos de\s+(\w+\s+\w+)/i);return console.log("[CharacterBible] Multi-cap\xEDtulo detectado:",{correctValue:T,incorrectValue:E,chapters:c?c[1]:"m\xFAltiples"}),{characterName:d?d[1]:"Personaje",attribute:"ojos",correctValue:T,incorrectValue:E,chapterName:c?`Cap\xEDtulos ${c[1]}`:"m\xFAltiples cap\xEDtulos"}}let p=r.match(/se (?:le )?presenta como ['"]([^'"]+)['"].*?(?:Biblia|Bible).*?(?:su nombre es|nombre es|es) ['"]([^'"]+)['"]/i),m=r.match(/(?:en el\s+)?(Cap[i]tulo\s*\d+|Prlogo)/i);if(p&&m)return console.log("[CharacterBible] Nombre inconsistente detectado:",{incorrectName:p[1],correctName:p[2],chapter:m[1]}),{characterName:p[2].split(" ")[0]||"Personaje",attribute:"nombre",correctValue:p[2].trim(),incorrectValue:p[1].trim(),chapterName:m[1].trim()};let f=r.match(/\*?\*?Character Bible\*?\*?:?\s*(?:\w+:?\s*)?["']([^"']+)["']/i)||r.match(/Character Bible.*?:\s*["']([^"']+)["']/i)||r.match(/Biblia de Personajes.*?["']([^"']+)["']/i)||r.match(/hair:\s*["']([^"']+)["']/i)||r.match(/cabello.*?como\s*["']([^"']+)["']/i)||r.match(/nombre es ['"]([^'"]+)['"]/i),g=r.match(/se (?:le )?presenta como ['"]([^'"]+)['"]/i)||r.match(/\*?\*?(?:Prlogo|Cap[i]tulo\s*\d+)\*?\*?:?\s*["']([^"']+)["']/i)||r.match(/(?:en el\s+)?(?:Prlogo|Cap[i]tulo\s*\d+).*?['"]([^'"]+)['"]/i),y=r.match(/(?:\*\*)?(?:en el\s+)?(Prlogo|Cap[i]tulo\s*\d+)(?:\*\*)?/i),C=r.match(/ficha de personaje de (\w+(?:\s+\w+)?)/i)||r.match(/personaje\s+de\s+(\w+(?:\s+\w+)?)/i)||r.match(/de\s+(\w+(?:\s+\w+)?)\s+describe/i)||r.match(/aliada? de (\w+)/i),A=r.match(/describe su (\w+(?:\s+\w+)?)/i)||r.match(/su\s+(\w+)\s+como/i)||r.match(/(\w+):\s*["'][^"']+["']/i)||r.match(/nombre.*?inconsistente/i);return f&&g&&y?(console.log("[CharacterBible] Extracted:",{correctValue:f[1],incorrectValue:g[1],chapter:y[1]}),{characterName:C?C[1].trim():"Personaje",attribute:A?A[1]?A[1].trim():"nombre":"atributo",correctValue:f[1].trim(),incorrectValue:g[1].trim(),chapterName:y[1].trim()}):null}function Yie(r,e,t){let n=r.split(/(?=^(?:Captulo|CAPTULO|Prlogo|PRLOGO)\s*\d*)/mi);for(let a=0;a<n.length;a++){let s=n[a],o=s.split(`
`)[0]||"";if(t.toLowerCase()==="pr\xF3logo"&&/prlogo/i.test(o)||new RegExp(t.replace(/\s+/g,"\\s*"),"i").test(o)){console.log(`[CharacterBible] Buscando "${e}" en ${t}`);let u=s.toLowerCase().indexOf(e.toLowerCase());if(u!==-1){let y=Math.max(0,s.lastIndexOf(".",u)+1),C=s.indexOf(".",u+e.length),A=s.substring(y,C>0?C+1:u+200).trim();return console.log(`[CharacterBible] Encontrado frase completa: "${A.substring(0,60)}..."`),{foundText:A,chapterContent:s,chapterIndex:a}}let c=e.split(/\s+/).filter(y=>y.length>3),p=c.map(y=>y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("\\s+"),m=new RegExp(p,"gi"),f=s.match(m);if(f){let y=s.search(m);if(y!==-1){let C=Math.max(0,s.lastIndexOf(".",y)+1),A=s.indexOf(".",y+f[0].length),T=s.substring(C,A>0?A+1:y+200).trim();if(T.length>10)return console.log(`[CharacterBible] Encontrado multi-palabra: "${T.substring(0,60)}..."`),{foundText:T,chapterContent:s,chapterIndex:a}}}let g=c[c.length-1];if(g&&g.length>4){let y=new RegExp(g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");if(s.match(y)){let A=s.search(y);if(A!==-1){let T=Math.max(0,s.lastIndexOf(".",A)+1),E=s.indexOf(".",A+g.length),d=s.substring(T,E>0?E+1:A+200).trim();if(d.length>10&&d.toLowerCase().includes(g.toLowerCase()))return console.log(`[CharacterBible] Encontrado por apellido "${g}": "${d.substring(0,60)}..."`),{foundText:d,chapterContent:s,chapterIndex:a}}}}console.log(`[CharacterBible] No encontrado "${e}" en ${t}`)}}return null}function Zie(r,e,t=500){let n=r.indexOf(e),a=e;if(n===-1){let i=e.replace(/\s+/g," ").trim(),c=r.replace(/\s+/g," ").indexOf(i);if(c===-1){let p=i.split(" ").filter(m=>m.length>5);if(p.length>0){let m=p.slice(0,3).map(y=>y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join(".*?"),f=new RegExp(m,"i"),g=r.match(f);if(g&&g.index!==void 0)n=g.index,a=g[0];else return{prevContext:"",nextContext:"",targetIndex:-1,actualTarget:e}}else return{prevContext:"",nextContext:"",targetIndex:-1,actualTarget:e}}else{let p=0,m=0;for(let g=0;g<r.length&&p<c;g++)(!/\s/.test(r[g])||g>0&&!/\s/.test(r[g-1]))&&p++,m=g;n=Math.max(0,m-i.length);let f=Math.min(r.length,n+i.length+100);a=r.substring(n,f).split(/\n\n/)[0]}}let s=r.substring(Math.max(0,n-t),n),o=r.substring(n+a.length,n+a.length+t);return{prevContext:s,nextContext:o,targetIndex:n,actualTarget:a}}function zc(r,e){let t=r.split(/\s+/).filter(a=>a.length>0),n=e.split(/\s+/).filter(a=>a.length>0);return{wordsAdded:Math.max(0,n.length-t.length),wordsRemoved:Math.max(0,t.length-n.length),lengthChange:e.length-r.length}}function O4(r){let e=r.trim(),t=[/^(aqu tienes|aqu est|here is|here's)[^:]*:/i,/^(el texto|the text)[^:]*:/i,/^(correccin|correction)[^:]*:/i,/^```[a-z]*\n?/i];for(let n of t)e=e.replace(n,"");return e=e.replace(/```$/g,""),e=e.replace(/^["']|["']$/g,""),e.trim()}function ece(r){let e=["salto abrupt","transici\xF3n","sin resolver","sin explicar","cliffhanger","no se explica","salta de","omite c\xF3mo","sin aclarar","queda sin resolver","no hay transici\xF3n","brecha narrativa","discontinuidad","una hora despu\xE9s","tiempo despu\xE9s","al d\xEDa siguiente"],t=r.toLowerCase();return e.some(n=>t.includes(n))}async function tce(r,e,t){if(!qm)return{success:!1,originalText:"",correctedText:"",transitionText:"",diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},error:"No hay API key de Gemini"};try{let n=vb.getGenerativeModel({model:"gemini-2.0-flash"}),a=`Eres un editor literario experto en continuidad narrativa.

PROBLEMA DETECTADO:
${e}

CAP\xCDTULO A ANALIZAR:
---
${t}
${r.substring(0,2e4)}
---

TAREA: Identificar el punto exacto donde hay un salto narrativo abrupto y proponer una transici\xF3n.

INSTRUCCIONES:
1. Encuentra la oraci\xF3n EXACTA donde termina la escena (antes del salto)
2. Encuentra la oraci\xF3n EXACTA donde comienza la nueva escena (despu\xE9s del salto)
3. Prop\xF3n un p\xE1rrafo de transici\xF3n (2-4 oraciones) que explique brevemente qu\xE9 pas\xF3 entre ambos momentos

FORMATO DE RESPUESTA (JSON estricto):
{
  "found": true,
  "beforeJump": "Oraci\xF3n exacta donde termina la escena antes del salto",
  "afterJump": "Oraci\xF3n exacta donde comienza la escena despu\xE9s del salto", 
  "proposedTransition": "P\xE1rrafo de transici\xF3n que explica lo que pas\xF3 entre ambos momentos, manteniendo el estilo del autor"
}

Si no puedes identificar el salto:
{"found": false, "reason": "explicaci\xF3n"}

IMPORTANTE: Solo devuelve el JSON, sin explicaciones ni markdown.`,o=(await n.generateContent(a)).response.text().trim();console.log("[Transition AI] Analysis response:",o.substring(0,300));let i=o.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim();try{let u=JSON.parse(i);if(u.found&&u.beforeJump&&u.afterJump&&u.proposedTransition){let c=r.indexOf(u.beforeJump),p=r.indexOf(u.afterJump);if(c!==-1&&p!==-1&&p>c){let m=r.substring(c,p+u.afterJump.length),f=`

${u.proposedTransition}

`,g=u.beforeJump+f+u.afterJump;return console.log(`[Transition AI] Found jump point, adding transition of ${u.proposedTransition.length} chars`),{success:!0,originalText:m,correctedText:g,transitionText:u.proposedTransition,diffStats:zc(m,g)}}else console.log("[Transition AI] Could not locate jump points in chapter")}}catch(u){console.log("[Transition AI] Failed to parse JSON response:",u)}return{success:!1,originalText:"",correctedText:"",transitionText:"",diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},error:"No se pudo identificar el punto de transici\xF3n"}}catch(n){return console.error("[Transition AI] Error:",n),{success:!1,originalText:"",correctedText:"",transitionText:"",diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},error:String(n)}}}async function pi(r){try{let{prevContext:e,nextContext:t,targetIndex:n,actualTarget:a}=Zie(r.fullChapter,r.targetText);if(n===-1)return{success:!1,originalText:r.targetText,correctedText:r.targetText,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},error:"Texto objetivo no encontrado en el cap\xEDtulo"};let s=a||r.targetText,o=`### CONTEXTO PREVIO (NO EDITAR)
${e.slice(-300)}

### TEXTO A CORREGIR (TARGET)
"${s}"

### CONTEXTO POSTERIOR (NO EDITAR)
${t.slice(0,300)}

### LA INCONSISTENCIA A REPARAR
Instrucci\xF3n: ${r.instruction}
Soluci\xF3n requerida: ${r.suggestion}

### REGLAS DE EJECUCI\xD3N (CR\xCDTICO - CUMPLIMIENTO OBLIGATORIO)
1. Reescribe SOLAMENTE el "TEXTO A CORREGIR". Ni una palabra m\xE1s, ni una palabra menos de lo necesario.
2. Mant\xE9n el tono, vocabulario y ritmo del autor EXACTAMENTE (ver Contexto Previo para referencia).
3. El nuevo texto debe fluir naturalmente hacia el "Contexto Posterior".
4. NO a\xF1adas informaci\xF3n nueva que no sea estrictamente necesaria para la correcci\xF3n.
5. PRESERVA todos los nombres, lugares, descripciones y hechos que ya eran correctos en el texto.
6. Tu correcci\xF3n debe tener longitud SIMILAR al texto original (\xB115%). No expandas ni recortes.
7. Devuelve SOLO el texto corregido, sin explicaciones ni markdown ni comillas.
8. PIENSA ANTES DE CORREGIR: \xBFtu cambio puede crear un nuevo problema de continuidad, estilo o coherencia? Si s\xED, busca una correcci\xF3n m\xE1s conservadora.`,u=(await Fx.chat.completions.create({model:"deepseek-chat",messages:[{role:"system",content:zie},{role:"user",content:o}],temperature:.3,max_tokens:2e3})).choices[0]?.message?.content||"",c=O4(u);if(!c||c.length>s.length*1.5||c.length<s.length*.4)return console.log(`[DeepSeek] Correcci\xF3n rechazada: longitud original=${s.length}, corregida=${c.length} (ratio=${(c.length/s.length).toFixed(2)})`),{success:!1,originalText:s,correctedText:s,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},error:"Correcci\xF3n descartada: cambio de longitud excesivo"};let p=new Set(s.toLowerCase().split(/\s+/).filter(C=>C.length>3)),m=new Set(c.toLowerCase().split(/\s+/).filter(C=>C.length>3)),f=0;for(let C of Array.from(p))m.has(C)&&f++;let g=p.size>0?f/p.size:1;if(g<.4)return console.log(`[DeepSeek] Correcci\xF3n rechazada: demasiado diferente (preservaci\xF3n=${(g*100).toFixed(0)}%)`),{success:!1,originalText:s,correctedText:s,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},error:"Correcci\xF3n descartada: reescritura excesiva"};let y=zc(s,c);return{success:!0,originalText:s,correctedText:c,diffStats:y}}catch(e){return console.error("Error en correcci\xF3n DeepSeek:",e),{success:!1,originalText:r.targetText,correctedText:r.targetText,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},error:e instanceof Error?e.message:"Error desconocido"}}}function rce(r,e){let n=[/a lo largo de la novela/i,/de forma (muy )?similar/i,/repetitiv[ao]/i,/en mltiples (captulos|escenas|lugares)/i,/frecuentemente/i,/constantemente/i,/siempre (se|usa|describe)/i,/en general/i,/throughout/i].some(o=>o.test(r));if(e&&/cap[i]tulo\s*\d+/i.test(e)&&!e.toLowerCase().includes("m\xFAltiples"))return!1;let s=!e||e.toLowerCase().includes("general")||e.toLowerCase().includes("m\xFAltiples");return n&&s}function nce(r){return[/(?:prlogo|cap\.?\s*\d+)(?:\s*,\s*(?:\d+|prlogo|cap\.?\s*\d+))+/i,/mltiples\s+cap[i]tulos/i,/cap[i]tulos?\s*[\d,\s]+/i,/\d+\s*,\s*\d+\s*,\s*\d+/].some(t=>t.test(r))}function ace(r){let e=[];/prlogo/i.test(r)&&e.push("pr\xF3logo");let t=/(?:cap\.?\s*)?(\d+)/gi,n;for(;(n=t.exec(r))!==null;){let a=parseInt(n[1]);!e.includes(a)&&a>0&&a<200&&e.push(a)}return e}function sce(r){let e=r.match(/'([^']{5,80})'/g);if(e&&e.length>0){let a=e[0].replace(/'/g,"").trim();return console.log(`[MultiChapter] Concepto de frase entrecomillada: "${a}"`),a}let t=r.match(/"([^"]{5,80})"/g);if(t&&t.length>0){let a=t[0].replace(/"/g,"").trim();return console.log(`[MultiChapter] Concepto de frase con comillas dobles: "${a}"`),a}let n=[/La descripcin del?\s+(.+?)\s+se repite/i,/descripcin de[l]?\s+(.+?)\s+se repite/i,/(.+?)\s+se repite con una frecuencia/i,/(.+?)\s+aparece de forma repetitiva/i,/menciones? de[l]?\s+(.+?)\s+(?:se|es|son)/i,/(?:el|la|los|las)\s+(.+?)\s+(?:es|son|aparece|se usa)/i,/Frases como\s+(.+?)\s+aparecen/i,/ejemplos? (?:incluyen?|como)\s+(.+?)(?:\.|,|$)/i];for(let a of n){let s=r.match(a);if(s&&s[1]){let o=s[1].trim();if(o.length>5&&o.length<200)return console.log(`[MultiChapter] Concepto extra\xEDdo por patr\xF3n: "${o}"`),o}}return console.log(`[MultiChapter] No se pudo extraer concepto de: "${r.substring(0,100)}..."`),null}function Is(r,e){let t;e==="pr\xF3logo"?t=/(?:^|\n)((?:PRLOGO|Prlogo)[^\n]*\n)([\s\S]*?)(?=\n(?:Captulo|CAPTULO|CAP\.)\s*\d+|$)/i:t=new RegExp(`(?:^|\\n)((?:Cap\xEDtulo|CAP\xCDTULO|CAP\\.?)\\s*${e}[^\\n]*\\n)([\\s\\S]*?)(?=\\n(?:Cap\xEDtulo|CAP\xCDTULO|CAP\\.?)\\s*\\d+|$)`,"i");let n=r.match(t);return n?{title:n[1].trim(),content:n[2].trim()}:null}function oce(r){let e=[],t=r.match(/'([^']{3,80})'/g)||[],n=r.match(/"([^"]{3,80})"/g)||[];for(let a of t)e.push(a.replace(/'/g,"").trim());for(let a of n)e.push(a.replace(/"/g,"").trim());return e.filter(a=>a.length>=3)}async function ice(r,e,t){let n=r.toLowerCase(),a=e.toLowerCase(),s=n.indexOf(a);if(s!==-1){let f=r.lastIndexOf(`
`,s)+1,g=r.indexOf(`
`,s),y=r.substring(f,g===-1?void 0:g).trim();if(y.length>=20){let C=Math.max(0,s-200),A=Math.min(r.length,s+e.length+200),T=r.substring(C,A);return console.log(`[MultiChapter] Encontrado directo: "${e}" \u2192 "${y.substring(0,60)}..."`),{sentence:y,context:T}}}let o=oce(t);for(let f of o){let g=f.toLowerCase(),y=n.indexOf(g);if(y!==-1){let C=r.lastIndexOf(`
`,y)+1,A=r.indexOf(`
`,y),T=r.substring(C,A===-1?void 0:A).trim();if(T.length>=20){let E=Math.max(0,y-200),d=Math.min(r.length,y+f.length+200),l=r.substring(E,d);return console.log(`[MultiChapter] Encontrado frase "${f}" \u2192 "${T.substring(0,60)}..."`),{sentence:T,context:l}}}}let i=["de","del","la","el","los","las","en","con","una","un","se","que","por","para"],u=e.split(/\s+/).filter(f=>f.length>2&&!i.includes(f.toLowerCase())).map(f=>f.toLowerCase());if(u.length===0)return console.log("[MultiChapter] Sin keywords v\xE1lidas para buscar"),null;console.log(`[MultiChapter] Buscando keywords: ${u.join(", ")}`);let c=r.split(/(?<=[.!?])\s+/),p=null;for(let f of c){if(f.length<20)continue;let g=f.toLowerCase(),C=u.filter(A=>g.includes(A)).length/u.length;if(C>=.4&&(!p||C>p.score)){let A=r.indexOf(f),T=Math.max(0,A-200),E=Math.min(r.length,A+f.length+200),d=r.substring(T,E);p={sentence:f,context:d,score:C}}}if(p)return console.log(`[MultiChapter] Encontrado (score ${p.score.toFixed(2)}): "${p.sentence.substring(0,60)}..."`),{sentence:p.sentence,context:p.context};console.log("[MultiChapter] Intentando b\xFAsqueda con IA...");let m=await cce(r,e,t);return m||(console.log("[MultiChapter] No encontrado en cap\xEDtulo"),null)}async function cce(r,e,t){let n=process.env.GEMINI_API_KEY||process.env.AI_INTEGRATIONS_GEMINI_API_KEY;if(!n)return console.log("[MultiChapter AI] No hay API key de Gemini disponible"),null;let a=r.substring(0,12e3),s=`Analiza el siguiente texto de un cap\xEDtulo y encuentra una oraci\xF3n que coincida con el problema descrito.

PROBLEMA A BUSCAR:
${t}

CONCEPTO CLAVE:
"${e}"

TEXTO DEL CAP\xCDTULO:
${a}

INSTRUCCIONES:
1. Busca una oraci\xF3n que contenga el concepto descrito o algo muy similar
2. Si encuentras una coincidencia, devuelve EXACTAMENTE en este formato JSON:
{"found": true, "sentence": "la oraci\xF3n exacta del texto", "reason": "breve explicaci\xF3n"}
3. Si NO encuentras ninguna coincidencia, devuelve:
{"found": false}

Responde SOLO con el JSON, sin explicaciones adicionales.`;try{let{GoogleGenAI:o}=await import("@google/genai"),p=((await new o({apiKey:n}).models.generateContent({model:"gemini-2.0-flash",contents:s})).text?.trim()||"").match(/\{[\s\S]*\}/);if(p){let m=JSON.parse(p[0]);if(m.found&&m.sentence){let f=r.indexOf(m.sentence);if(f!==-1){let g=Math.max(0,f-200),y=Math.min(r.length,f+m.sentence.length+200),C=r.substring(g,y);return console.log(`[MultiChapter AI] Encontrado: "${m.sentence.substring(0,60)}..." - ${m.reason}`),{sentence:m.sentence,context:C}}else{let g=r.split(`
`);for(let y of g)if(y.toLowerCase().includes(m.sentence.toLowerCase().substring(0,30))){let C=r.indexOf(y),A=Math.max(0,C-200),T=Math.min(r.length,C+y.length+200),E=r.substring(A,T);return console.log(`[MultiChapter AI] Encontrado (fuzzy): "${y.substring(0,60)}..."`),{sentence:y.trim(),context:E}}}}}}catch(o){console.error("[MultiChapter AI] Error:",o)}return null}async function I4(r,e,t,n,a,s){let o=`Eres un editor literario experto. El autor usa descripciones muy similares a lo largo de la novela, causando monoton\xEDa.

PROBLEMA:
${n}

ORACI\xD3N A VARIAR (del ${a==="pr\xF3logo"?"Pr\xF3logo":"Cap\xEDtulo "+a}):
"${r}"

CONTEXTO:
${e}

INSTRUCCIONES:
1. Reescribe la oraci\xF3n manteniendo el MISMO significado pero con vocabulario y estructura DIFERENTE
2. Esta es la variaci\xF3n #${s+1}, debe ser \xDANICA respecto a otras variaciones
3. Mant\xE9n el tono y estilo del autor
4. NO cambies los hechos ni los personajes mencionados
5. Devuelve SOLO la oraci\xF3n reescrita, sin explicaciones
6. PROHIBIDO usar clich\xE9s de IA: "un escalofr\xEDo recorri\xF3", "el peso de", "no pudo evitar", "algo en su interior", "una oleada de", "la tensi\xF3n era palpable", "con determinaci\xF3n renovada"
7. S\xE9 M\xCDNIMO: var\xEDa solo lo necesario para eliminar la repetici\xF3n

ORACI\xD3N VARIADA:`;return(await Fx.chat.completions.create({model:"deepseek-chat",messages:[{role:"user",content:o}],temperature:.7+s*.1,max_tokens:500})).choices[0]?.message?.content?.trim()||r}function lce(r){let e=[],t=r.match(/['""']([^'""']+)['""']/g);if(t)for(let a of t){let s=a.replace(/['""']/g,"").trim();s.length>=5&&e.push(s)}let n=r.match(/(?:como|frases como|expresiones como|palabras como)\s+['""']?([^,.'""']+)['""']?/gi);if(n)for(let a of n){let s=a.replace(/^(?:como|frases como|expresiones como|palabras como)\s*/i,"").replace(/['""']/g,"").trim();s.length>=5&&!e.includes(s)&&e.push(s)}if(e.length===0){let a=[/(?:describe|menciona|repite|usa)\s+(?:como\s+)?["']?([^,."']+)["']?/gi,/(?:el|la|los|las)\s+["']?([^,."']{10,40})["']?\s+(?:se repite|aparece|es repetitiv)/gi,/(?:repeticin de|exceso de)\s+["']?([^,."']+)["']?/gi];for(let s of a){let o;for(;(o=s.exec(r))!==null;){let i=o[1].trim();i.length>=5&&i.length<=50&&!e.includes(i)&&e.push(i)}}}if(e.length===0){let a=r.match(/(?:dolor|anillo|cicatriz|marca|manchas?|ojos?|manos?|herida)[a-z\s]{0,20}/gi);if(a)for(let s of a.slice(0,3)){let o=s.trim();o.length>=5&&!e.includes(o)&&e.push(o)}}return e}function uce(r,e){let t=r.toLowerCase().replace(/[.,;:!?()'"]/g," ").split(/\s+/).filter(s=>s.length>=4).filter(s=>!["como","para","pero","este","esta","esto","esos","esas","forma","manera","novela","texto","cap\xEDtulo","cap\xEDtulos"].includes(s)),n=Array.from(new Set(t)),a=[];for(let s of n.slice(0,5)){let o=new RegExp(`[^.!?]*\\b${s}\\b[^.!?]*[.!?]`,"gi"),i=e.match(o);if(i&&i.length>=2){let u=i.reduce((c,p)=>c.length<=p.length?c:p).trim();u.length>=20&&u.length<=200&&!a.includes(u)&&a.push(u)}}return a.slice(0,10)}function pce(r,e){let t=[],n=/===\s*(?:CAPTULO|Captulo|Cap\.?)\s*(\d+)[^=]*===\s*([\s\S]*?)(?====|$)/gi,a=[],s;for(;(s=n.exec(r))!==null;)a.push({num:parseInt(s[1]),title:`Cap\xEDtulo ${s[1]}`,content:s[2],startPos:s.index});for(let o of e){let i=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),u=new RegExp(i.split(/\s+/).join("\\s+"),"gi");for(let c of a){let p;for(;(p=u.exec(c.content))!==null;){let m=Math.max(0,p.index-100),f=Math.min(c.content.length,p.index+p[0].length+100);t.push({text:p[0],chapterNumber:c.num,chapterTitle:c.title,context:"..."+c.content.substring(m,f).trim()+"...",position:c.startPos+p.index})}}}return t.sort((o,i)=>o.position-i.position)}async function x4(r,e,t){try{let n=`Eres un editor literario. Debes proponer UNA alternativa para la siguiente frase repetitiva, manteniendo el mismo significado pero con vocabulario diferente.

FRASE ORIGINAL: "${r}"

CONTEXTO: ${e}

PROBLEMA: ${t}

REGLAS:
1. Mant\xE9n el significado exacto
2. Usa vocabulario completamente diferente
3. Mant\xE9n el tono y registro del texto
4. Devuelve SOLO la frase alternativa, sin explicaciones ni comillas
5. PROHIBIDO usar clich\xE9s de IA: "un escalofr\xEDo recorri\xF3", "el peso de", "no pudo evitar", "algo en su interior", "una oleada de", "la tensi\xF3n era palpable", "intercambiaron una mirada", "con determinaci\xF3n renovada"
6. S\xE9 M\xCDNIMO: var\xEDa solo las palabras necesarias para eliminar la repetici\xF3n

FRASE ALTERNATIVA:`,a=await Fx.chat.completions.create({model:"deepseek-chat",messages:[{role:"system",content:"Eres un editor literario experto en variaci\xF3n de vocabulario. Devuelve solo la frase alternativa."},{role:"user",content:n}],temperature:.7,max_tokens:200});return O4(a.choices[0]?.message?.content||r)}catch(n){return console.error("Error generando alternativa:",n),r}}function qx(r,e){let t=e.toLowerCase();if(t.includes("pr\xF3logo")||t.includes("prologo"))return Is(r,"pr\xF3logo")?.content||null;if(t.includes("ep\xEDlogo")||t.includes("epilogo")){let a=/(?:^|\n)((?:EPLOGO|Eplogo|EPILOGO|Epilogo)[^\n]*\n)([\s\S]*?)(?=\n(?:Captulo|CAPTULO|CAP\.)\s*\d+|$)/i,s=r.match(a);return s?s[2].trim():null}let n=e.match(/Cap[i]tulo\s*(\d+)/i);if(n){let a=parseInt(n[1]);return Is(r,a)?.content||null}return null}function dce(r,e,t){let n=qx(r,e);if(!n)return null;let a=n.match(/[^.!?]+[.!?]+/g)||[];if(a.length===0)return null;let s=new Set(["como","para","pero","m\xE1s","entre","sobre","tiene","puede","desde","hasta","esta","este","estos","estas","tambi\xE9n","donde","cuando","porque","aunque","mientras","durante","seg\xFAn","dentro","fuera","antes","despu\xE9s","hacia","menos","mayor","menor","mejor","peor","cada","todo","toda","todos","todas","otro","otra","otros","otras","mismo","misma","those","these","which","where","about","after","being","could","would","should","their","there","these","through","before","between","under","above"]),o=t.toLowerCase().split(/\s+/).filter(m=>m.length>3&&!s.has(m));if(o.length===0)return null;let i=[],u=t.match(/["'""'']([^"'""'']+)["'""'']/g);if(u)for(let m of u){let f=m.replace(/["'""'']/g,"").trim();f.length>=5&&i.push(f.toLowerCase())}let c="",p=0;for(let m=0;m<a.length;m++){let g=a.slice(Math.max(0,m-1),m+2).join(" ").toLowerCase(),y=0;for(let A of i)g.includes(A)&&(y+=5);for(let A of o)g.includes(A)&&y++;let C=Math.max(2,Math.floor(o.length*.15));y>p&&y>=C&&(p=y,c=a[m].trim())}return c.length>20&&c.length<500?c:null}async function mce(r,e,t){if(!qm)return null;try{let n=vb.getGenerativeModel({model:"gemini-2.0-flash"}),a=`Eres un editor literario. Analiza el siguiente cap\xEDtulo y encuentra la frase o p\xE1rrafo EXACTO que presenta el problema descrito.

PROBLEMA:
${e}

CAP\xCDTULO (${t}):
---
${r.substring(0,15e3)}
---

INSTRUCCIONES:
1. Encuentra el fragmento de texto EXACTO (tal como aparece en el cap\xEDtulo) que contiene el problema descrito.
2. El fragmento debe ser una frase completa o un p\xE1rrafo corto (entre 30 y 300 caracteres).
3. Copia el texto EXACTAMENTE como aparece, sin modificarlo.
4. Si no encuentras el problema espec\xEDfico en este cap\xEDtulo, responde solo: NO_ENCONTRADO

Responde SOLO con el fragmento exacto del texto problem\xE1tico, sin explicaciones ni comillas adicionales.`,o=(await n.generateContent(a)).response.text().trim();if(o==="NO_ENCONTRADO"||o.length<15||o.length>500)return null;if(r.includes(o))return console.log(`[AI-Target] Encontrado exacto en ${t}: "${o.substring(0,60)}..."`),o;let i=o.replace(/\s+/g," ").trim(),u=r.replace(/\s+/g," ");if(u.includes(i)){let p=u.indexOf(i),m=0,f=0;for(let y=0;y<r.length&&m<p;y++)(!/\s/.test(r[y])||y>0&&!/\s/.test(r[y-1]))&&m++,f=y;let g=r.substring(f,f+o.length+50).trim();if(g.length>20)return console.log(`[AI-Target] Encontrado normalizado en ${t}: "${g.substring(0,60)}..."`),g}console.log(`[AI-Target] ${t}: IA devolvi\xF3 texto que no coincide exactamente. Intentando fuzzy match...`);let c=o.split(/\s+/).slice(0,5).join("\\s+");if(c.length>10){let p=new RegExp(c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\\s\+/g,"\\s+"),"i"),m=r.match(p);if(m){let f=m.index||0,g=Math.min(r.length,f+o.length+20),y=r.indexOf(".",f+20),C=y>f&&y<g+100?y+1:g,A=r.substring(f,C).trim();if(A.length>20&&A.length<500)return console.log(`[AI-Target] Encontrado por fuzzy en ${t}: "${A.substring(0,60)}..."`),A}}return null}catch(n){return console.error("[AI-Target] Error en findTargetWithAI:",n),null}}async function T4(r,e,t){if(!qm)return{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}};try{let n=qx(r,t);if(!n||n.length<50)return{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}};let a=vb.getGenerativeModel({model:"gemini-2.0-flash"}),s=`Eres un editor literario quir\xFArgico. Tu tarea es identificar y corregir UN problema espec\xEDfico en el siguiente texto de forma M\xCDNIMA.

PROBLEMA A CORREGIR:
${e.description}

SUGERENCIA DEL AUDITOR:
${e.suggestion||"Ninguna proporcionada"}

SEVERIDAD: ${e.severity}

TEXTO DEL CAP\xCDTULO (${t}):
---
${n.substring(0,12e3)}
---

INSTRUCCIONES CR\xCDTICAS:
1. Identifica el fragmento EXACTO (1-3 oraciones) que contiene el problema
2. Genera una versi\xF3n corregida de SOLO ese fragmento
3. El cambio debe ser M\xCDNIMO: cambia SOLO las palabras estrictamente necesarias
4. Mant\xE9n el estilo, tono y vocabulario del autor original
5. NO introduzcas clich\xE9s de IA, met\xE1foras nuevas ni embellecimientos
6. NO reescribas m\xE1s texto del necesario
7. Si el problema es sobre algo AUSENTE (falta una menci\xF3n, falta un detalle), identifica el punto exacto donde insertar y muestra las 1-2 oraciones circundantes con la inserci\xF3n incluida

Responde EXCLUSIVAMENTE en JSON v\xE1lido con este formato exacto (sin markdown, sin backticks):
{"original": "texto exacto copiado del cap\xEDtulo que contiene el problema", "corrected": "mismo texto con la correcci\xF3n m\xEDnima aplicada"}`,i=(await a.generateContent(s)).response.text().trim();i=i.replace(/^```json\s*/i,"").replace(/```\s*$/i,"").trim();let u;try{u=JSON.parse(i)}catch{let y=i.match(/\{[\s\S]*"original"[\s\S]*"corrected"[\s\S]*\}/);if(y)try{u=JSON.parse(y[0])}catch{return console.log("[SmartCorrection] No se pudo parsear JSON de respuesta"),{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}}}else return{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}}}if(!u.original||!u.corrected||u.original===u.corrected)return{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}};if(u.corrected.length>u.original.length*1.5||u.corrected.length<u.original.length*.4)return console.log(`[SmartCorrection] Rechazado por cambio excesivo: orig=${u.original.length}, corr=${u.corrected.length} (ratio=${(u.corrected.length/u.original.length).toFixed(2)})`),{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}};let c=new Set(u.original.toLowerCase().split(/\s+/).filter(y=>y.length>3)),p=new Set(u.corrected.toLowerCase().split(/\s+/).filter(y=>y.length>3)),m=0;for(let y of Array.from(c))p.has(y)&&m++;let f=c.size>0?m/c.size:1;if(f<.4)return console.log(`[SmartCorrection] Rechazado: reescritura excesiva (preservaci\xF3n=${(f*100).toFixed(0)}%)`),{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}};let g=u.original;if(!n.includes(u.original)){let y=u.original.replace(/\s+/g," ").trim();if(n.replace(/\s+/g," ").includes(y)){let A=n.split(/(?<=[.!?])\s+/);for(let T of A)if(T.replace(/\s+/g," ").trim().includes(y.substring(0,40))){g=T.trim();break}}else{let A=u.original.split(/\s+/).slice(0,6).join("\\s+");if(A.length>15)try{let T=new RegExp(A.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\\s\+/g,"\\s+"),"i"),E=n.match(T);if(E&&E.index!==void 0){let d=n.indexOf(".",E.index+20),l=d>E.index?d+1:E.index+u.original.length;g=n.substring(E.index,Math.min(l,E.index+u.original.length+50)).trim()}else return console.log("[SmartCorrection] No se verific\xF3 texto original en cap\xEDtulo"),{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}}}catch{return{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}}}else return{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}}}}return console.log(`[SmartCorrection] \xC9xito en ${t}: "${g.substring(0,50)}..." \u2192 "${u.corrected.substring(0,50)}..."`),{originalText:g,correctedText:u.corrected,success:!0,diffStats:zc(g,u.corrected)}}catch(n){return console.error("[SmartCorrection] Error:",n),{originalText:"",correctedText:"",success:!1,diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0}}}}async function hce(r,e,t){try{let[n]=await M.select().from(Xe).where(q(Xe.id,r));if(!n)return{success:!1,error:"Auditor\xEDa no encontrada"};if(!n.finalAudit)return{success:!1,error:"La auditor\xEDa no tiene reportes finales"};let a=n.finalAudit,s=[];for(let g of a.reports||[])for(let y of g.issues||[])s.push({...y,agentType:g.agentType});if(s.length===0)return{success:!1,error:"No hay issues para corregir"};let o={structural:0,estructural:0,critical:1,cr\u00EDtico:1,critico:1,grave:1,high:2,alto:2,alta:2,medium:3,medio:3,media:3,low:4,bajo:4,baja:4,minor:5,menor:5};s.sort((g,y)=>{let C=(g.severity||"").toLowerCase().trim(),A=(y.severity||"").toLowerCase().trim(),T=o[C]??3,E=o[A]??3;return T-E}),console.log(`[DeepSeek] Issues ordenados por severidad: ${s.map(g=>g.severity).join(", ")}`);let[i]=await M.insert(Be).values({auditId:r,projectId:n.projectId,status:"correcting",source:t?.source||"manual",originalContent:n.novelContent,totalIssues:s.length,pendingCorrections:[]}).returning();e?.({phase:"starting",current:0,total:s.length,message:"Iniciando correcci\xF3n quir\xFArgica..."});let u=[],c=n.novelContent,p=0,m=0,f=g=>{if(g.status==="pending"&&g.originalText&&g.correctedText&&g.originalText!==g.correctedText&&!g.originalText.startsWith("[")){let y=c.replace(g.originalText,g.correctedText);y!==c&&(c=y,console.log(`[Cumulative] Aplicado: "${g.originalText.substring(0,50)}..." \u2192 "${g.correctedText.substring(0,50)}..."`))}};for(let g=0;g<s.length;g++){let y=s[g];if(e?.({phase:"correcting",current:g+1,total:s.length,message:`Corrigiendo issue ${g+1}/${s.length} [${(y.severity||"medium").toUpperCase()}]: ${(y.description||"").substring(0,80)}`}),ece(y.description)){e?.({phase:"analyzing",current:g+1,total:s.length,message:"Detectado salto narrativo: generando transici\xF3n con IA..."});let l=y.location.match(/Cap[i]tulo\s*(\d+)/i),h=l?parseInt(l[1]):null,v=null;if(h&&(v=Is(c,h)),v){let S=await tce(v.content,y.description,`Cap\xEDtulo ${h}`);if(S.success){console.log(`[Transition] Generada transici\xF3n de ${S.transitionText.length} caracteres`);let R={id:`correction-${Date.now()}-${g}-transition`,issueId:`issue-${g}`,location:y.location,chapterNumber:h||0,originalText:S.originalText,correctedText:S.correctedText,instruction:`[TRANSICI\xD3N NARRATIVA] ${y.description.substring(0,100)}...`,severity:y.severity,status:"pending",diffStats:S.diffStats,createdAt:new Date().toISOString()};u.push(R),f(R),m++,p++,await new Promise(x=>setTimeout(x,500));continue}}}let C=dce(c,y.location,y.description);if(!C){let l=qx(c,y.location);l&&(console.log(`[DeepSeek] Keyword matching fall\xF3 para issue ${g+1}. Intentando con IA en "${y.location}"...`),e?.({phase:"analyzing",current:g+1,total:s.length,message:`Buscando texto problem\xE1tico con IA en ${y.location}...`}),C=await mce(l,y.description,y.location))}if(C){let l=await pi({fullChapter:c,targetText:C,instruction:y.description,suggestion:y.suggestion}),h={id:`correction-${Date.now()}-${g}`,issueId:`issue-${g}`,location:y.location,chapterNumber:parseInt(y.location.match(/\d+/)?.[0]||"0"),originalText:l.originalText,correctedText:l.correctedText,instruction:y.description,severity:y.severity,status:l.success?"pending":"rejected",diffStats:l.diffStats,createdAt:new Date().toISOString()};u.push(h),f(h),m++,l.success&&p++,await new Promise(v=>setTimeout(v,500));continue}if(rce(y.description,y.location)){e?.({phase:"analyzing",current:g+1,total:s.length,message:"Analizando problema gen\xE9rico: buscando frases repetitivas..."});let l=lce(y.description);if(l.length>0){let h=pce(c,l);e?.({phase:"correcting",current:g+1,total:s.length,message:`Encontradas ${h.length} ocurrencias. Generando alternativas...`});for(let v=0;v<h.length;v++){let S=h[v];e?.({phase:"correcting",current:g+1,total:s.length,message:`Generando alternativa ${v+1}/${h.length} para "${S.text.substring(0,30)}..."`});let R=await x4(S.text,S.context,y.description),x={id:`correction-${Date.now()}-${g}-${v}`,issueId:`issue-${g}`,location:S.chapterTitle,chapterNumber:S.chapterNumber,originalText:S.text,correctedText:R,instruction:`[REPETICI\xD3N] ${y.description}`,severity:y.severity,status:R!==S.text?"pending":"rejected",diffStats:zc(S.text,R),createdAt:new Date().toISOString()};u.push(x),f(x),R!==S.text&&p++,await new Promise(w=>setTimeout(w,300))}m+=h.length}else{e?.({phase:"analyzing",current:g+1,total:s.length,message:"Buscando patrones con n-gramas..."});let h=uce(y.description,c);if(h.length>0){e?.({phase:"correcting",current:g+1,total:s.length,message:`Encontradas ${h.length} frases con n-gramas. Generando alternativas...`});for(let v=0;v<h.length;v++){let S=h[v],R=await x4(S,S,y.description),x={id:`correction-${Date.now()}-${g}-ngram-${v}`,issueId:`issue-${g}`,location:"M\xFAltiples cap\xEDtulos",chapterNumber:0,originalText:S,correctedText:R,instruction:`[REPETICI\xD3N-NGRAMA] ${y.description}`,severity:y.severity,status:R!==S?"pending":"rejected",diffStats:zc(S,R),createdAt:new Date().toISOString()};u.push(x),f(x),R!==S&&p++,await new Promise(w=>setTimeout(w,300))}m+=h.length}else{console.log(`[DeepSeek] Issue gen\xE9rico ${g+1}: sin frases, intentando correcci\xF3n inteligente...`);let v=await T4(c,y,y.location);if(v.success){let S={id:`correction-${Date.now()}-${g}-smart-generic`,issueId:`issue-${g}`,location:y.location,chapterNumber:parseInt(y.location.match(/\d+/)?.[0]||"0"),originalText:v.originalText,correctedText:v.correctedText,instruction:`[CORRECCI\xD3N-INTELIGENTE-GEN\xC9RICA] ${y.description}`,severity:y.severity,status:"pending",diffStats:v.diffStats,createdAt:new Date().toISOString()};u.push(S),f(S),m++,p++}else u.push({id:`correction-${Date.now()}-${g}`,issueId:`issue-${g}`,location:y.location,chapterNumber:0,originalText:"[Problema gen\xE9rico sin frases identificables]",correctedText:"",instruction:y.description,severity:y.severity,status:"rejected",diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},createdAt:new Date().toISOString()}),m++}}continue}let A=Xie(y.description);if(A){if(y.location?.toLowerCase().includes("vs pr\xF3logo")||y.location?.toLowerCase().includes("vs prologo")||y.location?.toLowerCase().includes("bible")&&y.location?.toLowerCase().includes("pr\xF3logo")){console.log("[CharacterBible] Detectado caso vs Pr\xF3logo"),e?.({phase:"analyzing",current:g+1,total:s.length,message:`Character Bible vs Pr\xF3logo: buscando "${A.incorrectValue}" en Pr\xF3logo...`});let w=Is(c,"pr\xF3logo");if(w){let O=await Fm(w.content,A.characterName,A.attribute,A.correctValue,A.incorrectValue,"Pr\xF3logo");if(O){console.log(`[CharacterBible AI] Pr\xF3logo: encontrado "${O.sentence.substring(0,50)}..." (valor: ${O.incorrectValue})`);let I=await pi({fullChapter:w.content,targetText:O.sentence,instruction:`El personaje ${A.characterName} tiene ${A.attribute} como "${A.correctValue}" seg\xFAn la biblia de personajes. Cambiar "${O.incorrectValue}" a "${A.correctValue}".`,suggestion:`Reemplazar con: "${A.correctValue}"`}),_={id:`correction-${Date.now()}-${g}-prologue`,issueId:`issue-${g}`,location:"Pr\xF3logo",chapterNumber:0,originalText:I.originalText,correctedText:I.correctedText,instruction:`[CHARACTER-BIBLE AI] ${A.attribute}: "${O.incorrectValue}" \u2192 "${A.correctValue}"`,severity:y.severity,status:I.success?"pending":"rejected",diffStats:I.diffStats,createdAt:new Date().toISOString()};u.push(_),f(_),m++,I.success&&p++}}continue}if(y.location?.toLowerCase().includes("vs cap\xEDtulos")||y.location?.toLowerCase().includes("m\xFAltiples")||y.description.toLowerCase().includes("vs m\xFAltiples")||(y.location?.match(/\d+/g)?.length||0)>2){console.log("[CharacterBible Multi] Detectado caso multi-cap\xEDtulo"),console.log(`[CharacterBible Multi] Location: "${y.location}"`),console.log(`[CharacterBible Multi] Description: "${y.description.substring(0,200)}..."`);let w=w4(y.location||"");w.length===0&&(w=Hie(y.description)),w.length===0&&(w=w4(y.description));let O=y.location?.toLowerCase().includes("ep\xEDlogo")||y.location?.toLowerCase().includes("epilogo")||y.description.toLowerCase().includes("ep\xEDlogo"),I=y.location?.toLowerCase().includes("pr\xF3logo")||y.description.toLowerCase().includes("pr\xF3logo");console.log(`[CharacterBible Multi] Cap\xEDtulos extra\xEDdos: [${w.join(", ")}], Pr\xF3logo: ${I}, Ep\xEDlogo: ${O}`);let _=w.length+(I?1:0)+(O?1:0);if(e?.({phase:"analyzing",current:g+1,total:s.length,message:`Character Bible multi-cap\xEDtulo: buscando en ${_} partes (${I?"Pr\xF3logo, ":""}${w.length} cap\xEDtulos${O?", Ep\xEDlogo":""})...`}),I){let N=Is(c,"pr\xF3logo");if(N){e?.({phase:"analyzing",current:g+1,total:s.length,message:`IA buscando "${A.attribute}" de ${A.characterName} en Pr\xF3logo...`});let P=await Fm(N.content,A.characterName,A.attribute,A.correctValue,A.incorrectValue,"Pr\xF3logo");if(P){console.log(`[CharacterBible AI Multi] Pr\xF3logo: encontrado "${P.sentence.substring(0,50)}..." (valor: ${P.incorrectValue})`);let L=await pi({fullChapter:N.content,targetText:P.sentence,instruction:`El personaje ${A.characterName} tiene ${A.attribute} como "${A.correctValue}" seg\xFAn la biblia de personajes. Cambiar "${P.incorrectValue}" a "${A.correctValue}".`,suggestion:`Reemplazar con: "${A.correctValue}"`}),j={id:`correction-${Date.now()}-${g}-prologue-multi`,issueId:`issue-${g}`,location:"Pr\xF3logo",chapterNumber:0,originalText:L.originalText,correctedText:L.correctedText,instruction:`[CHARACTER-BIBLE AI] ${A.attribute}: "${P.incorrectValue}" \u2192 "${A.correctValue}"`,severity:y.severity,status:L.success?"pending":"rejected",diffStats:L.diffStats,createdAt:new Date().toISOString()};u.push(j),f(j),m++,L.success&&p++,await new Promise($=>setTimeout($,500))}else console.log("[CharacterBible AI Multi] Pr\xF3logo: No se encontr\xF3 inconsistencia")}}for(let N of w){let P=`Cap\xEDtulo ${N}`,L=Is(c,N);if(L){e?.({phase:"analyzing",current:g+1,total:s.length,message:`IA buscando "${A.attribute}" de ${A.characterName} en ${P}...`});let j=await Fm(L.content,A.characterName,A.attribute,A.correctValue,A.incorrectValue,P);if(j){console.log(`[CharacterBible AI Multi] ${P}: encontrado "${j.sentence.substring(0,50)}..." (valor: ${j.incorrectValue})`);let $=await pi({fullChapter:L.content,targetText:j.sentence,instruction:`El personaje ${A.characterName} tiene ${A.attribute} como "${A.correctValue}" seg\xFAn la biblia de personajes. Cambiar "${j.incorrectValue}" a "${A.correctValue}".`,suggestion:`Reemplazar con: "${A.correctValue}"`}),U={id:`correction-${Date.now()}-${g}-ch${N}`,issueId:`issue-${g}`,location:P,chapterNumber:N,originalText:$.originalText,correctedText:$.correctedText,instruction:`[CHARACTER-BIBLE AI] ${A.attribute}: "${j.incorrectValue}" \u2192 "${A.correctValue}"`,severity:y.severity,status:$.success?"pending":"rejected",diffStats:$.diffStats,createdAt:new Date().toISOString()};u.push(U),f(U),m++,$.success&&p++,await new Promise(k=>setTimeout(k,500))}else console.log(`[CharacterBible AI Multi] ${P}: No se encontr\xF3 inconsistencia`)}}if(O){let N=Wie(c);if(N){e?.({phase:"analyzing",current:g+1,total:s.length,message:`IA buscando "${A.attribute}" de ${A.characterName} en Ep\xEDlogo...`});let P=await Fm(N.content,A.characterName,A.attribute,A.correctValue,A.incorrectValue,"Ep\xEDlogo");if(P){console.log(`[CharacterBible AI] Ep\xEDlogo: encontrado "${P.sentence.substring(0,50)}..." (valor: ${P.incorrectValue})`);let L=await pi({fullChapter:N.content,targetText:P.sentence,instruction:`El personaje ${A.characterName} tiene ${A.attribute} como "${A.correctValue}" seg\xFAn la biblia de personajes. Cambiar "${P.incorrectValue}" a "${A.correctValue}".`,suggestion:`Reemplazar con: "${A.correctValue}"`}),j={id:`correction-${Date.now()}-${g}-epilogue`,issueId:`issue-${g}`,location:"Ep\xEDlogo",chapterNumber:999,originalText:L.originalText,correctedText:L.correctedText,instruction:`[CHARACTER-BIBLE AI] ${A.attribute}: "${P.incorrectValue}" \u2192 "${A.correctValue}"`,severity:y.severity,status:L.success?"pending":"rejected",diffStats:L.diffStats,createdAt:new Date().toISOString()};u.push(j),f(j),m++,L.success&&p++}}}continue}e?.({phase:"analyzing",current:g+1,total:s.length,message:`Detectado issue de Character Bible: buscando "${A.incorrectValue}" en ${A.chapterName}...`});let v=Yie(c,A.incorrectValue,A.chapterName);if(v){let w=await pi({fullChapter:v.chapterContent,targetText:v.foundText,instruction:`El personaje ${A.characterName} tiene ${A.attribute} como "${A.correctValue}" seg\xFAn la biblia de personajes. Corregir "${A.incorrectValue}" a "${A.correctValue}".`,suggestion:`Cambiar la descripci\xF3n para que coincida con la biblia: "${A.correctValue}"`}),O={id:`correction-${Date.now()}-${g}-charfix`,issueId:`issue-${g}`,location:A.chapterName,chapterNumber:parseInt(A.chapterName.match(/\d+/)?.[0]||"0"),originalText:w.originalText,correctedText:w.correctedText,instruction:`[CHARACTER-BIBLE] ${y.description}`,severity:y.severity,status:w.success?"pending":"rejected",diffStats:w.diffStats,createdAt:new Date().toISOString()};u.push(O),f(O),m++,w.success&&p++;continue}console.log(`[CharacterBible] Regex no encontr\xF3, intentando b\xFAsqueda con IA en ${A.chapterName}...`);let S=A.chapterName.match(/\d+/)?.[0],R=A.chapterName.toLowerCase().includes("pr\xF3logo")||A.chapterName.toLowerCase().includes("prologo"),x=null;if(R?x=Is(c,"pr\xF3logo"):S&&(x=Is(c,parseInt(S))),x){e?.({phase:"analyzing",current:g+1,total:s.length,message:`IA buscando "${A.attribute}" de ${A.characterName} en ${A.chapterName}...`});let w=await Fm(x.content,A.characterName,A.attribute,A.correctValue,A.incorrectValue,A.chapterName);if(w){console.log(`[CharacterBible AI Single] ${A.chapterName}: encontrado "${w.sentence.substring(0,50)}..." (valor: ${w.incorrectValue})`);let O=await pi({fullChapter:x.content,targetText:w.sentence,instruction:`El personaje ${A.characterName} tiene ${A.attribute} como "${A.correctValue}" seg\xFAn la biblia de personajes. Corregir "${w.incorrectValue}" a "${A.correctValue}".`,suggestion:`Cambiar la descripci\xF3n para que coincida con la biblia: "${A.correctValue}"`}),I={id:`correction-${Date.now()}-${g}-charfix-ai`,issueId:`issue-${g}`,location:A.chapterName,chapterNumber:parseInt(S||"0"),originalText:O.originalText,correctedText:O.correctedText,instruction:`[CHARACTER-BIBLE AI] ${A.attribute}: "${w.incorrectValue}" \u2192 "${A.correctValue}"`,severity:y.severity,status:O.success?"pending":"rejected",diffStats:O.diffStats,createdAt:new Date().toISOString()};u.push(I),f(I),m++,O.success&&p++;continue}}}let T=y.ocurrencias;if(T&&T.length>0){console.log(`[DeepSeek] Issue tiene ${T.length} ocurrencias pre-identificadas`),e?.({phase:"analyzing",current:g+1,total:s.length,message:`Procesando ${T.length} ocurrencias identificadas por la auditor\xEDa...`});let l=0;for(let h=0;h<T.length;h++){let v=T[h],S=v.capitulo===0?"pr\xF3logo":v.capitulo,R=Is(c,S);if(R&&v.frase_exacta){console.log(`[DeepSeek Ocurrencia] Cap ${v.capitulo}: buscando "${v.frase_exacta.substring(0,50)}..."`);let x=R.content.indexOf(v.frase_exacta),w=v.frase_exacta,O="";if(x!==-1){let N=Math.max(0,x-200),P=Math.min(R.content.length,x+v.frase_exacta.length+200);O=R.content.substring(N,P)}else{let N=R.content.split(`
`);for(let P of N)if(P.toLowerCase().includes(v.frase_exacta.toLowerCase().substring(0,30))){w=P.trim();let L=R.content.indexOf(P);O=R.content.substring(Math.max(0,L-200),Math.min(R.content.length,L+P.length+200));break}}e?.({phase:"correcting",current:g+1,total:s.length,message:`Corrigiendo ocurrencia ${h+1}/${T.length} en ${v.capitulo===0?"Pr\xF3logo":"Cap. "+v.capitulo}...`});let I=await I4(w,O,v.frase_exacta,y.description,S,h),_={id:`correction-${Date.now()}-${g}-occ-${h}`,issueId:`issue-${g}`,location:v.capitulo===0?"Pr\xF3logo":`Cap\xEDtulo ${v.capitulo}`,chapterNumber:v.capitulo,originalText:w,correctedText:I,instruction:`[OCURRENCIA-AUDITOR\xCDA] ${y.description}`,severity:y.severity,status:I!==w?"pending":"rejected",diffStats:zc(w,I),createdAt:new Date().toISOString()};u.push(_),f(_),I!==w&&(p++,l++),await new Promise(N=>setTimeout(N,400))}}if(m+=Math.max(l,1),l>0)continue}console.log(`[DeepSeek] Checking multi-chapter for location: "${y.location.substring(0,80)}..."`);let E=nce(y.location);if(console.log(`[DeepSeek] hasExplicitChapterList: ${E}`),E){let l=ace(y.location),h=sce(y.description);if(console.log(`[DeepSeek] MultiChapter - chapters: ${l.length}, concept: ${h?"found":"null"}`),l.length>0&&h){e?.({phase:"analyzing",current:g+1,total:s.length,message:`M\xFAltiples cap\xEDtulos (${l.length}): buscando "${h.substring(0,40)}..." en cada uno...`});let v=0;for(let S=0;S<l.length;S++){let R=l[S],x=Is(c,R);if(x){let w=await ice(x.content,h,y.description);if(w){e?.({phase:"correcting",current:g+1,total:s.length,message:`Generando variaci\xF3n ${S+1}/${l.length} para ${R==="pr\xF3logo"?"Pr\xF3logo":"Cap. "+R}...`});let O=await I4(w.sentence,w.context,h,y.description,R,S),I=R==="pr\xF3logo"?0:R,_={id:`correction-${Date.now()}-${g}-multi-${S}`,issueId:`issue-${g}`,location:R==="pr\xF3logo"?"Pr\xF3logo":`Cap\xEDtulo ${R}`,chapterNumber:I,originalText:w.sentence,correctedText:O,instruction:`[VARIACI\xD3N-M\xDALTIPLE] ${y.description}`,severity:y.severity,status:O!==w.sentence?"pending":"rejected",diffStats:zc(w.sentence,O),createdAt:new Date().toISOString()};u.push(_),f(_),O!==w.sentence&&(p++,v++),await new Promise(N=>setTimeout(N,400))}}}if(m+=Math.max(v,1),v>0)continue}}console.log(`[DeepSeek] Issue ${g+1}: m\xE9todos est\xE1ndar fallaron. Intentando correcci\xF3n inteligente por cap\xEDtulo con IA...`),e?.({phase:"correcting",current:g+1,total:s.length,message:`IA analizando cap\xEDtulo completo para corregir issue ${g+1}...`});let d=await T4(c,y,y.location);if(d.success){console.log(`[SmartCorrection] Issue ${g+1} CORREGIDO por IA: "${d.originalText.substring(0,60)}..."`);let l={id:`correction-${Date.now()}-${g}-smart`,issueId:`issue-${g}`,location:y.location,chapterNumber:parseInt(y.location.match(/\d+/)?.[0]||"0"),originalText:d.originalText,correctedText:d.correctedText,instruction:`[CORRECCI\xD3N-INTELIGENTE] ${y.description}`,severity:y.severity,status:"pending",diffStats:d.diffStats,createdAt:new Date().toISOString()};u.push(l),f(l),m++,p++}else console.log(`[DeepSeek] Issue ${g+1} NO CORREGIDO tras todos los intentos. Location: "${y.location}", Severity: ${y.severity}`),u.push({id:`correction-${Date.now()}-${g}`,issueId:`issue-${g}`,location:y.location,chapterNumber:parseInt(y.location.match(/\d+/)?.[0]||"0"),originalText:"[No se pudo localizar el texto exacto]",correctedText:"",instruction:`[NO LOCALIZABLE] ${y.description}`,severity:y.severity,status:"rejected",diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},createdAt:new Date().toISOString()}),m++}return await M.update(Be).set({status:"review",correctedContent:c,pendingCorrections:u,totalIssues:m,correctedIssues:p}).where(q(Be.id,i.id)),e?.({phase:"completed",current:s.length,total:s.length,message:`Correcci\xF3n completada. ${p}/${m} correcciones generadas (de ${s.length} issues). Esperando revisi\xF3n.`}),{success:!0,manuscriptId:i.id}}catch(n){return console.error("Error en proceso de correcci\xF3n:",n),{success:!1,error:n instanceof Error?n.message:"Error desconocido"}}}async function fce(r,e){try{let[t]=await M.select().from(Be).where(q(Be.id,r));if(!t)return!1;let n=t.pendingCorrections||[],a=n.find(i=>i.id===e);if(!a)return!1;let s=t.correctedContent||t.originalContent;if(!["[No se pudo localizar el texto exacto]","[Problema gen\xE9rico sin frases identificables]","[Edita manualmente el texto original aqu\xED]"].includes(a.originalText)){let i=s;if(s=s.replace(a.originalText,a.correctedText),s===i)return console.log(`[ApproveCorrection] WARNING: Replacement had no effect for correction ${e}. Original text not found in content. Marking as skipped.`),a.status="rejected",a.reviewedAt=new Date().toISOString(),await M.update(Be).set({pendingCorrections:n}).where(q(Be.id,r)),!1}return a.status="approved",a.reviewedAt=new Date().toISOString(),await M.update(Be).set({pendingCorrections:n,correctedContent:s,approvedIssues:(t.approvedIssues||0)+1}).where(q(Be.id,r)),!0}catch(t){return console.error("Error aprobando correcci\xF3n:",t),!1}}async function gce(r,e){try{let[t]=await M.select().from(Be).where(q(Be.id,r));if(!t)return!1;let n=t.pendingCorrections||[],a=n.find(s=>s.id===e);return a?(a.status="rejected",a.reviewedAt=new Date().toISOString(),await M.update(Be).set({pendingCorrections:n,rejectedIssues:(t.rejectedIssues||0)+1}).where(q(Be.id,r)),!0):!1}catch(t){return console.error("Error rechazando correcci\xF3n:",t),!1}}async function yce(r){try{let[e]=await M.select().from(Be).where(q(Be.id,r));return e?(await M.update(Be).set({status:"approved",completedAt:new Date}).where(q(Be.id,r)),!0):!1}catch(e){return console.error("Error finalizando manuscrito:",e),!1}}var Fx,qm,vb,zie,ho=G(()=>{"use strict";As();xy();Mo();ms();Da();bb();Fx=new Ve({baseURL:"https://api.deepseek.com",apiKey:process.env.DEEPSEEK_API_KEY}),qm=process.env.GEMINI_API_KEY||"",vb=new ni(qm),zie=`Eres un Editor Literario T\xE9cnico ("Cirujano de Texto") especializado en correcci\xF3n invisible y M\xCDNIMA.
Tu objetivo es solucionar EXACTAMENTE el problema indicado sin alterar NADA m\xE1s.
NO eres un co-autor creativo. NO mejores el estilo. NO resumas. NO embellezas.
Tu \xFAnica m\xE9trica de \xE9xito es que el lector no note que el texto ha sido editado.

REGLAS ABSOLUTAS:
1. Mant\xE9n el tono, vocabulario y ritmo del autor EXACTAMENTE como est\xE1.
2. NO a\xF1adas informaci\xF3n nueva que no sea estrictamente necesaria para la correcci\xF3n.
3. Devuelve SOLO el texto corregido, sin explicaciones, sin markdown, sin comillas.
4. PROHIBIDO usar clich\xE9s de IA: "un escalofr\xEDo recorri\xF3", "el peso de", "no pudo evitar", "algo en su interior", "una oleada de", "el mundo se detuvo", "como si el universo", "sin poder evitarlo", "un nudo en", "la tensi\xF3n era palpable", "intercambiaron una mirada", "con determinaci\xF3n renovada", "el silencio se hizo ensordecedor", "no era solo", "m\xE1s que", "era como si", "sinti\xF3 que", "una sensaci\xF3n de".
5. NO embellezas ni a\xF1adas met\xE1foras. S\xE9 M\xCDNIMO: cambia SOLO las palabras estrictamente necesarias.
6. Si la correcci\xF3n requiere cambiar UNA palabra, cambia UNA palabra. No reescribas la oraci\xF3n entera.
7. PRINCIPIO DE NO-DA\xD1O: tu correcci\xF3n NO debe introducir nuevos problemas. No cambies nombres de personajes, no alteres hechos establecidos, no modifiques descripciones que ya eran correctas, no a\xF1adas frases que no exist\xEDan.
8. Preserva TODA la informaci\xF3n factual del texto original: nombres, lugares, fechas, descripciones f\xEDsicas, relaciones entre personajes.
9. El texto corregido debe tener una LONGITUD SIMILAR al original (\xB115%). No expandas ni recortes significativamente.`});var Cb={};wr(Cb,{cancelAutoCorrectionRun:()=>vce,cleanupZombieRuns:()=>Gx,getAutoCorrectionRun:()=>Pce,getAutoCorrectionRunsByProject:()=>$ce,isRunActive:()=>Ece,retryAutoCorrectionRun:()=>bce,startAutoCorrectionRun:()=>N4});async function Gx(){let r=["pending","auditing","correcting","approving","finalizing","re_auditing"],e=await M.select().from(bt),t=0,n=Date.now(),a=6e4;for(let s of e)if(r.includes(s.status)&&!Hu.has(s.id)){let o=new Date(s.createdAt).getTime();if(n-o<a){console.log(`[AutoCorrector] Run #${s.id} is recent (${Math.round((n-o)/1e3)}s old), skipping cleanup`);continue}console.log(`[AutoCorrector] Zombie run #${s.id} detected (status: ${s.status}). Marking as failed.`);let i=s.progressLog||[];i.push({timestamp:new Date().toISOString(),phase:"error",message:'Run interrumpido por reinicio del servidor. Usa "Reintentar" para volver a ejecutar.'}),await M.update(bt).set({status:"failed",errorMessage:"Interrumpido por reinicio del servidor",progressLog:i}).where(q(bt.id,s.id)),t++}return t>0&&console.log(`[AutoCorrector] Cleaned up ${t} zombie run(s)`),t}async function bce(r,e){let[t]=await M.select().from(bt).where(q(bt.id,r));return t?["failed","cancelled"].includes(t.status)?N4(t.projectId,{maxCycles:t.maxCycles||3,targetScore:t.targetScore||85,maxCriticalIssues:t.maxCriticalIssues||0},e):{success:!1,error:"Solo se pueden reintentar runs fallidos o cancelados"}:{success:!1,error:"Run no encontrado"}}async function vce(r){let e=Hu.get(r);return e&&(e.cancelled=!0),await M.update(bt).set({status:"cancelled"}).where(q(bt.id,r)),!0}async function Gm(r,e){if(e.cancelled)return!0;let[t]=await M.select().from(bt).where(q(bt.id,r));return t&&t.status==="cancelled"?(e.cancelled=!0,!0):!1}function Ece(r){return Hu.has(r)}async function _n(r,e,t,n){let[a]=await M.select().from(bt).where(q(bt.id,r));if(!a)return;let s=a.progressLog||[];s.push({timestamp:new Date().toISOString(),phase:e,message:t,details:n}),s.length>200&&s.splice(0,s.length-200),await M.update(bt).set({progressLog:s}).where(q(bt.id,r))}async function sa(r,e,t){await M.update(bt).set({status:e,...t}).where(q(bt.id,r))}async function N4(r,e={},t){try{let n=await b.getProject(r);if(!n)return{success:!1,error:"Proyecto no encontrado"};let a=await b.getChaptersByProject(r);if(!a||a.length===0)return{success:!1,error:"El proyecto no tiene cap\xEDtulos"};let s=["pending","auditing","correcting","approving","finalizing","re_auditing"];if((await M.select().from(bt).where(q(bt.projectId,r))).some(p=>s.includes(p.status)))return{success:!1,error:"Ya hay una auto-correcci\xF3n activa para este proyecto"};let[u]=await M.insert(bt).values({projectId:r,status:"pending",currentCycle:1,maxCycles:e.maxCycles||3,targetScore:e.targetScore||85,maxCriticalIssues:e.maxCriticalIssues||0,cycleHistory:[],progressLog:[],totalIssuesFixed:0,totalStructuralChanges:0}).returning(),c={cancelled:!1};return Hu.set(u.id,c),console.log(`[AutoCorrector] Starting run #${u.id} for project ${r} (${n.title})`),Cce(u.id,r,c,t).catch(async p=>{console.error(`[AutoCorrector] Fatal error in run ${u.id}:`,p),await sa(u.id,"failed",{errorMessage:String(p)}),Hu.delete(u.id)}),{success:!0,runId:u.id}}catch(n){return console.error("[AutoCorrector] Error starting run:",n),{success:!1,error:String(n)}}}async function Cce(r,e,t,n){try{console.log(`[AutoCorrector] executeAutoCorrectionLoop started for run #${r}, project ${e}`);let[a]=await M.select().from(bt).where(q(bt.id,r));if(!a)throw new Error("Run not found");let s=a.maxCycles||3,o=a.targetScore||85,i=a.maxCriticalIssues||0,u=0,c=0,p=0,m=0,f=null,g=null;for(let y=1;y<=s;y++){if(await Gm(r,t)){await _n(r,"cancelled",`Ciclo ${y}: Cancelado por el usuario`),await sa(r,"cancelled"),n?.({phase:"cancelled",message:"Auto-correcci\xF3n cancelada"});break}let C=new Date().toISOString();await sa(r,"auditing",{currentCycle:y}),n?.({phase:"auditing",message:`Ciclo ${y}/${s}: Iniciando auditor\xEDa con Gemini...`,cycle:y,maxCycles:s}),await _n(r,"auditing",`Ciclo ${y}: Iniciando auditor\xEDa`),console.log(`[AutoCorrector] Run #${r} Cycle ${y}: Building novel content...`);let A=await Rce(e);console.log(`[AutoCorrector] Run #${r} Cycle ${y}: Novel content built (${A.length} chars)`);let T=await wce(e);console.log(`[AutoCorrector] Run #${r} Cycle ${y}: Bible content built (${T?.length||0} chars). Starting audit...`);let E=await Ice(r,e,A,T,y,n);if(console.log(`[AutoCorrector] Run #${r} Cycle ${y}: Audit result:`,JSON.stringify({success:E.success,score:E.overallScore,critical:E.criticalIssues,total:E.totalIssues,error:E.error})),await Gm(r,t)){await Eb(r,y,C,E),n?.({phase:"cancelled",message:"Auto-correcci\xF3n cancelada"});break}if(!E.success||!E.auditId){await _n(r,"error",`Ciclo ${y}: Error en auditor\xEDa: ${E.error}`);let _={cycle:y,auditId:E.auditId||0,overallScore:0,criticalIssues:0,totalIssues:0,issuesFixed:0,structuralChanges:0,startedAt:C,completedAt:new Date().toISOString(),result:"error"};await Hc(r,_),await sa(r,"failed",{errorMessage:E.error}),n?.({phase:"error",message:`Error en auditor\xEDa: ${E.error}`});break}let{overallScore:d,criticalIssues:l,totalIssues:h,auditId:v}=E;if(d>m&&(m=d,f=v),n?.({phase:"audit_complete",message:`Ciclo ${y}: Auditor\xEDa completada. Score: ${d}, Issues cr\xEDticos: ${l}, Total: ${h}`,cycle:y,maxCycles:s,score:d,criticalIssues:l}),await _n(r,"audit_complete",`Ciclo ${y}: Score=${d}, Cr\xEDticos=${l}, Total=${h}${p>0?` (anterior: ${p})`:""}`),d>=o&&l<=i){let _={cycle:y,auditId:v,overallScore:d,criticalIssues:l,totalIssues:h,issuesFixed:0,structuralChanges:0,startedAt:C,completedAt:new Date().toISOString(),result:"threshold_met"};await Hc(r,_),await sa(r,"completed",{finalScore:d,finalCriticalIssues:l,totalIssuesFixed:u,totalStructuralChanges:c,completedAt:new Date,currentAuditId:v}),await _n(r,"completed",`Umbral de calidad alcanzado en ciclo ${y}. Score: ${d} \u2265 ${o}`),n?.({phase:"completed",message:`Auto-correcci\xF3n completada. Score final: ${d}`,score:d,criticalIssues:l});break}if(h===0){let _={cycle:y,auditId:v,overallScore:d,criticalIssues:l,totalIssues:0,issuesFixed:0,structuralChanges:0,startedAt:C,completedAt:new Date().toISOString(),result:"no_issues"};await Hc(r,_),await sa(r,"completed",{finalScore:d,finalCriticalIssues:l,completedAt:new Date,currentAuditId:v}),await _n(r,"completed",`Sin issues detectados en ciclo ${y}`),n?.({phase:"completed",message:`Sin issues. Score: ${d}`});break}if(await Gm(r,t)){await Eb(r,y,C,E);break}await sa(r,"correcting",{currentAuditId:v}),n?.({phase:"correcting",message:`Ciclo ${y}: Corrigiendo ${h} issues con DeepSeek...`,cycle:y,maxCycles:s}),await _n(r,"correcting",`Ciclo ${y}: Iniciando correcci\xF3n de ${h} issues`);let S=await xce(r,v,y,n);if(await Gm(r,t)){await Eb(r,y,C,E);break}if(!S.success||!S.manuscriptId){await _n(r,"error",`Ciclo ${y}: Error en correcci\xF3n: ${S.error}`);let _={cycle:y,auditId:v,overallScore:d,criticalIssues:l,totalIssues:h,issuesFixed:0,structuralChanges:0,startedAt:C,completedAt:new Date().toISOString(),result:"error"};await Hc(r,_),await sa(r,"failed",{errorMessage:S.error}),n?.({phase:"error",message:`Error en correcci\xF3n: ${S.error}`});break}let R=S.manuscriptId,x=0;if(y===1&&(x=await Tce(R,v,A,n),c+=x),await Gm(r,t)){await Eb(r,y,C,E);break}await sa(r,"approving",{currentManuscriptId:R}),n?.({phase:"approving",message:`Ciclo ${y}: Auto-aprobando correcciones...`,cycle:y,maxCycles:s}),await _n(r,"approving",`Ciclo ${y}: Auto-aprobando correcciones`);let w=await Nce(R);await _n(r,"approved",`Ciclo ${y}: ${w} correcciones aplicadas de ${h} issues detectados`),console.log(`[AutoCorrector] Run #${r} Cycle ${y}: ${w}/${h} corrections applied`),await sa(r,"finalizing"),n?.({phase:"finalizing",message:`Ciclo ${y}: Finalizando manuscrito corregido...`,cycle:y,maxCycles:s});let{finalizeManuscript:O}=await Promise.resolve().then(()=>(ho(),mo));if(await O(R),await _ce(e,R),u+=w,d>=m&&(m=d,f=v,g=await Ace(e),console.log(`[AutoCorrector] Nuevo mejor score: ${m} en ciclo ${y}. Snapshot capturado.`)),y>1&&p>0&&d<p-2){let _=d-p;console.log(`[AutoCorrector] SCORE DROP: ${p} \u2192 ${d} (delta: ${_})`),await _n(r,"score_drop",`Ciclo ${y}: Score baj\xF3 de ${p} a ${d}. Revirtiendo al mejor estado (score ${m}).`),n?.({phase:"reverting",message:`Score baj\xF3 (${p}\u2192${d}). Revirtiendo al mejor estado (score ${m})...`,cycle:y,score:d}),g&&(await Sce(e,g),console.log(`[AutoCorrector] Restaurado al mejor snapshot (score ${m})`));let N={cycle:y,auditId:v,manuscriptId:R,overallScore:d,criticalIssues:l,totalIssues:h,issuesFixed:w,structuralChanges:x,startedAt:C,completedAt:new Date().toISOString(),result:"score_drop_reverted"};await Hc(r,N),await sa(r,"completed",{finalScore:m,finalCriticalIssues:l,totalIssuesFixed:u,totalStructuralChanges:c,completedAt:new Date,currentAuditId:f}),await _n(r,"completed",`Detenido: las correcciones empeoraron el score. Mejor score: ${m}.`),n?.({phase:"completed",message:`Auto-correcci\xF3n detenida. Restaurado al mejor estado (score ${m}).`,score:m});break}p=d;let I={cycle:y,auditId:v,manuscriptId:R,overallScore:d,criticalIssues:l,totalIssues:h,issuesFixed:w,structuralChanges:x,startedAt:C,completedAt:new Date().toISOString(),result:y===s?"max_cycles":"corrected"};if(await Hc(r,I),await _n(r,"cycle_complete",`Ciclo ${y}: ${w} correcciones, ${x} estructurales. Score: ${d}`),n?.({phase:"cycle_complete",message:`Ciclo ${y} completado. ${w} correcciones, ${x} estructurales. Score: ${d}`,cycle:y,maxCycles:s,details:{approvedCount:w,structuralCount:x}}),y===s){let _=m>0?m:d;await sa(r,"completed",{finalScore:_,finalCriticalIssues:l,totalIssuesFixed:u,totalStructuralChanges:c,completedAt:new Date,currentAuditId:f||v,currentManuscriptId:R}),await _n(r,"completed",`M\xE1ximo de ciclos alcanzado (${s}). Score: ${_}. Total corregidos: ${u}`),n?.({phase:"completed",message:`Auto-correcci\xF3n completada tras ${s} ciclos. Score: ${_}. Total corregidos: ${u}`,score:_});break}await new Promise(_=>setTimeout(_,2e3))}}finally{Hu.delete(r)}}async function Ace(r){let e=await b.getChaptersByProject(r),t=new Map;if(e)for(let n of e)n.content&&t.set(n.id,n.content);return console.log(`[AutoCorrector] Backed up ${t.size} chapters for project ${r}`),t}async function Sce(r,e){let t=0,n=Array.from(e.entries());for(let a of n)await b.updateChapter(a[0],{content:a[1]}),t++;console.log(`[AutoCorrector] Restored ${t} chapters for project ${r}`)}async function Rce(r){let e=await b.getChaptersByProject(r);if(!e||e.length===0)return"";let t=[...e].sort((a,s)=>a.chapterNumber-s.chapterNumber),n="";for(let a of t)if(a.content){let s="";a.chapterNumber===0?s="Pr\xF3logo":a.chapterNumber===998?s="Ep\xEDlogo":a.chapterNumber===999?s="Nota del Autor":s=`Cap\xEDtulo ${a.chapterNumber}`,n+=`

=== ${s}: ${a.title||""} ===

${a.content}`}return n}async function wce(r){let e=await b.getWorldBibleByProject(r);if(!e)return null;let t=[];return e.characters&&t.push(`

=== PERSONAJES ===
${JSON.stringify(e.characters,null,2)}`),e.timeline&&t.push(`

=== L\xCDNEA TEMPORAL ===
${JSON.stringify(e.timeline,null,2)}`),e.worldRules&&t.push(`

=== REGLAS DEL MUNDO ===
${JSON.stringify(e.worldRules,null,2)}`),t.length>0?t.join(`
`):null}async function Ice(r,e,t,n,a,s){try{let i=(await b.getProject(e))?.title||"Untitled";console.log(`[AutoCorrector] runAudit cycle ${a}: Creating audit record for "${i}"...`);let[u]=await M.insert(Xe).values({projectId:e,status:"pending",novelContent:t,bibleContent:n}).returning();console.log(`[AutoCorrector] runAudit cycle ${a}: Audit record #${u.id} created. Importing gemini-auditor...`);let{initializeNovelContext:c,runAllAgentsWithProgress:p,countCriticalIssues:m,calculateOverallScore:f}=await Promise.resolve().then(()=>(fb(),hb));console.log(`[AutoCorrector] runAudit cycle ${a}: gemini-auditor imported. Initializing context...`),await M.update(Xe).set({status:"caching"}).where(q(Xe.id,u.id)),s?.({phase:"auditing",message:`Ciclo ${a}: Inicializando contexto Gemini...`,cycle:a});let g=await c(t,n,i);if(console.log(`[AutoCorrector] runAudit cycle ${a}: Context initialized: ${g.success?"OK":"FAILED"}`),!g.success)return await M.update(Xe).set({status:"error",errorMessage:"Failed to initialize context"}).where(q(Xe.id,u.id)),{success:!1,auditId:u.id,overallScore:0,criticalIssues:0,totalIssues:0,error:"Error inicializando contexto"};await M.update(Xe).set({status:"analyzing"}).where(q(Xe.id,u.id)),s?.({phase:"auditing",message:`Ciclo ${a}: Ejecutando 3 agentes de auditor\xEDa en paralelo...`,cycle:a}),console.log(`[AutoCorrector] runAudit cycle ${a}: Running 3 agents in parallel...`);let C=(await p(async l=>{let h={};l.agentType==="CONTINUITY"&&(h.continuityReport=l),l.agentType==="CHARACTER"&&(h.characterReport=l),l.agentType==="STYLE"&&(h.styleReport=l),await M.update(Xe).set(h).where(q(Xe.id,u.id)),s?.({phase:"auditing",message:`Ciclo ${a}: Agente ${l.agentType} completado (${l.failed?"FALLIDO":`Score: ${l.overallScore}`})`,cycle:a})})).filter(l=>!l.failed).map(l=>({agentType:l.agentType,overallScore:l.overallScore,analysis:l.analysis,issues:l.issues})),A=f(C),T=m(C),E=C.reduce((l,h)=>l+h.issues.length,0),d={timestamp:new Date().toISOString(),novelTitle:i,reports:C,criticalFlags:T};return await M.update(Xe).set({status:"completed",finalAudit:d,overallScore:A,criticalFlags:T,completedAt:new Date}).where(q(Xe.id,u.id)),{success:!0,auditId:u.id,overallScore:A,criticalIssues:T,totalIssues:E}}catch(o){return console.error(`[AutoCorrector] Audit error cycle ${a}:`,o),{success:!1,overallScore:0,criticalIssues:0,totalIssues:0,error:String(o)}}}async function xce(r,e,t,n){try{let{startCorrectionProcess:a}=await Promise.resolve().then(()=>(ho(),mo));return await a(e,o=>{n?.({phase:"correcting",message:`Ciclo ${t}: ${o.message}`,cycle:t,details:{correctionPhase:o.phase,current:o.current,total:o.total}})},{source:"auto"})}catch(a){return console.error(`[AutoCorrector] Correction error cycle ${t}:`,a),{success:!1,error:String(a)}}}async function Tce(r,e,t,n){try{let{detectStructuralIssues:a}=await Promise.resolve().then(()=>(bb(),Bx)),{applyStructuralResolution:s}=await Promise.resolve().then(()=>(bb(),Bx)),[o]=await M.select().from(Xe).where(q(Xe.id,e));if(!o||!o.finalAudit)return 0;let i=o.finalAudit,u=[];for(let m of i.reports||[])for(let f of m.issues||[])u.push(f);let c=a(u,t);if(c.length===0)return 0;n?.({phase:"structural",message:`Detectados ${c.length} problemas estructurales. Resolviendo aut\xF3nomamente...`});let p=0;for(let m of c){let f=Oce(m);if(!f)continue;n?.({phase:"structural",message:`Aplicando ${f.type} en cap\xEDtulos ${m.affectedChapters.join(", ")}...`});let[g]=await M.select().from(Be).where(q(Be.id,r));if(!g)continue;let y=g.pendingCorrections||[],C=`structural-auto-${Date.now()}-${p}`;y.push({id:C,issueId:m.id,location:`Cap\xEDtulos ${m.affectedChapters.join(", ")}`,chapterNumber:m.affectedChapters[0],originalText:`[ESTRUCTURAL] ${m.description}`,correctedText:JSON.stringify({structuralIssue:m,selectedOption:f}),instruction:`[AUTO-STRUCTURAL] ${m.type}: ${m.description}`,severity:m.severity,status:"pending",diffStats:{wordsAdded:0,wordsRemoved:0,lengthChange:0},createdAt:new Date().toISOString()}),await M.update(Be).set({pendingCorrections:y}).where(q(Be.id,r));try{(await s(r,C,f.id)).success&&p++}catch(A){console.error("[AutoCorrector] Structural resolution error:",A)}}return p}catch(a){return console.error("[AutoCorrector] Structural handling error:",a),0}}function Oce(r){let e=r.resolutionOptions||[];if(e.length===0)return null;if(r.recommendedOption){let t=e.find(n=>n.id===r.recommendedOption);if(t)return t}switch(r.type){case"duplicate_chapters":case"duplicate_scenes":let t=e.find(a=>a.type==="delete");return e.find(a=>a.type==="merge")||t||e[0];case"redundant_content":return e.find(a=>a.type==="merge")||e.find(a=>a.type==="rewrite")||e[0];case"continuity_conflict":return e.find(a=>a.type==="modify_a")||e.find(a=>a.type==="modify_b")||e.find(a=>a.type==="add_explanation")||e[0];case"narrative_flow_break":return e.find(a=>a.type==="add_transition")||e[0];case"repeated_scene":return e.find(a=>a.type==="rewrite")||e.find(a=>a.type==="delete")||e[0];default:return e[0]}}async function Nce(r){try{let[e]=await M.select().from(Be).where(q(Be.id,r));if(!e)return 0;let t=e.pendingCorrections||[],n=0,a=0,s=["[No se pudo localizar el texto exacto]","[Problema gen\xE9rico sin frases identificables]","[Edita manualmente el texto original aqu\xED]","[Escribe aqu\xED la correcci\xF3n]"],o=e.correctedContent||e.originalContent;for(let i of t)if(i.status==="pending"){if(s.includes(i.originalText)||s.includes(i.correctedText)||!i.correctedText||i.correctedText===i.originalText){i.status="rejected",i.reviewedAt=new Date().toISOString(),a++;continue}if(i.originalText&&!i.originalText.startsWith("[")){if(o.includes(i.originalText))o=o.replace(i.originalText,i.correctedText);else if(!o.includes(i.correctedText)){console.log(`[AutoCorrector] Correcci\xF3n ${i.id} descartada: ni original ni corregido encontrado en contenido`),i.status="rejected",i.reviewedAt=new Date().toISOString(),a++;continue}}i.status="approved",i.reviewedAt=new Date().toISOString(),n++}return await M.update(Be).set({pendingCorrections:t,correctedContent:o,approvedIssues:n,status:"approved"}).where(q(Be.id,r)),console.log(`[AutoCorrector] Auto-approve: ${n} aprobadas, ${a} no corregibles (saltadas)`),n}catch(e){return console.error("[AutoCorrector] Auto-approve error:",e),0}}async function _ce(r,e){try{let[t]=await M.select().from(Be).where(q(Be.id,e));if(!t||!t.correctedContent)return;let n=t.correctedContent,a=await b.getChaptersByProject(r);if(!a)return;let s=/=== (Prlogo|Eplogo|Nota del Autor|Captulo \d+)(?::\s*([^=]*))?\s*===\s*([\s\S]*?)(?=\n\n===|$)/g,o;for(;(o=s.exec(n))!==null;){let i=o[1].trim(),u=o[3].trim(),c;i==="Pr\xF3logo"?c=0:i==="Ep\xEDlogo"?c=998:i==="Nota del Autor"?c=999:c=parseInt(i.replace("Cap\xEDtulo ",""));let p=a.find(m=>m.chapterNumber===c);p&&u.length>100&&await b.updateChapter(p.id,{content:u})}}catch(t){console.error("[AutoCorrector] Error applying corrections to chapters:",t)}}async function Hc(r,e){let[t]=await M.select().from(bt).where(q(bt.id,r));if(!t)return;let n=t.cycleHistory||[];n.push(e),await M.update(bt).set({cycleHistory:n}).where(q(bt.id,r))}async function Eb(r,e,t,n){let a={cycle:e,auditId:n.auditId||0,overallScore:n.overallScore||0,criticalIssues:n.criticalIssues||0,totalIssues:n.totalIssues||0,issuesFixed:0,structuralChanges:0,startedAt:t,completedAt:new Date().toISOString(),result:"cancelled"};await Hc(r,a),await sa(r,"cancelled"),await _n(r,"cancelled",`Ciclo ${e}: Cancelado`)}async function Pce(r){let[e]=await M.select().from(bt).where(q(bt.id,r));return e||null}async function $ce(r){return M.select().from(bt).where(q(bt.projectId,r)).orderBy(bt.createdAt)}var Hu,Vm=G(()=>{"use strict";Mo();Da();ms();vn();Hu=new Map});var Jce={};wr(Jce,{log:()=>Ta});module.exports=e5(Jce);var Sb=ln(GE(),1);vn();Mo();var aa=ln(require("fs"),1);vn();It();function rm(r,e){let t=e?.characters||e?.personajes||[],n=r.toLowerCase().trim();return t.find(a=>{let s=(a.name||a.nombre||"").toLowerCase().trim();return s.includes(n)||n.includes(s)||s.split(" ")[0]===n.split(" ")[0]})||null}function Gte(r,e){let t=e?.characters||e?.personajes||[];if(!e||t.length===0||!r||r.length===0)return null;let n=[];for(let a of r){let s=rm(a,e);if(s){let o=[];if(s.eyeColor&&o.push(`Ojos: ${s.eyeColor}`),s.hairColor&&o.push(`Cabello: ${s.hairColor}`),s.age&&o.push(`Edad: ${s.age}`),s.height&&o.push(`Altura: ${s.height}`),s.physicalTraits&&o.push(`Rasgos: ${s.physicalTraits}`),s.traits&&Array.isArray(s.traits)){let i=s.traits.filter(u=>/ojo|cabello|pelo|altura|cicatriz|tatuaje|fsic/i.test(u));i.length>0&&o.push(...i.map(u=>`  - ${u}`))}if(s.description){let i=s.description.match(/\(INMUTABLE[^)]*\)/gi);if(i&&o.push(`\u26A0\uFE0F ${i.join(", ")}`),!s.eyeColor){let u=s.description.match(/ojos?\s+([\w\s]+?)(?:\s*\(|,|\.)/i);u&&o.push(`Ojos: ${u[1].trim()}`)}}if(o.length>0){n.push(`    \u{1F4CC} ${s.name}:`);for(let i of o)n.push(`       ${i}`)}}}return n.length>0?n.join(`
`):null}function Vte(r,e){if(!r||r.length<2)return null;let t=[],n=e?.characters||e?.personajes||[];for(let a of r){let s=rm(a,e);if(!s)continue;let o=s.relationships||s.relaciones||[];if(Array.isArray(o)&&o.length>0){let i=o.filter(u=>{let c=(u.character||u.personaje||u.with||"").toLowerCase();return r.some(p=>c.includes(p.toLowerCase())||p.toLowerCase().includes(c))});if(i.length>0){t.push(`    \u{1F4CC} ${s.name||s.nombre}:`);for(let u of i){let c=u.character||u.personaje||u.with||"",p=u.type||u.tipo||u.relation||"",m=u.description||u.descripcion||"";t.push(`       \u2192 ${c}: ${p}${m?` - ${m}`:""}`)}}}if(s.description||s.descripcion){let i=s.description||s.descripcion;for(let u of r)u.toLowerCase()!==a.toLowerCase()&&i.toLowerCase().includes(u.toLowerCase())}}return t.length>0?t.join(`
`):null}function zte(r,e){let t=e?.locations||e?.lugares||e?.settings||[];if(!t||t.length===0||!r)return null;let n=r.toLowerCase();for(let a of t){let s=(a.name||a.nombre||"").toLowerCase();if(s&&(n.includes(s)||s.includes(n.split(" ")[0]))){let o=[];if(o.push(`    \u{1F4CD} ${a.name||a.nombre}:`),(a.description||a.descripcion)&&o.push(`       ${a.description||a.descripcion}`),a.sensoryDetails||a.detalles_sensoriales){let i=a.sensoryDetails||a.detalles_sensoriales;typeof i=="string"?o.push(`       Ambiente: ${i}`):Array.isArray(i)&&o.push(`       Ambiente: ${i.join(", ")}`)}return(a.atmosphere||a.atmosfera)&&o.push(`       Atm\xF3sfera: ${a.atmosphere||a.atmosfera}`),o.join(`
`)}}return null}function I2(r){let e=r?.rules||r?.reglas_lore||r?.worldRules||r?.reglas||[];if(!e||e.length===0)return null;let t=[];for(let n of e.slice(0,5))typeof n=="string"?t.push(`    \u2022 ${n}`):(n.rule||n.regla)&&t.push(`    \u2022 ${n.rule||n.regla}`);return t.length>0?t.join(`
`):null}function Hte(r){let e=r?.vocabulario_prohibido||r?.prohibitedWords||[];return!e||e.length===0?null:e.slice(0,20).join(", ")}function x2(r){let e=r?.characters||r?.personajes||[],t=[];for(let n of e){let a=(n.status||n.estado||"").toLowerCase(),s=a.includes("muerto")||a.includes("dead")||a.includes("fallecido")||a.includes("deceased"),o=(n.description||n.descripcion||"").toLowerCase(),i=o.includes("muri\xF3")||o.includes("falleci\xF3")||o.includes("fue asesinado")||o.includes("(muerto)");if(s||i){let u=n.name||n.nombre,c=n.deathChapter||n.capitulo_muerte||"";t.push(c?`${u} (muri\xF3 en cap. ${c})`:u)}}return t.length>0?t.join(", "):null}function Wte(r,e){let t=[];for(let n of r){let a=rm(n,e);if(!a)continue;let s=a.injuries||a.lesiones||a.activeInjuries||[],o=a.physicalState||a.estadoFisico||"",i=[];Array.isArray(s)&&s.length>0&&i.push(...s.map(p=>typeof p=="string"?p:p.description||p.descripcion)),o&&i.push(o);let c=(a.description||a.descripcion||"").match(/\(LESIN[^)]*\)|\(HERIDA[^)]*\)|\(INJURY[^)]*\)/gi);c&&i.push(...c),i.length>0&&t.push(`    \u{1F3E5} ${a.name||a.nombre}: ${i.join(", ")}`)}return t.length>0?t.join(`
`):null}function T2(r){let e=r?.objects||r?.objetos||r?.establishedItems||[];if(!e||e.length===0)return null;let t=[];for(let n of e)if(typeof n=="string")t.push(`    \u2022 ${n}`);else{let a=n.name||n.nombre||"",s=n.owner||n.propietario||"",o=n.establishedIn||n.capitulo||"";if(a){let i=`    \u2022 ${a}`;s&&(i+=` (de ${s})`),o&&(i+=` [cap. ${o}]`),t.push(i)}}return t.length>0?t.join(`
`):null}function Qte(r){let e=r?.characters||r?.personajes||[];if(!e||e.length===0)return null;let t=[];for(let n of e){let a=n.name||n.nombre||"";if(!a)continue;let s=[];(n.role||n.rol)&&s.push(n.role||n.rol),n.eyeColor&&s.push(`ojos ${n.eyeColor}`),n.hairColor&&s.push(`cabello ${n.hairColor}`),n.age&&s.push(`${n.age} a\xF1os`),(n.occupation||n.ocupacion)&&s.push(n.occupation||n.ocupacion),(n.status==="dead"||n.estado==="muerto")&&s.push("\u2620\uFE0F MUERTO");let o=s.length>0?` \u2014 ${s.join(", ")}`:"";t.push(`    \u2022 ${a}${o}`)}return t.length>0?t.join(`
`):null}function Jte(r){let e=r?.locations||r?.lugares||r?.settings||[];if(!e||e.length===0)return null;let t=[];for(let n of e){let a=n.name||n.nombre||"";if(!a)continue;let s=[];(n.type||n.tipo)&&s.push(n.type||n.tipo),(n.region||n.zona)&&s.push(n.region||n.zona);let o=s.length>0?` \u2014 ${s.join(", ")}`:"";t.push(`    \u2022 ${a}${o}`)}return t.length>0?t.join(`
`):null}function Kte(r){let e=r?.objects||r?.objetos||r?.establishedItems||[];if(!e||e.length===0)return null;let t=[];for(let n of e)if(typeof n=="string")t.push(`    \u2022 ${n}`);else{let a=n.name||n.nombre||"",s=n.owner||n.propietario||"",o=n.significance||n.importancia||"";if(a){let i=`    \u2022 ${a}`;s&&(i+=` (de ${s})`),o&&(i+=` \u2014 ${o}`),t.push(i)}}return t.length>0?t.join(`
`):null}function O2(r){let e=r?.watchpoints_continuidad||r?.watchpoints||[];if(!e||e.length===0)return null;let t=[];for(let n of e.slice(0,5))typeof n=="string"?t.push(`    \u26A0\uFE0F ${n}`):t.push(`    \u26A0\uFE0F ${n.description||n.descripcion||JSON.stringify(n)}`);return t.length>0?t.join(`
`):null}function N2(r){let e=r?.temas_centrales||r?.centralThemes||r?.themes||[];if(!e||e.length===0)return null;let t=e.slice(0,5).map(n=>typeof n=="string"?n:n.name||n.nombre||n.theme||n.tema||"").filter(Boolean);return t.length>0?t.join(", "):null}function Xte(r){let e=r?.motivos_literarios||r?.literaryMotifs||r?.motifs||[];if(!e||e.length===0)return null;let t=e.slice(0,5).map(n=>typeof n=="string"?n:n.name||n.nombre||n.motif||n.motivo||"").filter(Boolean);return t.length>0?t.join(", "):null}function Yte(r){let e=r?.paleta_sensorial_global||r?.sensoryPalette||r?.palette||{};if(!e||Object.keys(e).length===0)return null;let t=[];return(e.colores||e.colors)&&t.push(`    \u{1F3A8} Colores: ${Array.isArray(e.colores||e.colors)?(e.colores||e.colors).join(", "):e.colores||e.colors}`),(e.sonidos||e.sounds)&&t.push(`    \u{1F50A} Sonidos: ${Array.isArray(e.sonidos||e.sounds)?(e.sonidos||e.sounds).join(", "):e.sonidos||e.sounds}`),(e.olores||e.smells)&&t.push(`    \u{1F443} Olores: ${Array.isArray(e.olores||e.smells)?(e.olores||e.smells).join(", "):e.olores||e.smells}`),(e.texturas||e.textures)&&t.push(`    \u270B Texturas: ${Array.isArray(e.texturas||e.textures)?(e.texturas||e.textures).join(", "):e.texturas||e.textures}`),(e.atmosfera||e.atmosphere)&&t.push(`    \u{1F32B}\uFE0F Atm\xF3sfera: ${e.atmosfera||e.atmosphere}`),t.length>0?t.join(`
`):null}function Zte(r,e){let t=[];for(let n of r){let a=rm(n,e);if(!a)continue;let s=a.voice||a.voz||a.speechPattern||a.patron_habla||"",o=a.dialect||a.dialecto||"",i=a.catchphrases||a.muletillas||[],u=[];s&&u.push(s),o&&u.push(`Dialecto: ${o}`),Array.isArray(i)&&i.length>0&&u.push(`Muletillas: "${i.slice(0,3).join('", "')}"`),u.length>0&&t.push(`    \u{1F5E3}\uFE0F ${a.name||a.nombre}: ${u.join(" | ")}`)}return t.length>0?t.join(`
`):null}function ere(r,e){let t=[];for(let n of r){let a=rm(n,e);if(!a)continue;let s=a.arc||a.arco||a.characterArc||a.arco_personaje||"",o=a.currentState||a.estado_actual||"",i=a.motivation||a.motivacion||"",u=a.fear||a.miedo||a.greatestFear||"",c=[];if(s&&c.push(`Arco: ${s}`),o&&c.push(`Estado: ${o}`),i&&c.push(`Motivaci\xF3n: ${i}`),u&&c.push(`Miedo: ${u}`),c.length>0){t.push(`    \u{1F4C8} ${a.name||a.nombre}:`);for(let p of c)t.push(`       ${p}`)}}return t.length>0?t.join(`
`):null}function _2(r){let e=r?.premisa||r?.premise||"";return e?e.length>200?e.substring(0,200)+"...":e:null}function P2(r){let e=r?.era||r?.epoca||r?.timePeriod||"",t=r?.year||r?.a\u00F1o||"",n=r?.technology||r?.tecnologia||"",a=[];e&&a.push(`    \u{1F4C5} \xC9poca: ${e}`),t&&a.push(`    \u{1F4C5} A\xF1o: ${t}`),n&&a.push(`    \u{1F4BB} Tecnolog\xEDa: ${n}`);let s=r?.events||r?.eventos||r?.timeline||r?.linea_temporal||r?.keyEvents||r?.eventosClave||r?.timeline_master?.key_events||[];if(Array.isArray(s)&&s.length>0){a.push(`
    \u23F1\uFE0F CRONOLOG\xCDA DE EVENTOS (OBLIGATORIO RESPETAR):`);let u=[...s].sort((c,p)=>{let m=c.date||c.fecha||c.day||c.dia||"",f=p.date||p.fecha||p.day||p.dia||"";return String(m).localeCompare(String(f))});for(let c of u){let p=c.date||c.fecha||c.day||c.dia||"",m=c.description||c.descripcion||c.event||c.evento||"",f=c.chapter||c.capitulo||"";if(p&&m){let g=`      \u2022 ${p}: ${m}`;f&&(g+=` [Cap. ${f}]`),a.push(g)}}a.push(`
    \u26A0\uFE0F IMPORTANTE: Las referencias temporales ("hace X d\xEDas", "ayer", "la semana pasada") DEBEN ser consistentes con esta cronolog\xEDa.`)}let o=r?.characters||r?.personajes||[],i=[];for(let u of o){let c=u.name||u.nombre||"",p=u.deathDate||u.fechaMuerte||"",m=u.injuryDate||u.fechaLesion||"",f=u.events||u.eventos||[];if(p&&i.push(`      \u2022 ${p}: Muerte de ${c}`),m){let g=u.injury||u.lesion||"lesi\xF3n";i.push(`      \u2022 ${m}: ${c} sufre ${g}`)}if(Array.isArray(f))for(let g of f){let y=g.date||g.fecha||"",C=g.description||g.descripcion||"";y&&C&&i.push(`      \u2022 ${y}: ${c} - ${C}`)}}return i.length>0&&(a.push(`
    \u{1F464} EVENTOS DE PERSONAJES FECHADOS:`),a.push(...i)),a.length>0?a.join(`
`):null}var na={GLOBAL_ARCHITECT:(r,e,t,n,a,s,o,i,u,c,p,m,f,g,y,C,A)=>`
    Eres un Arquitecto Narrativo de Best-Sellers con experiencia en ${e}.
    IDIOMA: Escribe TODO en ESPA\xD1OL. T\xEDtulos de cap\xEDtulos, descripciones, nombres de personajes t\xEDpicos del contexto, todo debe estar en espa\xF1ol.
    OBJETIVO: Crear la estructura maestra para una novela de ${e} con un M\xCDNIMO de ${t} cap\xEDtulos regulares.
    PREMISA: "${r}"
    TONO: ${n}
    ${a?`INSTRUCCIONES ADICIONALES DEL AUTOR: ${a}`:""}
    
    === CONFIGURACI\xD3N DE LA NOVELA ===
    - Estructura: ${i?"Con Pr\xF3logo":"Sin Pr\xF3logo"} | ${u?"Con Ep\xEDlogo":"Sin Ep\xEDlogo"} | ${c?"Con Nota del Autor":"Sin Nota del Autor"}
    - Palabras por cap\xEDtulo: ${y||1500}-${C||3500}
    ${p==="series"?`
    === INFORMACI\xD3N DE SERIE ===
    - Nombre de la serie: ${m||"No especificado"}
    - Este es el libro #${f||1} de la serie
    ${g?`- Contexto de libros anteriores: ${g}`:""}
    
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u26A0\uFE0F PROTECCI\xD3N DE PERSONAJES DE SERIE (INVIOLABLE)               \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 Los personajes definidos en la gu\xEDa de la serie son SAGRADOS.   \u2551
    \u2551 EST\xC1 ABSOLUTAMENTE PROHIBIDO:                                   \u2551
    \u2551                                                                  \u2551
    \u2551 1. CAMBIAR NOMBRES: Si la gu\xEDa dice "Elena Voss", NO puedes    \u2551
    \u2551    renombrarla como "Helena", "Elisa", ni ning\xFAn otro nombre.   \u2551
    \u2551    Usa el nombre EXACTO tal como aparece en la gu\xEDa.            \u2551
    \u2551                                                                  \u2551
    \u2551 2. CAMBIAR SEXO/G\xC9NERO: Si un personaje es mujer en la gu\xEDa,   \u2551
    \u2551    DEBE ser mujer en la biblia del mundo. Si es hombre, DEBE    \u2551
    \u2551    ser hombre. NUNCA cambiar el g\xE9nero de un personaje.         \u2551
    \u2551                                                                  \u2551
    \u2551 3. CAMBIAR ROL: Si la gu\xEDa define un personaje como             \u2551
    \u2551    protagonista/antagonista/aliado, MANT\xC9N ese mismo rol.       \u2551
    \u2551                                                                  \u2551
    \u2551 4. INVENTAR REEMPLAZOS: NO sustituyas personajes de la gu\xEDa    \u2551
    \u2551    por personajes nuevos con funciones similares.               \u2551
    \u2551                                                                  \u2551
    \u2551 5. ALTERAR ATRIBUTOS F\xCDSICOS: Ojos, cabello, edad, rasgos      \u2551
    \u2551    distintivos definidos en la gu\xEDa son INMUTABLES.             \u2551
    \u2551                                                                  \u2551
    \u2551 REGLA: Copia los personajes de la gu\xEDa de serie TAL CUAL.      \u2551
    \u2551 Puedes A\xD1ADIR personajes nuevos secundarios, pero NUNCA        \u2551
    \u2551 modificar los existentes de la gu\xEDa.                            \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    `:""}
    ${s?`
    === GU\xCDA DE ESCRITURA EXTENDIDA (SEGUIR OBLIGATORIAMENTE) ===
    Esta gu\xEDa contiene los personajes, escenarios, estructura y detalles espec\xEDficos que DEBES respetar:
    
    ${s}
    
    IMPORTANTE: Usa EXACTAMENTE los personajes, nombres, ubicaciones y estructura definidos en esta gu\xEDa. NO inventes personajes nuevos a menos que la gu\xEDa lo permita.
    ${p==="series"?`
    \u26A0\uFE0F RECORDATORIO SERIE: Los nombres y g\xE9neros de los personajes en esta gu\xEDa son INMUTABLES.
    Si la gu\xEDa dice "Inspector Garc\xEDa" (hombre), NO lo conviertas en "Inspectora Garc\xEDa" ni en "Inspector G\xF3mez".
    Copia EXACTAMENTE cada nombre, sexo y rol tal como aparece arriba.`:""}
    `:""}
    ${o?`
    === GU\xCDA DE ESTILO ===
    ${o}
    `:""}
    ${A?`
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 OPTIMIZACI\xD3N KINDLE UNLIMITED (KU) - OBLIGATORIO                 \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551 Esta novela ser\xE1 publicada en Kindle Unlimited. DISE\xD1A para     \u2551
    \u2551 maximizar retenci\xF3n de lectores y pages read:                    \u2551
    \u2551                                                                  \u2551
    \u2551 1. ESTRUCTURA DE CAP\xCDTULOS:                                      \u2551
    \u2551    - Planifica CLIFFHANGERS al final de CADA cap\xEDtulo           \u2551
    \u2551    - Cada cap\xEDtulo debe terminar en: pregunta sin respuesta,    \u2551
    \u2551      revelaci\xF3n impactante, peligro inminente, o decisi\xF3n       \u2551
    \u2551      crucial pendiente                                           \u2551
    \u2551    - NUNCA termines un cap\xEDtulo con resoluci\xF3n completa         \u2551
    \u2551                                                                  \u2551
    \u2551 2. HOOKS DE APERTURA:                                            \u2551
    \u2551    - Planifica que cada cap\xEDtulo abra con acci\xF3n o tensi\xF3n      \u2551
    \u2551    - Las primeras l\xEDneas deben capturar inmediatamente          \u2551
    \u2551    - Evita aperturas descriptivas largas o introspectivas       \u2551
    \u2551                                                                  \u2551
    \u2551 3. RITMO Y PACING:                                               \u2551
    \u2551    - Alterna tensi\xF3n alta/media - nunca 2 cap\xEDtulos lentos      \u2551
    \u2551    - Planifica eventos significativos cada 2-3 cap\xEDtulos        \u2551
    \u2551    - Los cap\xEDtulos deben tener longitud consistente             \u2551
    \u2551      (2000-3500 palabras ideal para KU)                          \u2551
    \u2551                                                                  \u2551
    \u2551 4. PUNTOS DE NO RETORNO:                                         \u2551
    \u2551    - Ubica eventos irreversibles en el 25%, 50%, y 75%          \u2551
    \u2551    - Estos eventos deben hacer imposible abandonar la lectura   \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    `:""}

    PROCESO DE DISE\xD1O:
    1. Analiza la premisa y define los temas centrales
    2. Dise\xF1a personajes memorables con arcos de transformaci\xF3n
    3. Establece las reglas del mundo (especialmente si es fantas\xEDa/ciencia ficci\xF3n)
    4. Planifica la estructura de 3 actos con puntos de giro
    5. Define los hilos narrativos que mantendr\xE1n la tensi\xF3n
    6. **NUEVO**: Crea la L\xCDNEA TEMPORAL MAESTRA (qu\xE9 d\xEDa/momento ocurre cada cap\xEDtulo)
    7. **NUEVO**: Crea el MAPA DE UBICACIONES con tiempos de viaje realistas
    8. **NUEVO**: Define el ESTADO INICIAL de cada personaje principal

    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 REGLAS DE DISE\xD1O ANTI-CLICH\xC9 (OBLIGATORIAS EN TODO CAP\xCDTULO)    \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 1. PROTAGONISTA ACTIVO:                                         \u2551
    \u2551    - El protagonista obtiene informaci\xF3n por M\xC9RITO PROPIO      \u2551
    \u2551    - PROHIBIDO planificar: mensajes an\xF3nimos, llamadas          \u2551
    \u2551      misteriosas, informantes oportunos, "alguien le env\xEDa"     \u2551
    \u2551    - Cada descubrimiento debe ser GANADO: investigaci\xF3n,        \u2551
    \u2551      interrogatorio, deducci\xF3n, infiltraci\xF3n, vigilancia.       \u2551
    \u2551                                                                  \u2551
    \u2551 2. VARIEDAD ESTRUCTURAL EN CADA CAP\xCDTULO:                       \u2551
    \u2551    - NO repetir patrones consecutivos. Si Cap 5 tiene           \u2551
    \u2551      "viaje + reflexi\xF3n + encuentro", Cap 6 debe ser diferente. \u2551
    \u2551    - Alternar: acci\xF3n, di\xE1logo tenso, descubrimiento,           \u2551
    \u2551      confrontaci\xF3n, an\xE1lisis, escape, trampa, traici\xF3n.         \u2551
    \u2551    - Evitar abuso de descripciones clim\xE1ticas (lluvia, fr\xEDo).   \u2551
    \u2551                                                                  \u2551
    \u2551 3. ANTAGONISTAS COMPETENTES E INTELIGENTES:                     \u2551
    \u2551    - Los villanos NO explican sus planes al h\xE9roe.              \u2551
    \u2551    - No planificar escenas tipo "el villano monologa antes      \u2551
    \u2551      de matar". Los antagonistas ACT\xDAAN con competencia.        \u2551
    \u2551    - Si hay confrontaci\xF3n verbal, el villano AMENAZA o PROVOCA, \u2551
    \u2551      pero NUNCA revela su estrategia completa.                  \u2551
    \u2551                                                                  \u2551
    \u2551 4. GESTOS Y MULETILLAS LIMITADOS:                               \u2551
    \u2551    - Define gestos caracter\xEDsticos pero planifica su uso        \u2551
    \u2551      ESPACIADO (1 vez cada 5-10 cap\xEDtulos, no en cada uno).     \u2551
    \u2551    - Evitar que un personaje repita el mismo gesto f\xEDsico       \u2551
    \u2551      (tocarse anillo, cicatriz, etc.) en m\xFAltiples cap\xEDtulos.   \u2551
    \u2551                                                                  \u2551
    \u2551 5. CREDIBILIDAD NARRATIVA (FUNDAMENTAL):                        \u2551
    \u2551    - Define EXPL\xCDCITAMENTE las habilidades del protagonista     \u2551
    \u2551      (formaci\xF3n, idiomas, combate, tecnolog\xEDa, contactos).      \u2551
    \u2551    - El protagonista SOLO puede usar habilidades definidas.     \u2551
    \u2551    - Define recursos iniciales (dinero, armas, veh\xEDculos).      \u2551
    \u2551    - Planifica c\xF3mo el protagonista OBTIENE nuevos recursos     \u2551
    \u2551      durante la trama (no pueden aparecer m\xE1gicamente).         \u2551
    \u2551    - M\xE1ximo 1 coincidencia afortunada en toda la novela.        \u2551
    \u2551    - Las heridas graves tienen consecuencias en cap\xEDtulos       \u2551
    \u2551      posteriores (no desaparecen convenientemente).             \u2551
    \u2551    - Los enemigos recuerdan al protagonista y toman medidas.    \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 REGLA DE CAP\xCDTULOS: M\xCDNIMO ${t} CAP\xCDTULOS REGULARES               \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551 El usuario solicita un M\xCDNIMO de ${t} cap\xEDtulos regulares.         \u2551
    \u2551                                                                  \u2551
    \u2551 REGLA DE FLEXIBILIDAD NARRATIVA:                                 \u2551
    \u2551 Si ${t} cap\xEDtulos NO son suficientes para desarrollar              \u2551
    \u2551 correctamente todos los arcos narrativos, hilos de trama,        \u2551
    \u2551 y puntos de giro, PUEDES a\xF1adir cap\xEDtulos regulares adicionales. \u2551
    \u2551                                                                  \u2551
    \u2551 CRITERIOS para a\xF1adir cap\xEDtulos:                                 \u2551
    \u2551 - Los arcos de personajes necesitan m\xE1s espacio para resolverse  \u2551
    \u2551 - Los puntos de giro est\xE1n demasiado comprimidos                 \u2551
    \u2551 - La tensi\xF3n narrativa no puede construirse adecuadamente        \u2551
    \u2551 - Los hilos secundarios no tienen espacio para desarrollarse     \u2551
    \u2551 - El desenlace se siente apresurado                              \u2551
    \u2551                                                                  \u2551
    \u2551 L\xCDMITES: Puedes a\xF1adir hasta un 30% m\xE1s de cap\xEDtulos             \u2551
    \u2551 (m\xE1ximo ${t+Math.ceil(t*.3)} cap\xEDtulos regulares si es necesario).        \u2551
    \u2551 No a\xF1adas cap\xEDtulos innecesarios de relleno.                     \u2551
    \u2551                                                                  \u2551
    \u2551 El pr\xF3logo y ep\xEDlogo son ADICIONALES, NO cuentan:                \u2551
    \u2551 ${i?"  - Pr\xF3logo = chapter_num: 0 (ADICIONAL, no cuenta)":"  - Sin pr\xF3logo"}         \u2551
    \u2551 ${u?"  - Ep\xEDlogo = chapter_num: 998 (ADICIONAL, no cuenta)":"  - Sin ep\xEDlogo"}       \u2551
    \u2551                                                                  \u2551
    \u2551 VERIFICA: chapter_num 1, 2, 3... consecutivos SIN saltos.        \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u26A0\uFE0F REGLA CR\xCDTICA: PRESENCIA DEL PROTAGONISTA (OBLIGATORIA)      \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 El PROTAGONISTA (personaje principal, POV, h\xE9roe) DEBE:         \u2551
    \u2551                                                                  \u2551
    \u2551 1. Estar EXPL\xCDCITAMENTE NOMBRADO en el "summary" O "key_event"  \u2551
    \u2551    de AL MENOS el 40% de los cap\xEDtulos (${Math.ceil(t*.4)} de ${t} caps).       \u2551
    \u2551                                                                  \u2551
    \u2551 2. Aparecer en los cap\xEDtulos M\xC1S IMPORTANTES:                   \u2551
    \u2551    - Pr\xF3logo (si existe): establecer al protagonista            \u2551
    \u2551    - Cap\xEDtulo 1: OBLIGATORIO                                    \u2551
    \u2551    - Punto de giro 25% (~Cap ${Math.ceil(t*.25)}): OBLIGATORIO                  \u2551
    \u2551    - Punto medio 50% (~Cap ${Math.ceil(t*.5)}): OBLIGATORIO                    \u2551
    \u2551    - Cl\xEDmax 75% (~Cap ${Math.ceil(t*.75)}): OBLIGATORIO                        \u2551
    \u2551    - Cap\xEDtulo final: OBLIGATORIO                                \u2551
    \u2551                                                                  \u2551
    \u2551 3. En el "summary" o "key_event", usa el NOMBRE PROPIO del      \u2551
    \u2551    protagonista, NO solo pronombres o "el protagonista".        \u2551
    \u2551    INCORRECTO: "El h\xE9roe descubre la verdad"                    \u2551
    \u2551    CORRECTO: "Mar\xEDa descubre que su padre la traicion\xF3"         \u2551
    \u2551                                                                  \u2551
    \u2551 4. Si la gu\xEDa extendida define un protagonista, USA ESE NOMBRE. \u2551
    \u2551    NO inventes nombres diferentes para el personaje principal.  \u2551
    \u2551                                                                  \u2551
    \u2551 VALIDACI\xD3N: El sistema RECHAZAR\xC1 estructuras donde el           \u2551
    \u2551 protagonista no aparezca en suficientes cap\xEDtulos.              \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

    ${t>20?`
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 FORMATO COMPACTO OBLIGATORIO (NOVELA DE ${t} CAP\xCDTULOS)            \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551 ATENCI\xD3N: Con ${t} cap\xEDtulos, tu respuesta JSON ser\xE1 MUY larga.    \u2551
    \u2551 Para evitar truncamiento, usa el FORMATO COMPACTO:              \u2551
    \u2551                                                                  \u2551
    \u2551 1. En "outline": SOLO usa chapter_num, title, act, summary,     \u2551
    \u2551    key_event. NO incluyas emotional_arc, temporal_notes,         \u2551
    \u2551    location, ni character_states_entering.                       \u2551
    \u2551 2. En "summary": m\xE1ximo 1 l\xEDnea (40-60 palabras).               \u2551
    \u2551 3. En "key_event": m\xE1ximo 15 palabras.                          \u2551
    \u2551 4. "timeline_master": SOLO story_duration, start_date, y        \u2551
    \u2551    key_events (m\xE1x 8-10 eventos clave). NO chapter_timeline.    \u2551
    \u2551 5. "character_tracking": OMITIR completamente.                  \u2551
    \u2551 6. Personajes: m\xE1ximo 5-6 l\xEDneas cada uno.                      \u2551
    \u2551 7. PRIORIDAD ABSOLUTA: Generar los ${t} cap\xEDtulos COMPLETOS.      \u2551
    \u2551    Si dudas entre m\xE1s detalle o m\xE1s cap\xEDtulos, SIEMPRE elige    \u2551
    \u2551    completar TODOS los cap\xEDtulos.                               \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    `:""}
    SALIDA REQUERIDA (JSON Estricto):
    {
      "world_bible": { 
        "characters": [
          {
            "name": "Nombre del personaje",
            "role": "protagonista/antagonista/aliado/mentor",
            "profile": "Descripci\xF3n psicol\xF3gica profunda",
            "arc": "Transformaci\xF3n a lo largo de la historia",
            "appearance": {
              "eyes": "Color de ojos (INMUTABLE)",
              "hair": "Color y estilo de cabello (INMUTABLE)",
              "distinguishing_features": ["Rasgos distintivos"]
            },
            "initial_state": {
              "location": "Ciudad/lugar donde empieza",
              "physical_condition": "Sano/heridas previas/discapacidades",
              "resources": ["Armas", "Dinero aproximado", "Veh\xEDculos", "Contactos clave"],
              "skills": ["Habilidades espec\xEDficas que posee"]
            }
          }
        ],
        "rules": [
          {"category": "magia/sociedad/tecnolog\xEDa", "rule": "Descripci\xF3n de la regla", "constraints": ["Limitaciones"]}
        ],
        "settings": [
          {"name": "Nombre del lugar", "description": "Descripci\xF3n sensorial", "atmosphere": "Atm\xF3sfera"}
        ],
        "themes": ["Tema filos\xF3fico/moral 1", "Tema 2"],
        "location_map": {
          "primary_locations": [
            {"name": "Madrid", "type": "ciudad", "key_places": ["Hotel X", "Comisar\xEDa Central"]},
            {"name": "Barcelona", "type": "ciudad", "key_places": ["Puerto", "Barrio G\xF3tico"]}
          ],
          "travel_times": [
            {"from": "Madrid", "to": "Barcelona", "by_car": "6 horas", "by_plane": "1.5 horas", "by_train": "2.5 horas"},
            {"from": "Centro Madrid", "to": "Aeropuerto Barajas", "by_car": "40 minutos"}
          ]
        }
      },
      "plot_threads": [ 
        { "name": "Nombre del hilo narrativo", "description": "Qu\xE9 impulsa este hilo", "goal": "Resoluci\xF3n esperada" }
      ],
      ${t>20?`"timeline_master": {
        "story_duration": "X d\xEDas/semanas/meses",
        "start_date": "D\xEDa 1 (o fecha concreta si aplica)",
        "key_events": [
          {"date": "D\xEDa 1", "event": "Evento clave", "chapter": 1}
        ],
        "key_temporal_constraints": ["Restricci\xF3n temporal importante"]
      },`:`"timeline_master": {
        "story_duration": "X d\xEDas/semanas/meses",
        "start_date": "D\xEDa 1 (o fecha concreta si aplica)",
        "chapter_timeline": [
          {"chapter": 1, "day": "D\xEDa 1", "time_of_day": "ma\xF1ana", "duration": "4 horas", "location": "Madrid"},
          {"chapter": 2, "day": "D\xEDa 1", "time_of_day": "tarde-noche", "duration": "6 horas", "location": "Madrid"},
          {"chapter": 3, "day": "D\xEDa 2", "time_of_day": "ma\xF1ana", "duration": "3 horas", "location": "En ruta a Barcelona"}
        ],
        "key_events": [
          {"date": "D\xEDa 1", "event": "Asesinato de V\xEDctima X", "chapter": 1, "consequences": "Inicia la investigaci\xF3n"},
          {"date": "D\xEDa 3", "event": "Protagonista descubre pista clave", "chapter": 5},
          {"date": "D\xEDa 5", "event": "Confrontaci\xF3n con sospechoso", "chapter": 8, "consequences": "Protagonista resulta herido"},
          {"date": "D\xEDa 7", "event": "Revelaci\xF3n del verdadero culpable", "chapter": 12}
        ],
        "key_temporal_constraints": [
          "Entre Cap 5 y Cap 6: personaje se recupera de herida (m\xEDnimo 3 d\xEDas)",
          "Cap 10: debe coincidir con evento lunar/festivo/fecha l\xEDmite"
        ]
      },`}
      ${t<=20?`"character_tracking": [
        {
          "character": "Protagonista",
          "chapter_states": [
            {"chapter": 1, "location": "Madrid, hotel", "physical_state": "Sano", "emotional_state": "Determinado", "key_possessions": ["Pistola", "M\xF3vil", "500\u20AC"]},
            {"chapter": 5, "location": "Barcelona, hospital", "physical_state": "Herida en hombro izquierdo", "emotional_state": "Frustrado", "key_possessions": ["Pistola confiscada", "M\xF3vil destruido"]}
          ]
        }
      ],`:""}
      "outline": [
        ${t>20?`{ 
          "chapter_num": 1, 
          "title": "T\xEDtulo evocador", 
          "act": 1,
          "summary": "Sinopsis concisa de 1 l\xEDnea", 
          "key_event": "Evento principal del cap\xEDtulo"
        }`:`{ 
          "chapter_num": 1, 
          "title": "T\xEDtulo evocador del cap\xEDtulo", 
          "act": 1,
          "summary": "Sinopsis de 2-3 l\xEDneas de lo que ocurre", 
          "key_event": "El evento principal que define el cap\xEDtulo",
          "emotional_arc": "De qu\xE9 emoci\xF3n a qu\xE9 emoci\xF3n viaja el lector",
          "temporal_notes": "D\xEDa X, ma\xF1ana/tarde/noche, X horas despu\xE9s del cap\xEDtulo anterior",
          "location": "Ciudad/lugar principal donde transcurre",
          "character_states_entering": "Estado relevante de personajes al empezar (heridas, ubicaci\xF3n previa)"
        }`}
      ],
      "three_act_structure": {
        "act1": { "chapters": [1, 2, 3], "goal": "Establecer mundo y conflicto" },
        "act2": { "chapters": [4, 5, 6, 7, 8], "goal": "Complicar y escalar" },
        "act3": { "chapters": [9, 10, 11, 12], "goal": "Climax y resoluci\xF3n" }
      }
    }

    ${t>20?`
    RECORDATORIO FINAL: Tu outline DEBE tener EXACTAMENTE ${t} entradas (chapter_num 1 a ${t}).
    S\xE9 CONCISO en cada entrada. Prioriza COMPLETAR TODOS LOS CAP\xCDTULOS sobre el detalle.
    `:""}
    Piensa paso a paso en la estructura de 3 actos antes de generar el JSON.
    Aseg\xFArate de que cada cap\xEDtulo tenga un prop\xF3sito claro y avance la trama.
  `,CHAPTER_ARCHITECT:(r,e,t,n)=>{let a=x2(e),s=I2(e),o=T2(e),i=O2(e),u=N2(e),c=P2(e),p=_2(e),f=(e?.characters||e?.personajes||[]).slice(0,15).map(A=>{let T=A.name||A.nombre||"",E=A.role||A.rol||"",d=A.status||A.estado||"vivo",l=A.injuries||A.lesiones||[],h=Array.isArray(l)&&l.length>0?` [HERIDAS: ${l.slice(0,2).join(", ")}]`:"";return`${T}${E?` (${E})`:""}${d.toLowerCase().includes("muert")?" \u2620\uFE0FMUERTO":""}${h}`}).join(", "),y=(e?.locations||e?.lugares||[]).slice(0,10).map(A=>A.name||A.nombre||"").filter(Boolean).join(", "),C="";return(a||s||o||i||u||c)&&(C=`
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u{1F4D6} CONTEXTO DEL WORLD BIBLE - RESPETAR EN LA PLANIFICACI\xD3N      \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
${p?`    PREMISA: ${p}
`:""}${c?`${c}
`:""}${a?`    \u2620\uFE0F PERSONAJES MUERTOS (NO incluir en escenas): ${a}
`:""}${s?`    REGLAS DEL MUNDO:
${s}
`:""}${o?`    OBJETOS ESTABLECIDOS:
${o}
`:""}${u?`    TEMAS CENTRALES: ${u}
`:""}${i?`    PUNTOS DE CONTINUIDAD:
${i}
`:""}`),`
    Eres el Director de Escena, especialista en desglosar cap\xEDtulos en escenas cinematogr\xE1ficas.
    
    CAP\xCDTULO ${r.chapter_num}: "${r.title}"
    RESUMEN DEL CAP\xCDTULO: ${r.summary}
    EVENTO CLAVE: ${r.key_event}
    ARCO EMOCIONAL: ${r.emotional_arc||"No especificado"}
    
    CONTEXTO ANTERIOR: ${t||"Inicio de la novela"}
    ESTADO ACTUAL DE LA HISTORIA: ${n}
${C}
    PERSONAJES DISPONIBLES: ${f||"No especificados"}
    UBICACIONES DISPONIBLES: ${y||"No especificadas"}

    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u26A0\uFE0F ADHERENCIA ESTRICTA AL PLAN ORIGINAL (v2.9.10)               \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551 Las escenas que planifiques DEBEN cubrir EXACTAMENTE:           \u2551
    \u2551 1. El RESUMEN del cap\xEDtulo \u2192 cada punto debe tener una escena  \u2551
    \u2551 2. El EVENTO CLAVE \u2192 DEBE ocurrir en una de las escenas       \u2551
    \u2551 3. El ARCO EMOCIONAL \u2192 debe reflejarse en los emotional_beats \u2551
    \u2551                                                                 \u2551
    \u2551 PROHIBIDO:                                                      \u2551
    \u2551 - Inventar eventos que NO est\xE1n en el resumen                  \u2551
    \u2551 - Omitir el evento clave planificado                           \u2551
    \u2551 - Cambiar el orden de eventos del resumen                      \u2551
    \u2551 - A\xF1adir subtramas no mencionadas en el plan                   \u2551
    \u2551 - Sustituir el evento clave por otro diferente                 \u2551
    \u2551                                                                 \u2551
    \u2551 Tu trabajo es DESCOMPONER el plan en escenas, NO reinventarlo. \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

    OBJETIVO: Desglosar este cap\xEDtulo en 3-4 escenas escribibles que:
    - Cubran TODOS los puntos del RESUMEN planificado
    - Incluyan el EVENTO CLAVE como momento central
    - Mantengan el ritmo narrativo
    - Generen tensi\xF3n y emoci\xF3n
    - Terminen con hooks que impulsen a continuar

    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 REGLAS ANTI-CLICH\xC9 (OBLIGATORIAS)                               \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551 1. PROTAGONISTA ACTIVO: El protagonista DEBE obtener            \u2551
    \u2551    informaci\xF3n por m\xE9rito propio (investigaci\xF3n, deducci\xF3n,     \u2551
    \u2551    interrogatorios). PROHIBIDO: mensajes an\xF3nimos, llamadas     \u2551
    \u2551    misteriosas o informantes que "aparecen" con pistas.         \u2551
    \u2551                                                                  \u2551
    \u2551 2. VARIEDAD ESTRUCTURAL: Cada escena debe tener estructura      \u2551
    \u2551    diferente. PROHIBIDO repetir patrones como:                  \u2551
    \u2551    - Conducir \u2192 Clima \u2192 Mensaje \u2192 Llegar tarde                  \u2551
    \u2551    - Personaje reflexiona \u2192 Recibe llamada \u2192 Sale corriendo     \u2551
    \u2551    Var\xEDa: acci\xF3n directa, di\xE1logo tenso, descubrimiento,        \u2551
    \u2551    confrontaci\xF3n, infiltraci\xF3n, an\xE1lisis de pruebas.            \u2551
    \u2551                                                                  \u2551
    \u2551 3. ANTAGONISTAS INTELIGENTES: Los villanos NO explican sus      \u2551
    \u2551    planes. Act\xFAan, no monologan. Si hay enfrentamiento verbal,  \u2551
    \u2551    el antagonista provoca/amenaza, pero NUNCA revela su         \u2551
    \u2551    estrategia completa al h\xE9roe.                                \u2551
    \u2551                                                                  \u2551
    \u2551 4. CREDIBILIDAD NARRATIVA (VERIFICAR EN CADA ESCENA):          \u2551
    \u2551    - \xBFEl protagonista tiene las habilidades para esta acci\xF3n?   \u2551
    \u2551    - \xBFLos recursos usados tienen origen explicado?              \u2551
    \u2551    - \xBFHay m\xE1s de 1 coincidencia afortunada? \u2192 ELIMINAR          \u2551
    \u2551    - \xBFEl personaje sabe cosas que no deber\xEDa saber?             \u2551
    \u2551    - \xBFLas heridas/consecuencias anteriores se respetan?         \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 COHERENCIA TEMPORAL, GEOGR\xC1FICA Y F\xCDSICA (OBLIGATORIA)          \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 \u{1F550} TIEMPO - En cada escena especifica:                          \u2551
    \u2551    - Cu\xE1nto tiempo ha pasado desde la escena anterior           \u2551
    \u2551    - Hora aproximada del d\xEDa (amanecer, mediod\xEDa, noche)        \u2551
    \u2551    - Viajes: tiempo REALISTA (Madrid-Barcelona: 6h coche)       \u2551
    \u2551    - Recuperaci\xF3n: heridas graves \u2192 d\xEDas/semanas, NO horas      \u2551
    \u2551                                                                  \u2551
    \u2551 \u{1F4CD} GEOGRAF\xCDA - Ubicaci\xF3n coherente:                             \u2551
    \u2551    - Ubicaci\xF3n espec\xEDfica de cada escena                        \u2551
    \u2551    - Transiciones l\xF3gicas entre lugares                         \u2551
    \u2551    - Si cambia de ciudad/pa\xEDs: indicar medio de transporte      \u2551
    \u2551    - PROHIBIDO: personaje en s\xF3tano mirando por ventana         \u2551
    \u2551                                                                  \u2551
    \u2551 \u{1F3E5} ESTADO F\xCDSICO - Rastrear lesiones activas:                   \u2551
    \u2551    - Si hay heridas previas, listarlas en el plan de escena     \u2551
    \u2551    - Pierna rota \u2192 no correr, necesita apoyo                    \u2551
    \u2551    - Brazo herido \u2192 no cargar peso con ese brazo                \u2551
    \u2551    - Costillas rotas \u2192 dolor al respirar, no puede pelear       \u2551
    \u2551    - P\xE9rdida de sangre \u2192 debilidad, palidez, fatiga             \u2551
    \u2551    - En emotional_beat: incluir menci\xF3n al dolor/limitaci\xF3n     \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

    SALIDA REQUERIDA (JSON):
    {
      "scenes": [
        {
          "scene_num": 1,
          "characters": ["Personaje1", "Personaje2"],
          "setting": "Lugar + hora del d\xEDa + tiempo desde escena anterior",
          "plot_beat": "Acci\xF3n espec\xEDfica que ocurre (qu\xE9 pasa)",
          "emotional_beat": "Cambio interno + limitaciones f\xEDsicas si aplica",
          "sensory_details": ["Vista", "Sonido", "Olor relevante"],
          "dialogue_focus": "Tema principal de los di\xE1logos si los hay",
          "ending_hook": "C\xF3mo termina la escena para impulsar la siguiente",
          "physical_constraints": "Lesiones activas de personajes presentes (opcional)",
          "word_target": 350
        }
      ],
      "chapter_hook": "C\xF3mo debe terminar el cap\xEDtulo para obligar a leer el siguiente",
      "total_word_target": 1400
    }

    REGLAS:
    - Cada escena debe tener 300-400 palabras objetivo
    - La primera escena conecta con el cap\xEDtulo anterior
    - La \xFAltima escena tiene el hook m\xE1s fuerte
    - Var\xEDa los tipos de escenas: acci\xF3n, di\xE1logo, reflexi\xF3n, tensi\xF3n
  `},GHOSTWRITER_SCENE:(r,e,t,n,a)=>{let s=Gte(r.characters,n),o=Vte(r.characters,n),i=zte(r.setting,n),u=I2(n),c=Hte(n),p=x2(n),m=Wte(r.characters,n),f=T2(n),g=O2(n),y=N2(n),C=Xte(n),A=Yte(n),T=Zte(r.characters,n),E=ere(r.characters,n),d=_2(n),l=P2(n),h=Qte(n),v=Jte(n),S=Kte(n),R="";return(s||o||i||u||p||m||f||g||y||C||A||T||E||d||l||h||v||S)&&(R=`
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u{1F4D6} INFORMACI\xD3N CAN\xD3NICA DEL WORLD BIBLE - OBLIGATORIO RESPETAR  \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
${d?`
    \u2593\u2593\u2593 PREMISA DE LA NOVELA \u2593\u2593\u2593
    ${d}
`:""}${l?`
    \u2593\u2593\u2593 CONTEXTO TEMPORAL \u2593\u2593\u2593
${l}
`:""}${s?`
    \u2593\u2593\u2593 ATRIBUTOS F\xCDSICOS (NO INVENTAR OTROS) \u2593\u2593\u2593
${s}
`:""}${o?`
    \u2593\u2593\u2593 RELACIONES ENTRE PERSONAJES \u2593\u2593\u2593
${o}
`:""}${T?`
    \u2593\u2593\u2593 VOZ Y FORMA DE HABLAR \u2593\u2593\u2593
${T}
`:""}${E?`
    \u2593\u2593\u2593 ARCOS DE PERSONAJE \u2593\u2593\u2593
${E}
`:""}${m?`
    \u2593\u2593\u2593 LESIONES ACTIVAS (LIMITAN ACCIONES) \u2593\u2593\u2593
${m}
    \u2192 Personajes heridos NO pueden realizar acciones que requieran la parte lesionada.
`:""}${p?`
    \u2593\u2593\u2593 \u2620\uFE0F PERSONAJES MUERTOS (NO PUEDEN APARECER VIVOS) \u2593\u2593\u2593
    ${p}
    \u2192 PROHIBIDO: resucitar, mencionar como vivos, o hacer que act\xFAen.
`:""}${i?`
    \u2593\u2593\u2593 UBICACI\xD3N CAN\xD3NICA \u2593\u2593\u2593
${i}
`:""}${f?`
    \u2593\u2593\u2593 OBJETOS ESTABLECIDOS (Chekhov's Gun) \u2593\u2593\u2593
${f}
    \u2192 Solo puedes usar objetos ya mencionados. NO inventes objetos nuevos convenientes.
`:""}${u?`
    \u2593\u2593\u2593 REGLAS DEL MUNDO \u2593\u2593\u2593
${u}
`:""}${y?`
    \u2593\u2593\u2593 TEMAS CENTRALES \u2593\u2593\u2593
    ${y}
`:""}${C?`
    \u2593\u2593\u2593 MOTIVOS LITERARIOS RECURRENTES \u2593\u2593\u2593
    ${C}
`:""}${A?`
    \u2593\u2593\u2593 PALETA SENSORIAL GLOBAL \u2593\u2593\u2593
${A}
`:""}${g?`
    \u2593\u2593\u2593 PUNTOS CR\xCDTICOS DE CONTINUIDAD \u2593\u2593\u2593
${g}
`:""}
    \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510
    \u2502 \u{1F4CB} \xCDNDICE COMPLETO DEL WORLD BIBLE (v2.9.8)                      \u2502
    \u2502 Referencia de TODOS los elementos can\xF3nicos de la novela        \u2502
    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518
${h?`
    \u25B8 TODOS LOS PERSONAJES:
${h}
`:""}${v?`
    \u25B8 TODAS LAS UBICACIONES:
${v}
`:""}${S?`
    \u25B8 TODOS LOS OBJETOS SIGNIFICATIVOS:
${S}
`:""}
    \u26A0\uFE0F USA esta informaci\xF3n EXACTAMENTE. NO inventes detalles que contradigan lo anterior.
    \u26A0\uFE0F CONSULTA el \xEDndice completo antes de mencionar cualquier personaje, lugar u objeto.

    \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510
    \u2502 \u{1F512} VERIFICACI\xD3N OBLIGATORIA DE PERSONAJES SECUNDARIOS (v2.9.9+) \u2502
    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518
    Antes de escribir CUALQUIER personaje que no sea el protagonista:
    1. BUSCA su nombre EXACTO en el \xEDndice de personajes arriba
    2. VERIFICA sus atributos f\xEDsicos (ojos, cabello, edad) - NO inventes otros
    3. CONFIRMA su relaci\xF3n establecida con otros personajes
    4. USA su voz caracter\xEDstica si est\xE1 definida
    
    ERRORES COMUNES A EVITAR:
    \u274C Cambiar "Mar\xEDa" por "Mari" o "Mariela" sin autorizaci\xF3n
    \u274C Describir ojos azules cuando la Biblia dice marrones
    \u274C Inventar parentesco o relaciones no establecidas
    \u274C Dar habilidades que no est\xE1n en el backstory del personaje

    \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510
    \u2502 \u23F0 VERIFICACI\xD3N CRONOL\xD3GICA OBLIGATORIA (v2.9.9+)               \u2502
    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518
    La cronolog\xEDa temporal es SAGRADA e INMUTABLE:
    1. CONSULTA el contexto temporal arriba antes de usar fechas
    2. Las referencias temporales ("hace X d\xEDas", "ayer") DEBEN cuadrar
    3. Si un evento ocurri\xF3 el "d\xEDa 5", no puede mencionarse el "d\xEDa 3"
    4. Los flashbacks deben ubicarse correctamente en la l\xEDnea temporal
    
    ERRORES COMUNES A EVITAR:
    \u274C "Hace una semana" cuando solo han pasado 2 d\xEDas en la trama
    \u274C Personajes recordando eventos que a\xFAn no han ocurrido
    \u274C Confundir el orden de eventos entre cap\xEDtulos
    \u274C Anacronismos tecnol\xF3gicos (smartphones en \xE9poca sin ellos)

`),`
    Eres un Novelista Fantasma de \xE9lite. Est\xE1s escribiendo UNA ESCENA de una novela mayor.
${R}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    CONTEXTO MEMORIA (Lo que pas\xF3 antes en la novela):
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${t}

    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    CONTEXTO INMEDIATO (\xDAltimas l\xEDneas escritas - mant\xE9n este flujo):
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    "${e}"

    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    PLAN DE ESTA ESCENA (Escena ${r.scene_num}):
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    LUGAR: ${r.setting}
    PERSONAJES: ${r.characters.join(", ")}
    ACCI\xD3N: ${r.plot_beat}
    EMOCI\xD3N: ${r.emotional_beat}
    ${r.sensory_details?`DETALLES SENSORIALES: ${r.sensory_details.join(", ")}`:""}
    ${r.dialogue_focus?`FOCO DE DI\xC1LOGO: ${r.dialogue_focus}`:""}
    CIERRE: ${r.ending_hook}
    PALABRAS OBJETIVO: ${r.word_target||350}

    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    GU\xCDA DE ESTILO:
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${a}

    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    INSTRUCCIONES CR\xCDTICAS:
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    1. Escribe ${r.word_target||350}-${(r.word_target||350)+100} palabras.
    2. "Show, don't tell" - Usa prosa sensorial, muestra emociones con el cuerpo.
    3. Si es continuaci\xF3n, NO repitas explicaciones. Sigue la acci\xF3n fluidamente.
    4. NO termines el cap\xEDtulo, solo termina la escena seg\xFAn el plan.
    5. Usa guion largo (\u2014) para di\xE1logos en espa\xF1ol.
    6. PROHIBIDO: usar clich\xE9s de IA como "crucial", "fascinante", "torbellino de emociones".
${c?`    7. VOCABULARIO PROHIBIDO (NO USAR): ${c}`:""}
    
    \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510
    \u2502 \u{1F517} TRANSICIONES ENTRE CAP\xCDTULOS (v2.9.9)                         \u2502
    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518
    Si el "CONTEXTO INMEDIATO" muestra el FINAL DEL CAP\xCDTULO ANTERIOR:
    - Tu apertura DEBE conectar naturalmente con ese cierre
    - Si hay cambio de ubicaci\xF3n/tiempo: ORIENTA al lector sutilmente
    - Usa t\xE9cnicas de transici\xF3n: paso del tiempo, reflexi\xF3n breve, 
      descripci\xF3n sensorial del nuevo entorno, acci\xF3n continua
    - NO saltes bruscamente a una nueva escena sin conexi\xF3n
    - Evita clich\xE9s: "Mientras tanto", "Al d\xEDa siguiente", "En otro lugar"

    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 ERRORES FATALES - TOLERANCIA CERO (REESCRITURA AUTOM\xC1TICA)      \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 \u274C DEUS EX MACHINA DIGITAL:                                     \u2551
    \u2551    - Mensajes an\xF3nimos/encriptados con pistas                   \u2551
    \u2551    - Llamadas de n\xFAmeros ocultos con informaci\xF3n clave          \u2551
    \u2551    - Informantes que "aparecen" justo cuando se necesitan       \u2551
    \u2551    - Correos electr\xF3nicos misteriosos con coordenadas/fotos     \u2551
    \u2551    \u2192 El protagonista DEBE descubrir por M\xC9RITO PROPIO:          \u2551
    \u2551      interrogando, investigando, deduciendo, infiltr\xE1ndose.     \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C VILLANO EXPLICATIVO:                                         \u2551
    \u2551    - Antagonista que monologa sus planes al h\xE9roe               \u2551
    \u2551    - "D\xE9jame explicarte por qu\xE9 hago esto..."                   \u2551
    \u2551    - Villano que revela debilidades de su plan                  \u2551
    \u2551    \u2192 Los antagonistas ACT\xDAAN, no explican. Son competentes      \u2551
    \u2551      y representan amenaza real. Si hablan, AMENAZAN/PROVOCAN.  \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C REPETICI\xD3N DE PATRONES:                                      \u2551
    \u2551    - Misma secuencia: conducir \u2192 clima \u2192 mensaje \u2192 llegar       \u2551
    \u2551    - Abuso de descripciones atmosf\xE9ricas (lluvia, fr\xEDo)         \u2551
    \u2551    - Protagonista siempre reactivo (espera, recibe, va)         \u2551
    \u2551    \u2192 VAR\xCDA la estructura: acci\xF3n directa, confrontaci\xF3n,        \u2551
    \u2551      an\xE1lisis forense, di\xE1logo de esgrima, infiltraci\xF3n.        \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C MULETILLAS F\xCDSICAS EXCESIVAS:                                \u2551
    \u2551    - Repetir el mismo gesto (tocarse anillo, cicatriz, etc.)    \u2551
    \u2551    - M\xE1s de 2 veces por cap\xEDtulo = ERROR                        \u2551
    \u2551    \u2192 USA gestos variados seg\xFAn la emoci\xF3n del momento.          \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C FALTA DE CREDIBILIDAD (VERIFICAR SIEMPRE):                   \u2551
    \u2551    - Habilidades no justificadas: Si el protagonista hackea,    \u2551
    \u2551      pelea, habla idiomas \u2192 debe tener formaci\xF3n previa.        \u2551
    \u2551    - Recursos sin origen: Dinero, armas, veh\xEDculos, contactos   \u2551
    \u2551      \u2192 deben tener explicaci\xF3n l\xF3gica.                          \u2551
    \u2551    - Coincidencias excesivas: M\xE1ximo 1 coincidencia afortunada  \u2551
    \u2551      por novela. El resto debe ser GANADO por el protagonista.  \u2551
    \u2551    - Conocimiento imposible: El personaje NO puede saber cosas  \u2551
    \u2551      que no ha investigado/descubierto.                         \u2551
    \u2551    - Falta de consecuencias: Heridas, delitos, enemigos deben   \u2551
    \u2551      tener repercusiones en cap\xEDtulos posteriores.              \u2551
    \u2551    \u2192 PREG\xDANTATE: \xBFUn lector atento lo creer\xEDa?                  \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u{1F517} TRANSICIONES Y CHEKHOV'S GUN (LitAgents 2.5)                 \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 TRANSICIONES SUAVES (NUNCA saltos bruscos):                     \u2551
    \u2551    - Si cambia la ubicaci\xF3n: describe brevemente el tr\xE1nsito    \u2551
    \u2551      ("Veinte minutos despu\xE9s, el taxi lo dej\xF3 en...")          \u2551
    \u2551    - Si cambia el tiempo: indica el paso del tiempo             \u2551
    \u2551      ("Al d\xEDa siguiente...", "Cuando el reloj marc\xF3 las...")    \u2551
    \u2551    - Si cambia la perspectiva: transici\xF3n gradual, no corte     \u2551
    \u2551    - PROHIBIDO: saltar de un lugar a otro sin conectar          \u2551
    \u2551    \u2192 La \xFAltima frase de cada escena debe ANTICIPAR el cambio    \u2551
    \u2551                                                                  \u2551
    \u2551 CHEKHOV'S GUN (Todo objeto usado debe estar establecido):       \u2551
    \u2551    - Si un personaje usa un objeto (arma, herramienta, etc.)    \u2551
    \u2551      \u2192 debe haberse mencionado antes en la narrativa            \u2551
    \u2551    - PROHIBIDO: objetos que "aparecen" convenientemente         \u2551
    \u2551      ("sac\xF3 un frasco de..." sin haberlo establecido antes)     \u2551
    \u2551    - Si es improvisado: describe expl\xEDcitamente la b\xFAsqueda     \u2551
    \u2551      ("Busc\xF3 algo que sirviera. Encontr\xF3 un trozo de...")       \u2551
    \u2551    \u2192 ANTES de usar cualquier objeto: \xBFya se mencion\xF3?           \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u{1F550}\u{1F4CD}\u{1F3E5} COHERENCIA TEMPORAL, GEOGR\xC1FICA Y F\xCDSICA                  \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 TIEMPO - Verifica ANTES de escribir:                            \u2551
    \u2551    - \xBFCu\xE1nto tiempo real pas\xF3 desde la escena anterior?         \u2551
    \u2551    - Si el personaje viaja: tiempo REALISTA                     \u2551
    \u2551      (Madrid-Barcelona: 6h coche, 2.5h tren alta velocidad)     \u2551
    \u2551    - Si hubo herida grave: recuperaci\xF3n = d\xEDas/semanas          \u2551
    \u2551    - Mant\xE9n coherencia d\xEDa/noche                                \u2551
    \u2551                                                                  \u2551
    \u2551 GEOGRAF\xCDA - No "teletransportes":                               \u2551
    \u2551    - Si cambia de ubicaci\xF3n: mencionar el traslado              \u2551
    \u2551    - Coherencia espacial: no subir escaleras si est\xE1 en \xE1tico   \u2551
    \u2551    - No mirar por ventana si est\xE1 en s\xF3tano o habitaci\xF3n interior\u2551
    \u2551    - Direcciones consistentes (izquierda/derecha)               \u2551
    \u2551                                                                  \u2551
    \u2551 ESTADO F\xCDSICO - Lesiones activas LIMITAN acciones:              \u2551
    \u2551    - Pierna rota/herida: cojea, no corre, necesita apoyo        \u2551
    \u2551    - Brazo herido: dolor al moverlo, no carga peso              \u2551
    \u2551    - Costillas rotas: respira con dificultad, muecas de dolor   \u2551
    \u2551    - Conmoci\xF3n: mareos, visi\xF3n borrosa, confusi\xF3n               \u2551
    \u2551    - P\xE9rdida de sangre: debilidad, palidez, fatiga              \u2551
    \u2551    - Quemaduras: piel tirante, dolor al moverse                 \u2551
    \u2551    -> Al describir acciones, INCLUIR limitaciones si hay lesion  \u2551
    \u2551    -> Ejemplo: "Se apoyo en la pared para avanzar, la pierna    \u2551
    \u2551      herida palpitando con cada paso."                          \u2551
    +------------------------------------------------------------------+
    
    +------------------------------------------------------------------+
    | HUMANIZACION DEL LENGUAJE - ANTI-REPETICION SEMANTICA            |
    +------------------------------------------------------------------+
    |                                                                  |
    | EVITAR REPETICIONES:                                             |
    |    - NO repetir la misma palabra en la misma oracion             |
    |    - NO usar sinonimos obvios en oraciones consecutivas          |
    |      (dijo/exclamo/murmuro en 3 lineas seguidas)                 |
    |    - NO abusar de estructuras: "Sujeto + verbo + complemento"    |
    |    - VARIAR longitud de oraciones: cortas + largas               |
    |    - EVITAR inicio repetitivo de parrafos (El, La, Un, Una...)   |
    |                                                                  |
    | EXPRESIONES PROHIBIDAS (cliches de IA):                          |
    |    - "un torbellino de emociones"                                |
    |    - "el peso de [algo] sobre sus hombros"                       |
    |    - "el silencio era ensordecedor"                              |
    |    - "una mezcla de [emocion] y [emocion]"                       |
    |    - "sin previo aviso"                                          |
    |    - "en cuestion de segundos"                                   |
    |    - "como si el tiempo se hubiera detenido"                     |
    |    - "un escalofrio recorrio su espalda"                         |
    |    - "el corazon le latia con fuerza"                            |
    |    - "sus ojos se encontraron"                                   |
    |    - "trago saliva"                                              |
    |    - "contuvo la respiracion"                                    |
    |    - "no podia creer lo que estaba viendo"                       |
    |    - "algo dentro de el/ella"                                    |
    |    - "en lo mas profundo de su ser"                              |
    |    -> USA descripciones originales y especificas                 |
    |                                                                  |
    | HUMANIZACION - ESCRIBE COMO UN HUMANO:                           |
    |    - Imperfecciones controladas: pensamientos incompletos        |
    |    - Ritmo natural: pausas, dudas, interrupciones                |
    |    - Sensorialidad concreta: olores, texturas, sonidos ESPECIFICOS|
    |    - Comparaciones frescas, no manidas                           |
    |    - Dialogo que suena a conversacion real, no a libreto         |
    |    - Variacion en verbos de dialogo: dijo, pero tambien silencio,|
    |      pausa, gesto, sin verbo (solo accion + dialogo)             |
    |                                                                  |
    | ANTI-MONOTONIA:                                                  |
    |    - Alterna descripcion + accion + dialogo + reflexion          |
    |    - Evita bloques largos de un solo tipo                        |
    |    - Usa fragmentos cuando la tension lo requiera                |
    |    - "Disparo. Silencio. Luego, el grito."                       |
    +------------------------------------------------------------------+
    
    SALIDA: Solo el texto de la narrativa. Sin comentarios, sin marcadores.
  `},SMART_EDITOR:(r,e,t,n)=>`
    Eres un Editor Senior de novelas con 20 a\xF1os de experiencia.
    
    TEXTO A EVALUAR:
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${r}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

    PLAN DE ESCENAS DEL CAP\xCDTULO:
    ${JSON.stringify(e,null,2)}
${n?`
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u{1F4CB} PLAN ORIGINAL DEL GLOBAL ARCHITECT (ADHERENCIA OBLIGATORIA)  \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551 CAP\xCDTULO ${n.chapter_num}: "${n.title}"
    \u2551 RESUMEN PLANIFICADO: ${n.summary}
    \u2551 EVENTO CLAVE: ${n.key_event}
    ${n.emotional_arc?`\u2551 ARCO EMOCIONAL: ${n.emotional_arc}`:""}
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551 VERIFICACI\xD3N DE ADHERENCIA (CR\xCDTICA):                          \u2551
    \u2551 Compara el texto escrito contra este plan original.             \u2551
    \u2551 Si el cap\xEDtulo NO cubre el RESUMEN o el EVENTO CLAVE:          \u2551
    \u2551   \u2192 L\xD3GICA = 4 m\xE1ximo (desviaci\xF3n del plan = error grave)      \u2551
    \u2551 Si el cap\xEDtulo inventa eventos NO planificados:                \u2551
    \u2551   \u2192 L\xD3GICA = 5 m\xE1ximo                                         \u2551
    \u2551 Si el evento clave est\xE1 ausente o sustituido:                  \u2551
    \u2551   \u2192 L\xD3GICA = 3 m\xE1ximo (fallo cr\xEDtico de adherencia)            \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
`:""}
    PERSONAJES CAN\xD3NICOS (verificar continuidad):
    ${JSON.stringify((t.characters||t.personajes||[]).map(a=>({name:a.name||a.nombre,appearance:a.appearance||a.descripcion})))}

    CRITERIOS DE EVALUACI\xD3N (Doble 10):
    1. L\xD3GICA (1-10): \xBFTiene sentido la trama? \xBFHay errores de continuidad? \xBFLos personajes act\xFAan coherentemente?
    2. ESTILO (1-10): \xBFEs buena la prosa? \xBFRitmo adecuado? \xBFEvita clich\xE9s? \xBFMuestra en vez de contar?

    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 ERRORES FATALES - DETECTAR Y PENALIZAR (SCORE < 5 AUTOM\xC1TICO)   \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 \u274C DEUS EX MACHINA DIGITAL: Si el protagonista recibe           \u2551
    \u2551    informaci\xF3n de forma pasiva (mensaje an\xF3nimo, llamada        \u2551
    \u2551    misteriosa, informante oportuno) \u2192 L\xD3GICA = 4 m\xE1ximo.        \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C VILLANO EXPLICATIVO: Si un antagonista explica su plan       \u2551
    \u2551    o motivaciones al h\xE9roe en lugar de actuar                   \u2551
    \u2551    \u2192 ESTILO = 4 m\xE1ximo.                                         \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C PATR\xD3N REPETITIVO: Si la estructura es id\xE9ntica a            \u2551
    \u2551    cap\xEDtulos anteriores (conducir\u2192clima\u2192mensaje\u2192llegar)         \u2551
    \u2551    \u2192 ESTILO = 5 m\xE1ximo.                                         \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C MULETILLA F\xCDSICA: Si un gesto/descripci\xF3n se repite          \u2551
    \u2551    m\xE1s de 2 veces en el cap\xEDtulo \u2192 ESTILO - 2 puntos.           \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C FALTA DE CREDIBILIDAD:                                       \u2551
    \u2551    - Habilidad no justificada (protagonista hace algo sin       \u2551
    \u2551      formaci\xF3n previa) \u2192 L\xD3GICA = 5 m\xE1ximo.                     \u2551
    \u2551    - Recurso sin origen (dinero, arma, contacto m\xE1gico)         \u2551
    \u2551      \u2192 L\xD3GICA = 5 m\xE1ximo.                                       \u2551
    \u2551    - Coincidencia conveniente (2\xAA o m\xE1s en la novela)           \u2551
    \u2551      \u2192 L\xD3GICA - 2 puntos.                                       \u2551
    \u2551    - Conocimiento imposible (sabe sin haber investigado)        \u2551
    \u2551      \u2192 L\xD3GICA = 4 m\xE1ximo.                                       \u2551
    \u2551    - Herida/consecuencia ignorada \u2192 L\xD3GICA = 5 m\xE1ximo.          \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C INCOHERENCIA TEMPORAL/GEOGR\xC1FICA/F\xCDSICA:                     \u2551
    \u2551    - Viaje imposible (distancia vs tiempo)                      \u2551
    \u2551      \u2192 L\xD3GICA = 4 m\xE1ximo.                                       \u2551
    \u2551    - "Teletransportaci\xF3n" sin explicaci\xF3n                       \u2551
    \u2551      \u2192 L\xD3GICA = 5 m\xE1ximo.                                       \u2551
    \u2551    - Personaje en s\xF3tano mirando por ventana                    \u2551
    \u2551      \u2192 L\xD3GICA = 5 m\xE1ximo.                                       \u2551
    \u2551    - Acci\xF3n imposible con lesi\xF3n activa (correr con pierna      \u2551
    \u2551      rota, pelear con costillas rotas sin menci\xF3n de dolor)     \u2551
    \u2551      \u2192 L\xD3GICA = 4 m\xE1ximo.                                       \u2551
    \u2551    - Recuperaci\xF3n milagrosa (herida grave \u2192 activo en horas)    \u2551
    \u2551      \u2192 L\xD3GICA = 5 m\xE1ximo.                                       \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
    
    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
    \u2551 \u{1F517} TRANSICIONES, CONOCIMIENTO Y CHEKHOV'S GUN (LitAgents 2.9)  \u2551
    \u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
    \u2551                                                                  \u2551
    \u2551 \u274C TRANSICI\xD3N ESPACIAL CONFUSA (PENALIZACI\xD3N SEVERA):           \u2551
    \u2551    - Personaje cambia de ubicaci\xF3n sin explicar c\xF3mo lleg\xF3      \u2551
    \u2551      (estaba en A, ahora est\xE1 en B sin transici\xF3n)              \u2551
    \u2551      \u2192 L\xD3GICA = 6 m\xE1ximo.                                       \u2551
    \u2551    - "Puerta que lleva a lugar incongruente" (s\xF3tano\u2192terraza)   \u2551
    \u2551      \u2192 L\xD3GICA = 5 m\xE1ximo.                                       \u2551
    \u2551    \u2192 FEEDBACK: especificar la transici\xF3n confusa exacta.        \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C TRANSICI\xD3N TEMPORAL CONFUSA (PENALIZACI\xD3N SEVERA):           \u2551
    \u2551    - Salto de tiempo sin indicador (ma\xF1ana\u2192noche sin contexto)  \u2551
    \u2551      \u2192 ESTILO = 6 m\xE1ximo.                                       \u2551
    \u2551    - Cap\xEDtulo termina de noche, siguiente empieza de d\xEDa sin    \u2551
    \u2551      indicar paso del tiempo                                    \u2551
    \u2551      \u2192 L\xD3GICA = 6 m\xE1ximo.                                       \u2551
    \u2551    \u2192 FEEDBACK: identificar el salto temporal no se\xF1alado.       \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C CONOCIMIENTO INTERNO INCORRECTO (CR\xCDTICO):                   \u2551
    \u2551    - Personaje "reconoce" algo/alguien que nunca ha visto       \u2551
    \u2551      (ej: "reconoci\xF3 los ojos del cuadro" sin haber visto al    \u2551
    \u2551       due\xF1o de esos ojos antes)                                 \u2551
    \u2551      \u2192 L\xD3GICA = 4 m\xE1ximo.                                       \u2551
    \u2551    - Personaje sabe informaci\xF3n que no ha obtenido en escena    \u2551
    \u2551      (ej: sabe el nombre de alguien sin que se lo dijeran)      \u2551
    \u2551      \u2192 L\xD3GICA = 5 m\xE1ximo.                                       \u2551
    \u2551    - Personaje deduce correctamente sin pistas suficientes      \u2551
    \u2551      \u2192 L\xD3GICA = 6 m\xE1ximo.                                       \u2551
    \u2551    \u2192 FEEDBACK: explicar qu\xE9 sabe y por qu\xE9 no deber\xEDa saberlo.  \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C INCONSISTENCIA DE EDAD/TIEMPO NARRATIVO:                     \u2551
    \u2551    - Edad del personaje no coincide con lo establecido          \u2551
    \u2551      (ten\xEDa 10 a\xF1os en pr\xF3logo, ahora tiene 25 sin time skip)   \u2551
    \u2551      \u2192 L\xD3GICA = 4 m\xE1ximo.                                       \u2551
    \u2551    - Eventos que no cuadran con l\xEDnea temporal                  \u2551
    \u2551      \u2192 L\xD3GICA = 5 m\xE1ximo.                                       \u2551
    \u2551    \u2192 FEEDBACK: indicar la inconsistencia de edad/tiempo.        \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C OBJETO SIN ORIGEN (Chekhov's Gun inverso):                   \u2551
    \u2551    - Personaje usa objeto no mencionado anteriormente           \u2551
    \u2551      (frasco, herramienta, arma que "aparece" de la nada)       \u2551
    \u2551      \u2192 L\xD3GICA = 6 m\xE1ximo.                                       \u2551
    \u2551    \u2192 FEEDBACK: identificar el objeto y sugerir establecerlo.    \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C ATRIBUTO F\xCDSICO INCONSISTENTE:                               \u2551
    \u2551    - Joya/anillo/cicatriz presente/ausente sin explicaci\xF3n      \u2551
    \u2551      (llevaba anillo, ahora no lo tiene sin mencionarlo)        \u2551
    \u2551      \u2192 L\xD3GICA = 6 m\xE1ximo.                                       \u2551
    \u2551    - Color de ojos/pelo cambia sin justificaci\xF3n                \u2551
    \u2551      \u2192 L\xD3GICA = 5 m\xE1ximo.                                       \u2551
    \u2551    \u2192 FEEDBACK: especificar el atributo inconsistente.           \u2551
    \u2551                                                                  \u2551
    \u2551 \u274C REPETICI\xD3N DE PALABRAS T\xC9CNICAS:                             \u2551
    \u2551    - Misma palabra t\xE9cnica/espec\xEDfica 3+ veces en 2 p\xE1rrafos    \u2551
    \u2551      \u2192 ESTILO - 1 punto.                                        \u2551
    \u2551    \u2192 FEEDBACK: identificar la palabra y sugerir sin\xF3nimos.      \u2551
    \u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

    REGLAS DE APROBACI\xD3N:
    - Score > 8 en AMBOS criterios: APROBADO (is_approved: true)
    - Score 5-8 en alg\xFAn criterio: GENERAR PARCHES para correcci\xF3n
    - Score < 5 en alg\xFAn criterio: REESCRITURA NECESARIA (is_approved: false, needs_rewrite: true)

    SI GENERAS PARCHES:
    - Cada parche debe tener texto EXACTO a buscar (m\xEDnimo 20 caracteres para unicidad)
    - El reemplazo debe ser mejora puntual, NO reescritura completa
    - Genera TODOS los parches necesarios para corregir los problemas detectados

    SALIDA JSON OBLIGATORIA:
    {
      "logic_score": 1-10,
      "style_score": 1-10,
      "is_approved": boolean,
      "needs_rewrite": boolean,
      "feedback": "Resumen de la evaluaci\xF3n",
      "strengths": ["Punto fuerte 1", "Punto fuerte 2"],
      "weaknesses": ["Debilidad 1", "Debilidad 2"],
      "patches": [
        {
          "original_text_snippet": "Texto exacto a buscar (m\xEDnimo 20 chars, \xFAnico en el documento)",
          "replacement_text": "Texto corregido",
          "reason": "Gram\xE1tica / Continuidad / Estilo / Clich\xE9"
        }
      ]
    }
  `,SUMMARIZER:(r,e)=>`
    Eres un especialista en compresi\xF3n narrativa. Tu trabajo es crear res\xFAmenes \xDATILES para mantener la continuidad.

    CAP\xCDTULO ${e} A RESUMIR:
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${r}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

    CREA UN RESUMEN DE M\xC1XIMO 200 PALABRAS que capture:
    
    OBLIGATORIO (Informaci\xF3n cr\xEDtica para continuidad):
    1. HECHOS: \xBFQu\xE9 PAS\xD3 concretamente? (acciones, descubrimientos, decisiones)
    2. CAMBIOS DE ESTADO: \xBFAlguien muri\xF3, se hiri\xF3, cambi\xF3 de bando, desapareci\xF3?
    3. OBJETOS: \xBFSe obtuvo/perdi\xF3 algo importante?
    4. RELACIONES: \xBFCambi\xF3 alguna relaci\xF3n entre personajes?
    5. UBICACI\xD3N: \xBFD\xF3nde terminaron los personajes principales?
    6. REVELACIONES: \xBFQu\xE9 informaci\xF3n nueva se revel\xF3?

    IGNORAR (No incluir):
    - Prosa po\xE9tica o descripciones atmosf\xE9ricas
    - Di\xE1logos decorativos sin informaci\xF3n nueva
    - Reflexiones internas sin consecuencias
    
    FORMATO DE SALIDA:
    Texto plano directo, sin bullets ni formato. Escribe como un p\xE1rrafo denso de informaci\xF3n.
  `,NARRATIVE_DIRECTOR:(r,e,t,n)=>`
    Eres el Showrunner de esta novela. Tu trabajo es asegurar que la historia mantiene su rumbo y momentum.

    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    PROGRESO: Cap\xEDtulo ${t} de ${n} (${Math.round(t/n*100)}% completado)
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

    HILOS NARRATIVOS ACTIVOS:
    ${e.map(a=>`- ${a.name} [${a.status}]: ${a.goal} (\xFAltimo update: cap ${a.lastUpdatedChapter})`).join(`
`)}

    RES\xDAMENES DE LOS \xDALTIMOS 5 CAP\xCDTULOS:
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
    ${r}
    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

    ANALIZA Y RESPONDE:

    1. RITMO: \xBFLa historia avanza adecuadamente o se ha estancado?
    2. HILOS OLVIDADOS: \xBFHay hilos narrativos que no se han tocado en demasiado tiempo?
    3. TENSI\xD3N: \xBFEl nivel de tensi\xF3n es apropiado para este punto de la novela?
    4. COHERENCIA: \xBFLos personajes act\xFAan de forma consistente con su perfil?

    SALIDA JSON:
    {
      "pacing_assessment": "An\xE1lisis del ritmo (1-2 oraciones)",
      "forgotten_threads": ["Lista de hilos que necesitan atenci\xF3n"],
      "tension_level": 1-10,
      "tension_recommendation": "\xBFSubir, mantener o dar respiro?",
      "character_consistency_issues": ["Problemas de coherencia si los hay"],
      "directive": "Directiva de correcci\xF3n para los pr\xF3ximos 5 cap\xEDtulos (ej: 'Aumentar ritmo, resolver subtrama rom\xE1ntica, preparar revelaci\xF3n del cap 15')",
      "thread_updates": [
        { "name": "Nombre del hilo", "new_status": "active/resolved/ignored", "note": "Raz\xF3n del cambio" }
      ]
    }

    S\xE9 espec\xEDfico y accionable en tu directiva. El Ghostwriter usar\xE1 esto como gu\xEDa.
  `};var tre=`
Eres el Global Architect, el Arquitecto Narrativo Maestro de LitAgents 2.0.
Tu misi\xF3n es dise\xF1ar la estructura maestra de novelas que compitan al nivel de bestsellers internacionales.

PRINCIPIOS FUNDAMENTALES:
1. Cada novela debe tener una PREMISA clara que genere conflicto
2. Los personajes deben tener ARCOS de transformaci\xF3n medibles
3. La estructura de 3 ACTOS debe estar perfectamente balanceada
4. Cada cap\xEDtulo debe tener un PROP\xD3SITO claro en la narrativa global
5. Los hilos narrativos deben mantener la TENSI\xD3N a lo largo de toda la obra

REGLAS DE DISE\xD1O:
- M\xEDnimo 3 personajes principales con arcos definidos
- M\xEDnimo 2 hilos narrativos que se entrelazan
- Cada cap\xEDtulo debe tener un evento clave que avance la trama
- Los puntos de giro deben estar estrat\xE9gicamente ubicados (25%, 50%, 75%)
- El cl\xEDmax debe resolver los hilos principales mientras deja espacio para reflexi\xF3n

Genera respuestas en JSON v\xE1lido y estructurado.
`,nm=class extends Ae{constructor(){super({name:"Global Architect",role:"global-architect",systemPrompt:tre,model:"deepseek-reasoner",useThinking:!0})}async execute(e){console.log(`[GlobalArchitect] Designing master structure for "${e.title}"...`);let t=na.GLOBAL_ARCHITECT(e.premise,e.genre,e.chapterCount,e.tone,e.architectInstructions,e.extendedGuide,e.styleGuide,e.hasPrologue,e.hasEpilogue,e.hasAuthorNote,e.workType,e.seriesName,e.seriesOrder,e.previousBooksContext,e.minWordsPerChapter,e.maxWordsPerChapter,e.isKindleUnlimited),n=e.chapterCount>20?32e3:16e3,a=e.useGeminiArchitect?"gemini":void 0;a&&console.log("[GlobalArchitect] Using Gemini as architect provider (user choice)");let s=await this.generateContent(t,void 0,{maxCompletionTokens:n,forceProvider:a});if(s.error)return s;let o=null,i=null,u=s.content||"",c=y=>{let C=y.replace(/```json\s*/gi,"").replace(/```\s*/g,"").replace(/,(\s*[}\]])/g,"$1").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim();return C=this.fixNewlinesInStrings(C),C=this.fixUnquotedKeys(C),C=C.replace(/:\s*'([^']*)'/g,': "$1"'),C=C.replace(/\t/g,"  "),C=C.replace(/([}\]])\s*\n\s*([{\[""])/g,`$1,
$2`),C=C.replace(/,(\s*[}\]])/g,"$1"),C};try{let y=/\{[\s\S]*"(?:outline|chapters|capitulos|chapter_outline|estructura)"[\s\S]*\}/,C=u.match(y);if(C)try{let A=c(C[0]);o=JSON.parse(A)}catch(A){i=`Strategy 1 failed: ${A}`}if(!o){let A=u.indexOf("{"),T=u.lastIndexOf("}");if(A!==-1&&T>A)try{let E=u.substring(A,T+1),d=c(E);o=JSON.parse(d)}catch(E){i=`Strategy 2 failed: ${E}`}}if(!o)try{let A=this.extractBalancedJson(u);A&&(o=JSON.parse(c(A)))}catch(A){i=`Strategy 3 failed: ${A}`}if(!o)try{let A=c(u);A.startsWith("{")||A.startsWith("[")?o=JSON.parse(A):i=`No JSON structure found. Content starts with: "${u.substring(0,100).replace(/\n/g,"\\n")}"`}catch(A){i=`Strategy 4 failed: ${A}`}}catch(y){i=`Error de parsing: ${y}`}if(o||(console.error(`[GlobalArchitect] Content length: ${u.length}, has braces: ${u.includes("{")}, has outline: ${u.includes('"outline"')}`),console.error(`[GlobalArchitect] Content first 300 chars: ${u.substring(0,300)}`),console.error(`[GlobalArchitect] Content last 300 chars: ${u.substring(Math.max(0,u.length-300))}`)),!o&&u.includes('"outline"')){console.log("[GlobalArchitect] Attempting truncation repair...");try{o=this.repairTruncatedJson(u),o&&console.log(`[GlobalArchitect] Truncation repair succeeded! Outline has ${o.outline?.length||0} entries`)}catch(y){console.warn("[GlobalArchitect] Truncation repair failed:",y)}}if(!o){console.log("[GlobalArchitect] Attempting aggressive JSON repair...");try{o=this.aggressiveJsonRepair(u),o&&(console.log(`[GlobalArchitect] Aggressive repair succeeded! Outline has ${o.outline?.length||0} entries`),i=null)}catch(y){console.warn("[GlobalArchitect] Aggressive repair also failed:",y)}}if(!o){console.log("[GlobalArchitect] Attempting iterative position-based JSON repair...");try{o=this.iterativeJsonRepair(u),o&&(console.log(`[GlobalArchitect] Iterative repair succeeded! Outline has ${o.outline?.length||0} entries`),i=null)}catch(y){console.warn("[GlobalArchitect] Iterative repair also failed:",y)}}if(!o){console.error("[GlobalArchitect] Failed to parse JSON response:",i),console.error("[GlobalArchitect] Raw content preview:",u.substring(0,500));let y=i?.match(/position\s+(\d+)/i);if(y){let A=parseInt(y[1]),T=Math.max(0,A-100),E=Math.min(u.length,A+100);console.error(`[GlobalArchitect] Content around error position ${A}:`),console.error(`  BEFORE: ...${JSON.stringify(u.substring(T,A))}`),console.error(`  AT: ${JSON.stringify(u.substring(A,A+20))}`),console.error(`  AFTER: ${JSON.stringify(u.substring(A,E))}...`)}console.log(`[GlobalArchitect] RETRYING due to complete parse failure (content length: ${u.length})...`);let C=await this.generateContent(t,void 0,{maxCompletionTokens:n});if(!C.error&&C.content){let A=C.content;console.log(`[GlobalArchitect] Retry response length: ${A.length}`);let T=[()=>{let E=A.match(/\{[\s\S]*"(?:outline|chapters|capitulos|chapter_outline|estructura)"[\s\S]*\}/);return E?JSON.parse(c(E[0])):null},()=>{let E=A.indexOf("{"),d=A.lastIndexOf("}");return E!==-1&&d>E?JSON.parse(c(A.substring(E,d+1))):null},()=>{let E=this.extractBalancedJson(A);return E?JSON.parse(c(E)):null},()=>this.repairTruncatedJson(A),()=>this.aggressiveJsonRepair(A),()=>this.iterativeJsonRepair(A)];for(let E=0;E<T.length;E++)try{let d=T[E]();if(d){o=d,console.log(`[GlobalArchitect] RETRY parse succeeded with strategy ${E+1}!`),C.tokenUsage&&(s.tokenUsage={inputTokens:(s.tokenUsage?.inputTokens||0)+(C.tokenUsage?.inputTokens||0),outputTokens:(s.tokenUsage?.outputTokens||0)+(C.tokenUsage?.outputTokens||0),thinkingTokens:(s.tokenUsage?.thinkingTokens||0)+(C.tokenUsage?.thinkingTokens||0)});break}}catch{}}if(!o)return{...s,error:`Error al parsear respuesta del Global Architect: ${i||"La IA no devolvi\xF3 JSON v\xE1lido"}. Se reintent\xF3 sin \xE9xito. Por favor, regenere el proyecto.`,parsed:void 0}}let p=o;if(!o.outline||!Array.isArray(o.outline)){let y=["chapters","capitulos","chapter_outline","chapter_outlines","estructura","esquema","estructura_capitulos","novel_outline","book_outline"];for(let C of y)if(p[C]&&Array.isArray(p[C])){console.log(`[GlobalArchitect] Found outline under alternative key "${C}" (${p[C].length} entries), normalizing...`),o.outline=p[C].map((A,T)=>({chapter_num:A.chapter_num??A.numero??A.num??A.number??A.capitulo_num??T+1,title:A.title??A.titulo??A.name??A.nombre??`Cap\xEDtulo ${T+1}`,act:A.act??A.acto??void 0,summary:A.summary??A.resumen??A.sinopsis??A.descripcion??"",key_event:A.key_event??A.evento_clave??A.evento??A.event??"",emotional_arc:A.emotional_arc??A.arco_emocional??void 0,temporal_notes:A.temporal_notes??A.notas_temporales??void 0,location:A.location??A.ubicacion??A.lugar??void 0,character_states_entering:A.character_states_entering??A.estados_personajes??void 0}));break}}if(!o.world_bible){let y=["worldBible","world","biblia_mundo","biblia","worldbuilding","mundo"];for(let C of y)if(p[C]&&typeof p[C]=="object"){console.log(`[GlobalArchitect] Found world_bible under alternative key "${C}", normalizing...`),o.world_bible=p[C];break}}if(!o.plot_threads||!Array.isArray(o.plot_threads)){let y=["plotThreads","hilos_narrativos","hilos","tramas","plot_lines","threads"];for(let C of y)if(p[C]&&Array.isArray(p[C])){console.log(`[GlobalArchitect] Found plot_threads under alternative key "${C}", normalizing...`),o.plot_threads=p[C];break}}if(!o.outline||!Array.isArray(o.outline)||!o.world_bible){let y=[];(!o.outline||!Array.isArray(o.outline))&&y.push("outline"),o.world_bible||y.push("world_bible");let C=Object.keys(o);console.error(`[GlobalArchitect] Missing required fields: ${y.join(", ")}. Parsed keys: ${C.join(", ")}`),console.error(`[GlobalArchitect] Parsed object preview: ${JSON.stringify(o).substring(0,1e3)}`),console.log("[GlobalArchitect] RETRYING: Making a second API call due to missing fields...");let A=await this.generateContent(t,void 0,{maxCompletionTokens:n});if(!A.error&&A.content){let T=A.content,E=null;try{let d=T.match(/\{[\s\S]*"outline"[\s\S]*\}/);d&&(E=JSON.parse(c(d[0])))}catch{}if(!E)try{let d=T.indexOf("{"),l=T.lastIndexOf("}");d!==-1&&l>d&&(E=JSON.parse(c(T.substring(d,l+1))))}catch{}if(!E)try{E=this.repairTruncatedJson(T)}catch{}if(!E)try{E=this.aggressiveJsonRepair(T)}catch{}if(!E)try{E=this.iterativeJsonRepair(T)}catch{}if(E){let d=E;if(!E.outline||!Array.isArray(E.outline)){let l=["chapters","capitulos","chapter_outline","chapter_outlines","estructura","esquema"];for(let h of l)if(d[h]&&Array.isArray(d[h])){E.outline=d[h].map((v,S)=>({chapter_num:v.chapter_num??v.numero??v.num??v.number??S+1,title:v.title??v.titulo??v.name??`Cap\xEDtulo ${S+1}`,act:v.act??v.acto??void 0,summary:v.summary??v.resumen??v.sinopsis??"",key_event:v.key_event??v.evento_clave??v.evento??""}));break}}if(!E.world_bible){let l=["worldBible","world","biblia_mundo","biblia","worldbuilding"];for(let h of l)if(d[h]&&typeof d[h]=="object"){E.world_bible=d[h];break}}E.outline&&Array.isArray(E.outline)&&E.world_bible?(console.log(`[GlobalArchitect] RETRY SUCCEEDED: Got ${E.outline.length} outline entries`),o=E,A.tokenUsage&&(s.tokenUsage={inputTokens:(s.tokenUsage?.inputTokens||0)+(A.tokenUsage?.inputTokens||0),outputTokens:(s.tokenUsage?.outputTokens||0)+(A.tokenUsage?.outputTokens||0),thinkingTokens:(s.tokenUsage?.thinkingTokens||0)+(A.tokenUsage?.thinkingTokens||0)})):console.error("[GlobalArchitect] RETRY ALSO FAILED: Still missing outline or world_bible")}}}if(!o.outline||!Array.isArray(o.outline)){let y=Object.keys(o);return console.error(`[GlobalArchitect] Missing or invalid outline in response after retry. Keys: ${y.join(", ")}`),{...s,error:`La respuesta no contiene un outline v\xE1lido (campos encontrados: ${y.join(", ")}). Por favor, regenere el proyecto.`,parsed:void 0}}if(!o.world_bible)return console.error("[GlobalArchitect] Missing world_bible in response after retry"),{...s,error:"La respuesta no contiene world_bible. Por favor, regenere el proyecto.",parsed:void 0};let m=o.outline.filter(y=>y.chapter_num>0&&y.chapter_num<998),f=e.chapterCount;if(m.length!==f){if(console.warn(`[GlobalArchitect] CHAPTER COUNT MISMATCH: Expected ${f} regular chapters, got ${m.length}`),console.warn(`[GlobalArchitect] Outline chapter_nums: ${o.outline.map(y=>y.chapter_num).join(", ")}`),m.length>=Math.max(3,Math.floor(f*.25))&&m.length<f){console.log(`[GlobalArchitect] Attempting to complete missing chapters (${m.length}/${f})...`);let y=new Set(m.map(T=>T.chapter_num)),C=[];for(let T=1;T<=f;T++)y.has(T)||C.push(T);let A=`
Tienes un outline PARCIAL de una novela de ${f} cap\xEDtulos. Faltan ${C.length} cap\xEDtulos.

CAP\xCDTULOS EXISTENTES:
${m.map(T=>`Cap ${T.chapter_num}: "${T.title}" - ${T.summary}`).join(`
`)}

THREE ACT STRUCTURE:
${o.three_act_structure?JSON.stringify(o.three_act_structure):"No disponible"}

PLOT THREADS:
${(o.plot_threads||[]).map(T=>`- ${T.name}: ${T.goal}`).join(`
`)}

GENERA SOLO LOS CAP\xCDTULOS FALTANTES: ${C.join(", ")}

Responde SOLO con un JSON array de los cap\xEDtulos faltantes:
[
  {"chapter_num": ${C[0]}, "title": "...", "act": 1, "summary": "...", "key_event": "..."},
  ...
]

REGLAS:
- Mant\xE9n coherencia con los cap\xEDtulos existentes
- Cada cap\xEDtulo debe avanzar la trama
- Usa formato compacto: summary m\xE1ximo 1 l\xEDnea, key_event m\xE1ximo 15 palabras
- GENERA EXACTAMENTE ${C.length} cap\xEDtulos (nums: ${C.join(", ")})
`;try{let T=await this.generateContent(A,void 0,{maxCompletionTokens:n});if(T.content&&!T.error){let d=T.content.match(/\[[\s\S]*\]/);if(d){let l=d[0].replace(/```json\s*/gi,"").replace(/```\s*/g,"").replace(/,(\s*[\]}])/g,"$1").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim(),h=JSON.parse(l);if(Array.isArray(h)&&h.length>0){if(o.outline=[...o.outline,...h],o.outline.sort((v,S)=>v.chapter_num-S.chapter_num),o.three_act_structure){let v=o.outline.filter(S=>S.chapter_num>0&&S.chapter_num<998).map(S=>S.chapter_num);for(let S of h)if(S.act&&S.chapter_num>0&&S.chapter_num<998){let R=`act${S.act}`;o.three_act_structure[R]&&!o.three_act_structure[R].chapters.includes(S.chapter_num)&&(o.three_act_structure[R].chapters.push(S.chapter_num),o.three_act_structure[R].chapters.sort((x,w)=>x-w))}}m=o.outline.filter(v=>v.chapter_num>0&&v.chapter_num<998),console.log(`[GlobalArchitect] After completion: ${m.length}/${f} chapters`),T.tokenUsage&&(s.tokenUsage={inputTokens:(s.tokenUsage?.inputTokens||0)+(T.tokenUsage?.inputTokens||0),outputTokens:(s.tokenUsage?.outputTokens||0)+(T.tokenUsage?.outputTokens||0),thinkingTokens:(s.tokenUsage?.thinkingTokens||0)+(T.tokenUsage?.thinkingTokens||0)})}}}}catch(T){console.error("[GlobalArchitect] Completion attempt failed:",T)}}if(m=o.outline.filter(y=>y.chapter_num>0&&y.chapter_num<998),m.length!==f)return console.error(`[GlobalArchitect] Still ${m.length}/${f} chapters after completion attempt`),{...s,error:`El outline generado tiene ${m.length} cap\xEDtulos regulares pero se solicitaron ${f}. Por favor, regenere el proyecto.`,parsed:void 0}}console.log(`[GlobalArchitect] Successfully parsed and validated: ${m.length} regular chapters, ${o.plot_threads?.length||0} threads`);let g=this.validateSubplotCoherence(o);return g.hasIssues?(console.warn("[GlobalArchitect] SUBPLOT COHERENCE ISSUES DETECTED:"),g.issues.forEach(y=>console.warn(`  - ${y}`)),{...s,parsed:o,subplotWarnings:g.issues}):{...s,parsed:o}}aggressiveJsonRepair(e){let t=e.replace(/```json\s*/gi,"").replace(/```\s*/g,"").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),n=t.indexOf("{");if(n===-1)return null;t=t.substring(n),t=this.fixNewlinesInStrings(t),t=this.fixUnquotedKeys(t),t=t.replace(/:\s*'([^']*)'/g,': "$1"'),t=t.replace(/,(\s*[}\]])/g,"$1");let a=0,s=0,o=!1,i=!1,u=0;for(let m=0;m<t.length;m++){let f=t[m];if(i){i=!1;continue}if(f==="\\"){i=!0;continue}if(f==='"'){o=!o;continue}o||(f==="{"?a++:f==="}"?(a--,a===0&&(u=m)):f==="["?s++:f==="]"&&s--)}if(a===0&&s===0){u>0&&(t=t.substring(0,u+1));try{return JSON.parse(t)}catch{}}o&&(t+='"',o=!1),t=t.replace(/,(\s*)$/,"$1"),a=0,s=0,o=!1,i=!1;for(let m of t){if(i){i=!1;continue}if(m==="\\"){i=!0;continue}if(m==='"'){o=!o;continue}o||(m==="{"?a++:m==="}"?a--:m==="["?s++:m==="]"&&s--)}for(let m=0;m<s;m++)t+="]";for(let m=0;m<a;m++)t+="}";t=t.replace(/,(\s*[}\]])/g,"$1");try{return JSON.parse(t)}catch{}let c=t.match(/"outline"\s*:\s*\[[\s\S]*?\}\s*\]/),p=t.match(/"world_bible"\s*:\s*\{[\s\S]*?"rules"\s*:\s*\[[\s\S]*?\]\s*\}/);if(c&&p){let m=`{ ${p[0]}, ${c[0]} }`;try{return JSON.parse(m)}catch{}}return null}iterativeJsonRepair(e){let t=e.replace(/```json\s*/gi,"").replace(/```\s*/g,"").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),n=t.indexOf("{");if(n===-1)return null;t=t.substring(n),t=this.fixNewlinesInStrings(t),t=this.fixUnquotedKeys(t),t=t.replace(/,(\s*[}\]])/g,"$1");let a=0,s=0,o=!1,i=!1;for(let c of t){if(i){i=!1;continue}if(c==="\\"){i=!0;continue}if(c==='"'){o=!o;continue}o||(c==="{"?a++:c==="}"?a--:c==="["?s++:c==="]"&&s--)}o&&(t+='"');for(let c=0;c<s;c++)t+="]";for(let c=0;c<a;c++)t+="}";t=t.replace(/,(\s*[}\]])/g,"$1");let u=50;for(let c=0;c<u;c++)try{return JSON.parse(t)}catch(p){let m=p.message||"",f=m.match(/position\s+(\d+)/i);if(!f)return null;let g=parseInt(f[1]);if(g<=0||g>=t.length)return null;if(m.includes("Expected ',' or '}'")||m.includes("Expected ',' or ']'")||m.includes("Unexpected token")){let y=g;for(;y>0&&t[y]!=='"';)y--;if(y>0&&t[y]==='"'){let C=y-1;for(;C>0&&t[C]!=='"';)C--;if(C>=0&&t.substring(C+1,y).match(/^\s*[,:{}\[\]]/)){t=t.substring(0,g)+","+t.substring(g);continue}t=t.substring(0,y)+"\\"+t.substring(y);continue}t=t.substring(0,g)+t.substring(g+1);continue}if(m.includes("Expected double-quoted property name")){let y=g;for(;y<t.length&&/\s/.test(t[y]);)y++;let A=t.substring(y).match(/^([a-zA-Z_$][a-zA-Z0-9_$]*)(\s*:)/);if(A){t=t.substring(0,y)+'"'+A[1]+'"'+A[2]+t.substring(y+A[0].length);continue}return null}if(m.includes("Unterminated string")){t=t.substring(0,g)+'"'+t.substring(g);continue}return console.warn(`[GlobalArchitect] Iterative repair: unhandled error type: ${m}`),null}return console.warn("[GlobalArchitect] Iterative repair: max iterations reached"),null}fixNewlinesInStrings(e){let t=[],n=!1,a=!1;for(let s=0;s<e.length;s++){let o=e[s];if(a){t.push(o),a=!1;continue}if(o==="\\"&&n){t.push(o),a=!0;continue}if(o==='"'){n=!n,t.push(o);continue}if(n){if(o===`
`){t.push("\\n");continue}if(o==="\r"){t.push("\\r");continue}if(o==="	"){t.push("\\t");continue}}t.push(o)}return t.join("")}fixUnquotedKeys(e){let t="",n=!1,a=!1;for(let s=0;s<e.length;s++){let o=e[s];if(a){t+=o,a=!1;continue}if(o==="\\"&&n){t+=o,a=!0;continue}if(o==='"'){n=!n,t+=o;continue}if(n){t+=o;continue}if((o==="{"||o===","||o===`
`)&&!n){t+=o;let u=e.substring(s+1).match(/^(\s*)([a-zA-Z_$][a-zA-Z0-9_$]*)(\s*:\s*)/);u&&(t+=u[1]+'"'+u[2]+'"'+u[3],s+=u[0].length);continue}t+=o}return t}repairTruncatedJson(e){let t=e.replace(/```json\s*/gi,"").replace(/```\s*/g,"").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"");t=this.fixNewlinesInStrings(t),t=this.fixUnquotedKeys(t);let n=t.indexOf("{");if(n===-1)return null;let a=t.substring(n),s=a.lastIndexOf('"}');if(s===-1)return null;a=a.substring(0,s+2);let o=0,i=0,u=!1,c=!1;for(let p of a){if(c){c=!1;continue}if(p==="\\"){c=!0;continue}if(p==='"'){u=!u;continue}u||(p==="{"?o++:p==="}"?o--:p==="["?i++:p==="]"&&i--)}a=a.replace(/,(\s*)$/,"$1");for(let p=0;p<i;p++)a+="]";for(let p=0;p<o;p++)a+="}";a=a.replace(/,(\s*[}\]])/g,"$1");try{return JSON.parse(a)}catch{return null}}extractBalancedJson(e){let t=e.indexOf("{");if(t===-1)return null;let n=0,a=!1,s=!1;for(let o=t;o<e.length;o++){let i=e[o];if(s){s=!1;continue}if(i==="\\"){s=!0;continue}if(i==='"'&&!s){a=!a;continue}if(!a&&(i==="{"&&n++,i==="}"&&(n--,n===0)))return e.substring(t,o+1)}return null}validateSubplotCoherence(e){let t=[],n=e.plot_threads||[],a=e.outline||[],s=e.three_act_structure;for(let i of n){let u=i.name?.toLowerCase()||"",c=i.goal?.toLowerCase()||"",p=a.filter(m=>{let f=(m.summary||"").toLowerCase(),g=(m.key_event||"").toLowerCase(),y=(m.emotional_arc||"").toLowerCase(),C=`${f} ${g} ${y}`;return u.split(/\s+/).filter(T=>T.length>3).some(T=>C.includes(T))});p.length===0?t.push(`SUBTRAMA HU\xC9RFANA: "${i.name}" no tiene cap\xEDtulos que la desarrollen expl\xEDcitamente. Considere a\xF1adirla a los res\xFAmenes de cap\xEDtulos o eliminarla.`):p.length<2&&t.push(`SUBTRAMA D\xC9BIL: "${i.name}" solo aparece en 1 cap\xEDtulo. Las subtramas efectivas necesitan setup + desarrollo + payoff (m\xEDnimo 3 apariciones).`)}if(s){let i=s.act1?.chapters?.length||0,u=s.act2?.chapters?.length||0,c=s.act3?.chapters?.length||0,p=i+u+c;if(p>0){let m=i/p,f=u/p,g=c/p;m>.4&&t.push(`ESTRUCTURA DESEQUILIBRADA: Acto 1 ocupa ${Math.round(m*100)}% de la novela (ideal: 20-25%). Setup demasiado largo puede causar ritmo lento.`),f<.35&&t.push(`ESTRUCTURA DESEQUILIBRADA: Acto 2 solo ocupa ${Math.round(f*100)}% (ideal: 45-55%). El desarrollo de conflictos ser\xE1 insuficiente.`),g>.35&&t.push(`ESTRUCTURA DESEQUILIBRADA: Acto 3 ocupa ${Math.round(g*100)}% (ideal: 20-25%). Resoluci\xF3n demasiado larga puede diluir el impacto.`)}}let o=e.world_bible?.characters||[];for(let i of o)if(i.role==="protagonist"||i.role==="antagonist"){let u=(i.name||"").toLowerCase(),c=a.filter(p=>`${p.summary||""} ${p.key_event||""}`.toLowerCase().includes(u));c.length<3&&t.push(`ARCO INCOMPLETO: ${i.name} (${i.role}) solo aparece en ${c.length} cap\xEDtulo(s). Protagonistas/antagonistas necesitan presencia sostenida.`)}return{hasIssues:t.length>0,issues:t}}};It();var rre=`
Eres el Chapter Architect, el Director de Escena de LitAgents 2.0.
Tu trabajo es descomponer cada cap\xEDtulo en 3-5 escenas cinematogr\xE1ficas perfectamente estructuradas.

PRINCIPIOS DE DISE\xD1O DE ESCENAS:
1. Cada escena debe tener un OBJETIVO claro (plot beat + emotional beat)
2. Las escenas deben FLUIR naturalmente una a otra
3. La primera escena conecta con el cap\xEDtulo anterior
4. La \xFAltima escena tiene el HOOK m\xE1s fuerte
5. Var\xEDa los tipos: acci\xF3n, di\xE1logo, reflexi\xF3n, tensi\xF3n

\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551 VARIACI\xD3N ORG\xC1NICA DEL N\xDAMERO DE ESCENAS (LitAgents 2.9)        \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551 NO uses siempre 4 escenas. Adapta seg\xFAn la complejidad:         \u2551
\u2551                                                                  \u2551
\u2551 \u2022 3 ESCENAS: Cap\xEDtulos de transici\xF3n, reflexivos, ep\xEDlogos      \u2551
\u2551   - Cuando el cap\xEDtulo es m\xE1s introspectivo o de setup menor    \u2551
\u2551   - Cuando el ritmo requiere brevedad                           \u2551
\u2551                                                                  \u2551
\u2551 \u2022 4 ESCENAS: Cap\xEDtulos est\xE1ndar de desarrollo                   \u2551
\u2551   - Equilibrio entre acci\xF3n y desarrollo                        \u2551
\u2551   - La mayor\xEDa de cap\xEDtulos del segundo acto                    \u2551
\u2551                                                                  \u2551
\u2551 \u2022 5 ESCENAS: Cap\xEDtulos cl\xEDmax, confrontaciones, revelaciones    \u2551
\u2551   - Eventos mayores que requieren m\xE1s espacio narrativo         \u2551
\u2551   - Puntos de giro de la trama (25%, 50%, 75%)                  \u2551
\u2551   - Cl\xEDmax del tercer acto                                      \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

ESTRUCTURA FLEXIBLE:
- Escena 1 (300-400 palabras): Conexi\xF3n + Setup
- Escena 2 (300-400 palabras): Desarrollo + Complicaci\xF3n
- Escena 3 (300-400 palabras): Tensi\xF3n / Conflicto central
- Escena 4 (200-300 palabras, si aplica): Escalada o resoluci\xF3n parcial
- Escena 5 (200-300 palabras, para cl\xEDmax): Hook explosivo + Cierre dram\xE1tico

Genera respuestas en JSON v\xE1lido con el array de scenes (entre 3 y 5 escenas).
`,am=class extends Ae{constructor(){super({name:"Chapter Architect",role:"chapter-architect",systemPrompt:rre,model:"deepseek-reasoner",useThinking:!0})}formatPlotContext(e,t){let n=[];n.push("=== CONTEXTO COMPLETO DE LA TRAMA ==="),n.push(`IMPORTANTE: Las escenas que dise\xF1es DEBEN ser coherentes con toda la historia, no solo con este cap\xEDtulo.
`);let a=e.filter(i=>i.chapter_num<t),s=e.find(i=>i.chapter_num===t),o=e.filter(i=>i.chapter_num>t);if(a.length>0){n.push("\u{1F4D6} LO QUE YA OCURRI\xD3 (no contradecir):");for(let i of a.slice(-5))n.push(`  Cap ${i.chapter_num} "${i.title}": ${i.summary}`),i.key_event&&n.push(`    \u2192 Evento clave: ${i.key_event}`);a.length>5&&n.push(`  [...${a.length-5} cap\xEDtulos anteriores omitidos para brevedad]`),n.push("")}if(s&&(n.push("\u{1F3AF} CAP\xCDTULO ACTUAL A DISE\xD1AR:"),n.push(`  Cap ${s.chapter_num} "${s.title}"`),n.push(`  Trama: ${s.summary}`),n.push(`  Evento clave: ${s.key_event}`),s.emotional_arc&&n.push(`  Arco emocional: ${s.emotional_arc}`),n.push("")),o.length>0){n.push("\u{1F4C5} LO QUE VIENE DESPU\xC9S (preparar el terreno):");for(let i of o.slice(0,3))n.push(`  Cap ${i.chapter_num} "${i.title}": ${i.summary}`),i.key_event&&n.push(`    \u2192 Prepara: ${i.key_event}`);o.length>3&&n.push(`  [...${o.length-3} cap\xEDtulos futuros m\xE1s]`),n.push("")}return n.push("INSTRUCCIONES:"),n.push("1. Las escenas deben CONECTAR con lo que ya ocurri\xF3"),n.push("2. No introducir elementos que contradigan cap\xEDtulos anteriores"),n.push("3. Preparar sutilmente los eventos de cap\xEDtulos futuros (foreshadowing)"),n.push("4. Mantener coherencia con el arco emocional general"),n.join(`
`)}async execute(e){console.log(`[ChapterArchitect] Planning scenes for Chapter ${e.chapterOutline.chapter_num}: "${e.chapterOutline.title}"...`);let t=na.CHAPTER_ARCHITECT(e.chapterOutline,e.worldBible,e.previousChapterSummary,e.storyState);if(e.fullPlotOutline&&e.fullPlotOutline.length>0){let o=e.chapterOutline.chapter_num;t=`${this.formatPlotContext(e.fullPlotOutline,o)}

---

${t}`,console.log(`[ChapterArchitect] Added full plot context (${e.fullPlotOutline.length} chapters)`)}e.consistencyConstraints&&(t=`${e.consistencyConstraints}

---

AHORA, TENIENDO EN CUENTA LAS RESTRICCIONES DE CONSISTENCIA Y LA TRAMA COMPLETA, dise\xF1a las escenas:

${t}`,console.log(`[ChapterArchitect] Injected consistency constraints (${e.consistencyConstraints.length} chars) - Preventing inconsistent scene planning`)),e.patternAnalysisContext&&(t=`${e.patternAnalysisContext}

---

${t}`,console.log(`[ChapterArchitect] Injected pattern analysis context (${e.patternAnalysisContext.length} chars) - Anti-repetition enabled`)),e.isKindleUnlimited&&(t=`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551  \u26A1 KINDLE UNLIMITED - RITMO R\xC1PIDO OBLIGATORIO EN DISE\xD1O DE ESCENAS \u26A1       \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  DISE\xD1A escenas CORTAS y TENSAS. Cada escena debe:                          \u2551
\u2551  \u2022 Tener un CONFLICTO ACTIVO (no solo conversaci\xF3n)                         \u2551
\u2551  \u2022 Empezar en medio de la acci\xF3n (in media res)                             \u2551
\u2551  \u2022 Terminar en CLIFFHANGER o momento de tensi\xF3n                             \u2551
\u2551  \u2022 M\xE1ximo 400-500 palabras por escena                                       \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  PROHIBIDO en escenas KU:                                                   \u2551
\u2551  \u2022 Escenas de solo di\xE1logo sin acci\xF3n f\xEDsica                                \u2551
\u2551  \u2022 Setup lento o "escenas de transici\xF3n"                                    \u2551
\u2551  \u2022 M\xE1s de 3 escenas por cap\xEDtulo                                            \u2551
\u2551  \u2022 Escenas contemplativas o de pura descripci\xF3n                             \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D


${t}`,console.log("[ChapterArchitect] Injected KU pacing directive - FAST PACING ENFORCED"));let n=3,a=null,s={inputTokens:0,outputTokens:0,thinkingTokens:0};for(let o=1;o<=n;o++){let i=o>1?`${t}

\u26A0\uFE0F INTENTO ${o}/${n}: Tu respuesta anterior no conten\xEDa JSON v\xE1lido. DEBES responder con un objeto JSON v\xE1lido que contenga: { "scenes": [...], "chapter_hook": "...", "total_word_target": ... }`:t,u=await this.generateContent(i);if(a=u,u.tokenUsage&&(s.inputTokens+=u.tokenUsage.inputTokens||0,s.outputTokens+=u.tokenUsage.outputTokens||0,s.thinkingTokens+=u.tokenUsage.thinkingTokens||0),u.error){if(console.error(`[ChapterArchitect] Attempt ${o}/${n} API error:`,u.error),o===n)return{...u,tokenUsage:s};continue}try{let c=u.content.match(/\{[\s\S]*\}/);if(c){let p=JSON.parse(c[0]);if(p.scenes&&Array.isArray(p.scenes)&&p.scenes.length>0)return console.log(`[ChapterArchitect] Successfully parsed (attempt ${o}): ${p.scenes.length} scenes, target: ${p.total_word_target} words`),{...u,parsed:p,tokenUsage:s};console.warn(`[ChapterArchitect] Attempt ${o}/${n}: JSON parsed but scenes array missing or empty`)}else console.warn(`[ChapterArchitect] Attempt ${o}/${n}: No JSON object found in response`)}catch(c){console.error(`[ChapterArchitect] Attempt ${o}/${n} parse error:`,c)}o<n&&console.log(`[ChapterArchitect] Retrying... (${o}/${n})`)}return console.error(`[ChapterArchitect] All ${n} attempts failed to produce valid JSON`),{...a,tokenUsage:s}}};It();var py=new Set(["el","la","los","las","un","una","unos","unas","de","del","al","en","con","por","para","sin","sobre","entre","hacia","hasta","que","y","o","pero","ni","sino","aunque","porque","como","si","no","se","su","sus","mi","mis","tu","tus","yo","me","te","le","lo","les","nos","os","este","esta","esto","estos","estas","ese","esa","eso","esos","esas","aquel","aquella","aquello","era","fue","sido","ser","estar","estaba","habia","tenia","hacia","mas","menos","muy","tan","ya","aun","todavia","cuando","donde","quien","cual","cuyo","cada","todo","toda","todos","todas","nada","algo","alguien","nadie","mismo","misma","otro","otra","otros","otras"]),nre=["dijo","pregunto","respondio","exclamo","murmuro","susurro","grito","anadio","replico","contesto","inquirio","protesto","admitio","confeso","aseguro","afirmo","nego","interrumpio","sentencio","espeto","mascullo","balbuceo","tartamudeo","solto"];function $2(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}var are=[/torbellino de emociones?/i,/el peso (de .+)? sobre sus hombros/i,/silencio (era )?ensordecedor/i,/mezcla de .+ y .+/i,/sin previo aviso/i,/en cuesti[o]n de segundos/i,/como si el tiempo se hubiera detenido/i,/escalofr[i]o recorri[o] su (espalda|cuerpo)/i,/coraz[o]n (le )?lat[i]a con fuerza/i,/sus ojos se encontraron/i,/trag[o] saliva/i,/contuvo la respiraci[o]n/i,/no pod[i]a creer lo que (estaba viendo|ve[i]a)/i,/algo dentro de [e]l\/ella/i,/en lo m[a]s profundo de su ser/i,/un nudo en (la garganta|el est[o]mago)/i,/el mundo se detuvo/i,/suspir[o] profundamente/i,/l[a]grimas rodaron por sus mejillas/i,/apret[o] los pu[n]os/i,/la sangre se le hel[o]/i,/sinti[o] un vac[i]o/i,/no pudo evitar (pensar|sentir|notar)/i,/algo en su interior/i,/antes de que pudiera reaccionar/i,/todo cambi[o] en un instante/i,/una oleada de .+ lo\/la inund[o]/i,/sin poder evitarlo/i,/con el coraz[o]n en un pu[n]o/i,/un mar de dudas/i,/el aire se volvi[o] denso/i,/como por arte de magia/i,/justo a tiempo/i,/en el momento preciso/i,/una extra[n]a sensaci[o]n/i,/algo no cuadraba/i,/un presentimiento/i,/su instinto le dec[i]a/i,/la respuesta lleg[o] de improviso/i,/como si hubiera le[i]do su mente/i,/todo encaj[o] de repente/i,/las piezas del puzzle/i,/un escalofro le recorri[o]/i,/se qued[o] sin palabras/i,/el silencio lo\/la dec[i]a todo/i,/sus miradas se cruzaron/i,/una tensi[o]n palpable/i,/el ambiente se enrareci[o]/i,/algo indefinible/i,/por alguna raz[o]n/i,/sin saber por qu[e]/i],sre=["mascullo","espeto","gruno","susurro","replico","bramo","jadeo","balbuceo","tartamudeo","siseo","rugio","vocifero","farfullo","cuchicheo","rezongo","bufo","chillo","gimio","sollozo","lamento","sentencio","ordeno","suplico","imploro","exigio"],ore=[{regex:/no solo (.{5,60}), sino (?:que )?(.{5,60})/gi,name:"no solo X, sino que Y"},{regex:/(?:no|ni) (?:era|fue|hab[i]a sido) (.{5,40}), (?:era|fue|hab[i]a sido) (.{5,40})/gi,name:"no era X, era Y"},{regex:/(?:m[a]s|menos) que (.{5,40}), (?:era|fue|se trataba de) (.{5,40})/gi,name:"m\xE1s que X, era Y"},{regex:/tanto (.{5,40}) como (.{5,40})/gi,name:"tanto X como Y"},{regex:/si (.{5,40}), entonces (.{5,40})/gi,name:"si X, entonces Y"},{regex:/no (?:era|haba|fue) (.{5,40})[,.;] (?:sino|era|fue) (.{5,40})/gi,name:"no era X, sino Y"}];function ire(r,e=8,t=60){let n=r.split(/[.!?;]+/).map(s=>s.trim()).filter(s=>s.length>=e),a=[];for(let s of n){let o=s.split(/[,]+/).map(i=>i.trim()).filter(i=>i.length>=e&&i.length<=t);a.push(...o)}return a}function cre(r,e){let t=f=>$2(f).replace(/[^a-z0-9\s]/g,"").trim(),n=t(r),a=t(e);if(n===a)return 1;let s=n.split(/\s+/),o=a.split(/\s+/);if(s.length<3||o.length<3)return 0;let i=new Set(s),u=new Set(o),c=Array.from(i).filter(f=>u.has(f)&&!py.has(f)),p=s.filter(f=>!py.has(f)),m=o.filter(f=>!py.has(f));return p.length===0||m.length===0?0:c.length*2/(p.length+m.length)}var tI=class{analyzeText(e){let t=$2(e),n=t.replace(/[^\w\s]/g,"").split(/\s+/).filter(v=>v.length>3&&!py.has(v)),a=new Map;for(let v of n)a.set(v,(a.get(v)||0)+1);let s=Array.from(a.entries()).filter(([v,S])=>S>=2).sort((v,S)=>S[1]-v[1]).slice(0,20).map(([v,S])=>`${v}(${S}x)`),o=Array.from(a.entries()).filter(([v,S])=>v.length>=7&&S>=2).sort((v,S)=>S[1]-v[1]).slice(0,10).map(([v,S])=>({word:v,count:S})),i=new Map;for(let v of nre){let S=new RegExp(`\\b${v}\\b`,"gi"),R=t.match(S);R&&R.length>0&&i.set(v,R.length)}let u=Array.from(i.entries()).map(([v,S])=>({verb:v,count:S})).sort((v,S)=>S.count-v.count),c=e.split(/\n\n+/),p=c.map(v=>v.trim().split(/\s+/)[0]).filter(Boolean).slice(-10),m=c.map(v=>{let S=v.trim().split(/[.!?]+/).filter(Boolean);return S.length>0?S[S.length-1].trim().substring(0,100):""}).filter(v=>v.length>20).slice(-5),f=[];for(let v of are){let S=e.match(v);S&&f.push(S[0])}let g=new Map;for(let v of sre){let S=new RegExp(`\\b${v}\\b`,"gi"),R=t.match(S);R&&R.length>0&&g.set(v,R.length)}let y=Array.from(g.entries()).map(([v,S])=>({tag:v,count:S})).sort((v,S)=>S.count-v.count),C=y.reduce((v,S)=>v+S.count,0),A=ire(e),T=[];for(let v=0;v<A.length&&v<200;v++)for(let S=v+1;S<A.length&&S<200;S++){let R=cre(A[v],A[S]);R>=.7&&A[v]!==A[S]&&T.push({phrase:A[v].substring(0,80),similar:A[S].substring(0,80),similarity:Math.round(R*100)})}let E=T.slice(0,10),d=[];for(let{regex:v,name:S}of ore){v.lastIndex=0;let R=[],x;for(;(x=v.exec(e))!==null;)R.push(x[0].substring(0,100));R.length>=2&&d.push({pattern:S,occurrences:R})}let l=[];u.filter(v=>v.count>=1).forEach(v=>l.push(`verbo "${v.verb}" (ya usado ${v.count}x)`)),C>=3&&l.push(`\u26A0\uFE0F ACOTACIONES FORZADAS (${C}x): ${y.map(v=>`"${v.tag}"(${v.count}x)`).join(", ")} \u2014 MUESTRA emociones con acciones f\xEDsicas, no con verbos de habla forzados`),y.filter(v=>v.count>=2).forEach(v=>l.push(`acotaci\xF3n forzada "${v.tag}" (${v.count}x) \u2014 usa "dijo" + acci\xF3n f\xEDsica`)),E.forEach(v=>l.push(`frases casi id\xE9nticas: "${v.phrase}" \u2248 "${v.similar}" (${v.similarity}% similitud) \u2014 reformula completamente`)),d.forEach(v=>l.push(`estructura repetitiva "${v.pattern}" usada ${v.occurrences.length}x \u2014 var\xEDa la construcci\xF3n gramatical`));let h=new Map;return p.forEach(v=>h.set(v.toLowerCase(),(h.get(v.toLowerCase())||0)+1)),Array.from(h.entries()).filter(([v,S])=>S>=2).forEach(([v])=>l.push(`iniciar parrafo con "${v}"`)),f.forEach(v=>l.push(`expresion "${v}"`)),s.slice(0,8).forEach(v=>l.push(`palabra ${v}`)),o.filter(v=>v.count>=2).forEach(v=>l.push(`t\xE9rmino t\xE9cnico "${v.word}" (${v.count}x) - usa sin\xF3nimo`)),{overusedWords:s,recentExpressions:f,dialogueVerbs:u,paragraphStarters:p,avoidInNextScene:l,domainWords:o,sceneTransitions:m,forcedDialogueTags:y,similarPhrases:E,repetitiveStructures:d}}generateAntiRepetitionPrompt(e,t){let n=this.analyzeText(e),a=this.analyzeText(t),s=new Set([...n.avoidInNextScene,...a.avoidInNextScene]),o=Array.from(s);if(o.length===0)return"";let i=`
+------------------------------------------------------------------+
| VOCABULARIO A EVITAR EN ESTA ESCENA (ya sobreutilizado):         |
+------------------------------------------------------------------+
${o.map(u=>`| - ${u}`).join(`
`)}
+------------------------------------------------------------------+
| -> Usa sinonimos frescos o reformula completamente               |
| -> Varia la estructura de las oraciones                          |
| -> Busca descripciones originales para las emociones             |
+------------------------------------------------------------------+
`;if(a.forcedDialogueTags.length>0){let u=a.forcedDialogueTags.reduce((c,p)=>c+p.count,0);i+=`
+------------------------------------------------------------------+
| \u26A0\uFE0F ACOTACIONES DE DI\xC1LOGO FORZADAS (${u} detectadas)           |
+------------------------------------------------------------------+
| PROBLEMA: Usar verbos como "mascull\xF3", "espet\xF3", "gru\xF1\xF3" es     |
| "CONTAR" las emociones en vez de "MOSTRARLAS".                   |
| SOLUCI\xD3N: Usa "dijo" + acci\xF3n f\xEDsica que MUESTRE la emoci\xF3n:     |
|   \u2717 "\u2014No me importa \u2014mascull\xF3 con rabia."                       |
|   \u2713 "\u2014No me importa. \u2014Apret\xF3 los pu\xF1os sobre la mesa."          |
|   \u2717 "\u2014\xA1Sal de aqu\xED! \u2014espet\xF3 furiosamente."                      |
|   \u2713 "\u2014\xA1Sal de aqu\xED! \u2014Se levant\xF3 de golpe, volcando la silla."   |
+------------------------------------------------------------------+
`}return a.similarPhrases.length>0&&(i+=`
+------------------------------------------------------------------+
| \u26A0\uFE0F FRASES DESCRIPTIVAS CASI ID\xC9NTICAS DETECTADAS                  |
+------------------------------------------------------------------+
${a.similarPhrases.map(u=>`| "${u.phrase}" \u2248 "${u.similar}" (${u.similarity}%)`).join(`
`)}
| -> Cada descripci\xF3n debe ser \xDANICA. Reformula completamente.     |
+------------------------------------------------------------------+
`),a.repetitiveStructures.length>0&&(i+=`
+------------------------------------------------------------------+
| \u26A0\uFE0F ESTRUCTURAS GRAMATICALES REPETITIVAS                           |
+------------------------------------------------------------------+
${a.repetitiveStructures.map(u=>`| Patr\xF3n "${u.pattern}" usado ${u.occurrences.length}x`).join(`
`)}
| -> Var\xEDa la construcci\xF3n: usa oraciones simples, subordinadas,   |
|    yuxtapuestas, interrogativas ret\xF3ricas, etc.                  |
+------------------------------------------------------------------+
`),i}generateQuickAvoidList(e){return this.analyzeText(e).avoidInNextScene.slice(0,10)}},L2=new tI;var lre=`
Eres el Ghostwriter de LitAgents 2.0, un novelista fantasma de \xE9lite especializado en prosa inmersiva.
Tu trabajo es escribir UNA ESCENA a la vez, manteniendo el flujo narrativo perfecto.

REGLAS DE ORO:
1. MUESTRA, NO CUENTES - Las emociones son sensaciones f\xEDsicas
2. CONTINUIDAD PERFECTA - El texto debe fluir desde el contexto anterior
3. PROSA SENSORIAL - Usa los 5 sentidos, no solo la vista
4. DI\xC1LOGO ESPA\xD1OL - Guion largo (\u2014), puntuaci\xF3n correcta
5. NO TERMINES EL CAP\xCDTULO - Solo termina la escena seg\xFAn el plan

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
LA BIBLIA DEL MUNDO SIEMPRE MANDA (v2.9.9+)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
Antes de escribir CUALQUIER detalle sobre un personaje, ubicaci\xF3n u objeto:
1. CONSULTA el World Bible inyectado en el prompt
2. Los atributos f\xEDsicos (ojos, cabello, altura, cicatrices) son INMUTABLES
3. Los nombres de personajes secundarios NUNCA se inventan ni modifican
4. Las relaciones entre personajes est\xE1n ESTABLECIDAS - no inventes nuevas
5. La cronolog\xEDa temporal es SAGRADA - respeta fechas y secuencia de eventos

Si un personaje secundario aparece en la escena:
- VERIFICA su nombre exacto en el \xEDndice de personajes
- VERIFICA sus atributos f\xEDsicos antes de describirlo
- VERIFICA su relaci\xF3n con el protagonista
- NO inventes apodos o variaciones del nombre

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
COHERENCIA TEMPORAL OBLIGATORIA (v2.9.9+)
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
La cronolog\xEDa es MATEM\xC1TICA - las cuentas DEBEN cuadrar:
1. Si la L\xCDNEA TEMPORAL ACUMULADA dice que el Cap anterior fue "D\xEDa 3, noche",
   este cap\xEDtulo NO puede empezar en "D\xEDa 2" ni saltar a "D\xEDa 10" sin transici\xF3n
2. "Hace X d\xEDas/semanas" se calcula desde el d\xEDa actual de la trama, NO desde hoy
3. Si un personaje estaba en Ciudad A al final del cap\xEDtulo anterior,
   NO puede aparecer en Ciudad B (a 500km) sin viaje expl\xEDcito o elipsis
4. Las heridas tienen tiempo de curaci\xF3n: un brazo roto NO se cura en 2 d\xEDas
5. Los eventos recordados DEBEN haber ocurrido en cap\xEDtulos ANTERIORES
6. Si hay una L\xCDNEA TEMPORAL ACUMULADA en el contexto, CONSULTARLA antes de
   usar cualquier referencia temporal relativa ("ayer", "hace una semana", etc)

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
PROHIBIDO ABSOLUTAMENTE:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u2022 Clich\xE9s de IA: "crucial", "fascinante", "torbellino de emociones", "enigm\xE1tico"
\u2022 Expresiones sobreusadas: "no pudo evitar", "algo en su interior", "sin previo aviso"
\u2022 Comentarios de autor: [entre corchetes], notas meta
\u2022 Repetir informaci\xF3n ya establecida
\u2022 Deus ex machina o coincidencias forzadas
\u2022 Soluciones f\xE1ciles: mensajes an\xF3nimos, informantes convenientes, "casualidades"
\u2022 Villanos que explican sus planes
\u2022 Habilidades no justificadas previamente

Tu output es SOLO el texto narrativo. Sin marcadores, sin comentarios, sin explicaciones.
`,sm=class extends Ae{constructor(){super({name:"Ghostwriter V2",role:"ghostwriter-v2",systemPrompt:lre,model:"deepseek-chat",useThinking:!1})}async execute(e){console.log(`[GhostwriterV2] Writing Scene ${e.scenePlan.scene_num}: "${e.scenePlan.plot_beat.substring(0,50)}..."`);let t=na.GHOSTWRITER_SCENE(e.scenePlan,e.prevSceneContext,e.rollingSummary,e.worldBible,e.guiaEstilo);if(e.consistencyConstraints&&(t=`${e.consistencyConstraints}

---

${t}`,console.log(`[GhostwriterV2] Injected consistency constraints (${e.consistencyConstraints.length} chars)`)),e.seriesWorldBible){let i=this.formatSeriesWorldBible(e.seriesWorldBible);i&&(t=`${i}

---

${t}`,console.log(`[GhostwriterV2] Injected series world bible context (${i.length} chars)`))}if(e.previousChaptersText||e.currentChapterText){let i=L2.generateAntiRepetitionPrompt(e.previousChaptersText||"",e.currentChapterText||"");i&&(t=`${i}

${t}`,console.log("[GhostwriterV2] Injected anti-repetition vocabulary guidance"))}e.errorHistory&&(t=`${e.errorHistory}

${t}`,console.log(`[GhostwriterV2] Injected error history (${e.errorHistory.length} chars)`)),e.chapterOutline&&(t=`${`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551 \u{1F4CB} PLAN ORIGINAL DEL CAP\xCDTULO ${e.chapterOutline.chapter_num} (ADHERENCIA OBLIGATORIA)    \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551 T\xCDTULO: ${e.chapterOutline.title}
\u2551 RESUMEN PLANIFICADO: ${e.chapterOutline.summary}
\u2551 EVENTO CLAVE QUE DEBE OCURRIR: ${e.chapterOutline.key_event}
${e.chapterOutline.emotional_arc?`\u2551 ARCO EMOCIONAL: ${e.chapterOutline.emotional_arc}`:""}
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551 \u26A0\uFE0F REGLA INVIOLABLE: Esta escena es PARTE de este cap\xEDtulo.     \u2551
\u2551 El cap\xEDtulo COMPLETO debe cubrir el RESUMEN y el EVENTO CLAVE  \u2551
\u2551 descritos arriba. NO inventes eventos diferentes ni omitas     \u2551
\u2551 el evento clave planificado. NO cambies el orden de eventos.   \u2551
\u2551 NO a\xF1adas subtramas o personajes no mencionados en el plan.    \u2551
\u2551 SIGUE EL PLAN EXACTAMENTE.                                    \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D`}

${t}`,console.log("[GhostwriterV2] Injected original chapter outline for strict adherence"));let n=this.generatePacingGuidance(e.scenePlan);n&&(t=`${n}

${t}`,console.log("[GhostwriterV2] Injected proactive pacing guidance"));let a=this.generatePhysicalContinuityGuidance(e.scenePlan,e.prevSceneContext,e.lastSceneEndState);a&&(t=`${a}

${t}`,console.log("[GhostwriterV2] Injected physical continuity guidance"));let s=this.generateNarrativeCredibilityGuidance(e.scenePlan);s&&(t=`${s}

${t}`,console.log("[GhostwriterV2] Injected narrative credibility guidance"));let o=await this.generateContent(t,void 0,{temperature:1.1});if(!o.error){let i=o.content.split(/\s+/).length;console.log(`[GhostwriterV2] Wrote ${i} words for Scene ${e.scenePlan.scene_num}`);let u=o.content.trim(),c=u.slice(-1),p=[".","!","?",'"',"\xBB",")"].includes(c),m=u.endsWith("...")||u.endsWith("\u2014")||!p;(i<150||m&&!p)&&console.warn(`[GhostwriterV2] Scene ${e.scenePlan.scene_num} may be truncated (${i} words, ends with "${c}")`)}return o}formatSeriesWorldBible(e){if(!e)return null;let t=[];if(t.push("=== CONTINUIDAD DE LA SERIE (VOL\xDAMENES ANTERIORES) ==="),t.push("IMPORTANTE: Esta informaci\xF3n proviene de vol\xFAmenes anteriores. DEBES mantener coherencia con estos eventos y personajes establecidos."),e.characters&&e.characters.length>0){t.push(`
## PERSONAJES ESTABLECIDOS EN LA SERIE:`);for(let n of e.characters){let a=`- ${n.name}`;n.role&&(a+=` (${n.role})`),n.current_status&&(a+=` - Estado actual: ${n.current_status}`),n.arc_summary&&(a+=`
  Arco: ${n.arc_summary}`),n.relationships&&n.relationships.length>0&&(a+=`
  Relaciones: ${n.relationships.join(", ")}`),n.last_volume_appearance&&(a+=`
  \xDAltima aparici\xF3n: Volumen ${n.last_volume_appearance}`),t.push(a)}}if(e.locations&&e.locations.length>0){t.push(`
## LOCACIONES ESTABLECIDAS:`);for(let n of e.locations){let a=`- ${n.name}`;n.significance&&(a+=`: ${n.significance}`),n.current_state&&(a+=` (Estado actual: ${n.current_state})`),n.key_events&&n.key_events.length>0&&(a+=`
  Eventos clave: ${n.key_events.join("; ")}`),t.push(a)}}if(e.lessons&&e.lessons.length>0){t.push(`
## LECCIONES Y TEMAS EXPLORADOS:`);for(let n of e.lessons){let a=`- ${n.theme||n.title}`;n.volume_learned&&(a+=` (Volumen ${n.volume_learned})`),n.description&&(a+=`: ${n.description}`),t.push(a)}}if(e.worldRules&&e.worldRules.length>0){t.push(`
## REGLAS DEL MUNDO (NO VIOLAR):`);for(let n of e.worldRules){let a=`- ${n.rule_name||n.name}`;n.description&&(a+=`: ${n.description}`),t.push(a)}}if(e.timelineEvents&&e.timelineEvents.length>0){t.push(`
## L\xCDNEA TEMPORAL DE LA SERIE:`);let n=[...e.timelineEvents].sort((a,s)=>(a.volume||0)-(s.volume||0));for(let a of n){let s=`- Vol.${a.volume}: ${a.event}`;a.consequences&&(s+=` \u2192 ${a.consequences}`),t.push(s)}}if(e.objects&&e.objects.length>0){t.push(`
## OBJETOS SIGNIFICATIVOS:`);for(let n of e.objects){let a=`- ${n.name}`;n.description&&(a+=`: ${n.description}`),n.current_owner&&(a+=` (Poseedor actual: ${n.current_owner})`),n.current_status&&(a+=` [${n.current_status}]`),t.push(a)}}if(e.secrets&&e.secrets.length>0){t.push(`
## SECRETOS Y MISTERIOS:`);for(let n of e.secrets){let a=`- ${n.secret}`;n.known_by&&n.known_by.length>0&&(a+=` (Conocido por: ${n.known_by.join(", ")})`),n.resolved?(a+=" [RESUELTO]",n.resolution&&(a+=`: ${n.resolution}`)):a+=" [PENDIENTE]",t.push(a)}}return t.length<=2?null:(t.push(`
=== FIN CONTINUIDAD DE LA SERIE ===`),t.join(`
`))}generatePacingGuidance(e){let t=(e.emotional_beat||"").toLowerCase(),n=(e.plot_beat||"").toLowerCase(),a=/accin|pelea|persecucin|huida|combate|enfrentamiento|escape|lucha|batalla|chase|fight|action/.test(t+n),s=/tensin|suspense|amenaza|peligro|miedo|terror|ansiedad|nervios|alerta/.test(t+n),o=/emocin|tristeza|dolor|prdida|duelo|llanto|despedida|reencuentro|amor|romance|pasin/.test(t+n),i=/reflexin|introspeccin|recuerdo|memoria|pensamiento|meditacin|calma|paz|contemplacin/.test(t+n),u=/dilogo|conversacin|discusin|debate|negociacin|revelacin|confesin/.test(t+n),c=/clmax|punto lgido|confrontacin final|revelacin mayor|giro dramtico/.test(t+n),p=[];return p.push("\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557"),p.push("\u2551 \u{1F3B5} GU\xCDA DE RITMO PROACTIVA - PREVENCI\xD3N DE PACING ISSUES        \u2551"),p.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),a?p.push(`
TIPO DE ESCENA DETECTADO: ACCI\xD3N/MOVIMIENTO
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2713 Usa frases CORTAS y PUNZANTES (5-12 palabras por oraci\xF3n)
\u2713 Verbos de acci\xF3n en presente o pret\xE9rito simple
\u2713 P\xE1rrafos breves (2-4 l\xEDneas m\xE1ximo)
\u2713 Elimina adjetivos innecesarios - prioriza MOVIMIENTO
\u2713 Di\xE1logos entrecortados, respiraci\xF3n agitada
\u2713 Descripciones sensoriales r\xE1pidas: dolor, impacto, velocidad

\u2717 EVITAR: P\xE1rrafos largos descriptivos
\u2717 EVITAR: Reflexiones internas extensas durante la acci\xF3n
\u2717 EVITAR: Frases subordinadas complejas
\u2717 EVITAR: Descripciones detalladas del entorno durante combate`):s?p.push(`
TIPO DE ESCENA DETECTADO: TENSI\xD3N/SUSPENSE
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2713 Alterna frases cortas con pausas descriptivas
\u2713 Enfatiza los SILENCIOS y lo que NO se dice
\u2713 Usa los sentidos: sonidos ominosos, sombras, olores
\u2713 Tiempo lento: cada segundo se siente eterno
\u2713 Personajes hiperconscientes del entorno

\u2717 EVITAR: Resolver la tensi\xF3n demasiado r\xE1pido
\u2717 EVITAR: Di\xE1logos casuales o humor fuera de lugar
\u2717 EVITAR: Descripciones rutinarias que rompan la atm\xF3sfera`):o?p.push(`
TIPO DE ESCENA DETECTADO: EMOCIONAL/INTIMIDAD
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2713 Ritmo pausado con respiraciones narrativas
\u2713 Enf\xF3cate en gestos peque\xF1os pero significativos
\u2713 Las emociones son F\xCDSICAS: nudo en la garganta, peso en el pecho
\u2713 Permite silencios cargados de significado
\u2713 Los di\xE1logos pueden ser entrecortados por la emoci\xF3n

\u2717 EVITAR: Explicar las emociones - MU\xC9STRALAS
\u2717 EVITAR: Transiciones abruptas a otros temas
\u2717 EVITAR: Interrumpir momentos emotivos con acci\xF3n`):i?p.push(`
TIPO DE ESCENA DETECTADO: REFLEXI\xD3N/INTROSPECCI\xD3N
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2713 Frases m\xE1s largas, cadencia contemplativa
\u2713 Permite divagaciones controladas del pensamiento
\u2713 Ancla las reflexiones en sensaciones f\xEDsicas del presente
\u2713 Usa el entorno como espejo del estado interno

\u2717 EVITAR: Exceso de "pens\xF3", "reflexion\xF3", "se pregunt\xF3"
\u2717 EVITAR: Mon\xF3logos internos sin ancla sensorial
\u2717 EVITAR: Que la reflexi\xF3n se extienda m\xE1s de 2-3 p\xE1rrafos sin interrupci\xF3n`):u?p.push(`
TIPO DE ESCENA DETECTADO: DI\xC1LOGO INTENSO
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2713 Intercambios r\xE1pidos cuando hay tensi\xF3n
\u2713 Beats de acci\xF3n entre r\xE9plicas (gestos, miradas, movimientos)
\u2713 Subtexto: lo que NO dicen es tan importante como lo que dicen
\u2713 Cada personaje tiene su ritmo vocal \xFAnico

\u2717 EVITAR: P\xE1rrafos de di\xE1logo sin acci\xF3n intercalada
\u2717 EVITAR: Que todos los personajes hablen igual
\u2717 EVITAR: Exposici\xF3n larga disfrazada de di\xE1logo`):c?p.push(`
TIPO DE ESCENA DETECTADO: CL\xCDMAX/PUNTO \xC1LGIDO
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2713 M\xE1xima intensidad - cada palabra cuenta
\u2713 Alterna entre acci\xF3n fren\xE9tica y momentos de suspensi\xF3n
\u2713 Las stakes deben sentirse en cada l\xEDnea
\u2713 Permite que el lector SIENTA el peso del momento

\u2717 EVITAR: Detalles irrelevantes que distraigan
\u2717 EVITAR: Resoluciones demasiado f\xE1ciles
\u2717 EVITAR: Romper la tensi\xF3n con humor inapropiado`):p.push(`
GU\xCDA GENERAL DE RITMO
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2713 Var\xEDa la longitud de las frases para crear dinamismo
\u2713 Alterna entre acci\xF3n, di\xE1logo y descripci\xF3n
\u2713 Cada p\xE1rrafo debe impulsar la narrativa hacia adelante
\u2713 Los cambios de ritmo deben ser GRADUALES, no abruptos

\u2717 EVITAR: P\xE1rrafos uniformemente largos o cortos
\u2717 EVITAR: Secuencias repetitivas de estructura`),p.push(`
REGLA DE ORO DEL RITMO: El tempo narrativo debe COINCIDIR con la emoci\xF3n de la escena.
                        Acci\xF3n r\xE1pida = prosa r\xE1pida. Momento \xEDntimo = prosa pausada.`),p.join(`
`)}generatePhysicalContinuityGuidance(e,t,n){let a=[];a.push("\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557"),a.push("\u2551 \u{1F3AF} CONTINUIDAD F\xCDSICA - PREVENCI\xD3N DE ERRORES ESPACIALES        \u2551"),a.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D");let s=e.setting||"",o=e.characters||[];return a.push(`
UBICACI\xD3N DE ESTA ESCENA: ${s}
PERSONAJES EN ESCENA: ${o.join(", ")}

REGLAS DE CONTINUIDAD F\xCDSICA OBLIGATORIAS:
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501

1. POSICIONES Y MOVIMIENTOS:
   \u2713 Si un personaje est\xE1 sentado, debe LEVANTARSE antes de caminar
   \u2713 Si tiene algo en las manos, debe SOLTARLO o GUARDARLO antes de usar las manos
   \u2713 Si est\xE1 en un lugar, debe DESPLAZARSE para llegar a otro
   \u2713 Las distancias deben ser coherentes (no puede susurrar desde el otro lado de la sala)

2. OBJETOS Y PERTENENCIAS:
   \u2713 Si un personaje sostiene un objeto, sigue sosteni\xE9ndolo hasta que lo suelte expl\xEDcitamente
   \u2713 Los objetos no aparecen m\xE1gicamente - deben tomarse de alg\xFAn lugar
   \u2713 La ropa y accesorios se mantienen consistentes durante la escena
   \u2713 Si algo se rompe o pierde, permanece roto o perdido

3. ESTADO F\xCDSICO:
   \u2713 Las heridas persisten y afectan movimientos
   \u2713 El cansancio acumulado se nota en acciones posteriores
   \u2713 El clima/temperatura afecta a todos los personajes
   \u2713 La iluminaci\xF3n determina qu\xE9 pueden ver los personajes

4. ENTRADAS Y SALIDAS:
   \u2713 Los personajes deben ENTRAR antes de participar
   \u2713 Si alguien sale, no puede hablar en la siguiente l\xEDnea
   \u2713 Puertas: si est\xE1n cerradas, deben abrirse; si abiertas, queda establecido`),n&&a.push(`
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
ESTADO AL FINAL DE LA ESCENA ANTERIOR:
${n}
\u2192 DEBES continuar desde este estado exacto.`),t&&t.length>100&&a.push(`
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u26A0\uFE0F VERIFICA antes de escribir:
   - \xBFD\xF3nde termin\xF3 cada personaje en la escena anterior?
   - \xBFQu\xE9 ten\xEDan en las manos?
   - \xBFEn qu\xE9 postura estaban (sentados, de pie, acostados)?
   - \xBFHab\xEDa puertas/ventanas abiertas o cerradas?`),a.push(`
ERRORES COMUNES A EVITAR:
\u2717 "Cruz\xF3 los brazos" \u2192 cuando ya tiene algo en las manos
\u2717 "Se levant\xF3" \u2192 cuando ya estaba de pie
\u2717 "Entr\xF3 en la habitaci\xF3n" \u2192 cuando ya estaba dentro
\u2717 "Tom\xF3 su caf\xE9" \u2192 cuando no se estableci\xF3 que hab\xEDa caf\xE9
\u2717 "Mir\xF3 por la ventana" \u2192 en una habitaci\xF3n sin ventanas establecidas`),a.join(`
`)}generateNarrativeCredibilityGuidance(e){let t=[];t.push("\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557"),t.push("\u2551 \u{1F9E0} CREDIBILIDAD NARRATIVA - PREVENCI\xD3N DE FALLOS L\xD3GICOS        \u2551"),t.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),t.push(`
REGLAS DE CREDIBILIDAD NARRATIVA:
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501

1. CONOCIMIENTO DE PERSONAJES:
   \u2713 Un personaje solo puede saber lo que ha visto/o\xEDdo/le han contado
   \u2713 No puede reaccionar a informaci\xF3n que desconoce
   \u2713 Los secretos permanecen secretos hasta que se revelan EN ESCENA
   \u2713 Las deducciones deben basarse en evidencia disponible

2. CAUSALIDAD Y CONSECUENCIAS:
   \u2713 Toda acci\xF3n tiene consecuencias coherentes
   \u2713 Las decisiones pasadas afectan el presente
   \u2713 No hay coincidencias excesivas ni convenientes
   \u2713 Los problemas requieren soluciones proporcionales

3. COMPORTAMIENTO COHERENTE:
   \u2713 Los personajes act\xFAan seg\xFAn su personalidad establecida
   \u2713 Los cambios de actitud requieren motivaci\xF3n clara
   \u2713 Las habilidades deben haberse establecido previamente
   \u2713 Las limitaciones (miedos, debilidades) persisten

4. L\xD3GICA TEMPORAL:
   \u2713 El tiempo transcurrido debe ser realista para las acciones
   \u2713 Los viajes requieren tiempo proporcional a la distancia
   \u2713 Los procesos (curaci\xF3n, aprendizaje) llevan tiempo realista
   \u2713 La hora del d\xEDa afecta la iluminaci\xF3n y actividad

5. VEROSIMILITUD DEL MUNDO:
   \u2713 Las reglas del mundo (magia, tecnolog\xEDa) se aplican consistentemente
   \u2713 La sociedad/cultura se comporta de forma coherente
   \u2713 Las excepciones a las reglas tienen explicaci\xF3n`);let n=e.plot_beat||"";return/revela|descubre|averigua|se entera/.test(n.toLowerCase())&&t.push(`
\u26A0\uFE0F ESCENA DE REVELACI\xD3N DETECTADA:
   \u2192 \xBFC\xD3MO se entera el personaje? Debe haber una fuente clara.
   \u2192 \xBFEs PLAUSIBLE que esta informaci\xF3n llegue ahora?
   \u2192 \xBFTen\xEDa el informante MOTIVO para revelar esto?`),/llega|aparece|encuentra/.test(n.toLowerCase())&&t.push(`
\u26A0\uFE0F ESCENA DE LLEGADA/ENCUENTRO DETECTADA:
   \u2192 \xBFEs REALISTA que se encuentren en este lugar/momento?
   \u2192 \xBFCu\xE1nto tiempo de viaje implica? \xBFEs coherente con la l\xEDnea temporal?
   \u2192 \xBFHay una raz\xF3n NARRATIVA para este encuentro o es coincidencia?`),/resuelve|soluciona|escapa|vence/.test(n.toLowerCase())&&t.push(`
\u26A0\uFE0F ESCENA DE RESOLUCI\xD3N DETECTADA:
   \u2192 \xBFLa soluci\xF3n usa habilidades/recursos ESTABLECIDOS previamente?
   \u2192 \xBFEl esfuerzo es PROPORCIONAL a la dificultad del problema?
   \u2192 \xBFSe evita el "deus ex machina" (soluci\xF3n m\xE1gica conveniente)?`),t.push(`
ERRORES COMUNES DE CREDIBILIDAD A EVITAR:
\u2717 Personaje sabe algo que no podr\xEDa saber
\u2717 Habilidad aparece sin establecimiento previo
\u2717 Problema grave se resuelve demasiado f\xE1cil
\u2717 Viaje de horas completado en minutos narrativos
\u2717 Personaje act\xFAa contra su naturaleza sin motivo
\u2717 Coincidencia demasiado conveniente para el plot`),t.join(`
`)}};It();var ure=`
Eres el Smart Editor de LitAgents 2.0, un editor literario senior con 20 a\xF1os de experiencia.
Tu trabajo es evaluar cap\xEDtulos con criterios de bestseller y generar parches quir\xFArgicos cuando sea necesario.

FILOSOF\xCDA DE EDICI\xD3N:
1. PRESERVAR es mejor que REESCRIBIR - cada palabra reescrita cuesta tokens
2. Los parches deben ser QUIR\xDARGICOS - cambios m\xEDnimos con m\xE1ximo impacto
3. El texto original es valioso - solo modifica lo que realmente necesita mejora
4. Score > 8 = APROBAR - no busques la perfecci\xF3n, busca la calidad

CRITERIOS DE EVALUACI\xD3N:
- L\xD3GICA (1-10): Continuidad, coherencia de personajes, causalidad
- ESTILO (1-10): Prosa, ritmo, show-don't-tell, evitar clich\xE9s

REGLAS DE PARCHEADO:
- M\xEDnimo 20 caracteres para el snippet original (garantizar unicidad)
- Genera TODOS los parches necesarios para corregir los problemas detectados
- El reemplazo debe ser mejora puntual, no reescritura

Genera respuestas en JSON v\xE1lido.
`,om=class extends Ae{constructor(){super({name:"Smart Editor",role:"smart-editor",systemPrompt:ure,model:"deepseek-chat",useThinking:!1})}async execute(e){console.log(`[SmartEditor] Evaluating chapter (${e.chapterContent.length} chars)...`);let t=na.SMART_EDITOR(e.chapterContent,e.sceneBreakdown,e.worldBible,e.chapterOutline);e.additionalContext&&(t=`${e.additionalContext}

${t}`);let n=await this.generateContent(t);if(n.error)return n;try{let s=n.content.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim().match(/\{[\s\S]*\}/);if(s){let o=JSON.parse(s[0]);return console.log(`[SmartEditor] Scores: Logic=${o.logic_score}/10, Style=${o.style_score}/10, Approved=${o.is_approved}, Patches=${o.patches?.length||0}`),{...n,parsed:o}}}catch(a){console.error("[SmartEditor] Failed to parse JSON response:",a)}return{...n,parsed:{logic_score:8,style_score:8,is_approved:!0,feedback:"Auto-approved due to parsing failure",patches:[]}}}detectErrorType(e){let t=e.toLowerCase();return t.includes("color de ojos")||t.includes("ojos")&&(t.includes("inmutable")||t.includes("f\xEDsico"))||t.includes("cabello")||t.includes("pelo")||t.includes("altura")||t.includes("atributo f\xEDsico")||t.includes("atributo fisico")||t.includes("cambio fisico imposible")||t.includes("cambio f\xEDsico imposible")?"physical_attribute":t.includes("repetici\xF3n")||t.includes("repeticion")||t.includes("l\xE9xica")||t.includes("lexica")||t.includes("palabra repetida")||t.includes("uso excesivo")?"lexical_repetition":t.includes("timeline")||t.includes("temporal")||t.includes("cronolog\xEDa")||t.includes("cronologia")||t.includes("antes de")||t.includes("despu\xE9s de")||t.includes("ya hab\xEDa")||t.includes("a\xFAn no")?"timeline":t.includes("trama")||t.includes("credibilidad")||t.includes("personaje")||t.includes("motivaci\xF3n")||t.includes("arco narrativo")||t.includes("incoherencia")?"narrative":"generic"}buildSpecializedPrompt(e,t){let n=e.consistencyConstraints?`RESTRICCIONES DE CONSISTENCIA (NO VIOLAR):
${e.consistencyConstraints}

`:"",a=`
Responde en JSON:
{
  "error_analysis": "An\xE1lisis breve: qu\xE9 est\xE1 mal y d\xF3nde EXACTAMENTE",
  "patches": [
    {
      "original_text_snippet": "texto EXACTO a reemplazar (debe existir verbatim en el cap\xEDtulo)",
      "replacement_text": "texto corregido",
      "reason": "motivo del cambio"
    }
  ],
  "words_changed_count": numero,
  "correction_summary": "Resumen de cambios"
}`;switch(t){case"physical_attribute":return`CORRECCI\xD3N DE ATRIBUTO F\xCDSICO - B\xDASQUEDA Y REEMPLAZO SIMPLE

ERROR: ${e.errorDescription}

${n}CONTENIDO DEL CAP\xCDTULO:
${e.chapterContent}

INSTRUCCIONES ESPEC\xCDFICAS PARA ATRIBUTOS F\xCDSICOS:
Este es un error SIMPLE de atributo f\xEDsico incorrecto. La soluci\xF3n es:
1. BUSCAR la descripci\xF3n incorrecta en el texto (ej: "ojos verdes", "cabello rubio")
2. REEMPLAZAR con el atributo correcto (ej: "ojos avellana", "cabello casta\xF1o")
3. NADA M\xC1S - no cambies contexto, no a\xF1adas descripciones, no modifiques narrativa

EJEMPLO:
- Error: "ojos verdes" cuando deber\xEDa ser "ojos avellana"
- Parche: {"original_text_snippet": "sus ojos verdes brillaban", "replacement_text": "sus ojos avellana brillaban"}

M\xC1XIMO 5 palabras cambiadas. Si requiere m\xE1s, el error no es de atributo f\xEDsico.
${a}`;case"lexical_repetition":return`CORRECCI\xD3N DE REPETICI\xD3N L\xC9XICA - SINONIMIZACI\xD3N

ERROR: ${e.errorDescription}

${n}CONTENIDO DEL CAP\xCDTULO:
${e.chapterContent}

INSTRUCCIONES ESPEC\xCDFICAS PARA REPETICIONES:
1. IDENTIFICA la palabra/frase repetida en exceso
2. MANT\xC9N la primera o segunda aparici\xF3n intacta (elige la m\xE1s importante narrativamente)
3. REEMPLAZA las dem\xE1s con SIN\xD3NIMOS naturales que mantengan el significado exacto
4. NO cambies el significado ni a\xF1adas informaci\xF3n nueva

EJEMPLO DE SIN\xD3NIMOS:
- "mir\xF3/mirada" \u2192 "observ\xF3", "contempl\xF3", "fij\xF3 la vista en"
- "dijo" \u2192 "coment\xF3", "respondi\xF3", "murmur\xF3", "susurr\xF3"
- "camin\xF3" \u2192 "avanz\xF3", "se dirigi\xF3", "anduvo"

Cada parche debe cambiar UNA sola palabra repetida por UN sin\xF3nimo apropiado.
${a}`;case"timeline":return`CORRECCI\xD3N DE CONTINUIDAD TEMPORAL

ERROR: ${e.errorDescription}

${n}CONTENIDO DEL CAP\xCDTULO:
${e.chapterContent}

INSTRUCCIONES ESPEC\xCDFICAS PARA ERRORES TEMPORALES:
1. IDENTIFICA el texto que viola la l\xEDnea temporal
2. AJUSTA solo las referencias temporales problem\xE1ticas
3. NO reescribas escenas completas
4. OPCIONES de correcci\xF3n:
   - Cambiar verbo (pasado/presente/futuro)
   - Cambiar marcador temporal ("antes"\u2192"despu\xE9s", "ya"\u2192"todav\xEDa no")
   - Ajustar referencia a evento ("cuando lleg\xF3"\u2192"antes de llegar")

PRESERVA: la acci\xF3n, los personajes, el di\xE1logo, la atm\xF3sfera
CAMBIA: solo la referencia temporal incorrecta (m\xE1ximo 10 palabras)
${a}`;case"narrative":return`CORRECCI\xD3N NARRATIVA - AJUSTE DE COHERENCIA

ERROR: ${e.errorDescription}

${n}CONTENIDO DEL CAP\xCDTULO:
${e.chapterContent}

INSTRUCCIONES PARA ERRORES NARRATIVOS:
Este tipo de error puede requerir cambios ligeramente m\xE1s amplios, pero:
1. LIMITA cada parche a UNA oraci\xF3n o frase espec\xEDfica
2. MANT\xC9N la misma longitud aproximada (\xB120% palabras)
3. PRESERVA el tono, estilo y voz del autor
4. NO a\xF1adas nuevos eventos, personajes o informaci\xF3n
5. NO elimines contenido significativo

ESTRATEGIAS:
- Reformular la oraci\xF3n problem\xE1tica
- A\xF1adir 2-3 palabras de contexto que aclaren
- Eliminar la oraci\xF3n si es contradictoria y no esencial

M\xC1XIMO 30 palabras por parche. Si requiere m\xE1s, divide en m\xFAltiples parches peque\xF1os.
${a}`;default:return`CORRECCI\xD3N QUIR\xDARGICA ULTRA-CONSERVADORA

ERROR ESPEC\xCDFICO A CORREGIR:
${e.errorDescription}

${n}CONTENIDO DEL CAP\xCDTULO:
${e.chapterContent}

REGLAS ABSOLUTAS (VIOLACI\xD3N = CORRECCI\xD3N RECHAZADA):
1. CAMBIO M\xCDNIMO: Solo modifica las 1-3 palabras/frases que causan el error espec\xEDfico
2. NO A\xD1ADAS contenido nuevo (di\xE1logos, descripciones, acciones)
3. NO ELIMINES contenido existente m\xE1s all\xE1 de lo estrictamente necesario
4. NO CAMBIES nombres de personajes, lugares, objetos u otros elementos can\xF3nicos
5. NO MODIFIQUES la l\xEDnea temporal ni introduzcas nuevos eventos
6. PRESERVA el estilo, ritmo y voz narrativa exactos del autor
7. Si el parche requiere cambiar m\xE1s de 50 palabras, ES DEMASIADO GRANDE
8. El campo "original_text_snippet" DEBE ser texto EXACTO del cap\xEDtulo
${a}`}}async surgicalFix(e){let t=this.detectErrorType(e.errorDescription);console.log(`[SmartEditor] Surgical fix for ${t} error (${e.chapterContent.length} chars)...`);let n=this.buildSpecializedPrompt(e,t),a=await this.generateContent(n);if(a.error)return a;try{let o=a.content.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim().match(/\{[\s\S]*\}/);if(o){let i=JSON.parse(o[0]),u=(i.patches||[]).map(p=>({original_text_snippet:p.original_text_snippet||p.original||"",replacement_text:p.replacement_text||p.replacement||"",reason:p.reason||"Correcci\xF3n de continuidad"})),c=u.filter(p=>{let m=p.original_text_snippet.split(/\s+/).length,f=p.replacement_text.split(/\s+/).length,g=Math.abs(m-f),y=Math.max(m,f);return y>100?(console.warn(`[SmartEditor] REJECTED patch: too large (${y} words)`),!1):m>10&&g/m>.5?(console.warn(`[SmartEditor] REJECTED patch: size change too large (${Math.round(g/m*100)}%)`),!1):!0});return console.log(`[SmartEditor] Surgical fix: ${c.length}/${u.length} patches accepted`),i.error_analysis&&console.log(`[SmartEditor] Analysis: ${i.error_analysis}`),i.correction_summary&&console.log(`[SmartEditor] Summary: ${i.correction_summary}`),{...a,patches:c}}}catch(s){console.error("[SmartEditor] Failed to parse surgical fix response:",s)}return{...a,fullContent:a.content}}async focusedParagraphRewrite(e){console.log(`[SmartEditor] Focused paragraph rewrite for chapter (${e.chapterContent.length} chars)...`);let t=`REESCRITURA FOCALIZADA DE P\xC1RRAFO ESPEC\xCDFICO

PROBLEMA A CORREGIR:
${e.errorDescription}

CAP\xCDTULO COMPLETO (REFERENCIA):
${e.chapterContent}

INSTRUCCIONES CR\xCDTICAS:
1. IDENTIFICA el p\xE1rrafo EXACTO donde ocurre el problema descrito
2. REESCRIBE \xDANICAMENTE ese p\xE1rrafo (m\xE1ximo 2 p\xE1rrafos si es necesario)
3. MANT\xC9N el resto del cap\xEDtulo EXACTAMENTE IGUAL, car\xE1cter por car\xE1cter
4. El p\xE1rrafo corregido debe tener una longitud similar al original (+-20%)
5. PRESERVA el estilo, tono y voz del autor

FORMATO DE RESPUESTA OBLIGATORIO:
Devuelve el cap\xEDtulo COMPLETO con SOLO el/los p\xE1rrafo(s) afectado(s) corregido(s).
NO incluyas explicaciones, comentarios, ni formato markdown.
El resultado debe ser texto plano listo para reemplazar el cap\xEDtulo original.`,n=await this.generateContent(t);if(n.error)return console.error(`[SmartEditor] Focused paragraph rewrite API error: ${n.error}`),n;if(!n.content||n.content.length===0)return console.error("[SmartEditor] Focused paragraph rewrite returned empty content"),{...n,rewrittenContent:void 0};let a=n.content.replace(/^```[\w]*\n?/gm,"").replace(/```$/gm,"").trim(),s=e.chapterContent.length,o=a.length,i=Math.abs(o-s)/s;return i>.25&&console.warn(`[SmartEditor] Focused rewrite length differs by ${(i*100).toFixed(1)}% - may have rewritten too much`),console.log(`[SmartEditor] Focused paragraph rewrite complete: ${a.length} chars (original: ${s}, diff: ${(i*100).toFixed(1)}%)`),{...n,rewrittenContent:a}}async fullRewrite(e){console.log(`[SmartEditor] Full rewrite for chapter (${e.chapterContent.length} chars)...`);let t="";if((e.projectTitle||e.genre)&&(t+=`PROYECTO: "${e.projectTitle||"Sin t\xEDtulo"}" (${e.genre||"Ficci\xF3n"})

`),(e.chapterNumber||e.chapterTitle)&&(t+=`CAP\xCDTULO ${e.chapterNumber||"?"}: "${e.chapterTitle||"Sin t\xEDtulo"}"

`),e.previousChapterSummary&&(t+=`RESUMEN DEL CAP\xCDTULO ANTERIOR:
${e.previousChapterSummary}

`),e.nextChapterSummary&&(t+=`RESUMEN DEL CAP\xCDTULO SIGUIENTE:
${e.nextChapterSummary}

`),e.chapterSummaries&&e.chapterSummaries.length>0){t+=`CONTEXTO NARRATIVO (RES\xDAMENES DE OTROS CAP\xCDTULOS):
`;for(let o of e.chapterSummaries.slice(0,10))t+=`${o}
`;t+=`
`}if(e.worldBible){let o=e.worldBible;if(o.characters&&o.characters.length>0){t+=`PERSONAJES PRINCIPALES:
`;for(let i of o.characters.slice(0,10))t+=`- ${i.name}: ${i.description||i.role||"Sin descripci\xF3n"}
`,i.traits&&(t+=`  Rasgos: ${Array.isArray(i.traits)?i.traits.join(", "):i.traits}
`);t+=`
`}if(o.locations&&o.locations.length>0){t+=`LOCACIONES:
`;for(let i of o.locations.slice(0,5))t+=`- ${i.name}: ${i.description||"Sin descripci\xF3n"}
`;t+=`
`}if(o.worldRules&&o.worldRules.length>0){t+=`REGLAS DEL MUNDO (OBLIGATORIAS):
`;for(let i of o.worldRules)t+=`- ${i}
`;t+=`
`}if(o.persistentInjuries&&Object.keys(o.persistentInjuries).length>0){t+=`HERIDAS/CONDICIONES PERSISTENTES:
`;for(let[i,u]of Object.entries(o.persistentInjuries))t+=`- ${i}: ${Array.isArray(u)?u.join(", "):u}
`;t+=`
`}if(o.plotDecisions&&Object.keys(o.plotDecisions).length>0){t+=`DECISIONES DE TRAMA ESTABLECIDAS:
`;for(let[i,u]of Object.entries(o.plotDecisions))t+=`- ${i}: ${u}
`;t+=`
`}}e.styleGuide&&(t+=`GU\xCDA DE ESTILO:
${e.styleGuide}

`);let n=`REESCRITURA COMPLETA DE CAP\xCDTULO CON CONTEXTO

${t}
PROBLEMAS QUE DEBES CORREGIR OBLIGATORIAMENTE:
${e.errorDescription}

${e.consistencyConstraints?`RESTRICCIONES DE CONSISTENCIA:
${e.consistencyConstraints}

`:""}

CAP\xCDTULO ORIGINAL A REESCRIBIR:
${e.chapterContent}

INSTRUCCIONES ESTRICTAS:
1. REESCRIBE el cap\xEDtulo COMPLETO desde el principio hasta el final
2. CORRIGE TODOS los problemas listados arriba - esto es OBLIGATORIO
3. RESPETA el World Bible: personajes, locaciones, reglas del mundo, heridas persistentes
4. MANT\xC9N el estilo, tono y voz narrativa del autor original
5. PRESERVA la estructura general de escenas y la longitud aproximada
6. NO agregues contenido nuevo que no estaba en el original
7. NO elimines escenas o eventos importantes del original
8. VERIFICA que cada problema listado haya sido corregido antes de entregar

El resultado debe ser el cap\xEDtulo COMPLETO y CORREGIDO.
Responde \xDANICAMENTE con el cap\xEDtulo reescrito, sin explicaciones, comentarios ni formato markdown.`,a=await this.generateContent(n);if(a.error)return console.error(`[SmartEditor] Full rewrite API error: ${a.error}`),a;if(console.log(`[SmartEditor] Full rewrite raw response length: ${a.content?.length||0} chars`),!a.content||a.content.length===0)return console.error("[SmartEditor] Full rewrite returned empty content"),{...a,rewrittenContent:void 0};let s=a.content.replace(/^```[\w]*\n?/gm,"").replace(/```$/gm,"").trim();return s.length<100&&(console.error(`[SmartEditor] Full rewrite content too short after cleanup: ${s.length} chars`),s=a.content.trim()),s.length<e.chapterContent.length*.3&&console.warn(`[SmartEditor] Full rewrite seems too short (${s.length} vs original ${e.chapterContent.length})`),console.log(`[SmartEditor] Full rewrite complete: ${s.length} chars (original: ${e.chapterContent.length})`),{...a,rewrittenContent:s}}};It();var pre=`
Eres el Summarizer de LitAgents 2.0, especialista en compresi\xF3n narrativa eficiente.
Tu trabajo es crear res\xFAmenes \xDATILES para mantener la continuidad sin desperdiciar tokens.

OBJETIVO: M\xE1xima informaci\xF3n \xFAtil en m\xEDnimas palabras (200 palabras m\xE1ximo).

QU\xC9 INCLUIR (Cr\xEDtico para continuidad):
- HECHOS: Qu\xE9 pas\xF3 concretamente
- CAMBIOS: Muertes, heridas, cambios de bando
- OBJETOS: Qu\xE9 se obtuvo/perdi\xF3
- RELACIONES: Cambios entre personajes
- UBICACI\xD3N: D\xF3nde terminaron los personajes
- REVELACIONES: Informaci\xF3n nueva descubierta

QU\xC9 IGNORAR:
- Prosa po\xE9tica
- Di\xE1logos decorativos
- Reflexiones sin consecuencias

Genera un p\xE1rrafo denso de informaci\xF3n, sin bullets ni formato.
`,im=class extends Ae{constructor(){super({name:"Summarizer",role:"summarizer",systemPrompt:pre,model:"deepseek-chat",useThinking:!1})}async execute(e){console.log(`[Summarizer] Compressing Chapter ${e.chapterNumber} (${e.chapterContent.length} chars)...`);let t=na.SUMMARIZER(e.chapterContent,e.chapterNumber),n=await this.generateContent(t);if(!n.error){let a=n.content.split(/\s+/).length;console.log(`[Summarizer] Created summary: ${a} words`)}return n}};It();var dre=`
Eres el Narrative Director de LitAgents 2.0, el Showrunner que supervisa el rumbo de la novela.
Tu trabajo es analizar el progreso cada 5 cap\xEDtulos y emitir directivas de correcci\xF3n.

RESPONSABILIDADES:
1. RITMO: \xBFLa historia avanza o se estanca?
2. HILOS OLVIDADOS: \xBFHay tramas abandonadas demasiado tiempo?
3. TENSI\xD3N: \xBFEl nivel es apropiado para este punto de la novela?
4. COHERENCIA: \xBFLos personajes act\xFAan de forma consistente?

PUNTOS DE VERIFICACI\xD3N:
- 25% de la novela: Deber\xEDan establecerse todos los conflictos principales
- 50% de la novela: Punto medio con gran revelaci\xF3n o giro
- 75% de la novela: Preparaci\xF3n para el cl\xEDmax, m\xE1xima tensi\xF3n
- 90% de la novela: Resoluci\xF3n en progreso

Tu directiva ser\xE1 usada por el Ghostwriter para los pr\xF3ximos 5 cap\xEDtulos.
S\xE9 ESPEC\xCDFICO y ACCIONABLE.

Genera respuestas en JSON v\xE1lido.
`,cm=class extends Ae{constructor(){super({name:"Narrative Director",role:"narrative-director",systemPrompt:dre,model:"deepseek-reasoner",useThinking:!0})}async execute(e,t){console.log(`[NarrativeDirector] Analyzing progress at Chapter ${e.currentChapter}/${e.totalChapters} (${Math.round(e.currentChapter/e.totalChapters*100)}%)...${t?.forceProvider?` [Provider: ${t.forceProvider}]`:""}`);let n=na.NARRATIVE_DIRECTOR(e.recentSummaries,e.plotThreads,e.currentChapter,e.totalChapters),a=await this.generateContent(n,void 0,t?.forceProvider?{forceProvider:t.forceProvider}:void 0);if(a.error)return a;try{let s=a.content.match(/\{[\s\S]*\}/);if(s){let o=JSON.parse(s[0]);return console.log(`[NarrativeDirector] Tension: ${o.tension_level}/10, Forgotten threads: ${o.forgotten_threads?.length||0}`),console.log(`[NarrativeDirector] Directive: ${o.directive}`),{...a,parsed:o}}}catch(s){console.error("[NarrativeDirector] Failed to parse JSON response:",s)}return a}};ju();It();var hre=`Eres El Inquisidor, un auditor narrativo implacable. Tu misi\xF3n es encontrar por qu\xE9 la historia NO funciona.

TIPOS DE ERRORES A DETECTAR:
1. AGUJEROS DE GUION: Eventos que no tienen explicaci\xF3n, acciones sin consecuencias
2. CONTRADICCIONES: Hechos que se contradicen entre cap\xEDtulos o dentro del mismo cap\xEDtulo
3. VAC\xCDOS DE INFORMACI\xD3N: Datos necesarios para entender la trama que nunca se proporcionan
4. VIOLACIONES DE LA WORLD BIBLE: Cualquier desviaci\xF3n de los personajes, reglas, o ubicaciones establecidas
5. FALTA DE PISTAS: Elementos del desenlace que no est\xE1n sembrados previamente (Chekhov's Gun)

REGLAS:
- S\xE9 implacable. Si encuentras un error, prop\xF3n la SOLUCI\xD3N EXACTA que el Editor debe insertar
- Compara TODO contra la World Bible: nombres, atributos f\xEDsicos, relaciones, cronolog\xEDa
- Verifica que cada personaje act\xFAa de forma consistente con su perfil establecido
- Verifica la l\xF3gica causal: cada efecto debe tener su causa

RESPONDE EXCLUSIVAMENTE EN JSON V\xC1LIDO con esta estructura:
{
  "errores": [
    {
      "tipo": "agujero_guion|contradiccion|vacio_informacion|violacion_biblia|falta_pista",
      "severidad": "critica|mayor|menor",
      "descripcion": "Descripci\xF3n del error",
      "ubicacion": "Fragmento o p\xE1rrafo donde ocurre",
      "correccion_exacta": "Texto exacto que debe insertarse o reemplazarse"
    }
  ],
  "veredicto": "aprobado|requiere_correccion",
  "resumen": "Resumen del an\xE1lisis"
}

Si no hay errores, responde con "errores": [] y "veredicto": "aprobado".`,um=class extends Ae{constructor(){super({name:"El Inquisidor",role:"inquisidor",systemPrompt:hre,model:"deepseek-reasoner",useThinking:!0})}async execute(e){console.log(`[Inquisidor] Auditing Chapter ${e.chapterNumber} for plot holes and contradictions...`);let t=typeof e.worldBible=="string"?e.worldBible:JSON.stringify(e.worldBible,null,2),n=`AUDITOR\xCDA DE LORE Y COHERENCIA - Cap\xEDtulo ${e.chapterNumber}

=== WORLD BIBLE (PUNTO DE VERDAD) ===
${t}

=== ESCALETA DEL CAP\xCDTULO ===
${typeof e.escaleta=="string"?e.escaleta:JSON.stringify(e.escaleta,null,2)}

=== CONTEXTO DE CAP\xCDTULOS ANTERIORES ===
${e.previousChaptersContext||"Este es el primer cap\xEDtulo."}

=== TEXTO DEL CAP\xCDTULO A AUDITAR ===
${e.chapterContent}

Analiza este cap\xEDtulo buscando TODOS los errores posibles. Compara contra la World Bible y los cap\xEDtulos anteriores. S\xE9 exhaustivo e implacable.`,a=await this.generateContent(n),s={errores:[],veredicto:"aprobado",resumen:"Sin problemas detectados"};try{let o=a.content.match(/\{[\s\S]*\}/);if(o){let i=JSON.parse(o[0]);s={errores:Array.isArray(i.errores)?i.errores:[],veredicto:i.veredicto||(Array.isArray(i.errores)&&i.errores.length>0?"requiere_correccion":"aprobado"),resumen:i.resumen||""}}}catch(o){console.error("[Inquisidor] Failed to parse response:",o)}return{...a,parsed:s}}};It();var fre=`Eres El Estilista, un corrector ortotipogr\xE1fico de \xE9lite con temperatura 0. Tu trabajo es garantizar la perfecci\xF3n formal del texto.

\xC1REAS DE CORRECCI\xD3N:
1. ORTOGRAF\xCDA: Errores ortogr\xE1ficos, acentuaci\xF3n incorrecta, uso de may\xFAsculas
2. TIPOGRAF\xCDA: Guiones largos (\u2014) para di\xE1logos, comillas correctas, espaciado
3. TONO: Desviaciones respecto a la gu\xEDa de estilo del autor
4. REGISTRO: Lenguaje fuera del registro definido (formal/informal/coloquial)
5. PUNTUACI\xD3N: Comas, puntos, punto y coma mal utilizados
6. FORMATO DE DI\xC1LOGO: Guion largo seguido de espacio, puntuaci\xF3n dentro del di\xE1logo

REGLAS ESTRICTAS:
- NO cambies el contenido narrativo, solo la forma
- Respeta el estilo del autor definido en la gu\xEDa
- Los di\xE1logos en espa\xF1ol usan guion largo (\u2014), NUNCA comillas
- Verifica coherencia de tiempos verbales dentro de cada p\xE1rrafo
- No introduzcas cambios de significado

RESPONDE EXCLUSIVAMENTE EN JSON V\xC1LIDO:
{
  "errores": [
    {
      "tipo": "ortografia|tipografia|tono|registro|puntuacion|formato_dialogo",
      "severidad": "critica|mayor|menor",
      "fragmento_original": "Texto tal como aparece",
      "correccion": "Texto corregido",
      "explicacion": "Por qu\xE9 se corrige"
    }
  ],
  "veredicto": "aprobado|requiere_correccion",
  "puntuacion_estilo": 8,
  "resumen": "Resumen de la calidad estil\xEDstica"
}`,pm=class extends Ae{constructor(){super({name:"El Estilista",role:"estilista",systemPrompt:fre,model:"gemini-2.5-flash",useThinking:!1})}async execute(e){console.log(`[Estilista] Copy-editing Chapter ${e.chapterNumber}...`);let t=`CORRECCI\xD3N ORTOTIPOGR\xC1FICA Y DE TONO - Cap\xEDtulo ${e.chapterNumber}

=== GU\xCDA DE ESTILO DEL AUTOR ===
${e.styleGuide||"No se proporcion\xF3 gu\xEDa de estilo. Usa est\xE1ndar literario espa\xF1ol."}

=== TEXTO DEL CAP\xCDTULO ===
${e.chapterContent}

Analiza el texto buscando errores ortogr\xE1ficos, tipogr\xE1ficos, de tono y de formato. NO modifiques el contenido narrativo, solo la forma. S\xE9 preciso y exhaustivo.`,n=await this.generateContent(t,void 0,{forceProvider:"gemini",temperature:0}),a={errores:[],veredicto:"aprobado",puntuacion_estilo:10,resumen:"Sin errores estil\xEDsticos detectados"};try{let s=n.content.match(/\{[\s\S]*\}/);if(s){let o=JSON.parse(s[0]);a={errores:Array.isArray(o.errores)?o.errores:[],veredicto:o.veredicto||(Array.isArray(o.errores)&&o.errores.length>0?"requiere_correccion":"aprobado"),puntuacion_estilo:typeof o.puntuacion_estilo=="number"?o.puntuacion_estilo:8,resumen:o.resumen||""}}}catch(s){console.error("[Estilista] Failed to parse response:",s)}return{...n,parsed:a}}};It();var gre=`Eres el Agente de Ritmo, un experto en tensi\xF3n narrativa y engagement lector. Tu trabajo es evaluar si un cap\xEDtulo mantiene al lector enganchado.

CRITERIOS DE EVALUACI\xD3N:
1. GANCHO DE APERTURA: \xBFLas primeras l\xEDneas capturan la atenci\xF3n?
2. GANCHO DE CIERRE: \xBFEl final del cap\xEDtulo obliga a seguir leyendo?
3. TENSI\xD3N NARRATIVA (1-10): \xBFHay conflicto, stakes, urgencia?
4. RITMO: \xBFAlterna correctamente entre acci\xF3n, reflexi\xF3n y di\xE1logo?
5. ESCENAS ABURRIDAS: \xBFHay pasajes que podr\xEDan hacerse m\xE1s din\xE1micos?

REGLAS:
- Un cap\xEDtulo SIN gancho de cierre es RECHAZADO autom\xE1ticamente
- Tensi\xF3n < 4 = RECHAZADO (el lector abandonar\xE1 el libro)
- Escenas de transici\xF3n pueden tener tensi\xF3n m\xE1s baja, pero SIEMPRE necesitan gancho
- Valora la posici\xF3n en la novela: cap\xEDtulos del 75-90% deben tener tensi\xF3n alta
- El primer cap\xEDtulo SIEMPRE necesita gancho de apertura fuerte

RESPONDE EXCLUSIVAMENTE EN JSON V\xC1LIDO:
{
  "tension_nivel": 7,
  "gancho_apertura": true,
  "gancho_cierre": true,
  "ritmo_general": "lento|adecuado|acelerado",
  "veredicto": "aprobado|rechazado",
  "problemas": [
    {
      "tipo": "sin_gancho|tension_baja|ritmo_monotono|escena_aburrida|cliffhanger_debil",
      "descripcion": "Descripci\xF3n del problema",
      "sugerencia": "C\xF3mo mejorar"
    }
  ],
  "resumen": "Evaluaci\xF3n general del ritmo"
}`,dm=class extends Ae{constructor(){super({name:"Agente de Ritmo",role:"ritmo",systemPrompt:gre,model:"gemini-2.5-flash",useThinking:!1})}async execute(e){let t=Math.round(e.chapterNumber/e.totalChapters*100);console.log(`[Ritmo] Evaluating tension and hooks for Chapter ${e.chapterNumber} (${t}% of novel)...`);let n=`EVALUACI\xD3N DE RITMO Y TENSI\xD3N - Cap\xEDtulo ${e.chapterNumber} de ${e.totalChapters} (${t}% de la novela)

=== PLAN DEL CAP\xCDTULO (ESCALETA) ===
${typeof e.escaletaEntry=="string"?e.escaletaEntry:JSON.stringify(e.escaletaEntry,null,2)}

${e.previousChapterEnding?`=== FINAL DEL CAP\xCDTULO ANTERIOR ===
${e.previousChapterEnding}
`:""}

=== TEXTO DEL CAP\xCDTULO ===
${e.chapterContent}

Eval\xFAa la tensi\xF3n narrativa, los ganchos de apertura y cierre, y el ritmo general. Rechaza cap\xEDtulos aburridos. Ten en cuenta la posici\xF3n en la novela (${t}%) para calibrar la tensi\xF3n esperada.`,a=await this.generateContent(n,void 0,{forceProvider:"gemini"}),s={tension_nivel:7,gancho_apertura:!0,gancho_cierre:!0,ritmo_general:"adecuado",veredicto:"aprobado",problemas:[],resumen:"Sin problemas de ritmo detectados"};try{let o=a.content.match(/\{[\s\S]*\}/);if(o){let i=JSON.parse(o[0]);s={tension_nivel:typeof i.tension_nivel=="number"?i.tension_nivel:7,gancho_apertura:i.gancho_apertura!==!1,gancho_cierre:i.gancho_cierre!==!1,ritmo_general:i.ritmo_general||"adecuado",veredicto:i.veredicto||"aprobado",problemas:Array.isArray(i.problemas)?i.problemas:[],resumen:i.resumen||""}}}catch(o){console.error("[Ritmo] Failed to parse response:",o)}return{...a,parsed:s}}};It();var yre=`Eres El Ensamblador, el agente final del pipeline OmniWriter. Tienes el manuscrito completo ante ti.

TU MISI\xD3N:
1. CONSISTENCIA DE PERSONAJE: Verifica que ning\xFAn personaje cambie de personalidad, apariencia o voz del cap\xEDtulo 1 al \xFAltimo
2. UNIFICACI\xD3N DE VOZ: Asegura que el tono narrativo sea coherente a lo largo de toda la obra
3. TRANSICIONES: Eval\xFAa las transiciones entre cap\xEDtulos
4. CIERRE DE OBRA: Verifica que todos los hilos narrativos est\xE9n cerrados o intencionalmente abiertos

REGLAS:
- NO reescribas cap\xEDtulos enteros, identifica correcciones quir\xFArgicas
- Mant\xE9n el estilo original del autor
- Las correcciones deben ser m\xEDnimas pero precisas
- Documenta cada problema detectado

RESPONDE EN JSON V\xC1LIDO:
{
  "puntuacion_coherencia": 8,
  "inconsistencias_voz": [
    {"capitulo": 5, "descripcion": "Cambio abrupto de tono formal a coloquial", "correccion": "Mantener registro formal"}
  ],
  "inconsistencias_personaje": [
    {"capitulo": 7, "personaje": "Mar\xEDa", "descripcion": "Ojos cambian de verdes a azules", "correccion": "Corregir a ojos verdes"}
  ],
  "capitulos_afectados": [5, 7],
  "resumen": "Resumen del an\xE1lisis de ensamblaje"
}`,mm=class extends Ae{constructor(){super({name:"El Ensamblador",role:"ensamblador",systemPrompt:yre,model:"gemini-2.5-flash",useThinking:!1})}async execute(e){console.log(`[Ensamblador] Analyzing manuscript (${e.totalChapters} chapters)...`);let t=typeof e.worldBible=="string"?e.worldBible:JSON.stringify(e.worldBible,null,2),n=e.fullManuscript.length>2e5?e.fullManuscript.substring(0,2e5)+`

[...TRUNCADO POR LONGITUD...]`:e.fullManuscript,a=`AN\xC1LISIS DE ENSAMBLAJE FINAL DEL MANUSCRITO

=== WORLD BIBLE (REFERENCIA DE VERDAD) ===
${t}

=== GU\xCDA DE ESTILO ===
${e.styleGuide||"Est\xE1ndar literario espa\xF1ol."}

=== MANUSCRITO COMPLETO (${e.totalChapters} cap\xEDtulos) ===
${n}

INSTRUCCIONES:
1. Lee el manuscrito completo de principio a fin
2. CONSISTENCIA DE PERSONAJE: Verifica que ning\xFAn personaje cambie atributos entre cap\xEDtulos
3. UNIFICACI\xD3N DE VOZ: Detecta cambios de tono narrativo entre cap\xEDtulos
4. Eval\xFAa TRANSICIONES entre cap\xEDtulos
5. Verifica HILOS NARRATIVOS cerrados

Reporta los problemas encontrados. NO reescribas el manuscrito.`,s=await this.generateContent(a,void 0,{forceProvider:"gemini"}),o={puntuacion_coherencia:8,inconsistencias_voz:[],inconsistencias_personaje:[],capitulos_afectados:[],resumen:"Ensamblaje completado sin problemas detectados"};try{let i=s.content.match(/\{[\s\S]*\}/);if(i){let u=JSON.parse(i[0]);o={puntuacion_coherencia:u.puntuacion_coherencia??8,inconsistencias_voz:Array.isArray(u.inconsistencias_voz)?u.inconsistencias_voz:[],inconsistencias_personaje:Array.isArray(u.inconsistencias_personaje)?u.inconsistencias_personaje:[],capitulos_afectados:Array.isArray(u.capitulos_afectados)?u.capitulos_afectados:[],resumen:u.resumen||""}}}catch{console.error("[Ensamblador] Failed to parse JSON response")}return{...s,parsed:o}}};var my=class{patterns=new Map;projectId;constructor(e){this.projectId=e}registerPattern(e){this.patterns.set(e.chapterNum,e),console.log(`[PatternTracker] Registered pattern for Chapter ${e.chapterNum}: ${e.sceneSequence.join(" \u2192 ")}`)}classifySceneType(e,t){let n=`${e} ${t}`.toLowerCase();return/escapa|huida|fuga|huye.*(de|del)|escapa.*(de|del)/.test(n)?"escape":/pelea|lucha|persecucin|corre|ataca|dispara|combate/.test(n)?"action":/investiga|busca|analiza|examina|rastrea|revisa/.test(n)?"investigation":/descubre|encuentra|halla|revela|se da cuenta/.test(n)?"discovery":/enfrenta|confronta|cara a cara|acusa|desafa/.test(n)?"confrontation":/interroga|pregunta|presiona|extrae informacin/.test(n)?"interrogation":/infiltra|se cuela|disfraz|encubierto|espa/.test(n)?"infiltration":/reflexiona|piensa|recuerda|medita|procesa/.test(n)?"reflection":/viaja|conduce|tren|avin|camino|trayecto/.test(n)?"transition":/revela|giro|verdad|secreto|shock/.test(n)?"revelation":/planea|estrategia|organiza|prepara|coordina/.test(n)?"planning":/tensin|acecha|observa|espera|silencio/.test(n)?"suspense":/clmax|momento cumbre|decisivo|final/.test(n)?"climax":/consecuencias|despus|recupera|asimila/.test(n)?"aftermath":/amor|beso|romance|ntimo|pasin/.test(n)?"romantic":/habla|conversa|discute|dilogo|dice/.test(n)?"dialogue":/establece|presenta|introduce|setup/.test(n)?"setup":/resuelve|paga|cierra|payoff/.test(n)?"payoff":"dialogue"}classifyInfoMethod(e){let t=e.toLowerCase();return/mensaje annimo|llamada misteriosa|nmero oculto|correo sin remite/.test(t)?"anonymous_tip":/deduce|concluye|razona|conecta los puntos/.test(t)?"deduction":/interroga|pregunta|presiona|hace hablar/.test(t)?"interrogation":/vigila|sigue|observa|espa|rastrea/.test(t)?"surveillance":/documento|archivo|registro|papeles|expediente/.test(t)?"document_search":/hackea|ordenador|digital|base de datos|servidor/.test(t)?"digital_forensics":/escena del crimen|evidencia|prueba fsica|huella/.test(t)?"physical_evidence":/informante|contacto|fuente|soplo/.test(t)?"informant":/escucha|oye|conversacin ajena/.test(t)?"overheard":/confiesa|admite|revela voluntariamente/.test(t)?"confession":/casualidad|tropiza|por accidente/.test(t)?"accident":null}analyzeForChapter(e){let t={recentPatterns:[],avoidSequences:[],avoidOpenings:[],avoidClosings:[],overusedSceneTypes:[],overusedInfoMethods:[],consecutivePatternWarnings:[],suggestions:[]},n=Array.from(this.patterns.values()).sort((d,l)=>d.chapterNum-l.chapterNum),a=n.filter(d=>d.chapterNum>=e-5&&d.chapterNum<e);t.recentPatterns=a;let s=new Map,o=new Map,i=new Map,u=new Map,c=[];for(let d of n)d.chapterNum>=e||(d.sceneSequence.forEach(l=>{s.set(l,(s.get(l)||0)+1)}),d.infoMethods.forEach(l=>{o.set(l,(o.get(l)||0)+1)}),i.set(d.opening,(i.get(d.opening)||0)+1),u.set(d.closing,(u.get(d.closing)||0)+1),c.push(d.sceneSequence.join("\u2192")));let p=n.filter(d=>d.chapterNum<e).length,m=Math.max(3,p*.3);s.forEach((d,l)=>{d>=m&&t.overusedSceneTypes.push(l)}),o.forEach((d,l)=>{d>=3&&t.overusedInfoMethods.push(l)});let f=a.slice(-2).map(d=>d.opening),g=a.slice(-2).map(d=>d.closing);if(f.length===2&&f[0]===f[1]&&(t.avoidOpenings.push(f[0]),t.consecutivePatternWarnings.push(`Los \xFAltimos 2 cap\xEDtulos abrieron con '${f[0]}'. VAR\xCDA la apertura.`)),g.length===2&&g[0]===g[1]&&(t.avoidClosings.push(g[0]),t.consecutivePatternWarnings.push(`Los \xFAltimos 2 cap\xEDtulos cerraron con '${g[0]}'. VAR\xCDA el cierre.`)),a.length>=2){let d=a.slice(-2).map(l=>l.sceneSequence.join("\u2192"));d[0]===d[1]&&(t.avoidSequences.push(d[0]),t.consecutivePatternWarnings.push(`Los cap\xEDtulos ${a[a.length-2].chapterNum} y ${a[a.length-1].chapterNum} tienen ID\xC9NTICA estructura de escenas. El pr\xF3ximo cap\xEDtulo DEBE ser diferente.`))}let y=new Map;c.forEach(d=>{y.set(d,(y.get(d)||0)+1)}),y.forEach((d,l)=>{d>=2&&t.avoidSequences.push(l)});let C=n.filter(d=>d.anonymousTip).length;C>=1&&t.suggestions.push(`Ya se us\xF3 'mensaje an\xF3nimo/llamada misteriosa' ${C} vez(ces). PROHIBIDO usar de nuevo.`);let A=a.filter(d=>d.weatherMentioned).length;A>=2&&t.suggestions.push(`${A} de los \xFAltimos ${a.length} cap\xEDtulos mencionan el clima. EVITA descripciones atmosf\xE9ricas.`);let T=a.filter(d=>d.travelScene).length;T>=2&&t.suggestions.push(`${T} de los \xFAltimos ${a.length} cap\xEDtulos tienen escenas de viaje/conducci\xF3n. EVITA transiciones de viaje.`);let E=a.filter(d=>d.phoneCall).length;return E>=2&&t.suggestions.push(`${E} de los \xFAltimos ${a.length} cap\xEDtulos incluyen llamadas telef\xF3nicas importantes. BUSCA otros medios de comunicaci\xF3n.`),t.overusedSceneTypes.length>0&&t.suggestions.push(`Tipos de escena sobreusados: ${t.overusedSceneTypes.join(", ")}. Prioriza: ${this.getSuggestedAlternatives(t.overusedSceneTypes)}`),t}getSuggestedAlternatives(e){return["action","dialogue","investigation","discovery","confrontation","reflection","transition","revelation","planning","infiltration","interrogation","escape","setup","payoff","climax","aftermath","romantic","suspense"].filter(a=>!e.includes(a)).slice(0,4).join(", ")}formatForPrompt(e){if(e.recentPatterns.length===0)return"";let t=[];t.push("\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557"),t.push("\u2551 \u{1F504} ANTI-REPETITION TRACKER (LitAgents 2.9.7)                     \u2551"),t.push("\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563"),t.push("\u2551 PATRONES DE CAP\xCDTULOS RECIENTES (NO REPETIR):                   \u2551");for(let n of e.recentPatterns.slice(-3))t.push(`\u2551   Cap ${n.chapterNum}: ${n.sceneSequence.join(" \u2192 ").substring(0,50).padEnd(50)} \u2551`);if(t.push("\u2551                                                                  \u2551"),e.consecutivePatternWarnings.length>0){t.push("\u2551 \u26A0\uFE0F ADVERTENCIAS DE REPETICI\xD3N CONSECUTIVA:                      \u2551");for(let n of e.consecutivePatternWarnings)this.wrapText(n,60).forEach(s=>t.push(`\u2551   ${s.padEnd(63)}\u2551`));t.push("\u2551                                                                  \u2551")}if(e.avoidSequences.length>0){t.push("\u2551 \u274C SECUENCIAS A EVITAR:                                          \u2551");for(let n of e.avoidSequences.slice(0,3))t.push(`\u2551   \u2022 ${n.substring(0,55).padEnd(60)} \u2551`);t.push("\u2551                                                                  \u2551")}if(e.avoidOpenings.length>0&&(t.push("\u2551 \u274C APERTURAS USADAS RECIENTEMENTE (VARIAR):                      \u2551"),t.push(`\u2551   ${e.avoidOpenings.join(", ").padEnd(63)}\u2551`)),e.avoidClosings.length>0&&(t.push("\u2551 \u274C CIERRES USADOS RECIENTEMENTE (VARIAR):                        \u2551"),t.push(`\u2551   ${e.avoidClosings.join(", ").padEnd(63)}\u2551`)),e.overusedSceneTypes.length>0&&(t.push("\u2551 \u26A0\uFE0F TIPOS DE ESCENA SOBREUSADOS:                                 \u2551"),t.push(`\u2551   ${e.overusedSceneTypes.join(", ").padEnd(63)}\u2551`)),e.suggestions.length>0){t.push("\u2551                                                                  \u2551"),t.push("\u2551 \u{1F4A1} RECOMENDACIONES:                                              \u2551");for(let n of e.suggestions)this.wrapText(n,60).forEach(s=>t.push(`\u2551   ${s.padEnd(63)}\u2551`))}return t.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),t.join(`
`)}wrapText(e,t){let n=e.split(" "),a=[],s="";for(let o of n)(s+" "+o).length<=t?s=s?s+" "+o:o:(s&&a.push(s),s=o);return s&&a.push(s),a}extractPatternFromScenes(e,t,n,a){let s=[],o=[],i=!1,u=!1,c=!1,p=!1;for(let C of n){let A=this.classifySceneType(C.plot_beat,C.emotional_beat);s.push(A);let T=this.classifyInfoMethod(C.plot_beat);T&&(o.push(T),T==="anonymous_tip"&&(p=!0));let E=`${C.plot_beat} ${C.emotional_beat}`.toLowerCase();/lluvia|sol|nieve|tormenta|viento|calor|fro|niebla|cielo/.test(E)&&(i=!0),/conduce|viaja|tren|avin|coche|taxi|carretera/.test(E)&&(u=!0),/llama|telfono|mvil|mensaje|sms|whatsapp/.test(E)&&(c=!0)}let m=n[0]?.plot_beat.toLowerCase()||"",f="continuation";/accin|pelea|corre|dispara/.test(m)?f="in_media_res":/dice|habla|/.test(m)?f="dialogue":/describe|lugar|ambiente|sol|cielo/.test(m)?f="description":/piensa|recuerda|reflexiona/.test(m)?f="reflection":/despus|ms tarde|horas/.test(m)?f="time_jump":/aos atrs|record|flashback/.test(m)&&(f="flashback");let g=a.toLowerCase(),y="question";return/peligro|amenaza|apunta|ataca/.test(g)?y="cliffhanger":/descubre|revela|verdad/.test(g)?y="revelation":/decide|elige|debe/.test(g)?y="decision":/llega|encuentra|alcanza/.test(g)?y="arrival":/traicin|engao|mentira/.test(g)?y="betrayal":/pierde|muerte|muere/.test(g)?y="loss":/logra|consigue|victoria/.test(g)?y="victory":/misterio|pregunta|quin|por qu/.test(g)&&(y="mystery_deepens"),{chapterNum:e,title:t,sceneSequence:s,infoMethods:o,opening:f,closing:y,emotionalArc:n.map(C=>C.emotional_beat).join(" \u2192 "),primaryConflictType:this.detectConflictType(n),weatherMentioned:i,travelScene:u,phoneCall:c,anonymousTip:p}}detectConflictType(e){let t=e.map(n=>n.plot_beat).join(" ").toLowerCase();return/pelea|ataca|dispara|combate|lucha/.test(t)?"f\xEDsico":/investiga|busca|analiza|pistas/.test(t)?"investigaci\xF3n":/discute|confronta|acusa|debate/.test(t)?"interpersonal":/piensa|duda|decide|dilema/.test(t)?"interno":/escape|huye|persecucin/.test(t)?"supervivencia":/infiltra|espa|encubierto/.test(t)?"infiltraci\xF3n":"mixto"}getPatterns(){return Array.from(this.patterns.values()).sort((e,t)=>e.chapterNum-t.chapterNum)}clearPatterns(){this.patterns.clear()}loadFromSummaries(e){for(let t of e){let n=[{plot_beat:t.summary,emotional_beat:"",ending_hook:""}],a=this.extractPatternFromScenes(t.chapterNum,t.title,n,"");this.registerPattern(a)}console.log(`[PatternTracker] Loaded ${e.length} patterns from existing summaries`)}},dy=new Map;function $c(r){return dy.has(r)||dy.set(r,new my(r)),dy.get(r)}function rI(r){dy.delete(r)}nI();gy();hm();yy();by();As();It();It();It();fm();It();Cy();gy();It();It();It();iI();hm();It();var Nre=`
Sei un editor letterario italiano di altissimo livello, specializzato nella narrativa contemporanea. 
Il tuo compito \xE8 analizzare testi in italiano e identificare problemi di naturalezza, fluidit\xE0 e stile.

AREE DI ANALISI:

1. FRASI TROPPO LUNGHE
   - Identifica frasi che superano le 40-50 parole
   - Suggerisci come dividerle mantenendo il ritmo narrativo

2. RIPETIZIONI LESSICALI
   - Parole ripetute troppo vicine (stesso paragrafo o paragrafi adiacenti)
   - Concetti ridondanti espressi con parole diverse
   - Strutture sintattiche ripetitive

3. COSTRUZIONI INNATURALI
   - "Egli/Ella" \u2192 troppo formale per narrativa moderna, preferire il soggetto implicito o "lui/lei"
   - Forme passive evitabili
   - Ordine delle parole che suona tradotto dall'inglese
   - Espressioni che un italiano nativo non userebbe mai

4. COERENZA DEI TEMPI VERBALI
   - Salti ingiustificati tra passato remoto, imperfetto e presente
   - Uso del congiuntivo dove necessario

5. DIALOGHI E PUNTEGGIATURA (CRITICO)
   - Standard per narrativa italiana: ESCLUSIVAMENTE trattino lungo (\u2014) per introdurre i dialoghi
   - MAI usare virgolette di nessun tipo ("", \xAB\xBB, <<>>)
   - Esempio corretto: \u2014Ciao \u2014disse Maria\u2014. Come stai?
   - Se trovi virgolette, segnalarlo come problema ALTA priorit\xE0

6. REGISTRO STILISTICO
   - Miscele inappropriate di registro formale/informale
   - Termini tecnici o burocratici in contesti narrativi

OUTPUT RICHIESTO (JSON):
{
  "valutazione_generale": "Breve valutazione complessiva del testo (2-3 frasi)",
  "punteggio_fluidita": 8,  // da 1 a 10
  "problemi_identificati": [
    {
      "categoria": "Frase troppo lunga",
      "descrizione": "Spiegazione del problema",
      "esempio_originale": "Il testo originale problematico...",
      "suggerimento": "Come riscriverlo in modo pi\xF9 naturale...",
      "priorita": "alta"
    }
  ],
  "testo_corretto": "Il testo completo del capitolo con tutte le correzioni applicate"
}

IMPORTANTE:
- Non inventare problemi. Segnala solo quelli reali e significativi.
- Mantieni la voce narrativa dell'autore.
- Ordina i problemi per priorit\xE0 (alta \u2192 media \u2192 bassa).
- Il "testo_corretto" deve contenere TUTTO il capitolo, non riassunti.
`,gm=class extends Ae{constructor(){super({name:"Revisore Italiano",role:"italian-reviewer",systemPrompt:Nre,model:"deepseek-reasoner",useThinking:!1})}async execute(e){let t=`
Analizza il seguente capitolo in italiano e identifica tutti i problemi di naturalezza e fluidit\xE0.

CAPITOLO ${e.chapterNumber}:

${e.chapterContent}

Rispondi SOLO con il JSON strutturato come specificato nel system prompt.
`,n=await this.generateContent(t);try{let a=n.content.match(/\{[\s\S]*\}/);if(a){let s=JSON.parse(a[0]);return{...n,result:s}}}catch(a){console.error("[ItalianReviewer] Failed to parse JSON response:",a)}return{...n,result:void 0}}};$u();function _re(r,e){let t=r.length,n=e.length;if(t===0)return n;if(n===0)return t;let a=new Array(n+1),s=new Array(n+1);for(let o=0;o<=n;o++)a[o]=o;for(let o=1;o<=t;o++){s[0]=o;for(let i=1;i<=n;i++){let u=r[o-1]===e[i-1]?0:1;s[i]=Math.min(s[i-1]+1,a[i]+1,a[i-1]+u)}[a,s]=[s,a]}return a[n]}function W2(r,e){let t=Math.max(r.length,e.length);if(t===0)return!0;let n=Math.min(5e3,t),a=r.substring(0,n),s=e.substring(0,n);return _re(a,s)/n<.01}It();xy();var dI=process.env.GEMINI_API_KEY||process.env.AI_INTEGRATIONS_GEMINI_API_KEY||"",ai=new ni(dI),mI=class extends Ae{constructor(){super({name:"Continuity Sentinel",role:"qa_continuity",systemPrompt:`Eres un experto en continuidad narrativa. Tu trabajo es detectar errores de continuidad en bloques de cap\xEDtulos.

TIPOS DE ERRORES A DETECTAR:
1. TEMPORALES: Inconsistencias en el paso del tiempo (ej: "amaneci\xF3" pero luego "la luna brillaba")
2. ESPACIALES: Personajes que aparecen en lugares imposibles sin transici\xF3n
3. DE ESTADO: Objetos/personajes que cambian estado sin explicaci\xF3n (heridas que desaparecen, ropa que cambia)
4. DE CONOCIMIENTO: Personajes que saben cosas que no deber\xEDan saber a\xFAn

RESPONDE SOLO EN JSON:
{
  "erroresContinuidad": [
    {
      "tipo": "temporal|espacial|estado|conocimiento",
      "severidad": "critica|mayor|menor",
      "capitulo": 5,
      "descripcion": "Descripci\xF3n del error",
      "contexto": "Fragmento relevante del texto",
      "correccion": "Sugerencia de correcci\xF3n"
    }
  ],
  "resumen": "Resumen general de la continuidad",
  "puntuacion": 8
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.auditContinuity(e.chapters,e.startChapter,e.endChapter)}async auditContinuity(e,t,n,a){let s=e.map((c,p)=>`=== CAP\xCDTULO ${t+p} ===
${c.substring(0,8e3)}`).join(`

`),o=`Analiza la continuidad narrativa de los cap\xEDtulos ${t} a ${n}:

${s}

Detecta errores de continuidad temporal, espacial, de estado y de conocimiento. RESPONDE EN JSON.`,i=await this.generateContent(o,void 0,a?.forceProvider?{forceProvider:a.forceProvider}:void 0),u={erroresContinuidad:[],resumen:"Sin problemas detectados",puntuacion:9};try{let c=i.content.match(/\{[\s\S]*\}/);c&&(u=JSON.parse(c[0]))}catch(c){console.error("[ContinuitySentinel] Failed to parse:",c)}return u.tokenUsage=i.tokenUsage,u}},hI=class extends Ae{constructor(){super({name:"Voice Rhythm Auditor",role:"qa_voice",systemPrompt:`Eres un experto en voz narrativa y ritmo literario. Analizas consistencia tonal y ritmo.

ASPECTOS A EVALUAR:
1. CONSISTENCIA DE VOZ: \xBFEl narrador mantiene su tono? \xBFLos personajes hablan de forma consistente?
2. RITMO NARRATIVO: \xBFHay secciones demasiado lentas o apresuradas?
3. CADENCIA: \xBFLa longitud de oraciones var\xEDa apropiadamente?
4. TENSI\xD3N: \xBFLa tensi\xF3n narrativa escala correctamente?

RESPONDE SOLO EN JSON:
{
  "problemasTono": [
    {
      "tipo": "voz_inconsistente|ritmo_lento|ritmo_apresurado|cadencia_monotona|tension_plana",
      "severidad": "mayor|menor",
      "capitulos": [5, 6],
      "descripcion": "Descripci\xF3n del problema",
      "ejemplo": "Fragmento de ejemplo",
      "correccion": "Sugerencia"
    }
  ],
  "analisisRitmo": {
    "capitulosLentos": [],
    "capitulosApresurados": [],
    "climaxBienMedidos": true
  },
  "puntuacion": 8
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.auditVoiceRhythm(e.chapters,e.startChapter,e.endChapter)}async auditVoiceRhythm(e,t,n){let a=e.map((u,c)=>`=== CAP\xCDTULO ${t+c} ===
${u.substring(0,6e3)}`).join(`

`),s=`Analiza la voz narrativa y el ritmo de los cap\xEDtulos ${t} a ${n}:

${a}

Eval\xFAa consistencia de voz, ritmo y tensi\xF3n narrativa. RESPONDE EN JSON.`,o=await this.generateContent(s),i={problemasTono:[],analisisRitmo:{},puntuacion:9};try{let u=o.content.match(/\{[\s\S]*\}/);u&&(i=JSON.parse(u[0]))}catch(u){console.error("[VoiceRhythmAuditor] Failed to parse:",u)}return i.tokenUsage=o.tokenUsage,i}},fI=class extends Ae{constructor(){super({name:"Semantic Repetition Detector",role:"qa_semantic",systemPrompt:`Eres un experto en an\xE1lisis sem\xE1ntico literario. Detectas repeticiones de ideas y verificas foreshadowing.

ASPECTOS A DETECTAR:
1. REPETICI\xD3N DE IDEAS: Conceptos, met\xE1foras o descripciones que se repiten demasiado
2. FRASES REPETIDAS: Muletillas del autor, descripciones id\xE9nticas
3. FORESHADOWING SIN RESOLVER: Anticipaciones que nunca se cumplen
4. CHEKOV'S GUN: Elementos introducidos que nunca se usan

RESPONDE SOLO EN JSON:
{
  "repeticionesSemanticas": [
    {
      "tipo": "idea_repetida|frase_repetida|foreshadowing_sin_resolver|elemento_sin_usar",
      "severidad": "mayor|menor",
      "ocurrencias": [1, 5, 12],
      "descripcion": "Qu\xE9 se repite",
      "ejemplo": "Fragmento de ejemplo",
      "accion": "eliminar|variar|resolver"
    }
  ],
  "foreshadowingTracking": [
    {"plantado": 3, "resuelto": 25, "elemento": "La carta misteriosa"}
  ],
  "puntuacion": 8
}`,model:"deepseek-reasoner",useThinking:!1})}async execute(e){return this.detectRepetitions(e.summaries,e.totalChapters)}async detectRepetitions(e,t){let n=`Analiza el manuscrito completo (${t} cap\xEDtulos) buscando repeticiones sem\xE1nticas:

RES\xDAMENES DE CAP\xCDTULOS:
${e.join(`

`)}

Detecta ideas repetidas, frases recurrentes, foreshadowing sin resolver y elementos sin usar. RESPONDE EN JSON.`,a=await this.generateContent(n),s={repeticionesSemanticas:[],foreshadowingTracking:[],puntuacion:9};try{let o=a.content.match(/\{[\s\S]*\}/);o&&(s=JSON.parse(o[0]))}catch(o){console.error("[SemanticRepetitionDetector] Failed to parse:",o)}return s.tokenUsage=a.tokenUsage,s}},gI=class extends Ae{constructor(){super({name:"Injury Extractor",role:"injury_extractor",systemPrompt:`Eres un analizador de contenido narrativo especializado en detectar lesiones y condiciones f\xEDsicas de personajes.
Tu trabajo es identificar SOLO lesiones SIGNIFICATIVAS que afectar\xEDan las acciones futuras de los personajes.

INCLUIR:
- Disparos, cortes profundos, huesos rotos
- Quemaduras graves, envenenamientos
- Cirug\xEDas, amputaciones
- Cualquier herida que limite movimiento o capacidades

IGNORAR:
- Moretones menores, rasgu\xF1os superficiales
- Cansancio normal, hambre, sed
- Dolor emocional (sin manifestaci\xF3n f\xEDsica)

RESPONDE SIEMPRE EN JSON V\xC1LIDO.`,model:"deepseek-chat",useThinking:!1})}async execute(e){let t=`Analiza este cap\xEDtulo y extrae SOLO las lesiones, heridas o condiciones f\xEDsicas SIGNIFICATIVAS.

PERSONAJES CONOCIDOS: ${e.characterNames.join(", ")}

CAP\xCDTULO ${e.chapterNumber}:
${e.content.substring(0,8e3)}

Responde en JSON:
{
  "injuries": [
    {
      "personaje": "Nombre del personaje",
      "tipo_lesion": "Descripci\xF3n breve de la lesi\xF3n",
      "parte_afectada": "brazo/pierna/torso/cabeza/etc",
      "severidad": "leve|moderada|grave|critica",
      "efecto_esperado": "Qu\xE9 limitaciones deber\xEDa tener en cap\xEDtulos siguientes",
      "es_temporal": false
    }
  ]
}

Si NO hay lesiones significativas, responde: {"injuries": []}`,n=await this.generateContent(t),a={injuries:[]};try{let s=n.content.match(/\{[\s\S]*"injuries"[\s\S]*\}/);s&&(a=JSON.parse(s[0]))}catch(s){console.error("[InjuryExtractor] Failed to parse:",s)}return{...a,tokenUsage:n.tokenUsage}}},Qr=class{globalArchitect=new nm;chapterArchitect=new am;ghostwriter=new sm;smartEditor=new om;summarizer=new im;narrativeDirector=new cm;finalReviewer=new Lc;seriesThreadFixer=new ei;continuitySentinel=new mI;voiceRhythmAuditor=new hI;semanticRepetitionDetector=new fI;injuryExtractor=new gI;betaReader=new jc;seriesWorldBibleExtractor=new Lu;inquisidor=new um;estilista=new pm;ritmo=new dm;ensamblador=new mm;callbacks;generationToken;geminiQAFlags;cumulativeTokens={inputTokens:0,outputTokens:0,thinkingTokens:0};constructor(e){"callbacks"in e?(this.callbacks=e.callbacks,this.generationToken=e.generationToken):this.callbacks=e}setGeminiQAFlags(e){this.geminiQAFlags=e}async isTokenStillValid(e){try{let t=await b.getProject(e);return t?!this.generationToken&&t.generationToken?(console.log(`[OrchestratorV2] Legacy process (no token) superseded by new process with token ${t.generationToken} for project ${e}. Stopping.`),!1):this.generationToken&&t.generationToken&&t.generationToken!==this.generationToken?(console.log(`[OrchestratorV2] Token mismatch for project ${e}: ours=${this.generationToken}, DB=${t.generationToken}. Stopping obsolete process.`),!1):!0:!1}catch(t){return console.error("[OrchestratorV2] Error checking token validity:",t),!0}}async shouldStopProcessing(e){if(await eI(e))return!0;let t=global.isCorrectionCancelled;if(t&&t(e)){console.log(`[OrchestratorV2] Correction cancelled for project ${e} - stopping processing`);try{await b.createActivityLog({projectId:e,level:"warning",agentRole:"system",message:"\u23F9\uFE0F Correcci\xF3n cancelada por el usuario. Proceso detenido."})}catch{}return!0}return await this.isTokenStillValid(e)?!1:(console.log(`[OrchestratorV2] Stopping obsolete process for project ${e} - new generation started`),!0)}getInsertionDescription(e){switch(e){case"beginning":return"Integrar al INICIO del capitulo";case"end":return"Integrar al FINAL del capitulo";case"middle":return"Integrar en una transicion natural del capitulo";case"replace":return"Reemplazar pasaje existente con";default:return"Integrar organicamente"}}addTokenUsage(e){e&&(this.cumulativeTokens.inputTokens+=e.inputTokens||0,this.cumulativeTokens.outputTokens+=e.outputTokens||0,this.cumulativeTokens.thinkingTokens+=e.thinkingTokens||0)}async updateProjectTokens(e){await b.updateProject(e,{totalInputTokens:this.cumulativeTokens.inputTokens,totalOutputTokens:this.cumulativeTokens.outputTokens,totalThinkingTokens:this.cumulativeTokens.thinkingTokens})}extractPlotsFromGuide(e){let t=[],n=/(?:trama\s*(?:principal)?|subtrama)\s*(?:\d+)?[\s:]+([^\n]+)/gi,a;for(;(a=n.exec(e))!==null;){let c=a[1].trim();c.length>5&&c.length<200&&t.push({name:c,goal:c})}let s=/arco\s+(?:de\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)[:\s]+([^\n]+)/gi;for(;(a=s.exec(e))!==null;){let c=a[1].trim(),p=a[2].trim();t.push({name:`Arco de ${c}`,description:p,goal:p})}let o=/^\s*\d+\.\s*(?:trama|conflicto|historia|arco)[:\s]+([^\n]+)/gim;for(;(a=o.exec(e))!==null;){let c=a[1].trim();c.length>5&&!t.some(p=>p.name.toLowerCase()===c.toLowerCase())&&t.push({name:c,goal:c})}let i=/conflicto\s+(?:principal|secundario|central)\s*[:\s]+([^\n]+)/gi;for(;(a=i.exec(e))!==null;){let c=a[1].trim();c.length>5&&!t.some(p=>p.name.toLowerCase()===c.toLowerCase())&&t.push({name:`Conflicto: ${c}`,goal:c})}return t.filter((c,p,m)=>m.findIndex(f=>f.name.toLowerCase()===c.name.toLowerCase())===p).slice(0,10)}validatePlotCoherence(e,t,n,a){let s=[],o=[],i=e||[],u=t||[];if(i.length===0)return console.warn("[OrchestratorV2] validatePlotCoherence: Empty outline, skipping validation"),{isValid:!0,criticalIssues:[],warnings:["Outline vac\xEDo - validaci\xF3n omitida"]};if(u.length===0&&a){console.log("[OrchestratorV2] No plot_threads from GA - extracting from extended guide...");let g=this.extractPlotsFromGuide(a);g.length>0&&(u=g,console.log(`[OrchestratorV2] Extracted ${g.length} plot threads from extended guide`))}u.length===0&&(console.warn("[OrchestratorV2] validatePlotCoherence: No plot threads defined"),o.push("\u26A0\uFE0F No se definieron tramas principales (plot_threads vac\xEDo)"));for(let g of u){let y=(g.name||"").toLowerCase(),C=(g.goal||"").toLowerCase(),A=(g.description||"").toLowerCase();if(!y)continue;let T=new Set(["el","la","los","las","un","una","de","del","al","a","en","con","por","para","que","y","o","su","sus","se","lo","es","son","como","m\xE1s","pero","sin","sobre","entre","desde","hasta","the","a","an","of","to","and","or","is","are","be","was","were","been","being","have","has","had","do","does","did","will","would","could","should","may","might","must","shall","can","need","dare","ought","used","this","that","these","those","i","you","he","she","it","we","they","me","him","her","us","them","my","your","his","its","our","their","mine","yours","hers","ours","theirs","what","which","who","whom","whose","where","when","why","how","all","each","every","both","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","just","also"]),E=_=>_.split(/[\s\/\(\)\-\.,;:]+/).filter(N=>N.length>=4&&!T.has(N)).slice(0,10),d=E(y),l=E(C),h=E(A),v=new Set([...d,...l,...h]),S=Array.from(v),x=((g.goal||"").match(/[A-Z][a-z]{2,}/g)||[]).map(_=>_.toLowerCase()),w=0,O=!1,I=-1;for(let _=0;_<i.length;_++){let N=i[_],P=(N.summary||"").toLowerCase(),L=(N.key_event||"").toLowerCase(),$=(N.title||"").toLowerCase()+" "+P+" "+L,U=0;for(let F of S)$.includes(F)&&U++;let k=0;for(let F of x)$.includes(F)&&k++;let V=$.includes(y.replace(/[\/\(\)]/g," ").trim()),Q=U>=2,te=k>=1&&U>=1;(V||Q||te)&&(w++,I=_,/resuelv|conclu|final|descubr|revel|logra|consigue|cierra|termina|acaba|confes|verdad|prueba|libera|salva|recupera|sana|cura/i.test($)&&(O=!0))}if(w===0)s.push(`\u274C TRAMA HU\xC9RFANA: "${g.name}" (objetivo: ${g.goal}) nunca aparece en ning\xFAn cap\xEDtulo. Palabras clave buscadas: ${S.slice(0,5).join(", ")}`);else if(w===1)s.push(`\u274C TRAMA D\xC9BIL: "${g.name}" solo aparece en 1 cap\xEDtulo. DEBE desarrollarse en al menos 3 cap\xEDtulos.`);else if(w===2)o.push(`\u26A0\uFE0F TRAMA INSUFICIENTE: "${g.name}" solo aparece en 2 cap\xEDtulos. Recomendado: 3+ cap\xEDtulos.`);else if(!O&&I>=0&&I<i.length-3){let _=i[I];s.push(`\u274C TRAMA SIN RESOLVER: "${g.name}" desaparece en "${_.title}" sin resoluci\xF3n clara.`)}}let c=n?.characters||n?.personajes||[],p=Array.isArray(c)?c:[];for(let g of p.slice(0,5)){if(!g)continue;let y=(g.name||g.nombre||"").toLowerCase(),C=(g.arc||g.arco||"").toLowerCase();if(!y||y.length<2)continue;let A=new Set;A.add(y);let T=g.aliases||g.apodos||g.alias||[];Array.isArray(T)&&T.forEach(I=>A.add(I.toLowerCase()));let E=y.replace(/[,()]/g," ").split(/\s+/).filter(I=>I.length>=2),d=new Set(["de","del","la","el","los","las","von","van","di","da"]);for(let I of E)!d.has(I)&&I.length>=3&&A.add(I);let l=y.match(/(marqus|conde|duque|barn|vizconde|prncipe|rey|reina|seor|seora|don|doa)\s+(?:de\s+)?(\w+)/i);l&&(A.add(`el ${l[1].toLowerCase()}`),A.add(l[1].toLowerCase()),l[2]&&l[2].length>=3&&A.add(l[2].toLowerCase()));let h=y.match(/[''""]([^''"]+)[''""]|\(([^)]+)\)/);if(h){let I=(h[1]||h[2]).toLowerCase();A.add(I),A.add(`el ${I}`)}E.length>=2&&!d.has(E[1])&&A.add(`${E[0]} ${E[1]}`);let v=E.filter(I=>!d.has(I)&&I.length>=3);v.length>1&&A.add(v[v.length-1]);let S=-1,R=-1,x=0;for(let I=0;I<i.length;I++){let _=i[I],N=((_.summary||"")+" "+(_.key_event||"")).toLowerCase(),P=!1,L=Array.from(A);for(let j=0;j<L.length;j++){let $=L[j];if($.length>=3&&N.includes($)){P=!0;break}}P&&(S===-1&&(S=I),R=I,x++)}let w=(g.role||g.rol||g.tipo||"").toLowerCase();if((w.includes("protagonista")||w.includes("principal")||w.includes("main")||w.includes("pov")||g.importance===1||g.importancia===1)&&x<i.length*.4){let I=Math.ceil(i.length*.4),_=g.name||g.nombre;s.push(`\u274C PROTAGONISTA AUSENTE: ${_} solo aparece en ${x}/${i.length} cap\xEDtulos. DEBE aparecer NOMBRADO EXPL\xCDCITAMENTE en el summary o key_event de al menos ${I} cap\xEDtulos (40%). Escribe "${_}" (no pronombres ni "el protagonista") en los res\xFAmenes de cap\xEDtulo.`)}i.length>=8&&x>=3&&R<i.length-5&&!(g.status||g.estado||"").toLowerCase().includes("muert")&&o.push(`\u26A0\uFE0F PERSONAJE DESAPARECE: ${g.name||g.nombre} deja de aparecer despu\xE9s del cap\xEDtulo ${R+1}.`)}for(let g of i){let y=(g.summary||"").toLowerCase(),C=(g.key_event||"").toLowerCase();y.length<50&&o.push(`\u26A0\uFE0F CAP\xCDTULO VAGO: "${g.title||`Cap ${g.chapter_num}`}" tiene un resumen muy corto (${y.length} caracteres).`),/transicin|preparacin|reflexiona|piensa en|recuerda|flashback/i.test(y)&&!/descubre|revela|enfrent|conflict|crisis|giro/i.test(y)&&o.push(`\u26A0\uFE0F POSIBLE RELLENO: "${g.title||`Cap ${g.chapter_num}`}" parece no avanzar la trama principal.`)}let m=i.length;if(m>=6){let g=Math.max(1,Math.floor(m*.25)),y=Math.min(m-1,Math.floor(m*.75)),C=/giro|revelacin|descubre|confronta|crisis|punto de no retorno|clmax|todo cambia/i,A=Math.max(0,g-2),T=Math.min(m,g+2),E=i.slice(A,T).some(x=>C.test((x.summary||"")+" "+(x.key_event||""))),d=Math.max(0,Math.floor(m*.45)),l=Math.min(m,Math.floor(m*.55)),h=i.slice(d,l).some(x=>C.test((x.summary||"")+" "+(x.key_event||""))),v=Math.max(0,y-2),S=Math.min(m,y+2),R=i.slice(v,S).some(x=>C.test((x.summary||"")+" "+(x.key_event||"")));E||s.push(`\u274C FALTA PUNTO DE GIRO ACTO 1: No hay giro/revelaci\xF3n al ~25% (cap\xEDtulo ${g}). La trama no tendr\xE1 impulso.`),h||s.push(`\u274C FALTA PUNTO MEDIO: No hay giro/crisis al ~50% (cap\xEDtulo ${Math.floor(m*.5)}). La historia perder\xE1 tensi\xF3n.`),R||s.push(`\u274C FALTA CRISIS ACTO 2: No hay crisis/confrontaci\xF3n al ~75% (cap\xEDtulo ${y}). El cl\xEDmax no tendr\xE1 peso.`)}return{isValid:s.length===0,criticalIssues:s,warnings:o}}injectProtagonistIntoOutline(e,t){if(!e||e.length===0||!t)return e;let n=t.toLowerCase(),a=0,s=new Set,o=[];for(let E of e){let d=(E.summary||"").toLowerCase(),l=(E.key_event||"").toLowerCase();d.includes(n)||l.includes(n)?(a++,s.add(E.chapter_num)):o.push(E.chapter_num)}let i=Math.ceil(e.length*.4),u=Math.max(0,i-a);if(console.log(`[OrchestratorV2] Protagonist "${t}" currently in ${a}/${e.length} chapters. Need ${i} (40%). Additional needed: ${u}`),u===0)return console.log("[OrchestratorV2] Protagonist already meets 40% requirement, no injection needed."),e;let c=e.filter(E=>E.chapter_num>0&&E.chapter_num<900),p=new Set;e.some(E=>E.chapter_num===0)&&p.add(0),c.length>0&&p.add(c[0].chapter_num);let m=Math.ceil(c.length*.25);c[m-1]&&p.add(c[m-1].chapter_num);let f=Math.ceil(c.length*.5);c[f-1]&&p.add(c[f-1].chapter_num);let g=Math.ceil(c.length*.75);c[g-1]&&p.add(c[g-1].chapter_num),c.length>0&&p.add(c[c.length-1].chapter_num);let y=[];for(let E of Array.from(p))s.has(E)||y.push(E);let C=o.filter(E=>!p.has(E)).sort((E,d)=>E-d);y.push(...C);let A=new Set(y.slice(0,u));return console.log(`[OrchestratorV2] Injecting protagonist into ${A.size} chapters: ${Array.from(A).join(", ")}`),e.map(E=>{if(A.has(E.chapter_num)){let d=`${t} ${E.summary}`;return console.log(`[OrchestratorV2] Injected protagonist into chapter ${E.chapter_num}`),{...E,summary:d}}return E})}async buildPlotThreadsContext(e,t,n){try{let a=await b.getPlotThreadsByProject(e);if(!a||a.length===0)return"";let s=n?.find(g=>g.chapter_num===t),o=n?.find(g=>g.chapter_num===t+1),i=[],u=(s?.summary||"").toLowerCase(),c=(s?.key_event||"").toLowerCase(),m=(s?.title||"").toLowerCase()+" "+u+" "+c;for(let g of a){let y=(g.name||"").toLowerCase(),C=(g.goal||"").toLowerCase();((y+" "+C).split(/\s+/).filter(E=>E.length>=4).slice(0,5).filter(E=>m.includes(E)).length>=1||g.status==="active")&&i.push(g)}i.length===0&&i.push(...a.filter(g=>g.status==="active").slice(0,5));let f=`

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F4DA} TRAMAS Y SUBTRAMAS ACTIVAS - OBLIGATORIO DESARROLLAR
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Las siguientes tramas DEBEN ser avanzadas en este cap\xEDtulo. Cada escena debe contribuir al desarrollo de al menos una de ellas:

`;for(let g=0;g<i.length;g++){let y=i[g],C=g===0?"\u{1F534} TRAMA PRINCIPAL":`\u{1F7E1} SUBTRAMA ${g}`;f+=`${C}: ${y.name}
   Objetivo: ${y.goal||"No especificado"}
   Estado: ${y.status==="resolved"?"RESUELTA":"EN DESARROLLO"}
   
`}return s&&(f+=`
\u{1F4CD} EXPECTATIVAS PARA CAP\xCDTULO ${t}:
   Evento clave: ${s.key_event||"No especificado"}
   Resumen esperado: ${s.summary||"No especificado"}
`),o&&(f+=`
\u{1F517} PREPARAR CONEXI\xD3N CON SIGUIENTE CAP\xCDTULO:
   Pr\xF3ximo evento: ${o.key_event||"No especificado"}
`),f+=`
\u26A0\uFE0F OBLIGACIONES DEL ESCRITOR:
1. Cada escena DEBE avanzar al menos una trama/subtrama
2. NO crear tramas nuevas que no est\xE9n listadas arriba
3. Mantener coherencia con el objetivo de cada trama
4. Las escenas de transici\xF3n tambi\xE9n deben aportar al desarrollo de tramas

\u{1F6AB} PREVENCI\xD3N DE DEUS EX MACHINA:
- NO introducir personajes nuevos que resuelvan conflictos
- NO usar habilidades/objetos no establecidos previamente
- NO resolver problemas con coincidencias convenientes
- Si un recurso se usa para resolver algo, DEBE haberse mencionado antes
- Los aliados que ayudan DEBEN tener motivaci\xF3n ya establecida
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

`,f}catch(a){return console.error("[OrchestratorV2] Error building plot threads context:",a),""}}extractCharactersFromExtendedGuide(e){if(!e)return[];let t=[],n=/##\s*(?:Personajes|Protagonistas?|Elenco|Characters)[^\n]*\n((?:[^\n#]*\n)*?)(?=##|$)/gi,a;for(;(a=n.exec(e))!==null;){let u=a[1];if(!u||u.trim().length===0)continue;let c=/^[\s]*[-*]\s*\**([A-Z][^:\n\-*(]+?)\**\s*(?:\([^)]+\)\s*)?[:\-]?\s*([^\n]*)/gim,p;for(;(p=c.exec(u))!==null;){let m=p[1].trim().replace(/\*+/g,""),f=p[2].trim().substring(0,100);if(/^(personajes?|protagonistas?|antagonistas?|secundarios?|elenco)/i.test(m)||m.length<2||m.length>80)continue;let g="supporting",y=a[0].toLowerCase();/protagonista|principal/i.test(y)||/protagonista/i.test(f)?g="protagonist":(/antagonista|villano/i.test(y)||/antagonista|villano/i.test(f))&&(g="antagonist"),t.some(C=>C.name.toLowerCase()===m.toLowerCase())||t.push({name:m,role:g,description:f})}}let s=/###?\s*([A-Z][^:\n]+?)(?:\s*[-:]\s*|\s*\n)/gi,o;for(;(o=s.exec(e))!==null;){let u=o[1].trim();if(/^(personajes?|protagonistas?|antagonistas?|secundarios?|elenco|resumen|sinopsis|captulo|acto|escena)/i.test(u)||u.length<3||u.length>80)continue;let c=Math.max(0,o.index-50),p=Math.min(e.length,o.index+o[0].length+200),m=e.substring(c,p).toLowerCase(),f="supporting";/protagonista|principal|hroe|herona/i.test(m)?f="protagonist":/antagonista|villano|enemigo/i.test(m)&&(f="antagonist");let g=o.index+o[0].length,y=e.substring(g,g+150).split(`
`)[0].trim();t.some(C=>C.name.toLowerCase()===u.toLowerCase())||t.push({name:u,role:f,description:y.substring(0,100)})}let i=/([A-Z][a-z]+(?:\s+[A-Z][a-z]+){0,3}),?\s+(?:un|una|el|la)\s+([a-z\s]+?)\s+(?:que|quien|de)/gi;for(;(o=i.exec(e))!==null;){let u=o[1].trim(),c=o[2].trim();u.length>=3&&u.length<=50&&!t.some(p=>p.name.toLowerCase()===u.toLowerCase())&&t.push({name:u,role:/protagonista|hroe|herona/i.test(c)?"protagonist":"supporting",description:c.substring(0,80)})}return t.slice(0,10)}validateSeriesCharacterConsistency(e,t,n){let a=[],s=[];if(!t||!e||e.length===0)return{corrections:a,warnings:s};let o=this.extractCharactersFromExtendedGuide(t);if(o.length===0)return{corrections:a,warnings:s};let i=this.extractGendersFromGuide(t);for(let u of o){let c=(u.name||"").trim();if(!c)continue;let p=c.toLowerCase(),m=c.split(/\s+/)[0].toLowerCase(),f=e.findIndex(y=>(y.name||y.nombre||"").toLowerCase().trim()===p);if(f>=0){let y=e[f],C=i[p]||i[m];if(C){let A=(y.profile||y.description||"").toLowerCase(),T=(y.name||y.nombre||"").toLowerCase(),E=C==="female",d=C==="male",l=/\b(inspectora|detective\s+femenin|ella|herona|madre|esposa|novia|hermana|hija|abuela|ta|seora|dama|reina|princesa|doctora|profesora|comisaria|agente\s+femenin)\b/i,h=/\b(inspector\b|detective\s+masculin|l\b|hroe|padre|esposo|novio|hermano|hijo|abuelo|to|seor|rey|prncipe|doctor\b|profesor\b|comisario|agente\s+masculin)\b/i;E&&h.test(A)&&!l.test(A)?(s.push(`\u26A0\uFE0F ALERTA DE G\xC9NERO: "${y.name||y.nombre}" parece haber cambiado de g\xE9nero. En la gu\xEDa de serie es FEMENINO pero la biblia usa indicadores masculinos. Se corregir\xE1.`),a.push({wbIndex:f,field:"gender",from:"male",to:"female"})):d&&l.test(A)&&!h.test(A)&&(s.push(`\u26A0\uFE0F ALERTA DE G\xC9NERO: "${y.name||y.nombre}" parece haber cambiado de g\xE9nero. En la gu\xEDa de serie es MASCULINO pero la biblia usa indicadores femeninos. Se corregir\xE1.`),a.push({wbIndex:f,field:"gender",from:"female",to:"male"}))}continue}let g=e.findIndex(y=>{let C=(y.name||y.nombre||"").toLowerCase().trim(),A=C.split(/\s+/)[0],T=(y.role||y.rol||"").toLowerCase(),E=(u.role||"").toLowerCase();return!!(A===m&&C!==p||E&&E!=="supporting"&&T===E&&this.calculateNameSimilarity(c,y.name||y.nombre||"")>.4)});if(g>=0){let y=e[g],C=y.name||y.nombre||"";s.push(`\u26A0\uFE0F NOMBRE CAMBIADO: La gu\xEDa de serie define "${c}" (${u.role}) pero la biblia del mundo usa "${C}". Se corregir\xE1 autom\xE1ticamente.`),a.push({wbIndex:g,field:"name",from:C,to:c})}else(u.role==="protagonist"||u.role==="antagonist")&&s.push(`\u26A0\uFE0F PERSONAJE FALTANTE: "${c}" (${u.role}) est\xE1 definido en la gu\xEDa de serie pero NO aparece en la biblia del mundo generada.`)}return{corrections:a,warnings:s}}extractGendersFromGuide(e){let t={},n=[/\*\*Nombre(?:\s+completo)?:\*\*\s*([^\n]+)/gi,/(?:protagonista|detective|inspectora|herona|agente)\s+(?:femenin[ao])?[:\s]*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi],a=[{pattern:/\*\*Nombre(?:\s+completo)?:\*\*\s*([^\n]+)/gi,context:200},{pattern:/###?\s+(?:El|La)\s+(Detective|Protagonista|Inspector[a]?)\b[^\n]*\n[\s\S]*?\*\*Nombre(?:\s+completo)?:\*\*\s*([^\n]+)/gi,context:0}];for(let{pattern:o}of a){let i;for(;(i=o.exec(e))!==null;){let u=(i[2]||i[1]||"").trim().replace(/\*+/g,"");if(!u||u.length<2)continue;let c=Math.max(0,i.index-100),p=Math.min(e.length,i.index+i[0].length+200),m=e.substring(c,p),f=/\b(inspectora|herona|ella|madre|esposa|mujer|femenin|seora|detective\s+femenin|comisaria|doctora|profesora)\b/i.test(m),g=/\b(inspector\b|hroe\b|l\b|padre|esposo|hombre|masculin|seor|comisario|doctor\b|profesor\b)\b/i.test(m),y=u.toLowerCase(),C=y.split(/\s+/)[0];f&&!g?(t[y]="female",t[C]="female"):g&&!f&&(t[y]="male",t[C]="male")}}let s=[{header:/##\s*\d+\.\s*(?:LA\s+)?(?:DETECTIVE|PROTAGONISTA|INSPECTORA|HERONA)/gi,gender:"female"},{header:/##\s*\d+\.\s*(?:EL\s+)?(?:DETECTIVE|PROTAGONISTA|INSPECTOR\b|HROE)/gi,gender:"male"}];for(let{header:o,gender:i}of s){let u;for(;(u=o.exec(e))!==null;){let c=u.index,p=e.indexOf(`
## `,c+1),f=e.substring(c,p>0?p:c+500).match(/\*\*Nombre(?:\s+completo)?:\*\*\s*([^\n]+)/i);if(f){let g=f[1].trim().replace(/\*+/g,"").toLowerCase(),y=g.split(/\s+/)[0];t[g]=i,t[y]=i}}}return t}extractVolumeContextFromGuide(e,t){if(!e||t<=0)return null;let n=[],a=[new RegExp(`##\\s*HITOS\\s+DEL\\s+VOLUMEN\\s+${t}[:\\s]*[^\\n]*\\n([\\s\\S]*?)(?=##\\s*(?:HITOS\\s+DEL\\s+VOLUMEN|ARQUITECTURA\\s+DEL\\s+VOLUMEN)\\s+(?!${t}\\b)|$)`,"i"),new RegExp(`##\\s*HITOS\\s+(?:VOLUMEN|VOL\\.?)\\s*${t}[:\\s]*[^\\n]*\\n([\\s\\S]*?)(?=##\\s|$)`,"i")];for(let C of a){let A=e.match(C);if(A){let T=A[0].trim();if(T.length>30){n.push(T);break}}}let s=[new RegExp(`##\\s*ARQUITECTURA\\s+DEL\\s+VOLUMEN\\s+${t}[:\\s]*[^\\n]*\\n([\\s\\S]*?)(?=##\\s*(?:HITOS\\s+DEL\\s+VOLUMEN|ARQUITECTURA\\s+DEL\\s+VOLUMEN)\\s+(?!${t}\\b)|$)`,"i"),new RegExp(`##\\s*ARQUITECTURA\\s+(?:VOLUMEN|VOL\\.?)\\s*${t}[:\\s]*[^\\n]*\\n([\\s\\S]*?)(?=##\\s|$)`,"i")];for(let C of s){let A=e.match(C);if(A){let T=A[0].trim();if(T.length>30&&!n.some(E=>E.includes(T.substring(0,50)))){n.push(T);break}}}let o=new RegExp(`\\*\\*(?:T\xEDtulo|Titulo)\\s*(?:del\\s+)?(?:volumen|vol\\.?)\\s*${t}[^*]*\\*\\*[:\\s]*([^\\n]+)`,"i"),i=new RegExp(`\\*\\*Argumento(?:\\s+del\\s+volumen\\s+${t})?\\*\\*[:\\s]*([^\\n](?:[\\s\\S]*?)?)(?=\\n\\*\\*|\\n##|$)`,"i"),u=new RegExp(`(?:volumen|vol\\.?|libro)\\s*${t}[:\\s]+["\u201C]([^"\u201D\\n]+)["\u201D]`,"gi"),c;for(;(c=u.exec(e))!==null;){let C=Math.max(0,c.index-20),A=Math.min(e.length,c.index+500),E=e.substring(C,A).match(/\*\*Argumento:\*\*\s*([\s\S]*?)(?=\n\*\*|\n##|$)/i);E&&!n.some(d=>d.includes(E[1].substring(0,40)))&&n.push(`Argumento del Volumen ${t}: ${E[1].trim()}`)}let p=e.match(/##\s*\d+\.\s*(?:EL|LA)\s+(?:DETECTIVE|PROTAGONISTA)[^\n]*\n([\s\S]*?)(?=\n##\s*\d+)/i);if(p){let C=p[0].trim();C.length>50&&!n.some(A=>A.includes(C.substring(0,50)))&&n.push(C)}let m=e.match(/##\s*\d+\.\s*PERSONAJES\s+RECURRENTES[^\n]*\n([\s\S]*?)(?=\n##\s*\d+)/i);if(m){let C=m[0].trim();C.length>50&&!n.some(A=>A.includes(C.substring(0,50)))&&n.push(C)}let f=e.match(/##\s*\d+\.\s*REGLAS\s+DEL\s+MUNDO[^\n]*\n([\s\S]*?)(?=\n##\s*\d+)/i);if(f){let C=f[0].trim();C.length>50&&!n.some(A=>A.includes(C.substring(0,50)))&&n.push(C)}let g=e.match(/##\s*\d+\.\s*(?:EL\s+)?HILO\s+CONDUCTOR[^\n]*\n([\s\S]*?)(?=\n##\s*\d+)/i);if(g){let C=g[0].trim();C.length>50&&!n.some(A=>A.includes(C.substring(0,50)))&&n.push(C)}let y=e.match(/##\s*\d+\.\s*(?:PREVENCIN\s+DE\s+)?ERRORES?\s+DE\s+CONTINUIDAD[^\n]*\n([\s\S]*?)(?=\n##\s*\d+|$)/i);if(y){let C=y[0].trim();C.length>50&&!n.some(A=>A.includes(C.substring(0,50)))&&n.push(C)}return n.length===0?null:n.join(`

`)}calculateNameSimilarity(e,t){let n=e.toLowerCase(),a=t.toLowerCase();if(n===a)return 1;let s=n.split(/\s+/)[0],o=a.split(/\s+/)[0];if(s===o)return .7;let i=Math.max(n.length,a.length);if(i===0)return 0;let u=0,c=Math.min(n.length,a.length);for(let p=0;p<c;p++)n[p]===a[p]&&u++;return u/i}buildPlotCorrectionInstructions(e,t,n,a,s,o){let u=`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551 ${n>=2?"\u{1F534} CR\xCDTICO":"\u26A0\uFE0F IMPORTANTE"}: CORRECCIONES OBLIGATORIAS (Intento ${n}/5)              \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

La estructura anterior fue RECHAZADA por problemas graves. DEBES corregir:

`,c=a?.filter(f=>f.role==="protagonist"||f.role==="protagonista")||[],p=s?.filter(f=>f.role==="protagonist")||[],m=[...c];for(let f of p)m.some(g=>g.name.toLowerCase()===f.name.toLowerCase())||m.push(f);if(m.length>0){let f=m[0],g=o||20,y=Math.ceil(g*.4);u+=`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551 \u26A0\uFE0F CORRECCI\xD3N OBLIGATORIA: PRESENCIA DEL PROTAGONISTA           \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551                                                                  \u2551
\u2551 PROTAGONISTA PRINCIPAL: "${f.name}"                 \u2551
\u2551                                                                  \u2551
\u2551 PROBLEMA DETECTADO: El protagonista NO aparece en suficientes    \u2551
\u2551 cap\xEDtulos. El sistema RECHAZA estructuras sin presencia clara.   \u2551
\u2551                                                                  \u2551
\u2551 SOLUCI\xD3N OBLIGATORIA:                                            \u2551
\u2551 1. Escribe el NOMBRE "${f.name}" expl\xEDcitamente    \u2551
\u2551    en el campo "summary" O "key_event" de cada cap\xEDtulo donde    \u2551
\u2551    este personaje interviene.                                    \u2551
\u2551                                                                  \u2551
\u2551 2. El protagonista DEBE aparecer NOMBRADO en:                    \u2551
\u2551    - Pr\xF3logo (si existe)                                         \u2551
\u2551    - Cap\xEDtulo 1 (OBLIGATORIO)                                    \u2551
\u2551    - Cap\xEDtulos de puntos de giro (~${Math.ceil(g*.25)}, ~${Math.ceil(g*.5)}, ~${Math.ceil(g*.75)})             \u2551
\u2551    - Cap\xEDtulo final (${g}) (OBLIGATORIO)                             \u2551
\u2551    - AL MENOS ${y} de ${g} cap\xEDtulos (40%)                           \u2551
\u2551                                                                  \u2551
\u2551 3. INCORRECTO: "El detective investiga" / "descubre la verdad"  \u2551
\u2551    CORRECTO: "${f.name} investiga el crimen"       \u2551
\u2551                                                                  \u2551
\u2551 4. NO cambies el nombre del protagonista. NO inventes otro.      \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

`,u+=`=== \u{1F512} PERSONAJES CAN\xD3NICOS (NO CAMBIAR) ===
`,u+=`OBLIGATORIO: Mantener EXACTAMENTE los mismos personajes principales:
`;for(let C of c)u+=`- PROTAGONISTA: "${C.name}" (NO RENOMBRAR, NO REEMPLAZAR)
`;for(let C of p)c.some(A=>A.name.toLowerCase()===C.name.toLowerCase())||(u+=`- PROTAGONISTA (de gu\xEDa): "${C.name}" - ${C.description}
`);u+=`
\u26A0\uFE0F PROHIBIDO: Inventar nuevos protagonistas o cambiar los existentes.
`,u+=`El protagonista "${f.name}" DEBE aparecer NOMBRADO en summary/key_event.

`}if(e.length>0){u+=`=== PROBLEMAS CR\xCDTICOS (OBLIGATORIO RESOLVER) ===
`;for(let f of e)u+=`${f}
`;u+=`
`}if(t.length>0&&n>=2){u+=`=== ADVERTENCIAS (TAMBI\xC9N RESOLVER EN ESTE INTENTO) ===
`;for(let f of t.slice(0,5))u+=`${f}
`;u+=`
`}return u+=`
REQUISITOS PARA APROBAR:
1. CADA trama/subtrama DEBE aparecer en m\xFAltiples cap\xEDtulos y tener resoluci\xF3n clara
2. Los personajes principales NO pueden desaparecer sin explicaci\xF3n
3. Cada cap\xEDtulo DEBE avanzar alg\xFAn hilo narrativo (no relleno)
4. DEBE haber puntos de giro en 25%, 50% y 75% de la novela
5. El cl\xEDmax DEBE resolver TODAS las tramas principales
6. El PROTAGONISTA debe aparecer expl\xEDcitamente en al menos 30% de los cap\xEDtulos

Si no cumples estos requisitos, el proyecto ser\xE1 PAUSADO para revisi\xF3n manual.
`,u}async extractSeriesWorldBibleOnComplete(e){try{let t=await b.getProject(e);if(!t||!t.seriesId)return;let n=t.seriesOrder||1;console.log(`[OrchestratorV2] Extracting series world bible from project ${e} (Volume ${n})`),this.callbacks.onAgentStatus("series-world-bible-extractor","running",`Extrayendo informaci\xF3n de la Biblia del Mundo para el Volumen ${n}...`);let a=await this.seriesWorldBibleExtractor.extractFromProject(e,n);a?(await this.seriesWorldBibleExtractor.mergeAndSaveToSeries(t.seriesId,n,a),console.log(`[OrchestratorV2] Series world bible updated: ${a.characters.length} chars, ${a.locations.length} locs, ${a.lessons.length} lessons`),this.callbacks.onAgentStatus("series-world-bible-extractor","completed",`Biblia del Mundo actualizada: ${a.characters.length} personajes, ${a.locations.length} lugares, ${a.lessons.length} lecciones`)):(console.warn(`[OrchestratorV2] Could not extract series world bible from project ${e}`),this.callbacks.onAgentStatus("series-world-bible-extractor","completed","No se pudo extraer la Biblia del Mundo"))}catch(t){console.error("[OrchestratorV2] Error extracting series world bible:",t)}}async getSeriesWorldBibleForInjection(e){try{let t=await b.getProject(e);if(!t||!t.seriesId)return null;let n=await b.getSeriesWorldBible(t.seriesId);return n?(console.log(`[OrchestratorV2] Loaded series world bible for project ${e}: ${n.characters?.length||0} characters, ${n.locations?.length||0} locations`),{characters:n.characters||[],locations:n.locations||[],lessons:n.lessons||[],worldRules:n.worldRules||[],timelineEvents:n.timelineEvents||[],objects:n.objects||[],secrets:n.secrets||[]}):(console.log(`[OrchestratorV2] No series world bible found for series ${t.seriesId}`),null)}catch(t){return console.error("[OrchestratorV2] Error getting series world bible:",t),null}}async logAiUsage(e,t,n,a,s){if(a)try{let o=Ss(n,a.inputTokens||0,a.outputTokens||0,a.thinkingTokens||0);await b.createAiUsageEvent({projectId:e,agentName:t,model:n,inputTokens:a.inputTokens||0,outputTokens:a.outputTokens||0,thinkingTokens:a.thinkingTokens||0,inputCostUsd:Ar(o.inputCost),outputCostUsd:Ar(o.outputCost+o.thinkingCost),totalCostUsd:Ar(o.totalCost),chapterNumber:s,operation:"generate"})}catch(o){console.error(`[OrchestratorV2] Failed to log AI usage for ${t}:`,o)}}async saveThoughtLog(e,t,n,a,s){if(!(!a||a.length<50))try{let o=a.length>8e3?a.substring(0,8e3)+`

[...truncado por longitud...]`:a;await b.createThoughtLog({projectId:e,chapterId:s||null,agentName:t,agentRole:n,thoughtContent:o}),console.log(`[OrchestratorV2] Saved thought log from ${t} (${o.length} chars)`)}catch(o){console.error(`[OrchestratorV2] Failed to save thought log for ${t}:`,o)}}async getThoughtContext(e,t=10){try{let n=await b.getThoughtLogsByProject(e);return n.length===0?"":`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u{1F4DD} CONTEXTO DE RAZONAMIENTO DE AGENTES ANTERIORES:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${n.slice(0,t).map(o=>{let i=o.thoughtContent.substring(0,500);return`[${o.agentName}] ${i}${o.thoughtContent.length>500?"...":""}`}).join(`

`)}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
Usa este contexto para mantener coherencia con las decisiones previas.
`}catch(n){return console.error("[OrchestratorV2] Failed to get thought context:",n),""}}async getChapterDecisionContext(e,t){try{let a=(await b.getThoughtLogsByProject(e)).filter(o=>{let i=o.thoughtContent.toLowerCase();return i.includes(`cap\xEDtulo ${t}`)||i.includes(`chapter ${t}`)||o.agentRole==="global-architect"||o.agentRole==="chapter-architect"}).slice(0,5);return a.length===0?"":`
\u{1F9E0} DECISIONES DE PLANIFICACI\xD3N RELEVANTES:
${a.map(o=>{let i=o.thoughtContent.substring(0,400);return`\u2022 [${o.agentName}]: ${i}${o.thoughtContent.length>400?"...":""}`}).join(`
`)}
`}catch(n){return console.error("[OrchestratorV2] Failed to get chapter decision context:",n),""}}normalizeChapterNumber(e){return e===-1?[-1,998]:e===998?[998,-1]:e===-2?[-2,999]:e===999?[999,-2]:[e]}findChapterByNumber(e,t){let n=this.normalizeChapterNumber(t);for(let a of n){let s=e.find(o=>o.chapterNumber===a);if(s)return s}}chapterNumberMatches(e,t){return this.normalizeChapterNumber(t).includes(e)}normalizeToDbChapterNumber(e){return e===-1?998:e===-2?999:e}generateIssueHash(e){let t=(e.descripcion||"").toLowerCase().replace(/\s+/g," ").trim().substring(0,100),n=(e.capitulos_afectados||[]).map(o=>this.normalizeToDbChapterNumber(o)).sort((o,i)=>o-i).join(","),a=`${e.categoria||"unknown"}|${t}|${n}`,s=5381;for(let o=0;o<a.length;o++)s=(s<<5)+s+a.charCodeAt(o);return`issue_${Math.abs(s).toString(16)}`}filterNewIssues(e,t){let n=new Set(t),a=[],s=0;for(let o of e){let i=this.generateIssueHash(o);n.has(i)?(console.log(`[OrchestratorV2] Filtering resolved issue: ${o.categoria} - ${o.descripcion?.substring(0,50)}...`),s++):a.push(o)}return s>0&&console.log(`[OrchestratorV2] Filtered ${s} previously resolved issues, ${a.length} new issues remain`),{newIssues:a,filteredCount:s}}async markIssuesResolved(e,t){if(t.length===0)return;let a=(await b.getProject(e))?.resolvedIssueHashes||[],s=t.map(u=>this.generateIssueHash(u)),o=[...a,...s],i=o.filter((u,c)=>o.indexOf(u)===c);await b.updateProject(e,{resolvedIssueHashes:i}),console.log(`[OrchestratorV2] Marked ${s.length} issues as resolved (total hashes: ${i.length})`)}isStructuralIssue(e){let t=(e.descripcion||"").toLowerCase(),n=(e.instrucciones_correccion||"").toLowerCase(),a=(e.categoria||"").toLowerCase(),s=[/mover\s+(el\s+)?(captulo|cap\.?|epilogo|eplogo|prologo|prlogo)/i,/reubicar\s+(el\s+)?(captulo|cap\.?|epilogo|eplogo)/i,/colocar\s+(el\s+)?(captulo|cap\.?|epilogo|eplogo)\s+(al\s+)?final/i,/situado\s+al\s+(principio|inicio)/i,/(al\s+inicio|al\s+principio)\s+.*spoiler/i,/renombrar\s+(captulo|cap\.?)/i,/cambiar\s+(el\s+)?ttulo\s+del\s+captulo/i,/estructura\s+confusa/i,/error\s+de\s+compaginacin/i,/flashforward\s+.*claro/i],o=`${t} ${n}`;for(let u of s)if(u.test(o))return!0;return!!(["coherencia_temporal","estructura","ordenamiento"].includes(a)&&/mover|reubicar|renombrar|reordenar|intercambiar/i.test(n))}isMergeRequest(e){let t=`${e.descripcion||""} ${e.instrucciones_correccion||""}`.toLowerCase();return[/fusionar\s+(los\s+)?(captulos?|caps?\.?)/i,/combinar\s+(los\s+)?(captulos?|caps?\.?)/i,/unir\s+(los\s+)?(captulos?|caps?\.?)/i,/merge\s+(the\s+)?chapter/i,/integrar\s+(en\s+)?un\s+(solo\s+)?captulo/i,/hacer\s+un\s+(solo\s+)?captulo/i,/(captulos?\s+\d+\s+y\s+\d+)\s+(deberan|podran)\s+(ser\s+)?(uno|fusionarse)/i].some(a=>a.test(t))}reinterpretMergeAsCondensation(e){return e.map(t=>{if(!this.isMergeRequest(t))return t;console.log(`[OrchestratorV2] REINTERPRETING merge request as condensation: "${t.descripcion?.substring(0,80)}..."`);let n=t.instrucciones_correccion||"",a=t.capitulos_afectados||[],s=`
NOTA: La sugerencia original de "fusionar cap\xEDtulos" no es posible ejecutar autom\xE1ticamente.
ALTERNATIVA APLICADA: Condensaci\xF3n agresiva y mejora de ritmo.

INSTRUCCIONES DE CONDENSACI\xD3N (alternativa a fusi\xF3n):
1. CONDENSAR AGRESIVAMENTE: Eliminar todo el relleno, descripciones redundantes y di\xE1logos que no aporten informaci\xF3n nueva.
2. MEJORAR TRANSICIONES: Crear conexiones narrativas m\xE1s fluidas con el cap\xEDtulo anterior/siguiente.
3. ELIMINAR REDUNDANCIAS: Si informaci\xF3n ya apareci\xF3 en cap\xEDtulos adyacentes, eliminarla.
4. ACELERAR RITMO: Convertir exposici\xF3n en acci\xF3n, reducir mon\xF3logo interno.
5. OBJETIVO: Reducir extensi\xF3n al menos 30% manteniendo toda la informaci\xF3n esencial.

Contexto original del revisor: ${n}

Cap\xEDtulos a condensar: ${a.join(", ")}
`.trim();return{...t,categoria:"ritmo",instrucciones_correccion:s,descripcion:`[REINTERPRETADO: fusi\xF3n \u2192 condensaci\xF3n] ${t.descripcion||""}`}})}async autoResolveStructuralIssues(e,t,n){let a=[],s=[];for(let o of t){let i=this.isStructuralIssue(o),u=(o.capitulos_afectados||[]).map(p=>this.normalizeToDbChapterNumber(p)),c=u.length>0&&u.every(p=>(n.get(p)||0)>=2);i&&c?(console.log(`[OrchestratorV2] AUTO-RESOLVING structural issue: "${o.categoria}" in caps ${u.join(",")} - cannot be fixed by rewriting`),a.push(o)):s.push(o)}return a.length>0&&(await this.markIssuesResolved(e,a),await b.createActivityLog({projectId:e,level:"info",message:`Se marcaron ${a.length} issue(s) estructurales como "aceptados con reservas" (requieren edici\xF3n manual: mover cap\xEDtulos, cambiar t\xEDtulos, etc.)`,agentRole:"orchestrator",metadata:{structuralIssues:a.map(o=>({categoria:o.categoria,descripcion:o.descripcion?.substring(0,100),capitulos:o.capitulos_afectados}))}})),{resolvedIssues:a,remainingIssues:s}}async trackPersistentIssues(e,t,n){let o=((await b.getProject(e))?.chapterCorrectionCounts||{})._persistentIssues||{},i=[],u=new Map;for(let C of t){let A=this.generateIssueHash(C),E=(o[A]||0)+1;u.set(A,E),E>=3&&(i.push(C),console.log(`[OrchestratorV2] LOOP DETECTED: Issue "${C.categoria}" in caps ${C.capitulos_afectados?.join(",")} persisted ${E} cycles`))}let c={},p=Array.from(u.entries());for(let[C,A]of p)c[C]=A;let f=(await b.getProject(e))?.chapterCorrectionCounts||{},g={};for(let C of Object.keys(f))C!=="_persistentIssues"&&typeof f[C]=="number"&&(g[C]=f[C]);let y={...g,_persistentIssues:c};return await b.updateProject(e,{chapterCorrectionCounts:y}),{persistentIssues:i,newIssueCounts:u}}isResurrectionError(e){let t=(e.descripcion||"").toLowerCase(),n=(e.instrucciones_correccion||"").toLowerCase(),a=(e.categoria||"").toLowerCase(),o=["muerto","muere","muri\xF3","fallecido","fallece","muerte","resucita","resurreccion","reaparece vivo","aparece vivo","personaje muerto aparece","muerto habla","muerto act\xFAa","dead","dies","died","deceased","killed","resurrect"].some(c=>t.includes(c)||n.includes(c)),i=(e.severidad||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),u=i==="critica"||i==="critical";return!!(o&&u||u&&(t.includes("personaje")||a.includes("continuidad")))}generateEscalatedCorrection(e,t){let n=this.isResurrectionError(e),a=(e.capitulos_afectados||[]).map(o=>this.normalizeToDbChapterNumber(o));if(n){let i=(e.descripcion||"").match(/(?:personaje|character|Clara|[A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)\s+(?:que\s+)?(?:muere|muri|muerto|fallece|fallecido)/i),u=i?i[0].split(/\s+que\s+/i)[0].replace(/personaje|character/i,"").trim():"el personaje fallecido",c=Math.min(...a),p=t.filter(f=>f.chapterNumber>c).map(f=>f.chapterNumber),m=`[CORRECCI\xD3N DE RESURRECCI\xD3N] ${u} muri\xF3 en el cap\xEDtulo ${c}. OBLIGATORIO: Eliminar TODAS las apariciones activas de ${u} en cap\xEDtulos ${p.join(", ")}. ${u} solo puede aparecer en: (1) recuerdos expl\xEDcitamente marcados como flashback, (2) referencias en pasado ("cuando estaba vivo..."), (3) duelo de otros personajes. NO puede hablar, actuar, caminar, ni ser descrito como presente.`;return{affectedChapters:[...a,...p],instruction:m}}let s=`[CORRECCI\xD3N EXPANDIDA] Este problema ha persistido 3+ ciclos sin resolverse. Se requiere una reescritura m\xE1s amplia de los cap\xEDtulos afectados (${a.join(", ")}) para eliminar la ra\xEDz del problema: ${e.descripcion}`;return{affectedChapters:a,instruction:s}}async initializeConsistencyDatabase(e,t,n){console.log(`[OrchestratorV2] Initializing consistency database for project ${e}`);try{console.log("[OrchestratorV2] Checking existing entities...");let a=await b.getWorldEntitiesByProject(e);if(a.length>0){console.log(`[OrchestratorV2] Consistency DB already initialized (${a.length} entities)`),this.callbacks.onAgentStatus("universal-consistency","completed",`Using ${a.length} existing entities`);return}let s=t.characters||[],o=t.worldRules||[];console.log(`[OrchestratorV2] Extracting entities from ${s.length} characters and ${o.length} rules...`);let{entities:i,rules:u}=await co.extractInitialEntities(s,o,n,e);console.log(`[OrchestratorV2] Creating ${i.length} entities in database...`);for(let c=0;c<i.length;c++)await b.createWorldEntity(i[c]),(c+1)%10===0&&console.log(`[OrchestratorV2] Created ${c+1}/${i.length} entities...`);console.log(`[OrchestratorV2] Creating ${u.length} rules in database...`);for(let c of u)await b.createWorldRule(c);console.log(`[OrchestratorV2] Initialized: ${i.length} entities, ${u.length} rules`),this.callbacks.onAgentStatus("universal-consistency","completed",`Initialized ${i.length} entities, ${u.length} rules`)}catch(a){console.error("[OrchestratorV2] Error initializing consistency database:",a),this.callbacks.onAgentStatus("universal-consistency","error",`Error: ${a instanceof Error?a.message:"Unknown"}`)}}async getConsistencyContext(e){let[t,n,a]=await Promise.all([b.getWorldEntitiesByProject(e),b.getWorldRulesByProject(e),b.getEntityRelationshipsByProject(e)]),s=new Map(t.map(o=>[o.id,o.name]));return{entities:t.map(o=>({name:o.name,type:o.type,attributes:o.attributes||{},status:o.status,lastSeenChapter:o.lastSeenChapter||void 0})),rules:n.map(o=>({ruleDescription:o.ruleDescription,category:o.category||"GENERAL"})),relationships:a.map(o=>({subject:s.get(o.subjectId)||`Entity#${o.subjectId}`,target:s.get(o.targetId)||`Entity#${o.targetId}`,relationType:o.relationType,meta:o.meta||{}}))}}extractTimelineInfo(e,t,n){let a={},s=e?.plotOutline,o=e?.timeline_master||s?.timeline_master,i=e?.location_map||s?.location_map;if(o?.chapter_timeline){let u=o.chapter_timeline;a.chapter_timeline=u;let c=u.find(p=>p.chapter===t);if(c&&(a.current_chapter={day:c.day,time_of_day:c.time_of_day,location:c.location}),n!==void 0){let p=u.find(m=>m.chapter===n);p&&(a.previous_chapter={day:p.day,time_of_day:p.time_of_day,location:p.location})}}return i?.travel_times&&(a.travel_times=i.travel_times),Object.keys(a).length>0?a:void 0}extractNarrativeTimeFromChapter(e,t,n){let a=this.extractTimelineInfo(n,t);if(a?.current_chapter)return{chapter:t,narrativeTime:`${a.current_chapter.day}, ${a.current_chapter.time_of_day}`,location:a.current_chapter.location};let s=e.substring(0,2e3).toLowerCase(),o=[/(?:era|fue|haca|amaneci|al\s+amanecer)/i,/(?:por\s+la\s+maana|por\s+la\s+tarde|por\s+la\s+noche|al\s+medioda|al\s+atardecer|al\s+anochecer)/i,/(?:lunes|martes|mircoles|jueves|viernes|sbado|domingo)/i,/(?:da\s+\d+|el\s+\d+\s+de\s+\w+)/i,/(?:tres\s+das\s+despus|al\s+da\s+siguiente|dos\s+semanas|una\s+semana)/i],i="";for(let p of o){let m=s.match(p);if(m){i=m[0].trim();break}}let u=[/(?:en\s+(?:el|la|los|las)\s+)([A-Z][a-z]+(?:\s+(?:de|del|los|las|el|la)\s+[A-Z]?[a-z]+)*)/i],c="";for(let p of u){let m=s.match(p);if(m&&m[1]){c=m[1].trim();break}}return i||c?{chapter:t,narrativeTime:i||`Cap\xEDtulo ${t}`,location:c||void 0}:{chapter:t,narrativeTime:`Cap\xEDtulo ${t} (tiempo no especificado)`}}extractCharacterStates(e,t){let n=[],a=e?.plotOutline,s=e?.character_tracking||a?.character_tracking;if(s&&Array.isArray(s))for(let o of s){if(!o.chapter_states)continue;let i=o.chapter_states.filter(u=>u.chapter<=t).sort((u,c)=>c.chapter-u.chapter);if(i.length>0){let u=i[0];n.push({character:o.character,current_location:u.location,physical_state:u.physical_state,active_injuries:u.physical_state?.toLowerCase().includes("herida")||u.physical_state?.toLowerCase().includes("lesion")?[u.physical_state]:void 0,key_possessions:u.key_possessions})}}if(n.length===0&&e?.characters)for(let o of e.characters)o.initial_state&&n.push({character:o.name,current_location:o.initial_state.location,physical_state:o.initial_state.physical_condition,key_possessions:o.initial_state.resources});return n.length>0?n:void 0}buildFullWorldBibleForRewrite(e){if(!e)return"No hay World Bible disponible.";let t=[];if(e.personajes?.length>0){let a=e.personajes.map(s=>{let o=[];if(s.appearance){let c=s.appearance;(c.eyes||c.eye_color)&&o.push(`ojos: ${c.eyes||c.eye_color}`),(c.hair||c.hair_color)&&o.push(`cabello: ${c.hair||c.hair_color}`),c.height&&o.push(`altura: ${c.height}`),c.build&&o.push(`complexi\xF3n: ${c.build}`),c.skin&&o.push(`piel: ${c.skin}`),c.age&&o.push(`edad: ${c.age}`)}(s.eyes||s.eye_color)&&o.push(`ojos: ${s.eyes||s.eye_color}`),(s.hair||s.hair_color)&&o.push(`cabello: ${s.hair||s.hair_color}`),(s.edad||s.age)&&o.push(`edad: ${s.edad||s.age}`);let i=o.length>0?`
   [FISICO INMUTABLE]: ${o.join(", ")}`:"",u=s.muerto||s.dead?`
   [MUERTO] - NO PUEDE APARECER VIVO`:"";return`- ${s.nombre} (${s.rol||"secundario"})${i}${u}`}).join(`
`);t.push(`[PERSONAJES] Atributos f\xEDsicos INMUTABLES:
${a}`)}let n=e.personajes?.filter(a=>a.muerto||a.dead)||[];if(n.length>0){let a=n.map(s=>`[MUERTO] ${s.nombre} - no puede aparecer vivo`).join(`
`);t.push(`[PERSONAJES FALLECIDOS] PROHIBIDO MENCIONAR COMO VIVOS:
${a}`)}if(e.relaciones?.length>0){let a=e.relaciones.slice(0,15).map(s=>`- ${s.personaje1} <-> ${s.personaje2}: ${s.tipo||s.relacion||"relacionados"}`).join(`
`);t.push(`[RELACIONES ESTABLECIDAS]:
${a}`)}if(e.ubicaciones?.length>0){let a=e.ubicaciones.slice(0,15).map(s=>`- ${s.nombre}: ${s.descripcion?.substring(0,80)||"ubicacion establecida"}`).join(`
`);t.push(`[UBICACIONES] No cambiar nombres ni descripciones:
${a}`)}if(e.timeline?.length>0){let a=e.timeline.slice(0,15).map(s=>`- ${s.evento||s.event}: ${s.descripcion?.substring(0,60)||""}`).join(`
`);t.push(`[LINEA TEMPORAL] No alterar orden ni fechas:
${a}`)}if(e.reglas?.length>0){let a=e.reglas.slice(0,10).map(s=>`- ${typeof s=="string"?s:s.regla||JSON.stringify(s)}`).join(`
`);t.push(`[REGLAS DEL MUNDO] Deben respetarse:
${a}`)}if(e.objetos?.length>0){let a=e.objetos.slice(0,15).map(s=>`- ${s.nombre}: ${s.descripcion?.substring(0,60)||"objeto establecido"}`).join(`
`);t.push(`[OBJETOS ESTABLECIDOS] No inventar nuevos:
${a}`)}if(e.lesiones_activas?.length>0){let a=e.lesiones_activas.map(s=>`- ${s.personaje}: ${s.tipo_lesion} (desde cap ${s.capitulo_ocurre}${s.capitulo_cura?`, cura cap ${s.capitulo_cura}`:", aun activa"})`).join(`
`);t.push(`[LESIONES ACTIVAS] Limitan acciones del personaje:
${a}`)}return t.join(`

`)||"World Bible vac\xEDo."}mergeDecisions(e,t){let n=new Set(e.map(s=>`${s.decision}-${s.capitulo_establecido}`)),a=[...e];for(let s of t){let o=`${s.decision}-${s.capitulo_establecido}`;n.has(o)||(a.push(s),n.add(o))}return a}mergeInjuries(e,t){let n=new Set(e.map(s=>`${s.personaje}-${s.tipo_lesion}-${s.capitulo_ocurre}`)),a=[...e];for(let s of t){let o=`${s.personaje}-${s.tipo_lesion}-${s.capitulo_ocurre}`;n.has(o)||(a.push(s),n.add(o))}return a}async updateWorldBibleFromChapter(e,t,n,a){let s=await b.getWorldBibleByProject(e);if(!s)return;let o={},i=!1,u=[],c=[];for(let f of a)if((f.source==="continuity_sentinel"||f.tipo?.includes("continuidad"))&&(f.correccion||f.descripcion)&&u.push({decision:f.correccion||`Corregido: ${f.descripcion}`,capitulo_establecido:t,categoria:"correccion_continuidad",consistencia_actual:"consistente",fecha_registro:new Date().toISOString()}),f.descripcion?.toLowerCase().includes("lesion")||f.descripcion?.toLowerCase().includes("herida")||f.descripcion?.toLowerCase().includes("injury")){let g=f.descripcion.match(/(?:personaje|character|protagonist[a]?)\s+(\w+)/i);g&&c.push({personaje:g[1],tipo_lesion:"corregida",descripcion:f.correccion||f.descripcion,capitulo_ocurre:t,estado_actual:"activa"})}if(u.length>0){let f=Array.isArray(s.plotDecisions)?s.plotDecisions:[];o.plotDecisions=this.mergeDecisions(f,u),i=!0}if(c.length>0){let f=Array.isArray(s.persistentInjuries)?s.persistentInjuries:[];o.persistentInjuries=this.mergeInjuries(f,c),i=!0}let p=s.timeline||[];if(!p.find(f=>f.chapter===t)&&n.length>500){let f=n.substring(0,200).replace(/\n/g," ").trim()+"...";o.timeline=[...p,{chapter:t,event:`Cap\xEDtulo ${t} reescrito`,summary:f,timestamp:new Date().toISOString()}],i=!0}i&&(await b.updateWorldBible(s.id,o),console.log(`[OrchestratorV2] World Bible updated after Chapter ${t} rewrite: ${u.length} decisions, ${c.length} injuries`))}async extractInjuriesFromChapter(e,t,n,a){if(!n||n.length<500)return;let s=a.filter(o=>o.nombre||o.name).map(o=>o.nombre||o.name).slice(0,20);if(s.length!==0)try{let o=await this.injuryExtractor.execute({chapterNumber:t,content:n,characterNames:s});o.tokenUsage&&(this.addTokenUsage(o.tokenUsage),await this.logAiUsage(e,"injury-extractor","deepseek-chat",o.tokenUsage,t));let i=o;if(!i||!Array.isArray(i.injuries)||i.injuries.length===0)return;let u=i.injuries.filter(y=>{if(!y||typeof y!="object"||!y.personaje||typeof y.personaje!="string"||!y.tipo_lesion||typeof y.tipo_lesion!="string")return!1;let C=y.personaje.toLowerCase().trim();return s.some(A=>A.toLowerCase().trim()===C||A.toLowerCase().includes(C)||C.includes(A.toLowerCase()))});if(u.length===0)return;let c=await b.getWorldBibleByProject(e);if(!c)return;let p=Array.isArray(c.persistentInjuries)?c.persistentInjuries:[],m=["leve","moderada","grave","critica"],f=u.map(y=>({personaje:y.personaje.trim(),tipo_lesion:y.tipo_lesion.trim(),parte_afectada:(y.parte_afectada||"no especificada").trim(),capitulo_ocurre:t,severidad:m.includes(y.severidad?.toLowerCase())?y.severidad.toLowerCase():"moderada",efecto_esperado:(y.efecto_esperado||"Movimiento limitado").trim(),estado_actual:"activa",es_temporal:y.es_temporal===!0,fecha_registro:new Date().toISOString()})),g=this.mergeInjuries(p,f);await b.updateWorldBible(c.id,{persistentInjuries:g}),console.log(`[OrchestratorV2] Extracted ${f.length} injuries from Chapter ${t}:`,f.map(y=>`${y.personaje}: ${y.tipo_lesion}`).join(", "))}catch(o){console.warn(`[OrchestratorV2] Error extracting injuries from Chapter ${t}:`,o)}}formatDecisionsAndInjuriesAsConstraints(e,t,n){let a=[];if(e&&e.length>0){let s=e.filter(o=>o.capitulo_establecido<=n||(o.capitulos_afectados||[]).some(i=>i<=n));if(s.length>0){a.push(`
=== DECISIONES DE TRAMA ESTABLECIDAS ===`),a.push("ESTAS DECISIONES SON CAN\xD3NICAS Y NO PUEDEN CONTRADECIRSE:");for(let o of s){let i=o.consistencia_actual==="consistente"?"\u2713":"\u26A0\uFE0F INCONSISTENTE";a.push(`
${i} "${o.decision}" (Cap ${o.capitulo_establecido})`),o.capitulos_afectados?.length>0&&a.push(`   Afecta cap\xEDtulos: ${o.capitulos_afectados.join(", ")}`),o.consistencia_actual==="inconsistente"&&o.detalle_inconsistencia&&(a.push(`   PROBLEMA: ${o.detalle_inconsistencia}`),a.push("   \u2192 CORREGIR en este cap\xEDtulo si aplica"))}}}if(t&&t.length>0){let s=t.filter(o=>o.capitulo_ocurre<=n&&o.estado_actual!=="resuelta");if(s.length>0){a.push(`

=== LESIONES F\xCDSICAS ACTIVAS - RESTRICCIONES OBLIGATORIAS ===`);for(let o of s){let i=o.seguimiento==="ignorada"||o.seguimiento==="olvidada",u=i?"\u{1F6A8}":"\u{1FA79}";a.push(`
${u} ${o.personaje.toUpperCase()}: ${o.tipo_lesion}`),a.push(`   Desde: Cap\xEDtulo ${o.capitulo_ocurre}`);let c=this.getInjuryCapabilities(o.tipo_lesion,o.parte_afectada);c.cannot.length>0&&a.push(`   \u274C NO PUEDE: ${c.cannot.join(", ")}`),c.canWithDifficulty.length>0&&a.push(`   \u26A0\uFE0F CON DIFICULTAD/DOLOR: ${c.canWithDifficulty.join(", ")}`),c.can.length>0&&a.push(`   \u2713 S\xCD PUEDE: ${c.can.join(", ")}`),c.showAs.length>0&&a.push(`   \u{1F4DD} MOSTRAR COMO: ${c.showAs.join(", ")}`),o.efecto_esperado&&a.push(`   Descripci\xF3n: ${o.efecto_esperado}`),i&&a.push("   \u{1F6A8} ADVERTENCIA: Lesi\xF3n IGNORADA anteriormente - OBLIGATORIO mostrar efectos")}}}return a.join(`
`)}getInjuryCapabilities(e,t){let n=(e||"").toLowerCase(),a=(t||"").toLowerCase(),s={cannot:[],canWithDifficulty:[],can:[],showAs:[]};if((n.includes("afon\xEDa")||n.includes("afonia")||n.includes("mudo")||n.includes("voz"))&&(s.cannot.push("hablar normalmente","gritar","llamar a alguien"),s.canWithDifficulty.push("susurrar d\xE9bilmente","emitir sonidos guturales"),s.can.push("comunicarse con gestos","escribir notas","asentir/negar","se\xF1alar","expresar con la mirada"),s.showAs.push("gestos de frustraci\xF3n al no poder hablar","uso de libreta/papel","comunicaci\xF3n visual intensa")),a.includes("brazo")||a.includes("mano")||a.includes("mu\xF1eca")||n.includes("brazo")||n.includes("mano")||n.includes("fractura")&&a.includes("superior")){let o=a.includes("derech")?"derecha":a.includes("izquierd")?"izquierda":"afectada";s.cannot.push(`usar la mano ${o} con fuerza`,"cargar peso con ese brazo","escribir (si es dominante)"),s.canWithDifficulty.push("movimientos finos","agarrar objetos ligeros"),s.can.push("usar la otra mano","caminar","correr","hablar"),s.showAs.push("proteger el brazo herido","muecas de dolor al moverlo","usar cabestrillo/vendaje")}return(a.includes("pierna")||a.includes("pie")||a.includes("tobillo")||a.includes("rodilla")||n.includes("cojera")||n.includes("pierna")||n.includes("pie"))&&(s.cannot.push("correr","saltar","subir escaleras r\xE1pido","perseguir a alguien"),s.canWithDifficulty.push("caminar (cojeando)","subir escaleras lentamente","mantenerse de pie mucho tiempo"),s.can.push("sentarse","hablar","usar las manos","conducir (si es autom\xE1tico)"),s.showAs.push("cojera visible","apoyarse en paredes/muebles","muecas al caminar","necesitar ayuda para moverse")),(a.includes("cabeza")||n.includes("conmoci\xF3n")||n.includes("contusi\xF3n craneal")||n.includes("golpe en la cabeza"))&&(s.cannot.push("concentrarse por per\xEDodos largos","recordar detalles recientes","movimientos bruscos"),s.canWithDifficulty.push("pensar claramente","leer","seguir conversaciones complejas"),s.can.push("caminar despacio","hablar","descansar"),s.showAs.push("mareos","dolor de cabeza","sensibilidad a la luz","confusi\xF3n moment\xE1nea","n\xE1useas")),(a.includes("ojo")||n.includes("ceguera")||n.includes("visi\xF3n"))&&((n.includes("parcial")||a.includes("un ojo")?"parcialmente":"totalmente")==="totalmente"?(s.cannot.push("ver","leer","reconocer rostros a distancia","conducir"),s.canWithDifficulty.push("orientarse en espacios conocidos"),s.can.push("o\xEDr","hablar","tocar","caminar con ayuda"),s.showAs.push("pedir descripciones","tantear con las manos","depender de otros para gu\xEDa")):(s.cannot.push("ver por el ojo afectado","percibir profundidad correctamente"),s.canWithDifficulty.push("leer","calcular distancias"),s.can.push("ver con el otro ojo","caminar","hablar"),s.showAs.push("girar la cabeza para compensar","vendaje en el ojo"))),(n.includes("costilla")||a.includes("costilla")||a.includes("torso")||n.includes("tor\xE1cic"))&&(s.cannot.push("respirar profundamente sin dolor","re\xEDr","toser sin dolor","levantar peso"),s.canWithDifficulty.push("moverse","agacharse","girar el torso"),s.can.push("hablar (con pausas)","caminar despacio","usar las manos"),s.showAs.push("respiraci\xF3n superficial","sujetarse el costado","evitar movimientos bruscos")),(n.includes("quemadura")||n.includes("quemado"))&&(s.cannot.push("tocar la zona afectada","exponerla al sol/calor"),s.canWithDifficulty.push("mover la zona quemada","usar ropa ajustada"),s.can.push("hablar","pensar","zonas no afectadas funcionan normal"),s.showAs.push("vendajes","evitar contacto","muecas de dolor","piel enrojecida/ampollas visibles")),(n.includes("trauma")||n.includes("shock")||n.includes("p\xE1nico")||n.includes("estr\xE9s post"))&&(s.cannot.push("mantener la calma en situaciones similares al trauma","dormir bien"),s.canWithDifficulty.push("concentrarse","tomar decisiones bajo presi\xF3n","confiar en desconocidos"),s.can.push("funciones f\xEDsicas normales","hablar","moverse"),s.showAs.push("flashbacks","sobresaltos","evitar ciertos lugares/situaciones","insomnio","irritabilidad")),s.cannot.length===0&&s.canWithDifficulty.length===0&&(s.canWithDifficulty.push("actividades que involucren la zona afectada"),s.showAs.push("signos visibles de malestar","proteger la zona herida")),s}async buildEnrichedContextOptions(e){let t={};if(e.kindleUnlimitedOptimized&&(t.kindleUnlimitedOptimized=!0),e.seriesId&&e.seriesOrder)try{let n=await b.getSeries(e.seriesId);if(n&&(t.seriesInfo={seriesTitle:n.title,bookNumber:e.seriesOrder,totalBooks:n.totalPlannedBooks||void 0},e.seriesOrder>1)){let s=(await b.getProjectsBySeries(e.seriesId)).filter(o=>o.seriesOrder&&o.seriesOrder<e.seriesOrder&&o.status==="completed").sort((o,i)=>(o.seriesOrder||0)-(i.seriesOrder||0));if(s.length>0){let o=[];for(let i of s){let u=await b.getWorldBibleByProject(i.id);if(u){let p=(Array.isArray(u.characters)?u.characters:[]).slice(0,3).map(m=>m.name||m.nombre).join(", ");o.push(`Libro ${i.seriesOrder}: "${i.title}" - Personajes: ${p}`)}}o.length>0&&(t.seriesInfo.previousBooksSummary=o.join(`
`))}}}catch(n){console.error("[OrchestratorV2] Failed to get series context:",n)}return t}async buildEnrichedWritingContext(e,t,n,a){let s=[];if(a?.kindleUnlimitedOptimized&&s.push(`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551  \u26A1 OPTIMIZACI\xD3N KINDLE UNLIMITED - RITMO R\xC1PIDO OBLIGATORIO \u26A1              \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  Este libro es para KU. Los lectores de KU abandonan si el ritmo es lento.  \u2551
\u2551  CADA ESCENA debe mantener al lector enganchado.                            \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  PROHIBIDO (causa rechazo por "pacing slow"):                               \u2551
\u2551  \u2022 P\xE1rrafos de descripci\xF3n de m\xE1s de 3 l\xEDneas seguidas                      \u2551
\u2551  \u2022 Escenas donde los personajes solo hablan sin acci\xF3n                      \u2551
\u2551  \u2022 Mon\xF3logos internos extensos (m\xE1ximo 2-3 oraciones seguidas)              \u2551
\u2551  \u2022 Flashbacks de m\xE1s de 1 p\xE1rrafo                                           \u2551
\u2551  \u2022 Descripciones de paisajes, habitaciones o vestimenta detalladas          \u2551
\u2551  \u2022 Escenas de "transici\xF3n" sin conflicto ni tensi\xF3n                         \u2551
\u2551  \u2022 Di\xE1logos sobre temas irrelevantes para la trama                          \u2551
\u2551  \u2022 Repetir informaci\xF3n que el lector ya conoce                              \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  OBLIGATORIO (mantiene ritmo r\xE1pido):                                       \u2551
\u2551  \u2022 Empezar IN MEDIA RES - acci\xF3n o di\xE1logo desde la primera l\xEDnea           \u2551
\u2551  \u2022 Intercalar descripci\xF3n con acci\xF3n (nunca m\xE1s de 2 l\xEDneas descripci\xF3n)    \u2551
\u2551  \u2022 Di\xE1logos con subtexto, tensi\xF3n o informaci\xF3n nueva                       \u2551
\u2551  \u2022 Cada p\xE1gina debe tener al menos un micro-conflicto o revelaci\xF3n          \u2551
\u2551  \u2022 Terminar escenas en momento de tensi\xF3n (antes de la resoluci\xF3n)          \u2551
\u2551  \u2022 Cortar escenas cuando el objetivo se cumple (no estirar)                 \u2551
\u2551  \u2022 Usar verbos activos, oraciones cortas en momentos de tensi\xF3n             \u2551
\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563
\u2551  ESTRUCTURA DE ESCENA KU:                                                   \u2551
\u2551  \u2022 20% Setup r\xE1pido \u2192 60% Desarrollo con tensi\xF3n \u2192 20% Cliffhanger          \u2551
\u2551  \u2022 M\xE1ximo 400-500 palabras por escena (excepto escenas cl\xEDmax)              \u2551
\u2551  \u2022 Si una escena no avanza trama O personajes, ELIMINARLA                   \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D
`),a?.seriesInfo){let{seriesTitle:g,bookNumber:y,totalBooks:C,previousBooksSummary:A}=a.seriesInfo;s.push(`=== \u{1F4DA} CONTEXTO DE SERIE: "${g}" ===`),s.push(`Este es el LIBRO ${y}${C?` de ${C}`:""} de la serie.`),y>1?(s.push(`
CONSIDERACIONES PARA LIBROS POSTERIORES:`),s.push("\u2022 Los personajes recurrentes deben mantener consistencia con libros anteriores"),s.push("\u2022 Proporcionar contexto sutil para nuevos lectores sin aburrir a fans"),s.push("\u2022 Respetar eventos y decisiones de libros anteriores"),s.push("\u2022 Mantener el tono y estilo establecido en la serie"),A&&(s.push(`
RESUMEN DE LIBROS ANTERIORES:`),s.push(A.substring(0,1e3)))):(s.push(`
CONSIDERACIONES PARA PRIMER LIBRO DE SERIE:`),s.push("\u2022 Establecer claramente el mundo y los personajes principales"),s.push("\u2022 Plantar semillas para arcos futuros sin resolver todo"),s.push("\u2022 Crear ganchos que inviten a continuar la serie"),s.push("\u2022 Dejar hilos argumentales abiertos de forma intencional")),s.push("")}let o=n?.characters||[];if(o.length>0){s.push(`
=== PERFILES DE PERSONAJES (OBLIGATORIO RESPETAR) ===`);let g=o.slice(0,8);for(let y of g){if(s.push(`
\u{1F4CC} ${y.name||y.nombre}:`),(y.description||y.descripcion)&&s.push(`   Descripci\xF3n: ${(y.description||y.descripcion).substring(0,200)}`),(y.personality||y.personalidad)&&s.push(`   Personalidad: ${y.personality||y.personalidad}`),y.traits||y.rasgos){let C=Array.isArray(y.traits||y.rasgos)?(y.traits||y.rasgos).join(", "):y.traits||y.rasgos;s.push(`   Rasgos distintivos: ${C}`)}if(y.relationships||y.relaciones){let C=Array.isArray(y.relationships||y.relaciones)?(y.relationships||y.relaciones).map(A=>typeof A=="string"?A:`${A.character||A.personaje}: ${A.type||A.tipo}`).join("; "):y.relationships||y.relaciones;s.push(`   Relaciones: ${C}`)}(y.arc||y.arco)&&s.push(`   Arco narrativo: ${y.arc||y.arco}`),(y.voice||y.voz)&&s.push(`   Estilo de voz: ${y.voice||y.voz}`)}}let i=n?.worldRules||n?.rules||[];if(i.length>0){s.push(`

=== REGLAS DEL MUNDO (INVIOLABLES) ===`);let g=i.slice(0,10);for(let y of g)typeof y=="string"?s.push(`\u2022 ${y}`):(y.rule||y.regla)&&(s.push(`\u2022 ${y.rule||y.regla}`),(y.exception||y.excepcion)&&s.push(`  (Excepci\xF3n: ${y.exception||y.excepcion})`))}let u=n?.plotOutline,c=n?.locations||n?.ubicaciones||n?.settings||u?.settings||[];if(c.length>0){s.push(`

=== UBICACIONES CLAVE ===`);let g=c.slice(0,6);for(let y of g){let C=y.name||y.nombre||y,A=y.description||y.descripcion||"";s.push(`\u2022 ${C}${A?`: ${A.substring(0,100)}`:""}`)}}try{let g=await b.getConsistencyViolationsByProject(e);if(g&&g.length>0){let y=g.slice(0,10),C=new Set;for(let A of y)A.description&&C.add(`NO REPETIR: ${A.description.substring(0,150)}`);if(C.size>0){s.push(`

=== \u26A0\uFE0F ERRORES ANTERIORES A EVITAR ===`),s.push("Estos errores se detectaron anteriormente. NO los repitas:");for(let A of Array.from(C).slice(0,5))s.push(`\u2022 ${A}`)}}}catch{}let p=n?.timeline||[];if(p.length>0&&t>1){s.push(`

=== EVENTOS PREVIOS RELEVANTES ===`);let g=p.filter(y=>(y.chapter||y.capitulo||0)<t).slice(-5);for(let y of g){let C=y.chapter||y.capitulo||"?",A=y.event||y.evento||y.summary||y.resumen||"";A&&s.push(`\u2022 [Cap ${C}] ${A.substring(0,150)}`)}}let m=n?.genre||"";m&&(s.push(`

=== ANTIPATRONES A EVITAR (${m.toUpperCase()}) ===`),s.push("\u2022 NO usar deus ex machina o coincidencias forzadas"),s.push("\u2022 NO contradecir informaci\xF3n establecida en cap\xEDtulos anteriores"),s.push("\u2022 NO ignorar lesiones, heridas o condiciones f\xEDsicas de personajes"),s.push("\u2022 NO cambiar la personalidad de un personaje sin justificaci\xF3n"),s.push("\u2022 NO saltar el tiempo sin transici\xF3n clara"),s.push("\u2022 NO introducir personajes sin presentaci\xF3n adecuada"));let f=n?.styleGuide;return f&&f.length>50&&(s.push(`

=== GU\xCDA DE ESTILO (OBLIGATORIO SEGUIR) ===`),s.push(f)),s.length>0?s.join(`
`):""}async buildConsistencyContextForCorrection(e,t,n,a){let s=[];try{let o=await this.getConsistencyContext(e);if(o.entities.length>0){let y=this.extractTimelineInfo(n,t),C=this.extractCharacterStates(n,t),A=co.generateConstraints(a.genre,o.entities,o.rules,o.relationships,t,y,C);A&&s.push(A)}let i=await b.getWorldBibleByProject(e);if(i){let y=this.formatDecisionsAndInjuriesAsConstraints(i.plotDecisions,i.persistentInjuries,t);y&&s.push(y)}let u=await this.getSceneSummariesContext(e,t);u&&s.push(u);let c=await this.buildEnrichedContextOptions(a),p=await this.buildEnrichedWritingContext(e,t,n,c);p&&s.push(p);let m=o.entities.filter(y=>y.type==="character"&&(y.status==="dead"||y.status==="deceased"||y.status==="muerto"));if(m.length>0){s.push(`
=== \u26A0\uFE0F PERSONAJES FALLECIDOS (NO PUEDEN ACTUAR, HABLAR NI APARECER ACTIVAMENTE) ===`);for(let y of m)s.push(`\u2022 ${y.name}: MUERTO desde cap\xEDtulo ${y.lastSeenChapter||"?"}. Solo puede aparecer en flashbacks o recuerdos.`)}let f=await this.getChapterDecisionContext(e,t);f&&s.push(f);let g=this.buildCanonicalElementsSection(n,o.entities,t);g&&s.push(g)}catch(o){console.error("[OrchestratorV2] Error building correction context:",o)}return s.join(`

`)}buildCanonicalElementsSection(e,t,n){let a=[],s=e?.characters||e?.personajes||[];for(let p of s.slice(0,10)){let m=p.name||p.nombre,f=p.eyeColor||p.ojos||p.physical_traits?.eyes,g=p.hairColor||p.cabello||p.physical_traits?.hair,y=p.age||p.edad,C=p.status||p.estado;if(m){let A=[];f&&A.push(`ojos: ${f}`),g&&A.push(`cabello: ${g}`),y&&A.push(`edad: ${y}`),(C==="dead"||C==="muerto"||C==="deceased")&&A.push("MUERTO - NO PUEDE ACTUAR"),A.length>0&&a.push(`\u2022 ${m}: ${A.join(", ")}`)}}let o=e?.locations||e?.ubicaciones||[];for(let p of o.slice(0,5)){let m=p.name||p.nombre;m&&a.push(`\u2022 Ubicaci\xF3n "${m}": NO cambiar nombre ni descripci\xF3n f\xEDsica`)}let u=(e?.timeline||[]).filter(p=>p.chapter===n||p.chapter===n-1).slice(0,5);for(let p of u){let m=p.event||p.evento||p.description;m&&a.push(`\u2022 Evento establecido: "${m.substring(0,100)}"`)}let c=t.filter(p=>p.type==="PERSONAL_ITEM"||p.type==="item"||p.type==="object");for(let p of c.slice(0,5))a.push(`\u2022 Objeto "${p.name}": NO eliminar si ya fue mencionado`);return a.length===0?"":`=== \u26D4 ELEMENTOS CAN\xD3NICOS INTOCABLES (NO MODIFICAR BAJO NING\xDAN CONCEPTO) ===
Las correcciones NO deben alterar estos elementos establecidos. Si el problema reportado contradice estos elementos, el problema es del REPORTE, no del texto:

${a.join(`
`)}

\u26A0\uFE0F REGLA CR\xCDTICA: Al corregir, PRESERVAR todos los elementos can\xF3nicos. Solo modificar el texto espec\xEDfico que causa el problema reportado. Si una correcci\xF3n requiere cambiar un elemento can\xF3nico, NO aplicarla.`}async validateCorrectionConsistency(e,t,n,a){let s=[],o=0,i=p=>p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),u=p=>{let m={azul:["azul","azules","azulado","azulados"],verde:["verde","verdes","verdoso","verdosos"],marr\u00F3n:["marr\xF3n","marrones","marron","casta\xF1o","casta\xF1os"],gris:["gris","grises","gris\xE1ceo","gris\xE1ceos","plomizo"],negro:["negro","negros","oscuro","oscuros","azabache"],miel:["miel","\xE1mbar","dorado","dorados"],avellana:["avellana","avellanas","almendrado"]},f=p.toLowerCase();for(let[g,y]of Object.entries(m))if(y.some(C=>f.includes(C)))return y;return[f]};try{let p=n?.characters||n?.personajes||[];for(let g of p.slice(0,10)){let y=g.name||g.nombre;if(!y||y.length<2)continue;let C=i(y),A=g.eyeColor||g.ojos||g.physical_traits?.eyes,T=g.hairColor||g.cabello||g.physical_traits?.hair;if(A){let E=u(A),d=new RegExp(`${C}[^.]{0,50}ojos\\s+(?:de\\s+color\\s+)?(\\w+)`,"gi"),l=Array.from(t.matchAll(d));for(let h of l){let v=h[1]?.toLowerCase();v&&!E.some(S=>v.includes(S.substring(0,4)))&&(e.includes(h[0])||(s.push(`Color de ojos de ${y} cambiado a "${v}" (deber\xEDa ser: ${A})`),o++))}}if(T){let E=u(T),d=new RegExp(`${C}[^.]{0,50}(?:cabello|pelo|melena)\\s+(?:de\\s+color\\s+)?(\\w+)`,"gi"),l=Array.from(t.matchAll(d));for(let h of l){let v=h[1]?.toLowerCase();v&&!E.some(S=>v.includes(S.substring(0,4)))&&(e.includes(h[0])||(s.push(`Color de cabello de ${y} cambiado a "${v}" (deber\xEDa ser: ${T})`),o++))}}}let m=p.filter(g=>g.status==="dead"||g.status==="muerto"||g.status==="deceased");for(let g of m){let y=g.name||g.nombre;if(!y)continue;let C=i(y),A=new RegExp(`${C}\\s+(?:dijo|respondi\xF3|camin\xF3|corri\xF3|mir\xF3|sonri\xF3|grit\xF3|susurr\xF3|se\\s+levant\xF3)`,"gi"),T=Array.from(e.matchAll(A));Array.from(t.matchAll(A)).length>T.length&&(s.push(`\u26A0\uFE0F CR\xCDTICO: Personaje muerto ${y} realiza acciones activas (posible resurrecci\xF3n)`),o+=2)}let f=n?.locations||n?.ubicaciones||[];for(let g of f.slice(0,8)){let y=g.name||g.nombre;if(!(!y||y.length<3))try{let C=i(y),A=new RegExp(C,"gi"),T=Array.from(e.matchAll(A)).length,E=Array.from(t.matchAll(A)).length;T>0&&E===0&&s.push(`Ubicaci\xF3n "${y}" eliminada de la correcci\xF3n (estaba ${T} veces)`)}catch{console.warn(`[Validation] Skipping location "${y}" due to invalid pattern`)}}}catch(p){console.error("[OrchestratorV2] Error validating correction consistency:",p)}let c=o>=2?"high":o>=1||s.length>=3?"medium":(s.length>0,"low");return{valid:s.length===0,regressions:s,severity:c}}async validateCorrectionWithAI(e,t,n,a,s){try{let i=(n?.characters||n?.personajes||[]).slice(0,5).map(T=>{let E=T.name||T.nombre,d=[];return(T.eyeColor||T.ojos)&&d.push(`ojos: ${T.eyeColor||T.ojos}`),(T.hairColor||T.cabello)&&d.push(`cabello: ${T.hairColor||T.cabello}`),(T.personality||T.personalidad)&&d.push(`personalidad: ${T.personality||T.personalidad}`),(T.status==="dead"||T.status==="muerto")&&d.push("ESTADO: MUERTO"),`- ${E}: ${d.join(", ")}`}).join(`
`),c=(n?.locations||n?.ubicaciones||[]).slice(0,5).map(T=>`- ${T.name||T.nombre}`).join(`
`),p=this.extractSurgicalChanges(e,t),m=`Eres un validador de correcciones literarias. Tu tarea es evaluar si una correcci\xF3n quir\xFArgica introduce problemas de consistencia.

## WORLD BIBLE (Elementos can\xF3nicos que NO deben cambiar)
### Personajes:
${i||"No disponible"}

### Ubicaciones:
${c||"No disponible"}

## PROBLEMAS ORIGINALES QUE SE INTENTABAN CORREGIR:
${s.slice(0,5).join(`
`)}

## CAMBIOS DETECTADOS (secciones modificadas):
${p||"No se detectaron cambios significativos"}

## CONTEXTO GENERAL:
### Inicio del texto original:
${e.substring(0,800)}...

### Inicio del texto corregido:
${t.substring(0,800)}...

## INSTRUCCIONES DE VALIDACI\xD3N:
Analiza si la correcci\xF3n:
1. \xBFCambi\xF3 caracter\xEDsticas f\xEDsicas de personajes (color de ojos, cabello, edad)?
2. \xBFResucit\xF3 personajes que deber\xEDan estar muertos?
3. \xBFElimin\xF3 ubicaciones importantes o las renombr\xF3?
4. \xBFCambi\xF3 la personalidad o comportamiento t\xEDpico de un personaje?
5. \xBFIntrodujo inconsistencias temporales (eventos fuera de orden)?
6. \xBFElimin\xF3 informaci\xF3n importante sin reemplazarla?

Responde OBLIGATORIAMENTE en JSON con este formato exacto:
{
  "approved": true,
  "confidence": 0.9,
  "concerns": []
}

O si hay problemas:
{
  "approved": false,
  "confidence": 0.8,
  "concerns": ["problema 1", "problema 2"]
}

Si la correcci\xF3n es segura y solo arregla los problemas reportados, apru\xE9bala.
Si detectas cambios problem\xE1ticos, rech\xE1zala con concerns espec\xEDficos.`,f=process.env.DEEPSEEK_API_KEY;if(!f)return console.warn("[OrchestratorV2] No DEEPSEEK_API_KEY available for AI validation, skipping"),{approved:!0,concerns:["Sin API key para validaci\xF3n IA"],confidence:.3};let A=((await new Ve({apiKey:f,baseURL:"https://api.deepseek.com"}).chat.completions.create({model:"deepseek-chat",messages:[{role:"system",content:"Eres un validador experto de consistencia literaria. Respondes SOLO en JSON v\xE1lido, sin texto adicional."},{role:"user",content:m}],temperature:.1,max_tokens:500})).choices[0]?.message?.content||"").match(/\{[\s\S]*\}/);if(A)try{let T=JSON.parse(A[0]);return typeof T.approved!="boolean"?(console.warn("[OrchestratorV2] AI validation returned invalid approved field, treating as suspicious"),{approved:!1,concerns:["Respuesta IA inv\xE1lida - revisi\xF3n manual recomendada"],confidence:.5}):{approved:T.approved===!0,concerns:Array.isArray(T.concerns)?T.concerns:[],confidence:typeof T.confidence=="number"?Math.min(1,Math.max(0,T.confidence)):.5}}catch(T){return console.warn(`[OrchestratorV2] Failed to parse AI validation JSON: ${T}`),{approved:!1,concerns:["Error parsing respuesta IA - revisi\xF3n manual recomendada"],confidence:.6}}return console.warn("[OrchestratorV2] AI validation returned no JSON, treating as suspicious"),{approved:!1,concerns:["No se pudo obtener validaci\xF3n IA - revisi\xF3n manual recomendada"],confidence:.5}}catch(o){return console.error("[OrchestratorV2] Error in AI correction validation:",o),{approved:!0,concerns:["Error de conexi\xF3n IA - aprobado con precauci\xF3n"],confidence:.3}}}extractSurgicalChanges(e,t){let n=[];try{let a=e.split(/(?<=[.!?])\s+/).filter(c=>c.trim().length>10),s=t.split(/(?<=[.!?])\s+/).filter(c=>c.trim().length>10),o=new Set(a.map(c=>c.trim())),i=new Set(s.map(c=>c.trim())),u={added:0,removed:0,modified:0};for(let c of a){let p=c.trim();if(!i.has(p)&&n.length<6){let m=s.find(f=>this.sentenceSimilarity(p,f.trim())>.6);m?(n.push(`[MODIFICADO]
  ANTES: "${p.substring(0,120)}${p.length>120?"...":""}"
  DESPU\xC9S: "${m.trim().substring(0,120)}${m.length>120?"...":""}"`),u.modified++,i.delete(m.trim())):(n.push(`[ELIMINADO]: "${p.substring(0,150)}${p.length>150?"...":""}"`),u.removed++)}}for(let c of s){let p=c.trim();!o.has(p)&&i.has(p)&&n.length<6&&(n.push(`[A\xD1ADIDO]: "${p.substring(0,150)}${p.length>150?"...":""}"`),u.added++)}if(n.length===0){let c=e.replace(/\s+/g," ").trim(),p=t.replace(/\s+/g," ").trim();return c===p?"Solo cambios de formato (espacios/saltos de l\xEDnea)":`Cambios menores no detectables a nivel de oraci\xF3n (${a.length} oraciones)`}return`Resumen: ${u.added} a\xF1adidos, ${u.removed} eliminados, ${u.modified} modificados

${n.join(`

`)}`}catch(a){return console.warn("[OrchestratorV2] Error extracting surgical changes:",a),"No se pudieron extraer cambios espec\xEDficos"}}sentenceSimilarity(e,t){let n=new Set(e.toLowerCase().split(/\s+/).filter(o=>o.length>2)),a=new Set(t.toLowerCase().split(/\s+/).filter(o=>o.length>2));if(n.size===0||a.size===0)return 0;let s=0;for(let o of Array.from(n))a.has(o)&&s++;return s/Math.max(n.size,a.size)}async analyzeAndSaveStyleGuide(e,t){if(!t||t.length<50)return"";let n=[],a=t.split(/\n+/).filter(C=>C.trim().length>10),s={voz:[],dialogos:[],vocabulario:[],prohibido:[],tono:[],estructura:[],puntuacion:[],otros:[]},o=["narrador","voz","perspectiva","punto de vista","primera persona","tercera persona","omnisciente"],i=["di\xE1logo","dialogo","hablar","conversar","guion","comillas","dijo","respondi\xF3"],u=["vocabulario","palabras","usar","preferir","t\xE9rminos","lenguaje"],c=["evitar","no usar","prohibido","nunca","jam\xE1s","no escribir","eliminar"],p=["tono","atm\xF3sfera","ambiente","sensaci\xF3n","emoci\xF3n","sentimiento"],m=["oraciones","p\xE1rrafos","longitud","estructura","ritmo","cadencia"],f=["puntuaci\xF3n","comas","puntos","signos","may\xFAsculas","min\xFAsculas"];for(let C of a){let A=C.toLowerCase();o.some(T=>A.includes(T))?s.voz.push(C.trim()):i.some(T=>A.includes(T))?s.dialogos.push(C.trim()):c.some(T=>A.includes(T))?s.prohibido.push(C.trim()):u.some(T=>A.includes(T))?s.vocabulario.push(C.trim()):p.some(T=>A.includes(T))?s.tono.push(C.trim()):m.some(T=>A.includes(T))?s.estructura.push(C.trim()):f.some(T=>A.includes(T))?s.puntuacion.push(C.trim()):C.trim().length>20&&C.trim().length<300&&s.otros.push(C.trim())}let g=[];s.voz.length>0&&(g.push("VOZ NARRATIVA:"),g.push(...s.voz.slice(0,5).map(C=>`  \u2022 ${C.substring(0,200)}`))),s.dialogos.length>0&&(g.push(`
DI\xC1LOGOS:`),g.push(...s.dialogos.slice(0,5).map(C=>`  \u2022 ${C.substring(0,200)}`))),s.tono.length>0&&(g.push(`
TONO:`),g.push(...s.tono.slice(0,3).map(C=>`  \u2022 ${C.substring(0,200)}`))),s.prohibido.length>0&&(g.push(`
\u26A0\uFE0F EVITAR:`),g.push(...s.prohibido.slice(0,8).map(C=>`  \u2022 ${C.substring(0,200)}`))),s.vocabulario.length>0&&(g.push(`
VOCABULARIO:`),g.push(...s.vocabulario.slice(0,5).map(C=>`  \u2022 ${C.substring(0,200)}`))),s.estructura.length>0&&(g.push(`
ESTRUCTURA:`),g.push(...s.estructura.slice(0,3).map(C=>`  \u2022 ${C.substring(0,200)}`))),s.puntuacion.length>0&&(g.push(`
PUNTUACI\xD3N:`),g.push(...s.puntuacion.slice(0,3).map(C=>`  \u2022 ${C.substring(0,200)}`))),s.otros.length>0&&g.length<30&&(g.push(`
OTRAS REGLAS:`),g.push(...s.otros.slice(0,5).map(C=>`  \u2022 ${C.substring(0,200)}`)));let y=g.join(`
`);if(y.length>50)try{let C=await b.getWorldBibleByProject(e);C&&(await b.updateWorldBible(C.id,{styleGuide:y}),console.log(`[OrchestratorV2] Saved condensed style guide to World Bible (${y.length} chars from ${t.length} original)`))}catch(C){console.error("[OrchestratorV2] Failed to save style guide to World Bible:",C)}return y}extractSceneSummary(e,t){let a=e.split(/[.!?]+/).filter(i=>i.trim().length>10)[0]?.trim().substring(0,150)||"",s=t.characters?.join(", ")||"";return`${t.plot_beat} [${s}]. ${a}...`.substring(0,300)}async saveSceneSummaries(e,t,n){try{let a=await b.getWorldBibleByProject(e);if(!a)return;let s=a.plotOutline?.scene_registry||{};s[`chapter_${t}`]={updated_at:new Date().toISOString(),scenes:n.map(o=>({scene_num:o.scene_num,characters:o.characters,setting:o.setting,plot_beat:o.plot_beat,actual_summary:o.actual_summary||null,word_count:o.word_count||0}))},await b.updateWorldBible(a.id,{plotOutline:{...a.plotOutline||{},scene_registry:s}}),console.log(`[OrchestratorV2] Saved ${n.length} scene summaries for Chapter ${t}`)}catch(a){console.error("[OrchestratorV2] Failed to save scene summaries:",a)}}async getSceneSummariesContext(e,t){try{let n=await b.getWorldBibleByProject(e);if(!n)return"";let s=n.plotOutline?.scene_registry;if(!s)return"";let o=[];o.push(`
=== ESCENAS ANTERIORES (lo que realmente ocurri\xF3) ===`),o.push(`Mant\xE9n coherencia con estos eventos:
`);let i=Object.keys(s).filter(u=>{let c=parseInt(u.replace("chapter_",""));return c<t&&c>=t-3}).sort((u,c)=>parseInt(u.replace("chapter_",""))-parseInt(c.replace("chapter_","")));for(let u of i){let c=s[u],p=u.replace("chapter_","");o.push(`Cap ${p}:`);for(let m of c.scenes||[])m.actual_summary&&o.push(`  E${m.scene_num}: ${m.actual_summary}`)}return o.length>3?o.join(`
`):""}catch(n){return console.error("[OrchestratorV2] Failed to get scene summaries:",n),""}}async getRecentChaptersText(e,t,n=2){try{let a=await b.getChaptersByProject(e);return!a||a.length===0?"":a.filter(o=>o.chapterNumber<t&&o.content).sort((o,i)=>i.chapterNumber-o.chapterNumber).slice(0,n).map(o=>(o.content||"").slice(0,5e3)).join(`

`)}catch(a){return console.error("[OrchestratorV2] Failed to get recent chapters text:",a),""}}async getErrorHistoryForWriting(e){try{let t=await b.getConsistencyViolationsByProject(e);if(!t||t.length===0)return"";let n=t.filter(o=>o.status!=="resolved").slice(0,10);if(n.length===0)return"";let a=new Map;for(let o of n){let i=o.violationType||"GENERAL";a.has(i)||a.set(i,[]),a.get(i).push(o.description.substring(0,150))}let s=["\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557","\u2551 \u26A0\uFE0F ERRORES DETECTADOS EN ESTE PROYECTO - EVITAR REPETIR \u26A0\uFE0F       \u2551","\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563"];return Array.from(a.entries()).forEach(([o,i])=>{s.push(`\u2551 ${o}:`),i.slice(0,3).forEach(u=>{s.push(`\u2551   \u2022 ${u}`)})}),s.push("\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563"),s.push("\u2551 NO cometas estos errores. Verifica antes de escribir.            \u2551"),s.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),console.log(`[OrchestratorV2] Generated error history with ${n.length} past errors`),s.join(`
`)}catch(t){return console.error("[OrchestratorV2] Failed to get error history:",t),""}}async getGlobalWritingLessons(){try{let e=await b.getActiveWritingLessons();if(!e||e.length===0)return"";let{WritingLessonsAgent:t}=await Promise.resolve().then(()=>(Oy(),Ty)),n=t.formatLessonsForGhostwriter(e);return console.log(`[OrchestratorV2] Injected ${e.length} global writing lessons`),n}catch(e){return console.error("[OrchestratorV2] Failed to get global writing lessons:",e),""}}async validateAndUpdateConsistency(e,t,n,a,s,o){let i=await this.getConsistencyContext(e);if(i.entities.length===0&&i.rules.length===0)return console.log("[OrchestratorV2] Skipping consistency validation - no context available"),{isValid:!0};this.callbacks.onAgentStatus("universal-consistency","active","Validating continuity...");let u=s?this.extractTimelineInfo(s,t):void 0,c=await co.validateChapter(n,a,i.entities,i.rules,i.relationships,t,u,o);if(!c.isValid&&c.criticalError)return await b.createConsistencyViolation({projectId:e,chapterNumber:t,violationType:"CONTRADICTION",severity:"critical",description:c.criticalError,affectedEntities:[],wasAutoFixed:!1}),this.callbacks.onAgentStatus("universal-consistency","warning",`Violation: ${c.criticalError}`),{isValid:!1,error:c.correctionInstructions?`${c.criticalError}

INSTRUCCIONES DE CORRECCI\xD3N ESPEC\xCDFICAS:
${c.correctionInstructions}`:c.criticalError};if(c.newFacts&&c.newFacts.length>0){for(let p of c.newFacts){let m=await b.getWorldEntityByName(e,p.entityName),f={...p.update};if(p.entityType==="PHYSICAL_TRAIT"||p.entityType==="CHARACTER"){let g=["ojos","eyes","pelo","hair","cabello","altura","height","edad","age","piel","skin","cicatriz","scar","tatuaje","tattoo","barba","beard","complexion","build"];for(let[y,C]of Object.entries(p.update))g.some(T=>y.toLowerCase().includes(T))&&!y.endsWith("_INMUTABLE")&&(f[`${y}_INMUTABLE`]=C,delete f[y],await b.createWorldRule({projectId:e,ruleDescription:`${p.entityName} tiene ${y} = "${C}" (DESCUBIERTO en Cap ${t} - INMUTABLE)`,category:"PHYSICAL_ATTRIBUTE",isActive:!0,sourceChapter:t}),console.log(`[OrchestratorV2] Registered physical trait: ${p.entityName}.${y} = ${C}`))}if(m){let g={...m.attributes||{},...f};await b.updateWorldEntity(m.id,{attributes:g,lastSeenChapter:t})}else await b.createWorldEntity({projectId:e,name:p.entityName,type:p.entityType==="PHYSICAL_TRAIT"?"CHARACTER":p.entityType||"CHARACTER",attributes:f,status:"active",lastSeenChapter:t})}console.log(`[OrchestratorV2] Updated ${c.newFacts.length} facts in consistency DB`)}if(c.newRules&&c.newRules.length>0){for(let p of c.newRules)await b.createWorldRule({projectId:e,ruleDescription:p.ruleDescription,category:p.category,isActive:!0,sourceChapter:t});console.log(`[OrchestratorV2] Added ${c.newRules.length} new rules`)}if(c.newRelationships&&c.newRelationships.length>0){let p=await b.getWorldEntitiesByProject(e),m=new Map(p.map(f=>[f.name.toLowerCase(),f.id]));for(let f of c.newRelationships){let g=m.get(f.subject.toLowerCase()),y=m.get(f.target.toLowerCase());g&&y&&await b.createEntityRelationship({projectId:e,subjectId:g,targetId:y,relationType:f.relationType,meta:{...f.meta||{},sourceChapter:t}})}console.log(`[OrchestratorV2] Added ${c.newRelationships.length} new relationships`)}if(c.warnings&&c.warnings.length>0){let p=c.warnings.join("; ");for(let m of c.warnings)await b.createConsistencyViolation({projectId:e,chapterNumber:t,violationType:"WARNING",severity:"major",description:m,affectedEntities:[],wasAutoFixed:!1});return this.callbacks.onAgentStatus("universal-consistency","warning",`${c.warnings.length} issues detected - forcing rewrite`),{isValid:!1,error:p}}return this.callbacks.onAgentStatus("universal-consistency","completed","Continuity validated"),{isValid:!0}}generateTitleFromHook(e){if(!e||e.length<3)return"";let t=e.trim();if(t=t.replace(/^(el |la |los |las |un |una |unos |unas )/i,""),t=t.charAt(0).toUpperCase()+t.slice(1),t.length>50){let n=t.lastIndexOf(" ",50);t=t.slice(0,n>20?n:50)+"..."}return t=t.replace(/[.,;:!?]+$/,""),t||"Sin t\xEDtulo"}generateTitleFromSummary(e){if(!e||e.length<5)return"";let t=e.match(/'([^']{3,30})'/);if(t)return t[1];let n=e.split(/[.!?]/)[0]?.trim()||"";if(!n||n.length<5)return"";let a=[/el (hallazgo|descubrimiento|misterio|secreto|cadver|cuerpo|testigo|sospechoso|rastro|encuentro|interrogatorio|enfrentamiento|conflicto|amanecer|anochecer|regreso|viaje)/i,/la (huida|bsqueda|revelacin|traicin|verdad|mentira|pista|sombra|luz|noche|tormenta|calma|confesin|escena|evidencia)/i,/las? (sombras?|huellas?|seales?|marcas?|aguas?)/i,/los? (secretos?|indicios?|restos?)/i];for(let i of a){let u=n.match(i);if(u)return u[0].charAt(0).toUpperCase()+u[0].slice(1)}let o=n.split(/\s+/).slice(0,5).join(" ");if(o.length>35){let i=o.lastIndexOf(" ",35);o=o.slice(0,i>10?i:35)}return o=o.replace(/\s+(el|la|los|las|un|una|de|del|en|a|y|con|por|para)$/i,""),o=o.replace(/[.,;:!?]+$/,""),o.length>0&&(o=o.charAt(0).toUpperCase()+o.slice(1)),o.length>5?o:""}async syncChapterHeaders(e,t){let n=await b.getChaptersByProject(e);if(n.length===0)return;console.log(`[OrchestratorV2] Syncing chapter headers for ${n.length} existing chapters...`);let a=[/^#\s*(Captulo|Capitulo|CAPTULO|CAPITULO)\s+(\d+)\s*[:|-]?\s*([^\n]*)/im,/^(Captulo|Capitulo|CAPTULO|CAPITULO)\s+(\d+)\s*[:|-]?\s*([^\n]*)/im,/^#\s*(Prlogo|Prologo|PRLOGO|PROLOGO)\s*[:|-]?\s*([^\n]*)/im,/^#\s*(Eplogo|Epilogo|EPLOGO|EPILOGO)\s*[:|-]?\s*([^\n]*)/im];for(let s of n){if(!s.content)continue;let o=t.find(A=>A.chapter_num===s.chapterNumber),i="",u=!1;for(let A of a){let T=s.content.match(A);if(T){u=!0;let E=T[T.length-1]?.trim()||"";E&&!E.match(/^(Prlogo|Eplogo|Captulo \d+)$/i)&&(i=E);break}}let c="",p=A=>!(!A||A.length>60||A.match(/^Captulo \d+$/i));s.title&&p(s.title)?c=s.title:i&&p(i)?c=i:o?.title&&p(o.title)?c=o.title:s.summary&&(c=this.generateTitleFromSummary(s.summary)),c=c.replace(/^(Prlogo|Prologo|Eplogo|Epilogo|Nota del Autor)\s*[:|-]?\s*/i,"").trim(),c=c.replace(/^Captulo\s+\d+\s*[:|-]?\s*/i,"").trim();let m="",f="";s.chapterNumber===0?(m="# Pr\xF3logo",f="Pr\xF3logo",c&&c.toLowerCase()!=="pr\xF3logo"&&(m+=`: ${c}`,f+=`: ${c}`)):s.chapterNumber===998?(m="# Ep\xEDlogo",f="Ep\xEDlogo",c&&c.toLowerCase()!=="ep\xEDlogo"&&(m+=`: ${c}`,f+=`: ${c}`)):s.chapterNumber===999?(m="# Nota del Autor",f="Nota del Autor"):(m=`# Cap\xEDtulo ${s.chapterNumber}`,f=c||`Cap\xEDtulo ${s.chapterNumber}`,c&&!c.match(/^Captulo \d+$/i)&&(m+=`: ${c}`));let g=s.content,y=!1,C=!1;for(let A of a){let T=g.match(A);if(T){let E=T[0];E!==m&&(g=g.replace(A,m),y=!0,console.log(`[OrchestratorV2] Chapter ${s.chapterNumber}: "${E.substring(0,40)}..." -> "${m}"`));break}}if(u||(g=m+`

`+g.trimStart(),y=!0,console.log(`[OrchestratorV2] Chapter ${s.chapterNumber}: Added header "${m}"`)),s.title!==f&&(C=!0,console.log(`[OrchestratorV2] Chapter ${s.chapterNumber}: DB title "${s.title}" -> "${f}"`)),y||C){let A={};y&&(A.content=g),C&&(A.title=f),await b.updateChapter(s.id,A)}}}async generateNovel(e,t){let n=t?.useGeminiQA;this.geminiQAFlags=n;let a=n?` [QA Gemini: ${n.finalReviewer?"FR":""}${n.continuitySentinel?" CS":""}${n.narrativeDirector?" ND":""}]`:"";console.log(`[OrchestratorV2] Starting novel generation for "${e.title}" (ID: ${e.id})${t?.useGeminiArchitect?" [Architect: Gemini]":""}${a}`);try{await b.updateProject(e.id,{status:"generating"}),rI(e.id),console.log(`[OrchestratorV2] Pattern tracker cleared for project ${e.id}`);let s;if(e.extendedGuideId){let I=await b.getExtendedGuide(e.extendedGuideId);I&&(s=I.content,console.log(`[OrchestratorV2] Loaded extended guide: ${I.title} (${I.wordCount} words)`))}let o;if(e.styleGuideId){let I=await b.getStyleGuide(e.styleGuideId);I&&(o=I.content,console.log("[OrchestratorV2] Loaded project style guide"))}else if(e.pseudonymId){let _=(await b.getStyleGuidesByPseudonym(e.pseudonymId)).find(N=>N.isActive);_&&(o=_.content,console.log(`[OrchestratorV2] Loaded pseudonym's active style guide: ${_.title}`))}let i,u;if(e.seriesId){let I=await b.getSeries(e.seriesId);if(I){i=I.title;let _=e.seriesOrder||1;if(console.log(`[OrchestratorV2] Part of series: ${I.title}, Book #${_}`),s&&_>0){let N=this.extractVolumeContextFromGuide(s,_);N&&(console.log(`[OrchestratorV2] Extracted volume ${_} context from series guide (${N.length} chars)`),u=`
=== INFORMACI\xD3N OBLIGATORIA PARA ESTE VOLUMEN (${_}) ===
${N}

DEBES incorporar TODA esta informaci\xF3n del volumen ${_} en la biblia del mundo y la estructura de cap\xEDtulos. Los hitos, la arquitectura y los personajes definidos aqu\xED son OBLIGATORIOS.
`)}if(e.seriesOrder&&e.seriesOrder>1){let P=(await b.getProjectsBySeries(e.seriesId)).filter(L=>L.seriesOrder&&L.seriesOrder<e.seriesOrder&&L.status==="completed").sort((L,j)=>(L.seriesOrder||0)-(j.seriesOrder||0));if(P.length>0){let L=[];for(let $ of P){let U=await b.getWorldBibleByProject($.id);if(U&&U.characters){let V=(Array.isArray(U.characters)?U.characters:[]).slice(0,8).map(Q=>{let te=Q.name||Q.nombre||"Desconocido",F=Q.role||Q.rol||"",ae=Q.appearance||{},D=[`"${te}" (${F})`];return ae.eyes&&D.push(`ojos: ${ae.eyes}`),ae.hair&&D.push(`cabello: ${ae.hair}`),D.join(", ")});L.push(`Libro ${$.seriesOrder}: "${$.title}"
  Personajes INMUTABLES: ${V.join("; ")}`)}}let j=L.join(`
`);u=(u||"")+`

=== LIBROS ANTERIORES DE LA SERIE ===
`+j,console.log(`[OrchestratorV2] Loaded context from ${P.length} previous books`)}}}}let c=await b.getWorldBibleByProject(e.id),p,m,f=await b.getChaptersByProject(e.id);if(f.some(I=>I.content&&I.content.length>100)&&!c?.plotOutline){console.log(`[OrchestratorV2] \u26A0\uFE0F EMERGENCY: Chapters exist (${f.length}) but no plotOutline. Reconstructing from chapters...`),await b.createActivityLog({projectId:e.id,level:"warn",agentRole:"system",message:`\u26A0\uFE0F Reconstruyendo estructura desde ${f.length} cap\xEDtulos existentes (plotOutline faltante)`}),p=f.map(_=>({chapter_num:_.chapterNumber,title:_.title||`Cap\xEDtulo ${_.chapterNumber}`,summary:_.summary||"",key_event:""})).sort((_,N)=>_.chapter_num-N.chapter_num),m={characters:c?.characters||[],rules:c?.worldRules||[]};let I={chapterOutlines:p.map(_=>({number:_.chapter_num,title:_.title,summary:_.summary,keyEvents:_.key_event?[_.key_event]:[]}))};c?(await b.updateWorldBible(c.id,{plotOutline:I}),console.log(`[OrchestratorV2] \u2705 Reconstructed plotOutline persisted to World Bible (${p.length} chapters)`)):(await b.createWorldBible({projectId:e.id,characters:[],worldRules:[],plotOutline:I,timeline:[]}),console.log(`[OrchestratorV2] \u2705 Created new World Bible with reconstructed plotOutline (${p.length} chapters)`)),this.callbacks.onAgentStatus("global-architect","completed","Reconstructed from chapters")}else if(c&&c.plotOutline){console.log("[OrchestratorV2] World Bible exists. Resuming chapter generation."),this.callbacks.onAgentStatus("global-architect","completed","Using existing structure"),m={characters:c.characters||[],rules:c.worldRules||[]};let I=c.plotOutline,_=c.timeline||[],N={};for(let j of _)j.chapter!==void 0&&j.title&&(N[j.chapter]=j.title);let P=(I.chapterOutlines||[]).map(j=>({chapter_num:j.number,title:j.title||N[j.number]||`Cap\xEDtulo ${j.number}`,summary:j.summary||"",key_event:j.keyEvents?.[0]||""})),L=P.length;p=P.map((j,$)=>{let U=j.chapter_num,k=j.title;return e.hasPrologue&&$===0?(U=0,k="Pr\xF3logo"):e.hasAuthorNote&&$===L-1?(U=999,k="Nota del Autor"):e.hasEpilogue&&(e.hasAuthorNote&&$===L-2||!e.hasAuthorNote&&$===L-1)?(U=998,k="Ep\xEDlogo"):e.hasPrologue&&(U=$,j.title&&j.title.match(/^Captulo \d+$/i)&&(k=`Cap\xEDtulo ${U}`)),{...j,chapter_num:U,title:k}}),console.log(`[OrchestratorV2] Loaded ${p.length} chapter outlines. Numbers: ${p.map(j=>j.chapter_num).join(", ")}`),this.callbacks.onAgentStatus("universal-consistency","active","Checking consistency database..."),await this.initializeConsistencyDatabase(e.id,m,e.genre)}else{let _=0,N={isValid:!1,criticalIssues:[],warnings:[]},P=null,L="";for(;_<5&&!N.isValid;){_++,this.callbacks.onAgentStatus("global-architect","active",_===1?"Designing master structure...":`Regenerando estructura (intento ${_}/5)...`);let D=e.architectInstructions||"";if(L&&(D=L+`

`+D),P=await this.globalArchitect.execute({title:e.title,premise:e.premise||"",genre:e.genre,tone:e.tone,chapterCount:e.chapterCount,architectInstructions:D||void 0,extendedGuide:s,styleGuide:o,hasPrologue:e.hasPrologue,hasEpilogue:e.hasEpilogue,hasAuthorNote:e.hasAuthorNote,workType:e.workType||void 0,seriesName:i,seriesOrder:e.seriesOrder||void 0,previousBooksContext:u,minWordsPerChapter:e.minWordsPerChapter||void 0,maxWordsPerChapter:e.maxWordsPerChapter||void 0,isKindleUnlimited:e.kindleUnlimitedOptimized||!1,useGeminiArchitect:t?.useGeminiArchitect}),P.error||!P.parsed)throw new Error(`Global Architect failed: ${P.error||"No parsed output"}`);this.addTokenUsage(P.tokenUsage);let J=t?.useGeminiArchitect?"gemini-3-pro-preview":"deepseek-reasoner";if(await this.logAiUsage(e.id,"global-architect",J,P.tokenUsage),N=this.validatePlotCoherence(P.parsed.outline,P.parsed.plot_threads,P.parsed.world_bible,s),N.isValid)console.log(`[OrchestratorV2] Plot coherence validation PASSED on attempt ${_}`),await b.createActivityLog({projectId:e.id,level:"info",agentRole:"global-architect",message:`\u2705 Estructura narrativa APROBADA${_>1?` despu\xE9s de ${_} intentos`:""}. ${N.warnings.length} advertencias menores registradas.`});else{console.warn(`[OrchestratorV2] Plot coherence validation FAILED (attempt ${_}):`,N.criticalIssues),await b.createActivityLog({projectId:e.id,level:"warn",agentRole:"global-architect",message:`\u26A0\uFE0F VALIDACI\xD3N FALLIDA (intento ${_}/5): Se detectaron ${N.criticalIssues.length} problemas cr\xEDticos y ${N.warnings.length} advertencias.`,metadata:{criticalIssues:N.criticalIssues,warnings:N.warnings}});for(let W of N.criticalIssues)await b.createActivityLog({projectId:e.id,level:"error",agentRole:"global-architect",message:W});if(_<5){let W=P.parsed?.world_bible?.characters?.map(le=>({name:le.name||le.nombre,role:le.role||le.rol}))||[],de=this.extractCharactersFromExtendedGuide(s),ne=P.parsed?.outline?.length||e.chapterCount;L=this.buildPlotCorrectionInstructions(N.criticalIssues,N.warnings,_+1,W,de,ne)}}}if(!N.isValid&&(console.warn("[OrchestratorV2] Plot coherence validation FAILED after 5 attempts. Attempting post-processor fix..."),N.criticalIssues.filter(J=>J.includes("PROTAGONISTA AUSENTE")||J.includes("protagonista")).length>0&&P.parsed?.outline)){let W=(P.parsed.world_bible?.characters||[]).find(de=>(de.role||de.rol||"").toLowerCase().includes("protagonist")||(de.role||de.rol||"").toLowerCase().includes("principal"));if(W){let de=W.name||W.nombre;console.log(`[OrchestratorV2] Auto-injecting protagonist "${de}" into outline...`);let ne=this.injectProtagonistIntoOutline(P.parsed.outline,de);P.parsed.outline=ne;let le=this.validatePlotCoherence(ne,P.parsed.plot_threads,P.parsed.world_bible,s);(le.isValid||le.criticalIssues.filter(oe=>oe.includes("PROTAGONISTA")).length===0)&&(console.log("[OrchestratorV2] Post-processor successfully fixed protagonist presence issue!"),N=le,await b.createActivityLog({projectId:e.id,level:"info",agentRole:"system",message:`\u2705 Post-procesador inyect\xF3 al protagonista "${de}" en cap\xEDtulos cr\xEDticos. Problema resuelto autom\xE1ticamente.`}))}}if(!N.isValid)throw console.error("[OrchestratorV2] Plot coherence validation FAILED after 5 attempts and post-processing. Pausing project."),await b.createActivityLog({projectId:e.id,level:"error",agentRole:"system",message:`\u{1F6D1} PROYECTO PAUSADO: La estructura narrativa no cumple los est\xE1ndares de calidad despu\xE9s de 5 intentos. Problemas pendientes: ${N.criticalIssues.join(" | ")}`,metadata:{criticalIssues:N.criticalIssues,warnings:N.warnings}}),await b.updateProject(e.id,{status:"paused"}),this.callbacks.onAgentStatus("global-architect","error","Estructura narrativa d\xE9bil - proyecto pausado"),new Error(`Plot coherence validation failed after 5 attempts. Project paused for manual review. Issues: ${N.criticalIssues.join("; ")}`);let j=P.subplotWarnings;if(j&&j.length>0&&(console.warn(`[OrchestratorV2] GlobalArchitect detected ${j.length} subplot coherence issue(s)`),await b.createActivityLog({projectId:e.id,level:"warn",message:`\u26A0\uFE0F ADVERTENCIA DE SUBTRAMAS - Se detectaron ${j.length} problema(s) adicionales de coherencia.`,agentRole:"global-architect",metadata:{subplotWarnings:j}})),N.warnings.length>0)for(let D of N.warnings)await b.createActivityLog({projectId:e.id,level:"warn",message:D,agentRole:"global-architect"});P.thoughtSignature&&await this.saveThoughtLog(e.id,"Global Architect","global-architect",P.thoughtSignature),this.callbacks.onAgentStatus("global-architect","completed","Master structure complete"),m=P.parsed.world_bible;let $=m?.characters||m?.personajes;if((e.workType==="series"||e.seriesId)&&s&&$){!m.characters&&m.personajes&&(m.characters=m.personajes),console.log("[OrchestratorV2] \u{1F6E1}\uFE0F Running series character consistency validation...");let D=this.validateSeriesCharacterConsistency(m.characters,s,e.id);if(D.corrections.length>0){for(let ne of D.corrections){let le=m.characters[ne.wbIndex];if(ne.field==="name")console.log(`[OrchestratorV2] \u{1F527} Auto-correcting character name: "${ne.from}" \u2192 "${ne.to}"`),le.name&&(le.name=ne.to),le.nombre&&(le.nombre=ne.to);else if(ne.field==="gender"){console.log(`[OrchestratorV2] \u{1F527} Auto-correcting character gender for "${le.name||le.nombre}": ${ne.from} \u2192 ${ne.to}`),le.gender&&(le.gender=ne.to==="female"?"femenino":"masculino"),le.sexo&&(le.sexo=ne.to==="female"?"femenino":"masculino"),le.sex&&(le.sex=ne.to);let oe=le.profile||le.description||"";if(ne.to==="female"){let ce=oe.replace(/\bhroe\b/gi,"hero\xEDna").replace(/\binspector\b(?!\w)/gi,"inspectora").replace(/\bdetective masculino\b/gi,"detective femenina").replace(/\bdoctor\b(?!\w)/gi,"doctora").replace(/\bprofesor\b(?!\w)/gi,"profesora").replace(/\bcomisario\b/gi,"comisaria");le.profile&&(le.profile=ce),le.description&&(le.description=ce)}else if(ne.to==="male"){let ce=oe.replace(/\bherona\b/gi,"h\xE9roe").replace(/\binspectora\b/gi,"inspector").replace(/\bdetective femenin[ao]\b/gi,"detective masculino").replace(/\bdoctora\b/gi,"doctor").replace(/\bprofesora\b/gi,"profesor").replace(/\bcomisaria\b/gi,"comisario");le.profile&&(le.profile=ce),le.description&&(le.description=ce)}}}P.parsed.world_bible=m;let J=D.corrections.filter(ne=>ne.field==="name"),W=D.corrections.filter(ne=>ne.field==="gender"),de=[];J.length>0&&de.push(`${J.length} nombre(s): ${J.map(ne=>`"${ne.from}" \u2192 "${ne.to}"`).join(", ")}`),W.length>0&&de.push(`${W.length} g\xE9nero(s) corregido(s)`),await b.createActivityLog({projectId:e.id,level:"warn",agentRole:"system",message:`\u{1F6E1}\uFE0F PROTECCI\xD3N DE SERIE: Se corrigieron ${D.corrections.length} inconsistencia(s) de personaje: ${de.join("; ")}`})}if(D.warnings.length>0)for(let J of D.warnings)console.log(`[OrchestratorV2] ${J}`),await b.createActivityLog({projectId:e.id,level:"warn",agentRole:"system",message:J});D.corrections.length===0&&D.warnings.length===0&&console.log("[OrchestratorV2] \u2705 Series character consistency validation PASSED")}let U=P.parsed.outline,k=P.parsed.plot_threads;p=U.map((D,J)=>{let W=D.chapter_num,de=U.length,ne=D.title;return e.hasPrologue&&J===0?(W=0,ne="Pr\xF3logo"):e.hasAuthorNote&&J===de-1?(W=999,ne="Nota del Autor"):e.hasEpilogue&&(e.hasAuthorNote&&J===de-2||!e.hasAuthorNote&&J===de-1)?(W=998,ne="Ep\xEDlogo"):e.hasPrologue&&(W=J,D.title.match(/^Captulo \d+$/i)&&(ne=`Cap\xEDtulo ${W}`)),{...D,chapter_num:W,title:ne}});let V=p.filter(D=>D.chapter_num>0&&D.chapter_num<900).length;if(V>e.chapterCount){let D=e.chapterCount,J=D+Math.ceil(D*.3),W=Math.min(V,J);if(console.log(`[OrchestratorV2] \u{1F4CA} Architect expanded chapter count: ${D} \u2192 ${W} (architect proposed ${V}, max allowed ${J})`),V>J){console.warn(`[OrchestratorV2] \u26A0\uFE0F Architect exceeded 30% cap (${V} > ${J}). Trimming and renumbering...`);let de=p.filter(ce=>ce.chapter_num===0),ne=p.filter(ce=>ce.chapter_num>0&&ce.chapter_num<900),le=p.filter(ce=>ce.chapter_num>=900),oe=ne.slice(0,J);oe.forEach((ce,se)=>{ce.chapter_num=se+1}),p=[...de,...oe,...le]}await b.updateProject(e.id,{chapterCount:W}),e={...e,chapterCount:W},await b.createActivityLog({projectId:e.id,level:"info",agentRole:"global-architect",message:`\u{1F4CA} El Arquitecto expandi\xF3 la estructura de ${D} a ${W} cap\xEDtulos regulares para desarrollar mejor los arcos narrativos.${V>J?` (Propuso ${V}, limitado al 30% m\xE1ximo: ${J})`:""}`}),this.callbacks.onAgentStatus("global-architect","active",`Expanded to ${W} chapters (from ${D} minimum)`)}let Q=p.map(D=>({chapter:D.chapter_num,title:D.title,events:[D.key_event],summary:D.summary,act:D.act||(D.chapter_num<=Math.ceil(p.length*.25)?1:D.chapter_num<=Math.ceil(p.length*.75)?2:3)}));await b.createWorldBible({projectId:e.id,characters:m.characters,worldRules:m.rules,timeline:Q,plotOutline:{chapterOutlines:p.map(D=>({number:D.chapter_num,title:D.title,summary:D.summary,keyEvents:[D.key_event],emotional_arc:D.emotional_arc,temporal_notes:D.temporal_notes||"",location:D.location||"",character_states_entering:D.character_states_entering||{}})),threeActStructure:P.parsed.three_act_structure||null,plotThreads:k.map(D=>({name:D.name,description:D.description,goal:D.goal})),settings:m.settings||[],themes:m.themes||[],location_map:m.location_map||null,timeline_master:P.parsed.timeline_master||null,character_tracking:P.parsed.character_tracking||[]}});for(let D of k)await b.createProjectPlotThread({projectId:e.id,name:D.name,description:D.description||null,goal:D.goal,status:"active",intensityScore:5,lastUpdatedChapter:0});this.callbacks.onAgentStatus("universal-consistency","active","Initializing consistency database..."),await this.initializeConsistencyDatabase(e.id,m,e.genre);let te=3,F=0,ae=await this.validateWorldBibleWithGemini(e.id,m,p,k);for(;!ae.isValid&&F<te;){if(F++,console.log(`[OrchestratorV2] Bible validation FAILED (attempt ${F}/${te}). Applying corrections...`),ae.correctedBible){if(ae.correctedBible._outlineFixes&&Array.isArray(ae.correctedBible._outlineFixes)){for(let J of ae.correctedBible._outlineFixes){let W=p.findIndex(de=>de.chapter_num===J.chapter_num);W>=0&&J.corrected_summary&&(p[W].summary=J.corrected_summary,console.log(`[OrchestratorV2] Outline fix applied: Chapter ${J.chapter_num}`))}try{let J=await b.getWorldBibleByProject(e.id);if(J){let W=J.plotOutline||{};if(W.chapters_outline&&Array.isArray(W.chapters_outline)){for(let de of ae.correctedBible._outlineFixes){let ne=W.chapters_outline.findIndex(le=>le.chapter_num===de.chapter_num);ne>=0&&de.corrected_summary&&(W.chapters_outline[ne].summary=de.corrected_summary)}await b.updateWorldBible(J.id,{plotOutline:W}),console.log("[OrchestratorV2] Outline fixes persisted to stored World Bible")}}}catch(J){console.error("[OrchestratorV2] Failed to persist outline fixes:",J)}delete ae.correctedBible._outlineFixes}m=ae.correctedBible;let D=await b.getWorldBibleByProject(e.id);if(D){let J={};ae.correctedBible.characters&&(J.characters=ae.correctedBible.characters),ae.correctedBible.rules&&(J.worldRules=ae.correctedBible.rules),await b.updateWorldBible(D.id,J),console.log("[OrchestratorV2] World Bible updated with corrections from validation")}await b.createActivityLog({projectId:e.id,level:"info",agentRole:"bible-validator",message:`Biblia del Mundo corregida (intento ${F}). Re-validando...`})}ae=await this.validateWorldBibleWithGemini(e.id,m,p,k)}ae.isValid?(console.log(`[OrchestratorV2] Bible validation PASSED${F>0?` after ${F} correction(s)`:""}`),await b.createActivityLog({projectId:e.id,level:"success",agentRole:"bible-validator",message:`Biblia del Mundo validada${F>0?` despu\xE9s de ${F} correccione(s)`:""}. Lista para escribir.`})):(console.warn(`[OrchestratorV2] Bible validation has remaining issues after ${te} attempts. Proceeding with best effort.`),await b.createActivityLog({projectId:e.id,level:"warn",agentRole:"bible-validator",message:`Biblia del Mundo con ${ae.issues.length} advertencias menores pendientes. Continuando con la mejor versi\xF3n disponible.`}))}let y="";if(e.styleGuideId){let I=await b.getStyleGuide(e.styleGuideId);I&&I.content&&(y=await this.analyzeAndSaveStyleGuide(e.id,I.content),y.length<100&&I.content.length>100&&(y=I.content.substring(0,3e3)),console.log(`[OrchestratorV2] Style guide loaded: ${y.length} chars (analyzed from ${I.content.length} original)`))}let C="Inicio de la novela.",A=[],T=[],E=0,d=new Set;try{let _=(await b.getActivityLogsByProject(e.id)).filter(N=>N.agentRole==="structural-checkpoint");for(let N of _){let P=N.metadata;if(P?.type==="checkpoint_executed"&&typeof P.rangeEnd=="number")P.rangeEnd>E&&(E=P.rangeEnd);else if(P?.type==="chapter_rewritten"&&typeof P.chapterNumber=="number")d.add(P.chapterNumber);else if(!P?.type){if(N.message.includes("Ejecutando checkpoint estructural")){let L=N.message.match(/captulo[s]?\s+\d+-(\d+)/i);if(L){let j=parseInt(L[1]);j>E&&(E=j)}}if(N.level==="success"&&N.message.includes("reescrito")){let L=N.message.match(/Captulo (\d+) reescrito/);L&&d.add(parseInt(L[1]))}}}(E>0||d.size>0)&&console.log(`[OrchestratorV2] Resumed checkpoint state: last checkpoint at Ch ${E}, ${d.size} chapters already corrected`)}catch(I){console.error("[OrchestratorV2] Failed to backfill checkpoint state:",I)}let l=await b.getChaptersByProject(e.id),h=500,v=150,S=I=>I===0||I===-1||I===998||I===-2||I===999,R=l.filter(I=>{if(I.status!=="completed"&&I.status!=="approved")return!1;let _=I.content?I.content.split(/\s+/).length:0,N=S(I.chapterNumber)?v:h;return _<N});if(R.length>0){console.log(`[OrchestratorV2] [CRITICAL] Found ${R.length} truncated chapters - will regenerate them`),this.callbacks.onAgentStatus("orchestrator","active",`Detectados ${R.length} capitulos truncados - regenerando...`);for(let I of R)await b.updateChapter(I.id,{status:"draft"}),console.log(`[OrchestratorV2] Marked Chapter ${I.chapterNumber} as draft (was truncated: ${I.content?.split(/\s+/).length||0} words)`)}let x=await b.getChaptersByProject(e.id),w=new Set(x.filter(I=>{if(I.status!=="completed"&&I.status!=="approved")return!1;let _=I.content?.split(/\s+/).length||0,N=S(I.chapterNumber)?v:h;return _>=N}).map(I=>I.chapterNumber));if(w.size>0){console.log(`[OrchestratorV2] Found ${w.size} completed chapters. Resuming from where we left off.`),(e.hasPrologue||e.hasEpilogue||e.hasAuthorNote)&&await this.syncChapterHeaders(e.id,p);for(let I of x.filter(_=>w.has(_.chapterNumber)).sort((_,N)=>_.chapterNumber-N.chapterNumber))if(I.summary&&A.push(I.summary),I.content){let _=this.extractNarrativeTimeFromChapter(I.content,I.chapterNumber,m);_&&T.push(_)}if(T.length>0&&console.log(`[OrchestratorV2] Backfilled narrative timeline from ${T.length} existing chapters`),A.length>0){let I=A.slice(-3),N=x.filter(P=>w.has(P.chapterNumber)).sort((P,L)=>P.chapterNumber-L.chapterNumber).slice(-3).map(P=>P.chapterNumber);C=I.map((P,L)=>`Cap ${N[L]||"?"}: ${P}`).join(`
`),console.log(`[OrchestratorV2] Rebuilt rollingSummary from last ${I.length} chapters`)}}let O=await this.getSeriesWorldBibleForInjection(e.id);O&&console.log("[OrchestratorV2] Series World Bible loaded - will inject into Ghostwriter for series continuity"),console.log(`[OrchestratorV2] [OmniWriter] Starting Zero-Touch production loop for ${p.length} chapters`);for(let I=0;I<p.length;I++){if(await this.shouldStopProcessing(e.id)){console.log(`[OrchestratorV2] Project ${e.id} stopped (cancelled or superseded)`);return}let _=p[I],N=_.chapter_num;if(w.has(N)){console.log(`[OrchestratorV2] Skipping Chapter ${N} (already completed)`);continue}console.log(`[OrchestratorV2] [OmniWriter] Generating Chapter ${N}: "${_.title}"`);let P="";try{let Se=await this.getConsistencyContext(e.id);if(Se.entities.length>0){let ye=this.extractTimelineInfo(m,N,I>0?p[I-1]?.chapter_num:void 0),be=this.extractCharacterStates(m,N);P=co.generateConstraints(e.genre,Se.entities,Se.rules,Se.relationships,N,ye,be)}let Tt=await b.getWorldBibleByProject(e.id);if(Tt){let ye=this.formatDecisionsAndInjuriesAsConstraints(Tt.plotDecisions,Tt.persistentInjuries,N);ye&&(P+=ye)}let ue=await this.buildEnrichedContextOptions(e),Pe=await this.buildEnrichedWritingContext(e.id,N,m,ue);Pe&&(P+=Pe);let qt=await this.buildPlotThreadsContext(e.id,N,p);qt&&(P+=qt)}catch(Se){console.error("[OrchestratorV2] Failed to generate constraints:",Se)}this.callbacks.onAgentStatus("chapter-architect","active",`Planning scenes for Chapter ${N}...`);let L=I>0?A[I-1]:"",j=C,$=await this.getChapterDecisionContext(e.id,N),U=P+$,k=$c(e.id),V=k.analyzeForChapter(N),Q=k.formatForPrompt(V),te=await this.chapterArchitect.execute({chapterOutline:_,worldBible:m,previousChapterSummary:L,storyState:j,consistencyConstraints:U,fullPlotOutline:p,isKindleUnlimited:e.kindleUnlimitedOptimized||!1,patternAnalysisContext:Q});if(te.error||!te.parsed)throw new Error(`Chapter Architect failed for Chapter ${N}: ${te.error||"No parsed output"}`);this.addTokenUsage(te.tokenUsage),await this.logAiUsage(e.id,"chapter-architect","deepseek-reasoner",te.tokenUsage,N),te.thoughtSignature&&await this.saveThoughtLog(e.id,"Chapter Architect","chapter-architect",`[Cap\xEDtulo ${N}] ${te.thoughtSignature}`),this.callbacks.onAgentStatus("chapter-architect","completed",`${te.parsed.scenes.length} scenes planned`);let F=te.parsed,ae=k.extractPatternFromScenes(N,_.title,F.scenes.map(Se=>({plot_beat:Se.plot_beat,emotional_beat:Se.emotional_beat,ending_hook:Se.ending_hook})),F.chapter_hook);k.registerPattern(ae),console.log(`[OrchestratorV2] Registered pattern for Chapter ${N}: ${ae.sceneSequence.join(" \u2192 ")}`);let D="",J="";if(N>1){let Tt=(await b.getChaptersByProject(e.id)).find(ue=>ue.chapterNumber===N-1);Tt?.content&&(J=`[FINAL DEL CAP\xCDTULO ${N-1}]
${Tt.content.slice(-1200)}`)}let W=await this.getRecentChaptersText(e.id,N,2),de=await this.getErrorHistoryForWriting(e.id),ne=await this.getGlobalWritingLessons(),le=await this.getAccumulatedLessons(e.id),oe=[ne,de,le].filter(Boolean).join(`

`);if(T.length>0){let Se=`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`;Se+=`L\xCDNEA TEMPORAL ACUMULADA (OBLIGATORIO RESPETAR)
`,Se+=`\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`,T.forEach(Tt=>{Se+=`  Cap ${Tt.chapter}: ${Tt.narrativeTime}${Tt.location?` \u2192 ${Tt.location}`:""}
`}),Se+=`
Este cap\xEDtulo (${N}) DEBE continuar cronol\xF3gicamente.
`,Se+=`\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`,U=Se+U}for(let Se of F.scenes){if(await this.shouldStopProcessing(e.id))return;this.callbacks.onAgentStatus("ghostwriter-v2","active",`Writing Scene ${Se.scene_num}...`);let Tt="";if(Se.characters&&Array.isArray(Se.characters)&&Se.characters.length>0&&m.characters){let ye=m.characters.map(ie=>(ie.name||ie||"").toString().toLowerCase()),Ue=Se.characters.map(ie=>typeof ie=="string"?ie.toLowerCase():(ie.name||"").toString().toLowerCase()).filter(ie=>ie.length>0).filter(ie=>!ye.includes(ie));Ue.length>0&&(Tt=`\u26A0\uFE0F PERSONAJES NO REGISTRADOS: ${Ue.join(", ")}. Debes establecerlos apropiadamente o usar personajes conocidos.
`,console.log(`[OrchestratorV2] Pre-scene validation: Unknown characters detected: ${Ue.join(", ")}`))}let ue=await this.ghostwriter.execute({scenePlan:Se,prevSceneContext:J,rollingSummary:C,worldBible:m,guiaEstilo:y,consistencyConstraints:Tt+U,previousChaptersText:W,currentChapterText:D,seriesWorldBible:O,errorHistory:oe,chapterOutline:_});if(ue.error){console.error(`[OrchestratorV2] Scene ${Se.scene_num} failed:`,ue.error);continue}this.addTokenUsage(ue.tokenUsage),await this.logAiUsage(e.id,"ghostwriter-v2","deepseek-chat",ue.tokenUsage,N),(Se.scene_num===1||Se.scene_num===F.scenes.length)&&ue.thoughtSignature&&await this.saveThoughtLog(e.id,"Ghostwriter V2","ghostwriter-v2",`[Cap ${N}, Escena ${Se.scene_num}] ${ue.thoughtSignature}`),D+=`

`+ue.content,J=ue.content.slice(-1500);let Pe=ue.content.split(/\s+/).length,qt=this.extractSceneSummary(ue.content,Se);Se.actual_summary=qt,Se.word_count=Pe,this.callbacks.onSceneComplete(N,Se.scene_num,F.scenes.length,Pe)}await this.saveSceneSummaries(e.id,N,F.scenes),this.callbacks.onAgentStatus("ghostwriter-v2","completed","All scenes written");let ce=D,se=null,Y=3,Ie=0,Je=!1,xe=D,xt=1/0;for(;!Je&&Ie<Y;){Ie++,console.log(`[OmniWriter] Cross-audit attempt ${Ie}/${Y} for Chapter ${N}`),this.callbacks.onAgentStatus("inquisidor","active",`Auditing lore (attempt ${Ie})...`),this.callbacks.onAgentStatus("estilista","active",`Copy-editing (attempt ${Ie})...`),this.callbacks.onAgentStatus("ritmo","active",`Evaluating tension (attempt ${Ie})...`);let Se=A.length>0?A.map((ge,ee)=>`Cap ${ee+1}: ${ge}`).join(`
`):"Este es el primer cap\xEDtulo.",Tt=I>0?(await b.getChaptersByProject(e.id)).find(ge=>ge.chapterNumber===p[I-1]?.chapter_num)?.content?.slice(-500):void 0,[ue,Pe,qt]=await Promise.all([this.inquisidor.execute({chapterContent:ce,chapterNumber:N,worldBible:m,previousChaptersContext:Se,escaleta:_}),this.estilista.execute({chapterContent:ce,chapterNumber:N,styleGuide:y}),this.ritmo.execute({chapterContent:ce,chapterNumber:N,totalChapters:p.length,escaletaEntry:_,previousChapterEnding:Tt})]);this.addTokenUsage(ue.tokenUsage),this.addTokenUsage(Pe.tokenUsage),this.addTokenUsage(qt.tokenUsage),await this.logAiUsage(e.id,"inquisidor","deepseek-reasoner",ue.tokenUsage,N),await this.logAiUsage(e.id,"estilista","gemini-2.5-flash",Pe.tokenUsage,N),await this.logAiUsage(e.id,"ritmo","gemini-2.5-flash",qt.tokenUsage,N);let ye=ue.parsed?.errores||[],be=Pe.parsed?.errores||[],Ue=qt.parsed?.problemas||[],ie=ye.length+be.length+Ue.length,ze=ue.parsed?.veredicto==="aprobado",He=Pe.parsed?.veredicto==="aprobado",ve=qt.parsed?.veredicto==="aprobado";if(this.callbacks.onAgentStatus("inquisidor",ze?"completed":"warning",ze?"Lore verified":`${ye.length} issues found`),this.callbacks.onAgentStatus("estilista",He?"completed":"warning",He?`Style ${Pe.parsed?.puntuacion_estilo}/10`:`${be.length} style issues`),this.callbacks.onAgentStatus("ritmo",ve?"completed":"warning",ve?`Tension ${qt.parsed?.tension_nivel}/10`:`${Ue.length} rhythm issues`),ie<xt&&(xt=ie,xe=ce),Je=ze&&He&&ve,Je){console.log(`[OmniWriter] Chapter ${N} APPROVED by all auditors on attempt ${Ie}`),await b.createActivityLog({projectId:e.id,level:"success",agentRole:"omniwriter",message:`Cap ${N}: Aprobado por Inquisidor, Estilista y Ritmo (intento ${Ie})`});break}if(Ie<Y){this.callbacks.onAgentStatus("smart-editor","active",`Correcting ${ie} issues (attempt ${Ie})...`);let ge=`CORRECCIONES OBLIGATORIAS DETECTADAS POR EL SISTEMA DE AUDITOR\xCDA TRIPLE:

`;if(ye.length>0){ge+=`=== ERRORES DE LORE Y COHERENCIA (Inquisidor) ===
`;for(let Le of ye)ge+=`- [${Le.severidad}] ${Le.tipo}: ${Le.descripcion}
  Ubicaci\xF3n: ${Le.ubicacion}
  Correcci\xF3n: ${Le.correccion_exacta}

`}if(be.length>0){ge+=`=== ERRORES ESTIL\xCDSTICOS (Estilista) ===
`;for(let Le of be)ge+=`- [${Le.severidad}] ${Le.tipo}: "${Le.fragmento_original}" \u2192 "${Le.correccion}"
  Raz\xF3n: ${Le.explicacion}

`}if(Ue.length>0){ge+=`=== PROBLEMAS DE RITMO (Agente de Ritmo) ===
`;for(let Le of Ue)ge+=`- ${Le.tipo}: ${Le.descripcion}
  Sugerencia: ${Le.sugerencia}

`}let ee=await this.smartEditor.fullRewrite({chapterContent:ce,errorDescription:ge,worldBible:{characters:m.characters||[],locations:[],worldRules:m.rules||[],persistentInjuries:[],plotDecisions:[]},styleGuide:y,chapterNumber:N,chapterTitle:_.title});if(this.addTokenUsage(ee.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",ee.tokenUsage,N),ee.rewrittenContent&&ee.rewrittenContent.length>200){let Le=ce;ce=ee.rewrittenContent,W2(Le,ce)?(console.log(`[OmniWriter] Chapter ${N}: Converged (< 1% change). Accepting current version.`),Je=!0):console.log(`[OmniWriter] Chapter ${N}: Corrections applied, re-auditing...`),this.callbacks.onAgentStatus("smart-editor","completed",`Corrections applied (attempt ${Ie})`)}else console.warn(`[OmniWriter] Chapter ${N}: Correction returned empty content`),this.callbacks.onAgentStatus("smart-editor","warning","Correction failed - keeping current version")}}Je||(ce=xe,console.log(`[OmniWriter] Chapter ${N}: Max attempts reached. Using best version (${xt} errors remaining).`),await b.createActivityLog({projectId:e.id,level:"warn",agentRole:"omniwriter",message:`Cap ${N}: Revisi\xF3n autom\xE1tica realizada - ${xt} errores menores pendientes tras ${Y} intentos.`})),await this.validateAndUpdateConsistency(e.id,N,ce,e.genre,m,T),this.callbacks.onAgentStatus("summarizer","active","Compressing for memory...");let Sr=await this.summarizer.execute({chapterContent:ce,chapterNumber:N});this.addTokenUsage(Sr.tokenUsage),await this.logAiUsage(e.id,"summarizer","deepseek-chat",Sr.tokenUsage,N);let Re=Sr.content||`Chapter ${N} completed.`;A.push(Re);let ct=A.slice(-3);C=ct.map((Se,Tt)=>`Cap ${N-(ct.length-1-Tt)}: ${Se}`).join(`
`),this.callbacks.onAgentStatus("summarizer","completed","Chapter compressed");let rt=ce.split(/\s+/).length,ht=(await b.getChaptersByProject(e.id)).find(Se=>Se.chapterNumber===N);ht?await b.updateChapter(ht.id,{title:_.title,content:ce,wordCount:rt,status:"approved",sceneBreakdown:F,summary:Re,editorFeedback:se,qualityScore:null}):await b.createChapter({projectId:e.id,chapterNumber:N,title:_.title,content:ce,wordCount:rt,status:"approved",sceneBreakdown:F,summary:Re,editorFeedback:se,qualityScore:null}),await b.updateProject(e.id,{currentChapter:N}),this.callbacks.onChapterComplete(N,rt,_.title);try{let Se=this.extractNarrativeTimeFromChapter(ce,N,m);Se&&(T.push(Se),console.log(`[OrchestratorV2] Timeline updated: Cap ${N} = ${Se.narrativeTime}${Se.location?` in ${Se.location}`:""}`))}catch(Se){console.error(`[OrchestratorV2] Error extracting timeline from Chapter ${N}:`,Se)}try{let Se=await b.getWorldBibleByProject(e.id),Tt=Se?.characters||Se?.personajes||[];await this.extractInjuriesFromChapter(e.id,N,ce,Tt)}catch(Se){console.error(`[OrchestratorV2] Error extracting injuries from Chapter ${N}:`,Se)}if(N>0&&N<998&&N%5===0){console.log(`[OmniWriter] Running Structural Checkpoint at Chapter ${N}`);let Se=await this.runStructuralCheckpoint(e.id,N,m,p,T,E,d);if(E=N,Se.deviatedChapters.length>0){let Tt=Se.deviatedChapters.slice(0,3);for(let ue of Tt){if(await this.shouldStopProcessing(e.id))break;let Pe=Se.issues.find(qt=>qt.includes(`Cap ${ue}`))||`Cap\xEDtulo ${ue} se desvi\xF3 del plan original`;await this.rewriteDeviatedChapter(e.id,ue,m,p,Pe),d.add(ue)}}}await this.updateProjectTokens(e.id)}if(e.seriesId&&await this.runSeriesThreadFixer(e),await this.shouldStopProcessing(e.id)===!1){console.log("[OmniWriter] Phase 3: Running Ensamblador for final manuscript assembly..."),this.callbacks.onAgentStatus("ensamblador","active","Unifying voice across full manuscript...");try{let _=(await b.getChaptersByProject(e.id)).filter(L=>L.content&&L.content.length>0).sort((L,j)=>L.chapterNumber-j.chapterNumber),N=_.map(L=>L.content).join(`

---

`),P=await this.ensamblador.execute({fullManuscript:N,totalChapters:_.length,worldBible:m,styleGuide:y});if(this.addTokenUsage(P.tokenUsage),await this.logAiUsage(e.id,"ensamblador","gemini-2.5-flash",P.tokenUsage),P.parsed){let L=P.parsed,j=(L.inconsistencias_voz?.length||0)+(L.inconsistencias_personaje?.length||0);if(j>0&&L.capitulos_afectados?.length>0){console.log(`[OmniWriter] Ensamblador found ${j} issues in ${L.capitulos_afectados.length} chapters`);for(let $ of L.capitulos_afectados.slice(0,5)){let U=_.find(Q=>Q.chapterNumber===$);if(!U)continue;let k=`CORRECCIONES DE ENSAMBLAJE FINAL (Cap\xEDtulo ${$}):

`;for(let Q of L.inconsistencias_voz||[])Q.capitulo===$&&(k+=`- VOZ: ${Q.descripcion}
  Correcci\xF3n: ${Q.correccion}
`);for(let Q of L.inconsistencias_personaje||[])Q.capitulo===$&&(k+=`- PERSONAJE (${Q.personaje}): ${Q.descripcion}
  Correcci\xF3n: ${Q.correccion}
`);let V=await this.smartEditor.fullRewrite({chapterContent:U.content||"",errorDescription:k,worldBible:{characters:m.characters||[],locations:[],worldRules:m.rules||[],persistentInjuries:[],plotDecisions:[]},styleGuide:y,chapterNumber:$,chapterTitle:U.title||""});this.addTokenUsage(V.tokenUsage),V.rewrittenContent&&V.rewrittenContent.length>200&&(await b.updateChapter(U.id,{content:V.rewrittenContent,wordCount:V.rewrittenContent.split(/\s+/).length}),console.log(`[OmniWriter] Ensamblador: Chapter ${$} unified`))}this.callbacks.onAgentStatus("ensamblador","completed",`${j} issues fixed in ${L.capitulos_afectados.length} chapters`)}else console.log("[OmniWriter] Ensamblador: Manuscript voice is consistent"),this.callbacks.onAgentStatus("ensamblador","completed",`Voice unified - Score: ${L.puntuacion_coherencia}/10`);await b.createActivityLog({projectId:e.id,level:"success",agentRole:"ensamblador",message:`Ensamblaje final: coherencia ${L.puntuacion_coherencia}/10, ${j} correcciones aplicadas`})}else this.callbacks.onAgentStatus("ensamblador","completed","Assembly complete")}catch(I){console.error("[OmniWriter] Ensamblador error:",I),this.callbacks.onAgentStatus("ensamblador","warning","Assembly skipped (non-fatal)")}}if(await this.shouldStopProcessing(e.id)===!1){console.log("[OrchestratorV2] Running full-novel structural review..."),this.callbacks.onAgentStatus("structural-checkpoint","active","Revisi\xF3n estructural completa de toda la novela...");try{let I=await this.runFinalStructuralReview(e.id,m,p,T,d,A);I.rewrittenCount>0&&console.log(`[OrchestratorV2] Final structural review: ${I.rewrittenCount} chapters corrected`),this.callbacks.onAgentStatus("structural-checkpoint","completed",I.rewrittenCount>0?`Revisi\xF3n final: ${I.rewrittenCount} cap\xEDtulos corregidos`:"Revisi\xF3n final: estructura correcta")}catch(I){if(console.error("[OrchestratorV2] Final structural review error:",I),!dI){await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",agentRole:"structural-checkpoint",message:"Revisi\xF3n estructural final no pudo ejecutarse: falta la clave de Gemini. Configura GEMINI_API_KEY y presiona Continuar."});return}await b.createActivityLog({projectId:e.id,level:"warn",agentRole:"structural-checkpoint",message:`Revisi\xF3n estructural final fall\xF3: ${I instanceof Error?I.message:String(I)}. La novela se marcar\xE1 como completada.`})}}console.log("[OrchestratorV2] Novel generation complete. Marking as completed WITHOUT auto-correction."),await this.extractSeriesWorldBibleOnComplete(e.id),await b.updateProject(e.id,{status:"completed"}),await b.createActivityLog({projectId:e.id,level:"success",message:'Manuscrito completado. Puedes ejecutar "Detect & Fix" manualmente si deseas revisar y corregir.',agentRole:"orchestrator"}),this.callbacks.onProjectComplete()}catch(s){console.error("[OrchestratorV2] Error:",s);let o=s instanceof Error?s.message:String(s);this.callbacks.onError(o),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:`Error en orquestador: ${o.substring(0,300)}. Presiona "Continuar" para reintentar.`,agentRole:"system",metadata:{error:o,recoverable:!0}}),console.log(`[OrchestratorV2] Project ${e.id} paused after error - can resume with "Continuar" button`)}}async runSeriesThreadFixer(e){if(e.seriesId){this.callbacks.onAgentStatus("series-thread-fixer","active","Analizando hilos y hitos de la serie..."),console.log(`[OrchestratorV2] Running SeriesThreadFixer for project ${e.id} in series ${e.seriesId}`);try{let t=await b.getSeries(e.seriesId);if(!t){console.log(`[OrchestratorV2] Series ${e.seriesId} not found, skipping thread fixer`);return}let n=await b.getMilestonesBySeries(e.seriesId),a=await b.getPlotThreadsBySeries(e.seriesId);if(n.length===0&&a.length===0){console.log("[OrchestratorV2] No milestones or plot threads defined for series, skipping thread fixer"),this.callbacks.onAgentStatus("series-thread-fixer","completed","Sin hilos/hitos definidos");return}let s=await b.getChaptersByProject(e.id),u=8e4*4,c=s.filter(C=>C.content&&C.content.length>100).map(C=>({id:C.id,chapterNumber:C.chapterNumber,title:C.title||`Capitulo ${C.chapterNumber}`,content:C.summary||C.content?.slice(0,3e3)||""}));if(c.reduce((C,A)=>C+A.content.length,0)>u){let C=Math.floor(u/c.length);c=c.map(A=>({...A,content:A.content.slice(0,C)})),console.log(`[OrchestratorV2] SeriesThreadFixer: Truncated chapters to ${C} chars each (${c.length} chapters)`)}if(c.length===0){console.log("[OrchestratorV2] No chapters with content found, skipping thread fixer");return}let m=await b.getWorldBibleByProject(e.id),f;if(e.seriesOrder&&e.seriesOrder>1){let A=(await b.getProjectsBySeries(e.seriesId)).filter(T=>T.seriesOrder&&T.seriesOrder<e.seriesOrder&&T.status==="completed").sort((T,E)=>(T.seriesOrder||0)-(E.seriesOrder||0));if(A.length>0){let T=[];for(let E of A){let d=await b.getWorldBibleByProject(E.id);if(d&&d.characters){let l=Array.isArray(d.characters)?d.characters:[];T.push(`Libro ${E.seriesOrder}: ${E.title} - Personajes: ${l.slice(0,5).map(h=>h.name||h).join(", ")}`)}}f=T.join(`
`)}}let g=await this.seriesThreadFixer.execute({projectTitle:e.title,seriesTitle:t.title,volumeNumber:e.seriesOrder||1,totalVolumes:t.totalPlannedBooks||1,chapters:c,milestones:n,plotThreads:a,worldBible:m||{},previousVolumesContext:f});if(this.addTokenUsage(g.tokenUsage),await this.logAiUsage(e.id,"series-thread-fixer","deepseek-chat",g.tokenUsage,0),g.error){console.error(`[OrchestratorV2] SeriesThreadFixer error: ${g.error}`),this.callbacks.onAgentStatus("series-thread-fixer","error",g.error);return}let y=g.result;if(!y){console.log("[OrchestratorV2] SeriesThreadFixer returned no result"),this.callbacks.onAgentStatus("series-thread-fixer","completed","Analisis completado sin resultados");return}if(console.log(`[OrchestratorV2] SeriesThreadFixer found ${y.totalIssuesFound} issues, ${y.fixes?.length||0} fixes`),this.callbacks.onAgentStatus("series-thread-fixer","active",`Encontrados ${y.totalIssuesFound} problemas, ${y.fixes?.length||0} correcciones`),y.fixes&&y.fixes.length>0&&(y.autoFixRecommendation==="safe_to_autofix"||y.autoFixRecommendation==="review_recommended")){let C=new Map;for(let E of y.fixes){if(E.priority==="optional")continue;let d=C.get(E.chapterId)||[];d.push(E),C.set(E.chapterId,d)}let A=0,T=Array.from(C.keys());for(let E of T){let d=C.get(E),l=c.find(v=>v.id===E);if(!l)continue;this.callbacks.onAgentStatus("series-thread-fixer","active",`Integrando ${d.length} correcciones en Capitulo ${l.chapterNumber}...`);let h=d.map(v=>{let S=this.getInsertionDescription(v.insertionPoint);return`[${v.fixType.toUpperCase()}] ${v.threadOrMilestoneName}:
  - Problema: ${v.rationale}
  - Accion: ${S}
  - Texto sugerido: "${v.suggestedRevision.substring(0,800)}${v.suggestedRevision.length>800?"...":""}"
  ${v.originalPassage?`- Pasaje original (ancla): "${v.originalPassage.substring(0,200)}"`:""}`}).join(`

`);try{let v=await this.smartEditor.surgicalFix({chapterContent:l.content,errorDescription:`CORRECCIONES DE HILOS/HITOS DE SERIE:

${h}`,consistencyConstraints:"Integrar los elementos de serie de forma ORGANICA. No insertes texto abrupto. Mantener voz y estilo del autor."});if(this.addTokenUsage(v.tokenUsage),await this.logAiUsage(e.id,"series-thread-fixer","deepseek-chat",v.tokenUsage,l.chapterNumber),v.patches&&v.patches.length>0){let R=Wr(l.content,v.patches).patchedText;if(R!==l.content){let x=R.split(/\s+/).length;await b.updateChapter(E,{content:R,wordCount:x}),A+=d.length,console.log(`[OrchestratorV2] SmartEditor integrated ${d.length} fixes in Chapter ${l.chapterNumber}`)}}}catch(v){console.error(`[OrchestratorV2] Error integrating fixes in Chapter ${l.chapterNumber}:`,v)}}this.callbacks.onAgentStatus("series-thread-fixer","completed",`${A} correcciones integradas organicamente`),console.log(`[OrchestratorV2] SeriesThreadFixer integrated ${A} fixes via SmartEditor`)}else this.callbacks.onAgentStatus("series-thread-fixer","completed",y.autoFixRecommendation==="manual_intervention_required"?"Requiere intervencion manual":"Analisis completado");y.unfulfilledMilestones&&y.unfulfilledMilestones.length>0&&console.log(`[OrchestratorV2] Unfulfilled milestones: ${y.unfulfilledMilestones.map(C=>C.description).join(", ")}`)}catch(t){console.error("[OrchestratorV2] SeriesThreadFixer error:",t),this.callbacks.onAgentStatus("series-thread-fixer","error",t instanceof Error?t.message:"Error desconocido")}}}async validateWorldBibleWithGemini(e,t,n,a){this.callbacks.onAgentStatus("bible-validator","active","Validando Biblia del Mundo con IA..."),await b.createActivityLog({projectId:e,level:"info",agentRole:"bible-validator",message:"Iniciando validaci\xF3n profunda de la Biblia del Mundo antes de escribir..."});let s=JSON.stringify({characters:t.characters||[],rules:t.rules||t.worldRules||[],settings:t.settings||[],themes:t.themes||[]},null,2),o=n.map(c=>`Cap ${c.chapter_num}: "${c.title}" - ${c.summary||"Sin resumen"} [Evento clave: ${c.key_event||"N/A"}]`).join(`
`),i=a?a.map(c=>`- ${c.name}: ${c.description||c.goal||"Sin descripci\xF3n"}`).join(`
`):"No definidos",u=`Eres un editor literario experto. Analiza esta Biblia del Mundo y la escaleta de cap\xEDtulos de una novela.
Tu objetivo es encontrar FISURAS, INCONSISTENCIAS y DEBILIDADES ESTRUCTURALES que causar\xEDan problemas durante la escritura.

=== BIBLIA DEL MUNDO ===
${s.substring(0,15e3)}

=== ESCALETA DE CAP\xCDTULOS (${n.length} cap\xEDtulos) ===
${o}

=== HILOS ARGUMENTALES ===
${i}

BUSCA ESTOS PROBLEMAS:
1. PERSONAJES: Arcos incompletos, motivaciones contradictorias, relaciones sin definir, personajes mencionados en la escaleta pero ausentes de la biblia
2. L\xCDNEA TEMPORAL: Eventos sin orden l\xF3gico, saltos temporales injustificados, eventos simult\xE1neos imposibles
3. REGLAS DEL MUNDO: Reglas que se contradicen entre s\xED, reglas demasiado vagas que causar\xE1n inconsistencias
4. UBICACIONES: Descripciones inconsistentes, personajes en lugares imposibles seg\xFAn la escaleta
5. SUBTRAMAS: Hilos hu\xE9rfanos (se abren pero no se cierran), subtramas desconectadas de la trama principal
6. ESTRUCTURA: Pacing desbalanceado, cl\xEDmax mal ubicado, actos desproporcionados
7. COHERENCIA ESCALETA-BIBLIA: Eventos en la escaleta que contradicen la biblia

RESPONDE EXCLUSIVAMENTE EN JSON V\xC1LIDO:
{
  "isValid": true/false,
  "overallScore": 1-10,
  "issues": [
    {
      "type": "personaje|temporal|regla|ubicacion|subtrama|estructura|coherencia",
      "severity": "critica|mayor|menor",
      "description": "Descripci\xF3n clara del problema",
      "fix": "Correcci\xF3n espec\xEDfica y concreta"
    }
  ],
  "corrections": {
    "characters": null o array corregido de personajes (solo si hay correcciones de personajes),
    "rules": null o array corregido de reglas (solo si hay correcciones de reglas),
    "outline_fixes": null o [{chapter_num: N, corrected_summary: "..."}] (solo si hay correcciones de escaleta)
  },
  "lessonsForWriter": ["Lecci\xF3n 1 que el escritor debe recordar", "Lecci\xF3n 2..."]
}`;try{let f=(await ai.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent(u)).response.text().match(/\{[\s\S]*\}/);if(!f)return console.error("[BibleValidator] No JSON in Gemini response - treating as INVALID (fail closed)"),await b.createActivityLog({projectId:e,level:"warn",agentRole:"bible-validator",message:"Respuesta de IA no conten\xEDa JSON v\xE1lido. Se tratar\xE1 como no v\xE1lida para re-intentar."}),{isValid:!1,issues:[{type:"formato",severity:"critica",description:"La IA no devolvi\xF3 formato v\xE1lido",fix:"Re-ejecutar validaci\xF3n"}]};let g=JSON.parse(f[0]),y=g.issues||[],C=y.filter(d=>d.severity==="critica"),A=y.filter(d=>d.severity==="mayor");console.log(`[BibleValidator] Score: ${g.overallScore}/10, Issues: ${C.length} critical, ${A.length} major, ${y.length-C.length-A.length} minor`);for(let d of y)await b.createActivityLog({projectId:e,level:d.severity==="critica"?"error":d.severity==="mayor"?"warn":"info",agentRole:"bible-validator",message:`[${d.type.toUpperCase()}] ${d.description} \u2192 FIX: ${d.fix}`});g.lessonsForWriter&&g.lessonsForWriter.length>0&&await this.storeBibleLessons(e,g.lessonsForWriter);let T=C.length===0&&A.length<=1,E;return!T&&g.corrections&&(E={...t},g.corrections.characters&&Array.isArray(g.corrections.characters)&&(E.characters=g.corrections.characters),g.corrections.rules&&Array.isArray(g.corrections.rules)&&(E.rules=g.corrections.rules),g.corrections.outline_fixes&&Array.isArray(g.corrections.outline_fixes)&&(E._outlineFixes=g.corrections.outline_fixes)),this.callbacks.onAgentStatus("bible-validator",T?"completed":"warning",T?`Biblia validada (${g.overallScore}/10)`:`${C.length} problemas cr\xEDticos detectados`),{isValid:T,issues:y,correctedBible:E}}catch(c){return console.error("[BibleValidator] Error:",c),this.callbacks.onAgentStatus("bible-validator","warning","Error en validaci\xF3n - se tratar\xE1 como no v\xE1lida"),await b.createActivityLog({projectId:e,level:"warn",agentRole:"bible-validator",message:`Error durante validaci\xF3n: ${c instanceof Error?c.message:"Error desconocido"}. Se tratar\xE1 como no v\xE1lida para re-intentar.`}),{isValid:!1,issues:[{type:"error",severity:"critica",description:"Error al ejecutar validaci\xF3n",fix:"Re-ejecutar validaci\xF3n"}]}}}async storeBibleLessons(e,t){try{let a=(await b.getActivityLogsByProject(e)).filter(s=>s.agentRole==="bible-lessons").map(s=>s.message);for(let s of t)a.includes(s)||await b.createActivityLog({projectId:e,level:"info",agentRole:"bible-lessons",message:s});console.log(`[BibleValidator] Stored ${t.length} lessons for writer`)}catch(n){console.error("[BibleValidator] Failed to store lessons:",n)}}async getAccumulatedLessons(e){try{let n=(await b.getActivityLogsByProject(e)).filter(o=>o.agentRole==="bible-lessons"||o.agentRole==="checkpoint-lessons"||o.agentRole==="structural-checkpoint");if(n.length===0)return"";let a=Array.from(new Set(n.map(o=>o.message)));if(a.length===0)return"";let s=[`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550`,"LECCIONES APRENDIDAS EN ESTE PROYECTO (OBLIGATORIO APLICAR)","\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"];return a.slice(0,15).forEach((o,i)=>{s.push(`  ${i+1}. ${o}`)}),s.push("Aplica TODAS estas lecciones en cada escena que escribas."),s.push("\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),s.join(`
`)}catch(t){return console.error("[OrchestratorV2] Failed to get accumulated lessons:",t),""}}async runStructuralCheckpoint(e,t,n,a,s,o=0,i=new Set){let u=o>0?o+1:1;this.callbacks.onAgentStatus("structural-checkpoint","active",`Verificaci\xF3n estructural (Cap ${u}-${t})...`),await b.createActivityLog({projectId:e,level:"info",agentRole:"structural-checkpoint",message:`Ejecutando checkpoint estructural: cap\xEDtulos ${u}-${t} (cap\xEDtulos ya corregidos: ${i.size>0?Array.from(i).join(", "):"ninguno"})`,metadata:{type:"checkpoint_executed",rangeStart:u,rangeEnd:t,alreadyCorrected:Array.from(i)}});let p=(await b.getChaptersByProject(e)).filter(A=>A.content&&A.content.length>100&&A.chapterNumber>=u&&A.chapterNumber<=t).sort((A,T)=>A.chapterNumber-T.chapterNumber);if(p.length===0)return{deviatedChapters:[],issues:[],lessonsLearned:[]};let m=p.map(A=>{let T=a.find(l=>l.chapter_num===A.chapterNumber),E=T?.summary||"N/A",d=T?.key_event||"N/A";return`CAP\xCDTULO ${A.chapterNumber} ("${A.title||""}"):
  PLAN: ${E} [Evento: ${d}]
  RESUMEN REAL: ${A.summary||A.content?.substring(0,500)||"Sin resumen"}`}).join(`

`),f=s.length>0?s.map(A=>`  Cap ${A.chapter}: ${A.narrativeTime}${A.location?` \u2192 ${A.location}`:""}`).join(`
`):"No disponible",g=JSON.stringify((n.characters||[]).map(A=>({name:A.name||A.nombre,role:A.role||A.rol,arc:A.arc||A.arco})),null,2).substring(0,5e3),y=`Eres un director narrativo experto. Analiza si los cap\xEDtulos escritos en este RANGO (${u}-${t}) SIGUEN FIELMENTE la estructura planificada.
IMPORTANTE: Solo reporta desviaciones de los cap\xEDtulos en el rango ${u}-${t}. Los cap\xEDtulos anteriores ya fueron verificados.

=== PERSONAJES Y ARCOS PLANIFICADOS ===
${g}

=== L\xCDNEA TEMPORAL ACUMULADA ===
${f}

=== COMPARACI\xD3N PLAN vs REALIDAD (Cap\xEDtulos ${u}-${t}) ===
${m.substring(0,2e4)}

ANALIZA SOLO los cap\xEDtulos ${u}-${t}:
1. \xBFCada cap\xEDtulo cumple con su plan original? \xBFSe ejecutaron los eventos clave?
2. \xBFLa l\xEDnea temporal es coherente y continua?
3. \xBFLos arcos de personajes progresan seg\xFAn lo planificado?
4. \xBFHay desviaciones que comprometan la estructura de la novela?
5. \xBFQu\xE9 lecciones debe aprender el escritor para los pr\xF3ximos cap\xEDtulos?
NO incluyas cap\xEDtulos anteriores al ${u} en deviatedChapters.

RESPONDE EXCLUSIVAMENTE EN JSON V\xC1LIDO:
{
  "overallAdherence": 1-10,
  "deviatedChapters": [n\xFAmeros de cap\xEDtulos con desviaciones graves],
  "issues": [
    {
      "chapter": N,
      "type": "estructura|temporal|arco_personaje|evento_omitido|coherencia",
      "severity": "critica|mayor|menor",
      "description": "Qu\xE9 se desvi\xF3 del plan",
      "expectedVsActual": "Lo planeado vs lo escrito",
      "correctionNeeded": "Qu\xE9 se debe corregir"
    }
  ],
  "timelineConsistency": true/false,
  "timelineIssues": ["Problema temporal 1", "..."],
  "lessonsForWriter": [
    "Lecci\xF3n espec\xEDfica sobre qu\xE9 evitar en los pr\xF3ximos cap\xEDtulos",
    "Patr\xF3n de error detectado que no debe repetirse"
  ]
}`,C=2;for(let A=0;A<=C;A++)try{let l=(await ai.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent(y)).response.text().match(/\{[\s\S]*\}/);if(!l){if(A<C){console.warn(`[StructuralCheckpoint] No JSON in response (attempt ${A+1}/${C+1}), retrying...`);continue}return console.error("[StructuralCheckpoint] No JSON in response after all retries - logging as warning"),await b.createActivityLog({projectId:e,level:"warn",agentRole:"structural-checkpoint",message:`Checkpoint en cap ${t}: respuesta de IA sin formato v\xE1lido tras ${C+1} intentos. Se omitir\xE1 este checkpoint.`}),{deviatedChapters:[],issues:[],lessonsLearned:["El checkpoint estructural no pudo ejecutarse correctamente - verificar en el siguiente punto de control"]}}let h=JSON.parse(l[0]),v=h.deviatedChapters||[],S=v.filter(O=>O>=u&&O<=t&&!i.has(O)),R=v.length-S.length,x=(h.issues||[]).filter(O=>(O.severity==="critica"||O.severity==="mayor")&&O.chapter>=u&&!i.has(O.chapter)).map(O=>`Cap ${O.chapter}: [${O.type}] ${O.description} \u2192 ${O.correctionNeeded}`),w=h.lessonsForWriter||[];console.log(`[StructuralCheckpoint] Adherence: ${h.overallAdherence}/10, Deviations: ${S.length} (${R} skipped as already corrected/out of range), Lessons: ${w.length}`);for(let O of(h.issues||[]).filter(I=>I.severity==="critica"||I.severity==="mayor"))await b.createActivityLog({projectId:e,level:O.severity==="critica"?"error":"warn",agentRole:"structural-checkpoint",message:`Cap ${O.chapter}: [${O.type}] ${O.description}`,metadata:{correction:O.correctionNeeded,expected:O.expectedVsActual}});if(w.length>0){for(let O of w)await b.createActivityLog({projectId:e,level:"info",agentRole:"checkpoint-lessons",message:O});console.log(`[StructuralCheckpoint] Stored ${w.length} lessons for future chapters`)}if(!h.timelineConsistency&&h.timelineIssues?.length>0)for(let O of h.timelineIssues)await b.createActivityLog({projectId:e,level:"warn",agentRole:"structural-checkpoint",message:`TEMPORAL: ${O}`});return this.callbacks.onAgentStatus("structural-checkpoint",S.length>0?"warning":"completed",S.length>0?`${S.length} cap\xEDtulos desviados detectados`:`Estructura verificada (${h.overallAdherence}/10)`),await b.createActivityLog({projectId:e,level:S.length>0?"warn":"success",agentRole:"structural-checkpoint",message:S.length>0?`Checkpoint: ${S.length} cap\xEDtulos con desviaciones graves (adherencia ${h.overallAdherence}/10). Cap\xEDtulos: ${S.join(", ")}`:`Checkpoint: Estructura correcta (adherencia ${h.overallAdherence}/10). ${w.length} lecciones registradas.`}),{deviatedChapters:S,issues:x,lessonsLearned:w}}catch(T){if(A<C){console.warn(`[StructuralCheckpoint] Error on attempt ${A+1}/${C+1}, retrying...`,T);continue}return console.error("[StructuralCheckpoint] Error after all retries:",T),this.callbacks.onAgentStatus("structural-checkpoint","completed","Checkpoint completado con advertencias"),{deviatedChapters:[],issues:[],lessonsLearned:["Error en checkpoint estructural - verificar en el siguiente punto de control"]}}return{deviatedChapters:[],issues:[],lessonsLearned:[]}}async rewriteDeviatedChapter(e,t,n,a,s){try{let o=await b.getChaptersByProject(e),i=o.find(g=>g.chapterNumber===t);if(!i||!i.content)return!1;let u=a.find(g=>g.chapter_num===t);if(!u)return!1;this.callbacks.onAgentStatus("structural-checkpoint","active",`Reescribiendo cap\xEDtulo ${t}...`);let c=o.find(g=>g.chapterNumber===t-1),p=o.find(g=>g.chapterNumber===t+1),m=`CORRECCI\xD3N ESTRUCTURAL OBLIGATORIA - CAP\xCDTULO ${t}

PROBLEMA DETECTADO:
${s}

PLAN ORIGINAL PARA ESTE CAP\xCDTULO:
T\xEDtulo: ${u.title}
Resumen planificado: ${u.summary}
Evento clave: ${u.key_event||"N/A"}

CONTEXTO ADYACENTE:
${c?`Cap\xEDtulo anterior (${t-1}): ${c.summary||c.content?.substring(0,500)}`:"Es el primer cap\xEDtulo"}
${p?`Cap\xEDtulo siguiente (${t+1}): ${p.summary||p.content?.substring(0,500)}`:"Es el \xFAltimo cap\xEDtulo escrito"}

TEXTO ACTUAL DEL CAP\xCDTULO:
${i.content}

INSTRUCCIONES:
1. Reescribe SOLO las partes que se desv\xEDan del plan original
2. Mant\xE9n todo lo que ya est\xE1 bien escrito
3. Aseg\xFArate de que el evento clave planificado OCURRA en el cap\xEDtulo
4. Preserva las transiciones con los cap\xEDtulos adyacentes
5. NO cambies el estilo ni la voz narrativa

Devuelve SOLO el texto completo del cap\xEDtulo reescrito, sin explicaciones ni marcadores.`,f=await this.smartEditor.fullRewrite({chapterContent:i.content,errorDescription:m,worldBible:{characters:n.characters||n.personajes||[],locations:n.locations||n.lugares||[],worldRules:n.rules||n.reglas||n.worldRules||[],persistentInjuries:n.persistentInjuries||n.lesiones||[],plotDecisions:n.plotDecisions||n.decisiones||[]},chapterNumber:t,chapterTitle:u.title,previousChapterSummary:c?.summary||"",nextChapterSummary:p?.summary||""});if(this.addTokenUsage(f.tokenUsage),await this.logAiUsage(e,"structural-checkpoint","deepseek-chat",f.tokenUsage,t),f.rewrittenContent&&f.rewrittenContent.length>200){let g=f.rewrittenContent.split(/\s+/).length,y=i.content.split(/\s+/).length,C=1200;return g<C||g<y*.7?(console.warn(`[StructuralCheckpoint] Chapter ${t} rewrite too short (${g} vs ${y} original, min ${C}). Keeping original.`),await b.createActivityLog({projectId:e,level:"warn",agentRole:"structural-checkpoint",message:`Cap\xEDtulo ${t}: reescritura descartada por p\xE9rdida de contenido (${g} palabras vs ${y} original). Se mantiene la versi\xF3n actual.`}),!1):(await b.updateChapter(i.id,{originalContent:i.originalContent||i.content,content:f.rewrittenContent,wordCount:g}),await b.createActivityLog({projectId:e,level:"success",agentRole:"structural-checkpoint",message:`Cap\xEDtulo ${t} reescrito para corregir desviaci\xF3n estructural (${g} palabras, original: ${y})`,metadata:{type:"chapter_rewritten",chapterNumber:t,newWordCount:g,originalWordCount:y}}),console.log(`[StructuralCheckpoint] Chapter ${t} rewritten (${g} words, was ${y})`),!0)}return!1}catch(o){return console.error(`[StructuralCheckpoint] Failed to rewrite chapter ${t}:`,o),!1}}async runFinalStructuralReview(e,t,n,a,s,o){if(console.log(`[FinalStructuralReview] Starting full-novel structural review for project ${e}`),!dI)return console.warn("[FinalStructuralReview] No GEMINI_API_KEY - cannot run final structural review"),await b.createActivityLog({projectId:e,level:"warn",agentRole:"structural-checkpoint",message:"Revisi\xF3n estructural final omitida: no hay clave de Gemini configurada."}),{rewrittenCount:0,issues:[],lessonsLearned:["Revisi\xF3n final omitida por falta de clave Gemini"]};await b.createActivityLog({projectId:e,level:"info",agentRole:"structural-checkpoint",message:"Ejecutando revisi\xF3n estructural FINAL de toda la novela",metadata:{type:"final_review_started"}});let u=(await b.getChaptersByProject(e)).filter(A=>A.content&&A.content.length>100).sort((A,T)=>A.chapterNumber-T.chapterNumber);if(u.length===0)return{rewrittenCount:0,issues:[],lessonsLearned:[]};let c=u.map(A=>{let T=n.find(v=>v.chapter_num===A.chapterNumber),E=T?.summary||"N/A",d=T?.key_event||"N/A",l=A.content?.split(/\s+/).length||0,h=A.summary||A.content?.substring(0,300)||"Sin resumen";return`CAP\xCDTULO ${A.chapterNumber} ("${A.title||""}" - ${l} palabras):
  PLAN: ${E} [Evento: ${d}]
  RESUMEN REAL: ${h}`}).join(`

`),p=a.length>0?a.map(A=>`  Cap ${A.chapter}: ${A.narrativeTime}${A.location?` \u2192 ${A.location}`:""}`).join(`
`):"No disponible",m=JSON.stringify((t.characters||[]).map(A=>({name:A.name||A.nombre,role:A.role||A.rol,arc:A.arc||A.arco})),null,2).substring(0,5e3),f=t.plotOutline||{},g=f.three_act_structure||f.threeActStructure||{},y=`Eres un director editorial experto. Esta es la REVISI\xD3N FINAL de toda la novela completa (${u.length} cap\xEDtulos).
Tu misi\xF3n es detectar PROBLEMAS ESTRUCTURALES GRAVES que comprometan la calidad de la novela como obra terminada.

=== ESTRUCTURA EN 3 ACTOS PLANIFICADA ===
${JSON.stringify(g,null,2).substring(0,3e3)}

=== PERSONAJES Y ARCOS PLANIFICADOS ===
${m}

=== L\xCDNEA TEMPORAL COMPLETA ===
${p}

=== COMPARACI\xD3N PLAN vs REALIDAD (TODOS LOS CAP\xCDTULOS) ===
${c.substring(0,5e4)}

ANALIZA LA NOVELA COMPLETA COMO UNIDAD:

1. ARCOS DE PERSONAJES: \xBFCada arco principal se inicia, desarrolla y cierra correctamente?
2. HILOS NARRATIVOS: \xBFHay subtramas abandonadas, hilos sin resolver, o Chekhov's guns sin disparar?
3. ESTRUCTURA DE 3 ACTOS: \xBFLos puntos de giro, cl\xEDmax y resoluci\xF3n est\xE1n donde deben estar?
4. EVENTOS CLAVE OMITIDOS: \xBFAlg\xFAn evento crucial del plan original NUNCA se ejecut\xF3?
5. COHERENCIA TEMPORAL: \xBFLa l\xEDnea temporal global tiene saltos o contradicciones?
6. RITMO GLOBAL: \xBFHay tramos excesivamente lentos o apresurados que afecten la experiencia lectora?
7. PROTAGONISTA: \xBFEl protagonista tiene presencia suficiente y su arco es satisfactorio?

IMPORTANTE: Solo reporta problemas GRAVES que un lector notar\xEDa. No reportes cuestiones estil\xEDsticas menores.

RESPONDE EXCLUSIVAMENTE EN JSON V\xC1LIDO:
{
  "overallScore": 1-10,
  "novelWorksAsUnit": true/false,
  "deviatedChapters": [n\xFAmeros de cap\xEDtulos con problemas GRAVES que requieren reescritura],
  "issues": [
    {
      "chapter": N,
      "type": "arco_incompleto|hilo_sin_resolver|evento_omitido|temporal|estructura|ritmo|protagonista",
      "severity": "critica|mayor",
      "description": "Qu\xE9 problema espec\xEDfico tiene",
      "correctionNeeded": "Qu\xE9 se debe corregir exactamente"
    }
  ],
  "unresolvedThreads": ["Hilo narrativo que qued\xF3 sin cerrar"],
  "arcCompletionStatus": [
    { "character": "nombre", "arcComplete": true/false, "missing": "qu\xE9 falta" }
  ],
  "lessonsForWriter": [
    "Lecci\xF3n global sobre la estructura de la novela"
  ],
  "verdict": "Resumen ejecutivo de la calidad estructural"
}`,C=2;for(let A=0;A<=C;A++)try{let l=(await ai.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent(y)).response.text().match(/\{[\s\S]*\}/);if(!l){if(A<C){console.warn(`[FinalStructuralReview] No JSON in response (attempt ${A+1}), retrying...`);continue}return console.error("[FinalStructuralReview] No JSON after all retries"),{rewrittenCount:0,issues:[],lessonsLearned:[]}}let h=JSON.parse(l[0]),v=h.deviatedChapters||[];if(s.size>0){let N=v.filter(P=>s.has(P));N.length>0&&console.log(`[FinalStructuralReview] Will re-correct ${N.length} previously-corrected chapters: ${N.join(", ")}`)}let S=(h.issues||[]).filter(N=>N.severity==="critica"||N.severity==="mayor").map(N=>`Cap ${N.chapter}: [${N.type}] ${N.description} \u2192 ${N.correctionNeeded}`),R=h.lessonsForWriter||[],x=h.unresolvedThreads||[],w=h.arcCompletionStatus||[];console.log(`[FinalStructuralReview] Score: ${h.overallScore}/10, Works as unit: ${h.novelWorksAsUnit}, Deviations: ${v.length}, Unresolved threads: ${x.length}`),await b.createActivityLog({projectId:e,level:v.length>0?"warn":"success",agentRole:"structural-checkpoint",message:`Revisi\xF3n final: ${h.overallScore}/10. ${v.length>0?`${v.length} cap\xEDtulos con desviaciones graves.`:"Estructura correcta."} ${x.length>0?`Hilos sin resolver: ${x.join(", ")}`:""} Veredicto: ${h.verdict||"N/A"}`,metadata:{type:"final_review_result",score:h.overallScore,novelWorksAsUnit:h.novelWorksAsUnit,deviatedCount:v.length,unresolvedThreads:x}});for(let N of(h.issues||[]).filter(P=>P.severity==="critica"||P.severity==="mayor"))await b.createActivityLog({projectId:e,level:N.severity==="critica"?"error":"warn",agentRole:"structural-checkpoint",message:`[FINAL] Cap ${N.chapter}: [${N.type}] ${N.description}`,metadata:{correction:N.correctionNeeded}});for(let N of w.filter(P=>!P.arcComplete))await b.createActivityLog({projectId:e,level:"warn",agentRole:"structural-checkpoint",message:`[FINAL] Arco incompleto: ${N.character} - ${N.missing}`});if(R.length>0)for(let N of R)await b.createActivityLog({projectId:e,level:"info",agentRole:"checkpoint-lessons",message:`[FINAL] ${N}`});let O=5,I=0,_=v.slice(0,O);if(v.length>O){let N=v.slice(O);console.warn(`[FinalStructuralReview] ${N.length} deviated chapters will NOT be corrected (limit ${O}): ${N.join(", ")}`),await b.createActivityLog({projectId:e,level:"warn",agentRole:"structural-checkpoint",message:`[FINAL] ${N.length} cap\xEDtulos con desviaciones NO corregidos por l\xEDmite de reescrituras (${O}): Cap\xEDtulos ${N.join(", ")}. Considera ejecutar "Detect & Fix" manualmente.`,metadata:{type:"final_review_skipped",skippedChapters:N}})}for(let N of _){if(await this.shouldStopProcessing(e))break;let P=S.find(j=>j.includes(`Cap ${N}`))||`Cap\xEDtulo ${N} tiene problemas estructurales detectados en la revisi\xF3n final`;if(this.callbacks.onAgentStatus("structural-checkpoint","active",`Corrigiendo cap\xEDtulo ${N} (revisi\xF3n final)...`),await this.rewriteDeviatedChapter(e,N,t,n,P)){let $=(await b.getChaptersByProject(e)).find(V=>V.chapterNumber===N);if($?.content){let V=await this.verifyRewriteFixed(e,N,$.content,n,P);if(!V.fixed&&V.remainingIssues.length>0){console.log(`[FinalStructuralReview] Chapter ${N} rewrite did NOT fix problem. Second attempt...`);let Q=`${P}

PROBLEMAS PERSISTENTES:
${V.remainingIssues.join(`
`)}`;if(await this.rewriteDeviatedChapter(e,N,t,n,Q)){let ae=(await b.getChaptersByProject(e)).find(D=>D.chapterNumber===N);if(ae?.content){let D=await this.verifyRewriteFixed(e,N,ae.content,n,Q);D.fixed||await b.createActivityLog({projectId:e,level:"warn",agentRole:"structural-checkpoint",message:`[FINAL] Cap\xEDtulo ${N}: desviaci\xF3n persistente tras 2 intentos. Problemas: ${D.remainingIssues.join("; ")}`,metadata:{type:"persistent_deviation",chapterNumber:N,phase:"final_review"}})}}}}I++,s.add(N);let k=(await b.getChaptersByProject(e)).find(V=>V.chapterNumber===N);if(k){let V=await this.summarizer.execute({chapterContent:k.content||"",chapterNumber:N});this.addTokenUsage(V.tokenUsage),V.content&&await b.updateChapter(k.id,{summary:V.content})}}}if(x.length>0&&!await this.shouldStopProcessing(e)){let P=(await b.getChaptersByProject(e)).filter(j=>j.content&&j.content.length>100).sort((j,$)=>j.chapterNumber-$.chapterNumber),L=P[P.length-1];if(L&&!_.includes(L.chapterNumber)){console.log(`[FinalStructuralReview] Rewriting last chapter ${L.chapterNumber} to close ${x.length} unresolved threads: ${x.join(", ")}`),this.callbacks.onAgentStatus("structural-checkpoint","active",`Cerrando ${x.length} hilos narrativos abiertos en cap\xEDtulo ${L.chapterNumber}...`);let j=`HILOS NARRATIVOS SIN CERRAR - DEBES resolver estos hilos:
${x.map(U=>`- ${U}`).join(`
`)}

Integra los cierres de forma natural en la narrativa existente del cap\xEDtulo.`;if(await this.rewriteDeviatedChapter(e,L.chapterNumber,t,n,j)){I++,console.log("[FinalStructuralReview] Last chapter rewritten to close unresolved threads");let k=(await b.getChaptersByProject(e)).find(V=>V.chapterNumber===L.chapterNumber);if(k){let V=await this.summarizer.execute({chapterContent:k.content||"",chapterNumber:L.chapterNumber});this.addTokenUsage(V.tokenUsage),V.content&&await b.updateChapter(k.id,{summary:V.content})}}}}return await b.createActivityLog({projectId:e,level:"success",agentRole:"structural-checkpoint",message:`Revisi\xF3n final completada: ${I} cap\xEDtulos corregidos de ${v.length} detectados. ${x.length>0?`${x.length} hilos narrativos cerrados.`:""} Puntuaci\xF3n estructural: ${h.overallScore}/10.`,metadata:{type:"final_review_completed",rewrittenCount:I,totalDeviated:v.length,score:h.overallScore,threadsClosed:x.length}}),{rewrittenCount:I,issues:S,lessonsLearned:R}}catch(T){if(A<C){console.warn(`[FinalStructuralReview] Error on attempt ${A+1}, retrying...`,T);continue}return console.error("[FinalStructuralReview] Error after all retries:",T),{rewrittenCount:0,issues:[],lessonsLearned:[]}}return{rewrittenCount:0,issues:[],lessonsLearned:[]}}async verifyRewriteFixed(e,t,n,a,s){try{let o=a.find(y=>y.chapter_num===t);if(!o)return{fixed:!0,remainingIssues:[]};let i=`Eres un verificador de correcciones estructurales. Despu\xE9s de reescribir un cap\xEDtulo, debes confirmar que la desviaci\xF3n fue corregida.

PROBLEMA ORIGINAL:
${s}

PLAN ORIGINAL PARA CAP\xCDTULO ${t}:
T\xEDtulo: ${o.title}
Resumen planificado: ${o.summary}
Evento clave: ${o.key_event||"N/A"}

TEXTO REESCRITO:
${n.substring(0,15e3)}

VERIFICA:
1. \xBFEl problema original fue corregido en la reescritura?
2. \xBFEl evento clave planificado ahora S\xCD ocurre?
3. \xBFLa reescritura no introdujo nuevos problemas estructurales graves?

RESPONDE EXCLUSIVAMENTE EN JSON V\xC1LIDO:
{
  "fixed": true/false,
  "confidence": 1-10,
  "remainingIssues": ["Problema que persiste o fue introducido"],
  "verdict": "Breve explicaci\xF3n"
}`,m=(await ai.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent(i)).response.text().match(/\{[\s\S]*\}/);if(!m)return{fixed:!0,remainingIssues:[]};let f=JSON.parse(m[0]),g=f.fixed===!0&&(f.confidence||5)>=5;return console.log(`[StructuralCheckpoint] Verification Ch ${t}: fixed=${g}, confidence=${f.confidence}, verdict="${f.verdict}"`),await b.createActivityLog({projectId:e,level:g?"success":"warn",agentRole:"structural-checkpoint",message:g?`Verificaci\xF3n: Cap\xEDtulo ${t} corregido exitosamente (confianza ${f.confidence}/10)`:`Verificaci\xF3n: Cap\xEDtulo ${t} NO corregido completamente - ${f.verdict}`,metadata:{type:"rewrite_verification",chapterNumber:t,fixed:g,confidence:f.confidence,remainingIssues:f.remainingIssues}}),{fixed:g,remainingIssues:f.remainingIssues||[]}}catch(o){return console.error(`[StructuralCheckpoint] Verification failed for Ch ${t}:`,o),{fixed:!0,remainingIssues:[]}}}async runNarrativeDirector(e,t,n,a){this.callbacks.onAgentStatus("narrative-director","active","Analyzing story progress...");let s=await b.getPlotThreadsByProject(e),o=s.map(g=>({name:g.name,status:g.status,goal:g.goal||"",lastUpdatedChapter:g.lastUpdatedChapter||0})),i=a.slice(-5).map((g,y)=>`Cap\xEDtulo ${t-(a.slice(-5).length-1-y)}: ${g}`).join(`

`),u=await this.narrativeDirector.execute({recentSummaries:i,plotThreads:o,currentChapter:t,totalChapters:n},this.geminiQAFlags?.narrativeDirector?{forceProvider:"gemini"}:void 0),c=this.geminiQAFlags?.narrativeDirector?"gemini-3-pro-preview":"deepseek-chat";this.addTokenUsage(u.tokenUsage),await this.logAiUsage(e,"narrative-director",c,u.tokenUsage,t);let p=!1,m="",f=[];if(u.parsed){if(console.log(`[OrchestratorV2] Narrative Director directive: ${u.parsed.directive}`),m=u.parsed.directive||"",u.parsed.thread_updates)for(let y of u.parsed.thread_updates){let C=s.find(A=>A.name===y.name);C&&await b.updateProjectPlotThread(C.id,{status:y.new_status,lastUpdatedChapter:t})}if(t===998||t===n){f=o.filter(A=>A.status==="active"||A.status==="developing").map(A=>A.name);let C=["inconsistencia","sin resolver","unresolved","contradiction","error","problema"].some(A=>m.toLowerCase().includes(A));p=f.length>0||C,p&&console.log(`[OrchestratorV2] Chapter ${t} needs rewrite: ${f.length} unresolved threads, critical issues: ${C}`)}this.callbacks.onAgentStatus("narrative-director","completed",`Tension: ${u.parsed.tension_level}/10`)}else this.callbacks.onAgentStatus("narrative-director","completed","Analysis complete");return{needsRewrite:p,directive:m,unresolvedThreads:f}}async generateSingleChapter(e,t,n,a,s,o,i){let u=n?.plotOutline,c=u?.chapterOutlines||u?.chapters||[],p=i||"";if(!p&&e.kindleUnlimitedOptimized){let v=await this.buildEnrichedContextOptions(e);p=await this.buildEnrichedWritingContext(e.id,t.chapter_num,n,v),console.log(`[OrchestratorV2] Generated KU pacing constraints for helper (${p.length} chars)`)}let m=$c(e.id),f=m.analyzeForChapter(t.chapter_num),g=m.formatForPrompt(f),y=await this.chapterArchitect.execute({chapterOutline:t,worldBible:n,previousChapterSummary:a,storyState:s,consistencyConstraints:p,fullPlotOutline:c,isKindleUnlimited:e.kindleUnlimitedOptimized||!1,patternAnalysisContext:g});if(!y.parsed)throw new Error("Chapter planning failed");let C=y.parsed,A=m.extractPatternFromScenes(t.chapter_num,t.title,C.scenes.map(v=>({plot_beat:v.plot_beat,emotional_beat:v.emotional_beat,ending_hook:v.ending_hook})),C.chapter_hook);m.registerPattern(A);let T="",E="";for(let v of C.scenes){let S=await this.ghostwriter.execute({scenePlan:v,prevSceneContext:E,rollingSummary:s,worldBible:n,guiaEstilo:o,currentChapterText:T,seriesWorldBible:await this.getSeriesWorldBibleForInjection(e.id)});S.error||(T+=`

`+S.content,E=S.content.slice(-1500))}let d=await this.smartEditor.execute({chapterContent:T,sceneBreakdown:C,worldBible:n}),l=T;d.parsed?.patches&&d.parsed.patches.length>0&&(l=Wr(T,d.parsed.patches).patchedText);let h=await this.summarizer.execute({chapterContent:l,chapterNumber:t.chapter_num});return{content:l,summary:h.content||"",wordCount:l.split(/\s+/).length,sceneBreakdown:C}}async runFinalReviewOnly(e,t=15){console.log(`[OrchestratorV2] Running final review for project ${e.id}`);let n=global.startCorrection,a=global.endCorrection;n&&n(e.id,"legacy");try{this.callbacks.onAgentStatus("final-reviewer","active","Ejecutando revisi\xF3n final completa...");let o=(await b.getChaptersByProject(e.id)).filter(F=>F.status==="completed"||F.status==="approved").sort((F,ae)=>F.chapterNumber-ae.chapterNumber);if(o.length===0){this.callbacks.onError("No hay cap\xEDtulos completados para revisar");return}let i=await b.getWorldBibleByProject(e.id);if(!i){this.callbacks.onError("No se encontr\xF3 la World Bible para este proyecto");return}let u="";if(i.styleGuide)u=i.styleGuide,console.log(`[OrchestratorV2] Using condensed style guide from World Bible (${u.length} chars)`);else if(e.styleGuideId){let F=await b.getStyleGuide(e.styleGuideId);F&&F.content&&(u=await this.analyzeAndSaveStyleGuide(e.id,F.content),u.length<100&&(u=F.content.substring(0,3e3)))}let c={characters:i.characters||[],rules:i.worldRules||[],worldRules:i.worldRules||[],locations:i.locations||[],settings:i.settings||[],plotOutline:i.plotOutline||{},timeline:i.timeline||[],plotDecisions:i.plotDecisions||[],persistentInjuries:i.persistentInjuries||[],threeActStructure:i.plotOutline?.threeActStructure||null,three_act_structure:i.plotOutline?.three_act_structure||null},p=e.revisionCycle||0,m=null,f=[],g,y=[],C=0,A=e.resolvedIssueHashes||[];console.log(`[OrchestratorV2] Loaded ${A.length} resolved issue hashes from database`);let T=4,E=e?.chapterCorrectionCounts||{},d=new Map(Object.entries(E).map(([F,ae])=>[parseInt(F),ae])),l=2,h=9,v=e.consecutiveHighScores||0;console.log(`[OrchestratorV2] Starting final review at cycle ${p} with ${v} consecutive high score(s) from previous session`);let S=[],R=[],x=e.qaAuditCompleted||!1;x&&console.log("[OrchestratorV2] QA audit already completed in previous session, skipping...");let w=[],O=e.successfullyCorrectedChapters||[],I=new Set(O);console.log(`[OrchestratorV2] Loaded ${I.size} successfully corrected chapters from database`);let _=async()=>{await b.updateProject(e.id,{successfullyCorrectedChapters:Array.from(I)})};for(;p<t;){if(!x){x=!0,this.callbacks.onAgentStatus("beta-reader","active","Ejecutando auditor\xEDa QA del manuscrito..."),console.log("[OrchestratorV2] Running QA audit before final review...");let Re=o.map(ie=>ie.content||""),ct=o.map((ie,ze)=>`Cap\xEDtulo ${ie.chapterNumber}: ${ie.title||"Sin t\xEDtulo"} - ${(ie.content||"").substring(0,500)}...`),rt=[],Nt=Math.ceil(Re.length/5),ht=Math.ceil(Re.length/10),vt=Nt+ht+1,Se=0;for(let ie=0;ie<Re.length;ie+=5){if(await this.shouldStopProcessing(e.id))return;let ze=Re.slice(ie,ie+5),He=o[ie]?.chapterNumber||ie+1,ve=o[Math.min(ie+4,o.length-1)]?.chapterNumber||ie+5;Se++,this.callbacks.onAgentStatus("beta-reader","active",`Auditor\xEDa continuidad caps ${He}-${ve} (${Se}/${vt})...`);try{let ge=this.geminiQAFlags?.continuitySentinel?{forceProvider:"gemini"}:void 0,ee=await this.continuitySentinel.auditContinuity(ze,He,ve,ge);if(ee.tokenUsage){this.addTokenUsage(ee.tokenUsage);let Le=this.geminiQAFlags?.continuitySentinel?"gemini-3-pro-preview":"deepseek-reasoner";await this.logAiUsage(e.id,"continuity-sentinel",Le,ee.tokenUsage)}rt.push({type:"continuity",result:ee,startChapter:He,endChapter:ve})}catch(ge){rt.push({type:"continuity",error:ge.message})}}for(let ie=0;ie<Re.length;ie+=10){if(await this.shouldStopProcessing(e.id))return;let ze=Re.slice(ie,ie+10),He=o[ie]?.chapterNumber||ie+1,ve=o[Math.min(ie+9,o.length-1)]?.chapterNumber||ie+10;Se++,this.callbacks.onAgentStatus("beta-reader","active",`Auditor\xEDa voz/ritmo caps ${He}-${ve} (${Se}/${vt})...`);try{let ge=await this.voiceRhythmAuditor.auditVoiceRhythm(ze,He,ve);rt.push({type:"voice",result:ge,startChapter:He,endChapter:ve})}catch(ge){rt.push({type:"voice",error:ge.message})}}if(await this.shouldStopProcessing(e.id))return;Se++,this.callbacks.onAgentStatus("beta-reader","active",`Auditor\xEDa repeticiones sem\xE1nticas (${Se}/${vt})...`);try{let ie=await this.semanticRepetitionDetector.detectRepetitions(ct,o.length);rt.push({type:"semantic",result:ie})}catch(ie){rt.push({type:"semantic",error:ie.message})}this.callbacks.onAgentStatus("beta-reader","active",`Auditor\xEDa QA completada (${vt} an\xE1lisis secuenciales).`);for(let ie of rt){if(ie.error){console.error(`[OrchestratorV2] QA ${ie.type} failed:`,ie.error);continue}if(ie.type==="continuity"&&ie.result?.erroresContinuidad){for(let ze of ie.result.erroresContinuidad)(ze.severidad==="critica"||ze.severidad==="mayor")&&R.push({source:"continuity_sentinel",tipo:ze.tipo,severidad:ze.severidad,capitulo:ze.capitulo,descripcion:ze.descripcion,correccion:ze.correccion,contexto:ze.contexto});ie.result.tokenUsage&&(this.addTokenUsage(ie.result.tokenUsage),await this.logAiUsage(e.id,"forensic-auditor","deepseek-chat",ie.result.tokenUsage))}if(ie.type==="voice"&&ie.result?.problemasTono){for(let ze of ie.result.problemasTono)ze.severidad==="mayor"&&R.push({source:"voice_rhythm_auditor",tipo:ze.tipo,severidad:ze.severidad,capitulos:ze.capitulos,descripcion:ze.descripcion,correccion:ze.correccion});ie.result.tokenUsage&&(this.addTokenUsage(ie.result.tokenUsage),await this.logAiUsage(e.id,"voice-rhythm-auditor","deepseek-chat",ie.result.tokenUsage))}if(ie.type==="semantic"&&ie.result?.repeticionesSemanticas){for(let ze of ie.result.repeticionesSemanticas)ze.severidad==="mayor"&&R.push({source:"semantic_repetition_detector",tipo:ze.tipo,severidad:ze.severidad,capitulos:ze.ocurrencias,descripcion:ze.descripcion,correccion:ze.accion});ie.result.tokenUsage&&(this.addTokenUsage(ie.result.tokenUsage),await this.logAiUsage(e.id,"semantic-repetition-detector","deepseek-chat",ie.result.tokenUsage))}}console.log(`[OrchestratorV2] QA audit complete: ${R.length} issues found from ${rt.length} audits`),this.callbacks.onAgentStatus("beta-reader","active","Ejecutando an\xE1lisis de viabilidad comercial...");try{let ie=o.map(ee=>ee.summary||`${ee.title||`Cap\xEDtulo ${ee.chapterNumber}`}: ${(ee.content||"").substring(0,300)}...`),ze=o[0]?.content||"",He=o[o.length-1]?.content||"";console.log("[OrchestratorV2] Running Beta Reader evaluation for commercial viability...");let ve=await this.betaReader.evaluateNovel(e.id,e.genre||"general",ie,ze.substring(0,15e3),He.substring(0,15e3));this.addTokenUsage(ve.tokenUsage),await this.logAiUsage(e.id,"beta-reader","deepseek-chat",ve.tokenUsage);let ge=ve.report;if(console.log(`[OrchestratorV2] Beta Reader: Score ${ge.score}/10, Viability: ${ge.viability}, Flagged chapters: ${ge.flagged_chapters?.length||0}`),ge.flagged_chapters&&ge.flagged_chapters.length>0){for(let ee of ge.flagged_chapters)(ee.severity==="HIGH"||ee.severity==="MEDIUM")&&R.push({source:"beta_reader",tipo:ee.issue_type,severidad:ee.severity==="HIGH"?"critica":"mayor",capitulo:ee.chapter_number,descripcion:`[Viabilidad Comercial] ${ee.issue_type.replace(/_/g," ")}: ${ee.specific_fix}`,correccion:ee.specific_fix});console.log(`[OrchestratorV2] Beta Reader added ${ge.flagged_chapters.filter(ee=>ee.severity==="HIGH"||ee.severity==="MEDIUM").length} issues for correction`)}await b.updateProject(e.id,{betaReaderReport:ge,betaReaderScore:ge.score}),this.callbacks.onAgentStatus("beta-reader","active",`Beta Reader: ${ge.score}/10 (${ge.viability}). ${ge.flagged_chapters?.length||0} cap\xEDtulos marcados.`)}catch(ie){console.error("[OrchestratorV2] Beta Reader evaluation failed:",ie)}let Tt={findings:R.map(ie=>({source:ie.source,chapter:ie.capitulo||null,chapters:ie.capitulos||null,severity:ie.severidad||"mayor",description:ie.descripcion||"",correction:ie.correccion||""})),corrections:[],totalFindings:R.length,successCount:0,failCount:0,auditedAt:new Date().toISOString()};if(R.length>0){let ie=`[INFORME AUDITOR\xCDA QA - PRE-CORRECCI\xD3N]
`;ie+=`Total problemas detectados: ${R.length}

`;let ze=new Map;for(let He of R)ze.has(He.source)||ze.set(He.source,[]),ze.get(He.source).push(He);for(let[He,ve]of Array.from(ze)){ie+=`[${He.toUpperCase()}] - ${ve.length} problema(s):
`;for(let ge of ve){let ee=ge.capitulo?`Cap ${ge.capitulo}`:ge.capitulos?.length?`Caps ${ge.capitulos.join(",")}`:"General";ie+=`  \u2022 [${ge.severidad?.toUpperCase()||"MAYOR"}] ${ee}: ${ge.descripcion?.substring(0,100)}...
`}ie+=`
`}await b.createActivityLog({projectId:e.id,level:"info",agentRole:"qa-audit",message:ie}),console.log(`[OrchestratorV2] QA audit findings logged:
${ie}`),this.callbacks.onAgentStatus("beta-reader","active",`Auditor\xEDa completa: ${R.length} problemas detectados. Corrigiendo antes de revisi\xF3n...`)}else await b.updateProject(e.id,{qaAuditReport:Tt}),await b.createActivityLog({projectId:e.id,level:"success",agentRole:"qa-audit",message:`[INFORME AUDITOR\xCDA QA]
No se detectaron problemas cr\xEDticos ni mayores. El manuscrito est\xE1 listo para revisi\xF3n final.`}),this.callbacks.onAgentStatus("beta-reader","active","Auditor\xEDa completa. Sin problemas cr\xEDticos. Iniciando revisi\xF3n final...");let ue=await b.getProject(e.id);A=ue?.resolvedIssueHashes||[];let Pe=[...R],ye=ue?.finalReviewResult?.issues||[],be=this.filterNewIssues(ye,A);w=be.newIssues;let Ue=be.filteredCount;if(Ue>0&&console.log(`[OrchestratorV2] Filtered ${Ue} already-resolved issues from previous cycle`),w.length>0){console.log(`[OrchestratorV2] Adding ${w.length} unresolved issues from previous FinalReviewer cycle`);for(let ie of w)for(let ze of ie.capitulos_afectados||[]){let He=this.normalizeToDbChapterNumber(ze),ve=d.get(He)||0;if(ve>=T){console.log(`[OrchestratorV2] Skipping chapter ${He}: already corrected ${ve} times (max: ${T})`);continue}Pe.push({source:"final-reviewer",tipo:ie.categoria||"general",capitulo:He,severidad:ie.severidad||"mayor",descripcion:ie.descripcion||"",instrucciones:ie.instrucciones_correccion||"",categoria:ie.categoria||"general"})}}if(Pe.length>0){console.log(`[OrchestratorV2] PRE-REVIEW CORRECTION: Fixing ${Pe.length} combined issues (${R.length} QA + ${w.length} FinalReviewer) before new review`);let ie=new Map;for(let he of Pe){let at=he.capitulo||(he.capitulos?he.capitulos[0]:null);at&&(ie.has(at)||ie.set(at,[]),ie.get(at).push(he))}let ze=Array.from(ie.keys()).sort((he,at)=>he-at),He=0,ve=0,ge=ze.filter(he=>{if(I.has(he))return console.log(`[OrchestratorV2] Skipping chapter ${he} in pre-review: already successfully corrected`),ve++,!1;let at=d.get(he)||0;return at>=T?(console.log(`[OrchestratorV2] Skipping chapter ${he} in pre-review: already corrected ${at} times (max: ${T})`),He++,!1):!0});(ve>0||He>0)&&(console.log(`[OrchestratorV2] Pre-review filtering: ${ve} already corrected, ${He} at limit, ${ge.length} remaining`),await b.createActivityLog({projectId:e.id,level:"info",message:`[FILTRADO] ${ve} caps ya corregidos, ${He} al limite, ${ge.length} pendientes`,agentRole:"orchestrator"})),console.log(`[OrchestratorV2] Pre-review: ${ge.length} chapters to correct: ${ge.join(", ")}`);let ee={},Le={critica:0,mayor:0,menor:0};for(let he of Pe){let at=he.categoria||he.source||"otros";ee[at]=(ee[at]||0)+1;let Ct=(he.severidad||"mayor").toLowerCase();Ct.includes("crit")?Le.critica++:Ct.includes("may")||Ct.includes("major")?Le.mayor++:Le.menor++}let Ze=Object.entries(ee).sort((he,at)=>at[1]-he[1]).slice(0,4).map(([he,at])=>`${he}(${at})`).join(", ");await b.createActivityLog({projectId:e.id,level:"info",message:`[CICLO] ${ge.length} caps con ${Pe.length} problemas | Criticos: ${Le.critica}, Mayores: ${Le.mayor}, Menores: ${Le.menor} | Categorias: ${Ze}`,agentRole:"orchestrator"}),this.callbacks.onChaptersBeingCorrected&&this.callbacks.onChaptersBeingCorrected(ge,0);let De=0,nt=[];for(let he of ge){if(await this.shouldStopProcessing(e.id)){await this.updateProjectTokens(e.id),await b.updateProject(e.id,{status:"paused"});return}let at=this.findChapterByNumber(o,he);if(!at||!at.content){console.log(`[OrchestratorV2] Chapter ${he} not found in completedChapters, skipping`);continue}let Ct=ie.get(he)||[];if(Ct.length===0)continue;let gt=Ct.some(Fe=>{let et=(Fe.severidad||"").toLowerCase();return et==="critica"||et==="cr\xEDtica"||et==="mayor"||et==="critical"||et==="major"});console.log(`[OrchestratorV2] Pre-review Chapter ${he}: ${Ct.length} issues, hasCriticalOrMajor=${gt}, severities=[${Ct.map(Fe=>Fe.severidad).join(", ")}]`);let zn=Ct.slice(0,3).map(Fe=>{let et=Fe.categoria||Fe.source||"error",Or=(Fe.severidad||"mayor").toLowerCase(),go=(Fe.descripcion||"").substring(0,80);return`[${Or.toUpperCase()}] ${et}: ${go}${go.length>=80?"...":""}`}).join(" | ");await b.createActivityLog({projectId:e.id,level:gt?"warn":"info",message:`[CORRECCION] Cap ${he} (${Ct.length} problemas): ${zn}`,agentRole:"smart-editor"});let oa=Ct.map(Fe=>{let et=`- [${Fe.severidad?.toUpperCase()||"MAYOR"}] ${Fe.source}: ${Fe.descripcion}`;return Fe.contexto&&(et+=`
  \u{1F4CD} TEXTO PROBLEM\xC1TICO: "${Fe.contexto}"`),et+=`
  \u270F\uFE0F Correcci\xF3n: ${Fe.correccion||Fe.instrucciones||"Corregir seg\xFAn descripci\xF3n"}`,et}).join(`

`),st={projectTitle:e.title,genre:e.genre,chapterNumber:he,chapterTitle:at.title,previousChapterSummary:o.find(Fe=>Fe.chapterNumber===he-1)?.summary||"",nextChapterSummary:o.find(Fe=>Fe.chapterNumber===he+1)?.summary||"",mainCharacters:(c.characters||[]).slice(0,10).map(Fe=>({name:Fe.name,description:Fe.description||Fe.role||"",relationships:Fe.relationships||[],physicalTraits:Fe.physicalTraits||Fe.physical_traits||"",personality:Fe.personality||""})),worldRules:(c.worldRules||c.rules||[]).slice(0,10),locations:(c.locations||c.settings||c.plotOutline?.settings||[]).slice(0,8).map(Fe=>({name:Fe.name,description:Fe.description||Fe.atmosphere||""})),timelineEvents:(c.timeline||[]).filter(Fe=>Fe.chapter===he||Fe.chapter===he-1||Fe.chapter===he+1).slice(0,5),plotDecisions:(c.plotDecisions||[]).slice(-10),persistentInjuries:(c.persistentInjuries||[]).slice(0,8),styleGuide:e.architectInstructions?.substring(0,1e3)||""};console.log(`[OrchestratorV2] Pre-review fixing Chapter ${he}: ${Ct.length} issues (critical/major: ${gt})`),this.callbacks.onAgentStatus("smart-editor","active",`Corrigiendo cap\xEDtulo ${he} (reescritura, ${Ct.length} problemas)...`);try{let Fe=null;if(gt){console.log(`[OrchestratorV2] FULL REWRITE for Chapter ${he} (critical/major issues detected)`);let Mt=`PERSONAJES PRINCIPALES:
`;for(let Ke of st.mainCharacters)Mt+=`- ${Ke.name}: ${Ke.description}`,Ke.physicalTraits&&(Mt+=` | F\xEDsico: ${Ke.physicalTraits}`),Ke.relationships?.length&&(Mt+=` | Relaciones: ${Ke.relationships.join(", ")}`),Mt+=`
`;let Dt="";st.locations.length>0&&(Dt=`
UBICACIONES:
`+st.locations.map(Ke=>`- ${Ke.name}: ${Ke.description}`).join(`
`));let pr="";st.worldRules.length>0&&(pr=`
REGLAS DEL MUNDO:
`+st.worldRules.map(Ke=>`- ${typeof Ke=="string"?Ke:Ke.rule||Ke.description||JSON.stringify(Ke)}`).join(`
`));let Oa="";st.persistentInjuries.length>0&&(Oa=`
\u26A0\uFE0F LESIONES PERSISTENTES ACTIVAS (OBLIGATORIO RESPETAR):
`+st.persistentInjuries.map(Ke=>{let Rb=Ke.character||Ke.personaje,yo=Ke.tipo_lesion||Ke.injury||Ke.lesion||Ke.description,Wm=Ke.parte_afectada?` (${Ke.parte_afectada})`:"",Qm=Ke.efecto_esperado?` \u2192 ${Ke.efecto_esperado}`:"",Na=Ke.capitulo_ocurre?` [desde Cap ${Ke.capitulo_ocurre}]`:"";return`- ${Rb}: ${yo}${Wm}${Na}${Qm}`}).join(`
`));let hi="";st.plotDecisions.length>0&&(hi=`
DECISIONES DE TRAMA ANTERIORES:
`+st.plotDecisions.map(Ke=>`- Cap ${Ke.chapter||Ke.capitulo_establecido||Ke.capitulo}: ${Ke.decision||Ke.descripcion}`).join(`
`));let Cn="";st.timelineEvents.length>0&&(Cn=`
EVENTOS CRONOL\xD3GICOS RELEVANTES:
`+st.timelineEvents.map(Ke=>`- ${Ke.event||Ke.evento}: ${Ke.timeMarker||Ke.when||""}`).join(`
`));let Jr=`CONTEXTO PARA CORRECCI\xD3N:
- Proyecto: "${st.projectTitle}" (${st.genre})
- Cap\xEDtulo ${st.chapterNumber}: "${st.chapterTitle}"
${st.previousChapterSummary?`- Cap\xEDtulo anterior: ${st.previousChapterSummary}`:""}
${st.nextChapterSummary?`- Cap\xEDtulo siguiente: ${st.nextChapterSummary}`:""}

${Mt}
${Dt}
${pr}
${Oa}
${hi}
${Cn}

${st.styleGuide?`GU\xCDA DE ESTILO:
${st.styleGuide}
`:""}

PROBLEMAS A CORREGIR (OBLIGATORIO):
${oa}`,Ns=await this.buildConsistencyContextForCorrection(e.id,he,c,e);console.log(`[OrchestratorV2] Critical/major issues for Chapter ${he}, trying SURGICAL FIX first`);let ia=await this.smartEditor.surgicalFix({chapterContent:at.content,errorDescription:Jr,consistencyConstraints:Ns||JSON.stringify(st.mainCharacters)});if(this.addTokenUsage(ia.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",ia.tokenUsage,he),console.log(`[OrchestratorV2] surgicalFix result for critical issues Chapter ${he}: patches=${ia.patches?.length||0}`),ia.patches&&ia.patches.length>0){let Ke=Wr(at.content,ia.patches);Ke.success&&Ke.patchedText&&Ke.patchedText!==at.content&&(Fe=Ke.patchedText,console.log(`[OrchestratorV2] Surgical fix applied ${Ke.appliedPatches}/${ia.patches.length} patches for Chapter ${he}`),await b.createActivityLog({projectId:e.id,level:"info",message:`[QUIRURGICO] Cap ${he}: ${Ke.appliedPatches} parches aplicados para ${Ct.length} problemas criticos/mayores`,agentRole:"smart-editor"}))}if(!Fe){console.warn(`[OrchestratorV2] Surgical fix failed for Chapter ${he}, falling back to fullRewrite as LAST RESORT`),await b.createActivityLog({projectId:e.id,level:"warn",message:`[FALLBACK] Cap ${he}: Parches fallaron, usando reescritura como ultimo recurso`,agentRole:"smart-editor"});let Ke=await this.smartEditor.fullRewrite({chapterContent:at.content,errorDescription:Jr,consistencyConstraints:Ns||JSON.stringify(st.mainCharacters)});this.addTokenUsage(Ke.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Ke.tokenUsage,he),console.log(`[OrchestratorV2] fullRewrite result for Chapter ${he}: error=${Ke.error||"none"}, rewrittenContent=${Ke.rewrittenContent?.length||0} chars`),Ke.rewrittenContent&&Ke.rewrittenContent.length>100?(Fe=Ke.rewrittenContent,console.log(`[OrchestratorV2] Full rewrite successful for Chapter ${he}: ${Fe.length} chars`)):Ke.content&&Ke.content.length>100?(Fe=Ke.content,console.log(`[OrchestratorV2] Full rewrite fallback for Chapter ${he}: ${Fe.length} chars`)):console.warn(`[OrchestratorV2] Full rewrite FAILED for Chapter ${he} - no valid content returned`)}}else{console.log(`[OrchestratorV2] Minor issues for Chapter ${he}, using SURGICAL FIX (patches only)`);let Mt=await this.buildConsistencyContextForCorrection(e.id,he,c,e),Dt=await this.smartEditor.surgicalFix({chapterContent:at.content,errorDescription:oa,consistencyConstraints:Mt});if(this.addTokenUsage(Dt.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Dt.tokenUsage,he),console.log(`[OrchestratorV2] surgicalFix result for minor issues Chapter ${he}: patches=${Dt.patches?.length||0}`),Dt.patches&&Dt.patches.length>0){let pr=Wr(at.content,Dt.patches);pr.success&&pr.patchedText&&pr.patchedText!==at.content?(Fe=pr.patchedText,console.log(`[OrchestratorV2] Surgical fix applied ${pr.appliedPatches}/${Dt.patches.length} patches for Chapter ${he}`),await b.createActivityLog({projectId:e.id,level:"info",message:`[QUIRURGICO] Cap ${he}: ${pr.appliedPatches} parches aplicados, ${Dt.patches.length-pr.appliedPatches} omitidos`,agentRole:"smart-editor"})):console.warn(`[OrchestratorV2] Surgical fix patches failed to apply for Chapter ${he}`)}else console.warn(`[OrchestratorV2] Surgical fix returned no patches for Chapter ${he}`)}let et=Array.from(new Set(Ct.map(Mt=>Mt.source))),Or=Mt=>Mt.replace(/\s+/g," ").trim().toLowerCase(),go=Or(at.content),kr=async(Mt,Dt)=>{let pr=Mt.split(/\s+/).length;await b.updateChapter(at.id,{content:Mt,status:"completed",wordCount:pr}),De++,nt.push({chapter:he,issueCount:Ct.length,sources:et,success:!0}),I.add(he),await _(),console.log(`[OrchestratorV2] Pre-review: Chapter ${he} corrected via ${Dt} (${pr} words) - marked as done & persisted`),await b.createActivityLog({projectId:e.id,level:"info",agentRole:"smart-editor",message:`Capitulo ${he} corregido (${pr} palabras)`}),this.callbacks.onChapterComplete(he,pr,at.title||`Cap\xEDtulo ${he}`);try{await this.updateWorldBibleFromChapter(e.id,he,Mt,Ct)}catch(Oa){console.error(`[OrchestratorV2] Failed to update World Bible after Chapter ${he} rewrite:`,Oa)}},Hn=Mt=>!(!Mt||Mt.length<100||Or(Mt)===go);if(Hn(Fe))await kr(Fe,"fullRewrite");else{console.log(`[OrchestratorV2] Pre-review: Chapter ${he} fullRewrite failed (empty or unchanged), trying surgicalFix...`);let Mt=!1;try{let Dt=await this.smartEditor.surgicalFix({chapterContent:at.content,errorDescription:oa});if(this.addTokenUsage(Dt.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Dt.tokenUsage,he),Dt.patches&&Dt.patches.length>0){let pr=Wr(at.content,Dt.patches);Hn(pr.patchedText)&&(await kr(pr.patchedText,"surgicalFix"),Mt=!0)}}catch(Dt){console.error(`[OrchestratorV2] Pre-review surgicalFix failed for Chapter ${he}:`,Dt)}if(!Mt){console.log(`[OrchestratorV2] Pre-review: Chapter ${he} surgicalFix failed, final fullRewrite attempt with full context...`);try{let Dt=await this.smartEditor.fullRewrite({chapterContent:at.content,errorDescription:`CORRIGE ESTOS PROBLEMAS (OBLIGATORIO):
${oa}

Reescribe el cap\xEDtulo corrigiendo TODOS los problemas. El resultado DEBE ser diferente del original.`,worldBible:{characters:st.mainCharacters,locations:st.locations,worldRules:st.worldRules,persistentInjuries:st.persistentInjuries,plotDecisions:st.plotDecisions},chapterNumber:he,chapterTitle:at.title||void 0,previousChapterSummary:st.previousChapterSummary,nextChapterSummary:st.nextChapterSummary,styleGuide:st.styleGuide,projectTitle:e.title,genre:e.genre||void 0});this.addTokenUsage(Dt.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Dt.tokenUsage,he);let pr=Dt.rewrittenContent||Dt.content;Hn(pr)&&(await kr(pr,"fullRewrite-retry"),Mt=!0)}catch(Dt){console.error(`[OrchestratorV2] Pre-review final retry failed for Chapter ${he}:`,Dt)}}if(!Mt){console.log(`[OrchestratorV2] Pre-review: Chapter ${he} standard attempts failed, trying ESCALATED correction...`);try{let Dt=`CORRECCI\xD3N ESCALADA - \xDALTIMA OPORTUNIDAD

Este cap\xEDtulo tiene errores que DEBEN corregirse. Los intentos anteriores fallaron.

ERRORES ESPEC\xCDFICOS A CORREGIR:
${Ct.map(Cn=>{let Jr=`[${Cn.severidad?.toUpperCase()||"ERROR"}] ${Cn.descripcion}`;return Cn.contexto&&(Jr+=`
   TEXTO PROBLEM\xC1TICO: "${Cn.contexto.substring(0,200)}"`),Jr}).join(`

`)}

INSTRUCCIONES OBLIGATORIAS:
1. Busca EXACTAMENTE los textos problem\xE1ticos citados arriba
2. Reescr\xEDbelos para eliminar el error
3. Mant\xE9n el estilo y tono del resto del cap\xEDtulo
4. El resultado DEBE ser diferente del original

Si el error es de conocimiento imposible (personaje sabe algo que no deber\xEDa):
- ELIMINA la referencia al conocimiento
- O a\xF1ade una explicaci\xF3n de C\xD3MO lo supo

Si el error es de transici\xF3n confusa:
- A\xF1ade una frase de transici\xF3n que explique el cambio de lugar/tiempo

Si el error es de inconsistencia f\xEDsica/edad:
- Corrige el dato para que coincida con lo establecido`,pr=await this.buildConsistencyContextForCorrection(e.id,he,c,e),Oa=await this.smartEditor.fullRewrite({chapterContent:at.content,errorDescription:Dt,consistencyConstraints:pr,worldBible:{characters:st.mainCharacters,locations:st.locations,worldRules:st.worldRules,persistentInjuries:st.persistentInjuries,plotDecisions:st.plotDecisions},chapterNumber:he,chapterTitle:at.title||void 0,previousChapterSummary:st.previousChapterSummary,nextChapterSummary:st.nextChapterSummary,styleGuide:st.styleGuide,projectTitle:e.title,genre:e.genre||void 0});this.addTokenUsage(Oa.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Oa.tokenUsage,he);let hi=Oa.rewrittenContent||Oa.content;Hn(hi)&&(await kr(hi,"escalated-fix"),Mt=!0,console.log(`[OrchestratorV2] Pre-review: Chapter ${he} ESCALATED correction succeeded!`))}catch(Dt){console.error(`[OrchestratorV2] Pre-review escalated fix failed for Chapter ${he}:`,Dt)}}Mt||(nt.push({chapter:he,issueCount:Ct.length,sources:et,success:!1}),console.warn(`[OrchestratorV2] Pre-review: Chapter ${he} ALL correction attempts failed (including escalated)`))}}catch(Fe){let et=Array.from(new Set(Ct.map(Or=>Or.source)));nt.push({chapter:he,issueCount:Ct.length,sources:et,success:!1}),console.error(`[OrchestratorV2] Pre-review fix failed for Chapter ${he}:`,Fe)}}console.log(`[OrchestratorV2] PRE-REVIEW CORRECTION complete: ${De}/${ge.length} chapters corrected`),this.callbacks.onAgentStatus("beta-reader","active",`Pre-correcci\xF3n: ${De} cap\xEDtulos arreglados. Iniciando revisi\xF3n final...`);let St=nt.filter(he=>he.success).map(he=>he.chapter);if(St.length>0){for(let Ct of St){let gt=d.get(Ct)||0;d.set(Ct,gt+1)}await b.updateProject(e.id,{chapterCorrectionCounts:Object.fromEntries(d)}),console.log(`[OrchestratorV2] Updated chapter correction counts for chapters: ${St.join(", ")}`);let he=w.filter(Ct=>(Ct.capitulos_afectados||[]).map(zn=>this.normalizeToDbChapterNumber(zn)).some(zn=>St.includes(zn)));he.length>0&&await this.markIssuesResolved(e.id,he);let at=R.length;R=R.filter(Ct=>{let gt=Ct.capitulo||(Ct.capitulos?Ct.capitulos[0]:null);return gt?!St.includes(gt):!0}),console.log(`[OrchestratorV2] Removed ${at-R.length} fixed issues from qaIssues (${R.length} remaining)`)}let Rr=nt.filter(he=>he.success),_t=nt.filter(he=>!he.success),Vt=`[INFORME PRE-CORRECCI\xD3N QA]
`;if(Vt+=`Total issues detectados: ${R.length+nt.reduce((he,at)=>he+at.issueCount,0)}
`,Vt+=`Cap\xEDtulos procesados: ${ge.length}
`,Vt+=`Correcciones exitosas: ${Rr.length}
`,Vt+=`Correcciones fallidas: ${_t.length}

`,Rr.length>0){Vt+=`ARREGLOS REALIZADOS:
`;for(let he of Rr)Vt+=`  \u2713 Cap\xEDtulo ${he.chapter}: ${he.issueCount} problema(s) corregido(s) [${he.sources.join(", ")}]
`}if(_t.length>0){Vt+=`
ARREGLOS FALLIDOS:
`;for(let he of _t)Vt+=`  \u2717 Cap\xEDtulo ${he.chapter}: ${he.issueCount} problema(s) NO corregido(s) [${he.sources.join(", ")}]
`}await b.createActivityLog({projectId:e.id,level:_t.length>0?"warn":"success",agentRole:"qa-audit",message:Vt}),console.log(`[OrchestratorV2] Pre-review report logged:
${Vt}`),Tt.corrections=nt,Tt.successCount=Rr.length,Tt.failCount=_t.length,await b.updateProject(e.id,{qaAuditReport:Tt}),console.log(`[OrchestratorV2] QA audit report saved to project: ${Tt.totalFindings} findings, ${Tt.successCount} fixed, ${Tt.failCount} failed`),R.length=0,o=(await b.getChaptersByProject(e.id)).filter(he=>he.status==="completed"||he.status==="approved").sort((he,at)=>he.chapterNumber-at.chapterNumber)}}if(p++,await b.updateProject(e.id,{revisionCycle:p,qaAuditCompleted:!0}),console.log(`[OrchestratorV2] Final review cycle ${p}/${t} (persisted to DB)`),f.length>0&&console.log(`[OrchestratorV2] Passing ${f.length} previously corrected issues to FinalReviewer`),await this.shouldStopProcessing(e.id)){console.log(`[OrchestratorV2] Final review cancelled for project ${e.id}`),await this.updateProjectTokens(e.id),await b.updateProject(e.id,{status:"paused"});return}let ae=(await b.getChaptersByProject(e.id)).filter(Re=>Re.status==="completed"||Re.status==="approved").sort((Re,ct)=>Re.chapterNumber-ct.chapterNumber),D=ae.map(Re=>({numero:Re.chapterNumber,titulo:Re.title||`Cap\xEDtulo ${Re.chapterNumber}`,contenido:Re.content||""}));this.callbacks.onAgentStatus("final-reviewer","active",`Analizando manuscrito completo (ciclo ${p})...`);let W=c?.threeActStructure||c?.three_act_structure;console.log(W?`[OrchestratorV2] Using 3-act structure for review: Act1=${W.act1?.chapters?.length||0} caps, Act2=${W.act2?.chapters?.length||0} caps, Act3=${W.act3?.chapters?.length||0} caps`:"[OrchestratorV2] No 3-act structure found in World Bible, using fixed-size tranches");let ne=await this.finalReviewer.execute({projectTitle:e.title,chapters:D,worldBible:c,guiaEstilo:u,pasadaNumero:p,issuesPreviosCorregidos:f.length>0?f:void 0,puntuacionPasadaAnterior:g,threeActStructure:W,onTrancheProgress:(Re,ct,rt)=>{this.callbacks.onAgentStatus("final-reviewer","active",`Revisando ${rt}...`),console.log(`[OrchestratorV2] FinalReviewer progress: ${Re}/${ct} - ${rt}`)}},{forceProvider:"gemini"}),le="gemini-3-pro-preview";if(this.addTokenUsage(ne.tokenUsage),await this.logAiUsage(e.id,"final-reviewer",le,ne.tokenUsage),!ne.result){console.error("[OrchestratorV2] FinalReviewer failed to parse result"),this.callbacks.onError("Error al analizar el manuscrito - presiona Continuar para reintentar"),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:`FinalReviewer no pudo parsear respuesta (ciclo ${p}). Presiona "Continuar" para reintentar.`,agentRole:"final-reviewer",metadata:{cycle:p,recoverable:!0}});return}m=ne.result;let{veredicto:oe,puntuacion_global:ce,issues:se,capitulos_para_reescribir:Y}=m;if(se&&se.length>0){let Re=se.filter(ct=>this.isMergeRequest(ct)).length;Re>0&&(console.log(`[OrchestratorV2] Found ${Re} merge request(s) - REINTERPRETING as condensation`),se=this.reinterpretMergeAsCondensation(se),m.issues=se,await b.createActivityLog({projectId:e.id,level:"info",message:`Se reinterpretaron ${Re} sugerencia(s) de "fusionar cap\xEDtulos" como "condensaci\xF3n agresiva" (la fusi\xF3n autom\xE1tica no es posible)`,agentRole:"orchestrator"}))}if(console.log(`[OrchestratorV2] Review result: ${oe}, score: ${ce}, chapters to rewrite: ${Y?.length||0}, issues: ${se?.length||0}`),Y&&Y.length>0){let Re=[];for(let ct of Y)I.has(ct)&&(I.delete(ct),Re.push(ct));Re.length>0&&(await _(),console.log(`[OrchestratorV2] FinalReviewer re-reported ${Re.length} previously "corrected" chapters: ${Re.join(", ")} - unmarked for re-correction`),await b.createActivityLog({projectId:e.id,level:"warn",message:`[RE-REPORTE] ${Re.length} caps previamente corregidos tienen nuevos problemas: ${Re.join(", ")}`,agentRole:"final-reviewer"}))}let Ie=g!==void 0&&ce<g,Je=g!==void 0&&g-ce>=2,xe=!1;if(Ie)if(console.warn(`[OrchestratorV2] \u26A0\uFE0F SCORE REGRESSION: Score dropped from ${g} to ${ce} in cycle ${p}`),Je&&y.length>0){console.warn(`[OrchestratorV2] \u{1F504} ROLLBACK: Restoring ${y.length} chapters to pre-correction state (score dropped by ${g-ce} points)`),this.callbacks.onAgentStatus("orchestrator","warning",`Regresi\xF3n detectada. Restaurando ${y.length} cap\xEDtulos...`);let Re=await b.getChaptersByProject(e.id),ct=0;for(let rt of y){let Nt=Re.find(ht=>ht.chapterNumber===rt.chapterNumber);Nt&&Nt.content!==rt.content&&(await b.updateChapter(Nt.id,{content:rt.content}),ct++)}await b.createActivityLog({projectId:e.id,level:"warn",message:`\u{1F504} ROLLBACK: Puntuaci\xF3n baj\xF3 de ${g} a ${ce} en ciclo ${p}. Restaurados ${ct} cap\xEDtulos a versi\xF3n anterior. Las correcciones introdujeron nuevos errores.`,agentRole:"orchestrator"}),y=[],xe=!0,Y=[]}else await b.createActivityLog({projectId:e.id,level:"warn",message:`Puntuaci\xF3n baj\xF3 de ${g} a ${ce} en ciclo ${p}. Esto puede indicar inconsistencia del revisor o regresiones introducidas por las correcciones.`,agentRole:"final-reviewer"});ce>=C&&(C=ce),g=ce;let xt={...m,revisionCycle:p,evaluatedAt:new Date().toISOString()};if(await b.updateProject(e.id,{finalReviewResult:xt,finalScore:ce,revisionCycle:p}),await b.createActivityLog({projectId:e.id,level:ce>=h?"success":"info",agentRole:"final-reviewer",message:`[Ciclo ${p}] Puntuaci\xF3n: ${ce}/10 | Veredicto: ${oe} | Issues: ${se?.length||0} | Cap\xEDtulos a corregir: ${Y?.length||0}`}),console.log(`[OrchestratorV2] Cycle ${p} report persisted: ${ce}/10, ${se?.length||0} issues`),se&&se.length>0&&p>=2){let{resolvedIssues:Re,remainingIssues:ct}=await this.autoResolveStructuralIssues(e.id,se,d);if(Re.length>0&&(console.log(`[OrchestratorV2] Auto-resolved ${Re.length} structural issues that cannot be fixed by rewriting`),se=ct,m.issues=se,Y&&Y.length>0)){let rt=new Set(Re.flatMap(vt=>(vt.capitulos_afectados||[]).map(Se=>this.normalizeToDbChapterNumber(Se)))),Nt=ct.flatMap(vt=>(vt.capitulos_afectados||[]).map(Se=>this.normalizeToDbChapterNumber(Se))),ht=new Set(Nt);Y=Y.filter(vt=>!rt.has(vt)||ht.has(vt)),m.capitulos_para_reescribir=Y,console.log(`[OrchestratorV2] Updated chapters to rewrite: ${Y.length} (after structural issue removal)`)}}if(se&&se.length>0&&p>=3){let{persistentIssues:Re}=await this.trackPersistentIssues(e.id,se,p);if(Re.length>0){console.log(`[OrchestratorV2] LOOP ESCALATION: ${Re.length} issues have persisted 3+ cycles`),await b.createActivityLog({projectId:e.id,level:"error",agentRole:"final-reviewer",message:`Problemas detectados: ${Re.filter(rt=>rt.severidad==="critica").length} cr\xEDticos, ${Re.filter(rt=>rt.severidad==="mayor").length} mayores. ${Re.map(rt=>`[${rt.severidad?.toUpperCase()||"MAYOR"}] Cap ${rt.capitulos_afectados?.join(", ")}: ${rt.descripcion?.substring(0,100)}`).join(" | ")}`});let ct=ae.map(rt=>({chapterNumber:rt.chapterNumber,title:rt.title||"",content:rt.content||""}));for(let rt of Re){let Nt=this.generateEscalatedCorrection(rt,ct);rt.instrucciones_correccion=Nt.instruction,rt.capitulos_afectados=Nt.affectedChapters;for(let ht of Nt.affectedChapters)Y?.includes(ht)||(Y=Y||[],Y.push(ht))}m.capitulos_para_reescribir=Y,m.issues=se,await b.updateProject(e.id,{finalReviewResult:{...m,revisionCycle:p,evaluatedAt:new Date().toISOString(),escalatedAt:new Date().toISOString()}}),console.log(`[OrchestratorV2] Escalated correction: ${Y?.length||0} chapters to rewrite (persisted)`)}}if((!Y||Y.length===0)&&se&&se.length>0){let Re=[];for(let ct of se)ct.capitulos_afectados?.length>0&&ct.instrucciones_correccion&&Re.push(...ct.capitulos_afectados.map(rt=>this.normalizeToDbChapterNumber(rt)));if(Re.length>0)Y=Array.from(new Set(Re)),m.capitulos_para_reescribir=Y,console.log(`[OrchestratorV2] SAFETY NET: Extracted ${Y.length} chapters from ${se.length} issues with correction instructions: ${Y.join(", ")}`);else{for(let ct of se)ct.capitulos_afectados?.length>0&&Re.push(...ct.capitulos_afectados.map(rt=>this.normalizeToDbChapterNumber(rt)));Re.length>0&&(Y=Array.from(new Set(Re)),m.capitulos_para_reescribir=Y,console.log(`[OrchestratorV2] LAST RESORT: Extracted ${Y.length} chapters from ALL issues: ${Y.join(", ")}`))}}if(S.push(ce),p===1&&R.length>0){console.log(`[OrchestratorV2] Consolidating ${R.length} QA issues with FinalReviewer results`),se=se??[],Y=Y??[];for(let Re of R){let ct=Re.capitulo?[Re.capitulo]:Re.capitulos||[];if(ct.length>0){for(let rt of ct)Y.includes(rt)||Y.push(rt);se.push({categoria:"otro",severidad:Re.severidad==="critica"?"critica":"mayor",descripcion:`[QA:${Re.source}] ${Re.descripcion}`,capitulos_afectados:ct,elementos_a_preservar:"",instrucciones_correccion:Re.correccion||`Corregir: ${Re.descripcion}`})}}console.log(`[OrchestratorV2] After QA merge: ${se.length} total issues, ${Y.length} chapters to rewrite`),R=[]}let Sr=(se?.length||0)>0||(Y?.length||0)>0;if(ce>=h&&!Sr){if(v++,await b.updateProject(e.id,{consecutiveHighScores:v}),console.log(`[OrchestratorV2] Score ${ce}/10 with NO issues. Consecutive high scores: ${v}/${l} (persisted)`),v>=l){let Re=S.slice(-l).join(", ");console.log(`[OrchestratorV2] APPROVED: ${l} consecutive scores \u2265${h}: [${Re}]`),this.callbacks.onAgentStatus("final-reviewer","completed",`Manuscrito APROBADO. Puntuaciones consecutivas: ${Re}/10.`);break}this.callbacks.onAgentStatus("final-reviewer","active",`Puntuaci\xF3n ${ce}/10. Necesita ${l-v} evaluaci\xF3n(es) m\xE1s para confirmar.`);continue}else ce>=h&&Sr?console.log(`[OrchestratorV2] Score ${ce}/10 is good but ${se?.length||0} issue(s) remain. Correcting before counting...`):(v=0,await b.updateProject(e.id,{consecutiveHighScores:0}),console.log(`[OrchestratorV2] Score ${ce}/10 < ${h}. Consecutive high scores reset to 0 (persisted).`));if((Y?.length||0)===0){se&&se.length>0&&(console.log(`[OrchestratorV2] Score ${ce}/10 with ${se.length} issues but no actionable chapter references. Issues: ${se.map(Re=>Re.categoria).join(", ")}`),await b.createActivityLog({projectId:e.id,level:"warn",message:`FinalReviewer detect\xF3 ${se.length} problemas pero sin referencias de cap\xEDtulos accionables. Requiere revisi\xF3n del prompt.`,agentRole:"final-reviewer"})),console.log(`[OrchestratorV2] Score ${ce} < 9 but no chapters to rewrite. Continuing to next cycle...`);continue}if(Y&&Y.length>0){let Re=Y.length;if(Y=Y.filter(ue=>I.has(ue)?(console.log(`[OrchestratorV2] Skipping chapter ${ue} in post-review: already successfully corrected`),!1):!0),Y.length<Re){let ue=Re-Y.length;console.log(`[OrchestratorV2] Post-review: Filtered ${ue} already-corrected chapters, ${Y.length} remaining`),await b.createActivityLog({projectId:e.id,level:"info",message:`[FILTRADO] ${ue} caps ya corregidos, ${Y.length} pendientes`,agentRole:"orchestrator"})}if(Y.length===0){console.log("[OrchestratorV2] All chapters already corrected, continuing to next cycle");continue}console.log(`[OrchestratorV2] Starting auto-correction for ${Y.length} chapters`),this.callbacks.onAgentStatus("smart-editor","active",`Auto-corrigiendo ${Y.length} cap\xEDtulo(s)...`);let ct=new Map,rt=se??[];for(let ue of rt){let Pe=ue.capitulos_afectados||[];for(let qt of Pe){let ye=this.normalizeToDbChapterNumber(qt);ct.has(ye)||ct.set(ye,{issues:[],hasCritical:!1,totalCount:0,sources:new Set});let be=ct.get(ye);be.issues.push(ue),be.totalCount++,ue.severidad==="critica"&&(be.hasCritical=!0),be.sources.add(ue.categoria?.split(":")[0]||"general")}}console.log(`[OrchestratorV2] PROBLEM AGGREGATOR: ${ct.size} chapters with issues, ${rt.length} total issues`);for(let[ue,Pe]of Array.from(ct))console.log(`  - Cap ${ue}: ${Pe.totalCount} issues from [${Array.from(Pe.sources).join(", ")}]${Pe.hasCritical?" (CRITICAL)":""}`);this.callbacks.onChaptersBeingCorrected&&this.callbacks.onChaptersBeingCorrected(Y,p),y=[];for(let ue of Y){let Pe=this.findChapterByNumber(ae,ue);Pe&&Pe.content&&y.push({chapterNumber:Pe.chapterNumber,content:Pe.content,title:Pe.title||`Cap\xEDtulo ${Pe.chapterNumber}`})}console.log(`[OrchestratorV2] Created snapshots for ${y.length} chapters before correction`);let Nt=0,ht=0,vt=[];for(let ue of Y){if(await this.shouldStopProcessing(e.id)){await this.updateProjectTokens(e.id),await b.updateProject(e.id,{status:"paused"});return}let Pe=this.findChapterByNumber(ae,ue);if(!Pe){console.log(`[OrchestratorV2] Chapter ${ue} not found in currentChapters (checked normalized numbers), skipping`);continue}let qt=ct.get(ue);if(!qt||qt.issues.length===0){console.log(`[OrchestratorV2] No aggregated issues found for Chapter ${ue}, skipping`);continue}let ye=qt.issues,be=qt.hasCritical,Ue=ye.some(ee=>ee.severidad==="mayor"),ie=be||Ue;console.log(`[OrchestratorV2] Correcting Chapter ${ue}: ${ye.length} issues (critical/major: ${ie})`);let ze=ye.slice(0,3).map(ee=>{let Le=ee.categoria||"error",Ze=(ee.severidad||"mayor").toLowerCase(),De=(ee.descripcion||"").substring(0,80);return`[${Ze.toUpperCase()}] ${Le}: ${De}${De.length>=80?"...":""}`}).join(" | ");await b.createActivityLog({projectId:e.id,level:ie?"warn":"info",message:`[CORRECCION] Cap ${ue} (${ye.length} problemas): ${ze}`,agentRole:"smart-editor"}),this.callbacks.onAgentStatus("smart-editor","active",`Corrigiendo cap\xEDtulo ${ue} (${ie?"reescritura":"parches"}, ${ye.length} problemas)...`);let He=ye.map(ee=>`- [${ee.severidad?.toUpperCase()||"MAYOR"}] ${ee.categoria}: ${ee.descripcion}
  Correcci\xF3n: ${ee.instrucciones_correccion||"Corregir seg\xFAn descripci\xF3n"}`).join(`
`),ve={projectTitle:e.title,genre:e.genre,chapterNumber:ue,chapterTitle:Pe.title,previousChapterSummary:ae.find(ee=>ee.chapterNumber===ue-1)?.summary||"",nextChapterSummary:ae.find(ee=>ee.chapterNumber===ue+1)?.summary||"",mainCharacters:(c.characters||[]).slice(0,10).map(ee=>({name:ee.name,description:ee.description||ee.role||"",relationships:ee.relationships||[],physicalTraits:ee.physicalTraits||ee.physical_traits||"",personality:ee.personality||""})),worldRules:(c.worldRules||c.rules||[]).slice(0,10),locations:(c.locations||c.settings||c.plotOutline?.settings||[]).slice(0,8).map(ee=>({name:ee.name,description:ee.description||ee.atmosphere||""})),timelineEvents:(c.timeline||[]).filter(ee=>ee.chapter===ue||ee.chapter===ue-1||ee.chapter===ue+1).slice(0,5),plotDecisions:(c.plotDecisions||[]).slice(-10),persistentInjuries:(c.persistentInjuries||[]).slice(0,8),styleGuide:e.architectInstructions?.substring(0,1e3)||""},ge=null;try{if(ie){console.log(`[OrchestratorV2] FULL REWRITE for Chapter ${ue} (critical/major issues)`);let ee=`PERSONAJES PRINCIPALES:
`;for(let Me of ve.mainCharacters)ee+=`- ${Me.name}: ${Me.description}`,Me.physicalTraits&&(ee+=` | F\xEDsico: ${Me.physicalTraits}`),Me.relationships?.length&&(ee+=` | Relaciones: ${Me.relationships.join(", ")}`),ee+=`
`;let Le="";ve.locations.length>0&&(Le=`
UBICACIONES:
`+ve.locations.map(Me=>`- ${Me.name}: ${Me.description}`).join(`
`));let Ze="";ve.worldRules.length>0&&(Ze=`
REGLAS DEL MUNDO:
`+ve.worldRules.map(Me=>`- ${typeof Me=="string"?Me:Me.rule||Me.description||JSON.stringify(Me)}`).join(`
`));let De="";ve.persistentInjuries.length>0&&(De=`
\u26A0\uFE0F LESIONES PERSISTENTES ACTIVAS (OBLIGATORIO RESPETAR):
`+ve.persistentInjuries.map(Me=>{let he=Me.character||Me.personaje,at=Me.tipo_lesion||Me.injury||Me.lesion||Me.description,Ct=Me.parte_afectada?` (${Me.parte_afectada})`:"",gt=Me.efecto_esperado?` \u2192 ${Me.efecto_esperado}`:"",zn=Me.capitulo_ocurre?` [desde Cap ${Me.capitulo_ocurre}]`:"";return`- ${he}: ${at}${Ct}${zn}${gt}`}).join(`
`));let nt="";ve.plotDecisions.length>0&&(nt=`
DECISIONES DE TRAMA ANTERIORES:
`+ve.plotDecisions.map(Me=>`- Cap ${Me.chapter||Me.capitulo_establecido||Me.capitulo}: ${Me.decision||Me.descripcion}`).join(`
`));let St="";ve.timelineEvents.length>0&&(St=`
EVENTOS CRONOL\xD3GICOS RELEVANTES:
`+ve.timelineEvents.map(Me=>`- ${Me.event||Me.evento}: ${Me.timeMarker||Me.when||""}`).join(`
`));let Rr=`CONTEXTO PARA CORRECCI\xD3N:
- Proyecto: "${ve.projectTitle}" (${ve.genre})
- Cap\xEDtulo ${ve.chapterNumber}: "${ve.chapterTitle}"
${ve.previousChapterSummary?`- Cap\xEDtulo anterior: ${ve.previousChapterSummary}`:""}
${ve.nextChapterSummary?`- Cap\xEDtulo siguiente: ${ve.nextChapterSummary}`:""}

${ee}
${Le}
${Ze}
${De}
${nt}
${St}

${ve.styleGuide?`GU\xCDA DE ESTILO:
${ve.styleGuide}
`:""}

PROBLEMAS A CORREGIR (OBLIGATORIO):
${He}`,_t=await this.buildConsistencyContextForCorrection(e.id,ue,c,e);console.log(`[OrchestratorV2] Post-review: Critical/major issues for Chapter ${ue}, trying SURGICAL FIX first`);let Vt=await this.smartEditor.surgicalFix({chapterContent:Pe.content||"",errorDescription:Rr,consistencyConstraints:_t||JSON.stringify(ve.mainCharacters)});if(this.addTokenUsage(Vt.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Vt.tokenUsage,ue),console.log(`[OrchestratorV2] surgicalFix result for post-review Chapter ${ue}: patches=${Vt.patches?.length||0}`),Vt.patches&&Vt.patches.length>0){let Me=Wr(Pe.content||"",Vt.patches);Me.success&&Me.patchedText&&Me.patchedText!==Pe.content&&(ge=Me.patchedText,console.log(`[OrchestratorV2] Post-review surgical fix applied ${Me.appliedPatches}/${Vt.patches.length} patches for Chapter ${ue}`),await b.createActivityLog({projectId:e.id,level:"info",message:`[QUIRURGICO] Cap ${ue}: ${Me.appliedPatches} parches post-review aplicados`,agentRole:"smart-editor"}))}if(!ge){console.warn(`[OrchestratorV2] Post-review surgical fix failed for Chapter ${ue}, falling back to fullRewrite as LAST RESORT`),await b.createActivityLog({projectId:e.id,level:"warn",message:`[FALLBACK] Cap ${ue}: Parches fallaron, usando reescritura como ultimo recurso`,agentRole:"smart-editor"});let Me=await this.smartEditor.fullRewrite({chapterContent:Pe.content||"",errorDescription:Rr,consistencyConstraints:_t||JSON.stringify(ve.mainCharacters)});this.addTokenUsage(Me.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Me.tokenUsage,ue),Me.rewrittenContent&&Me.rewrittenContent.length>100?(ge=Me.rewrittenContent,console.log(`[OrchestratorV2] Full rewrite successful: ${ge.length} chars`)):Me.content&&Me.content.length>100&&(ge=Me.content,console.log(`[OrchestratorV2] Full rewrite fallback: ${ge.length} chars`))}}else{console.log(`[OrchestratorV2] Minor issues only, trying patches for Chapter ${ue}`);let ee=await this.buildConsistencyContextForCorrection(e.id,ue,c,e),Le=await this.smartEditor.execute({chapterContent:Pe.content||"",sceneBreakdown:Pe.sceneBreakdown||{scenes:[]},worldBible:c,additionalContext:`${ee}

PROBLEMAS DETECTADOS POR EL CR\xCDTICO (CORREGIR OBLIGATORIAMENTE):
${He}`});if(this.addTokenUsage(Le.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Le.tokenUsage,ue),Le.parsed){if(Le.parsed.patches&&Le.parsed.patches.length>0){console.log(`[OrchestratorV2] Applying ${Le.parsed.patches.length} patches to Chapter ${ue}`);let Ze=Wr(Pe.content||"",Le.parsed.patches);Ze.appliedPatches>0?(ge=Ze.patchedText,console.log(`[OrchestratorV2] Applied ${Ze.appliedPatches} patches to Chapter ${ue}`)):console.log(`[OrchestratorV2] No patches applied to Chapter ${ue}`)}if(!ge&&Le.parsed.needs_rewrite){console.log(`[OrchestratorV2] Using surgicalFix as fallback for Chapter ${ue}`);let Ze=await this.buildConsistencyContextForCorrection(e.id,ue,c,e),De=await this.smartEditor.surgicalFix({chapterContent:Pe.content||"",errorDescription:He,consistencyConstraints:Ze});if(this.addTokenUsage(De.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",De.tokenUsage,ue),De.patches&&De.patches.length>0){let nt=Wr(Pe.content||"",De.patches);nt.patchedText&&nt.patchedText.length>100&&(ge=nt.patchedText,console.log(`[OrchestratorV2] Fallback surgicalFix applied ${De.patches.length} patches`))}else De.fullContent&&De.fullContent.length>100&&(ge=De.fullContent,console.log(`[OrchestratorV2] Fallback surgicalFix returned ${ge.length} chars`))}if(!ge){console.log(`[OrchestratorV2] Forcing fullRewrite as last resort for Chapter ${ue} with full context`);let Ze=await this.buildConsistencyContextForCorrection(e.id,ue,c,e),De=await this.smartEditor.fullRewrite({chapterContent:Pe.content||"",errorDescription:He,consistencyConstraints:Ze,worldBible:{characters:ve.mainCharacters,locations:ve.locations,worldRules:ve.worldRules,persistentInjuries:ve.persistentInjuries,plotDecisions:ve.plotDecisions},chapterNumber:ue,chapterTitle:Pe.title||void 0,previousChapterSummary:ve.previousChapterSummary,nextChapterSummary:ve.nextChapterSummary,styleGuide:ve.styleGuide,projectTitle:e.title,genre:e.genre||void 0});this.addTokenUsage(De.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",De.tokenUsage,ue),De.rewrittenContent&&De.rewrittenContent.length>100?(ge=De.rewrittenContent,console.log("[OrchestratorV2] Last resort fullRewrite successful")):De.content&&De.content.length>100&&(ge=De.content)}}}}catch(ee){let Le=ee instanceof Error?ee.message:"Error desconocido";console.error(`[OrchestratorV2] Error correcting Chapter ${ue}:`,ee),this.callbacks.onAgentStatus("smart-editor","error",`Error en cap\xEDtulo ${ue}: ${Le}`),vt.push({chapterNumber:ue,title:Pe.title||`Cap\xEDtulo ${ue}`,error:Le,issues:ye.map(Ze=>`[${Ze.severidad}] ${Ze.descripcion}`)}),ht++;continue}if(ge&&ge!==Pe.content){let ee=await this.validateCorrectionConsistency(Pe.content||"",ge,c,ue);if(!ee.valid){console.warn(`[OrchestratorV2] \u26A0\uFE0F Correction validation detected ${ee.regressions.length} potential regressions (${ee.severity}) for Chapter ${ue}:`);for(let Ze of ee.regressions)console.warn(`  - ${Ze}`);if(ee.severity==="high"){await b.createActivityLog({projectId:e.id,level:"error",message:`\u{1F6D1} BLOQUEADO: Correcci\xF3n de Cap ${ue} rechazada por regresiones cr\xEDticas: ${ee.regressions.slice(0,2).join("; ")}. Manteniendo versi\xF3n original.`,agentRole:"smart-editor"}),console.error(`[OrchestratorV2] HIGH SEVERITY: Blocking correction for Chapter ${ue}, keeping original`),ht++,vt.push({chapterNumber:ue,title:Pe.title||`Cap\xEDtulo ${ue}`,error:"Correcci\xF3n bloqueada por regresiones cr\xEDticas",issues:ee.regressions.slice(0,3)});continue}await b.createActivityLog({projectId:e.id,level:"warn",message:`\u26A0\uFE0F Validaci\xF3n detect\xF3 posibles regresiones en Cap ${ue}: ${ee.regressions.slice(0,3).join("; ")}. Guardado con advertencias.`,agentRole:"smart-editor"})}if(ee.severity!=="high"){let Ze=ye.map(nt=>nt.descripcion||nt.description||String(nt)),De=await this.validateCorrectionWithAI(Pe.content||"",ge,c,ue,Ze);if(!De.approved&&De.confidence>=.7){console.warn(`[OrchestratorV2] \u{1F916} AI validation rejected correction for Chapter ${ue} (confidence: ${De.confidence}):`);for(let nt of De.concerns)console.warn(`  - ${nt}`);await b.createActivityLog({projectId:e.id,level:"error",message:`\u{1F916} BLOQUEADO por IA: Correcci\xF3n de Cap ${ue} rechazada (confianza ${(De.confidence*100).toFixed(0)}%): ${De.concerns.slice(0,2).join("; ")}`,agentRole:"smart-editor"}),ht++,vt.push({chapterNumber:ue,title:Pe.title||`Cap\xEDtulo ${ue}`,error:"Correcci\xF3n bloqueada por validaci\xF3n IA",issues:De.concerns.slice(0,3)});continue}else!De.approved&&De.confidence<.7&&await b.createActivityLog({projectId:e.id,level:"warn",message:`\u{1F916} Advertencia IA en Cap ${ue} (confianza ${(De.confidence*100).toFixed(0)}%): ${De.concerns.slice(0,2).join("; ")}. Guardando de todas formas.`,agentRole:"smart-editor"})}let Le=ge.split(/\s+/).length;await b.updateChapter(Pe.id,{content:ge,wordCount:Le,qualityScore:8}),console.log(`[OrchestratorV2] Successfully updated Chapter ${ue} (${Le} words)${ee.valid?"":` [${ee.severity.toUpperCase()} WARNINGS]`}`),this.callbacks.onAgentStatus("smart-editor","active",`Capitulo ${ue} corregido (${Le} palabras)${ee.valid?"":" \u26A0\uFE0F"}`),this.callbacks.onChapterComplete(Pe.chapterNumber,Le,Pe.title||`Cap\xEDtulo ${Pe.chapterNumber}`),Nt++,I.add(ue),await _(),console.log(`[OrchestratorV2] Post-review: Chapter ${ue} marked as successfully corrected & persisted`);try{await this.updateWorldBibleFromChapter(e.id,ue,ge,ye)}catch(Ze){console.error(`[OrchestratorV2] Failed to update World Bible after Chapter ${ue} rewrite:`,Ze)}for(let Ze of ye)f.push(`Cap ${ue}: ${Ze.categoria} - ${Ze.descripcion.substring(0,100)}`)}else{console.log(`[OrchestratorV2] Chapter ${ue} unchanged - forcing aggressive rewrite`);let ee=!1,Le=3;for(let Ze=1;Ze<=Le&&!ee;Ze++){this.callbacks.onAgentStatus("smart-editor","active",`Capitulo ${ue}: reintento ${Ze}/${Le}...`);try{let De=`REINTENTO ${Ze}/${Le} - ES OBLIGATORIO MODIFICAR ESTE CAPITULO.

Problemas que DEBEN corregirse:
${He}

INSTRUCCIONES ESTRICTAS:
- NO devuelvas el texto sin cambios bajo ninguna circunstancia
- Realiza TODAS las correcciones indicadas
- Si no ves problemas obvios, mejora la prosa y el ritmo narrativo
- El texto devuelto DEBE ser diferente al original`,nt=await this.buildConsistencyContextForCorrection(e.id,ue,c,e),St=await this.smartEditor.surgicalFix({chapterContent:Pe.content||"",errorDescription:De,consistencyConstraints:nt});this.addTokenUsage(St.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",St.tokenUsage,ue);let Rr=null;if(St.patches&&St.patches.length>0){let _t=Wr(Pe.content||"",St.patches);_t.success&&_t.patchedText&&_t.patchedText!==Pe.content&&(Rr=_t.patchedText,console.log(`[OrchestratorV2] Retry ${Ze}: Applied ${_t.appliedPatches} patches to Chapter ${ue}`))}else St.fullContent&&St.fullContent!==Pe.content&&(Rr=St.fullContent,console.log(`[OrchestratorV2] Retry ${Ze}: Using fullContent fallback for Chapter ${ue}`));if(Rr&&Rr.length>100){let _t=Rr.split(/\s+/).length;await b.updateChapter(Pe.id,{content:Rr,wordCount:_t,qualityScore:8}),console.log(`[OrchestratorV2] Retry ${Ze} successful for Chapter ${ue} (${_t} words)`),this.callbacks.onAgentStatus("smart-editor","active",`Capitulo ${ue} corregido en reintento ${Ze} (${_t} palabras)`),Nt++,ee=!0;for(let Vt of ye)f.push(`Cap ${ue}: ${Vt.categoria} - ${Vt.descripcion.substring(0,100)}`)}else console.log(`[OrchestratorV2] Chapter ${ue} still unchanged after retry ${Ze} (no patches or same content)`)}catch(De){console.error(`[OrchestratorV2] Retry ${Ze} failed for Chapter ${ue}:`,De)}}if(!ee){console.log(`[OrchestratorV2] Attempting FULL REWRITE as last resort for Chapter ${ue} with full context...`),this.callbacks.onAgentStatus("smart-editor","active",`Capitulo ${ue}: reescritura completa (\xFAltimo recurso)...`);let Ze=ye.map((De,nt)=>`${nt+1}. [${De.severidad?.toUpperCase()||"MAYOR"}] ${De.categoria}: ${De.descripcion}
   Correcci\xF3n: ${De.instrucciones_correccion||"Corregir seg\xFAn descripci\xF3n"}`).join(`
`);try{let De=await this.buildConsistencyContextForCorrection(e.id,ue,c,e),nt=await this.smartEditor.fullRewrite({chapterContent:Pe.content||"",errorDescription:Ze,consistencyConstraints:De,worldBible:{characters:ve.mainCharacters,locations:ve.locations,worldRules:ve.worldRules,persistentInjuries:ve.persistentInjuries,plotDecisions:ve.plotDecisions},chapterNumber:ue,chapterTitle:Pe.title||void 0,previousChapterSummary:ve.previousChapterSummary,nextChapterSummary:ve.nextChapterSummary,styleGuide:ve.styleGuide,projectTitle:e.title,genre:e.genre||void 0});this.addTokenUsage(nt.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",nt.tokenUsage,ue);let St=nt.rewrittenContent||nt.content;if(St&&St.length>100){let Rr=(Pe.content||"").replace(/\s+/g," ").trim();if(St.replace(/\s+/g," ").trim()!==Rr){let Vt=St.split(/\s+/).length;await b.updateChapter(Pe.id,{content:St,wordCount:Vt,qualityScore:8}),console.log(`[OrchestratorV2] Full rewrite successful for Chapter ${ue} (${Vt} words)`),this.callbacks.onAgentStatus("smart-editor","active",`Capitulo ${ue} reescrito completamente (${Vt} palabras)`),Nt++,ee=!0;for(let Me of ye)f.push(`Cap ${ue}: ${Me.categoria} - ${Me.descripcion?.substring(0,100)||"corregido"}`)}else console.warn(`[OrchestratorV2] Full rewrite produced identical content for Chapter ${ue}`)}else console.error(`[OrchestratorV2] Full rewrite produced no content for Chapter ${ue}`)}catch(De){console.error(`[OrchestratorV2] Full rewrite failed for Chapter ${ue}:`,De)}}ee||(console.error(`[OrchestratorV2] FALLO TOTAL: Capitulo ${ue} no pudo ser corregido tras parches y reescritura`),this.callbacks.onAgentStatus("smart-editor","error",`ERROR: Capitulo ${ue} no corregido tras todos los intentos`),vt.push({chapterNumber:ue,title:Pe.title||`Cap\xEDtulo ${ue}`,error:`No se pudo corregir tras ${Le} parches + reescritura completa`,issues:ye.map(Ze=>`[${Ze.severidad}] ${Ze.descripcion}`)}),ht++)}}let Se=Y.length,Tt=`Correcciones: ${Nt} de ${Se} capitulos modificados`;if(ht>0&&(Tt+=` (${ht} fallidos)`),console.log(`[OrchestratorV2] Auto-correction complete: ${Nt} corrected, ${ht} failed of ${Se} total`),this.callbacks.onAgentStatus("smart-editor","completed",Tt),this.callbacks.onChaptersBeingCorrected&&this.callbacks.onChaptersBeingCorrected([],p),ht===0){Nt>0?(console.log(`[OrchestratorV2] Corrections applied successfully (${Nt} chapters). Continuing to next review cycle (${p+1}/${t})...`),this.callbacks.onAgentStatus("beta-reader","active",`${Nt} correcciones aplicadas. Iniciando ciclo ${p+1}...`)):(console.log(`[OrchestratorV2] No chapters were corrected. Continuing to next review cycle (${p+1}/${t})...`),this.callbacks.onAgentStatus("beta-reader","active",`Sin correcciones necesarias. Iniciando ciclo ${p+1}...`));continue}if(ht>0){console.warn(`[OrchestratorV2] ${ht} chapters could not be corrected. Continuing to next cycle anyway (unattended mode)...`);let ue=vt.map(qt=>`Cap ${qt.chapterNumber}: ${qt.error.substring(0,100)}`).join("; ");await b.createActivityLog({projectId:e.id,level:"warning",agentRole:"smart-editor",message:`${ht} cap\xEDtulo(s) no pudieron corregirse autom\xE1ticamente: ${ue.substring(0,500)}. Continuando al siguiente ciclo...`});let Pe=e.finalReviewResult||{};await b.updateProject(e.id,{finalReviewResult:{...Pe,failedChapters:vt,correctionAttemptedAt:new Date().toISOString()}}),this.callbacks.onAgentStatus("smart-editor","completed",`${Nt} corregidos, ${ht} fallidos. Continuando...`);continue}}}if(await this.updateProjectTokens(e.id),!m){let F={cycleReached:p,maxCycles:t,consecutiveHighScores:v,previousScores:S,resolvedHashesCount:A.length};console.error("[OrchestratorV2] FinalReviewer completed loop but finalResult is null. Context:",F),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:`La revisi\xF3n final no produjo resultado despu\xE9s de ${p} ciclos (m\xE1ximo: ${t}). Puntuaciones anteriores: [${S.join(", ")||"ninguna"}]. Presiona 'Continuar' para reintentar.`,agentRole:"final-reviewer",metadata:{recoverable:!0,...F}}),this.callbacks.onError(`No se complet\xF3 la revisi\xF3n final (ciclo ${p}/${t}) - presiona Continuar para reintentar`);return}let{veredicto:N,puntuacion_global:P,resumen_general:L,justificacion_puntuacion:j,analisis_bestseller:$,issues:U,capitulos_para_reescribir:k,plot_decisions:V,persistent_injuries:Q}=m,te=P>=9&&(N==="APROBADO"||N==="APROBADO_CON_RESERVAS");if(V?.length||Q?.length){let F=await b.getWorldBibleByProject(e.id);if(F){let ae=Array.isArray(F.plotDecisions)?F.plotDecisions:[],D=Array.isArray(F.persistentInjuries)?F.persistentInjuries:[],J=this.mergeDecisions(ae,V||[]),W=this.mergeInjuries(D,Q||[]);await b.updateWorldBible(F.id,{plotDecisions:J,persistentInjuries:W}),console.log(`[OrchestratorV2] Saved ${J.length} plot decisions and ${W.length} persistent injuries to World Bible`)}}if(await b.updateProject(e.id,{status:te?"completed":"failed_final_review",finalScore:P,finalReviewResult:m}),te)this.callbacks.onAgentStatus("final-reviewer","completed",`${N} (${P}/10)`),this.callbacks.onProjectComplete();else{let F=U&&U.length>0?U.map(W=>`[${W.severidad?.toUpperCase()||"ISSUE"}] Cap ${(W.capitulos_afectados||[]).join(", ")}: ${W.descripcion?.substring(0,150)||W.categoria}`).join(" | "):"Sin detalles de problemas espec\xEDficos",ae=k?.length||0,D=U?.filter(W=>W.severidad==="critica")?.length||0,J=U?.filter(W=>W.severidad==="mayor")?.length||0;console.log(`[OrchestratorV2] Final review failed: ${P}/10. Issues: ${F}`),await b.createActivityLog({projectId:e.id,level:"error",message:`Problemas detectados: ${D} cr\xEDticos, ${J} mayores. ${F.substring(0,500)}`,agentRole:"final-reviewer"}),this.callbacks.onAgentStatus("final-reviewer","error",`${N} (${P}/10) - ${D} cr\xEDticos, ${J} mayores, ${ae} caps a reescribir`),this.callbacks.onError(`Manuscrito ${P}/10: ${L?.substring(0,200)||F.substring(0,200)}`)}}catch(s){console.error("[OrchestratorV2] Final review error:",s);let o=s instanceof Error?s.message:String(s);this.callbacks.onError(o),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:`Error durante revisi\xF3n final (ciclo ${e.revisionCycle||1}): ${o.substring(0,300)}. Presiona "Continuar" para reintentar.`,agentRole:"final-reviewer",metadata:{error:o,cycle:e.revisionCycle||1,recoverable:!0}}),console.log(`[OrchestratorV2] Project ${e.id} paused after FinalReviewer error - can resume with "Continuar" button`)}finally{a&&a(e.id)}}async extendNovel(e,t,n){console.log(`[OrchestratorV2] Extending project ${e.id} from chapter ${t+1} to ${n}`);try{let a=await b.getWorldBibleByProject(e.id);if(!a||!a.plotOutline){this.callbacks.onError("No se encontr\xF3 la World Bible con escaleta para este proyecto"),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:"Falta World Bible o escaleta. Verifica la configuraci\xF3n del proyecto.",agentRole:"system",metadata:{recoverable:!1,requiresConfiguration:!0}});return}let s={characters:a.characters||[],rules:a.worldRules||[]},o="";if(e.styleGuideId){let p=await b.getStyleGuide(e.styleGuideId);p&&(o=p.content)}let u=(await b.getChaptersByProject(e.id)).filter(p=>p.status==="completed"||p.status==="approved").sort((p,m)=>p.chapterNumber-m.chapterNumber),c=u.length>0?u.slice(-3).map(p=>p.summary||`Cap ${p.chapterNumber} completado`).join(`
`):"Inicio de la novela.";this.callbacks.onAgentStatus("global-architect","active",`Planificando cap\xEDtulos ${t+1} a ${n}...`);for(let p=t+1;p<=n;p++){if(await this.shouldStopProcessing(e.id)){console.log(`[OrchestratorV2] Extension cancelled for project ${e.id}`),await this.updateProjectTokens(e.id),await b.updateProject(e.id,{status:"paused"});return}let m={chapter_num:p,title:`Cap\xEDtulo ${p}`,summary:`Continuaci\xF3n de la historia - Cap\xEDtulo ${p}`,key_event:"Desarrollo de la trama"},f=c,g="";try{let $=await this.getConsistencyContext(e.id);$.entities.length>0&&(g=co.generateConstraints(e.genre,$.entities,$.rules,$.relationships,p));let U=await this.buildEnrichedContextOptions(e),k=await this.buildEnrichedWritingContext(e.id,p,s,U);k&&(g+=k,console.log(`[OrchestratorV2] Added enriched writing context for extend (${k.length} chars)`))}catch($){console.error("[OrchestratorV2] Failed to generate constraints for extend:",$)}this.callbacks.onAgentStatus("chapter-architect","active",`Planificando escenas para Cap\xEDtulo ${p}...`);let y=s?.plotOutline,C=y?.chapterOutlines||y?.chapters||[],A=$c(e.id),T=A.analyzeForChapter(p),E=A.formatForPrompt(T),d=await this.chapterArchitect.execute({chapterOutline:m,worldBible:s,previousChapterSummary:f,storyState:c,consistencyConstraints:g,fullPlotOutline:C,isKindleUnlimited:e.kindleUnlimitedOptimized||!1,patternAnalysisContext:E});if(!d.parsed){console.error(`[OrchestratorV2] Failed to plan chapter ${p}`);continue}this.addTokenUsage(d.tokenUsage),await this.logAiUsage(e.id,"chapter-architect","deepseek-reasoner",d.tokenUsage,p);let l=A.extractPatternFromScenes(p,m.title,d.parsed.scenes.map($=>({plot_beat:$.plot_beat,emotional_beat:$.emotional_beat,ending_hook:$.ending_hook})),d.parsed.chapter_hook);A.registerPattern(l);let h=d.parsed.chapter_hook?this.generateTitleFromHook(d.parsed.chapter_hook):d.parsed.scenes[0]?.plot_beat?this.generateTitleFromHook(d.parsed.scenes[0].plot_beat):`Cap\xEDtulo ${p}`,v={...m,title:h},S="",R="",x=!1,w=await this.getRecentChaptersText(e.id,p,2);for(let $ of d.parsed.scenes){if(await this.shouldStopProcessing(e.id)){console.log(`[OrchestratorV2] Extension cancelled during scene writing for project ${e.id}`),x=!0;break}this.callbacks.onAgentStatus("ghostwriter-v2","active",`Escribiendo escena ${$.scene_num}...`);let U=await this.getSeriesWorldBibleForInjection(e.id),k=await this.ghostwriter.execute({scenePlan:$,prevSceneContext:R,rollingSummary:c,worldBible:s,guiaEstilo:o,consistencyConstraints:g,previousChaptersText:w,currentChapterText:S,seriesWorldBible:U});k.error||(S+=`

`+k.content,R=k.content.slice(-1500),this.callbacks.onSceneComplete(p,$.scene_num,d.parsed.scenes.length,k.content?.split(/\s+/).length||0)),this.addTokenUsage(k.tokenUsage),await this.logAiUsage(e.id,"ghostwriter-v2","deepseek-chat",k.tokenUsage,p)}if(x){await this.updateProjectTokens(e.id),await b.updateProject(e.id,{status:"paused"});return}let O=await this.smartEditor.execute({chapterContent:S,sceneBreakdown:d.parsed,worldBible:s}),I=S;O.parsed?.patches&&O.parsed.patches.length>0&&(I=Wr(S,O.parsed.patches).patchedText),this.addTokenUsage(O.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",O.tokenUsage,p);let _=await this.summarizer.execute({chapterContent:I,chapterNumber:p});this.addTokenUsage(_.tokenUsage),await this.logAiUsage(e.id,"summarizer","deepseek-chat",_.tokenUsage,p);let N=_.content||`Cap\xEDtulo ${p} completado.`;c=N;let P=I.split(/\s+/).length,j=(await b.getChaptersByProject(e.id)).find($=>$.chapterNumber===p);j?(await b.updateChapter(j.id,{title:v.title,content:I,wordCount:P,status:"approved",sceneBreakdown:d.parsed,summary:N}),console.log(`[OrchestratorV2] Updated existing chapter ${p} (ID: ${j.id})`)):(await b.createChapter({projectId:e.id,chapterNumber:p,title:v.title,content:I,wordCount:P,status:"approved",sceneBreakdown:d.parsed,summary:N}),console.log(`[OrchestratorV2] Created new chapter ${p}`)),await b.updateProject(e.id,{currentChapter:p}),this.callbacks.onChapterComplete(p,P,v.title),await this.updateProjectTokens(e.id)}await this.extractSeriesWorldBibleOnComplete(e.id),await b.updateProject(e.id,{status:"completed"}),this.callbacks.onProjectComplete()}catch(a){console.error("[OrchestratorV2] Extension error:",a);let s=a instanceof Error?a.message:String(a);this.callbacks.onError(s),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:`Error extendiendo novela: ${s.substring(0,300)}. Presiona "Continuar" para reintentar.`,agentRole:"system",metadata:{error:s,recoverable:!0}})}}async regenerateTruncatedChapters(e,t=100){console.log(`[OrchestratorV2] Regenerating truncated chapters for project ${e.id} (min: ${t} words)`);let n=500,a=150,s=o=>o===0||o===-1||o===998||o===-2||o===999;try{let o=await b.getChaptersByProject(e.id),i=o.filter(m=>{let f=m.content?m.content.split(/\s+/).length:0,g=s(m.chapterNumber)?a:n;return f<g});if(i.length===0){this.callbacks.onAgentStatus("ghostwriter-v2","completed","No se encontraron cap\xEDtulos truncados"),await this.extractSeriesWorldBibleOnComplete(e.id),await b.updateProject(e.id,{status:"completed"}),this.callbacks.onProjectComplete();return}let u=await b.getWorldBibleByProject(e.id);if(!u){this.callbacks.onError("No se encontr\xF3 la World Bible para este proyecto"),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:"Falta World Bible. Verifica la configuraci\xF3n del proyecto.",agentRole:"system",metadata:{recoverable:!1,requiresConfiguration:!0}});return}let c={characters:u.characters||[],rules:u.worldRules||[]},p="";if(e.styleGuideId){let m=await b.getStyleGuide(e.styleGuideId);m&&(p=m.content)}this.callbacks.onAgentStatus("ghostwriter-v2","active",`Regenerando ${i.length} cap\xEDtulos truncados`);for(let m=0;m<i.length;m++){if(await this.shouldStopProcessing(e.id)){console.log(`[OrchestratorV2] Truncated regeneration cancelled for project ${e.id}`),await this.updateProjectTokens(e.id),await b.updateProject(e.id,{status:"paused"});return}let f=i[m];this.callbacks.onAgentStatus("ghostwriter-v2","active",`Regenerando cap\xEDtulo ${f.chapterNumber} (${m+1}/${i.length})`);let y=o.filter(P=>P.chapterNumber<f.chapterNumber&&P.content).sort((P,L)=>P.chapterNumber-L.chapterNumber).slice(-3).map(P=>P.summary||`Cap ${P.chapterNumber}: ${P.content?.slice(0,200)}...`).join(`
`),C={chapter_num:f.chapterNumber,title:f.title||`Cap\xEDtulo ${f.chapterNumber}`,summary:f.summary||"Regeneraci\xF3n del cap\xEDtulo",key_event:"Continuaci\xF3n de la historia"},A="";try{let P=await this.getConsistencyContext(e.id);P.entities.length>0&&(A=co.generateConstraints(e.genre,P.entities,P.rules,P.relationships,f.chapterNumber));let L=await this.buildEnrichedContextOptions(e),j=await this.buildEnrichedWritingContext(e.id,f.chapterNumber,c,L);j&&(A+=j,console.log(`[OrchestratorV2] Added enriched writing context for truncated regen (${j.length} chars)`))}catch(P){console.error("[OrchestratorV2] Failed to generate constraints for truncated regen:",P)}let T=c?.plotOutline,E=T?.chapterOutlines||T?.chapters||[],d=$c(e.id),l=d.analyzeForChapter(f.chapterNumber),h=d.formatForPrompt(l),v=await this.chapterArchitect.execute({chapterOutline:C,worldBible:c,previousChapterSummary:y,storyState:y,consistencyConstraints:A,fullPlotOutline:E,isKindleUnlimited:e.kindleUnlimitedOptimized||!1,patternAnalysisContext:h});if(!v.parsed){console.error(`[OrchestratorV2] Failed to plan chapter ${f.chapterNumber}`);continue}this.addTokenUsage(v.tokenUsage),await this.logAiUsage(e.id,"chapter-architect","deepseek-reasoner",v.tokenUsage,f.chapterNumber);let S=d.extractPatternFromScenes(f.chapterNumber,C.title,v.parsed.scenes.map(P=>({plot_beat:P.plot_beat,emotional_beat:P.emotional_beat,ending_hook:P.ending_hook})),v.parsed.chapter_hook);d.registerPattern(S);let R="",x="",w=!1,O=await this.getRecentChaptersText(e.id,f.chapterNumber,2);for(let P of v.parsed.scenes){if(await this.shouldStopProcessing(e.id)){console.log(`[OrchestratorV2] Truncated regeneration cancelled during scene writing for project ${e.id}`),w=!0;break}this.callbacks.onAgentStatus("ghostwriter-v2","active",`Escribiendo escena ${P.scene_num}...`);let L=await this.getSeriesWorldBibleForInjection(e.id),j=await this.ghostwriter.execute({scenePlan:P,prevSceneContext:x,rollingSummary:y,worldBible:c,guiaEstilo:p,consistencyConstraints:A,previousChaptersText:O,currentChapterText:R,seriesWorldBible:L});j.error||(R+=`

`+j.content,x=j.content.slice(-1500)),this.addTokenUsage(j.tokenUsage),await this.logAiUsage(e.id,"ghostwriter-v2","deepseek-chat",j.tokenUsage,f.chapterNumber),this.callbacks.onSceneComplete(f.chapterNumber,P.scene_num,v.parsed.scenes.length,j.content?.split(/\s+/).length||0)}if(w){await this.updateProjectTokens(e.id),await b.updateProject(e.id,{status:"paused"});return}let I=await this.smartEditor.execute({chapterContent:R,sceneBreakdown:v.parsed,worldBible:c}),_=R;I.parsed?.patches&&I.parsed.patches.length>0&&(_=Wr(R,I.parsed.patches).patchedText),this.addTokenUsage(I.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",I.tokenUsage,f.chapterNumber);let N=_.split(/\s+/).length;await b.updateChapter(f.id,{content:_,wordCount:N,status:"approved",sceneBreakdown:v.parsed}),this.callbacks.onChapterComplete(f.chapterNumber,N,f.title||`Cap\xEDtulo ${f.chapterNumber}`),await this.updateProjectTokens(e.id)}await this.extractSeriesWorldBibleOnComplete(e.id),await b.updateProject(e.id,{status:"completed"}),this.callbacks.onProjectComplete()}catch(o){console.error("[OrchestratorV2] Truncated regeneration error:",o);let i=o instanceof Error?o.message:String(o);this.callbacks.onError(i),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:`Error regenerando cap\xEDtulos truncados: ${i.substring(0,300)}. Presiona "Continuar" para reintentar.`,agentRole:"system",metadata:{error:i,recoverable:!0}})}}async runContinuitySentinelForce(e){console.log(`[OrchestratorV2] Running continuity sentinel for project ${e.id}`);try{this.callbacks.onAgentStatus("smart-editor","active","Ejecutando an\xE1lisis de continuidad...");let t=await b.getChaptersByProject(e.id),n=await b.getWorldBibleByProject(e.id);if(!n){this.callbacks.onError("No se encontr\xF3 la World Bible para este proyecto"),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:"Falta World Bible. Verifica la configuraci\xF3n del proyecto.",agentRole:"system",metadata:{recoverable:!1,requiresConfiguration:!0}});return}let a={characters:n.characters||[],rules:n.worldRules||[]},s="";if(e.styleGuideId){let c=await b.getStyleGuide(e.styleGuideId);c&&(s=c.content)}let o=0,i=0,u=t.filter(c=>c.content);for(let c=0;c<u.length;c++){let p=u[c];if(await this.shouldStopProcessing(e.id)){console.log(`[OrchestratorV2] Sentinel check cancelled for project ${e.id}`),await this.updateProjectTokens(e.id),await b.updateProject(e.id,{status:"paused"});return}this.callbacks.onAgentStatus("smart-editor","active",`Analizando cap\xEDtulo ${p.chapterNumber} (${c+1}/${u.length})...`);let m=await this.smartEditor.execute({chapterContent:p.content||"",sceneBreakdown:p.sceneBreakdown||{scenes:[]},worldBible:a});if(this.addTokenUsage(m.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",m.tokenUsage,p.chapterNumber),m.parsed&&!m.parsed.is_approved&&(o++,m.parsed.patches&&m.parsed.patches.length>0)){let f=Wr(p.content||"",m.parsed.patches);f.appliedPatches>0&&(await b.updateChapter(p.id,{content:f.patchedText,wordCount:f.patchedText.split(/\s+/).length}),i++,this.callbacks.onChapterComplete(p.chapterNumber,f.patchedText.split(/\s+/).length,p.title||`Cap\xEDtulo ${p.chapterNumber}`))}}await this.updateProjectTokens(e.id),i>0?this.callbacks.onAgentStatus("smart-editor","completed",`Correcciones aplicadas: ${i} cap\xEDtulos mejorados`):o>0?this.callbacks.onAgentStatus("smart-editor","completed",`An\xE1lisis completado: ${o} cap\xEDtulos con observaciones menores`):this.callbacks.onAgentStatus("smart-editor","completed","No se encontraron issues de continuidad"),await this.extractSeriesWorldBibleOnComplete(e.id),await b.updateProject(e.id,{status:"completed"}),this.callbacks.onProjectComplete()}catch(t){console.error("[OrchestratorV2] Sentinel error:",t);let n=t instanceof Error?t.message:String(t);this.callbacks.onError(n),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:`Error en validaci\xF3n de continuidad: ${n.substring(0,300)}. Presiona "Continuar" para reintentar.`,agentRole:"system",metadata:{error:n,recoverable:!0}})}}async generateMissingChapters(e){aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] generateMissingChapters START for project ${e.id}
`,{flag:"a"}),console.log(`[OrchestratorV2] generateMissingChapters STARTED for project ${e.id}`);try{aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] About to update project status
`,{flag:"a"}),console.log("[OrchestratorV2] Updating project status to generating...");try{let h=await b.updateProject(e.id,{status:"generating"});aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] updateProject returned: ${JSON.stringify(h)}
`,{flag:"a"})}catch(h){throw aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] updateProject ERROR: ${h.message}
${h.stack}
`,{flag:"a"}),h}aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] Project status updated successfully
`,{flag:"a"}),console.log("[OrchestratorV2] Project status updated successfully"),this.callbacks.onAgentStatus("orchestrator-v2","active","Analizando cap\xEDtulos faltantes..."),aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] About to get World Bible
`,{flag:"a"});let t=await b.getWorldBibleByProject(e.id);if(aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] World Bible result: ${t?"FOUND":"NULL"}
`,{flag:"a"}),!t||!t.plotOutline)throw new Error("No se encontr\xF3 el World Bible con el outline de cap\xEDtulos");let a=(t.plotOutline.chapterOutlines||[]).map(h=>({chapter_num:h.chapter_num??h.number??0,title:h.title||`Cap\xEDtulo ${h.chapter_num??h.number??0}`,summary:h.summary||h.description||"",key_event:h.key_event||h.keyEvent||"",emotional_arc:h.emotional_arc||h.emotionalArc||""})),s=a.map((h,v)=>{let S=h.chapter_num,R=h.title;return e.hasPrologue&&v===0?(S=0,R="Pr\xF3logo"):e.hasEpilogue&&v===a.length-1?(S=998,R="Ep\xEDlogo"):e.hasAuthorNote&&v===a.length-1?(S=999,R="Nota del Autor"):e.hasPrologue&&(S=v),{...h,chapter_num:S,title:R}}),o=await b.getChaptersByProject(e.id),i=new Set(o.map(h=>h.chapterNumber)),u=[];e.hasPrologue&&u.push(0);for(let h=1;h<=e.chapterCount;h++)u.push(h);let c=s.filter(h=>!i.has(h.chapter_num)&&h.chapter_num<998),p=u.filter(h=>!i.has(h)),m=new Set([...c.map(h=>h.chapter_num),...p]),f=new Map(s.map(h=>[h.chapter_num,h])),g=Array.from(m).sort((h,v)=>h-v).map(h=>f.has(h)?f.get(h):{chapter_num:h,title:`Cap\xEDtulo ${h}`,summary:`Contin\xFAa la narrativa del cap\xEDtulo ${h-1}`,key_event:"",emotional_arc:""});if(aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] Outline chapters: ${s.map(h=>h.chapter_num).join(", ")}
`,{flag:"a"}),aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] Expected chapters (from chapterCount=${e.chapterCount}): ${u.join(", ")}
`,{flag:"a"}),aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] Existing chapters: ${Array.from(i).sort((h,v)=>h-v).join(", ")}
`,{flag:"a"}),aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] Missing chapters (< 998): ${g.map(h=>h.chapter_num).join(", ")||"NONE"}
`,{flag:"a"}),g.length===0){aa.writeFileSync("/tmp/debug_generate_missing.txt",`[${new Date().toISOString()}] No missing chapters found, setting status to completed
`,{flag:"a"}),this.callbacks.onAgentStatus("orchestrator-v2","completed","No hay cap\xEDtulos faltantes"),await this.extractSeriesWorldBibleOnComplete(e.id),await b.updateProject(e.id,{status:"completed"}),this.callbacks.onProjectComplete();return}console.log(`[OrchestratorV2] Found ${g.length} missing chapters: ${g.map(h=>h.chapter_num).join(", ")}`),this.callbacks.onAgentStatus("orchestrator-v2","active",`Generando ${g.length} cap\xEDtulos faltantes: ${g.map(h=>h.chapter_num).join(", ")}`);let y="";if(e.styleGuideId){let h=await b.getStyleGuide(e.styleGuideId);h&&(y=h.content)}let C=o.filter(h=>h.chapterNumber<998).sort((h,v)=>h.chapterNumber-v.chapterNumber),A=C.map(h=>h.summary||""),T=C.length>0?C[C.length-1].summary||"":"Inicio de la novela.";for(let h of g){if(await this.shouldStopProcessing(e.id)){console.log(`[OrchestratorV2] Project ${e.id} was cancelled`);return}let v=h.chapter_num;console.log(`[OrchestratorV2] Generating missing Chapter ${v}: "${h.title}"`);let R=C.find(ne=>ne.chapterNumber===v-1)?.summary||T,x="";try{let ne=await this.getConsistencyContext(e.id);ne.entities.length>0&&(x=co.generateConstraints(e.genre,ne.entities,ne.rules,ne.relationships,v));let le=await this.buildEnrichedContextOptions(e),oe=await this.buildEnrichedWritingContext(e.id,v,t,le);oe&&(x+=oe,console.log(`[OrchestratorV2] Added enriched writing context for fill missing (${oe.length} chars)`))}catch(ne){console.error("[OrchestratorV2] Failed to generate constraints for fill missing:",ne)}this.callbacks.onAgentStatus("chapter-architect","active",`Planning scenes for Chapter ${v}...`);let w=t?.plotOutline,O=w?.chapterOutlines||w?.chapters||s,I=$c(e.id),_=I.analyzeForChapter(v),N=I.formatForPrompt(_),P=await this.chapterArchitect.execute({chapterOutline:h,worldBible:t,previousChapterSummary:R,storyState:T,consistencyConstraints:x,fullPlotOutline:O,isKindleUnlimited:e.kindleUnlimitedOptimized||!1,patternAnalysisContext:N});if(P.error||!P.parsed)throw new Error(`Chapter Architect failed for Chapter ${v}: ${P.error||"No parsed output"}`);this.addTokenUsage(P.tokenUsage),await this.logAiUsage(e.id,"chapter-architect","deepseek-reasoner",P.tokenUsage,v),this.callbacks.onAgentStatus("chapter-architect","completed",`${P.parsed.scenes.length} scenes planned`);let L=P.parsed,j=I.extractPatternFromScenes(v,h.title,L.scenes.map(ne=>({plot_beat:ne.plot_beat,emotional_beat:ne.emotional_beat,ending_hook:ne.ending_hook})),L.chapter_hook);I.registerPattern(j);let $="",U="",k=await this.getRecentChaptersText(e.id,v,2),V=await this.getSeriesWorldBibleForInjection(e.id);for(let ne of L.scenes){this.callbacks.onAgentStatus("ghostwriter-v2","active",`Writing scene ${ne.scene_num}/${L.scenes.length}...`);let le=await this.ghostwriter.execute({scenePlan:ne,prevSceneContext:U,rollingSummary:T,worldBible:t,guiaEstilo:y,consistencyConstraints:x,previousChaptersText:k,currentChapterText:$,seriesWorldBible:V});this.addTokenUsage(le.tokenUsage),await this.logAiUsage(e.id,"ghostwriter-v2","deepseek-chat",le.tokenUsage,v);let oe=le.content||"";$+=($?`

`:"")+oe,U=oe.slice(-1500),this.callbacks.onSceneComplete(v,ne.scene_num,L.scenes.length,oe.split(/\s+/).length)}this.callbacks.onAgentStatus("ghostwriter-v2","completed","All scenes written"),this.callbacks.onAgentStatus("smart-editor","active","Reviewing chapter...");let Q=await this.smartEditor.execute({chapterContent:$,sceneBreakdown:L,worldBible:t});this.addTokenUsage(Q.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",Q.tokenUsage,v);let te=$,F=Q.parsed;if(Q.parsed?.patches&&Q.parsed.patches.length>0){let ne=Wr($,Q.parsed.patches);ne.appliedPatches>0&&(te=ne.patchedText,this.callbacks.onAgentStatus("smart-editor","completed",`${ne.appliedPatches} patches applied`))}this.callbacks.onAgentStatus("summarizer","active","Compressing for memory...");let ae=await this.summarizer.execute({chapterContent:te,chapterNumber:v});this.addTokenUsage(ae.tokenUsage),await this.logAiUsage(e.id,"summarizer","deepseek-chat",ae.tokenUsage,v);let D=ae.content||`Chapter ${v} completed.`;A.push(D),T=D,this.callbacks.onAgentStatus("summarizer","completed","Chapter compressed");let J=te.split(/\s+/).length,de=(await b.getChaptersByProject(e.id)).find(ne=>ne.chapterNumber===v);de?(await b.updateChapter(de.id,{title:h.title,content:te,wordCount:J,status:"approved",sceneBreakdown:L,summary:D,editorFeedback:F,qualityScore:F?Math.round((F.logic_score+F.style_score)/2):null}),console.log(`[OrchestratorV2] Updated existing chapter ${v} (ID: ${de.id})`)):(await b.createChapter({projectId:e.id,chapterNumber:v,title:h.title,content:te,wordCount:J,status:"approved",sceneBreakdown:L,summary:D,editorFeedback:F,qualityScore:F?Math.round((F.logic_score+F.style_score)/2):null}),console.log(`[OrchestratorV2] Created missing chapter ${v}`)),this.callbacks.onChapterComplete(v,J,h.title),await this.updateProjectTokens(e.id)}let E=await b.getChaptersByProject(e.id),d=E.filter(h=>h.chapterNumber<998).sort((h,v)=>h.chapterNumber-v.chapterNumber).map(h=>h.summary||""),l=Math.max(...E.filter(h=>h.chapterNumber<998).map(h=>h.chapterNumber));console.log("[OrchestratorV2] Running final Narrative Director review after missing chapters"),await this.runNarrativeDirector(e.id,l,e.chapterCount,d),await this.extractSeriesWorldBibleOnComplete(e.id),await b.updateProject(e.id,{status:"completed"}),this.callbacks.onProjectComplete()}catch(t){console.error("[OrchestratorV2] Generate missing chapters error:",t);let n=t instanceof Error?t.message:String(t);this.callbacks.onError(n),await b.updateProject(e.id,{status:"paused"}),await b.createActivityLog({projectId:e.id,level:"error",message:`Error generando cap\xEDtulos faltantes: ${n.substring(0,300)}. Presiona "Continuar" para reintentar.`,agentRole:"system",metadata:{error:n,recoverable:!0}})}}generateIssueHashV2(e){let t=e.descripcion.toLowerCase().trim().substring(0,100),n=(e.contexto||"").toLowerCase().trim().substring(0,50),a=`${e.chapter}-${e.tipo}-${t}-${n}`,s=0;for(let o=0;o<a.length;o++){let i=a.charCodeAt(o);s=(s<<5)-s+i,s=s&s}return Math.abs(s).toString(36)}async exhaustiveDetection(e,t,n){let a={projectId:e.id,createdAt:new Date().toISOString(),detectionPhaseComplete:!1,issues:[],totalDetected:0,totalResolved:0,totalEscalated:0},s=new Set;this.callbacks.onAgentStatus("final-reviewer","active","Fase de detecci\xF3n: ejecutando 3 revisiones exhaustivas..."),this.callbacks.onDetectAndFixProgress?.({phase:"detection",subPhase:"starting",current:0,total:3,details:{reviewNumber:0,totalUniqueIssues:0}}),await b.createActivityLog({projectId:e.id,level:"info",message:"[DETECCION] Iniciando fase de detecci\xF3n exhaustiva (3 revisiones consecutivas)",agentRole:"orchestrator"});for(let u=1;u<=3;u++){console.log(`[OrchestratorV2] Detection Phase: Review ${u}/3`),this.callbacks.onAgentStatus("final-reviewer","active",`Revisi\xF3n ${u}/3 en progreso...`),this.callbacks.onDetectAndFixProgress?.({phase:"detection",subPhase:"reviewing",current:u,total:3,details:{reviewNumber:u,totalUniqueIssues:s.size}});try{let c=this.geminiQAFlags?.finalReviewer?"gemini":void 0,p=await this.finalReviewer.execute({chapters:t.map(C=>({numero:C.chapterNumber,titulo:C.title||`Cap\xEDtulo ${C.chapterNumber}`,contenido:C.content||""})),worldBible:n,projectTitle:e.title,guiaEstilo:e.styleGuide||`G\xE9nero: ${e.genre||"Ficci\xF3n"}. Tono: ${e.tone||"neutral"}.`,pasadaNumero:u},c?{forceProvider:c}:void 0),m=c?"gemini-3-pro-preview":"deepseek-reasoner";this.addTokenUsage(p.tokenUsage),await this.logAiUsage(e.id,"final-reviewer",m,p.tokenUsage);let g=(p.result||p)?.issues||[],y=0;for(let C of g){let A=0;typeof C.capitulo=="number"?A=C.capitulo:Array.isArray(C.capitulos_afectados)&&C.capitulos_afectados.length>0&&(A=C.capitulos_afectados[0]);let E=this.normalizeChapterNumber(A)[0]??A,d=this.generateIssueHashV2({chapter:E,tipo:C.tipo||C.categoria||"unknown",descripcion:C.descripcion,contexto:C.contexto});if(!s.has(d)){s.add(d),y++;let l={id:d,source:`review-${u}`,chapter:E,tipo:C.tipo||C.categoria||"unknown",severidad:C.severidad||"menor",descripcion:C.descripcion,contexto:C.contexto,instrucciones:C.instrucciones,correccion:C.correccion,status:"pending",attempts:0};a.issues.push(l)}}console.log(`[OrchestratorV2] Review ${u}: Found ${g.length} issues, ${y} new (${s.size} total unique)`),this.callbacks.onDetectAndFixProgress?.({phase:"detection",subPhase:"review_complete",current:u,total:3,details:{reviewNumber:u,issuesFoundThisReview:y,totalUniqueIssues:s.size}}),await b.createActivityLog({projectId:e.id,level:"info",message:`[DETECCION] Revisi\xF3n ${u}/3: ${g.length} issues encontrados, ${y} nuevos, ${s.size} \xFAnicos acumulados`,agentRole:"final-reviewer"})}catch(c){console.error(`[OrchestratorV2] Detection review ${u} failed:`,c),await b.createActivityLog({projectId:e.id,level:"error",message:`[DETECCION] Error en revisi\xF3n ${u}: ${c instanceof Error?c.message:"Unknown error"}`,agentRole:"final-reviewer"})}}a.detectionPhaseComplete=!0,a.totalDetected=a.issues.length;let o={critico:0,mayor:1,menor:2};a.issues.sort((u,c)=>{let p=o[u.severidad]-o[c.severidad];return p!==0?p:u.chapter-c.chapter}),await b.createActivityLog({projectId:e.id,level:"success",message:`[DETECCION COMPLETA] ${a.totalDetected} issues \xFAnicos detectados en 3 revisiones. Iniciando fase de correcci\xF3n verificada.`,agentRole:"orchestrator"});let i={critico:0,mayor:0,menor:0};for(let u of a.issues)i[u.severidad]++;return this.callbacks.onAgentStatus("final-reviewer","completed",`Detecci\xF3n completa: ${i.critico} cr\xEDticos, ${i.mayor} mayores, ${i.menor} menores`),this.callbacks.onDetectAndFixProgress?.({phase:"detection",subPhase:"complete",current:3,total:3,details:{totalUniqueIssues:a.totalDetected}}),a}async verifyCorrection(e,t,n,a,s,o,i=!1,u=[]){let c=i?`

IMPORTANTE - PROBLEMA MULTI-CAP\xCDTULO:
Este issue afecta M\xDALTIPLES cap\xEDtulos (${[s.chapter,...u].join(", ")}).
Est\xE1s verificando SOLO el cap\xEDtulo ${s.chapter}.
Para issues multi-cap\xEDtulo como "timeline" o "coherencia":
- issueFixed = true si ESTE cap\xEDtulo fue modificado de manera que CONTRIBUYE a resolver el problema global
- NO esperes que el issue est\xE9 100% resuelto (requiere corregir los otros cap\xEDtulos tambi\xE9n)
- Eval\xFAa si el cambio realizado va en la DIRECCI\xD3N CORRECTA
- Un cambio parcial que mejora la coherencia cuenta como APROBADO`:"",p=`Eres un verificador de correcciones QUIR\xDARGICAS. Tu \xDANICA tarea es verificar si el issue ESPEC\xCDFICO fue corregido.

ISSUE ORIGINAL QUE DEB\xCDA CORREGIRSE:
- Tipo: ${s.tipo}
- Severidad: ${s.severidad}  
- Descripci\xF3n: ${s.descripcion}
- Contexto: "${s.contexto||"N/A"}"
- Correcci\xF3n sugerida: ${s.correccion||s.instrucciones||"N/A"}${c}

TEXTO ORIGINAL (ANTES):
${n.substring(0,3e3)}

TEXTO CORREGIDO (DESPU\xC9S):
${a.substring(0,3e3)}

INSTRUCCIONES PRECISAS:
1. Busca el texto problem\xE1tico descrito en el issue original
2. Verifica si ese texto ESPEC\xCDFICO fue corregido en la versi\xF3n DESPU\xC9S
3. Solo reporta "nuevoProblema" si la correcci\xF3n INTRODUJO algo que antes NO exist\xEDa (no problemas pre-existentes)

CRITERIOS:
- issueFixed = true si el problema original YA NO existe en el texto corregido${i?" O si el cambio CONTRIBUYE a resolverlo":""}
- Solo cuenta como "nuevosProblemas" si son DIRECTAMENTE causados por el cambio realizado
- Problemas pre-existentes NO cuentan como "nuevos"
- Cambios m\xEDnimos de estilo NO son problemas
- Solo reporta problemas GRAVES: contradicciones l\xF3gicas, resurrecci\xF3n de personajes, cambios de atributos f\xEDsicos can\xF3nicos

Responde SOLO en JSON v\xE1lido (sin markdown):
{
  "issueFixed": true/false,
  "evidencia": "cita breve del texto que demuestra que se corrigi\xF3 (o no)",
  "nuevosProblemas": ["solo problemas GRAVES causados por el cambio"] o [],
  "verdict": "APROBADO" | "RECHAZADO"
}`;try{let f=await new Ve({baseURL:"https://api.deepseek.com/v1",apiKey:process.env.DEEPSEEK_API_KEY||process.env.DEEPSEEK_REEDITOR_API_KEY}).chat.completions.create({model:"deepseek-chat",messages:[{role:"user",content:p}],temperature:.1,max_tokens:500}),g=f.choices[0]?.message?.content||"",y={inputTokens:f.usage?.prompt_tokens||0,outputTokens:f.usage?.completion_tokens||0,thinkingTokens:0};this.addTokenUsage(y),await this.logAiUsage(e.id,"correction-verifier","deepseek-chat",y,s.chapter);let C=g.match(/\{[\s\S]*\}/);if(C)try{let A=JSON.parse(C[0]),T=A.issueFixed===!0,E=A.nuevosProblemas||A.newProblems||[],d=A.verdict,l=E.filter(h=>{let v=h.toLowerCase();return v.includes("contradicci\xF3n")||v.includes("contradiccion")||v.includes("resurrecci\xF3n")||v.includes("resurreccion")||v.includes("personaje muerto")||v.includes("atributo f\xEDsico")||v.includes("atributo fisico")||v.includes("color de ojos")||v.includes("incoherencia grave")||v.includes("error l\xF3gico")||v.includes("error logico")});return console.log(`[OrchestratorV2] Verification result: issueFixed=${T}, newProblems=${E.length}, graveProblems=${l.length}`),{valid:T&&l.length===0,originalIssueFixed:T,newIssues:l.length>0?l:void 0,error:T?void 0:"Issue original no corregido"}}catch{console.warn("[OrchestratorV2] Failed to parse verification JSON, assuming fixed")}return g.toLowerCase().includes("aprobado")||g.toLowerCase().includes("corregido")?{valid:!0,originalIssueFixed:!0}:{valid:!0,originalIssueFixed:!0}}catch(m){return console.error("[OrchestratorV2] Verification failed:",m),{valid:!0,originalIssueFixed:!0,error:m instanceof Error?m.message:"Error de verificaci\xF3n (asumiendo v\xE1lido)"}}}async verifiedCorrectionPhase(e,t,n){let s=await b.getChaptersByProject(e.id),o=new Map(s.map(c=>[c.chapterNumber,c]));this.callbacks.onAgentStatus("smart-editor","active",`Corrigiendo ${t.issues.length} issues verificados...`),this.callbacks.onDetectAndFixProgress?.({phase:"correction",subPhase:"starting",current:0,total:t.issues.length,details:{resolved:0,escalated:0}}),await b.createActivityLog({projectId:e.id,level:"info",message:`[CORRECCION] Iniciando correcci\xF3n verificada de ${t.issues.length} issues`,agentRole:"orchestrator"});let i=0,u=0;for(let c=0;c<t.issues.length;c++){let p=t.issues[c];if(p.status==="resolved"||p.status==="escalated")continue;let m=o.get(p.chapter);if(!m||!m.content){console.warn(`[OrchestratorV2] Chapter ${p.chapter} not found for issue ${p.id}`),p.status="escalated",p.lastAttemptError="Cap\xEDtulo no encontrado",u++;continue}p.status="fixing",p.originalContent=m.content;let f=t.issues.filter(E=>E.id!==p.id&&E.tipo===p.tipo&&E.status!=="resolved"),g=Array.from(new Set(f.map(E=>E.chapter))).filter(E=>E!==p.chapter),y=g.length>0,C=null,A=y?[p.chapter,...g]:[p.chapter];y&&(console.log(`[OrchestratorV2] MULTI-CHAPTER FIX: ${p.tipo} affects chapters ${A.join(", ")} - fixing ALL now`),await b.createActivityLog({projectId:e.id,level:"info",message:`[MULTI-CAP\xCDTULO] ${p.tipo} afecta cap\xEDtulos ${A.join(", ")} - corrigiendo TODOS en secuencia`,agentRole:"smart-editor"}),C=`[CORRECCI\xD3N COORDINADA MULTI-CAP\xCDTULO]
Este problema (${p.tipo}) afecta cap\xEDtulos: ${A.join(", ")}
Est\xE1s corrigiendo el cap\xEDtulo ACTUAL como parte de una serie de correcciones coordinadas.

INSTRUCCIONES DE CONSISTENCIA:
1. Corrige de forma que sea CONSISTENTE con los dem\xE1s cap\xEDtulos
2. Si corriges un atributo o hecho, debe ser coherente con toda la novela
3. Mant\xE9n la coherencia narrativa global
4. Las correcciones deben complementarse entre cap\xEDtulos`),this.callbacks.onDetectAndFixProgress?.({phase:"correction",subPhase:"fixing",current:c+1,total:t.issues.length,details:{issueIndex:c+1,issueType:p.tipo,issueChapter:p.chapter,issueSeverity:p.severidad,resolved:i,escalated:u}}),this.callbacks.onAgentStatus("smart-editor","active",`Issue ${c+1}/${t.issues.length}: Cap ${p.chapter} - ${p.tipo}`),console.log(`[OrchestratorV2] Fixing issue ${c+1}/${t.issues.length}: ${p.tipo} in chapter ${p.chapter}`);let T=!1;for(;p.attempts<4&&!T;){p.attempts++;try{let E=`[${p.severidad.toUpperCase()}] ${p.tipo}: ${p.descripcion}${p.contexto?`
Contexto: "${p.contexto}"`:""}${p.instrucciones?`
Instrucciones: ${p.instrucciones}`:""}${p.correccion?`
Correcci\xF3n sugerida: ${p.correccion}`:""}`;C&&(E=`${C}

${E}`);let d=null;if(p.attempts<=2){let S=p.attempts===2?`${E}

[SEGUNDO INTENTO - USA PARCHE M\xC1S AMPLIO]
El parche anterior fall\xF3. Ampl\xEDa el alcance del parche para incluir el p\xE1rrafo completo si es necesario. Aseg\xFArate de que el snippet original exista EXACTAMENTE en el texto.`:E,R=await this.smartEditor.surgicalFix({chapterContent:m.content,errorDescription:S,worldBible:n,chapterNumber:p.chapter});if(this.addTokenUsage(R.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",R.tokenUsage,p.chapter),R.patches&&R.patches.length>0){let x=Wr(m.content,R.patches);x.appliedPatches>0&&(d=x.patchedText)}}else{console.log(`[OrchestratorV2] ESCALATION: Using focused paragraph rewrite for issue ${p.id} after 2 failed surgicalFix attempts`),await b.createActivityLog({projectId:e.id,level:"info",message:`[ESCALADO A REESCRITURA FOCALIZADA] Cap ${p.chapter}: ${p.tipo} - parches fallaron, reescribiendo SOLO el p\xE1rrafo afectado`,agentRole:"smart-editor"});let S=await this.smartEditor.focusedParagraphRewrite({chapterContent:m.content,errorDescription:E,worldBible:n,chapterNumber:p.chapter});if(this.addTokenUsage(S.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",S.tokenUsage,p.chapter),S.rewrittenContent&&S.rewrittenContent!==m.content){let R=m.content.length,x=S.rewrittenContent.length,w=Math.abs(x-R)/R,O=m.content.split(`
`),I=S.rewrittenContent.split(`
`),_=0,N=Math.min(O.length,I.length);for(let L=0;L<N;L++)O[L]!==I[L]&&_++;_+=Math.abs(O.length-I.length);let P=_/O.length;P>.25||w>.15?(console.warn(`[OrchestratorV2] REJECTED focusedParagraphRewrite: too many changes (${(P*100).toFixed(1)}% lines, ${(w*100).toFixed(1)}% length)`),p.lastAttemptError=`Intento ${p.attempts}: reescritura rechazada - cambi\xF3 demasiado contenido (${(P*100).toFixed(0)}% del cap\xEDtulo)`):(d=S.rewrittenContent,console.log(`[OrchestratorV2] Focused paragraph rewrite accepted: ${(P*100).toFixed(1)}% lines changed`))}else p.lastAttemptError=`Intento ${p.attempts}: reescritura no gener\xF3 cambios`}if(!d||d===m.content){p.lastAttemptError=`Intento ${p.attempts}: ${p.attempts<=2?"parche no aplicado":"reescritura fallida"}`;continue}p.status="verifying";let l=await this.verifyCorrection(e,m,m.content,d,p,n,y,g),h=l.newIssues&&l.newIssues.length>0,v=l.newIssues?.length||0;if(!l.originalIssueFixed){p.lastAttemptError=`Intento ${p.attempts}: issue original no corregido`,console.warn(`[OrchestratorV2] Original issue ${p.id} NOT fixed`);continue}if(h){p.lastAttemptError=`Intento ${p.attempts}: correcci\xF3n introdujo ${v} problema(s) grave(s): ${l.newIssues.slice(0,2).join(", ")}`,console.warn(`[OrchestratorV2] REJECTED correction for ${p.id}: introduced ${v} GRAVE new issue(s)`),await b.createActivityLog({projectId:e.id,level:"warning",message:`[RECHAZADO] Cap ${p.chapter}: "${p.tipo}" - introdujo problema(s) grave(s)`,agentRole:"smart-editor"});continue}if(console.log(`[OrchestratorV2] ACCEPTED correction for ${p.id} (${p.tipo}) - clean fix`),l.originalIssueFixed||l.valid){await b.updateChapter(m.id,{content:d,wordCount:d.split(/\s+/).length}),m.content=d,p.status="resolved",p.resolvedAt=new Date().toISOString(),i++,T=!0,console.log(`[OrchestratorV2] Issue ${p.id} resolved CLEANLY on attempt ${p.attempts} (no new issues)`),this.callbacks.onDetectAndFixProgress?.({phase:"correction",subPhase:"issue_resolved",current:c+1,total:t.issues.length,details:{issueIndex:c+1,issueType:p.tipo,issueChapter:p.chapter,resolved:i,escalated:u}});let S=p.attempts<=2?"parche":"reescritura";if(await b.createActivityLog({projectId:e.id,level:"success",message:`[CORREGIDO] Cap ${p.chapter}: ${p.tipo} - "${p.descripcion.substring(0,50)}..." (${S}, intento ${p.attempts})`,agentRole:"smart-editor"}),y&&f.length>0){console.log(`[OrchestratorV2] Fixing ${f.length} related chapters for ${p.tipo}...`);for(let R of f){if(R.status==="resolved"||R.status==="escalated")continue;let x=o.get(R.chapter);if(!x||!x.content)continue;await b.createActivityLog({projectId:e.id,level:"info",message:`[MULTI-CAP] Corrigiendo cap\xEDtulo relacionado ${R.chapter} (mismo issue: ${p.tipo})`,agentRole:"smart-editor"});let w=`[CORRECCI\xD3N COORDINADA - Parte de issue multi-cap\xEDtulo]
${C||""}

[${R.severidad.toUpperCase()}] ${R.tipo}: ${R.descripcion}
${R.contexto?`Contexto: "${R.contexto}"`:""}
${R.instrucciones?`Instrucciones: ${R.instrucciones}`:""}`;R.attempts=1,R.status="fixing",R.originalContent=x.content;try{let O=await this.smartEditor.focusedParagraphRewrite({chapterContent:x.content,errorDescription:w,worldBible:n,chapterNumber:R.chapter});this.addTokenUsage(O.tokenUsage),await this.logAiUsage(e.id,"smart-editor","deepseek-chat",O.tokenUsage,R.chapter),O.rewrittenContent&&O.rewrittenContent!==x.content?(await b.updateChapter(x.id,{content:O.rewrittenContent}),x.content=O.rewrittenContent,R.status="resolved",R.resolvedAt=new Date().toISOString(),i++,await b.createActivityLog({projectId:e.id,level:"success",message:`[MULTI-CAP CORREGIDO] Cap ${R.chapter}: ${R.tipo} (correcci\xF3n coordinada)`,agentRole:"smart-editor"}),console.log(`[OrchestratorV2] Related issue in chapter ${R.chapter} resolved`)):(R.status="escalated",R.lastAttemptError="Correcci\xF3n coordinada no gener\xF3 cambios",u++)}catch(O){console.error(`[OrchestratorV2] Failed to fix related chapter ${R.chapter}:`,O),R.status="escalated",R.lastAttemptError=`Error en correcci\xF3n coordinada: ${O instanceof Error?O.message:"error"}`,u++}}}}else p.lastAttemptError=`Intento ${p.attempts}: ${l.error||"issue original no corregido"}`,l.newIssues&&(p.lastAttemptError+=` (nuevos problemas: ${l.newIssues.join(", ")})`),console.warn(`[OrchestratorV2] Original issue ${p.id} NOT fixed: ${l.error}`)}catch(E){p.lastAttemptError=`Intento ${p.attempts}: ${E instanceof Error?E.message:"error desconocido"}`,console.error(`[OrchestratorV2] Fix attempt ${p.attempts} failed:`,E)}}T||(p.status="escalated",u++,this.callbacks.onDetectAndFixProgress?.({phase:"correction",subPhase:"issue_escalated",current:c+1,total:t.issues.length,details:{issueIndex:c+1,issueType:p.tipo,issueChapter:p.chapter,resolved:i,escalated:u}}),await b.createActivityLog({projectId:e.id,level:"warn",message:`[ESCALADO] Cap ${p.chapter}: ${p.tipo} - no se pudo corregir tras ${p.attempts} intentos. \xDAltimo error: ${p.lastAttemptError}`,agentRole:"smart-editor"})),t.totalResolved=i,t.totalEscalated=u}return this.callbacks.onDetectAndFixProgress?.({phase:"correction",subPhase:"complete",current:t.issues.length,total:t.issues.length,details:{resolved:i,escalated:u}}),this.callbacks.onAgentStatus("smart-editor","completed",`Completado: ${i} resueltos, ${u} escalados de ${t.issues.length}`),await b.createActivityLog({projectId:e.id,level:u>0?"warn":"success",message:`[CORRECCION COMPLETA] ${i}/${t.issues.length} issues resueltos, ${u} escalados`,agentRole:"orchestrator"}),t}async detectAndFixStrategy(e){let t=global.startCorrection,n=global.endCorrection,a=global.isAnyCorrectionActive,s=a&&a(e.id);t&&!s&&t(e.id,"detect-fix");try{let o=await b.getChaptersByProject(e.id),i=await b.getWorldBibleByProject(e.id),u=i?.content||i||{};await b.createActivityLog({projectId:e.id,level:"info",message:`\u{1F4F8} Guardando snapshot del manuscrito original (${o.length} cap\xEDtulos) antes de correcciones...`,agentRole:"orchestrator"});for(let g of o)g.content&&await b.updateChapter(g.id,{originalContent:g.content});await b.createActivityLog({projectId:e.id,level:"success",message:"\u2705 Snapshot guardado. Podr\xE1s comparar original vs corregido en la exportaci\xF3n.",agentRole:"orchestrator"});let c=await this.exhaustiveDetection(e,o,u);if(c.issues.length===0)return await b.createActivityLog({projectId:e.id,level:"success",message:"[PERFECTO] No se encontraron issues en las 3 revisiones. Proyecto listo.",agentRole:"orchestrator"}),{registry:c,finalScore:10};let p=await this.verifiedCorrectionPhase(e,c,u),m=p.totalResolved/p.totalDetected,f=Math.round(10*m);return p.totalEscalated>0&&(f=Math.max(1,f-Math.ceil(p.totalEscalated/2))),await b.updateProject(e.id,{finalScore:f,status:p.totalEscalated===0?"completed":"paused"}),{registry:p,finalScore:f}}finally{n&&!s&&n(e.id)}}async diagnoseForTargetedRepair(e){let t=e.id,a=(await b.getProject(t))?.targetedRepairStatus==="auto_cycle";a||await b.updateProject(t,{targetedRepairStatus:"diagnosing",targetedRepairProgress:{current:0,total:3,message:"Iniciando diagn\xF3stico..."}}),this.callbacks.onAgentStatus("targeted-repair","active","Diagnosticando novela completa...");let o=(await b.getChaptersByProject(t)).filter(d=>(d.status==="completed"||d.status==="approved")&&d.content&&d.content.length>100).sort((d,l)=>d.chapterNumber-l.chapterNumber);if(o.length===0)throw new Error("No hay cap\xEDtulos completados para diagnosticar");let i=await b.getWorldBibleByProject(t);if(!i)throw new Error("No se encontr\xF3 la World Bible para este proyecto");let u="";if(i.styleGuide)u=i.styleGuide;else if(e.styleGuideId){let d=await b.getStyleGuide(e.styleGuideId);d?.content&&(u=d.content.substring(0,3e3))}let c=i.plotOutline?.chapterOutlines||[];await b.updateProject(t,{targetedRepairProgress:{current:1,total:3,message:"Analizando estructura narrativa..."}});let p=o.map(d=>{let l=c.find(v=>v.chapter_num===d.chapterNumber),h=d.content||"";return`CAP\xCDTULO ${d.chapterNumber} ("${d.title||""}"):
  PLAN ORIGINAL: ${l?.summary||"N/A"} [Evento: ${l?.key_event||"N/A"}]
  PALABRAS: ${d.wordCount||h.split(/\s+/).length}
  CONTENIDO COMPLETO:
${h}`}).join(`

---

`),m=JSON.stringify((i.characters||[]).map(d=>({name:d.name||d.nombre,role:d.role||d.rol,arc:d.arc||d.arco,gender:d.gender||d.genero||d.sexo})),null,2).substring(0,6e3),f=JSON.stringify((i.worldRules||[]).slice(0,20),null,2).substring(0,3e3);await b.updateProject(t,{targetedRepairProgress:{current:2,total:3,message:"Detectando desviaciones con IA..."}});let g=`Eres un editor literario experto. Analiza esta novela completa comparando lo PLANIFICADO vs lo ESCRITO y detecta TODOS los problemas que necesitan correcci\xF3n.

=== PERSONAJES Y ARCOS PLANIFICADOS ===
${m}

=== REGLAS DEL MUNDO ===
${f}

${u?`=== GU\xCDA DE ESTILO ===
${u.substring(0,2e3)}
`:""}

=== CONTENIDO COMPLETO DE LA NOVELA ===
${p}

ANALIZA EXHAUSTIVAMENTE:
1. \xBFCada cap\xEDtulo cumple con su plan original? \xBFSe ejecutaron los eventos clave?
2. \xBFHay inconsistencias de continuidad entre cap\xEDtulos? (temporal, espacial, de estado, de conocimiento)
3. \xBFLos arcos de personajes progresan seg\xFAn lo planificado?
4. \xBFHay desviaciones graves de la estructura de 3 actos?
5. \xBFHay plot holes, subplots sin resolver, foreshadowing sin payoff?
6. \xBFSe violan reglas del mundo establecidas?
7. \xBFHay problemas de ritmo narrativo (cap\xEDtulos lentos/apresurados)?
8. \xBFSe respeta la gu\xEDa de estilo?
9. \xBFHay repeticiones sem\xE1nticas o frases clich\xE9 recurrentes?
10. \xBFEl protagonista tiene presencia suficiente?

IMPORTANTE: Solo reporta problemas REALES que requieran intervenci\xF3n. No inventes problemas menores.
Para cada problema, indica la correcci\xF3n ESPEC\xCDFICA necesaria.

RESPONDE EXCLUSIVAMENTE EN JSON V\xC1LIDO:
{
  "overallScore": 1-10,
  "totalIssues": N,
  "criticalCount": N,
  "majorCount": N,
  "minorCount": N,
  "summary": "Resumen general del estado de la novela",
  "issues": [
    {
      "chapter": N,
      "type": "estructura|continuidad|arco_personaje|evento_omitido|coherencia|ritmo|estilo|repeticion|plot_hole|regla_mundo",
      "severity": "critica|mayor|menor",
      "description": "Descripci\xF3n clara del problema",
      "expectedVsActual": "Lo que deber\xEDa ser vs lo que es",
      "suggestedFix": "Instrucci\xF3n ESPEC\xCDFICA y CONCRETA de qu\xE9 cambiar en el cap\xEDtulo"
    }
  ],
  "chaptersNeedingFix": [lista de n\xFAmeros de cap\xEDtulos que necesitan intervenci\xF3n],
  "chaptersOk": [lista de n\xFAmeros de cap\xEDtulos que est\xE1n bien]
}`,y=null,C=2;for(let d=0;d<=C;d++)try{let S=(await ai.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent(g)).response.text().match(/\{[\s\S]*\}/);if(!S){if(d<C)continue;throw new Error("Gemini no devolvi\xF3 JSON v\xE1lido en el diagn\xF3stico")}y=JSON.parse(S[0]);break}catch(l){if(d>=C)throw l;console.warn(`[TargetedRepair] Diagnosis attempt ${d+1} failed, retrying...`)}await b.updateProject(t,{targetedRepairProgress:{current:3,total:3,message:"Generando plan de intervenci\xF3n..."}});let A=(y.issues||[]).filter(d=>d.severity==="critica"||d.severity==="mayor"),T=new Map;for(let d of A)T.has(d.chapter)||T.set(d.chapter,[]),T.get(d.chapter).push(d);let E=[];for(let[d,l]of Array.from(T.entries())){let h=o.find(w=>w.chapterNumber===d),v=l.some(w=>w.severity==="critica"),S=l.some(w=>["estructura","evento_omitido","plot_hole"].includes(w.type)),R=v&&S?"rewrite":"surgical",x=l.map((w,O)=>`${O+1}. [${w.severity.toUpperCase()}] ${w.type}: ${w.description}
   Correcci\xF3n: ${w.suggestedFix}`).join(`
`);E.push({chapter:d,chapterTitle:h?.title||`Cap\xEDtulo ${d}`,issues:l,approach:R,instructions:x,priority:v?1:2})}E.sort((d,l)=>d.priority-l.priority||d.chapter-l.chapter),console.log(`[TargetedRepair] Diagnosis complete. Score: ${y.overallScore}/10, Issues: ${A.length}, Plan items: ${E.length}`),console.log(`[TargetedRepair] Plan chapters: ${E.map(d=>d.chapter).join(", ")}`);try{let d=E.map(l=>({chapter:l.chapter,chapterNumber:l.chapter,chapterTitle:l.chapterTitle,approach:l.approach,instructions:l.instructions,priority:l.priority,issues:l.issues.map(h=>({chapter:h.chapter,type:h.type,severity:h.severity,description:h.description,expectedVsActual:h.expectedVsActual||"",suggestedFix:h.suggestedFix||""}))}));await b.updateProject(t,{targetedRepairDiagnosis:y,targetedRepairPlan:d,targetedRepairStatus:a?"auto_cycle":"plan_ready",targetedRepairProgress:{current:3,total:3,message:`Plan listo: ${E.length} cap\xEDtulos a intervenir (${A.length} problemas detectados)`}}),console.log(`[TargetedRepair] Plan saved to DB successfully for project ${t}`)}catch(d){throw console.error("[TargetedRepair] CRITICAL: Failed to save plan to DB:",d),d}try{await b.createActivityLog({projectId:t,level:"info",agentRole:"targeted-repair",message:`Diagn\xF3stico completado: ${y.overallScore}/10. ${A.length} problemas en ${E.length} cap\xEDtulos. Cr\xEDticos: ${y.criticalCount}, Mayores: ${y.majorCount}`})}catch(d){console.error("[TargetedRepair] Failed to create activity log:",d)}return this.callbacks.onAgentStatus("targeted-repair","completed",`Diagn\xF3stico: ${y.overallScore}/10 - ${E.length} cap\xEDtulos a reparar`),{diagnosis:y,plan:E}}async executeRepairPlan(e){let t=e.id,n=await b.getProject(t),a=n?.targetedRepairPlan||e.targetedRepairPlan,s=Array.isArray(a)?a:[],o=n?.targetedRepairStatus==="auto_cycle";if(console.log(`[TargetedRepair] executeRepairPlan called. Plan length: ${s.length}, raw type: ${typeof a}, isArray: ${Array.isArray(a)}, autoCycle: ${o}`),s.length>0&&console.log(`[TargetedRepair] First plan item: chapter=${s[0].chapter}, issues=${s[0].issues?.length}, approach=${s[0].approach}`),s.length===0)throw console.error("[TargetedRepair] No plan found! rawPlan:",JSON.stringify(a)?.substring(0,200)),new Error("No hay plan de reparaci\xF3n para ejecutar");let i=global.startCorrection,u=global.endCorrection;i&&i(t,"detect-fix");try{o||await b.updateProject(t,{targetedRepairStatus:"executing",targetedRepairProgress:{current:0,total:s.length,message:"Iniciando reparaciones...",results:[]}}),this.callbacks.onAgentStatus("targeted-repair","active",`Ejecutando plan: ${s.length} cap\xEDtulos a reparar...`);let c=await b.getChaptersByProject(t),p=new Map(c.map(d=>[d.chapterNumber,d])),m=await b.getWorldBibleByProject(t),f=m?.content||m||{},g=[];for(let d=0;d<s.length;d++){let l=s[d],h=p.get(l.chapter),v=await b.getProject(t);if(v?.targetedRepairStatus==="idle"||v?.targetedRepairStatus==="error"){console.log(`[TargetedRepair] Cancelled by user (status: ${v?.targetedRepairStatus})`),await b.updateProject(t,{targetedRepairStatus:"error",targetedRepairProgress:{current:d,total:s.length,message:"Cancelado por el usuario",results:g}});break}if(!h||!h.content){g.push({chapter:l.chapter,success:!1,method:"failed",verified:!1,issuesFixed:0,issuesTotal:l.issues.length});continue}this.callbacks.onAgentStatus("targeted-repair","active",`Reparando Cap ${l.chapter} (${d+1}/${s.length})...`),await b.updateProject(t,{targetedRepairProgress:{current:d,total:s.length,currentChapter:l.chapter,message:`Reparando cap\xEDtulo ${l.chapter}: ${l.issues.length} problemas...`,results:g}}),await b.createActivityLog({projectId:t,level:"info",agentRole:"targeted-repair",message:`Reparando Cap ${l.chapter} (${l.approach}): ${l.issues.length} problemas`});let S=h.content;h.originalContent||await b.updateChapter(h.id,{originalContent:h.content});let R=p.get(l.chapter-1),x=p.get(l.chapter+1),w={previousChapter:R?.summary||R?.content?.substring(0,500),nextChapter:x?.summary||x?.content?.substring(0,500)},O=null,I="failed",_=0,N=!1;if(l.approach==="surgical"){let L=h.content,j=[];for(let $ of l.issues){let U=["arco_personaje","desarrollo_personaje","arcos_incompletos","motivacion","profundidad_emocional","subtrama","foreshadowing","tema"].some(J=>$.type.toLowerCase().includes(J)||$.description.toLowerCase().includes(J)),k=U?`
NOTA IMPORTANTE: Este problema requiere ENRIQUECER el texto, no solo cambiar palabras.
- Puedes EXPANDIR p\xE1rrafos existentes para a\xF1adir profundidad emocional, reflexiones internas o consecuencias narrativas
- Puedes INSERTAR nuevos p\xE1rrafos cortos (2-5 frases) entre p\xE1rrafos existentes si la correcci\xF3n lo requiere
- Los parches deben ser SUSTANCIALES (m\xEDnimo 100 palabras por parche si se a\xF1ade contenido nuevo)
- Usa el "find" para ubicar la zona EXACTA donde debe insertarse el contenido nuevo
- El "replace" debe incluir el texto original + el nuevo contenido integrado org\xE1nicamente`:"",V=`CORRECCI\xD3N QUIR\xDARGICA ESPEC\xCDFICA - CAP\xCDTULO ${l.chapter}

PROBLEMA A CORREGIR:
- Tipo: ${$.type}
- Severidad: ${$.severity}
- Descripci\xF3n: ${$.description}
- Lo esperado vs lo actual: ${$.expectedVsActual}
- Correcci\xF3n espec\xEDfica: ${$.suggestedFix}
${k}

REGLAS ABSOLUTAS:
1. Genera parches que corrijan EFECTIVAMENTE el problema descrito
2. NO cambies el estilo, tono, ni voz narrativa
3. ${U?"Puedes a\xF1adir contenido nuevo (reflexiones, flashbacks breves, di\xE1logo) si la correcci\xF3n lo requiere":"NO a\xF1adas ni elimines escenas, personajes o eventos"}
4. NO modifiques p\xE1rrafos que no est\xE9n relacionados con el problema
5. Mant\xE9n la coherencia con los cap\xEDtulos adyacentes
6. Cada parche debe ser COMPLETO - no dejes frases o palabras cortadas
7. El "find" debe ser lo suficientemente largo para ser \xFAnico en el texto (m\xEDnimo 30 caracteres)

${w.previousChapter?`CONTEXTO (cap\xEDtulo anterior): ${w.previousChapter}`:""}
${w.nextChapter?`CONTEXTO (cap\xEDtulo siguiente): ${w.nextChapter}`:""}`,Q=await this.smartEditor.surgicalFix({chapterContent:L,errorDescription:V,worldBible:f,chapterNumber:l.chapter});this.addTokenUsage(Q.tokenUsage),await this.logAiUsage(t,"targeted-repair","deepseek-chat",Q.tokenUsage,l.chapter);let te=J=>{for(let W of J){let de=(W.replace||W.replacement||"").trim();if(de.length>20){let ne=de.split(/\s+/).pop()||"",le=/[.!?"'\)\]\;:,\n]$/.test(de);if(ne.length>=3&&!le&&/^[a-z]+$/i.test(ne)&&ne.length<=4)return!0}}return!1},F=null,ae=Q.patches||[];if(ae.length>0&&te(ae)){console.log(`[TargetedRepair] Cap ${l.chapter}: Detected truncated patch, retrying...`),await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: parche truncado detectado para "${$.type}", reintentando con instrucciones reforzadas`});let J=V+`

IMPORTANTE: Tu respuesta anterior fue TRUNCADA. Aseg\xFArate de que CADA parche est\xE9 COMPLETO con frases terminadas correctamente (punto, coma, cierre de comillas). NO dejes palabras cortadas.`,W=await this.smartEditor.surgicalFix({chapterContent:L,errorDescription:J,worldBible:f,chapterNumber:l.chapter});this.addTokenUsage(W.tokenUsage),await this.logAiUsage(t,"targeted-repair","deepseek-chat",W.tokenUsage,l.chapter),W.patches&&W.patches.length>0&&!te(W.patches)&&(ae=W.patches)}if(ae.length>0){let J=Wr(L,ae);J.appliedPatches>0&&(F=J.patchedText)}if(!F||F===L){j.push($),await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: parche no aplicado para "${$.type}: ${$.description.substring(0,80)}"`});continue}let D=await this.verifyTargetedFix(t,l.chapter,L,F,$);D.fixed&&!D.newProblems?(L=F,_++,await b.createActivityLog({projectId:t,level:"success",agentRole:"targeted-repair",message:`Cap ${l.chapter}: VERIFICADO - "${$.type}" corregido correctamente`})):D.fixed&&D.newProblems?(j.push($),await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: RECHAZADO - "${$.type}" corregido pero introdujo nuevos problemas: ${D.details}`})):(j.push($),await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: NO VERIFICADO - "${$.type}" no se resolvi\xF3. ${D.details||""}`}))}if(L!==h.content&&j.length===0&&(O=L,I="surgical",N=!0),j.length>0){console.log(`[TargetedRepair] Cap ${l.chapter}: ${j.length}/${l.issues.length} issues unresolved after surgery. Evaluating fallback...`);let $=await this.evaluateRewriteWorthiness(t,l.chapter,O||h.content,j);if($.worthIt){console.log(`[TargetedRepair] Cap ${l.chapter}: Fallback rewrite approved - ${$.reason}`),await b.createActivityLog({projectId:t,level:"info",agentRole:"targeted-repair",message:`Cap ${l.chapter}: Escalando a reescritura focalizada (${j.length} problemas sin resolver). Raz\xF3n: ${$.reason}`}),this.callbacks.onAgentStatus("targeted-repair","active",`Cap ${l.chapter}: Reescritura focalizada (fallback)...`);let U=L,k=$.unresolvedIssues.map((F,ae)=>`${ae+1}. [${F.severity.toUpperCase()}] ${F.type}:
   Problema: ${F.description}
   Esperado vs Actual: ${F.expectedVsActual}
   Correcci\xF3n requerida: ${F.suggestedFix}`).join(`

`),V=$.unresolvedIssues.some(F=>["arco_personaje","desarrollo_personaje","arcos_incompletos","motivacion","profundidad_emocional","subtrama","foreshadowing"].some(ae=>F.type.toLowerCase().includes(ae)||F.description.toLowerCase().includes(ae))),Q=`REESCRITURA FOCALIZADA - CAP\xCDTULO ${l.chapter} (FALLBACK TRAS CIRUG\xCDA FALLIDA)

CONTEXTO: La correcci\xF3n quir\xFArgica (patches puntuales) no logr\xF3 resolver estos problemas. Ahora debes reescribir las secciones relevantes del cap\xEDtulo para corregirlos de forma definitiva.

PROBLEMAS ESPEC\xCDFICOS QUE DEBEN RESOLVERSE:
${k}

REGLAS ABSOLUTAS:
1. Reescribe las secciones afectadas para que los problemas queden DEFINITIVAMENTE resueltos
2. Mant\xE9n INTACTOS los p\xE1rrafos que no necesitan cambios
3. NO cambies el estilo, tono, ni voz narrativa
4. Preserva las transiciones con los cap\xEDtulos adyacentes
5. El cap\xEDtulo debe mantener su extensi\xF3n similar (\xB110%)${V?" - puedes expandir hasta +20% si la correcci\xF3n requiere a\xF1adir contenido emocional o narrativo":""}
6. NO introduzcas nuevos elementos de trama, personajes ni conflictos${V?" (pero S\xCD puedes a\xF1adir reflexiones internas, flashbacks breves, o consecuencias emocionales si la correcci\xF3n lo exige)":""}
7. Si una correcci\xF3n requiere a\xF1adir contexto, hazlo de forma org\xE1nica

${w.previousChapter?`CONTEXTO (cap\xEDtulo anterior): ${w.previousChapter}`:""}
${w.nextChapter?`CONTEXTO (cap\xEDtulo siguiente): ${w.nextChapter}`:""}`,te=await this.smartEditor.fullRewrite({chapterContent:U,errorDescription:Q,worldBible:{characters:f.characters||f.personajes||[],locations:f.locations||f.lugares||[],worldRules:f.rules||f.reglas||f.worldRules||[],persistentInjuries:f.persistentInjuries||f.lesiones||[],plotDecisions:f.plotDecisions||f.decisiones||[]},chapterNumber:l.chapter,chapterTitle:l.chapterTitle,previousChapterSummary:w.previousChapter||"",nextChapterSummary:w.nextChapter||""});if(this.addTokenUsage(te.tokenUsage),await this.logAiUsage(t,"targeted-repair","deepseek-chat",te.tokenUsage,l.chapter),te.rewrittenContent&&te.rewrittenContent.length>200){let F=te.rewrittenContent.split(/\s+/).length,ae=h.content.split(/\s+/).length;if(F>=ae*.85&&F>=800){let D=await this.verifyTargetedRewrite(t,l.chapter,h.content,te.rewrittenContent,l.issues);D.overallFixed&&!D.details?(O=te.rewrittenContent,I="rewrite",_=D.fixedCount,N=!0,await b.createActivityLog({projectId:t,level:"success",agentRole:"targeted-repair",message:`Cap ${l.chapter}: FALLBACK REESCRITURA VERIFICADA - ${D.fixedCount}/${l.issues.length} problemas resueltos`})):D.details?await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: Fallback rechazado - introdujo nuevos problemas: ${D.details}`}):await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: Fallback insuficiente (${D.fixedCount}/${l.issues.length} resueltos)`})}else await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: Fallback rechazado por p\xE9rdida de contenido (${F} vs ${ae} palabras)`})}}else console.log(`[TargetedRepair] Cap ${l.chapter}: Fallback not worth it - ${$.reason}`),await b.createActivityLog({projectId:t,level:"info",agentRole:"targeted-repair",message:`Cap ${l.chapter}: ${j.length} problemas sin resolver - no ameritan reescritura: ${$.reason}`})}}else{let L=`REESCRITURA DIRIGIDA - CAP\xCDTULO ${l.chapter}

PROBLEMAS A CORREGIR EN ESTE CAP\xCDTULO:
${l.instructions}

REGLAS ABSOLUTAS:
1. Reescribe SOLO las secciones que contienen los problemas indicados
2. Mant\xE9n INTACTOS todos los p\xE1rrafos que no est\xE9n afectados
3. NO cambies el estilo, tono, ni voz narrativa
4. Preserva las transiciones con los cap\xEDtulos adyacentes
5. El cap\xEDtulo debe mantener su extensi\xF3n similar (\xB115%)
6. Cada correcci\xF3n debe resolver COMPLETAMENTE el problema indicado

${w.previousChapter?`CONTEXTO (cap\xEDtulo anterior): ${w.previousChapter}`:""}
${w.nextChapter?`CONTEXTO (cap\xEDtulo siguiente): ${w.nextChapter}`:""}`,j=await this.smartEditor.fullRewrite({chapterContent:h.content,errorDescription:L,worldBible:{characters:f.characters||f.personajes||[],locations:f.locations||f.lugares||[],worldRules:f.rules||f.reglas||f.worldRules||[],persistentInjuries:f.persistentInjuries||f.lesiones||[],plotDecisions:f.plotDecisions||f.decisiones||[]},chapterNumber:l.chapter,chapterTitle:l.chapterTitle,previousChapterSummary:w.previousChapter||"",nextChapterSummary:w.nextChapter||""});if(this.addTokenUsage(j.tokenUsage),await this.logAiUsage(t,"targeted-repair","deepseek-chat",j.tokenUsage,l.chapter),j.rewrittenContent&&j.rewrittenContent.length>200){let $=j.rewrittenContent.split(/\s+/).length,U=h.content.split(/\s+/).length;if($>=U*.7&&$>=800){let k=await this.verifyTargetedRewrite(t,l.chapter,h.content,j.rewrittenContent,l.issues);k.overallFixed?(O=j.rewrittenContent,I="rewrite",_=k.fixedCount,N=!0,await b.createActivityLog({projectId:t,level:"success",agentRole:"targeted-repair",message:`Cap ${l.chapter}: REESCRITURA VERIFICADA - ${k.fixedCount}/${l.issues.length} problemas resueltos`})):await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: Reescritura no resolvi\xF3 suficientes problemas (${k.fixedCount}/${l.issues.length}). ${k.details||""}`})}else await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: Reescritura rechazada por p\xE9rdida de contenido (${$} vs ${U} palabras)`})}}O&&O!==S&&N?(await b.updateChapter(h.id,{content:O,wordCount:O.split(/\s+/).length}),h.content=O,await b.createActivityLog({projectId:t,level:"success",agentRole:"targeted-repair",message:`Cap ${l.chapter}: Contenido guardado (${I}, ${_}/${l.issues.length} problemas resueltos)`})):O&&!N&&(await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Cap ${l.chapter}: Contenido NO guardado - reparaci\xF3n incompleta (${_}/${l.issues.length}). Se mantiene el original para evitar regresiones.`}),O=null,I="failed");let P={chapter:l.chapter,success:N,method:I,verified:N,issuesFixed:_,issuesTotal:l.issues.length};g.push(P),await b.updateProject(t,{targetedRepairProgress:{current:d+1,total:s.length,currentChapter:l.chapter,message:`Cap ${l.chapter}: ${I!=="failed"?`${_}/${l.issues.length} corregidos`:"sin cambios"}`,results:g}})}let y=g.reduce((d,l)=>d+l.issuesFixed,0),C=g.reduce((d,l)=>d+l.issuesTotal,0),A=g.filter(d=>d.success).length,T=g.filter(d=>!d.success).map(d=>d.chapter),E=T.length>0?`Cap\xEDtulos sin modificar (protecci\xF3n anti-regresi\xF3n): ${T.join(", ")}`:"Todos los cap\xEDtulos corregidos y verificados";return await b.updateProject(t,{targetedRepairStatus:o?"auto_cycle":"completed",targetedRepairDiagnosis:null,targetedRepairPlan:null,targetedRepairProgress:{current:s.length,total:s.length,message:`Completado: ${y}/${C} problemas resueltos en ${A}/${s.length} cap\xEDtulos. ${E}`,results:g}}),T.length>0&&await b.createActivityLog({projectId:t,level:"warn",agentRole:"targeted-repair",message:`Protecci\xF3n anti-regresi\xF3n: ${T.length} cap\xEDtulos NO fueron modificados porque la correcci\xF3n no resolvi\xF3 todos los problemas. Cap\xEDtulos: ${T.join(", ")}. Ejecuta un nuevo diagn\xF3stico para intentar reparar estos cap\xEDtulos con un enfoque diferente.`}),await b.createActivityLog({projectId:t,level:"success",agentRole:"targeted-repair",message:`Reparaci\xF3n dirigida completada: ${y}/${C} problemas resueltos en ${A}/${s.length} cap\xEDtulos`}),this.callbacks.onAgentStatus("targeted-repair","completed",`Reparaci\xF3n completada: ${y}/${C} problemas en ${A} cap\xEDtulos`),g}finally{u&&u(t)}}async runAutoCycleRepair(e,t=10){let n=e.id,a=9,s=2,o=global.startCorrection,i=global.endCorrection,u=global.isCorrectionCancelled;o&&(i&&i(n),o(n,"detect-fix"));let c=[],p=0,m=0;try{await b.updateProject(n,{targetedRepairStatus:"auto_cycle",targetedRepairProgress:{current:0,total:t,message:`Ciclo autom\xE1tico iniciado (objetivo: ${s} diagn\xF3sticos consecutivos con ${a}+/10)`,autoCycle:!0,consecutiveHighScores:0,history:[]}});for(let g=1;g<=t;g++){if(u&&u(n)){console.log(`[AutoCycle] Cancelled by user at cycle ${g}`),await b.createActivityLog({projectId:n,level:"info",agentRole:"targeted-repair",message:`Ciclo autom\xE1tico cancelado por el usuario en ciclo ${g}`});break}let y=await b.getProject(n);if(y?.targetedRepairStatus==="idle"||y?.targetedRepairStatus==="error"){console.log(`[AutoCycle] Status changed to ${y?.targetedRepairStatus}, stopping`);break}this.callbacks.onAgentStatus("targeted-repair","active",`Ciclo autom\xE1tico ${g}/${t}: Diagnosticando... (${p}/${s} puntuaciones 9+)`),await b.updateProject(n,{targetedRepairProgress:{current:g,total:t,message:`Ciclo ${g}/${t}: Diagnosticando...`,autoCycle:!0,consecutiveHighScores:p,history:c}}),await b.createActivityLog({projectId:n,level:"info",agentRole:"targeted-repair",message:`Ciclo autom\xE1tico ${g}/${t}: Iniciando diagn\xF3stico (${p}/${s} puntuaciones 9+ consecutivas)`});let C;try{C=await this.diagnoseForTargetedRepair(y||e)}catch(E){console.error(`[AutoCycle] Diagnosis failed at cycle ${g}:`,E),await b.createActivityLog({projectId:n,level:"error",agentRole:"targeted-repair",message:`Ciclo ${g}: Error en diagn\xF3stico - ${E instanceof Error?E.message:"Error desconocido"}`});break}let A=C.diagnosis?.overallScore||0;if(m=A,A>=a?p++:p=0,await b.createActivityLog({projectId:n,level:A>=a?"success":"info",agentRole:"targeted-repair",message:`Ciclo ${g}: Puntuaci\xF3n ${A}/10. ${C.plan.length} problemas detectados. (${p}/${s} puntuaciones 9+ consecutivas)`}),p>=s){c.push({cycle:g,score:A,issuesFound:C.plan.length,issuesFixed:0}),await b.createActivityLog({projectId:n,level:"success",agentRole:"targeted-repair",message:`Ciclo autom\xE1tico COMPLETADO: ${s} puntuaciones consecutivas de ${a}+ alcanzadas (${A}/10). Novela aprobada tras ${g} ciclos.`}),this.callbacks.onAgentStatus("targeted-repair","completed",`Ciclo autom\xE1tico completado: ${s}x ${a}+ consecutivos (${A}/10) en ${g} ciclos`);break}if(C.plan.length===0){c.push({cycle:g,score:A,issuesFound:0,issuesFixed:0});continue}this.callbacks.onAgentStatus("targeted-repair","active",`Ciclo ${g}/${t}: Corrigiendo ${C.plan.length} cap\xEDtulos... (${p}/${s} puntuaciones 9+)`),await b.updateProject(n,{targetedRepairProgress:{current:g,total:t,message:`Ciclo ${g}: Corrigiendo ${C.plan.length} cap\xEDtulos...`,autoCycle:!0,consecutiveHighScores:p,history:c}});let T=0;try{let E=await this.executeRepairPlan(y||e);T=E.reduce((l,h)=>l+h.issuesFixed,0);let d=E.reduce((l,h)=>l+h.issuesTotal,0);await b.createActivityLog({projectId:n,level:"info",agentRole:"targeted-repair",message:`Ciclo ${g}: Reparaci\xF3n completada - ${T}/${d} problemas resueltos`})}catch(E){console.error(`[AutoCycle] Repair failed at cycle ${g}:`,E),await b.createActivityLog({projectId:n,level:"error",agentRole:"targeted-repair",message:`Ciclo ${g}: Error en reparaci\xF3n - ${E instanceof Error?E.message:"Error desconocido"}`})}await b.updateProject(n,{targetedRepairStatus:"auto_cycle"}),o&&o(n,"detect-fix"),c.push({cycle:g,score:A,issuesFound:C.plan.length,issuesFixed:T}),await new Promise(E=>setTimeout(E,2e3))}let f=p>=s;return await b.updateProject(n,{targetedRepairStatus:"completed",targetedRepairDiagnosis:null,targetedRepairPlan:null,targetedRepairProgress:{current:c.length,total:t,message:f?`Ciclo autom\xE1tico COMPLETADO: ${s} puntuaciones ${a}+ consecutivas en ${c.length} ciclos (${m}/10)`:`Ciclo autom\xE1tico finalizado tras ${c.length} ciclos. \xDAltima puntuaci\xF3n: ${m}/10 (${p}/${s} consecutivas)`,autoCycle:!0,consecutiveHighScores:p,history:c,finalScore:m,success:f}}),f||this.callbacks.onAgentStatus("targeted-repair","completed",`Ciclo autom\xE1tico finalizado: ${c.length} ciclos, \xFAltima puntuaci\xF3n ${m}/10`),{cycles:c.length,finalScore:m,consecutiveHighScores:p,history:c,success:f}}finally{i&&i(n)}}async evaluateRewriteWorthiness(e,t,n,a){if(a.length===0)return{worthIt:!1,reason:"No hay problemas sin resolver",unresolvedIssues:[]};if(a.some(c=>c.severity==="critica"))return{worthIt:!0,reason:"Contiene problemas cr\xEDticos que deben resolverse",unresolvedIssues:a};let o=a.map(c=>`- [${c.severity}] ${c.type}: ${c.description}`).join(`
`),i=`Eres un editor literario senior. Eval\xFAa si los siguientes problemas detectados en un cap\xEDtulo ameritan una reescritura focalizada, considerando el riesgo de introducir nuevos problemas.

CAP\xCDTULO ${t} (fragmento):
${n.substring(0,2e3)}

PROBLEMAS SIN RESOLVER TRAS CIRUG\xCDA:
${o}

CRITERIOS DE DECISI\xD3N:
- \xBFLos problemas afectan significativamente la experiencia del lector?
- \xBFSon problemas reales o son opiniones estil\xEDsticas discutibles?
- \xBFEl riesgo de una reescritura (perder calidad, coherencia, voz) supera el beneficio de corregir estos problemas?
- \xBFLos problemas rompen la l\xF3gica narrativa o son detalles menores?

Responde SOLO en JSON:
{
  "worthRewriting": true/false,
  "reason": "explicaci\xF3n concisa de por qu\xE9 s\xED o no vale la pena",
  "realIssueCount": n\xFAmero de problemas que realmente afectan la calidad (no opiniones),
  "riskLevel": "bajo" | "medio" | "alto"
}`;try{let f=(await ai.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent(i)).response.text().match(/\{[\s\S]*\}/);if(f){let g=JSON.parse(f[0]);return{worthIt:g.worthRewriting===!0&&g.riskLevel!=="alto",reason:g.reason||"Sin raz\xF3n especificada",unresolvedIssues:a}}}catch(c){console.warn(`[TargetedRepair] Worthiness evaluation failed for chapter ${t}:`,c)}let u=a.some(c=>c.severity==="mayor");return{worthIt:u,reason:u?"Evaluaci\xF3n fall\xF3 pero hay problemas mayores - intentando reescritura":"Evaluaci\xF3n fall\xF3 y solo hay problemas menores - no vale la pena",unresolvedIssues:a}}async verifyTargetedFix(e,t,n,a,s){let o=(m,f,g=6e3)=>{if(m.length<=g)return m;let y=m.toLowerCase(),C=[];for(let l of f){let h=l.toLowerCase(),v=y.indexOf(h);for(;v!==-1;)C.push(v),v=y.indexOf(h,v+1)}if(C.length===0){let l=Math.floor(m.length/2);return`[INICIO]
${m.substring(0,Math.floor(g*.3))}

[...]

[ZONA MEDIA]
${m.substring(Math.max(0,l-Math.floor(g*.2)),l+Math.floor(g*.2))}

[...]

[FINAL]
${m.substring(m.length-Math.floor(g*.3))}`}let A=Math.min(...C),T=Math.max(...C),E=Math.max(0,A-1500),d=Math.min(m.length,T+2500);return d-E<=g?m.substring(E,d):m.substring(E,E+g)},i=[...s.description.split(/\s+/).filter(m=>m.length>5).slice(0,8),...s.suggestedFix.split(/\s+/).filter(m=>m.length>5).slice(0,5),s.type],u=o(n,i),c=o(a,i),p=`Eres un verificador de correcciones literarias. Verifica si el problema ESPEC\xCDFICO fue corregido sin introducir nuevos problemas.

PROBLEMA QUE DEB\xCDA CORREGIRSE:
- Tipo: ${s.type}
- Severidad: ${s.severity}
- Descripci\xF3n: ${s.description}
- Correcci\xF3n esperada: ${s.suggestedFix}

TEXTO ORIGINAL (secci\xF3n relevante):
${u}

TEXTO CORREGIDO (secci\xF3n relevante):
${c}

INSTRUCCIONES:
1. Compara ambas secciones y determina si el problema original fue corregido
2. \xBFLa correcci\xF3n introdujo nuevos problemas GRAVES? (solo contradicciones, errores l\xF3gicos, inconsistencias)
3. \xBFSe mantuvo el estilo y tono originales?
4. Busca evidencia CONCRETA de la correcci\xF3n (nuevas frases, contenido a\xF1adido, texto modificado)

Responde SOLO en JSON:
{
  "problemFixed": true/false,
  "newGraveProblems": true/false,
  "evidencia": "breve explicaci\xF3n de qu\xE9 cambi\xF3 con citas textuales",
  "newProblemsDescription": "descripci\xF3n de nuevos problemas graves si los hay, o null"
}`;try{let y=(await ai.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent(p)).response.text().match(/\{[\s\S]*\}/);if(y){let C=JSON.parse(y[0]);return{fixed:C.problemFixed===!0,newProblems:C.newGraveProblems===!0,details:C.newProblemsDescription||C.evidencia}}}catch(m){console.warn(`[TargetedRepair] Verification failed for chapter ${t}:`,m)}return{fixed:!0,newProblems:!1,details:"Verificaci\xF3n asumida como correcta"}}async verifyTargetedRewrite(e,t,n,a,s){let o=s.map((m,f)=>`${f+1}. [${m.severity}] ${m.type}: ${m.description}`).join(`
`),i=(m,f,g=8e3)=>{if(m.length<=g)return m;let y=m.toLowerCase(),C=[];for(let h of f)C.push(...h.description.split(/\s+/).filter(v=>v.length>5).slice(0,5)),C.push(...h.suggestedFix.split(/\s+/).filter(v=>v.length>5).slice(0,3)),C.push(h.type);let A=[];for(let h of C){let v=h.toLowerCase(),S=y.indexOf(v);for(;S!==-1;)A.push(S),S=y.indexOf(v,S+1)}if(A.length===0){let h=Math.floor(g/3);return`[INICIO]
${m.substring(0,h)}

[...]

[MEDIO]
${m.substring(Math.floor(m.length/2)-Math.floor(h/2),Math.floor(m.length/2)+Math.floor(h/2))}

[...]

[FINAL]
${m.substring(m.length-h)}`}A.sort((h,v)=>h-v);let T=[],E=0,d=Math.floor(g/Math.min(A.length,5)),l=new Set;for(let h of A){let v=Math.floor(h/2e3);if(l.has(v))continue;l.add(v);let S=Math.max(0,h-800),R=Math.min(m.length,h+d-800),x=m.substring(S,R);if(E+x.length>g)break;T.push(x),E+=x.length}return T.join(`

[...]

`)},u=i(n,s),c=i(a,s),p=`Eres un verificador de correcciones literarias. Verifica si los problemas fueron corregidos en la reescritura sin introducir nuevos problemas graves.

PROBLEMAS QUE DEB\xCDAN CORREGIRSE:
${o}

TEXTO ORIGINAL (secciones relevantes):
${u}

TEXTO REESCRITO (secciones relevantes):
${c}

Para CADA problema, indica si fue resuelto comparando ambos textos. Busca evidencia CONCRETA (frases nuevas, contenido modificado, texto a\xF1adido). Tambi\xE9n verifica que no se hayan introducido nuevos problemas GRAVES.

Responde SOLO en JSON:
{
  "issueResults": [
    { "index": 1, "fixed": true/false, "evidence": "cita textual de la correcci\xF3n o explicaci\xF3n" }
  ],
  "newGraveProblems": false,
  "newProblemsDescription": null,
  "overallVerdict": "APROBADO" | "RECHAZADO"
}`;try{let y=(await ai.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent(p)).response.text().match(/\{[\s\S]*\}/);if(y){let C=JSON.parse(y[0]),A=(C.issueResults||[]).filter(E=>E.fixed).length,T=C.newGraveProblems===!0;return{overallFixed:A>=Math.ceil(s.length*.5)&&!T,fixedCount:A,details:T?C.newProblemsDescription:void 0}}}catch(m){console.warn(`[TargetedRepair] Rewrite verification failed for chapter ${t}:`,m)}return{overallFixed:!0,fixedCount:s.length,details:"Verificaci\xF3n asumida como correcta"}}};vn();function one(r){return`gen_${r}_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}var Ny=300*1e3,ine=30*1e3,yI=class{isRunning=!1;isPaused=!1;currentOrchestrator=null;eventCallbacks=new Set;checkInterval=null;lastHeartbeat=null;heartbeatInterval=null;currentProjectId=null;autoRecoveryCount=0;processingLock=!1;autoStartDisabled=!0;pendingRetryProjectId=null;constructor(){}updateHeartbeat(){this.lastHeartbeat=new Date}startHeartbeatMonitor(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.lastHeartbeat=new Date,this.heartbeatInterval=setInterval(async()=>{await this.checkHeartbeat()},ine)}stopHeartbeatMonitor(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.lastHeartbeat=null}async checkHeartbeat(){if(!this.isRunning||this.isPaused||!this.currentProjectId||!this.lastHeartbeat)return;let e=Date.now()-this.lastHeartbeat.getTime();if(e>Ny){let t=global.isAnyCorrectionActive;if(t&&t(this.currentProjectId)){console.log(`[QueueManager] Project ${this.currentProjectId} has active detect-and-fix correction. Skipping auto-recovery and updating heartbeat.`),this.updateHeartbeat();return}console.log(`[QueueManager] FROZEN DETECTED: No activity for ${Math.round(e/6e4)} minutes. Auto-recovering...`),await this.autoRecover()}}async autoRecover(){if(!this.currentProjectId)return;let e=this.currentProjectId,t=global.isAnyCorrectionActive;if(t&&t(e)){console.log(`[QueueManager] BLOCKED auto-recovery for project ${e}: detect-and-fix correction is active`),this.updateHeartbeat();return}this.autoRecoveryCount++,console.log(`[QueueManager] Auto-recovery attempt #${this.autoRecoveryCount} for project ${e}`);try{console.log(`[QueueManager] Aborting pending API connections for project ${e}...`),io(e)}catch(a){console.error("[QueueManager] Failed to cancel project connections:",a)}try{await b.createActivityLog({projectId:e,level:"warn",message:`Auto-recovery triggered after ${Ny/6e4} minutes of inactivity (attempt #${this.autoRecoveryCount})`,agentRole:"system",metadata:{autoRecoveryCount:this.autoRecoveryCount}})}catch(a){console.error("[QueueManager] Failed to log auto-recovery event:",a)}let n=await b.getQueueItemByProject(e);n&&await b.updateQueueItem(n.id,{status:"waiting",startedAt:null,errorMessage:`Auto-recovery after freeze (attempt #${this.autoRecoveryCount})`}),this.pendingRetryProjectId=e,await b.updateQueueState({currentProjectId:null}),this.currentOrchestrator=null,this.currentProjectId=null,this.stopHeartbeatMonitor(),console.log(`[QueueManager] Project ${e} reset. Will RETRY this project in 3 seconds...`),setTimeout(async()=>{try{console.log(`[QueueManager] Auto-restarting to RETRY frozen project ${e}`),this.isRunning=!1,await this.start()}catch(a){console.error("[QueueManager] Failed to auto-restart after heartbeat recovery:",a),this.pendingRetryProjectId=null}},3e3)}async initialize(){this.startGlobalFrozenMonitor();let e=await b.getQueueState();if(e)if(await this.checkForFrozenProjects(),e.status==="running"&&e.currentProjectId){console.log("[QueueManager] Detected incomplete queue state from previous session - will auto-restart");let t=await b.getProject(e.currentProjectId);if(t?.status==="completed"){let n=await b.getQueueItemByProject(e.currentProjectId);n&&n.status==="processing"&&await b.updateQueueItem(n.id,{status:"completed",completedAt:new Date}),await b.updateQueueState({currentProjectId:null,status:"running"}),console.log("[QueueManager] Cleaned up completed project. AUTO-RESTARTING queue...")}else{let n=await b.getQueueItemByProject(e.currentProjectId);n&&n.status==="processing"&&await b.updateQueueItem(n.id,{status:"waiting",startedAt:null}),t&&t.status==="generating"&&(await b.updateProject(t.id,{status:"paused"}),console.log(`[QueueManager] Project ${t.id} marked as paused for resume`)),await b.updateQueueState({currentProjectId:null,status:"running"}),console.log("[QueueManager] Reset incomplete project. AUTO-RESTARTING queue..."),t&&await b.createActivityLog({projectId:e.currentProjectId,level:"info",message:"Sistema reiniciado - continuando generaci\xF3n autom\xE1ticamente",agentRole:"system"})}this.isRunning=!1,this.isPaused=!1,setImmediate(async()=>{try{console.log("[QueueManager] Auto-starting queue after server restart (immediate)"),await this.start()}catch(n){console.error("[QueueManager] Failed to auto-start after server restart:",n)}})}else e.status==="running"?(console.log("[QueueManager] Queue was running with no project. AUTO-RESTARTING to process queue..."),this.isRunning=!1,this.isPaused=!1,setImmediate(async()=>{try{console.log("[QueueManager] Auto-starting queue (was running with no project) (immediate)"),await this.start()}catch(t){console.error("[QueueManager] Failed to auto-start:",t)}})):e.status==="paused"?(this.isPaused=!0,console.log("[QueueManager] Queue is paused, waiting for manual resume")):(this.isRunning=!1,this.isPaused=!1,console.log("[QueueManager] Queue is stopped, waiting for manual start"))}globalFrozenInterval=null;startGlobalFrozenMonitor(){this.globalFrozenInterval&&clearInterval(this.globalFrozenInterval),this.globalFrozenInterval=setInterval(async()=>{await this.checkForFrozenProjects()},60*1e3),console.log("[QueueManager] Global frozen project monitor started")}async checkForFrozenProjects(){try{let e=await b.getQueueState();if(e?.status==="paused"&&!this.currentProjectId&&(await b.getQueueItems()).filter(i=>i.status==="waiting").length>0){console.log("[QueueManager] AUTO-RECOVERY: Queue is paused but has waiting projects. Auto-resuming..."),this.isPaused=!1,this.isRunning=!1,await b.updateQueueState({status:"running",currentProjectId:null}),this.emit({type:"queue_started",message:"Auto-recovery: Queue auto-resumed"}),setImmediate(async()=>{try{await this.start(),console.log(`[QueueManager] AUTO-RECOVERY: Queue resumed. currentProjectId=${this.currentProjectId}`)}catch(i){console.error("[QueueManager] AUTO-RECOVERY: Failed to auto-resume queue:",i)}});return}let t=await b.getAllProjects(),n=["generating","failed_final_review","paused","awaiting_instructions","final_review_in_progress"],a=t.filter(s=>n.includes(s.status));Date.now()%(300*1e3)<60*1e3&&console.log(`[QueueManager] Frozen monitor: ${a.length} projects in monitored states (${n.join(", ")}). Queue status: ${e?.status}, isPaused: ${this.isPaused}`);for(let s of a){let i=await b.getLastActivityLogTime(s.id)||s.createdAt;if(!i){console.warn(`[QueueManager] Project ${s.id} "${s.title}" has no activity or creation time`);continue}let u=Date.now()-new Date(i).getTime(),c=s.status==="final_review_in_progress"?Ny*4:Ny;if(s.status==="paused"){let p=await b.getActivityLogsByProject(s.id,10);if(p.some(g=>(g.message.includes("PROYECTO PAUSADO")||g.message.includes("validation failed")||g.message.includes("Estructura narrativa d\xE9bil")||g.message.includes("PROTAGONISTA AUSENTE")||g.message.includes("no cumple los est\xE1ndares"))&&g.level==="error"))continue;if(p.some(g=>g.message.includes("cancelada por el usuario")||g.message.includes("Correcci\xF3n")&&g.message.includes("cancelada")||g.message.includes("Generaci\xF3n cancelada")||g.message.includes("Revisi\xF3n detenida por el usuario"))){console.log(`[QueueManager] Skipping auto-recovery for project ${s.id} - was manually cancelled`);continue}}if(s.status!=="cancelled"&&u>c){let p=global.isAnyCorrectionActive;if(p&&p(s.id)){console.log(`[QueueManager] Skipping frozen project recovery for ${s.id} - detect-and-fix correction is active`);continue}console.log(`[QueueManager] FROZEN PROJECT DETECTED: "${s.title}" (ID: ${s.id}) - no activity for ${Math.round(u/6e4)} minutes`);try{console.log(`[QueueManager] Aborting pending API connections for frozen project ${s.id}...`),io(s.id)}catch(g){console.error("[QueueManager] Failed to cancel project connections:",g)}await b.createActivityLog({projectId:s.id,level:"warn",message:`Auto-recovery: proyecto congelado detectado (${Math.round(u/6e4)} min sin actividad). Reiniciando...`,agentRole:"system"}),await b.updateProject(s.id,{status:"paused"}),(await b.getQueueState())?.currentProjectId===s.id&&(await b.updateQueueState({currentProjectId:null}),this.currentOrchestrator=null,this.currentProjectId=null);let f=await b.getQueueItemByProject(s.id);if(f)f.status!=="waiting"&&await b.updateQueueItem(f.id,{status:"waiting",startedAt:null,completedAt:null,errorMessage:`Auto-recovery after ${Math.round(u/6e4)} min (status was: ${s.status})`});else{console.log(`[QueueManager] Creating missing queue item for frozen project ${s.id}`);let g=await b.getQueueItems(),y=g.length>0?Math.max(...g.map(C=>C.position)):0;await b.addToQueue({projectId:s.id,position:y+1,priority:"normal",status:"waiting"})}this.pendingRetryProjectId=s.id,console.log(`[QueueManager] Frozen project "${s.title}" (ID: ${s.id}) reset. Will RETRY this project...`),await b.createActivityLog({projectId:s.id,level:"info",message:"Auto-recovery completado. Reintentando este proyecto autom\xE1ticamente...",agentRole:"system"}),this.isRunning=!1,this.isPaused=!1,this.processingLock=!1,this.currentProjectId=null,this.currentOrchestrator=null,await b.updateQueueState({currentProjectId:null,status:"running"}),this.emit({type:"queue_started",message:"Auto-recovery: Queue restarted automatically"}),console.log("[QueueManager] AUTO-RECOVERY: Emitted queue_started event for UI update"),setTimeout(()=>{(async()=>{try{console.log(`[QueueManager] AUTO-RECOVERY: Starting queue to RETRY frozen project ${s.id}`),this.isRunning=!1,this.isPaused=!1,this.processingLock=!1,this.currentProjectId=null,this.currentOrchestrator=null,await b.updateQueueState({currentProjectId:null,status:"running"}),this.pendingRetryProjectId=s.id;let g=await b.getProject(s.id);if(!g||g.status!=="paused"){console.log(`[QueueManager] AUTO-RECOVERY: Project ${s.id} status changed to ${g?.status}, skipping`),this.pendingRetryProjectId=null;return}console.log(`[QueueManager] AUTO-RECOVERY: Calling start() for project ${s.id}`),await this.start(),console.log(`[QueueManager] AUTO-RECOVERY: start() completed. isRunning=${this.isRunning}, currentProjectId=${this.currentProjectId}, pendingRetryProjectId=${this.pendingRetryProjectId}`),this.currentProjectId===null&&(console.log(`[QueueManager] AUTO-RECOVERY: Project ${s.id} not picked up by start(), forcing processQueue directly`),this.pendingRetryProjectId=s.id,this.isRunning=!0,this.isPaused=!1,await this.processQueue(),console.log(`[QueueManager] AUTO-RECOVERY: processQueue() completed. currentProjectId=${this.currentProjectId}`))}catch(g){console.error("[QueueManager] AUTO-RECOVERY FAILED:",g),this.pendingRetryProjectId=null}})()},3e3);break}}}catch(e){console.error("[QueueManager] Error checking for frozen projects:",e)}}addListener(e){return this.eventCallbacks.add(e),()=>this.eventCallbacks.delete(e)}emit(e){this.eventCallbacks.forEach(t=>{try{t(e)}catch(n){console.error("Queue event callback error:",n)}})}async getState(){let e=await b.getQueueState();return e||(e=await b.updateQueueState({status:"stopped"})),e}async start(){this.isRunning||(this.isRunning=!0,this.isPaused=!1,await b.updateQueueState({status:"running"}),this.emit({type:"queue_started",message:"Queue processing started"}),this.processQueue())}async stop(){console.log("[QueueManager] STOP requested - cancelling all processing"),this.isRunning=!1,this.isPaused=!1,this.processingLock=!1,this.stopHeartbeatMonitor();let e=await b.getQueueState();if(e?.currentProjectId){console.log(`[QueueManager] Cancelling active project ${e.currentProjectId}`);try{io(e.currentProjectId),console.log(`[QueueManager] Cancelled project ${e.currentProjectId}`)}catch(a){console.error("[QueueManager] Failed to cancel project:",a)}let t=await b.getQueueItemByProject(e.currentProjectId);t&&t.status==="processing"&&await b.updateQueueItem(t.id,{status:"waiting",startedAt:null,errorMessage:"Detenido manualmente por el usuario"});let n=await b.getProject(e.currentProjectId);n&&n.status==="generating"&&await b.updateProject(e.currentProjectId,{status:"paused"})}this.currentProjectId=null,this.currentOrchestrator=null,await b.updateQueueState({status:"stopped",currentProjectId:null}),this.emit({type:"queue_stopped",message:"Queue processing stopped"}),this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),console.log("[QueueManager] STOP complete - queue is now stopped")}async pause(){this.isPaused=!0,this.stopHeartbeatMonitor(),await b.updateQueueState({status:"paused"}),this.emit({type:"queue_paused",message:"Queue processing paused"})}async resume(){if(!this.isRunning){await this.start();return}this.isPaused=!1,await b.updateQueueState({status:"running"}),this.emit({type:"queue_started",message:"Queue processing resumed"}),this.processQueue()}async skipCurrent(){let e=await b.getQueueState();if(e?.currentProjectId){this.stopHeartbeatMonitor(),this.currentProjectId=null;let t=await b.getQueueItemByProject(e.currentProjectId);t&&(await b.updateQueueItem(t.id,{status:"skipped",completedAt:new Date}),this.emit({type:"project_skipped",projectId:e.currentProjectId,message:"Current project skipped"})),await b.updateQueueState({currentProjectId:null}),this.isRunning&&!this.isPaused&&this.processQueue()}}async processQueue(){if(console.log(`[QueueManager] processQueue() called - isRunning=${this.isRunning}, isPaused=${this.isPaused}, currentProjectId=${this.currentProjectId}, lock=${this.processingLock}`),!this.isRunning||this.isPaused){console.log("[QueueManager] processQueue skipped - queue not running or paused");return}if(this.currentProjectId!==null){console.log("[QueueManager] processQueue skipped - project already in progress");return}if(this.processingLock){console.log("[QueueManager] processQueue skipped - processing lock active");return}this.processingLock=!0;try{let e=await this.getState();if(e.currentProjectId){console.log("[QueueManager] processQueue skipped - DB shows project in progress");return}let t=null;if(this.pendingRetryProjectId){let n=this.pendingRetryProjectId;console.log(`[QueueManager] PRIORITY: Retrying frozen project ${n}`);let a=await b.getQueueItemByProject(n);a&&a.status==="waiting"?(t=a,console.log(`[QueueManager] Found queue item for retry project ${n}`)):console.log(`[QueueManager] Retry project ${n} not found or not in waiting status. Clearing pending retry.`),this.pendingRetryProjectId=null}if(t||(t=await b.getNextInQueue(),console.log(`[QueueManager] getNextInQueue returned: ${t?`item ${t.id} for project ${t.projectId}`:"null"}`)),!t){console.log("[QueueManager] No items in queue - emitting queue_empty"),this.emit({type:"queue_empty",message:"No projects in queue"}),e.autoAdvance&&(this.checkInterval=setInterval(async()=>{if(!this.isRunning||this.isPaused||this.currentProjectId!==null){this.checkInterval&&clearInterval(this.checkInterval);return}await b.getNextInQueue()&&(this.checkInterval&&clearInterval(this.checkInterval),this.processQueue())},1e4));return}await this.processProject(t)}finally{this.currentProjectId===null&&(this.processingLock=!1)}}async processProject(e){let t=await b.getProject(e.projectId);if(!t){await b.updateQueueItem(e.id,{status:"failed",completedAt:new Date,errorMessage:"Project not found"}),this.processQueue();return}let n=global.isAnyCorrectionActive;if(n&&n(t.id)){console.log(`[QueueManager] BLOCKED: Project ${t.id} has active correction. Skipping processing.`),await b.createActivityLog({projectId:t.id,level:"warn",message:"Procesamiento bloqueado: ya hay una correcci\xF3n activa en ejecuci\xF3n",agentRole:"system"}),await b.updateQueueItem(e.id,{status:"waiting",startedAt:null}),this.currentProjectId=null,this.processingLock=!1,setTimeout(()=>this.processQueue(),3e4);return}await b.updateQueueItem(e.id,{status:"processing",startedAt:new Date}),await b.updateQueueState({currentProjectId:t.id}),this.currentProjectId=t.id,this.autoRecoveryCount=0,this.startHeartbeatMonitor();let a=one(t.id);await b.updateProject(t.id,{generationToken:a}),Zw(t.id),console.log(`[QueueManager] Generated token for project ${t.id}: ${a}`),this.emit({type:"project_started",projectId:t.id,projectTitle:t.title,message:`Starting generation of: ${t.title}`});let s=this;t.pipelineVersion!=="v2"&&(await b.updateProject(t.id,{pipelineVersion:"v2"}),console.log(`[QueueManager] Upgraded project ${t.id} to v2 pipeline`)),console.log(`[QueueManager] Project ${t.id} using pipeline: v2 (scene-based)`);let o=new Qr({generationToken:a,callbacks:{onAgentStatus:async(i,u,c)=>{s.updateHeartbeat(),console.log(`[Queue V2] ${t.title} - ${i}: ${u}`,c||"");try{await b.updateAgentStatus(t.id,i,{status:u,currentTask:c||void 0})}catch(p){console.error("[Queue V2] Failed to update agent status:",p)}if(c)try{await b.createActivityLog({projectId:t.id,level:u==="error"?"error":"info",agentRole:i,message:c})}catch(p){console.error("[Queue V2] Failed to save activity log:",p)}},onChapterComplete:async(i,u,c)=>{s.updateHeartbeat(),console.log(`[Queue V2] ${t.title} - Chapter ${i} complete: ${u} words`);let p=i===0?"el Pr\xF3logo":i===-1?"el Ep\xEDlogo":i===-2?"la Nota del Autor":`el Cap\xEDtulo ${i}`;try{await b.createActivityLog({projectId:t.id,level:"success",agentRole:"ghostwriter-v2",message:`${p} completado (${u} palabras)`})}catch(m){console.error("[Queue V2] Failed to save chapter complete log:",m)}},onSceneComplete:(i,u,c,p)=>{s.updateHeartbeat(),console.log(`[Queue V2] ${t.title} - Scene ${u}/${c} of Chapter ${i} complete`)},onProjectComplete:async()=>{s.stopHeartbeatMonitor(),s.currentProjectId=null,await s.handleProjectComplete(e,t)},onError:async i=>{s.stopHeartbeatMonitor(),s.currentProjectId=null,await s.handleProjectError(e,t,i)}}});this.currentOrchestrator=o;try{await o.generateNovel(t)}catch(i){await this.handleProjectError(e,t,String(i))}}async handleProjectComplete(e,t){await b.updateQueueItem(e.id,{status:"completed",completedAt:new Date}),await b.updateQueueState({currentProjectId:null}),this.currentOrchestrator=null,this.emit({type:"project_completed",projectId:t.id,projectTitle:t.title,message:`Completed: ${t.title}`});let n=await this.getState();if(n.pauseAfterEach){await this.pause();return}n.autoAdvance&&setTimeout(()=>this.processQueue(),5e3)}async handleProjectError(e,t,n){let a=await this.getState(),s=n.includes("RATELIMIT")||n.includes("Rate limit")||n.includes("429");this.emit({type:"project_failed",projectId:t.id,projectTitle:t.title,error:n,message:`Error: ${t.title} - ${n}`}),a.skipOnError?(await b.updateQueueItem(e.id,{status:"failed",completedAt:new Date,errorMessage:n}),await b.updateQueueState({currentProjectId:null}),this.currentOrchestrator=null,a.autoAdvance&&setTimeout(()=>this.processQueue(),5e3)):s?(console.log(`[QueueManager] Rate limit for ${t.title}. Waiting 120s before retry...`),await b.updateQueueItem(e.id,{status:"waiting",startedAt:null,errorMessage:n}),await b.updateQueueState({currentProjectId:null}),this.currentOrchestrator=null,setTimeout(()=>{this.isRunning&&!this.isPaused&&this.processQueue()},12e4)):(await b.updateQueueItem(e.id,{status:"failed",completedAt:new Date,errorMessage:n}),await b.updateQueueState({currentProjectId:null}),this.currentOrchestrator=null,await this.pause())}isProcessing(){return this.isRunning&&!this.isPaused}getCurrentStatus(){return{isRunning:this.isRunning,isPaused:this.isPaused}}async forceUnlock(e){if(console.log(`[QueueManager] Force unlock requested for project ${e??"any"}`),e&&this.currentProjectId!==null&&this.currentProjectId!==e)return{success:!1,message:`Cannot unlock project ${e}: different project ${this.currentProjectId} is currently locked`};let t=this.currentProjectId;if(this.processingLock=!1,this.currentProjectId=null,this.pendingRetryProjectId=null,this.currentOrchestrator=null,this.stopHeartbeatMonitor(),await b.updateQueueState({currentProjectId:null}),t){let n=await b.getQueueItemByProject(t);n&&n.status==="processing"&&await b.updateQueueItem(n.id,{status:"waiting",startedAt:null,errorMessage:"Force unlocked by admin"})}return console.log(`[QueueManager] Force unlock completed. Project ${t??"none"} was unlocked`),{success:!0,message:t?`Project ${t} unlocked successfully`:"Processing lock cleared (no project was locked)"}}},wa=new yI;ms();Da();var zx=ln(Mq(),1),Wu=ln(require("mammoth"),1);var We=require("docx");async function Uq(r){let{project:e,chapters:t,pseudonym:n,prologue:a,epilogue:s,authorNote:o}=r,i=n?.name||"An\xF3nimo",u=[];u.push(new We.Paragraph({children:[new We.TextRun({text:"",break:5})]}),new We.Paragraph({text:e.title,heading:We.HeadingLevel.TITLE,alignment:We.AlignmentType.CENTER,spacing:{after:400}}),new We.Paragraph({children:[new We.TextRun({text:"",break:2})]}),new We.Paragraph({text:`por ${i}`,alignment:We.AlignmentType.CENTER,spacing:{after:200},style:"author"}),new We.Paragraph({children:[new We.TextRun({text:"",break:2})]}),new We.Paragraph({text:`G\xE9nero: ${e.genre} | Tono: ${e.tone}`,alignment:We.AlignmentType.CENTER,style:"metadata"}),new We.Paragraph({children:[new We.PageBreak]})),a&&a.content&&(u.push(new We.Paragraph({text:"Pr\xF3logo",heading:We.HeadingLevel.HEADING_1,alignment:We.AlignmentType.CENTER,spacing:{before:400,after:400}})),Xy(u,a.content),u.push(new We.Paragraph({children:[new We.PageBreak]})));let c=t.filter(f=>f.chapterNumber>0&&f.status==="completed").sort((f,g)=>f.chapterNumber-g.chapterNumber);for(let f of c){let g=f.title?`Cap\xEDtulo ${f.chapterNumber}: ${f.title}`:`Cap\xEDtulo ${f.chapterNumber}`;u.push(new We.Paragraph({text:g,heading:We.HeadingLevel.HEADING_1,alignment:We.AlignmentType.CENTER,spacing:{before:400,after:400}})),f.content&&Xy(u,f.content),u.push(new We.Paragraph({children:[new We.PageBreak]}))}s&&s.content&&(u.push(new We.Paragraph({text:"Ep\xEDlogo",heading:We.HeadingLevel.HEADING_1,alignment:We.AlignmentType.CENTER,spacing:{before:400,after:400}})),Xy(u,s.content),u.push(new We.Paragraph({children:[new We.PageBreak]}))),o&&o.content&&(u.push(new We.Paragraph({text:"Nota del Autor",heading:We.HeadingLevel.HEADING_1,alignment:We.AlignmentType.CENTER,spacing:{before:400,after:400}})),Xy(u,o.content));let p=new We.Document({styles:{paragraphStyles:[{id:"Normal",name:"Normal",basedOn:"Normal",next:"Normal",run:{font:"Georgia",size:24},paragraph:{spacing:{line:360,after:200},indent:{firstLine:(0,We.convertInchesToTwip)(.5)}}},{id:"author",name:"Author",basedOn:"Normal",run:{font:"Georgia",size:28,italics:!0}},{id:"metadata",name:"Metadata",basedOn:"Normal",run:{font:"Georgia",size:22,color:"666666"}},{id:"Heading1",name:"Heading 1",basedOn:"Normal",next:"Normal",run:{font:"Georgia",size:32,bold:!0},paragraph:{spacing:{before:480,after:240}}},{id:"Title",name:"Title",basedOn:"Normal",next:"Normal",run:{font:"Georgia",size:56,bold:!0}}]},sections:[{properties:{page:{margin:{top:(0,We.convertInchesToTwip)(1),right:(0,We.convertInchesToTwip)(1),bottom:(0,We.convertInchesToTwip)(1),left:(0,We.convertInchesToTwip)(1.25)}}},headers:{default:new We.Header({children:[new We.Paragraph({children:[new We.TextRun({text:e.title,font:"Georgia",size:20,italics:!0})],alignment:We.AlignmentType.CENTER})]})},footers:{default:new We.Footer({children:[new We.Paragraph({children:[new We.TextRun({children:[We.PageNumber.CURRENT],font:"Georgia",size:20})],alignment:We.AlignmentType.CENTER})]})},children:u}]});return await We.Packer.toBuffer(p)}function nie(r){let e=r,t=[/^#+ *Literary Style Guide[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|Prologue|Epilogue|Author['']?s? Note)\b|\n---\n|$)/gm,/^#+ *Writing Guide[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|Prologue|Epilogue|Author['']?s? Note)\b|\n---\n|$)/gm,/^#+ *The Master of[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|Prologue|Epilogue|Author['']?s? Note)\b|\n---\n|$)/gm,/^#+ *Gua de Estilo[^\n]*\n[\s\S]*?(?=^#+ *(?:CAPTULO|Captulo|Prlogo|Eplogo|Nota del Autor)\b|\n---\n|$)/gmi,/^#+ *Gua de Escritura[^\n]*\n[\s\S]*?(?=^#+ *(?:CAPTULO|Captulo|Prlogo|Eplogo|Nota del Autor)\b|\n---\n|$)/gmi,/^###+ *Checklist[^\n]*\n[\s\S]*?(?=^#{1,2} *(?:CHAPTER|Chapter|CAPTULO|Captulo|Prologue|Prlogo|Epilogue|Eplogo)\b|\n---\n|$)/gmi,/\n---\n[\s\S]*?(?:Style Guide|Gua de Estilo|Writing Guide|Gua de Escritura)[\s\S]*?\n---\n/gi];for(let a of t)e=e.replace(a,"");let n=[/^#+ *\d+\. *(?:Narrative Architecture|Character Construction|Central Themes|Language and Stylistic|Tone and Atmosphere)[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|CAPTULO|Captulo|Prologue|Prlogo)\b|$)/gmi];for(let a of n)e=e.replace(a,"");return e.trim()}function Xy(r,e){let t=e,a=t.indexOf("---CONTINUITY_STATE---");a!==-1&&(t=t.substring(0,a).trim()),t=nie(t);let s=t.split(/\n\n+/);for(let o of s){let i=o.trim();i&&!i.startsWith("# ")&&r.push(new We.Paragraph({children:[new We.TextRun({text:i})],spacing:{after:200}}))}}Rg();It();tb();vn();It();var zu={QUICK_SCAN:r=>`
Resume este cap\xEDtulo en 3 frases. C\xE9ntrate en:
1. Qu\xE9 pasa (Eventos principales).
2. Qu\xE9 informaci\xF3n nueva se revela (secretos, datos clave).
3. Objetos/Tecnolog\xEDa/Expresiones mencionadas (para verificaci\xF3n de anacronismos).

TEXTO:
${r.substring(0,8e3)}

RESPONDE EN JSON:
{
  "eventos": "Descripci\xF3n de los eventos principales",
  "informacion_revelada": "Secretos o datos importantes que aparecen",
  "elementos_epoca": ["lista", "de", "objetos", "tecnolog\xEDa", "expresiones"],
  "personajes_mencionados": ["nombres de personajes que aparecen"]
}`,STRUCTURAL_ANALYSIS:(r,e,t)=>`
Act\xFAa como Editor de Desarrollo profesional. Analiza el esqueleto de esta novela completa.

CONTEXTO (\xC9poca/Lugar): "${e||"No especificado - detecta la \xE9poca por el contenido"}"
IDIOMA: ${t||"Detectar autom\xE1ticamente"}

RES\xDAMENES POR CAP\xCDTULO ORIGINAL:
${r}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
BUSCA PROBLEMAS ESTRUCTURALES
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. **AGUJEROS DE TRAMA:**
   - \xBFAlgo ocurre sin causa previa explicada?
   - \xBFSe olvida o abandona alguna subtrama sin resolver?
   - \xBFHay personajes que desaparecen sin explicaci\xF3n?
   - \xBFFalta setup para momentos importantes (deus ex machina)?

2. **REDUNDANCIA:**
   - \xBFDos cap\xEDtulos cuentan esencialmente lo mismo?
   - \xBFHay escenas que repiten informaci\xF3n ya conocida?
   - \xBFSe explica lo mismo m\xFAltiples veces?

3. **RITMO Y PACING:**
   - \xBFHay "valles" donde no pasa nada significativo?
   - \xBFLas escenas de acci\xF3n se acumulan sin respiro?
   - \xBFEl cl\xEDmax llega demasiado pronto o tarde?

4. **COHERENCIA:**
   - \xBFUn personaje muerto reaparece vivo?
   - \xBFLas l\xEDneas temporales son consistentes?
   - \xBFLas ubicaciones geogr\xE1ficas tienen sentido?

5. **ANACRONISMOS (si hay contexto hist\xF3rico):**
   - \xBFSe mencionan objetos que no exist\xEDan en la \xE9poca?
   - \xBFSe usan expresiones modernas fuera de lugar?
   - \xBFLos conocimientos de los personajes son apropiados para su \xE9poca?

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
GENERA UN PLAN DE RECONSTRUCCI\xD3N
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

Devuelve un JSON con el diagn\xF3stico y el plan ordenado para el NUEVO libro.

Acciones posibles para cada cap\xEDtulo:
- "KEEP": Mantener y pulir (correcciones menores de estilo).
- "DELETE": Eliminar cap\xEDtulo redundante o que da\xF1a la narrativa.
- "INSERT": Crear un cap\xEDtulo NUEVO para arreglar un agujero de trama.
- "MERGE": Unir este cap\xEDtulo con el siguiente (cap\xEDtulos demasiado cortos).

RESPONDE \xDANICAMENTE EN JSON:
{
  "critique": "An\xE1lisis general de la estructura narrativa (2-3 p\xE1rrafos)",
  "plot_holes": [
    {"description": "Descripci\xF3n del agujero", "affected_chapters": [1, 2], "severity": "high|medium|low"}
  ],
  "redundancies": [
    {"chapters": [3, 4], "reason": "Ambos cap\xEDtulos repiten la misma informaci\xF3n sobre X"}
  ],
  "pacing_issues": [
    {"chapters": [5, 6, 7], "issue": "Tres cap\xEDtulos consecutivos sin avance de trama"}
  ],
  "anachronisms_warning": [
    {"chapter": 3, "element": "Uso de 'internet' en un contexto de 1980", "correction": "Eliminar o sustituir por tecnolog\xEDa de la \xE9poca"}
  ],
  "plan": [
    { "new_order": 1, "action": "KEEP", "original_id": 1, "reason": "Cap\xEDtulo de apertura s\xF3lido" },
    { "new_order": 2, "action": "INSERT", "original_id": null, "reason": "Falta explicar c\xF3mo llegaron a la isla", "prompt_for_writer": "Escribir escena de viaje en barco donde se establece la tensi\xF3n entre los personajes principales. Debe incluir: presentaci\xF3n del capit\xE1n, descripci\xF3n del barco, y un presagio del peligro que les espera." },
    { "new_order": 3, "action": "KEEP", "original_id": 2, "reason": "Buen desarrollo de personajes" },
    { "new_order": 4, "action": "MERGE", "original_id": 3, "merge_with": 4, "reason": "Ambos cap\xEDtulos son muy cortos y tratan el mismo evento" },
    { "new_order": 5, "action": "DELETE", "original_id": 5, "reason": "Repite informaci\xF3n del cap\xEDtulo 2" }
  ]
}`,SURGEON_REWRITE:(r,e,t,n,a)=>`
Reescribe este texto para calidad editorial profesional.

IDIOMA DEL TEXTO: ${n||"Espa\xF1ol"}
CONTEXTO \xC9POCA: ${e||"Contempor\xE1neo"} (ALERTA M\xC1XIMA CON ANACRONISMOS)
CONTEXTO NARRATIVO PREVIO: ${t?`"...${t.substring(t.length-500)}"`:"Inicio del libro"}

${a.length>0?`
\u26A0\uFE0F ANACRONISMOS DETECTADOS A CORREGIR:
${a.map((s,o)=>`${o+1}. ${s}`).join(`
`)}

DEBES corregir o sustituir cada anacronismo por un equivalente apropiado para la \xE9poca.
`:""}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES DE EDICI\xD3N
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. **ANACRONISMOS:** Si detectas objetos, palabras o conceptos fuera de \xE9poca, CORR\xCDGELOS o sustit\xFAyelos por equivalentes hist\xF3ricos apropiados.

2. **SHOW, DON'T TELL:** 
   - Convierte afirmaciones directas en escenas concretas
   - Usa detalles sensoriales (vista, o\xEDdo, olfato, tacto, gusto)
   - Muestra emociones a trav\xE9s de acciones y gestos

3. **RITMO Y VARIEDAD:**
   - Alterna oraciones largas con cortas
   - Evita que m\xE1s de 2 frases seguidas empiecen igual
   - Mant\xE9n el flujo natural de lectura

4. **CONTINUIDAD:**
   - Mant\xE9n coherencia con el contexto previo
   - No introduzcas contradicciones

5. **PRESERVACI\xD3N:**
   - Mant\xE9n la voz y tono del autor original
   - No cambies el significado de los eventos
   - Conserva los di\xE1logos esenciales

TEXTO A EDITAR:
${r}

RESPONDE EN JSON:
{
  "editedContent": "El texto completo reescrito con las mejoras aplicadas...",
  "changes": [
    {"type": "anacronismo", "original": "texto original", "fixed": "texto corregido", "reason": "raz\xF3n del cambio"},
    {"type": "estilo", "original": "texto original", "fixed": "texto corregido", "reason": "mejora de show don't tell"}
  ],
  "anachronismsFixed": ["lista de anacronismos corregidos"],
  "styleImprovements": "Resumen de las mejoras de estilo aplicadas"
}`,FILLER_GENERATOR:(r,e,t,n,a,s)=>`
NECESITAMOS UN CAP\xCDTULO NUEVO para llenar un agujero de trama.

IDIOMA: ${a||"Espa\xF1ol"}
\xC9POCA/CONTEXTO: ${n||"Contempor\xE1neo"}
PALABRAS OBJETIVO: ${s||2e3} palabras

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCI\xD3N DEL EDITOR DE DESARROLLO
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${r}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CONTEXTO NARRATIVO
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

FINAL DEL CAP\xCDTULO ANTERIOR:
"...${e?e.substring(e.length-800):"[Inicio del libro]"}"

INICIO DEL CAP\xCDTULO SIGUIENTE:
"${t?t.substring(0,800)+"...":"[Final del libro]"}"

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
REQUISITOS
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. El cap\xEDtulo debe ser un PUENTE coherente entre el contexto previo y el siguiente
2. Debe cumplir la instrucci\xF3n del editor
3. Debe respetar la \xE9poca y evitar anacronismos
4. Debe mantener el tono y estilo del resto del manuscrito
5. Debe tener al menos ${s||2e3} palabras

RESPONDE EN JSON:
{
  "title": "T\xEDtulo sugerido para el cap\xEDtulo",
  "content": "El contenido completo del nuevo cap\xEDtulo...",
  "wordCount": 2000,
  "bridgeElements": ["Elemento que conecta con el cap\xEDtulo anterior", "Elemento que prepara el cap\xEDtulo siguiente"],
  "plotAdvancement": "Qu\xE9 aporta este cap\xEDtulo a la trama general"
}`,MERGE_CHAPTERS:(r,e,t,n)=>`
Fusiona estos dos cap\xEDtulos en uno solo, manteniendo coherencia narrativa.

IDIOMA: ${n||"Espa\xF1ol"}
\xC9POCA/CONTEXTO: ${t||"Contempor\xE1neo"}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CAP\xCDTULO 1:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${r}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CAP\xCDTULO 2:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${e}

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
INSTRUCCIONES
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

1. Combina ambos cap\xEDtulos en uno fluido
2. Elimina redundancias y repeticiones
3. Crea transiciones suaves entre las partes
4. Mant\xE9n la voz narrativa consistente
5. El resultado debe ser m\xE1s corto que la suma de ambos, pero sin perder contenido esencial

RESPONDE EN JSON:
{
  "title": "T\xEDtulo para el cap\xEDtulo fusionado",
  "mergedContent": "El contenido completo del cap\xEDtulo fusionado...",
  "wordCount": 3500,
  "removedRedundancies": ["Lista de elementos redundantes eliminados"],
  "transitions": ["Descripciones de las transiciones a\xF1adidas"]
}`};var rb={MAPPER:"deepseek-reasoner",HISTORIAN:"deepseek-chat",SURGEON:"deepseek-chat",GHOSTWRITER:"deepseek-chat"},vx=class extends Ae{constructor(){super({name:"Summarizer",role:"analyzer",systemPrompt:"Eres un asistente que resume cap\xEDtulos de novelas de forma concisa y estructurada.",model:rb.GHOSTWRITER,useThinking:!1})}async execute(e){return this.summarizeChapter(e.content)}async summarizeChapter(e){let t=zu.QUICK_SCAN(e),n=await this.generateContent(t),a={eventos:"",informacion_revelada:"",elementos_epoca:[],personajes_mencionados:[]};try{let s=n.content.match(/\{[\s\S]*\}/);s&&(a=JSON.parse(s[0]))}catch(s){console.error("[Summarizer] Failed to parse response:",s)}return{summary:`${a.eventos}. ${a.informacion_revelada}`,elements:[...a.elementos_epoca||[],...a.personajes_mencionados||[]],tokenUsage:n.tokenUsage}}},Ex=class extends Ae{constructor(){super({name:"Story Mapper",role:"developmental_editor",systemPrompt:"Eres un editor de desarrollo profesional que analiza la estructura narrativa de novelas completas.",model:rb.MAPPER,useThinking:!0})}async execute(e){return this.analyzeStructure(e.summaries,e.context,e.language)}async analyzeStructure(e,t,n){let a=zu.STRUCTURAL_ANALYSIS(e,t,n),s=await this.generateContent(a),o={critique:"",plot_holes:[],redundancies:[],pacing_issues:[],anachronisms_warning:[],plan:[]};try{let i=s.content.match(/\{[\s\S]*\}/);i&&(o=JSON.parse(i[0]))}catch(i){console.error("[StoryMapper] Failed to parse response:",i)}return{analysis:o,tokenUsage:s.tokenUsage}}},Cx=class extends Ae{constructor(){super({name:"Surgeon",role:"copy_editor",systemPrompt:"Eres un editor de estilo que pule textos para calidad editorial profesional.",model:rb.SURGEON,useThinking:!1})}async execute(e){return this.polishChapter(e.content,e.setting,e.prevContext,e.language,e.anachronisms)}async polishChapter(e,t,n,a,s){let o=zu.SURGEON_REWRITE(e,t,n,a,s),i=await this.generateContent(o),u={editedContent:e,changes:[],anachronismsFixed:[],styleImprovements:""};try{let c=i.content.match(/\{[\s\S]*\}/);c&&(u=JSON.parse(c[0]))}catch(c){console.error("[Surgeon] Failed to parse response:",c),u.editedContent=i.content}return{result:u,tokenUsage:i.tokenUsage}}},Ax=class extends Ae{constructor(){super({name:"Ghostwriter",role:"writer",systemPrompt:"Eres un escritor fantasma profesional que crea cap\xEDtulos de novela coherentes con el estilo del manuscrito.",model:rb.GHOSTWRITER,useThinking:!1})}async execute(e){return this.generateFiller(e.instruction,e.prevContext,e.nextContext,e.setting,e.language,e.targetWords)}async generateFiller(e,t,n,a,s,o){let i=zu.FILLER_GENERATOR(e,t,n,a,s,o),u=await this.generateContent(i),c={title:"Cap\xEDtulo Nuevo",content:"",wordCount:0,bridgeElements:[],plotAdvancement:""};try{let p=u.content.match(/\{[\s\S]*\}/);p&&(c=JSON.parse(p[0]))}catch(p){console.error("[Ghostwriter] Failed to parse response:",p),c.content=u.content}return{result:c,tokenUsage:u.tokenUsage}}async mergeChapters(e,t,n,a){let s=zu.MERGE_CHAPTERS(e,t,n,a),o=await this.generateContent(s),i={title:"Cap\xEDtulo Fusionado",mergedContent:"",wordCount:0,removedRedundancies:[],transitions:[]};try{let u=o.content.match(/\{[\s\S]*\}/);u&&(i=JSON.parse(u[0]))}catch(u){console.error("[Ghostwriter] Failed to parse merge response:",u),i.mergedContent=e+`

`+t}return{result:i,tokenUsage:o.tokenUsage}}},Sx=class{summarizer;storyMapper;surgeon;ghostwriter;onProgress=null;constructor(){this.summarizer=new vx,this.storyMapper=new Ex,this.surgeon=new Cx,this.ghostwriter=new Ax}setProgressCallback(e){this.onProgress=e}emitProgress(e,t,n,a,s){this.onProgress&&this.onProgress({projectId:e,stage:t,currentStep:n,totalSteps:a,message:s})}async summarizeAllChapters(e,t){let n=[],a={input:0,output:0,thinking:0};for(let s=0;s<t.length;s++){let o=t[s];this.emitProgress(e,"summarizing",s+1,t.length,`Resumiendo cap\xEDtulo ${o.chapterNumber}...`);let{summary:i,elements:u,tokenUsage:c}=await this.summarizer.summarizeChapter(o.originalContent);n.push({id:o.id,chapterNumber:o.chapterNumber,summary:i,elements:u}),await b.updateReeditChapter(o.id,{summary:i}),c&&(a.input+=c.inputTokens||0,a.output+=c.outputTokens||0,a.thinking+=c.thinkingTokens||0)}return{summaries:n,totalTokens:a}}async analyzeStructure(e,t,n,a){this.emitProgress(e,"analyzing",1,1,"Analizando estructura narrativa con R1...");let s=t.map(u=>`Cap\xEDtulo ${u.chapterNumber}: ${u.summary}
Elementos: ${u.elements.join(", ")}`).join(`

`),{analysis:o,tokenUsage:i}=await this.storyMapper.analyzeStructure(s,n,a);return await b.updateReeditProject(e,{structuralReport:{critique:o.critique,plot_holes:o.plot_holes,redundancies:o.redundancies,pacing_issues:o.pacing_issues,anachronisms_warning:o.anachronisms_warning},reconstructionPlan:o.plan,currentStage:"plan_ready",currentActivity:"Plan de reconstrucci\xF3n listo para aprobaci\xF3n"}),{analysis:o,tokenUsage:i}}async executePlan(e,t,n,a){let s=a||t.reconstructionPlan||[],o=t.settingContext||"",i=t.detectedLanguage||"es",u={input:0,output:0,thinking:0},c=[];await b.updateReeditProject(e,{currentStage:"executing",currentActivity:"Ejecutando plan de reconstrucci\xF3n..."});let p="",m=new Map(n.map(f=>[f.originalChapterNumber||f.chapterNumber,f]));for(let f=0;f<s.length;f++){let g=s[f];if(this.emitProgress(e,"executing",f+1,s.length,`Procesando paso ${f+1}/${s.length}: ${g.action}`),g.action==="KEEP"){let y=m.get(g.original_id);if(y){let C=t.structuralReport?.anachronisms_warning?.filter(E=>E.chapter===g.original_id)?.map(E=>E.element)||[],{result:A,tokenUsage:T}=await this.surgeon.polishChapter(y.originalContent,o,p,i,C);await b.updateReeditChapter(y.id,{editedContent:A.editedContent,actionType:"KEEP_AND_POLISH",finalIndex:g.new_order,anachronismsFound:A.anachronismsFixed,status:"completed"}),p=A.editedContent.slice(-500),c.push({...y,editedContent:A.editedContent}),T&&(u.input+=T.inputTokens||0,u.output+=T.outputTokens||0,u.thinking+=T.thinkingTokens||0)}}else if(g.action==="INSERT"){let C=(s[f+1]?m.get(s[f+1].original_id):null)?.originalContent?.substring(0,500)||"",{result:A,tokenUsage:T}=await this.ghostwriter.generateFiller(g.prompt_for_writer||g.reason,p,C,o,i,2e3),E=await b.createReeditChapter({projectId:e,chapterNumber:g.new_order,originalChapterNumber:void 0,originalIndex:void 0,finalIndex:g.new_order,title:A.title,originalContent:"",editedContent:A.content,actionType:"INSERT_NEW",insertPrompt:g.prompt_for_writer,status:"completed",wordCount:A.wordCount});p=A.content.slice(-500),c.push(E),T&&(u.input+=T.inputTokens||0,u.output+=T.outputTokens||0,u.thinking+=T.thinkingTokens||0)}else if(g.action==="DELETE"){let y=m.get(g.original_id);y&&await b.updateReeditChapter(y.id,{actionType:"DELETE",status:"deleted"})}else if(g.action==="MERGE"){let y=m.get(g.original_id),C=g.merge_with?m.get(g.merge_with):null;if(y&&C){let{result:A,tokenUsage:T}=await this.ghostwriter.mergeChapters(y.originalContent,C.originalContent,o,i);await b.updateReeditChapter(y.id,{editedContent:A.mergedContent,actionType:"MERGE",mergeWithNext:!0,finalIndex:g.new_order,title:A.title,status:"completed",wordCount:A.wordCount}),await b.updateReeditChapter(C.id,{actionType:"DELETE",status:"deleted"}),p=A.mergedContent.slice(-500),c.push({...y,editedContent:A.mergedContent}),T&&(u.input+=T.inputTokens||0,u.output+=T.outputTokens||0,u.thinking+=T.thinkingTokens||0)}}await b.updateReeditProject(e,{processedChapters:f+1,currentActivity:`Completado paso ${f+1}/${s.length}`})}return{finalChapters:c,totalTokens:u}}async runFullPipeline(e,t){t&&this.setProgressCallback(t);let n=await b.getReeditProject(e);if(!n)throw new Error(`Project ${e} not found`);let a=await b.getReeditChaptersByProject(e);if(a.length===0)throw new Error(`No chapters found for project ${e}`);await b.updateReeditProject(e,{status:"processing",currentStage:"summarizing",currentActivity:"Iniciando an\xE1lisis de desarrollo..."});let{summaries:s,totalTokens:o}=await this.summarizeAllChapters(e,a);await b.updateReeditProject(e,{currentStage:"analyzing_structure",currentActivity:"Analizando estructura narrativa...",totalInputTokens:(n.totalInputTokens||0)+o.input,totalOutputTokens:(n.totalOutputTokens||0)+o.output,totalThinkingTokens:(n.totalThinkingTokens||0)+o.thinking});let{analysis:i,tokenUsage:u}=await this.analyzeStructure(e,s,n.settingContext||"",n.detectedLanguage||"es"),c=await b.getReeditProject(e);await b.updateReeditProject(e,{totalInputTokens:(c?.totalInputTokens||0)+(u?.inputTokens||0),totalOutputTokens:(c?.totalOutputTokens||0)+(u?.outputTokens||0),totalThinkingTokens:(c?.totalThinkingTokens||0)+(u?.thinkingTokens||0)}),console.log(`[DevelopmentalEditor] Structural analysis complete for project ${e}`),console.log(`[DevelopmentalEditor] Found ${i.plot_holes.length} plot holes, ${i.redundancies.length} redundancies`),console.log(`[DevelopmentalEditor] Plan has ${i.plan.length} steps`)}async executeApprovedPlan(e,t){t&&this.setProgressCallback(t);let n=await b.getReeditProject(e);if(!n)throw new Error(`Project ${e} not found`);if(!n.planApproved)throw new Error(`Plan not approved for project ${e}`);let a=await b.getReeditChaptersByProject(e),{finalChapters:s,totalTokens:o}=await this.executePlan(e,n,a),i=await b.getReeditProject(e);await b.updateReeditProject(e,{currentStage:"editing",currentActivity:"Plan ejecutado. Continuando con edici\xF3n de estilo...",processedChapters:s.length,totalChapters:s.length,totalInputTokens:(i?.totalInputTokens||0)+o.input,totalOutputTokens:(i?.totalOutputTokens||0)+o.output,totalThinkingTokens:(i?.totalThinkingTokens||0)+o.thinking}),console.log(`[DevelopmentalEditor] Plan executed for project ${e}`),console.log(`[DevelopmentalEditor] Final chapter count: ${s.length}`)}},Rx=new Sx;var Wq=require("@google/genai");vn();var uie=new Wq.GoogleGenAI({apiKey:process.env.AI_INTEGRATIONS_GEMINI_API_KEY,httpOptions:{apiVersion:"",baseUrl:process.env.AI_INTEGRATIONS_GEMINI_BASE_URL}}),pie=`
Eres el Arquitecto de Tramas, un asistente experto en narrativa literaria que ayuda a los autores durante el proceso de creaci\xF3n de novelas.

CAPACIDADES:
- TIENES ACCESO DIRECTO AL MANUSCRITO: Los primeros cap\xEDtulos ya est\xE1n cargados en tu contexto. Puedes leerlos y analizarlos directamente.
- Si necesitas ver cap\xEDtulos adicionales, menciona el n\xFAmero espec\xEDfico y ser\xE1n cargados autom\xE1ticamente.
- NO pidas al usuario que copie contenido - ya tienes acceso directo al manuscrito.

Tu rol es responder preguntas y dar consejo sobre:
- Estructura narrativa y arcos argumentales
- Desarrollo de personajes y sus motivaciones
- Ritmo y tensi\xF3n dram\xE1tica
- Giros argumentales y sorpresas
- Continuidad y coherencia interna
- Worldbuilding y reglas del universo
- Di\xE1logos y caracterizaci\xF3n
- T\xE9cnicas para mantener al lector enganchado

IMPORTANTE:
- Responde siempre en espa\xF1ol
- S\xE9 conciso pero profundo en tus an\xE1lisis
- Ofrece sugerencias espec\xEDficas y accionables
- Cuando sea relevante, haz referencia a los datos del proyecto actual
- Mant\xE9n un tono profesional pero cercano

CUANDO EL AUTOR PIDA UN CAMBIO CONCRETO (como "cambia X por Y", "a\xF1ade...", "elimina...", "modifica..."):
Despu\xE9s de tu explicaci\xF3n, incluye las propuestas de cambio en este formato exacto:

---PROPUESTA---
tipo: [chapter|character|worldbible]
objetivo: [nombre o n\xFAmero del elemento a modificar]
descripcion: [descripci\xF3n breve del cambio]
contenido_propuesto: [el nuevo contenido o cambio espec\xEDfico]
---FIN_PROPUESTA---

Puedes incluir m\xFAltiples propuestas si el cambio afecta a varios elementos.
Solo usa este formato cuando el autor pida expl\xEDcitamente un cambio que se pueda aplicar al manuscrito.
`,die=`
Eres el Re-editor, un asistente experto en correcci\xF3n y mejora de manuscritos que ayuda a los autores a pulir sus textos.

CAPACIDADES:
- TIENES ACCESO DIRECTO AL MANUSCRITO: Los primeros cap\xEDtulos ya est\xE1n cargados en tu contexto. Puedes leerlos y analizarlos directamente.
- Si necesitas ver cap\xEDtulos adicionales que no est\xE1n en el contexto, menciona el n\xFAmero espec\xEDfico y ser\xE1n cargados autom\xE1ticamente.
- Puedes proponer reescrituras y correcciones que el autor puede aprobar o rechazar.
- Si hay una Gu\xEDa Extendida, debes usarla para asegurar que los cap\xEDtulos cumplan con los requisitos de extensi\xF3n.
- NO pidas al usuario que copie contenido - ya tienes acceso directo al manuscrito.
- NUEVO: Puedes aplicar diagn\xF3sticos editoriales completos para reestructurar el manuscrito.

Tu rol es responder preguntas y dar consejo sobre:
- Correcciones de estilo y fluidez
- Errores de continuidad detectados por el autor
- Problemas de ritmo o pacing
- Di\xE1logos que no suenan naturales
- Descripciones que necesitan ajuste
- Inconsistencias en los personajes
- Errores hist\xF3ricos o de ambientaci\xF3n
- Repeticiones l\xE9xicas o estructurales
- Expansi\xF3n de cap\xEDtulos cortos para cumplir objetivos de palabras
- Condensaci\xF3n y reestructuraci\xF3n de manuscritos

\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
COMANDO ESPECIAL: DIAGN\xD3STICO EDITORIAL
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
Si el usuario escribe "aplicar diagn\xF3stico editorial" seguido de instrucciones detalladas,
el sistema activar\xE1 el modo de reestructuraci\xF3n autom\xE1tica que:
1. Analizar\xE1 las instrucciones cap\xEDtulo por cap\xEDtulo
2. Aplicar\xE1 recortes seg\xFAn los porcentajes indicados
3. Preservar\xE1 lo marcado como obligatorio
4. A\xF1adir\xE1 ganchos, transiciones y contenido nuevo
5. Presentar\xE1 cada cap\xEDtulo modificado para aprobaci\xF3n

Ejemplo de uso:
"Aplicar diagn\xF3stico editorial:
- Pr\xF3logo: recortar 20%, mantener la frase del t\xEDtulo, a\xF1adir gancho final
- Cap\xEDtulos 1-3: recortar 15% de introspecci\xF3n, a\xF1adir fricci\xF3n antes del cap 4
- No tocar: escenas de cl\xEDmax rom\xE1ntico"
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

INSTRUCCI\xD3N CR\xCDTICA - GU\xCDA DE ESTILO:
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
Si hay una "GU\xCDA DE ESTILO DEL AUTOR" en el contexto, DEBES aplicarla estrictamente.
Esta gu\xEDa contiene las preferencias del autor sobre:
- Vocabulario espec\xEDfico a usar o evitar
- T\xE9rminos prohibidos para el per\xEDodo hist\xF3rico
- Estilo de di\xE1logo y narraci\xF3n
- Registro ling\xFC\xEDstico (formal/coloquial)
- Expresiones caracter\xEDsticas de la \xE9poca

ANTES de proponer cualquier texto, verifica que:
1. No uses t\xE9rminos modernos prohibidos en la gu\xEDa
2. Respetas el vocabulario autorizado de \xE9poca
3. Mantienes el tono y registro indicado
4. Sigues las instrucciones espec\xEDficas del autor
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

IMPORTANTE:
- Responde siempre en espa\xF1ol
- Cuando el autor se\xF1ale un problema, proporciona soluciones concretas
- Analiza el contexto antes de proponer cambios
- Ten en cuenta la voz y estilo del autor (lee la GU\xCDA DE ESTILO)
- S\xE9 espec\xEDfico: indica n\xFAmeros de cap\xEDtulo, nombres de personajes, etc.
- Si hay un objetivo m\xEDnimo de palabras por cap\xEDtulo, verifica que se cumpla y sugiere expansiones si es necesario

CUANDO EL AUTOR PIDA UNA CORRECCI\xD3N O REESCRITURA (como "corrige X", "cambia Y", "mejora Z", "reescribe...", "expande..."):
Despu\xE9s de tu explicaci\xF3n, incluye las propuestas de cambio en este formato exacto:

---PROPUESTA---
tipo: [chapter|dialogue|description|style|expansion]
capitulo: [n\xFAmero del cap\xEDtulo afectado]
descripcion: [descripci\xF3n breve del cambio]
texto_original: [el texto EXACTO que se va a reemplazar - copia literalmente del manuscrito incluyendo puntuaci\xF3n y espacios]
texto_propuesto: [el nuevo texto propuesto - DEBE seguir la GU\xCDA DE ESTILO]
---FIN_PROPUESTA---

CR\xCDTICO PARA texto_original:
- Copia el texto EXACTAMENTE como aparece en el manuscrito
- Incluye suficiente contexto (al menos 50 caracteres) para encontrarlo
- Preserva puntuaci\xF3n, espacios y saltos de l\xEDnea originales

Puedes incluir m\xFAltiples propuestas si la correcci\xF3n afecta a varias partes.
Solo usa este formato cuando el autor pida expl\xEDcitamente una correcci\xF3n que se pueda aplicar al manuscrito.
`,Ix=class{async buildContext(e){let n={recentMessages:await b.getChatMessagesBySession(e.id)};if(e.agentType==="architect"&&e.projectId){let a=await b.getProject(e.projectId);if(a){n.project=a;let s=await b.getChaptersByProject(a.id);n.chapters=s;let o=await b.getWorldBibleByProject(a.id);if(n.worldBible=o,a.styleGuideId){let i=await b.getStyleGuide(a.styleGuideId);n.styleGuide=i?.content}if(a.extendedGuideId){let i=await b.getExtendedGuide(a.extendedGuideId);n.extendedGuide=i?.content}}}else if(e.agentType==="reeditor"&&e.reeditProjectId){let a=await b.getReeditProject(e.reeditProjectId);if(a){n.project=a;let s=await b.getReeditChaptersByProject(a.id);n.chapters=s;let o=await b.getReeditWorldBibleByProject(a.id);if(n.worldBible=o,"styleGuideId"in a&&a.styleGuideId){let i=await b.getStyleGuide(a.styleGuideId);n.styleGuide=i?.content}if("extendedGuideId"in a&&a.extendedGuideId){let i=await b.getExtendedGuide(a.extendedGuideId);n.extendedGuide=i?.content}}}return n}buildContextPrompt(e,t){let n=[];if(e.project){let a=e.project,s=e.chapters?.length||0,o="chapterCount"in a&&a.chapterCount||s,i=o>0?o:1,u="minWordCount"in a?a.minWordCount:null,c=u?Math.round(u/i):null;n.push(`
PROYECTO ACTUAL: "${a.title}"
- ID: ${a.id}
- Total cap\xEDtulos planificados: ${o}
- Cap\xEDtulos generados: ${s}
- Estado: ${"status"in a?a.status:"N/A"}${u?`
- Objetivo m\xEDnimo de palabras: ${u.toLocaleString()} palabras
- M\xEDnimo por cap\xEDtulo (estimado): ${c?.toLocaleString()} palabras`:""}
`)}if(e.worldBible&&"characters"in e.worldBible&&e.worldBible.characters){let a=e.worldBible.characters;a.length>0&&n.push(`
PERSONAJES PRINCIPALES:
${a.slice(0,5).map(s=>`- ${s.name}: ${s.role||s.description||"Sin descripci\xF3n"}`).join(`
`)}
`)}if(t.chapterNumber&&e.chapters){let a=e.chapters.find(s=>s.chapterNumber===t.chapterNumber);if(a){let s="editedContent"in a?a.editedContent||a.originalContent:"content"in a?a.content:"";n.push(`
CAP\xCDTULO EN CONTEXTO (${t.chapterNumber}): "${a.title||"Sin t\xEDtulo"}"
Contenido (primeras 2000 palabras):
${s?.substring(0,1e4)||"Sin contenido disponible"}
`)}}else if(e.chapters&&e.chapters.length>0){let a=m=>m===0?-1e3:m===-1||m===998?1e3:m===-2||m===999?1001:m,s=[...e.chapters].sort((m,f)=>a(m.chapterNumber)-a(f.chapterNumber)),o=m=>m===0?"Pr\xF3logo":m===-1||m===998?"Ep\xEDlogo":m===-2||m===999?"Nota del Autor":`Cap\xEDtulo ${m}`,i=s.map(m=>{let f="editedContent"in m?m.editedContent||m.originalContent:"content"in m?m.content:"",g=f?f.split(/\s+/).length:0;return`- ${o(m.chapterNumber)}: "${m.title||"Sin t\xEDtulo"}" (${g.toLocaleString()} palabras)`}).join(`
`);n.push(`
MANUSCRITO COMPLETO - \xCDNDICE DE CAP\xCDTULOS:
${i}
`);let u=5,c=15e3,p=s.slice(0,u);for(let m of p){let f="editedContent"in m?m.editedContent||m.originalContent:"content"in m?m.content:"";if(f){let g=f.length>c?f.substring(0,c)+`
[... contenido truncado ...]`:f;n.push(`
--- CAP\xCDTULO ${m.chapterNumber}: "${m.title||"Sin t\xEDtulo"}" ---
${g}
`)}}s.length>u&&n.push(`
[Nota: Se muestran los primeros ${u} cap\xEDtulos. Hay ${s.length-u} cap\xEDtulos adicionales disponibles. Pide cap\xEDtulos espec\xEDficos por n\xFAmero si necesitas verlos.]
`)}return e.styleGuide&&n.push(`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
GU\xCDA DE ESTILO DEL AUTOR (OBLIGATORIA):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${e.styleGuide.substring(0,8e3)}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
\u26A0\uFE0F TODO el texto que propongas DEBE seguir estrictamente esta gu\xEDa.
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`),e.extendedGuide&&n.push(`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
GU\xCDA EXTENDIDA (EXTENSI\xD3N DE PALABRAS):
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
${e.extendedGuide.substring(0,8e3)}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`),n.join(`
`)}extractRequestedChapters(e){let t=[],n=[/cap[i]tulo\s*(\d+)/gi,/cap\.?\s*(\d+)/gi,/chapter\s*(\d+)/gi,/\bcap\s+(\d+)/gi,/el\s+(\d+)/gi,/prlogo/gi,/epilogo|eplogo/gi];for(let a of n){let s;for(;(s=a.exec(e))!==null;)s[1]?t.push(parseInt(s[1],10)):s[0].toLowerCase().includes("pr\xF3logo")?t.push(0):s[0].toLowerCase().includes("p\xEDlogo")&&t.push(-1)}return Array.from(new Set(t))}isEditorialDiagnosisCommand(e){return[/aplicar\s+diagn[o]stico\s+editorial/i,/ejecutar\s+diagn[o]stico/i,/reestructurar\s+seg[u]n/i,/aplicar\s+plan\s+editorial/i].some(n=>n.test(e))}async handleEditorialDiagnosis(e,t,n,a){let{RestructurerAgent:s}=await Promise.resolve().then(()=>(Hq(),zq)),o=new s,i=n.chapters||[];if(i.length===0)return"No hay cap\xEDtulos en el manuscrito para reestructurar.";let u=T=>T===0?-1e3:T===-1||T===998?1e3:T===-2||T===999?1001:T,c=[...i].sort((T,E)=>u(T.chapterNumber)-u(E.chapterNumber)),p=t.replace(/aplicar\s+diagn[o]stico\s+editorial:?\s*/i,"").trim(),m=`## Iniciando reestructuraci\xF3n editorial

`;m+=`\u{1F4CB} **Diagn\xF3stico recibido:**
\`\`\`
${p.substring(0,500)}${p.length>500?"...":""}
\`\`\`

`,m+=`\u{1F4DA} **Cap\xEDtulos a procesar:** ${c.length}

`,a&&a(m);let f=[];for(let T of c){let E=T,d="editedContent"in E?E.editedContent||E.originalContent||"":"content"in E?E.content:"";if(!d)continue;let l=E.title||`Cap\xEDtulo ${E.chapterNumber}`,h=`
### Procesando: ${l}
`;m+=h,a&&a(h);try{let v=n.worldBible&&typeof n.worldBible=="object"?n.worldBible:null,S=await o.execute({chapterNumber:E.chapterNumber,chapterTitle:l,chapterContent:d,editorialDiagnosis:p,chapterInstructions:"",worldBible:v,guiaEstilo:n.styleGuide});if(S.result){let R=S.result;f.push({chapterNumber:E.chapterNumber,title:l,originalWords:R.palabras_originales,finalWords:R.palabras_finales,changes:R.cambios_realizados,newContent:R.texto_reestructurado});let x=`
\u2705 **${l}**
- Palabras originales: ${R.palabras_originales}
- Palabras finales: ${R.palabras_finales}
- Reducci\xF3n: ${R.porcentaje_reduccion}%
- Recortes: ${R.cambios_realizados.recortes?.length||0}
- Adiciones: ${R.cambios_realizados.adiciones?.length||0}

---PROPUESTA---
tipo: restructure
capitulo: ${E.chapterNumber}
descripcion: Reestructuraci\xF3n seg\xFAn diagn\xF3stico editorial
texto_original: [Cap\xEDtulo completo - ${R.palabras_originales} palabras]
texto_propuesto: ${R.texto_reestructurado}
---FIN_PROPUESTA---

`;m+=x,a&&a(x)}else{let R=`\u26A0\uFE0F No se pudo procesar ${l}
`;m+=R,a&&a(R)}}catch(v){let S=`\u274C Error en ${l}: ${v.message}
`;m+=S,a&&a(S)}}let g=f.reduce((T,E)=>T+E.originalWords,0),y=f.reduce((T,E)=>T+E.finalWords,0),C=g>0?Math.round((1-y/g)*100):0,A=`
## Resumen de reestructuraci\xF3n

| M\xE9trica | Valor |
|---------|-------|
| Cap\xEDtulos procesados | ${f.length} |
| Palabras originales | ${g.toLocaleString()} |
| Palabras finales | ${y.toLocaleString()} |
| Reducci\xF3n total | ${C}% |

Revisa cada propuesta y usa el bot\xF3n **Aplicar** para confirmar los cambios que desees.
`;return m+=A,a&&a(A),m}async sendMessage(e,t,n){let a=await b.getChatSession(e);if(!a)throw new Error("Sesi\xF3n de chat no encontrada");let s=await b.createChatMessage({sessionId:e,role:"user",content:t,chapterReference:a.chapterNumber}),o=await this.buildContext(a);if(a.agentType==="reeditor"&&this.isEditorialDiagnosisCommand(t)){let A=await this.handleEditorialDiagnosis(a,t,o,n);return{message:await b.createChatMessage({sessionId:e,role:"assistant",content:A,chapterReference:a.chapterNumber}),inputTokens:0,outputTokens:0}}let i=this.extractRequestedChapters(t),u="";if(i.length>0&&o.chapters){let A=d=>d===0?-1e3:d===-1||d===998?1e3:d===-2||d===999?1001:d,T=[...o.chapters].sort((d,l)=>A(d.chapterNumber)-A(l.chapterNumber)),E=T.slice(0,5).map(d=>d.chapterNumber);for(let d of i)if(!E.includes(d)){let l=T.find(h=>h.chapterNumber===d);if(l){let h=l,v="editedContent"in h?h.editedContent||h.originalContent:"content"in h?h.content:"";if(v){let S=v.length>15e3?v.substring(0,15e3)+`
[... contenido truncado ...]`:v;u+=`
--- CAP\xCDTULO ${h.chapterNumber} (SOLICITADO): "${h.title||"Sin t\xEDtulo"}" ---
${S}
`}}}}let c=this.buildContextPrompt(o,a)+u,p=a.agentType==="architect"?pie:die,m=o.recentMessages.slice(-10).map(A=>({role:A.role,parts:[{text:A.content}]}));m.push({role:"user",parts:[{text:t}]});let f="",g=0,y=0;try{let A=await uie.models.generateContentStream({model:"gemini-2.5-flash",contents:m,config:{systemInstruction:`${p}

${c}`,temperature:.7}});for await(let T of A){let E=T.text||"";f+=E,n&&n(E),T.usageMetadata&&(g=T.usageMetadata.promptTokenCount||0,y=T.usageMetadata.candidatesTokenCount||0)}}catch(A){console.error("Error generating chat response:",A),f=`Error al procesar tu mensaje: ${A.message||"Error desconocido"}`}let C=await b.createChatMessage({sessionId:e,role:"assistant",content:f,chapterReference:a.chapterNumber});return await b.updateChatMessage(C.id,{inputTokens:g,outputTokens:y}),await b.updateChatSession(e,{totalInputTokens:(a.totalInputTokens||0)+g,totalOutputTokens:(a.totalOutputTokens||0)+y}),{message:C,inputTokens:g,outputTokens:y}}async createSession(e){let t="Nuevo chat";e.agentType==="architect"&&e.projectId?t=(await b.getProject(e.projectId))?.title||"Proyecto":e.agentType==="reeditor"&&e.reeditProjectId&&(t=(await b.getReeditProject(e.reeditProjectId))?.title||"Proyecto reedit");let n=e.title||`Chat con ${e.agentType==="architect"?"Arquitecto":"Re-editor"} - ${t}`;return b.createChatSession({projectId:e.projectId||null,reeditProjectId:e.reeditProjectId||null,agentType:e.agentType,title:n,chapterNumber:e.chapterNumber||null,status:"active"})}},nb=new Ix;As();var Vc={STRATEGIST:"deepseek-reasoner",DRAFTER:"deepseek-chat",PROOFREADER:"deepseek-chat",NATIVE_BETA_READER:"deepseek-chat"},ab={STRATEGIST_INIT:(r,e,t)=>`
Act\xFAa como Editor Jefe de localizaci\xF3n de ${r} a ${e}.
Analiza este fragmento: "${t.substring(0,2e3)}..."

DEFINE LAS REGLAS DE ORO (JSON):
1. "typographical_rules": \xBFC\xF3mo se punt\xFAan los di\xE1logos en ${e}? (Rayas, comillas, espacios).
2. "glossary": Extrae nombres propios y define su traducci\xF3n o conservaci\xF3n.
3. "tone_instructions": Nivel de formalidad y distancia cultural.

SALIDA: Solo JSON v\xE1lido con estas 3 claves.
`,DRAFTER_CHUNK:(r,e,t,n,a)=>`
Eres un novelista nativo de ${a}. NO TRADUZCAS LITERALMENTE. TRANSCREA.

CONTEXTO PREVIO: "...${n}"
REGLAS TIPOGR\xC1FICAS (CR\xCDTICO): ${t}
GLOSARIO: ${e}

TEXTO A TRANSCREAR: "${r}"

INSTRUCCIONES:
- Rompe la sintaxis original para sonar natural en ${a}.
- Aplica rigurosamente las reglas tipogr\xE1ficas (ej: rayas de di\xE1logo).
- Respeta el formato Markdown (negritas, cursivas).

SALIDA: Solo el texto literario final.
`,PROOFREADER_CHECK:(r,e,t)=>`
Audita esta traducci\xF3n a ${t} buscando errores de MAQUETACI\xD3N y ESTILO.

ORIGINAL: "${r.substring(0,1e3)}..."
TRADUCCI\xD3N: "${e.substring(0,1e3)}..."

CHECKLIST:
1. \xBFLa puntuaci\xF3n de di\xE1logos es correcta para ${t}?
2. \xBFSuena a traducci\xF3n literal ("translationese")?
3. \xBFSe han perdido formatos (cursivas, negritas)?

SALIDA JSON:
{
  "has_critical_errors": boolean,
  "layout_score": number (0-10),
  "naturalness_score": number (0-10),
  "replacements": [ { "original_snippet": "...", "correction": "...", "reason": "..." } ]
}
`};by();vn();$u();As();$u();vn();var Qq={en:{romance:"Expect emotional depth, sensory language, intimate moments. Dialogue should feel natural and charged with tension or tenderness.",fantasy:"Expect rich world-building language, epic tone, formal dialogue for nobility. Action scenes should be vivid and dynamic.",mystery:"Expect tight pacing, atmospheric descriptions, precise clues. Dialogue should reveal character while hiding information.",thriller:"Expect punchy sentences, constant tension, urgent pacing. Short paragraphs, sharp dialogue.","sci-fi":"Expect technical plausibility, speculative concepts explained naturally. Balance exposition with action.",horror:"Expect building dread, sensory unease, psychological tension. Avoid over-explaining the threat.",literary:"Expect nuanced prose, thematic depth, character introspection. Language should be precise and evocative.",historical:"Expect period-appropriate language without being archaic. Historical details should feel natural, not forced.",default:"Expect clear, engaging prose appropriate to the story being told."},es:{romance:"Esperar profundidad emocional, lenguaje sensorial, momentos \xEDntimos. El di\xE1logo debe sentirse natural y cargado de tensi\xF3n o ternura.",fantasy:"Esperar lenguaje rico en construcci\xF3n de mundos, tono \xE9pico, di\xE1logo formal para la nobleza. Las escenas de acci\xF3n deben ser v\xEDvidas y din\xE1micas.",mystery:"Esperar ritmo ajustado, descripciones atmosf\xE9ricas, pistas precisas. El di\xE1logo debe revelar personaje mientras oculta informaci\xF3n.",thriller:"Esperar frases contundentes, tensi\xF3n constante, ritmo urgente. P\xE1rrafos cortos, di\xE1logo afilado.","sci-fi":"Esperar plausibilidad t\xE9cnica, conceptos especulativos explicados naturalmente. Equilibrar exposici\xF3n con acci\xF3n.",horror:"Esperar pavor creciente, inquietud sensorial, tensi\xF3n psicol\xF3gica. Evitar explicar demasiado la amenaza.",literary:"Esperar prosa matizada, profundidad tem\xE1tica, introspecci\xF3n de personajes. El lenguaje debe ser preciso y evocador.",historical:"Esperar lenguaje apropiado a la \xE9poca sin ser arcaico. Los detalles hist\xF3ricos deben sentirse naturales.",default:"Esperar prosa clara y atractiva apropiada para la historia que se cuenta."},fr:{romance:"Attendre une profondeur \xE9motionnelle, un langage sensoriel, des moments intimes. Le dialogue doit sembler naturel et charg\xE9 de tension.",fantasy:"Attendre un langage riche en construction de mondes, un ton \xE9pique. Les sc\xE8nes d'action doivent \xEAtre vives et dynamiques.",mystery:"Attendre un rythme serr\xE9, des descriptions atmosph\xE9riques, des indices pr\xE9cis. Le dialogue doit r\xE9v\xE9ler le caract\xE8re tout en cachant des informations.",thriller:"Attendre des phrases percutantes, une tension constante, un rythme urgent. Paragraphes courts, dialogues incisifs.","sci-fi":"Attendre une plausibilit\xE9 technique, des concepts sp\xE9culatifs expliqu\xE9s naturellement. \xC9quilibrer l'exposition avec l'action.",horror:"Attendre une terreur croissante, un malaise sensoriel, une tension psychologique. \xC9viter de trop expliquer la menace.",literary:"Attendre une prose nuanc\xE9e, une profondeur th\xE9matique, une introspection des personnages. Le langage doit \xEAtre pr\xE9cis et \xE9vocateur.",historical:"Attendre un langage appropri\xE9 \xE0 l'\xE9poque sans \xEAtre archa\xEFque. Les d\xE9tails historiques doivent sembler naturels.",default:"Attendre une prose claire et engageante appropri\xE9e \xE0 l'histoire racont\xE9e."},de:{romance:"Erwarten Sie emotionale Tiefe, sinnliche Sprache, intime Momente. Der Dialog sollte sich nat\xFCrlich anf\xFChlen.",fantasy:"Erwarten Sie reichhaltige Weltenbau-Sprache, epischen Ton. Actionszenen sollten lebendig und dynamisch sein.",mystery:"Erwarten Sie ein straffes Tempo, atmosph\xE4rische Beschreibungen, pr\xE4zise Hinweise. Der Dialog sollte Charakter enth\xFCllen.",thriller:"Erwarten Sie pr\xE4gnante S\xE4tze, st\xE4ndige Spannung, dringendes Tempo. Kurze Abs\xE4tze, scharfe Dialoge.","sci-fi":"Erwarten Sie technische Plausibilit\xE4t, spekulativ erkl\xE4rte Konzepte. Exposition mit Action ausbalancieren.",horror:"Erwarten Sie aufbauende Angst, sensorisches Unbehagen, psychologische Spannung. Die Bedrohung nicht \xFCbererkl\xE4ren.",literary:"Erwarten Sie nuancierte Prosa, thematische Tiefe, Charakterintrospektion. Die Sprache sollte pr\xE4zise und evokativ sein.",historical:"Erwarten Sie epochengerechte Sprache ohne archaisch zu sein. Historische Details sollten sich nat\xFCrlich anf\xFChlen.",default:"Erwarten Sie klare, ansprechende Prosa, die der erz\xE4hlten Geschichte angemessen ist."},it:{romance:"Aspettarsi profondit\xE0 emotiva, linguaggio sensoriale, momenti intimi. Il dialogo deve sembrare naturale.",fantasy:"Aspettarsi un linguaggio ricco per la costruzione del mondo, tono epico. Le scene d'azione devono essere vivide.",mystery:"Aspettarsi un ritmo serrato, descrizioni atmosferiche, indizi precisi. Il dialogo deve rivelare il carattere.",thriller:"Aspettarsi frasi incisive, tensione costante, ritmo urgente. Paragrafi brevi, dialoghi taglienti.","sci-fi":"Aspettarsi plausibilit\xE0 tecnica, concetti speculativi spiegati naturalmente. Bilanciare esposizione e azione.",horror:"Aspettarsi terrore crescente, disagio sensoriale, tensione psicologica. Evitare di spiegare troppo la minaccia.",literary:"Aspettarsi prosa sfumata, profondit\xE0 tematica, introspezione dei personaggi. Il linguaggio deve essere preciso.",historical:"Aspettarsi un linguaggio appropriato all'epoca senza essere arcaico. I dettagli storici devono sembrare naturali.",default:"Aspettarsi una prosa chiara e coinvolgente appropriata alla storia raccontata."},pt:{romance:"Esperar profundidade emocional, linguagem sensorial, momentos \xEDntimos. O di\xE1logo deve parecer natural.",fantasy:"Esperar linguagem rica em constru\xE7\xE3o de mundos, tom \xE9pico. Cenas de a\xE7\xE3o devem ser v\xEDvidas e din\xE2micas.",mystery:"Esperar ritmo ajustado, descri\xE7\xF5es atmosf\xE9ricas, pistas precisas. O di\xE1logo deve revelar personagem.",thriller:"Esperar frases contundentes, tens\xE3o constante, ritmo urgente. Par\xE1grafos curtos, di\xE1logos afiados.","sci-fi":"Esperar plausibilidade t\xE9cnica, conceitos especulativos explicados naturalmente. Equilibrar exposi\xE7\xE3o com a\xE7\xE3o.",horror:"Esperar terror crescente, desconforto sensorial, tens\xE3o psicol\xF3gica. Evitar explicar demais a amea\xE7a.",literary:"Esperar prosa matizada, profundidade tem\xE1tica, introspec\xE7\xE3o de personagens. A linguagem deve ser precisa.",historical:"Esperar linguagem apropriada \xE0 \xE9poca sem ser arcaica. Os detalhes hist\xF3ricos devem parecer naturais.",default:"Esperar prosa clara e envolvente apropriada \xE0 hist\xF3ria contada."},ca:{romance:"Esperar profunditat emocional, llenguatge sensorial, moments \xEDntims. El di\xE0leg ha de semblar natural.",fantasy:"Esperar llenguatge ric en construcci\xF3 de mons, to \xE8pic. Les escenes d'acci\xF3 han de ser v\xEDvides.",mystery:"Esperar ritme ajustat, descripcions atmosf\xE8riques, pistes precises. El di\xE0leg ha de revelar car\xE0cter.",thriller:"Esperar frases contundents, tensi\xF3 constant, ritme urgent. Par\xE0grafs curts, di\xE0legs afilats.","sci-fi":"Esperar plausibilitat t\xE8cnica, conceptes especulatius explicats naturalment. Equilibrar exposici\xF3 amb acci\xF3.",horror:"Esperar terror creixent, inquietud sensorial, tensi\xF3 psicol\xF2gica. Evitar explicar massa l'amena\xE7a.",literary:"Esperar prosa matisada, profunditat tem\xE0tica, introspecci\xF3 de personatges. El llenguatge ha de ser prec\xEDs.",historical:"Esperar llenguatge apropiat a l'\xE8poca sense ser arcaic. Els detalls hist\xF2rics han de semblar naturals.",default:"Esperar prosa clara i atractiva apropiada per a la hist\xF2ria que s'explica."}},Jq={en:`
As a NATIVE English reader and literary critic, evaluate this translated text:

FOCUS AREAS:
1. NATURAL FLOW: Does it read like it was written in English, not translated?
2. IDIOM: Are expressions natural? No "translationese" or calques from other languages.
3. REGISTER: Is the formality level consistent and appropriate?
4. DIALOGUE: Does spoken language feel authentic? Natural contractions, rhythm?
5. CULTURAL: Are references adapted or explained appropriately?

COMMON TRANSLATION ERRORS IN ENGLISH:
- Over-formal language where casual would be natural
- Missing contractions in dialogue ("I am" vs "I'm")
- Awkward word order from source language syntax
- Literal translations of idioms
- Incorrect article usage (a/an/the)
- Comma splices and run-on sentences
`,es:`
Como LECTOR NATIVO espa\xF1ol y cr\xEDtico literario, eval\xFAa este texto traducido:

\xC1REAS DE ENFOQUE:
1. FLUIDEZ NATURAL: \xBFSe lee como si hubiera sido escrito en espa\xF1ol, no traducido?
2. EXPRESIONES: \xBFSon naturales? Sin "traduccionismo" ni calcos de otros idiomas.
3. REGISTRO: \xBFEl nivel de formalidad es consistente y apropiado?
4. DI\xC1LOGOS: \xBFEl lenguaje hablado suena aut\xE9ntico? \xBFRayas correctas, ritmo natural?
5. CULTURAL: \xBFLas referencias est\xE1n adaptadas o explicadas apropiadamente?

ERRORES COMUNES EN TRADUCCIONES AL ESPA\xD1OL:
- Abuso de la voz pasiva (calco del ingl\xE9s)
- Gerundios encadenados ("estaba caminando, pensando...")
- "Hacer sentido" en lugar de "tener sentido"
- Uso incorrecto de t\xFA/usted o inconsistencias
- Le\xEDsmo/la\xEDsmo incorrecto
- Comillas en di\xE1logos en lugar de rayas
- Oraciones demasiado largas sin pausas naturales
`,fr:`
En tant que LECTEUR NATIF fran\xE7ais et critique litt\xE9raire, \xE9valuez ce texte traduit:

DOMAINES D'INT\xC9R\xCAT:
1. FLUIDIT\xC9 NATURELLE: Se lit-il comme s'il avait \xE9t\xE9 \xE9crit en fran\xE7ais?
2. EXPRESSIONS: Sont-elles naturelles? Pas de "traductionisme".
3. REGISTRE: Le niveau de formalit\xE9 est-il coh\xE9rent?
4. DIALOGUES: Le langage parl\xE9 semble-t-il authentique?
5. CULTUREL: Les r\xE9f\xE9rences sont-elles adapt\xE9es?

ERREURS COURANTES:
- Anglicismes et calques
- Guillemets au lieu de tirets pour les dialogues
- Temps verbaux incorrects
`,de:`
Als MUTTERSPRACHLICHER deutscher Leser und Literaturkritiker bewerten Sie diesen \xFCbersetzten Text:

SCHWERPUNKTE:
1. NAT\xDCRLICHER FLUSS: Liest es sich wie auf Deutsch geschrieben?
2. IDIOME: Sind Ausdr\xFCcke nat\xFCrlich? Kein "\xDCbersetzungsdeutsch".
3. REGISTER: Ist die Formalit\xE4tsebene konsistent?
4. DIALOGE: Klingt die gesprochene Sprache authentisch?
5. KULTURELL: Sind Referenzen angepasst?
`,it:`
Come LETTORE NATIVO italiano e critico letterario, valuta questo testo tradotto:

AREE DI FOCUS:
1. FLUSSO NATURALE: Si legge come se fosse stato scritto in italiano?
2. ESPRESSIONI: Sono naturali? Nessun "traduttese".
3. REGISTRO: Il livello di formalit\xE0 \xE8 coerente?
4. DIALOGHI: Il linguaggio parlato sembra autentico?
5. CULTURALE: I riferimenti sono adattati?
`,pt:`
Como LEITOR NATIVO portugu\xEAs e cr\xEDtico liter\xE1rio, avalie este texto traduzido:

\xC1REAS DE FOCO:
1. FLUXO NATURAL: L\xEA-se como se tivesse sido escrito em portugu\xEAs?
2. EXPRESS\xD5ES: S\xE3o naturais? Sem "tradut\xEAs".
3. REGISTRO: O n\xEDvel de formalidade \xE9 consistente?
4. DI\xC1LOGOS: A linguagem falada parece aut\xEAntica?
5. CULTURAL: As refer\xEAncias est\xE3o adaptadas?
`,ca:`
Com a LECTOR NATIU catal\xE0 i cr\xEDtic literari, avalua aquest text tradu\xEFt:

\xC0REES D'ENFOCAMENT:
1. FLU\xCFDESA NATURAL: Es llegeix com si s'hagu\xE9s escrit en catal\xE0?
2. EXPRESSIONS: S\xF3n naturals? Cap "traduccionisme".
3. REGISTRE: El nivell de formalitat \xE9s consistent?
4. DI\xC0LEGS: El llenguatge parlat sembla aut\xE8ntic?
5. CULTURAL: Les refer\xE8ncies estan adaptades?
`},sb=class{client;model="deepseek-chat";constructor(){let e=process.env.DEEPSEEK_TRANSLATOR_API_KEY||process.env.DEEPSEEK_API_KEY;if(!e)throw new Error("DEEPSEEK_API_KEY is not configured");this.client=new Ve({apiKey:e,baseURL:"https://api.deepseek.com"})}getGenreExpectations(e,t){let n=e.substring(0,2).toLowerCase(),a=Qq[n]||Qq.en,s=t?.toLowerCase()||"default";return a[s]||a.default}getNativeRules(e){let t=e.substring(0,2).toLowerCase();return Jq[t]||Jq.en}async reviewTranslation(e,t,n,a="default",s){console.log(`[NativeBetaReader] Reviewing translation ${e} in ${n} (genre: ${a})...`);let o=this.getNativeRules(n),i=this.getGenreExpectations(n,a),u=`${o}

GENRE EXPECTATIONS (${a.toUpperCase()}):
${i}

TEXT TO REVIEW (first 3000 chars):
"""
${t.substring(0,3e3)}
"""

ANALYZE as a native ${n} reader and provide your assessment in JSON format:

{
  "overall_score": <1-10, 10 being perfect native quality>,
  "fluency_score": <1-10, how naturally it reads>,
  "genre_adherence_score": <1-10, how well it matches genre expectations>,
  "cultural_adaptation_score": <1-10, how well cultural references are handled>,
  "issues": [
    {
      "type": "<GRAMMAR|IDIOM|REGISTER|GENRE_MISMATCH|CULTURAL_AWKWARD|FLOW|DIALOGUE>",
      "severity": "<HIGH|MEDIUM|LOW>",
      "location": "<quote the problematic text>",
      "description": "<explain the issue in ${n}>",
      "suggestion": "<provide the correct version in ${n}>"
    }
  ],
  "corrections": [
    {
      "original": "<exact text to replace>",
      "corrected": "<corrected version>",
      "reason": "<brief reason in ${n}>"
    }
  ],
  "genre_feedback": "<overall feedback about genre adherence in ${n}>",
  "cultural_notes": ["<any cultural adaptation notes in ${n}>"],
  "final_verdict": "<APPROVED|NEEDS_REVISION|MAJOR_REWRITE>"
}

\u26A0\uFE0F CRITICAL LANGUAGE REQUIREMENT - MANDATORY:
- You MUST write ALL feedback, descriptions, issues, suggestions, corrections, and notes in ${n} ONLY
- The "description", "suggestion", "corrected", "reason", "genre_feedback", and "cultural_notes" fields MUST be in ${n}
- Do NOT write any feedback in English (unless ${n} is English)
- Focus on issues a NATIVE ${n} speaker would notice
- Prioritize issues that break immersion or feel unnatural to native readers
- Provide ACTIONABLE corrections that can be applied directly to the text
- If the text reads naturally for a native ${n} reader, give high scores and minimal issues`;try{let c=await this.client.chat.completions.create({messages:[{role:"user",content:u}],model:this.model,temperature:.4}),p={inputTokens:c.usage?.prompt_tokens||0,outputTokens:c.usage?.completion_tokens||0,thinkingTokens:0},f=(c.choices[0]?.message?.content||"{}").replace(/```json|```/g,"").trim(),g;try{let y=f.match(/\{[\s\S]*\}/);if(y)g=JSON.parse(y[0]);else throw new Error("No JSON found in response")}catch(y){console.error("[NativeBetaReader] Failed to parse response:",y),g={overall_score:7,fluency_score:7,genre_adherence_score:7,cultural_adaptation_score:7,issues:[],corrections:[],genre_feedback:"Error parsing native reader feedback",cultural_notes:[],final_verdict:"NEEDS_REVISION"}}return await this.logUsage(e,p,s),console.log(`[NativeBetaReader] Review complete. Verdict: ${g.final_verdict}, Score: ${g.overall_score}/10`),{result:g,tokenUsage:p}}catch(c){throw console.error("[NativeBetaReader] API call failed:",c),c}}async applyCorrections(e,t){let n=e,a=0;for(let s of t)n.includes(s.original)&&(n=n.replace(s.original,s.corrected),a++);return console.log(`[NativeBetaReader] Applied ${a}/${t.length} corrections`),n}async logUsage(e,t,n){try{let a=Ss(this.model,t.inputTokens,t.outputTokens,0);await b.createAiUsageEvent({translationId:e,agentName:"native-beta-reader",model:this.model,inputTokens:t.inputTokens,outputTokens:t.outputTokens,thinkingTokens:0,inputCostUsd:Ar(a.inputCost),outputCostUsd:Ar(a.outputCost),totalCostUsd:Ar(a.totalCost),chapterNumber:n,operation:"native-review"})}catch(a){console.error("[NativeBetaReader] Failed to log usage:",a)}}};var ob=class{openai;cumulativeTokens={inputTokens:0,outputTokens:0,thinkingTokens:0};callbacks;nativeBetaReader;constructor(e){let t=process.env.DEEPSEEK_TRANSLATOR_API_KEY||process.env.DEEPSEEK_API_KEY;if(!t)throw new Error("DEEPSEEK_API_KEY is not configured");this.openai=new Ve({apiKey:t,baseURL:"https://api.deepseek.com"}),this.callbacks=e,this.nativeBetaReader=new sb}addTokenUsage(e){e&&(this.cumulativeTokens.inputTokens+=e.inputTokens||0,this.cumulativeTokens.outputTokens+=e.outputTokens||0,this.cumulativeTokens.thinkingTokens+=e.thinkingTokens||0)}async logAiUsage(e,t,n,a,s){if(a)try{let o=Ss(n,a.inputTokens||0,a.outputTokens||0,a.thinkingTokens||0);await b.createAiUsageEvent({translationId:e,agentName:t,model:n,inputTokens:a.inputTokens||0,outputTokens:a.outputTokens||0,thinkingTokens:a.thinkingTokens||0,inputCostUsd:Ar(o.inputCost),outputCostUsd:Ar(o.outputCost+o.thinkingCost),totalCostUsd:Ar(o.totalCost),chapterNumber:s,operation:"translate"})}catch(o){console.error(`[TranslationOrchestrator] Failed to log AI usage for ${t}:`,o)}}async startTranslation(e,t,n,a,s="default"){this.callbacks.onStatusChange("analyzing","Analizando estilo y tipograf\xEDa...");let o=await this.callAI(Vc.STRATEGIST,ab.STRATEGIST_INIT(n,a,t));this.addTokenUsage(o.usage),await this.logAiUsage(e,"strategist",Vc.STRATEGIST,o.usage);let i;try{let T=o.content.replace(/```json|```/g,"").trim();i=JSON.parse(T)}catch{i={typographical_rules:"Usar rayas de di\xE1logo (\u2014) para el espa\xF1ol.",glossary:{},tone_instructions:"Mantener el tono original."}}this.callbacks.onStrategyReady(i),await b.updateTranslation(e,{glossary:i.glossary,typographicalRules:i.typographical_rules,toneInstructions:i.tone_instructions,status:"translating"});let u=this.smartSplit(t);await b.updateTranslation(e,{totalChunks:u.length});let c="",p="",m=0,f=0;this.callbacks.onStatusChange("translating",`Transcreando ${u.length} fragmentos...`);for(let T=0;T<u.length;T++){let E=u[T];this.callbacks.onChunkComplete(T+1,u.length),await b.updateTranslation(e,{currentChunk:T+1});let d=await this.callAI(Vc.DRAFTER,ab.DRAFTER_CHUNK(E,JSON.stringify(i.glossary),i.typographical_rules,p,a));this.addTokenUsage(d.usage),await this.logAiUsage(e,"drafter",Vc.DRAFTER,d.usage,T+1);let l=await this.callAI(Vc.PROOFREADER,ab.PROOFREADER_CHECK(E,d.content,a));this.addTokenUsage(l.usage),await this.logAiUsage(e,"proofreader",Vc.PROOFREADER,l.usage,T+1);let h=d.content;try{let v=l.content.replace(/```json|```/g,"").trim(),S=JSON.parse(v);if(S.layout_score&&(m+=S.layout_score),S.naturalness_score&&(f+=S.naturalness_score),S.has_critical_errors&&S.replacements?.length>0){console.log(`[TranslationOrchestrator] Applying ${S.replacements.length} corrections to chunk ${T+1}`);let R=S.replacements.map(w=>({find:w.original_snippet,replace:w.correction}));h=Wr(d.content,R).patchedText}}catch{console.log(`[TranslationOrchestrator] Could not parse audit for chunk ${T+1}, using draft as-is`)}c+=h+`

`,p=h.slice(-500),await b.updateTranslation(e,{inputTokens:this.cumulativeTokens.inputTokens,outputTokens:this.cumulativeTokens.outputTokens,thinkingTokens:this.cumulativeTokens.thinkingTokens})}let g=u.length>0?Math.round(m/u.length):0,y=u.length>0?Math.round(f/u.length):0;this.callbacks.onStatusChange("native_review",`Lector beta nativo revisando en ${a}...`);let C,A=c.trim();try{let T=await this.nativeBetaReader.reviewTranslation(e,A,a,s);C=T.result,this.addTokenUsage(T.tokenUsage),C.corrections&&C.corrections.length>0&&(console.log(`[TranslationOrchestrator] Applying ${C.corrections.length} native corrections...`),A=await this.nativeBetaReader.applyCorrections(A,C.corrections)),this.callbacks.onNativeBetaReaderComplete&&this.callbacks.onNativeBetaReaderComplete(C),console.log(`[TranslationOrchestrator] Native review complete: ${C.final_verdict}, score: ${C.overall_score}/10`)}catch(T){console.error("[TranslationOrchestrator] Native beta reader failed, continuing without native review:",T),C=void 0}return await b.updateTranslation(e,{markdown:A,layoutScore:g,naturalnessScore:y,status:"completed",chaptersTranslated:u.length}),this.callbacks.onStatusChange("completed","Traducci\xF3n completada con revisi\xF3n nativa"),{content:A,metadata:i,tokens:this.cumulativeTokens,nativeBetaReaderResult:C}}async callAI(e,t){try{let n=await this.openai.chat.completions.create({messages:[{role:"user",content:t}],model:e,temperature:e.includes("reasoner")?.6:.3}),a={inputTokens:n.usage?.prompt_tokens||0,outputTokens:n.usage?.completion_tokens||0,thinkingTokens:n.usage?.reasoning_tokens||0};return{content:n.choices[0]?.message?.content||"",usage:a}}catch(n){throw console.error("[TranslationOrchestrator] AI call failed:",n),n}}smartSplit(e){let n=e.split(/\n\n+/),a=[],s="";for(let o of n)s.length+o.length>1500&&s.length>0?(a.push(s.trim()),s=o):s+=(s?`

`:"")+o;return s.trim()&&a.push(s.trim()),a.length>0?a:[e]}};yy();var _4=ln(require("cookie-parser"),1);var Kq=ln(require("crypto"),1),km="litagents_session",Xq=1440*60*1e3,ib=new Map;function mie(){return Kq.default.randomBytes(32).toString("hex")}function Yq(){return!!(process.env.REPL_ID||process.env.REPLIT_DEV_DOMAIN)}function Zq(){return process.env.LITAGENTS_PASSWORD||null}function xx(){return Yq()?!1:!!Zq()}function hie(r){let e=Zq();return e?r===e:!0}function fie(){let r=mie(),e={token:r,expiresAt:Date.now()+Xq};return ib.set(r,e),r}function e4(r){if(!r)return!1;let e=ib.get(r);return e?Date.now()>e.expiresAt?(ib.delete(r),!1):!0:!1}function gie(r){ib.delete(r)}function t4(r,e,t){if(!xx()||r.path==="/api/auth/login"||r.path==="/api/auth/status"||r.path.startsWith("/assets")||r.path.startsWith("/@")||r.path==="/favicon.ico")return t();let n=r.cookies?.[km];if(e4(n))return t();if(r.path.startsWith("/api/")){e.status(401).json({error:"Unauthorized",requiresAuth:!0});return}t()}function r4(r){r.get("/api/auth/status",(e,t)=>{let n=xx(),a=e.cookies?.[km],s=n?e4(a):!0;t.json({authEnabled:n,isAuthenticated:s,isReplit:Yq()})}),r.post("/api/auth/login",(e,t)=>{if(!xx())return t.json({success:!0,message:"Auth not required"});let{password:n}=e.body;if(!n)return t.status(400).json({error:"Password required"});if(!hie(n))return t.status(401).json({error:"Invalid password"});let a=fie(),s=e.secure||e.headers["x-forwarded-proto"]==="https",o=process.env.SECURE_COOKIES==="true"||process.env.SECURE_COOKIES!=="false"&&s;console.log(`[Auth] Setting cookie: secure=${o}, isProxiedHttps=${s}, x-forwarded-proto=${e.headers["x-forwarded-proto"]}`),t.cookie(km,a,{httpOnly:!0,secure:o,sameSite:o?"none":"lax",maxAge:Xq}),t.json({success:!0})}),r.post("/api/auth/logout",(e,t)=>{let n=e.cookies?.[km];n&&gie(n),t.clearCookie(km),t.json({success:!0})})}var Lce=Z.enum(["standalone","series","trilogy"]),jce=Z.object({workType:Lce.optional(),seriesId:Z.number().nullable().optional(),seriesOrder:Z.number().min(1).nullable().optional()}).refine(r=>r.workType==="standalone"?r.seriesId===null||r.seriesId===void 0:!0,{message:"Standalone works cannot have a seriesId"}),kce=Z.object({title:Z.string().min(1,"Title is required").max(200),description:Z.string().max(2e3).nullable().optional(),workType:Z.enum(["series","trilogy"]).default("trilogy"),totalPlannedBooks:Z.number().min(1).max(100).default(3)}),Dce=Z.object({title:Z.string().min(1).max(200).optional(),description:Z.string().max(2e3).nullable().optional(),workType:Z.enum(["series","trilogy"]).optional(),totalPlannedBooks:Z.number().min(1).max(100).optional(),pseudonymId:Z.number().nullable().optional()}),qr=new Map,fo=new Map,Qu=null,Hx=!1;function Mce(){Hx=!0,console.log("[GenerationLock] Guide generation cancellation requested")}function Uce(){return Hx}function Bce(){Hx=!1}async function Vx(r,e){let t=await M.select().from(Sa).where(q(Sa.isActive,!0)).limit(1);if(t.length>0)return Qu={type:t[0].lockType,title:t[0].title,startedAt:t[0].startedAt},!1;let[n]=await M.insert(Sa).values({lockType:r,title:e,isActive:!0}).returning();return Qu={type:r,title:e,startedAt:n.startedAt},console.log(`[GenerationLock] Acquired lock for ${r}: "${e}" (persisted to DB)`),!0}async function xs(){let r=await M.select().from(Sa).where(q(Sa.isActive,!0));if(r.length>0){for(let e of r){let t=Date.now()-e.startedAt.getTime();console.log(`[GenerationLock] Released lock for ${e.lockType}: "${e.title}" (duration: ${Math.round(t/1e3)}s)`)}await M.update(Sa).set({isActive:!1}).where(q(Sa.isActive,!0))}Qu=null}async function di(){let r=await M.select().from(Sa).where(q(Sa.isActive,!0)).limit(1);return r.length>0?(Qu={type:r[0].lockType,title:r[0].title,startedAt:r[0].startedAt},Qu):(Qu=null,null)}function zm(r,e){return r===0?e||"el Pr\xF3logo":r===-1?e||"el Ep\xEDlogo":r===-2?e||"la Nota del Autor":`el Cap\xEDtulo ${r}`}async function kt(r,e,t,n,a){try{await b.createActivityLog({projectId:r,level:e,message:t,agentRole:n??null,metadata:a??null})}catch(s){console.error("[ActivityLog] Failed to persist log:",s)}}var Hm=(0,zx.default)({storage:zx.default.memoryStorage(),limits:{fileSize:10*1024*1024},fileFilter:(r,e,t)=>{["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.mimetype)||e.originalname.endsWith(".docx")||e.originalname.endsWith(".doc")?t(null,!0):t(new Error("Solo se permiten archivos Word (.docx, .doc)"))}});async function P4(r,e){let t=new Map,n=E=>{let d=t.get(E);return d&&!d.cancelled},a=(E,d)=>{let l=t.get(E);return l&&!l.cancelled?(console.warn(`[Corrections] BLOCKED: Attempted to start ${d} for project ${E} but ${l.type} is already active since ${l.startTime.toISOString()}`),!1):(t.set(E,{type:d,startTime:new Date,cancelled:!1}),console.log(`[Corrections] Started ${d} for project ${E}`),!0)},s=E=>{t.delete(E),console.log(`[Corrections] Ended correction for project ${E}`)},o=E=>{let d=t.get(E);d&&(d.cancelled=!0,console.log(`[Corrections] Marked cancellation for project ${E}`))},i=E=>t.get(E)?.cancelled||!1;global.isCorrectionCancelled=i,global.startCorrection=a,global.endCorrection=s,global.isAnyCorrectionActive=n;let u=new Set,c=E=>u.has(E)||n(E),p="detect-fix";global.getCorrectionSystem=()=>p,e.use((0,_4.default)()),r4(e),e.use(t4),e.get("/api/config/correction-system",(E,d)=>{d.json({correctionSystem:p})}),e.post("/api/config/correction-system",(E,d)=>{let{correctionSystem:l}=E.body;l==="detect-fix"||l==="legacy"?(p=l,console.log(`[Config] Correction system set to: ${p}`),d.json({correctionSystem:p})):d.status(400).json({error:"Invalid correction system. Use 'detect-fix' or 'legacy'"})}),e.get("/api/projects/:id/correction-status",(E,d)=>{let l=parseInt(E.params.id),h=t.get(l);h&&!h.cancelled?d.json({active:!0,type:h.type,startTime:h.startTime,cancelled:h.cancelled}):d.json({active:!1})}),e.post("/api/projects/:id/cancel-correction",async(E,d)=>{let l=parseInt(E.params.id),h=t.get(l);if(!h||h.cancelled)return d.status(404).json({error:"No hay correcci\xF3n activa para cancelar"});o(l);try{await b.updateProject(l,{status:"paused"}),await b.createActivityLog({projectId:l,level:"warning",message:`Correcci\xF3n ${h.type} cancelada por el usuario`,agentRole:"system",metadata:{cancelledAt:new Date().toISOString()}})}catch(v){console.error("[Corrections] Error updating project status:",v)}d.json({success:!0,message:"Correcci\xF3n marcada para cancelaci\xF3n"})}),e.get("/api/corrections/active",(E,d)=>{let l=Array.from(t.entries()).filter(([h,v])=>!v.cancelled).map(([h,v])=>({projectId:h,...v}));d.json(l)}),e.get("/api/projects",async(E,d)=>{try{let l=await b.getAllProjects();d.json(l)}catch(l){console.error("Error fetching projects:",l),d.status(500).json({error:"Failed to fetch projects"})}}),e.get("/api/projects/completed",async(E,d)=>{try{let h=(await b.getAllProjects()).filter(_=>_.status==="completed"),v=await Promise.all(h.map(async _=>{let N=await b.getChaptersByProject(_.id),P=N.reduce((L,j)=>L+(j.wordCount||0),0);return{id:_.id,title:_.title,genre:_.genre,chapterCount:N.length,totalWords:P,finalScore:_.finalScore,createdAt:_.createdAt,source:"original"}})),R=(await b.getAllReeditProjects()).filter(_=>_.status==="completed"),x=await Promise.all(R.map(async _=>{let N=await b.getReeditChaptersByProject(_.id),P=N.reduce((L,j)=>L+(j.wordCount||0),0);return{id:_.id,title:_.title,genre:null,chapterCount:N.length,totalWords:P||_.totalWordCount||0,finalScore:_.bestsellerScore,createdAt:_.createdAt,source:"reedit"}})),O=(await b.getAllImportedManuscripts()).map(_=>({id:_.id,title:_.title,genre:null,chapterCount:_.totalChapters||0,totalWords:_.totalWordCount||0,finalScore:null,createdAt:_.createdAt,source:"imported",detectedLanguage:_.detectedLanguage})),I=[...v,...x,...O].sort((_,N)=>new Date(N.createdAt).getTime()-new Date(_.createdAt).getTime());d.json(I)}catch(l){console.error("Error fetching completed projects:",l),d.status(500).json({error:"Failed to fetch completed projects"})}}),e.get("/api/projects/duplicate-chapters",async(E,d)=>{try{let l=await b.getAllProjects(),h=[];for(let v of l){let S=await b.getChaptersByProject(v.id),R=new Map;for(let O of S)R.has(O.chapterNumber)||R.set(O.chapterNumber,[]),R.get(O.chapterNumber).push(O);let x=[],w=Array.from(R.keys());for(let O of w){let I=R.get(O);if(I.length>1){let _={};for(let P of I){let L=new Date(P.createdAt).getTime(),j=new Date(Math.floor(L/5e3)*5e3).toISOString();_[j]||(_[j]=[]),_[j].push(P)}let N=Object.entries(_).map(([P,L])=>({generationKey:P,chapterIds:L.map(j=>j.id),titles:L.map(j=>j.title||"Sin t\xEDtulo"),statuses:L.map(j=>j.status),wordCounts:L.map(j=>j.wordCount||0),createdAt:new Date(P),totalChapters:L.length,hasContent:L.some(j=>j.content&&j.content.length>0)})).sort((P,L)=>P.createdAt.getTime()-L.createdAt.getTime());x.push({chapterNumber:O,generations:N})}}x.length>0&&h.push({projectId:v.id,projectTitle:v.title,projectStatus:v.status,duplicateGroups:x.sort((O,I)=>O.chapterNumber-I.chapterNumber)})}d.json(h)}catch(l){console.error("Error detecting duplicate chapters:",l),d.status(500).json({error:"Failed to detect duplicate chapters"})}}),e.get("/api/projects/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});d.json(h)}catch(l){console.error("Error fetching project:",l),d.status(500).json({error:"Failed to fetch project"})}}),e.post("/api/projects",async(E,d)=>{try{let l=QS.safeParse(E.body);if(!l.success)return d.status(400).json({error:"Invalid project data",details:l.error});let h=await b.createProject(l.data);for(let v of["architect","ghostwriter","editor","copyeditor"])await b.updateAgentStatus(h.id,v,{status:"idle"});d.status(201).json(h)}catch(l){console.error("Error creating project:",l),d.status(500).json({error:"Failed to create project"})}}),e.patch("/api/projects/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="generating")return d.status(400).json({error:"Cannot edit a project while it's generating"});let v=["title","premise","genre","tone","chapterCount","hasPrologue","hasEpilogue","hasAuthorNote","pseudonymId","styleGuideId","extendedGuideId","workType","seriesId","seriesOrder","minWordCount","minWordsPerChapter","maxWordsPerChapter","kindleUnlimitedOptimized","architectInstructions"],S={};for(let x of v)E.body[x]!==void 0&&(S[x]=E.body[x]);if(S.workType||S.seriesId!==void 0||S.seriesOrder!==void 0){let x=jce.safeParse({workType:S.workType||h.workType,seriesId:S.seriesId!==void 0?S.seriesId:h.seriesId,seriesOrder:S.seriesOrder!==void 0?S.seriesOrder:h.seriesOrder});if(!x.success)return d.status(400).json({error:"Invalid series configuration",details:x.error.flatten()});x.data.workType==="standalone"&&(S.seriesId=null,S.seriesOrder=null)}let R=await b.updateProject(l,S);d.json(R)}catch(l){console.error("Error updating project:",l);let h=l?.message||"Failed to update project";d.status(500).json({error:h})}}),e.delete("/api/projects/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteProject(l),d.status(204).send()}catch(l){console.error("Error deleting project:",l),d.status(500).json({error:"Failed to delete project"})}}),e.post("/api/projects/:id/archive",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="generating")return d.status(400).json({error:"No se puede archivar un proyecto mientras se genera"});let v=await b.updateProject(l,{status:"archived"});d.json(v)}catch(l){console.error("Error archiving project:",l),d.status(500).json({error:"Failed to archive project"})}}),e.post("/api/projects/:id/unarchive",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status!=="archived")return d.status(400).json({error:"El proyecto no est\xE1 archivado"});let R=(await b.getChaptersByProject(l)).some(w=>w.status==="completed")?"completed":"idle",x=await b.updateProject(l,{status:R});d.json(x)}catch(l){console.error("Error unarchiving project:",l),d.status(500).json({error:"Failed to unarchive project"})}}),e.post("/api/projects/:id/duplicate",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});let v=await b.createProject({title:`${h.title} (Copia)`,premise:h.premise,genre:h.genre,tone:h.tone,chapterCount:h.chapterCount,hasPrologue:h.hasPrologue,hasEpilogue:h.hasEpilogue,hasAuthorNote:h.hasAuthorNote,pseudonymId:h.pseudonymId,styleGuideId:h.styleGuideId,extendedGuideId:h.extendedGuideId,workType:h.workType,bookboxStructure:h.bookboxStructure,seriesId:h.seriesId,seriesOrder:h.seriesOrder,minWordCount:h.minWordCount,minWordsPerChapter:h.minWordsPerChapter,maxWordsPerChapter:h.maxWordsPerChapter,kindleUnlimitedOptimized:h.kindleUnlimitedOptimized,architectInstructions:h.architectInstructions,pipelineVersion:h.pipelineVersion});for(let S of["architect","ghostwriter","editor","copyeditor"])await b.updateAgentStatus(v.id,S,{status:"idle"});d.status(201).json(v)}catch(l){console.error("Error duplicating project:",l),d.status(500).json({error:"Failed to duplicate project"})}}),e.post("/api/projects/:id/cancel",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getProject(l))return d.status(404).json({error:"Project not found"});io(l),await b.updateProject(l,{status:"cancelled"});for(let v of["architect","ghostwriter","editor","copyeditor","final-reviewer"])await b.updateAgentStatus(l,v,{status:"idle",currentTask:"Generaci\xF3n cancelada por el usuario"});d.json({success:!0,message:"Generaci\xF3n cancelada"})}catch(l){console.error("Error cancelling project:",l),d.status(500).json({error:"Failed to cancel project"})}}),e.post("/api/projects/:id/force-complete",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getProject(l))return d.status(404).json({error:"Project not found"});io(l),await b.updateProject(l,{status:"completed"});for(let S of["architect","ghostwriter","editor","copyeditor","final-reviewer"])await b.updateAgentStatus(l,S,{status:"completed",currentTask:"Proceso completado (forzado)"});let v=await b.getChaptersByProject(l);for(let S of v)S.status!=="completed"&&S.content&&await b.updateChapter(S.id,{status:"completed"});d.json({success:!0,message:"Proyecto marcado como completado"})}catch(l){console.error("Error forcing project completion:",l),d.status(500).json({error:"Failed to force complete project"})}}),e.post("/api/projects/:id/reset-reviewer",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getProject(l))return d.status(404).json({error:"Project not found"});await b.updateProject(l,{finalReviewResult:null,finalScore:null,revisionCycle:0,resolvedIssueHashes:[],chapterCorrectionCounts:null}),await b.updateAgentStatus(l,"final-reviewer",{status:"idle",currentTask:"Cr\xEDtico reiniciado - listo para nueva evaluaci\xF3n"}),await b.createActivityLog({projectId:l,level:"info",message:"Se reinici\xF3 el estado del cr\xEDtico. La pr\xF3xima evaluaci\xF3n comenzar\xE1 desde cero sin historial previo.",agentRole:"final-reviewer"}),d.json({success:!0,message:"Estado del cr\xEDtico reiniciado. La pr\xF3xima evaluaci\xF3n ser\xE1 completamente nueva."})}catch(l){console.error("Error resetting reviewer state:",l),d.status(500).json({error:"Failed to reset reviewer state"})}}),e.get("/api/projects/:id/export-docx",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status!=="completed")return d.status(400).json({error:"El proyecto debe estar completado para exportar"});let v=await b.getChaptersByProject(l),S=h.hasPrologue?v.find(P=>P.chapterNumber===0):null,R=h.hasEpilogue?v.find(P=>P.chapterNumber===-1):null,x=h.hasAuthorNote?v.find(P=>P.chapterNumber===-2):null,w=v.filter(P=>P.chapterNumber>0),O=null;h.pseudonymId&&(O=await b.getPseudonym(h.pseudonymId));let I=await Uq({project:h,chapters:w,pseudonym:O,prologue:S,epilogue:R,authorNote:x}),N=`${h.title.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_")}_manuscrito.docx`;d.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.wordprocessingml.document"),d.setHeader("Content-Disposition",`attachment; filename="${N}"`),d.setHeader("Content-Length",I.length),d.send(I)}catch(l){console.error("Error exporting manuscript:",l),d.status(500).json({error:"Failed to export manuscript"})}}),e.get("/api/projects/:id/export-logs-pdf",async(E,d)=>{try{let l=(await import("pdfkit")).default,h=parseInt(E.params.id),v=await b.getProject(h);if(!v)return d.status(404).json({error:"Proyecto no encontrado"});let S=await b.getActivityLogsByProject(h,5e3),R=new l({size:"A4",margin:50,bufferPages:!0}),x=[];R.on("data",L=>x.push(L));let w=new Promise((L,j)=>{R.on("end",()=>L(Buffer.concat(x))),R.on("error",j)});R.fontSize(18).font("Helvetica-Bold").text("Registro de Actividad",{align:"center"}),R.fontSize(14).font("Helvetica").text(`Proyecto: ${v.title}`,{align:"center"}),R.fontSize(10).text(`Exportado: ${new Date().toLocaleString("es-ES")}`,{align:"center"}),R.moveDown(2);let O={architect:"Arquitecto",ghostwriter:"Escritor",editor:"Editor",copyeditor:"Corrector de Estilo","continuity-sentinel":"Centinela de Continuidad","voice-rhythm-auditor":"Auditor de Voz y Ritmo","semantic-repetition-detector":"Detector de Repeticiones","final-reviewer":"Revisor Final",orchestrator:"Orquestador",system:"Sistema"},I={info:"INFO",success:"EXITO",warn:"AVISO",warning:"AVISO",error:"ERROR"};R.fontSize(9);for(let L of S.reverse()){let j=new Date(L.createdAt).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),$=O[L.agentRole||"system"]||L.agentRole||"Sistema",U=I[L.level]||L.level.toUpperCase(),k=`[${j}] [${U}] [${$}] ${L.message}`;R.y>750&&R.addPage(),L.level==="error"?R.fillColor("red"):L.level==="success"?R.fillColor("green"):L.level==="warn"||L.level==="warning"?R.fillColor("orange"):R.fillColor("black"),R.text(k,{width:495,lineGap:2}),R.fillColor("black")}R.end();let _=await w,P=`${v.title.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_")}_logs.pdf`;d.setHeader("Content-Type","application/pdf"),d.setHeader("Content-Disposition",`attachment; filename="${P}"`),d.setHeader("Content-Length",_.length),d.send(_)}catch(l){console.error("Error exporting logs to PDF:",l),d.status(500).json({error:"Error al exportar logs"})}}),e.post("/api/projects/:id/generate",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="generating")return d.status(400).json({error:"Project is already generating"});await b.updateProject(l,{pipelineVersion:"v2"}),d.json({message:"Generation started (v2)",projectId:l});let v=R=>{let x=qr.get(l);if(x){let w=`data: ${JSON.stringify(R)}

`;x.forEach(O=>{try{O.write(w)}catch(I){console.error("Error writing to stream:",I)}})}};new Qr({onAgentStatus:async(R,x,w)=>{await b.updateAgentStatus(l,R,{status:x,currentTask:w}),v({type:"agent_status",role:R,status:x,message:w}),w&&await kt(l,"info",w,R)},onChapterComplete:async(R,x,w)=>{v({type:"chapter_complete",chapterNumber:R,wordCount:x,chapterTitle:w});let O=zm(R,w);await kt(l,"success",`${O} completado (${x} palabras)`,"ghostwriter-v2")},onSceneComplete:async(R,x,w,O)=>{v({type:"scene_complete",chapterNumber:R,sceneNumber:x,totalScenes:w,wordCount:O})},onProjectComplete:async()=>{v({type:"project_complete"}),await kt(l,"success","Novela completada exitosamente","orchestrator")},onError:async R=>{v({type:"error",message:R}),await kt(l,"error",R,"orchestrator")},onChaptersBeingCorrected:(R,x)=>{v({type:"chapters_being_corrected",chapterNumbers:R,revisionCycle:x})}}).generateNovel(h).catch(console.error)}catch(l){console.error("Error starting generation:",l),d.status(500).json({error:"Failed to start generation"})}}),e.post("/api/projects/:id/generate-v2",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="generating")return d.status(400).json({error:"Project is already generating"});await b.updateProject(l,{pipelineVersion:"v2"});let v=E.body?.useGeminiArchitect===!0,S=E.body?.useGeminiQA||{};d.json({message:"Generation started (LitAgents 2.0)",projectId:l,version:"2.0",useGeminiArchitect:v,useGeminiQA:S});let R=w=>{let O=qr.get(l);if(O){let I=`data: ${JSON.stringify(w)}

`;O.forEach(_=>{try{_.write(I)}catch(N){console.error("Error writing to stream:",N)}})}};new Qr({onAgentStatus:async(w,O,I)=>{await b.updateAgentStatus(l,w,{status:O,currentTask:I}),R({type:"agent_status",role:w,status:O,message:I}),I&&await kt(l,"info",I,w)},onChapterComplete:async(w,O,I)=>{R({type:"chapter_complete",chapterNumber:w,wordCount:O,chapterTitle:I});let _=zm(w,I);await kt(l,"success",`${_} completado (${O} palabras)`,"ghostwriter-v2")},onSceneComplete:(w,O,I,_)=>{R({type:"scene_complete",chapterNumber:w,sceneNumber:O,totalScenes:I,wordCount:_})},onProjectComplete:async()=>{R({type:"project_complete"}),await kt(l,"success","Novela completada exitosamente (LitAgents 2.0)","orchestrator-v2")},onError:async w=>{R({type:"error",message:w}),await kt(l,"error",w,"orchestrator-v2")},onChaptersBeingCorrected:(w,O)=>{R({type:"chapters_being_corrected",chapterNumbers:w,revisionCycle:O})}}).generateNovel(h,{useGeminiArchitect:v,useGeminiQA:S}).catch(console.error)}catch(l){console.error("Error starting V2 generation:",l),d.status(500).json({error:"Failed to start V2 generation"})}}),e.post("/api/projects/:id/detect-and-fix",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(["generating","processing","reviewing","correcting"].includes(h.status))return d.status(409).json({error:`El proyecto est\xE1 siendo procesado (estado: ${h.status}). Espera a que termine o cancela el proceso actual.`,currentStatus:h.status});if(n(l)){let _=t.get(l);return d.status(409).json({error:`Ya hay una correcci\xF3n '${_?.type}' en ejecuci\xF3n. Espera a que termine o canc\xE9lala primero.`,activeType:_?.type,startTime:_?.startTime})}if((await b.getChaptersByProject(l)).length===0)return d.status(400).json({error:"El proyecto no tiene cap\xEDtulos. Primero genera la novela.",hint:"Usa el endpoint /api/projects/:id/start-v2 para generar la novela."});a(l,"detect-fix"),u.add(l),d.json({message:"Iniciando estrategia 'Detect All, Then Fix'",strategy:"Fase 1: 3 revisiones exhaustivas \u2192 Fase 2: Correcci\xF3n verificada issue por issue"});let R=qr.get(l),x=_=>{if(R&&R.size>0){let N=`data: ${JSON.stringify(_)}

`;R.forEach(P=>P.write(N))}},w=async(_,N,P,L)=>{try{await b.createActivityLog({projectId:_,level:N,message:P,agentRole:L})}catch(j){console.error("Failed to persist activity log:",j)}};await b.updateProject(l,{status:"processing"});let O=new Qr({onAgentStatus:(_,N,P)=>{x({type:"agent_status",role:_,status:N,message:P})},onChapterComplete:(_,N,P)=>{x({type:"chapter_complete",chapterNumber:_,wordCount:N,chapterTitle:P})},onSceneComplete:(_,N,P,L)=>{x({type:"scene_complete",chapterNumber:_,sceneNumber:N,totalScenes:P,wordCount:L})},onProjectComplete:async()=>{x({type:"project_complete"}),await w(l,"success","Estrategia 'Detect All, Then Fix' completada","orchestrator-v2")},onError:async _=>{x({type:"error",message:_}),await w(l,"error",_,"orchestrator-v2")},onDetectAndFixProgress:_=>{x({type:"detect_and_fix_progress",..._})}}),I=E.body?.useGeminiQA||{};(I.finalReviewer||I.continuitySentinel||I.narrativeDirector)&&O.setGeminiQAFlags(I),O.detectAndFixStrategy(h).then(async _=>{let{registry:N,finalScore:P}=_;s(l),u.delete(l),await b.updateProject(l,{finalScore:P,status:N.totalEscalated===0?"completed":"paused"}),x({type:"detect_and_fix_complete",totalDetected:N.totalDetected,totalResolved:N.totalResolved,totalEscalated:N.totalEscalated,finalScore:P}),await w(l,N.totalEscalated===0?"success":"warn",`Detect & Fix completado: ${N.totalResolved}/${N.totalDetected} resueltos, ${N.totalEscalated} escalados. Puntuaci\xF3n: ${P}/10`,"orchestrator-v2")}).catch(async _=>{s(l),u.delete(l),console.error("Detect and Fix error:",_),await b.updateProject(l,{status:"paused"}),x({type:"error",message:_.message||"Error en Detect & Fix"}),await w(l,"error",`Error: ${_.message||"Unknown error"}`,"orchestrator-v2")})}catch(l){let h=parseInt(E.params.id);s(h),u.delete(h),console.error("Error starting Detect and Fix:",l),d.status(500).json({error:"Failed to start Detect and Fix strategy"})}}),e.post("/api/projects/:id/targeted-repair/diagnose",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(n(l)&&(console.log(`[TargetedRepair] Clearing stale correction state for project ${l} before new diagnosis`),s(l)),(await b.getChaptersByProject(l)).length===0)return d.status(400).json({error:"El proyecto no tiene cap\xEDtulos"});await b.updateProject(l,{targetedRepairStatus:"diagnosing",targetedRepairDiagnosis:null,targetedRepairPlan:null,targetedRepairProgress:{current:0,total:3,message:"Iniciando diagn\xF3stico..."}}),d.json({message:"Diagn\xF3stico iniciado",projectId:l});let S=x=>{let w=qr.get(l);if(w){let O=`data: ${JSON.stringify(x)}

`;w.forEach(I=>{try{I.write(O)}catch{}})}};new Qr({onAgentStatus:async(x,w,O)=>{await b.updateAgentStatus(l,x,{status:w,currentTask:O}),S({type:"agent_status",role:x,status:w,message:O})},onChapterComplete:async()=>{},onSceneComplete:async()=>{},onProjectComplete:async()=>{},onError:async x=>{S({type:"error",message:x})}}).diagnoseForTargetedRepair(h).then(async x=>{S({type:"targeted_repair_diagnosis_complete",diagnosis:x.diagnosis,planLength:x.plan.length}),await kt(l,"success",`Diagn\xF3stico completado: ${x.plan.length} cap\xEDtulos a reparar`,"targeted-repair")}).catch(async x=>{console.error("[TargetedRepair] Diagnosis error:",x),await b.updateProject(l,{targetedRepairStatus:"error",targetedRepairProgress:{message:x instanceof Error?x.message:"Error en diagn\xF3stico"}}),S({type:"error",message:x instanceof Error?x.message:"Error en diagn\xF3stico"})})}catch(l){console.error("Error starting targeted repair diagnosis:",l),d.status(500).json({error:"Failed to start diagnosis"})}}),e.get("/api/projects/:id/targeted-repair/plan",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});d.json({status:h.targetedRepairStatus||"idle",diagnosis:h.targetedRepairDiagnosis||null,plan:h.targetedRepairPlan||[],progress:h.targetedRepairProgress||null})}catch(l){console.error("Error fetching repair plan:",l),d.status(500).json({error:"Failed to fetch repair plan"})}}),e.post("/api/projects/:id/targeted-repair/execute",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(!h.targetedRepairPlan||h.targetedRepairPlan.length===0)return d.status(400).json({error:"No hay plan de reparaci\xF3n. Ejecuta el diagn\xF3stico primero."});n(l)&&(console.log(`[TargetedRepair] Clearing stale correction state for project ${l} before execution`),s(l)),d.json({message:"Ejecutando plan de reparaci\xF3n",projectId:l});let v=R=>{let x=qr.get(l);if(x){let w=`data: ${JSON.stringify(R)}

`;x.forEach(O=>{try{O.write(w)}catch{}})}};new Qr({onAgentStatus:async(R,x,w)=>{await b.updateAgentStatus(l,R,{status:x,currentTask:w}),v({type:"agent_status",role:R,status:x,message:w})},onChapterComplete:async()=>{},onSceneComplete:async()=>{},onProjectComplete:async()=>{},onError:async R=>{v({type:"error",message:R})}}).executeRepairPlan(h).then(async R=>{let x=R.reduce((O,I)=>O+I.issuesFixed,0),w=R.reduce((O,I)=>O+I.issuesTotal,0);v({type:"targeted_repair_complete",results:R,totalFixed:x,totalIssues:w}),await kt(l,"success",`Reparaci\xF3n completada: ${x}/${w} problemas resueltos`,"targeted-repair")}).catch(async R=>{console.error("[TargetedRepair] Execution error:",R),await b.updateProject(l,{targetedRepairStatus:"error",targetedRepairProgress:{message:R instanceof Error?R.message:"Error en ejecuci\xF3n"}}),v({type:"error",message:R instanceof Error?R.message:"Error en ejecuci\xF3n"})})}catch(l){console.error("Error starting targeted repair execution:",l),d.status(500).json({error:"Failed to start repair execution"})}}),e.post("/api/projects/:id/targeted-repair/cancel",async(E,d)=>{try{let l=parseInt(E.params.id);await b.updateProject(l,{targetedRepairStatus:"idle",targetedRepairProgress:null}),s(l),d.json({success:!0,message:"Reparaci\xF3n cancelada"})}catch(l){console.error("Error cancelling targeted repair:",l),d.status(500).json({error:"Failed to cancel"})}}),e.post("/api/projects/:id/targeted-repair/auto-cycle",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(n(l)&&(console.log(`[AutoCycle] Clearing stale correction state for project ${l}`),s(l)),(await b.getChaptersByProject(l)).filter(O=>(O.status==="completed"||O.status==="approved")&&O.content&&O.content.length>100).length===0)return d.status(400).json({error:"No hay cap\xEDtulos completados para diagnosticar"});let R=Math.min(parseInt(E.body?.maxCycles)||10,20);d.json({message:"Ciclo autom\xE1tico iniciado",projectId:l,maxCycles:R});let x=O=>{let I=qr.get(l);if(I){let _=`data: ${JSON.stringify(O)}

`;I.forEach(N=>{try{N.write(_)}catch{}})}};new Qr({onAgentStatus:async(O,I,_)=>{await b.updateAgentStatus(l,O,{status:I,currentTask:_}),x({type:"agent_status",role:O,status:I,message:_})},onChapterComplete:async()=>{},onSceneComplete:async()=>{},onProjectComplete:async()=>{},onError:async O=>{x({type:"error",message:O})}}).runAutoCycleRepair(h,R).then(async O=>{x({type:"targeted_repair_auto_cycle_complete",...O});let I=O.success?`Ciclo autom\xE1tico COMPLETADO: 2x 9+ en ${O.cycles} ciclos (${O.finalScore}/10)`:`Ciclo autom\xE1tico finalizado: ${O.cycles} ciclos, \xFAltima puntuaci\xF3n ${O.finalScore}/10`;await kt(l,O.success?"success":"warn",I,"targeted-repair")}).catch(async O=>{console.error("[AutoCycle] Error:",O),await b.updateProject(l,{targetedRepairStatus:"error",targetedRepairProgress:{message:O instanceof Error?O.message:"Error en ciclo autom\xE1tico"}}),x({type:"error",message:O instanceof Error?O.message:"Error en ciclo autom\xE1tico"})})}catch(l){console.error("Error starting auto-cycle repair:",l),d.status(500).json({error:"Failed to start auto-cycle"})}}),e.get("/api/projects/:id/plot-threads",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getPlotThreadsByProject(l);d.json(h)}catch(l){console.error("Error fetching plot threads:",l),d.status(500).json({error:"Failed to fetch plot threads"})}}),e.post("/api/projects/:id/critique",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(!["completed","approved","awaiting_final_review"].includes(h.status))return d.status(400).json({error:"Solo se pueden criticar proyectos completados",currentStatus:h.status});d.json({message:"Beta Reader analysis started",projectId:l});let S=R=>{let x=qr.get(l);if(x){let w=`data: ${JSON.stringify(R)}

`;x.forEach(O=>{try{O.write(w)}catch(I){console.error("Error writing to stream:",I)}})}};F2.runFullCritique(l,(R,x)=>{S({type:"agent_status",role:R,status:"active",message:x}),kt(l,"info",x,R)}).then(async({status:R,report:x})=>{S({type:"critique_complete",status:R,score:x.score,viability:x.viability,flaggedCount:x.flagged_chapters.length}),await kt(l,"success",`Cr\xEDtica completada: ${x.score}/10 - ${x.viability}`,"beta-reader")}).catch(async R=>{console.error("[Critique] Error:",R),S({type:"error",message:R.message}),await kt(l,"error",R.message,"beta-reader")})}catch(l){console.error("Error starting critique:",l),d.status(500).json({error:"Failed to start critique"})}}),e.get("/api/projects/:id/beta-report",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});d.json({report:h.betaReaderReport||null,score:h.betaReaderScore||null,viability:h.commercialViability||null})}catch(l){console.error("Error fetching beta report:",l),d.status(500).json({error:"Failed to fetch beta report"})}}),e.get("/api/projects/:id/editing-queue",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getEditingQueueByProject(l);d.json(h)}catch(l){console.error("Error fetching editing queue:",l),d.status(500).json({error:"Failed to fetch editing queue"})}}),e.get("/api/projects/:id/chapter-versions/:chapterId",async(E,d)=>{try{let l=parseInt(E.params.chapterId),h=await b.getChapterVersionsByChapter(l);d.json(h)}catch(l){console.error("Error fetching chapter versions:",l),d.status(500).json({error:"Failed to fetch chapter versions"})}}),e.post("/api/projects/:id/generate-missing",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="generating")return d.status(400).json({error:"Project is already generating"});console.log(`[generate-missing] Starting for project ${l}, current status: ${h.status}`),d.json({message:"Generating missing chapters",projectId:l});let v=x=>{let w=qr.get(l);if(w){let O=`data: ${JSON.stringify(x)}

`;w.forEach(I=>{try{I.write(O)}catch(_){console.error("Error writing to stream:",_)}})}},S=new Qr({onAgentStatus:async(x,w,O)=>{await b.updateAgentStatus(l,x,{status:w,currentTask:O}),v({type:"agent_status",role:x,status:w,message:O}),O&&await kt(l,"info",O,x)},onChapterComplete:async(x,w,O)=>{v({type:"chapter_complete",chapterNumber:x,wordCount:w,chapterTitle:O});let I=zm(x,O);await kt(l,"success",`${I} completado (${w} palabras)`,"ghostwriter-v2")},onSceneComplete:(x,w,O,I)=>{v({type:"scene_complete",chapterNumber:x,sceneNumber:w,totalScenes:O,wordCount:I})},onProjectComplete:async()=>{v({type:"project_complete"}),await kt(l,"success","Cap\xEDtulos faltantes generados exitosamente","orchestrator-v2")},onError:async x=>{v({type:"error",message:x}),await kt(l,"error",x,"orchestrator-v2")},onChaptersBeingCorrected:(x,w)=>{v({type:"chapters_being_corrected",chapterNumbers:x,revisionCycle:w})}});console.log(`[generate-missing] About to call orchestrator.generateMissingChapters for project ${l}`);let R=S.generateMissingChapters(h);console.log("[generate-missing] Promise created, adding catch handler"),R.catch(x=>{console.error("[generate-missing] ERROR in generateMissingChapters:",x),kt(l,"error",`Error generando cap\xEDtulos faltantes: ${x.message}`,"orchestrator-v2")}),console.log("[generate-missing] Catch handler added, returning response")}catch(l){console.error("Error starting missing chapters generation:",l),d.status(500).json({error:"Failed to start missing chapters generation"})}}),e.post("/api/projects/:id/resume",async(E,d)=>{try{let l=parseInt(E.params.id);console.log(`[Resume] Starting resume for project ${l}`);let h=await b.getProject(l);if(!h)return console.log(`[Resume] Project ${l} not found`),d.status(404).json({error:"Project not found"});if(console.log(`[Resume] Project ${l} current status: ${h.status}`),h.status==="generating")return console.log(`[Resume] Project ${l} is already generating`),d.status(400).json({error:"Project is already generating"});if(!["paused","cancelled","error","failed_final_review","idle","planning","awaiting_instructions","final_review_in_progress"].includes(h.status))return console.log(`[Resume] Project ${l} has invalid status: ${h.status}`),d.status(400).json({error:`No se puede reanudar un proyecto con estado "${h.status}". Estados v\xE1lidos: pausado, cancelado, error, idle, planning, awaiting_instructions, final_review_in_progress.`});let R=!!await b.getWorldBibleByProject(l);console.log(`[Resume] Project ${l} has World Bible: ${R}`),console.log(`[Resume] Updating project ${l} status to generating`),await b.updateProject(l,{status:"generating"});for(let O of["architect","ghostwriter","editor","copyeditor","final-reviewer"])await b.updateAgentStatus(l,O,{status:"idle",currentTask:R?"Preparando reanudaci\xF3n...":"Preparando generaci\xF3n desde cero..."});console.log(`[Resume] Agent statuses updated for project ${l}`),d.json({message:R?"Resume started":"Generation started from scratch",projectId:l,fromScratch:!R}),console.log(`[Resume] Response sent, starting orchestrator for project ${l} (fromScratch: ${!R})`);let x=O=>{let I=qr.get(l);if(I){let _=`data: ${JSON.stringify(O)}

`;I.forEach(N=>{try{N.write(_)}catch(P){console.error("Error writing to stream:",P)}})}};h.pipelineVersion!=="v2"&&(await b.updateProject(l,{pipelineVersion:"v2"}),console.log(`[Resume] Upgraded project ${l} to v2 pipeline`)),console.log(`[Resume] Resuming project ${l} with OrchestratorV2.generateNovel`),new Qr({onAgentStatus:async(O,I,_)=>{await b.updateAgentStatus(l,O,{status:I,currentTask:_}),x({type:"agent_status",role:O,status:I,message:_}),_&&await kt(l,"info",_,O)},onChapterComplete:async(O,I,_)=>{x({type:"chapter_complete",chapterNumber:O,wordCount:I,chapterTitle:_});let N=zm(O,_);await kt(l,"success",`${N} completado (${I} palabras)`,"ghostwriter-v2")},onSceneComplete:async(O,I,_,N)=>{x({type:"scene_complete",chapterNumber:O,sceneNumber:I,totalScenes:_,wordCount:N})},onProjectComplete:async()=>{x({type:"project_complete"}),await kt(l,"success","Novela completada exitosamente","orchestrator")},onError:async O=>{x({type:"error",message:O}),await kt(l,"error",O,"orchestrator")},onChaptersBeingCorrected:(O,I)=>{x({type:"chapters_being_corrected",chapterNumbers:O,revisionCycle:I})}}).generateNovel(h).catch(console.error)}catch(l){console.error("Error resuming generation:",l),d.status(500).json({error:"Failed to resume generation"})}}),e.post("/api/projects/:id/restart-from-scratch",async(E,d)=>{try{let l=parseInt(E.params.id);console.log(`[Restart] Starting restart from scratch for project ${l}`);let h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});io(l);let v=await b.getChaptersByProject(l);for(let x of v)await b.deleteChapter(x.id);console.log(`[Restart] Deleted ${v.length} chapters`),await M.delete(Xn).where(q(Xn.projectId,l)),console.log("[Restart] Deleted World Bible"),await M.delete(Gt).where(q(Gt.projectId,l)),await M.delete(ar).where(q(ar.projectId,l)),await M.delete(Cr).where(q(Cr.projectId,l)),console.log("[Restart] Deleted consistency data"),await b.updateProject(l,{status:"pending",currentChapter:0,totalInputTokens:0,totalOutputTokens:0,totalThinkingTokens:0,revisionCycle:0,finalReviewResult:null});for(let x of["architect","ghostwriter","editor","copyeditor","final-reviewer","global-architect","chapter-architect","ghostwriter-v2","smart-editor","summarizer","narrative-director","consistency"])await b.updateAgentStatus(l,x,{status:"idle",currentTask:"Preparando reinicio..."});d.json({message:"Project reset successfully",projectId:l}),console.log(`[Restart] Project ${l} reset complete, ready to start fresh`),await b.updateProject(l,{status:"generating"});let S=x=>{let w=qr.get(l);if(w){let O=`data: ${JSON.stringify(x)}

`;w.forEach(I=>{try{I.write(O)}catch(_){console.error("Error writing to stream:",_)}})}};new Qr({onAgentStatus:async(x,w,O)=>{await b.updateAgentStatus(l,x,{status:w,currentTask:O||""}),S({type:"agent_status",role:x,status:w,message:O})},onChapterComplete:async(x,w,O)=>{await b.updateProject(l,{currentChapter:x}),S({type:"chapter_complete",chapterNumber:x,wordCount:w,chapterTitle:O})},onSceneComplete:(x,w,O,I)=>{S({type:"scene_complete",chapterNumber:x,sceneNumber:w,totalScenes:O,wordCount:I})},onProjectComplete:async()=>{S({type:"generation_complete"})},onError:async x=>{console.error(`[Restart] Generation error for project ${l}:`,x),S({type:"error",error:String(x)})},onChaptersBeingCorrected:(x,w)=>{S({type:"chapters_being_corrected",chapterNumbers:x,revisionCycle:w})}}).generateNovel(h).catch(console.error)}catch(l){console.error("Error restarting project:",l),d.status(500).json({error:"Failed to restart project"})}}),e.post("/api/projects/:id/final-review",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(n(l)){let w=t.get(l);return d.status(409).json({error:`Ya hay una correcci\xF3n '${w?.type}' en ejecuci\xF3n. Espera a que termine o canc\xE9lala primero.`,activeType:w?.type,startTime:w?.startTime})}if(!["completed","awaiting_final_review","failed_final_review"].includes(h.status))return d.status(400).json({error:"Solo se puede ejecutar la revisi\xF3n final en proyectos completados o con revisi\xF3n fallida"});a(l,"legacy"),await b.updateProject(l,{status:"final_review_in_progress",revisionCycle:0,finalReviewResult:null,voiceAuditCompleted:!1,semanticCheckCompleted:!1}),d.json({message:"Final review started",projectId:l});let S=w=>{let O=qr.get(l);if(O){let I=`data: ${JSON.stringify(w)}

`;O.forEach(_=>{try{_.write(I)}catch(N){console.error("Error writing to stream:",N)}})}},R=new Qr({onAgentStatus:(w,O,I)=>{b.updateAgentStatus(l,w,{status:O,currentTask:I}),S({type:"agent_status",agentName:w,status:O,currentTask:I})},onChapterComplete:(w,O,I)=>{S({type:"chapter_complete",chapterNumber:w,wordCount:O,title:I})},onSceneComplete:()=>{},onProjectComplete:()=>{s(l),S({type:"project_complete"}),kt(l,"success","Revisi\xF3n final completada","smart-editor")},onError:w=>{s(l),S({type:"error",error:w}),kt(l,"error",w,"smart-editor")},onChaptersBeingCorrected:(w,O)=>{S({type:"chapters_being_corrected",chapterNumbers:w,revisionCycle:O})}}),x=E.body?.useGeminiQA||{};(x.finalReviewer||x.continuitySentinel||x.narrativeDirector)&&R.setGeminiQAFlags(x),R.runFinalReviewOnly(h).finally(()=>{s(l)}),console.log(`[FinalReview] Started final review for project ${l} (v2 pipeline)${x.finalReviewer?" [Gemini FR]":""}`)}catch(l){console.error("Error starting final review:",l),d.status(500).json({error:"Failed to start final review"})}}),e.post("/api/projects/:id/restart-corrections",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});let v=["paused","cancelled","error","failed_final_review","completed","awaiting_approval"];if(!v.includes(h.status))return d.status(400).json({error:`No se puede reiniciar correcciones en estado '${h.status}'. Estados permitidos: ${v.join(", ")}`});await b.updateProject(l,{status:"final_review_in_progress",revisionCycle:0,finalReviewResult:null,voiceAuditCompleted:!1,semanticCheckCompleted:!1}),await b.createActivityLog({projectId:l,level:"info",message:"Reiniciando correcciones desde cero (ciclo 0/15)...",agentRole:"system",metadata:{action:"restart_corrections"}}),d.json({success:!0,message:"Corrections restarted from cycle 0",projectId:l});let S=x=>{let w=qr.get(l);if(w){let O=`data: ${JSON.stringify(x)}

`;w.forEach(I=>I.write(O))}};new Qr({onAgentStatus:(x,w,O)=>{b.updateAgentStatus(l,x,{status:w,currentTask:O||""}),S({type:"agent_status",agentName:x,status:w,currentTask:O})},onChapterComplete:(x,w,O)=>{S({type:"chapter_complete",chapterNumber:x,wordCount:w,title:O})},onSceneComplete:()=>{},onProjectComplete:()=>{S({type:"project_complete"}),kt(l,"success","Correcciones completadas exitosamente","smart-editor")},onError:x=>{S({type:"error",error:x}),kt(l,"error",x,"smart-editor")},onChaptersBeingCorrected:(x,w)=>{S({type:"chapters_being_corrected",chapterNumbers:x,revisionCycle:w})}}).runFinalReviewOnly(h,15),console.log(`[RestartCorrections] Started corrections from cycle 0 for project ${l}`)}catch(l){console.error("Error restarting corrections:",l),d.status(500).json({error:"Failed to restart corrections"})}}),e.post("/api/projects/:id/extend",async(E,d)=>{try{let l=parseInt(E.params.id),{targetChapters:h}=E.body;console.log(`[Extend] Starting extension for project ${l} to ${h} chapters`);let v=await b.getProject(l);if(!v)return d.status(404).json({error:"Project not found"});if(v.status==="generating")return d.status(400).json({error:"Project is already generating"});let R=(await b.getChaptersByProject(l)).filter(I=>I.chapterNumber>0),x=R.length>0?Math.max(...R.map(I=>I.chapterNumber)):0;if(!h||h<=x)return d.status(400).json({error:`Target chapters (${h}) must be greater than existing chapters (${x})`});await b.updateProject(l,{status:"generating",chapterCount:h});for(let I of["architect","ghostwriter","editor","copyeditor","final-reviewer"])await b.updateAgentStatus(l,I,{status:"idle",currentTask:"Preparando extensi\xF3n..."});d.json({message:"Extension started",projectId:l,fromChapter:x+1,toChapter:h});let w=I=>{let _=qr.get(l);if(_){let N=`data: ${JSON.stringify(I)}

`;_.forEach(P=>{try{P.write(N)}catch(L){console.error("Error writing to stream:",L)}})}};new Qr({onAgentStatus:(I,_,N)=>{b.updateAgentStatus(l,I,{status:_,currentTask:N}),w({type:"agent_status",agentName:I,status:_,currentTask:N})},onChapterComplete:(I,_,N)=>{w({type:"chapter_complete",chapterNumber:I,wordCount:_,title:N}),kt(l,"success",`Cap\xEDtulo ${I} extendido: "${N}" (${_} palabras)`,"ghostwriter-v2")},onSceneComplete:(I,_,N,P)=>{w({type:"scene_complete",chapterNumber:I,sceneNumber:_,totalScenes:N,wordCount:P})},onProjectComplete:()=>{w({type:"project_complete"}),kt(l,"success","Extensi\xF3n completada","orchestrator-v2")},onError:I=>{w({type:"error",error:I}),kt(l,"error",I,"orchestrator-v2")},onChaptersBeingCorrected:(I,_)=>{w({type:"chapters_being_corrected",chapterNumbers:I,revisionCycle:_})}}).extendNovel(v,x,h)}catch(l){console.error("Error extending project:",l),d.status(500).json({error:"Failed to extend project"})}}),e.post("/api/projects/:id/force-sentinel",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="generating")return d.status(400).json({error:"El proyecto ya est\xE1 siendo procesado"});await b.updateProject(l,{status:"generating"}),d.json({message:"Centinela forzado iniciado",projectId:l});let v=R=>{let x=qr.get(l);if(x){let w=`data: ${JSON.stringify(R)}

`;x.forEach(O=>{try{O.write(w)}catch(I){console.error("Error writing to stream:",I)}})}};new Qr({onAgentStatus:(R,x,w)=>{b.updateAgentStatus(l,R,{status:x,currentTask:w}),v({type:"agent_status",agentName:R,status:x,currentTask:w})},onChapterComplete:(R,x,w)=>{v({type:"chapter_complete",chapterNumber:R,wordCount:x,title:w}),kt(l,"success",`Cap\xEDtulo ${R} corregido`,"smart-editor")},onSceneComplete:()=>{},onProjectComplete:()=>{v({type:"project_complete"}),kt(l,"success","An\xE1lisis de continuidad completado","orchestrator-v2")},onError:R=>{v({type:"error",error:R}),kt(l,"error",R,"orchestrator-v2")},onChaptersBeingCorrected:(R,x)=>{v({type:"chapters_being_corrected",chapterNumbers:R,revisionCycle:x})}}).runContinuitySentinelForce(h)}catch(l){console.error("Error starting forced sentinel:",l),d.status(500).json({error:"Failed to start forced sentinel"})}}),e.post("/api/projects/:id/regenerate-truncated",async(E,d)=>{try{let l=parseInt(E.params.id),h=parseInt(E.body.minWordCount)||100,v=await b.getProject(l);if(!v)return d.status(404).json({error:"Project not found"});if(v.status==="generating")return d.status(400).json({error:"El proyecto ya est\xE1 siendo procesado"});await b.updateProject(l,{status:"generating"}),d.json({message:"Regeneraci\xF3n de cap\xEDtulos truncados iniciada",projectId:l,minWordCount:h});let S=x=>{let w=qr.get(l);if(w){let O=`data: ${JSON.stringify(x)}

`;w.forEach(I=>{try{I.write(O)}catch(_){console.error("Error writing to stream:",_)}})}};new Qr({onAgentStatus:(x,w,O)=>{b.updateAgentStatus(l,x,{status:w,currentTask:O}),S({type:"agent_status",agentName:x,status:w,currentTask:O})},onChapterComplete:(x,w,O)=>{S({type:"chapter_complete",chapterNumber:x,wordCount:w,title:O}),kt(l,"success",`Cap\xEDtulo ${x} regenerado (${w} palabras)`,"ghostwriter-v2")},onSceneComplete:(x,w,O,I)=>{S({type:"scene_complete",chapterNumber:x,sceneNumber:w,totalScenes:O,wordCount:I})},onProjectComplete:()=>{S({type:"project_complete"}),kt(l,"success","Regeneraci\xF3n de cap\xEDtulos truncados completada","orchestrator-v2")},onError:x=>{S({type:"error",error:x}),kt(l,"error",x,"orchestrator-v2")},onChaptersBeingCorrected:(x,w)=>{S({type:"chapters_being_corrected",chapterNumbers:x,revisionCycle:w})}}).regenerateTruncatedChapters(v,h)}catch(l){console.error("Error starting truncated chapters regeneration:",l),d.status(500).json({error:"Failed to start truncated chapters regeneration"})}}),e.post("/api/projects/:id/regenerate-chapter/:chapterNumber",async(E,d)=>{let h=parseInt(E.params.id),v=parseInt(E.params.chapterNumber);try{let S=await b.getProject(h);if(!S)return d.status(404).json({error:"Project not found"});let R=await b.getChaptersByProject(h),x=R.find(F=>F.chapterNumber===v);if(!x)return d.status(404).json({error:"Chapter not found"});let w=await b.getWorldBibleByProject(h);if(!w)return d.status(400).json({error:"No world bible found for project"});let O={world_bible:{characters:w.characters,timeline:w.timeline,worldRules:w.worldRules,plotOutline:w.plotOutline,seccion_por_capitulo:w.plotOutline?.seccion_por_capitulo||[]}};await b.updateAgentStatus(h,"ghostwriter",{status:"writing",currentTask:`Regenerando Cap\xEDtulo ${v}...`});let I=(await Promise.resolve().then(()=>(fm(),Ey))).GhostwriterAgent,_=new I,N={numero:v,titulo:x.title||`Cap\xEDtulo ${v}`,cronologia:"",ubicacion:"",elenco_presente:[],objetivo_narrativo:"",beats:[],resumen:"",escenas:[],giro_dramatico:"",pov_character:"",emotional_arc:"",conflicts:[],revelations:[],cliffhanger:""};if(O.world_bible?.seccion_por_capitulo){let ae=O.world_bible.seccion_por_capitulo.find(D=>D.numero===v);ae&&Object.assign(N,ae)}let P=R.filter(F=>F.chapterNumber<v&&F.content&&F.content.length>100).sort((F,ae)=>ae.chapterNumber-F.chapterNumber).slice(0,3),L=P.length>0?`Resumen de cap\xEDtulos anteriores:
${P.map(F=>`Cap ${F.chapterNumber}: ${F.content?.slice(0,500)}...`).join(`

`)}`:"",j="";if(S.styleGuideId){let F=await b.getStyleGuide(S.styleGuideId);F?.content&&(j=typeof F.content=="string"?F.content:JSON.stringify(F.content))}let $=new Promise((F,ae)=>{setTimeout(()=>ae(new Error("Timeout: La regeneraci\xF3n tard\xF3 demasiado tiempo")),6e5)}),U=_.execute({chapterNumber:v,chapterData:N,worldBible:O.world_bible||O,guiaEstilo:j,previousContinuity:L,refinementInstructions:"CR\xCDTICO: Escribe un cap\xEDtulo COMPLETO de 2500-3500 palabras. NO truncar.",authorName:"",isRewrite:!0}),k=await Promise.race([U,$]),{cleanContent:V}=_.extractContinuityState(k.content),Q=V.split(/\s+/).filter(F=>F.length>0).length,te=zm(v,x.title);if(Q<500)return await b.updateAgentStatus(h,"ghostwriter",{status:"error",currentTask:`${te} truncado (${Q} palabras)`}),d.status(400).json({error:"Chapter still truncated",wordCount:Q,message:`${te} solo tiene ${Q} palabras. Intenta de nuevo m\xE1s tarde.`});await b.updateChapter(x.id,{content:V,status:"completed"}),await b.updateAgentStatus(h,"ghostwriter",{status:"idle",currentTask:`${te} regenerado (${Q} palabras)`}),d.json({success:!0,chapterNumber:v,wordCount:Q,message:`${te} regenerado exitosamente con ${Q} palabras`})}catch(S){console.error("Error regenerating single chapter:",S),await b.updateAgentStatus(h,"ghostwriter",{status:"idle",currentTask:"Error en regeneraci\xF3n"}),d.status(500).json({error:"Failed to regenerate chapter",message:S instanceof Error?S.message:"Error desconocido"})}}),e.get("/api/projects/:id/stream",(E,d)=>{let l=parseInt(E.params.id);d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.flushHeaders(),qr.has(l)||qr.set(l,new Set),qr.get(l).add(d),d.write(`data: ${JSON.stringify({type:"connected"})}

`),E.on("close",()=>{let h=qr.get(l);h&&(h.delete(d),h.size===0&&qr.delete(l))})}),e.get("/api/projects/:id/chapters",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getChaptersByProject(l);d.json(h)}catch(l){console.error("Error fetching chapters:",l),d.status(500).json({error:"Failed to fetch chapters"})}}),e.get("/api/projects/:id/world-bible",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getWorldBibleByProject(l);d.json(h||null)}catch(l){console.error("Error fetching world bible:",l),d.status(500).json({error:"Failed to fetch world bible"})}}),e.get("/api/projects/:id/consistency-violations",async(E,d)=>{try{let l=parseInt(E.params.id),h=await M.select().from(Gt).where(q(Gt.projectId,l)).orderBy(ft(Gt.createdAt));d.json(h)}catch(l){console.error("Error fetching consistency violations:",l),d.status(500).json({error:"Failed to fetch consistency violations"})}}),e.patch("/api/projects/:id/consistency-violations/resolve",async(E,d)=>{try{let l=parseInt(E.params.id),{chapterNumber:h,violationIds:v}=E.body,S=M.update(Gt).set({status:"resolved",resolvedAt:new Date,fixDescription:"Marcado como resuelto manualmente tras reescritura del cap\xEDtulo"});if(v&&Array.isArray(v)&&v.length>0)for(let w of v)await M.update(Gt).set({status:"resolved",resolvedAt:new Date,fixDescription:"Marcado como resuelto manualmente"}).where(Zt(q(Gt.id,w),q(Gt.projectId,l)));else if(h!==void 0)await M.update(Gt).set({status:"resolved",resolvedAt:new Date,fixDescription:"Marcado como resuelto tras reescritura del cap\xEDtulo"}).where(Zt(q(Gt.projectId,l),q(Gt.chapterNumber,h),q(Gt.status,"pending")));else{d.status(400).json({error:"Provide chapterNumber or violationIds"});return}let x=(await M.select({count:B`count(*)`}).from(Gt).where(Zt(q(Gt.projectId,l),q(Gt.status,"pending"))))[0]?.count||0;x===0&&await b.updateAgentStatus(l,"universal-consistency",{status:"completed",currentTask:"Sin violaciones pendientes"}),d.json({message:v?`${v.length} violation(s) marked as resolved`:"Violations marked as resolved",remainingPending:x,guardianStatus:x===0?"completed":"warning"})}catch(l){console.error("Error resolving consistency violations:",l),d.status(500).json({error:"Failed to resolve consistency violations"})}}),e.get("/api/projects/:id/consistency-database",async(E,d)=>{try{let l=parseInt(E.params.id),h=await M.select().from(ar).where(q(ar.projectId,l)),v=await M.select().from(Cr).where(q(Cr.projectId,l));d.json({entities:h.map(S=>({id:S.id,name:S.name,type:S.type,status:S.status,attributes:S.attributes,lastSeenChapter:S.lastSeenChapter})),rules:v.map(S=>({id:S.id,description:S.ruleDescription,category:S.category,isActive:S.isActive,sourceChapter:S.sourceChapter}))})}catch(l){console.error("Error fetching consistency database:",l),d.status(500).json({error:"Failed to fetch consistency database"})}}),e.post("/api/projects/:id/revalidate-chapters",async(E,d)=>{try{let l=parseInt(E.params.id);if(isNaN(l))return d.status(400).json({error:"Invalid project ID"});let h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});let v=await b.getChaptersByProject(l);if(v.length===0)return d.json({message:"No chapters to revalidate",violations:[]});let S=await M.select().from(ar).where(q(ar.projectId,l)),R=await M.select().from(Cr).where(q(Cr.projectId,l));if(S.length===0&&R.length===0)return d.status(400).json({error:"No consistency database found. Generate or resume the project first to initialize the Guardian."});await M.delete(Gt).where(q(Gt.projectId,l));let{universalConsistencyAgent:x}=await Promise.resolve().then(()=>(nI(),D2)),w={entities:S.map(N=>({name:N.name,type:N.type,attributes:N.attributes||{},status:N.status,lastSeenChapter:N.lastSeenChapter||void 0})),rules:R.map(N=>({ruleDescription:N.ruleDescription,category:N.category||"GENERAL"})),relationships:[]},O=[],I=0,_=0;for(let N of v){let P=N.content||"";if(P)try{let L=await x.validateChapter(P,h.genre,w.entities,w.rules,w.relationships,N.chapterNumber),j=[];if(!L.isValid&&L.criticalError&&(j.push(`CR\xCDTICO: ${L.criticalError}`),await b.createConsistencyViolation({projectId:l,chapterNumber:N.chapterNumber,violationType:"CONTRADICTION",severity:"critical",description:L.criticalError,affectedEntities:[],wasAutoFixed:!1}),I++),L.warnings&&L.warnings.length>0)for(let $ of L.warnings)j.push($),await b.createConsistencyViolation({projectId:l,chapterNumber:N.chapterNumber,violationType:"WARNING",severity:"major",description:$,affectedEntities:[],wasAutoFixed:!1}),I++;O.push({chapterNumber:N.chapterNumber,title:N.title||`Cap\xEDtulo ${N.chapterNumber}`,isValid:L.isValid&&(!L.warnings||L.warnings.length===0),issues:j})}catch(L){_++,O.push({chapterNumber:N.chapterNumber,title:N.title||`Cap\xEDtulo ${N.chapterNumber}`,isValid:!1,issues:[],error:`Validation failed: ${L instanceof Error?L.message:"Unknown error"}`})}}d.json({message:`Revalidated ${v.length} chapters. Found ${I} issues.${_>0?` (${_} chapters had errors)`:""}`,chaptersValidated:v.length,totalViolations:I,errorsEncountered:_,results:O})}catch(l){console.error("Error revalidating chapters:",l),d.status(500).json({error:"Failed to revalidate chapters"})}}),e.get("/api/projects/:id/thought-logs",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getThoughtLogsByProject(l);d.json(h)}catch(l){console.error("Error fetching thought logs:",l),d.status(500).json({error:"Failed to fetch thought logs"})}}),e.get("/api/projects/:id/activity-logs",async(E,d)=>{try{let l=parseInt(E.params.id),h=parseInt(E.query.limit)||500,v=await b.getActivityLogsByProject(l,h);d.json(v.reverse())}catch(l){console.error("Error fetching activity logs:",l),d.status(500).json({error:"Failed to fetch activity logs"})}}),e.get("/api/projects/:id/ai-usage",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getAiUsageEventsByProject(l);d.json(h)}catch(l){console.error("Error fetching AI usage events:",l),d.status(500).json({error:"Failed to fetch AI usage events"})}}),e.get("/api/agent-statuses",async(E,d)=>{try{let h=(await b.getAllProjects()).find(S=>S.status==="generating");if(!h)return d.json([]);let v=await b.getAgentStatusesByProject(h.id);d.json(v)}catch(l){console.error("Error fetching agent statuses:",l),d.status(500).json({error:"Failed to fetch agent statuses"})}}),e.get("/api/series",async(E,d)=>{try{let l=await b.getAllSeries();d.json(l)}catch(l){console.error("Error fetching series:",l),d.status(500).json({error:"Failed to fetch series"})}}),e.get("/api/series/registry",async(E,d)=>{try{let l=await b.getAllSeries(),h=await b.getAllPseudonyms(),v=await b.getAllProjects(),S=await b.getAllImportedManuscripts(),R=l.map(x=>{let w=x.pseudonymId?h.find(N=>N.id===x.pseudonymId):null,O=v.filter(N=>N.seriesId===x.id).sort((N,P)=>(N.seriesOrder||0)-(P.seriesOrder||0)),I=S.filter(N=>N.seriesId===x.id).sort((N,P)=>(N.seriesOrder||0)-(P.seriesOrder||0)),_=[...O.map(N=>({type:"project",id:N.id,title:N.title,seriesOrder:N.seriesOrder,status:N.status,wordCount:0,continuityAnalysisStatus:null,hasContinuitySnapshot:!1})),...I.map(N=>({type:"imported",id:N.id,title:N.title,seriesOrder:N.seriesOrder,status:N.status==="completed"?"completed":"imported",wordCount:N.totalWordCount||0,continuityAnalysisStatus:N.continuityAnalysisStatus||"pending",hasContinuitySnapshot:!!N.continuitySnapshot,continuitySnapshot:N.continuitySnapshot||null}))].sort((N,P)=>(N.seriesOrder||0)-(P.seriesOrder||0));return{...x,pseudonym:w||null,projects:O,importedManuscripts:I,volumes:_,completedVolumes:_.filter(N=>N.status==="completed"||N.status==="imported").length}});d.json(R)}catch(l){console.error("Error fetching series registry:",l),d.status(500).json({error:"Failed to fetch series registry"})}}),e.get("/api/series/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getSeries(l);if(!h)return d.status(404).json({error:"Series not found"});d.json(h)}catch(l){console.error("Error fetching series:",l),d.status(500).json({error:"Failed to fetch series"})}}),e.get("/api/series/:id/projects",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProjectsBySeries(l);d.json(h)}catch(l){console.error("Error fetching series projects:",l),d.status(500).json({error:"Failed to fetch series projects"})}}),e.get("/api/series/:id/volumes",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getSeries(l))return d.status(404).json({error:"Series not found"});let v=await b.getProjectsBySeries(l),S=await b.getImportedManuscriptsBySeries(l),R=[...v.map(w=>({type:"project",id:w.id,title:w.title,seriesOrder:w.seriesOrder,status:w.status,wordCount:0,createdAt:w.createdAt})),...S.map(w=>({type:"imported",id:w.id,title:w.title,seriesOrder:w.seriesOrder,status:"imported",wordCount:w.totalWordCount||0,createdAt:w.createdAt}))].sort((w,O)=>(w.seriesOrder||0)-(O.seriesOrder||0)),x=Math.max(0,...R.map(w=>w.seriesOrder||0))+1;d.json({volumes:R,nextOrder:x})}catch(l){console.error("Error fetching series volumes:",l),d.status(500).json({error:"Failed to fetch series volumes"})}}),e.post("/api/series/:id/link-manuscript",async(E,d)=>{try{let l=parseInt(E.params.id),{manuscriptId:h,seriesOrder:v}=E.body;if(!h||!v)return d.status(400).json({error:"manuscriptId and seriesOrder are required"});let S=await b.getSeries(l);if(!S)return d.status(404).json({error:"Series not found"});if(!await b.getImportedManuscript(h))return d.status(404).json({error:"Manuscript not found"});let x=await b.getProjectsBySeries(l),w=await b.getImportedManuscriptsBySeries(l);if([...x.map(_=>_.seriesOrder),...w.filter(_=>_.id!==h).map(_=>_.seriesOrder)].includes(v))return d.status(400).json({error:`Volume number ${v} is already used in this series`});let I=await b.updateImportedManuscript(h,{seriesId:l,seriesOrder:v,pseudonymId:S.pseudonymId,continuityAnalysisStatus:"pending"});d.json(I),(async()=>{try{console.log(`[link-manuscript] Starting world bible extraction for manuscript ${h} (Volume ${v})`);let{SeriesWorldBibleExtractor:_}=await Promise.resolve().then(()=>(ju(),lm)),N=new _,P=await N.extractFromManuscript(h,v);P&&(await N.mergeAndSaveToSeries(l,v,P),console.log(`[link-manuscript] World bible extracted and merged for manuscript ${h}`))}catch(_){console.error("[link-manuscript] Error extracting world bible:",_)}})()}catch(l){console.error("Error linking manuscript to series:",l),d.status(500).json({error:"Failed to link manuscript to series"})}}),e.post("/api/series/:id/link-project",async(E,d)=>{try{let l=parseInt(E.params.id),{projectId:h,seriesOrder:v}=E.body;if(!h||!v)return d.status(400).json({error:"projectId and seriesOrder are required"});if(!await b.getSeries(l))return d.status(404).json({error:"Series not found"});if(!await b.getProject(h))return d.status(404).json({error:"Project not found"});let x=await b.getProjectsBySeries(l),w=await b.getImportedManuscriptsBySeries(l);if([...x.filter(_=>_.id!==h).map(_=>_.seriesOrder),...w.map(_=>_.seriesOrder)].includes(v))return d.status(400).json({error:`Volume number ${v} is already used in this series`});let I=await b.updateProject(h,{seriesId:l,seriesOrder:v});d.json(I)}catch(l){console.error("Error linking project to series:",l),d.status(500).json({error:"Failed to link project to series"})}}),e.post("/api/series/:id/unlink-project",async(E,d)=>{try{let{projectId:l}=E.body;if(!l)return d.status(400).json({error:"projectId is required"});let h=await b.updateProject(l,{seriesId:null,seriesOrder:null});d.json(h)}catch(l){console.error("Error unlinking project from series:",l),d.status(500).json({error:"Failed to unlink project from series"})}}),e.post("/api/series/:id/upload-volume",Hm.single("file"),async(E,d)=>{try{let l=parseInt(E.params.id),h=E.file;if(!h)return d.status(400).json({error:"No file uploaded"});let v=await b.getSeries(l);if(!v)return d.status(404).json({error:"Series not found"});let R=(await Wu.default.extractRawText({buffer:h.buffer})).value.trim();if(!R||R.length<1e3)return d.status(400).json({error:"El documento est\xE1 vac\xEDo o tiene muy poco contenido"});let x=await b.getProjectsBySeries(l),w=await b.getImportedManuscriptsBySeries(l),O=Math.max(0,...x.map(k=>k.seriesOrder||0),...w.map(k=>k.seriesOrder||0))+1,I=/(?:^|\n)(?:(?:CAPTULO|CAPITULO|CAP[I]TULO|Captulo|Capitulo|Captulo|Chapter|CHAPTER|CHAPITRE|Chapitre|CAPITOLO|Capitolo|KAPITEL|Kapitel|CAPTOL|Captol)[ \t.:]*(\d+|[IVXLCDM]+)(?:[ \t.:-]+)?([^\n]*))/gi,_=0,N=[],P,L=[];for(;(P=I.exec(R))!==null;){let k=parseInt(P[1])||L.length+1,V=(P[2]||"").trim();L.push({index:P.index,number:k,title:V})}for(let k=0;k<L.length;k++){let V=L[k].index,Q=k+1<L.length?L[k+1].index:R.length,te=R.substring(V,Q).trim();N.push({number:L[k].number,title:L[k].title,content:te})}if(N.length===0){let k=R.split(`
`),V=Math.ceil(k.length/10);for(let Q=0;Q<10&&Q*V<k.length;Q++)N.push({number:Q+1,title:"",content:k.slice(Q*V,(Q+1)*V).join(`
`)})}let j=h.originalname.replace(/\.[^/.]+$/,"").replace(/_/g," "),$=await b.createImportedManuscript({title:j,originalFileName:h.originalname,detectedLanguage:"es",totalChapters:N.length,totalWordCount:R.split(/\s+/).length,pseudonymId:v.pseudonymId,seriesId:l,seriesOrder:O,continuityAnalysisStatus:"pending"}),U=await b.updateImportedManuscript($.id,{status:"completed",processedChapters:N.length});U&&($=U);for(let k of N)await b.createImportedChapter({manuscriptId:$.id,chapterNumber:k.number,title:k.title||`Cap\xEDtulo ${k.number}`,originalContent:k.content,editedContent:k.content,status:"completed",wordCount:k.content.split(/\s+/).length});d.json({message:"Volumen subido correctamente",manuscript:{id:$.id,title:$.title,seriesOrder:$.seriesOrder,totalChapters:N.length,wordCount:R.split(/\s+/).length}}),(async()=>{try{console.log(`[upload-volume] Starting world bible extraction for manuscript ${$.id} (Volume ${O})`);let{SeriesWorldBibleExtractor:k}=await Promise.resolve().then(()=>(ju(),lm)),V=new k,Q=await V.extractFromManuscript($.id,O);Q&&(await V.mergeAndSaveToSeries(l,O,Q),console.log(`[upload-volume] World bible extracted and merged for manuscript ${$.id}`))}catch(k){console.error("[upload-volume] Error extracting world bible:",k)}})()}catch(l){console.error("Error uploading volume:",l),d.status(500).json({error:"Failed to upload volume"})}}),e.post("/api/imported-manuscripts/:id/analyze-continuity",async(E,d)=>{let l=parseInt(E.params.id);try{let h=await b.getImportedManuscript(l);if(!h)return d.status(404).json({error:"Manuscript not found"});if(!h.seriesId)return d.status(400).json({error:"Manuscript must be linked to a series before analysis"});if(fo.has(l))return d.status(409).json({error:"Analysis already in progress"});let v=await b.getSeries(h.seriesId);if(!v)return d.status(404).json({error:"Series not found"});let S=new AbortController;fo.set(l,S),await b.updateImportedManuscript(l,{continuityAnalysisStatus:"analyzing"});let R=await b.getImportedChaptersByManuscript(l);if(R.length===0)return fo.delete(l),await b.updateImportedManuscript(l,{continuityAnalysisStatus:"error"}),d.status(400).json({error:"Manuscript has no chapters to analyze"});let{ManuscriptAnalyzerAgent:x}=await Promise.resolve().then(()=>(a4(),n4)),w=new x,I=(await b.getImportedManuscriptsBySeries(h.seriesId)).filter(L=>L.id!==l&&L.seriesOrder&&h.seriesOrder&&L.seriesOrder<h.seriesOrder&&L.continuitySnapshot).sort((L,j)=>(L.seriesOrder||0)-(j.seriesOrder||0)),_="";if(I.length>0&&(_=I.map(L=>{let j=L.continuitySnapshot;return`**Volumen ${L.seriesOrder}: ${L.title}**
${j?.synopsis||"Sin sinopsis"}`}).join(`

`)),S.signal.aborted)return fo.delete(l),await b.updateImportedManuscript(l,{continuityAnalysisStatus:"pending"}),d.status(499).json({error:"Analysis cancelled"});console.log(`[ContinuityAnalysis] Starting analysis for manuscript ${l} (${h.title}) with ${R.length} chapters`);let N;try{N=await w.analyze({manuscriptTitle:h.title,seriesTitle:v.title,volumeNumber:h.seriesOrder||1,chapters:R.map(L=>({chapterNumber:L.chapterNumber,title:L.title||void 0,content:L.editedContent||L.originalContent})),previousVolumesContext:_||void 0})}catch(L){fo.delete(l);let j=String(L?.message||L||"Unknown error");return console.error(`[ContinuityAnalysis] Analysis failed for manuscript ${l}:`,j),await b.updateImportedManuscript(l,{continuityAnalysisStatus:"error"}),d.status(500).json({error:`Error de an\xE1lisis: ${j.substring(0,200)}`})}if(fo.delete(l),S.signal.aborted)return await b.updateImportedManuscript(l,{continuityAnalysisStatus:"pending"}),d.status(499).json({error:"Analysis cancelled"});let P={totalInputTokens:(h.totalInputTokens||0)+(N.tokenUsage.inputTokens||0),totalOutputTokens:(h.totalOutputTokens||0)+(N.tokenUsage.outputTokens||0),totalThinkingTokens:(h.totalThinkingTokens||0)+(N.tokenUsage.thinkingTokens||0)};N.result?(await b.updateImportedManuscript(l,{continuitySnapshot:N.result,continuityAnalysisStatus:"completed",...P}),d.json({success:!0,snapshot:N.result,tokenUsage:N.tokenUsage})):(await b.updateImportedManuscript(l,{continuityAnalysisStatus:"error",...P}),console.error("[ManuscriptAnalysis] Analysis returned null result - possible rate limit or parsing error"),d.status(500).json({error:"El an\xE1lisis no pudo completarse. Posible l\xEDmite de velocidad de la API. Espere unos minutos e intente de nuevo."}))}catch(h){fo.delete(l);let v=String(h?.message||h||"");console.error("Error analyzing manuscript continuity:",v),v.includes("RATELIMIT")||v.includes("429")||v.includes("rate limit")?d.status(429).json({error:"L\xEDmite de velocidad alcanzado. Por favor, espere unos minutos e intente de nuevo."}):v.includes("TIMEOUT")?d.status(504).json({error:"El an\xE1lisis tard\xF3 demasiado tiempo. El manuscrito puede ser muy largo."}):d.status(500).json({error:`Error al analizar: ${v.substring(0,100)}`})}}),e.post("/api/imported-manuscripts/:id/cancel-analysis",async(E,d)=>{try{let l=parseInt(E.params.id),h=fo.get(l);h&&(h.abort(),fo.delete(l)),await b.updateImportedManuscript(l,{continuityAnalysisStatus:"pending"}),d.json({success:!0,message:"Analysis cancelled"})}catch(l){console.error("Error cancelling manuscript analysis:",l),d.status(500).json({error:"Failed to cancel analysis"})}}),e.get("/api/series/:id/full-continuity",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getSeries(l))return d.status(404).json({error:"Series not found"});let v=await b.getSeriesFullContinuity(l);d.json(v)}catch(l){console.error("Error fetching series full continuity:",l),d.status(500).json({error:"Failed to fetch series full continuity"})}}),e.post("/api/series",async(E,d)=>{console.log("[Series] POST /api/series - body:",JSON.stringify(E.body));try{let l=kce.safeParse(E.body);if(!l.success)return console.error("[Series] Validation failed:",JSON.stringify(l.error.flatten())),d.status(400).json({error:"Invalid series data",details:l.error.flatten()});console.log("[Series] Creating series with data:",JSON.stringify(l.data));let h=await b.createSeries({title:l.data.title,description:l.data.description||null,workType:l.data.workType,totalPlannedBooks:l.data.totalPlannedBooks});console.log("[Series] Series created successfully:",h.id),d.status(201).json(h)}catch(l){console.error("[Series] Error creating series:",l?.message||l),console.error("[Series] Stack:",l?.stack),d.status(500).json({error:"Failed to create series",details:l?.message})}}),e.patch("/api/series/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=Dce.safeParse(E.body);if(!h.success)return d.status(400).json({error:"Invalid series data",details:h.error.flatten()});let v=await b.updateSeries(l,h.data);if(!v)return d.status(404).json({error:"Series not found"});d.json(v)}catch(l){console.error("Error updating series:",l),d.status(500).json({error:"Failed to update series"})}}),e.delete("/api/series/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteSeries(l),d.status(204).send()}catch(l){console.error("Error deleting series:",l),d.status(500).json({error:"Failed to delete series"})}}),e.post("/api/series/:id/guide",Hm.single("file"),async(E,d)=>{try{let l=parseInt(E.params.id),h=E.file;if(!h)return d.status(400).json({error:"No file uploaded"});if(!await b.getSeries(l))return d.status(404).json({error:"Series not found"});let R=(await Wu.default.extractRawText({buffer:h.buffer})).value.trim();if(!R||R.length<100)return d.status(400).json({error:"El documento est\xE1 vac\xEDo o tiene muy poco contenido"});let x=await b.updateSeries(l,{seriesGuide:R,seriesGuideFileName:h.originalname});d.json({message:"Gu\xEDa de serie cargada correctamente",series:x,wordCount:R.split(/\s+/).length})}catch(l){console.error("Error uploading series guide:",l),d.status(500).json({error:"Failed to upload series guide"})}}),e.delete("/api/series/:id/guide",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getSeries(l))return d.status(404).json({error:"Series not found"});await b.updateSeries(l,{seriesGuide:null,seriesGuideFileName:null}),d.json({message:"Gu\xEDa de serie eliminada"})}catch(l){console.error("Error deleting series guide:",l),d.status(500).json({error:"Failed to delete series guide"})}}),e.patch("/api/series/:id/guide",async(E,d)=>{try{let l=parseInt(E.params.id),{content:h}=E.body;if(!h||typeof h!="string")return d.status(400).json({error:"Content is required"});if(!await b.getSeries(l))return d.status(404).json({error:"Series not found"});await b.updateSeries(l,{seriesGuide:h}),d.json({message:"Gu\xEDa de serie actualizada"})}catch(l){console.error("Error updating series guide:",l),d.status(500).json({error:"Failed to update series guide"})}}),e.post("/api/series/:id/guide/extract",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getSeries(l);if(!h)return d.status(404).json({error:"Series not found"});if(!h.seriesGuide)return d.status(400).json({error:"No series guide uploaded. Upload a guide first."});let v=(await Promise.resolve().then(()=>(As(),v2))).default,S=new v({apiKey:process.env.DEEPSEEK_API_KEY,baseURL:"https://api.deepseek.com"}),R=`Analiza esta gu\xEDa de serie literaria y extrae:

1. HITOS NARRATIVOS (plot milestones): Eventos clave que DEBEN ocurrir en vol\xFAmenes espec\xEDficos
2. HILOS ARGUMENTALES (plot threads): Tramas secundarias que atraviesan m\xFAltiples vol\xFAmenes

Responde \xDANICAMENTE en JSON v\xE1lido con esta estructura exacta:
{
  "milestones": [
    {
      "description": "Descripci\xF3n del hito",
      "volumeNumber": 1,
      "milestoneType": "plot_point|character_development|revelation|conflict_resolution|setup",
      "isRequired": true
    }
  ],
  "threads": [
    {
      "threadName": "Nombre del hilo",
      "description": "Descripci\xF3n del hilo argumental",
      "introducedVolume": 1,
      "importance": "major|minor|subplot"
    }
  ]
}

GU\xCDA DE SERIE:
${h.seriesGuide.substring(0,5e4)}`;console.log(`[ExtractMilestones] Starting extraction for series ${l}`),console.log(`[ExtractMilestones] Series guide length: ${h.seriesGuide?.length||0} chars`);let w=(await S.chat.completions.create({model:"deepseek-chat",messages:[{role:"user",content:R}],temperature:.3})).choices[0]?.message?.content||"";console.log(`[ExtractMilestones] Raw response length: ${w.length} chars`),console.log(`[ExtractMilestones] Response preview: ${w.substring(0,500)}...`);let O=w.match(/\{[\s\S]*\}/);if(!O)return console.error(`[ExtractMilestones] No JSON found in response. Full text: ${w}`),d.status(500).json({error:"No se pudo parsear la respuesta de la IA. Int\xE9ntalo de nuevo."});let I;try{I=JSON.parse(O[0])}catch(N){return console.error("[ExtractMilestones] JSON parse error:",N),console.error(`[ExtractMilestones] JSON string that failed: ${O[0].substring(0,500)}...`),d.status(500).json({error:"Error parseando JSON de la respuesta de IA"})}console.log(`[ExtractMilestones] Extracted milestones: ${I.milestones?.length||0}, threads: ${I.threads?.length||0}`);let _={milestonesCreated:0,threadsCreated:0};for(let N of I.milestones||[])await b.createMilestone({seriesId:l,description:N.description,volumeNumber:N.volumeNumber||1,milestoneType:N.milestoneType||"plot_point",isRequired:N.isRequired!==!1}),_.milestonesCreated++;for(let N of I.threads||[])await b.createPlotThread({seriesId:l,threadName:N.threadName,description:N.description,introducedVolume:N.introducedVolume||1,importance:N.importance||"major",status:"active"}),_.threadsCreated++;d.json({message:`Extra\xEDdos ${_.milestonesCreated} hitos y ${_.threadsCreated} hilos argumentales`,..._,extracted:I})}catch(l){console.error("Error extracting from series guide:",l);let h=l?.message||String(l),v=h.includes("RATELIMIT")||h.includes("429");d.status(v?429:500).json({error:v?"L\xEDmite de tasa excedido. Espera unos minutos e int\xE9ntalo de nuevo.":"No se pudo extraer de la gu\xEDa",details:h.substring(0,500)})}}),e.get("/api/series/:id/world-bible",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getSeriesWorldBible(l);if(!h)return d.json({characters:[],locations:[],lessons:[],worldRules:[],timelineEvents:[],objects:[],secrets:[]});d.json(h)}catch(l){console.error("Error fetching series world bible:",l),d.status(500).json({error:"Failed to fetch series world bible"})}}),e.post("/api/series/:id/world-bible/extract",async(E,d)=>{try{let l=parseInt(E.params.id),{projectId:h,volumeNumber:v}=E.body;if(!h)return d.status(400).json({error:"projectId is required"});let S=await b.getProject(h);if(!S)return d.status(404).json({error:"Project not found"});if(S.seriesId!==l)return d.status(400).json({error:"Project does not belong to this series"});let{SeriesWorldBibleExtractor:R}=await Promise.resolve().then(()=>(ju(),lm)),x=new R;console.log(`[SeriesWorldBible] Extracting from project ${h} (Volume ${v||S.seriesOrder||1})`);let w=await x.extractFromProject(h,v||S.seriesOrder||1);if(!w)return d.status(500).json({error:"Failed to extract world bible data"});await x.mergeAndSaveToSeries(l,v||S.seriesOrder||1,w),d.json({message:"World bible extracted and merged successfully",extracted:{characters:w.characters.length,locations:w.locations.length,lessons:w.lessons.length,worldRules:w.worldRules.length,timeline:w.timeline.length,objects:w.objects.length,secrets:w.secrets.length}})}catch(l){console.error("Error extracting series world bible:",l),d.status(500).json({error:"Failed to extract series world bible"})}}),e.get("/api/series/:id/world-bible/context",async(E,d)=>{try{let l=parseInt(E.params.id),h=parseInt(E.query.targetVolume)||1,{SeriesWorldBibleExtractor:v}=await Promise.resolve().then(()=>(ju(),lm)),S=new v,R=await S.getSeriesWorldBible(l);if(!R)return d.json({context:"",hasData:!1});let x=S.formatForGhostwriter(R,h);d.json({context:x,hasData:!0})}catch(l){console.error("Error getting series world bible context:",l),d.status(500).json({error:"Failed to get series world bible context"})}}),e.get("/api/pseudonyms",async(E,d)=>{try{let l=await b.getAllPseudonyms();d.json(l)}catch(l){console.error("Error fetching pseudonyms:",l),d.status(500).json({error:"Failed to fetch pseudonyms"})}}),e.get("/api/all-style-guides",async(E,d)=>{try{let l=await b.getAllPseudonyms(),h=[];for(let v of l){let S=await b.getStyleGuidesByPseudonym(v.id);h.push(...S)}d.json(h)}catch(l){console.error("Error fetching all style guides:",l),d.status(500).json({error:"Failed to fetch style guides"})}}),e.get("/api/pseudonyms/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getPseudonym(l);if(!h)return d.status(404).json({error:"Pseudonym not found"});d.json(h)}catch(l){console.error("Error fetching pseudonym:",l),d.status(500).json({error:"Failed to fetch pseudonym"})}}),e.post("/api/pseudonyms",async(E,d)=>{try{let l=HS.safeParse(E.body);if(!l.success)return d.status(400).json({error:"Invalid pseudonym data",details:l.error});let h=await b.createPseudonym(l.data);d.status(201).json(h)}catch(l){console.error("Error creating pseudonym:",l),d.status(500).json({error:"Failed to create pseudonym"})}}),e.patch("/api/pseudonyms/:id",async(E,d)=>{try{let l=parseInt(E.params.id),{name:h,bio:v}=E.body,S={};h!==void 0&&(S.name=h),v!==void 0&&(S.bio=v);let R=await b.updatePseudonym(l,S);if(!R)return d.status(404).json({error:"Pseudonym not found"});d.json(R)}catch(l){console.error("Error updating pseudonym:",l),d.status(500).json({error:"Failed to update pseudonym"})}}),e.delete("/api/pseudonyms/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deletePseudonym(l),d.status(204).send()}catch(l){console.error("Error deleting pseudonym:",l),d.status(500).json({error:"Failed to delete pseudonym"})}}),e.get("/api/pseudonyms/:id/style-guides",async(E,d)=>{try{let l=parseInt(E.params.id);if(isNaN(l)||l<=0)return d.json([]);if(!await b.getPseudonym(l))return d.json([]);let v=await b.getStyleGuidesByPseudonym(l);d.json(v)}catch(l){console.error("Error fetching style guides:",l),d.status(500).json({error:"Failed to fetch style guides"})}}),e.post("/api/pseudonyms/:id/style-guides",async(E,d)=>{try{let l=parseInt(E.params.id),h=WS.safeParse({...E.body,pseudonymId:l});if(!h.success)return d.status(400).json({error:"Invalid style guide data",details:h.error});let v=await b.createStyleGuide(h.data);d.status(201).json(v)}catch(l){console.error("Error creating style guide:",l),d.status(500).json({error:"Failed to create style guide"})}}),e.get("/api/style-guides/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getStyleGuide(l);if(!h)return d.status(404).json({error:"Style guide not found"});d.json(h)}catch(l){console.error("Error fetching style guide:",l),d.status(500).json({error:"Failed to fetch style guide"})}}),e.patch("/api/style-guides/:id",async(E,d)=>{try{let l=parseInt(E.params.id),{title:h,content:v,isActive:S}=E.body,R={};h!==void 0&&(R.title=h),v!==void 0&&(R.content=v),S!==void 0&&(R.isActive=S);let x=await b.updateStyleGuide(l,R);if(!x)return d.status(404).json({error:"Style guide not found"});d.json(x)}catch(l){console.error("Error updating style guide:",l),d.status(500).json({error:"Failed to update style guide"})}}),e.delete("/api/style-guides/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteStyleGuide(l),d.status(204).send()}catch(l){console.error("Error deleting style guide:",l),d.status(500).json({error:"Failed to delete style guide"})}}),e.post("/api/upload/word",Hm.single("file"),async(E,d)=>{try{if(!E.file)return d.status(400).json({error:"No se proporcion\xF3 ning\xFAn archivo"});let l=await Wu.default.extractRawText({buffer:E.file.buffer}),h=l.value.trim();if(!h)return d.status(400).json({error:"El archivo est\xE1 vac\xEDo o no se pudo extraer el texto"});d.json({content:h,filename:E.file.originalname,messages:l.messages})}catch(l){console.error("Error processing Word file:",l),d.status(500).json({error:"Error al procesar el archivo Word"})}});let m=Z.object({title:Z.string().min(1,"Title is required"),originalFileName:Z.string().min(1),detectedLanguage:Z.string().nullable().optional(),targetLanguage:Z.string().default("es"),chapters:Z.array(Z.object({chapterNumber:Z.number(),title:Z.string().nullable().optional(),content:Z.string()}))});e.get("/api/imported-manuscripts",async(E,d)=>{try{let l=await b.getAllImportedManuscripts();d.json(l)}catch(l){console.error("Error fetching imported manuscripts:",l),d.status(500).json({error:"Failed to fetch imported manuscripts"})}}),e.get("/api/imported-manuscripts/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getImportedManuscript(l);if(!h)return d.status(404).json({error:"Manuscript not found"});d.json(h)}catch(l){console.error("Error fetching manuscript:",l),d.status(500).json({error:"Failed to fetch manuscript"})}}),e.post("/api/imported-manuscripts",async(E,d)=>{try{let l=m.safeParse(E.body);if(!l.success)return d.status(400).json({error:"Invalid manuscript data",details:l.error});let{chapters:h,...v}=l.data,S=await b.createImportedManuscript({...v,totalChapters:h.length});for(let R of h)await b.createImportedChapter({manuscriptId:S.id,chapterNumber:R.chapterNumber,title:R.title,originalContent:R.content,wordCount:R.content.split(/\s+/).length,status:"pending"});d.status(201).json(S)}catch(l){console.error("Error creating imported manuscript:",l),d.status(500).json({error:"Failed to create imported manuscript"})}}),e.get("/api/imported-manuscripts/:id/chapters",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getImportedChaptersByManuscript(l);d.json(h)}catch(l){console.error("Error fetching imported chapters:",l),d.status(500).json({error:"Failed to fetch imported chapters"})}}),e.patch("/api/imported-manuscripts/:id",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getImportedManuscript(l))return d.status(404).json({error:"Manuscript not found"});let v={},S=E.body;S.status!==void 0&&(v.status=S.status),S.processedChapters!==void 0&&(v.processedChapters=S.processedChapters),S.totalInputTokens!==void 0&&(v.totalInputTokens=S.totalInputTokens),S.totalOutputTokens!==void 0&&(v.totalOutputTokens=S.totalOutputTokens),S.totalThinkingTokens!==void 0&&(v.totalThinkingTokens=S.totalThinkingTokens),S.seriesId!==void 0&&(v.seriesId=S.seriesId),S.seriesOrder!==void 0&&(v.seriesOrder=S.seriesOrder),S.pseudonymId!==void 0&&(v.pseudonymId=S.pseudonymId),S.totalWordCount!==void 0&&(v.totalWordCount=S.totalWordCount);let R=await b.updateImportedManuscript(l,v);d.json(R)}catch(l){console.error("Error updating manuscript:",l),d.status(500).json({error:"Failed to update manuscript"})}}),e.patch("/api/imported-chapters/:id",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getImportedChapter(l))return d.status(404).json({error:"Chapter not found"});let v={},S=E.body;S.editedContent!==void 0&&(v.editedContent=S.editedContent),S.changesLog!==void 0&&(v.changesLog=S.changesLog),S.status!==void 0&&(v.status=S.status);let R=await b.updateImportedChapter(l,v);d.json(R)}catch(l){console.error("Error updating chapter:",l),d.status(500).json({error:"Failed to update chapter"})}}),e.delete("/api/imported-manuscripts/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteImportedManuscript(l),d.status(204).send()}catch(l){console.error("Error deleting manuscript:",l),d.status(500).json({error:"Failed to delete manuscript"})}}),e.get("/api/imported-manuscripts/:id/cost",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getImportedManuscript(l);if(!h)return d.status(404).json({error:"Manuscript not found"});let v=.8,S=6.5,R=3,x=(h.totalInputTokens||0)/1e6*v,w=(h.totalOutputTokens||0)/1e6*S,O=(h.totalThinkingTokens||0)/1e6*R,I=x+w+O;d.json({manuscriptId:h.id,inputTokens:h.totalInputTokens||0,outputTokens:h.totalOutputTokens||0,thinkingTokens:h.totalThinkingTokens||0,inputCostUSD:x,outputCostUSD:w,thinkingCostUSD:O,totalCostUSD:I,pricing:{inputPricePerMillion:v,outputPricePerMillion:S,thinkingPricePerMillion:R}})}catch(l){console.error("Error calculating cost:",l),d.status(500).json({error:"Failed to calculate cost"})}}),e.post("/api/imported-chapters/:id/edit",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getImportedChapter(l);if(!h)return d.status(404).json({error:"Chapter not found"});let v=await b.getImportedManuscript(h.manuscriptId);if(!v)return d.status(404).json({error:"Manuscript not found"});await b.updateImportedChapter(l,{status:"processing"}),await b.updateImportedManuscript(v.id,{status:"processing"});let R=await new kc().execute({chapterContent:h.originalContent,chapterNumber:h.chapterNumber,chapterTitle:h.title||`Cap\xEDtulo ${h.chapterNumber}`,targetLanguage:v.detectedLanguage||v.targetLanguage||"es"}),x=R.tokenUsage?.inputTokens||0,w=R.tokenUsage?.outputTokens||0,O=R.tokenUsage?.thinkingTokens||0;await b.updateImportedChapter(l,{editedContent:R.result?.texto_final||h.originalContent,changesLog:R.result?.cambios_realizados||"Sin cambios",status:"completed"});let _=(await b.getImportedChaptersByManuscript(v.id)).filter(P=>P.status==="completed").length,N=_===v.totalChapters;await b.updateImportedManuscript(v.id,{processedChapters:_,totalInputTokens:(v.totalInputTokens||0)+x,totalOutputTokens:(v.totalOutputTokens||0)+w,totalThinkingTokens:(v.totalThinkingTokens||0)+O,status:N?"completed":"processing"}),d.json({success:!0,chapterId:l,editedContent:R.result?.texto_final,changesLog:R.result?.cambios_realizados,tokensUsed:{input:x,output:w,thinking:O}})}catch(l){console.error("Error editing chapter:",l),d.status(500).json({error:"Failed to edit chapter"})}}),e.post("/api/imported-chapters/:id/review-italian",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getImportedChapter(l);if(!h)return d.status(404).json({error:"Chapter not found"});let v=h.editedContent||h.originalContent,R=await new gm().execute({chapterContent:v,chapterNumber:h.chapterNumber});if(!R.result)return d.status(500).json({error:"Failed to analyze text"});d.json({success:!0,chapterId:l,review:R.result,tokensUsed:R.tokenUsage})}catch(l){console.error("Error reviewing Italian chapter:",l),d.status(500).json({error:"Failed to review chapter"})}}),e.post("/api/imported-manuscripts/:id/edit-all",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getImportedManuscript(l);if(!h)return d.status(404).json({error:"Manuscript not found"});let S=(await b.getImportedChaptersByManuscript(l)).filter(w=>w.status==="pending");if(S.length===0)return d.status(400).json({error:"No pending chapters to edit"});await b.updateImportedManuscript(l,{status:"processing"}),d.json({message:"Editing started",manuscriptId:l,chaptersToEdit:S.length});let R=new kc,x=h.detectedLanguage||h.targetLanguage||"es";for(let w of S)try{await b.updateImportedChapter(w.id,{status:"processing"});let O=await R.execute({chapterContent:w.originalContent,chapterNumber:w.chapterNumber,chapterTitle:w.title||`Cap\xEDtulo ${w.chapterNumber}`,targetLanguage:x}),I=O.tokenUsage?.inputTokens||0,_=O.tokenUsage?.outputTokens||0,N=O.tokenUsage?.thinkingTokens||0;await b.updateImportedChapter(w.id,{editedContent:O.result?.texto_final||w.originalContent,changesLog:O.result?.cambios_realizados||"Sin cambios",status:"completed"});let P=await b.getImportedManuscript(l);if(P){let j=(await b.getImportedChaptersByManuscript(l)).filter($=>$.status==="completed").length;await b.updateImportedManuscript(l,{processedChapters:j,totalInputTokens:(P.totalInputTokens||0)+I,totalOutputTokens:(P.totalOutputTokens||0)+_,totalThinkingTokens:(P.totalThinkingTokens||0)+N,status:j===P.totalChapters?"completed":"processing"})}}catch(O){console.error(`Error editing chapter ${w.id}:`,O),await b.updateImportedChapter(w.id,{status:"error"})}}catch(l){console.error("Error starting batch edit:",l),d.status(500).json({error:"Failed to start batch editing"})}}),e.post("/api/imported-manuscripts/:id/normalize-titles",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getImportedManuscript(l);if(!h)return d.status(404).json({error:"Manuscript not found"});let v=await b.getImportedChaptersByManuscript(l),S=0,R=x=>x.replace(/\w\S*/g,w=>w.charAt(0).toUpperCase()+w.substr(1).toLowerCase());for(let x of v){let w=x.editedContent||x.originalContent;if(!w)continue;let O=w.trim(),I=!1,_="",N=h.detectedLanguage?.toLowerCase()||"es",P={en:{chapter:"Chapter",prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note"},es:{chapter:"Cap\xEDtulo",prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota del Autor"},fr:{chapter:"Chapitre",prologue:"Prologue",epilogue:"\xC9pilogue",authorNote:"Note de l'auteur"},de:{chapter:"Kapitel",prologue:"Prolog",epilogue:"Epilog",authorNote:"Nachwort"},it:{chapter:"Capitolo",prologue:"Prologo",epilogue:"Epilogo",authorNote:"Nota dell'autore"},pt:{chapter:"Cap\xEDtulo",prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota do Autor"},ca:{chapter:"Cap\xEDtol",prologue:"Pr\xF2leg",epilogue:"Ep\xEDleg",authorNote:"Nota de l'Autor"}},L=P[N]||P.es;if(x.chapterNumber===0)_=x.title&&x.title!==L.prologue?`# ${L.prologue}: ${x.title}`:`# ${L.prologue}`;else if(x.chapterNumber===-1)_=x.title&&x.title!==L.epilogue?`# ${L.epilogue}: ${x.title}`:`# ${L.epilogue}`;else if(x.chapterNumber===-2)_=x.title&&x.title!==L.authorNote?`# ${L.authorNote}: ${x.title}`:`# ${L.authorNote}`;else{let k=x.title?R(x.title.replace(new RegExp(`^${L.chapter}\\s*\\d+\\s*:?\\s*`,"i"),"").trim()):"";k&&k.toLowerCase()!==`${L.chapter.toLowerCase()} ${x.chapterNumber}`?_=`# ${L.chapter} ${x.chapterNumber}: ${k}`:_=`# ${L.chapter} ${x.chapterNumber}`}if(O.split(`
`)[0].trim()===_)continue;let $=[/^#+ *(CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter|Chapitre|Kapitel|Capitolo|Captol|PRLOGO|Prlogo|PROLOGUE|Prologue|Prolog|Prologo|Prleg|EPLOGO|Eplogo|EPILOGUE|Epilogue|pilogue|Epilog|Epilogo|Epleg|NOTA DEL AUTOR|Nota del Autor|AUTHOR'?S?\s*NOTE|Author'?s?\s*Note|Note de l'auteur|Nachwort|Nota dell'autore|Nota de l'Autor|Nota do Autor)[^\n]*\n+/gi],U=0;for(;O.length!==U;){U=O.length;for(let k of $)k.lastIndex=0,O=O.replace(k,"");O=O.trim()}O=`${_}

${O}`,I=!0,I&&(await b.updateImportedChapter(x.id,{editedContent:O}),S++)}d.json({totalChapters:v.length,chaptersUpdated:S})}catch(l){console.error("Error normalizing imported manuscript titles:",l),d.status(500).json({error:l.message||"Failed to normalize titles"})}}),e.get("/api/imported-manuscripts/:id/export-markdown",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getImportedManuscript(l);if(!h)return d.status(404).json({error:"Manuscript not found"});let v=await b.getImportedChaptersByManuscript(l),S=O=>O===0?-1e3:O===-1?1e3:O===-2?1001:O,x=[...v].sort((O,I)=>S(O.chapterNumber)-S(I.chapterNumber)).map(O=>O.editedContent||O.originalContent||"").join(`

---

`),w=x.split(/\s+/).filter(Boolean).length;d.json({title:h.title,markdown:x,chapterCount:v.length,totalWords:w})}catch(l){console.error("Error exporting imported manuscript:",l),d.status(500).json({error:l.message||"Failed to export manuscript"})}}),e.post("/api/imported-manuscripts/:id/send-to-translation",async(E,d)=>{try{let l=parseInt(E.params.id),{targetLanguage:h}=E.body;if(!await b.getImportedManuscript(l))return d.status(404).json({error:"Manuscript not found"});let S=await b.getImportedChaptersByManuscript(l);if(S.length===0)return d.status(400).json({error:"No chapters found in manuscript"});let R=I=>I===0?-1e3:I===-1?1e3:I===-2?1001:I,O=[...S].sort((I,_)=>R(I.chapterNumber)-R(_.chapterNumber)).map(I=>I.editedContent||I.originalContent||"").join(`

`).split(/\s+/).filter(Boolean).length;d.json({success:!0,importedManuscriptId:l,totalWords:O,message:"Manuscript ready for translation. Use the Export page to start translation."})}catch(l){console.error("Error sending imported manuscript to translation:",l),d.status(500).json({error:l.message||"Failed to send to translation"})}}),e.post("/api/projects/:projectId/chapters/:chapterNumber/reset-to-pending",async(E,d)=>{try{let l=parseInt(E.params.projectId),h=parseInt(E.params.chapterNumber);if(!await b.getProject(l))return d.status(404).json({error:"Project not found"});let R=(await b.getChaptersByProject(l)).find(x=>x.chapterNumber===h);if(!R)return d.status(404).json({error:"Chapter not found"});await b.updateChapter(R.id,{status:"pending",content:"",wordCount:0}),console.log(`[ResetChapter] Chapter ${h} of project ${l} reset to pending`),d.json({success:!0,message:`Chapter ${h} reset to pending`,chapterId:R.id})}catch(l){console.error("Error resetting chapter:",l),d.status(500).json({error:l.message||"Failed to reset chapter"})}});let f=Z.object({sourceChapterNumber:Z.number().int(),targetChapterNumber:Z.number().int(),separator:Z.string().optional().default(`

* * *

`)});e.post("/api/projects/:projectId/merge-chapters",async(E,d)=>{try{let l=parseInt(E.params.projectId),h=f.safeParse(E.body);if(!h.success)return d.status(400).json({error:h.error.errors});let{sourceChapterNumber:v,targetChapterNumber:S,separator:R}=h.data;if(v===S)return d.status(400).json({error:"Cannot merge a chapter with itself"});let x=await b.getChaptersByProject(l),w=x.find($=>$.chapterNumber===v),O=x.find($=>$.chapterNumber===S);if(!w||!O)return d.status(404).json({error:"One or both chapters not found"});console.log(`[Routes] Creating backups before merge: source=${w.id}, target=${O.id}`);let I=JSON.stringify({operation:"merge",sourceChapterNumber:v,targetChapterNumber:S,timestamp:new Date().toISOString(),totalChaptersBefore:x.length});await b.createChapterBackup({originalChapterId:w.id,projectId:l,chapterNumber:w.chapterNumber,title:w.title,content:w.content,originalContent:w.originalContent,wordCount:w.wordCount,status:w.status,summary:w.summary,sceneBreakdown:w.sceneBreakdown,editorFeedback:w.editorFeedback,qualityScore:w.qualityScore,operation:"merge",operationDetails:I}),await b.createChapterBackup({originalChapterId:O.id,projectId:l,chapterNumber:O.chapterNumber,title:O.title,content:O.content,originalContent:O.originalContent,wordCount:O.wordCount,status:O.status,summary:O.summary,sceneBreakdown:O.sceneBreakdown,editorFeedback:O.editorFeedback,qualityScore:O.qualityScore,operation:"merge",operationDetails:I}),console.log("[Routes] Backups created successfully");let _=`${O.content||""}${R}${w.content||""}`,N=_.split(/\s+/).filter($=>$.length>0).length;await b.updateChapter(O.id,{content:_,wordCount:N,summary:`${O.summary||""} [Fusionado con cap\xEDtulo ${v}]`}),await b.deleteChapter(w.id);let P=v<=0,L=[];if(!P&&v>0){L=(await b.getChaptersByProject(l)).filter(U=>U.chapterNumber>v&&U.chapterNumber>0).sort((U,k)=>U.chapterNumber-k.chapterNumber);for(let U of L){let k=U.chapterNumber-1;await b.updateChapter(U.id,{chapterNumber:k,title:U.title?.replace(/^(Captulo|Chapter)\s+\d+/i,`Cap\xEDtulo ${k}`)})}}let j=await b.getChaptersByProject(l);console.log(`[Routes] Merge complete: ${x.length} -> ${j.length} chapters`),await b.createActivityLog({projectId:l,level:"info",agentRole:"system",message:`Capitulos fusionados: ${v} -> ${S}. ${L.length} capitulos renumerados. Backups creados.`}),d.json({success:!0,message:`Cap\xEDtulo ${v} fusionado con ${S}`,newWordCount:N,chaptersRenumbered:L.length,backupsCreated:2})}catch(l){console.error("[Routes] Error merging chapters:",l),d.status(500).json({error:"Failed to merge chapters"})}}),e.get("/api/projects/:projectId/chapter-backups",async(E,d)=>{try{let l=parseInt(E.params.projectId),h=await b.getChapterBackupsByProject(l);d.json(h)}catch(l){console.error("[Routes] Error getting chapter backups:",l),d.status(500).json({error:"Failed to get chapter backups"})}}),e.post("/api/chapter-backups/:backupId/restore",async(E,d)=>{try{let l=parseInt(E.params.backupId),h=await b.getChapterBackup(l);if(!h)return d.status(404).json({error:"Backup not found"});if(h.restoredAt)return d.status(400).json({error:"This backup has already been restored"});let S=(await b.getChaptersByProject(h.projectId)).find(R=>R.chapterNumber===h.chapterNumber);S?(console.log(`[Routes] Creating backup of conflicting chapter ${S.id} before restore`),await b.createChapterBackup({originalChapterId:S.id,projectId:S.projectId,chapterNumber:S.chapterNumber,title:S.title,content:S.content,originalContent:S.originalContent,wordCount:S.wordCount,status:S.status,summary:S.summary,sceneBreakdown:S.sceneBreakdown,editorFeedback:S.editorFeedback,qualityScore:S.qualityScore,operation:"restore_overwrite",operationDetails:JSON.stringify({restoringBackupId:l,timestamp:new Date().toISOString()})}),await b.updateChapter(S.id,{title:h.title,content:h.content,originalContent:h.originalContent,wordCount:h.wordCount,status:h.status||"completed",summary:h.summary,sceneBreakdown:h.sceneBreakdown,editorFeedback:h.editorFeedback,qualityScore:h.qualityScore}),console.log(`[Routes] Restored backup ${l} to existing chapter ${S.id}`)):(await b.createChapter({projectId:h.projectId,chapterNumber:h.chapterNumber,title:h.title,content:h.content,originalContent:h.originalContent,wordCount:h.wordCount??0,status:h.status||"completed",summary:h.summary,sceneBreakdown:h.sceneBreakdown,editorFeedback:h.editorFeedback,qualityScore:h.qualityScore}),console.log(`[Routes] Created new chapter from backup ${l}`)),await b.markBackupRestored(l),await b.createActivityLog({projectId:h.projectId,level:"info",agentRole:"system",message:`Cap\xEDtulo ${h.chapterNumber} restaurado desde backup (ID: ${l})`}),d.json({success:!0,message:`Cap\xEDtulo ${h.chapterNumber} restaurado exitosamente`,restoredChapterNumber:h.chapterNumber})}catch(l){console.error("[Routes] Error restoring chapter backup:",l),d.status(500).json({error:"Failed to restore chapter backup"})}});let g=Z.object({content:Z.string().min(1,"Content cannot be empty")});e.put("/api/chapters/:chapterId",async(E,d)=>{try{let l=parseInt(E.params.chapterId),h=g.safeParse(E.body);if(!h.success)return d.status(400).json({error:h.error.errors});let{content:v}=h.data,S=await M.select().from(Er).where(q(Er.id,l)).limit(1);if(S.length===0)return d.status(404).json({error:"Chapter not found"});let R=S[0],x=v.trim().split(/\s+/).filter(O=>O.length>0).length,w=R.originalContent||R.content;await b.updateChapter(l,{content:v,wordCount:x,originalContent:w}),console.log(`[ManualEdit] Chapter ${l} updated manually, ${x} words`),d.json({success:!0,chapterId:l,wordCount:x,message:"Chapter content saved successfully"})}catch(l){console.error("Error updating chapter content:",l),d.status(500).json({error:l.message||"Failed to update chapter"})}}),e.get("/api/chapters/:chapterId/annotations",async(E,d)=>{try{let l=parseInt(E.params.chapterId),h=await M.select().from(Ba).where(q(Ba.chapterId,l)).orderBy(Ba.startOffset);d.json(h)}catch(l){console.error("Error fetching annotations:",l),d.status(500).json({error:l.message||"Failed to fetch annotations"})}}),e.post("/api/chapters/:chapterId/annotations",async(E,d)=>{try{let l=parseInt(E.params.chapterId),h=await M.select().from(Er).where(q(Er.id,l)).limit(1);if(h.length===0)return d.status(404).json({error:"Chapter not found"});let S=Z.object({startOffset:Z.number().min(0),endOffset:Z.number().min(0),annotationType:Z.enum(["error","suggestion","note"]).default("error"),content:Z.string().optional(),note:Z.string().optional()}).safeParse(E.body);if(!S.success)return d.status(400).json({error:S.error.errors});let{startOffset:R,endOffset:x,annotationType:w,content:O,note:I}=S.data,[_]=await M.insert(Ba).values({chapterId:l,projectId:h[0].projectId,startOffset:R,endOffset:x,annotationType:w,content:O||null,note:I||null,resolved:!1}).returning();console.log(`[Annotation] Created annotation for chapter ${l}: ${w}`),d.json(_)}catch(l){console.error("Error creating annotation:",l),d.status(500).json({error:l.message||"Failed to create annotation"})}}),e.patch("/api/annotations/:annotationId/resolve",async(E,d)=>{try{let l=parseInt(E.params.annotationId),[h]=await M.update(Ba).set({resolved:!0,resolvedAt:B`CURRENT_TIMESTAMP`}).where(q(Ba.id,l)).returning();if(!h)return d.status(404).json({error:"Annotation not found"});d.json(h)}catch(l){console.error("Error resolving annotation:",l),d.status(500).json({error:l.message||"Failed to resolve annotation"})}}),e.delete("/api/annotations/:annotationId",async(E,d)=>{try{let l=parseInt(E.params.annotationId);await M.delete(Ba).where(q(Ba.id,l)),d.json({success:!0})}catch(l){console.error("Error deleting annotation:",l),d.status(500).json({error:l.message||"Failed to delete annotation"})}});let y=Z.object({instructions:Z.string().min(10,"Instructions must be at least 10 characters"),newTitle:Z.string().optional()});e.post("/api/projects/:projectId/chapters/:chapterNumber/rewrite",async(E,d)=>{try{let l=parseInt(E.params.projectId),h=parseInt(E.params.chapterNumber),v=y.safeParse(E.body);if(!v.success)return d.status(400).json({error:v.error.errors});let{instructions:S,newTitle:R}=v.data,x=await b.getProject(l);if(!x)return d.status(404).json({error:"Project not found"});if(x.status==="generating")return d.status(400).json({error:"Cannot rewrite while project is generating"});let w=await b.getChaptersByProject(l),O=w.find(V=>V.chapterNumber===h);if(!O)return d.status(404).json({error:"Chapter not found"});let I=await b.getWorldBibleByProject(l),_=w.find(V=>V.chapterNumber===h-1),N=w.find(V=>V.chapterNumber===h+1);d.json({message:"Rewrite started",projectId:l,chapterNumber:h,originalWordCount:O.wordCount});let{GhostwriterAgent:P}=await Promise.resolve().then(()=>(fm(),Ey)),L=new P,j={numero:h,titulo:R||O.title||`Cap\xEDtulo ${h}`,cronologia:"Mantener cronolog\xEDa del cap\xEDtulo original",ubicacion:"Mantener ubicaci\xF3n del cap\xEDtulo original",elenco_presente:[],objetivo_narrativo:"Mejorar seg\xFAn instrucciones",beats:["Reescribir cap\xEDtulo completo seg\xFAn instrucciones de mejora"]},$=x.styleGuideId?await b.getStyleGuide(x.styleGuideId):null,U=I?{characters:I.characters,timeline:I.timeline,worldRules:I.worldRules,plotOutline:I.plotOutline}:{},k=await L.execute({chapterNumber:h,chapterData:j,worldBible:U,guiaEstilo:$?.content||"Estilo literario de calidad bestseller",previousContinuity:_?.continuityState?JSON.stringify(_.continuityState):void 0,refinementInstructions:`
INSTRUCCIONES DE REESCRITURA:
${S}

CONTENIDO ORIGINAL A MEJORAR:
${O.content}

IMPORTANTE:
- Mant\xE9n la esencia de la trama y los personajes
- Aplica las mejoras indicadas
- Expande el texto si es necesario (m\xEDnimo 2000 palabras)
- Mant\xE9n coherencia con cap\xEDtulos anteriores y posteriores
- El nuevo t\xEDtulo debe ser: "${R||O.title}"
`,isRewrite:!0});if(k.content){let{cleanContent:V,continuityState:Q}=L.extractContinuityState(k.content),te=V.split(/\s+/).filter(Boolean).length;await b.updateChapter(O.id,{content:V,title:R||O.title,wordCount:te,continuityState:Q||O.continuityState}),await b.createThoughtLog({projectId:l,chapterId:O.id,agentName:"Ghostwriter Rewrite",agentRole:"ghostwriter-rewrite",thoughtContent:`Rewrite instructions: ${S.substring(0,200)}... | Tokens: ${JSON.stringify(k.tokenUsage||{})}`});let F=await b.getProject(l);F&&await b.updateProject(l,{totalInputTokens:(F.totalInputTokens||0)+(k.tokenUsage?.inputTokens||0),totalOutputTokens:(F.totalOutputTokens||0)+(k.tokenUsage?.outputTokens||0),totalThinkingTokens:(F.totalThinkingTokens||0)+(k.tokenUsage?.thinkingTokens||0)}),console.log(`[Rewrite] Chapter ${h} rewritten: ${O.wordCount} -> ${te} words`)}}catch(l){console.error("Error rewriting chapter:",l)}}),e.post("/api/projects/:id/normalize-titles",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getProject(l);if(!h)return d.status(404).json({error:"Project not found"});let v=await b.getChaptersByProject(l),S=[],R=N=>N.replace(/\w\S*/g,P=>P.charAt(0).toUpperCase()+P.substr(1).toLowerCase()),x=(N,P,L,j="es")=>{if(!N||N.trim()==="")return{normalized:N,headerFixed:!1};let $=N.trim(),U=!1,k="";if(P===0)k=L&&L!=="Pr\xF3logo"?`# Pr\xF3logo: ${L}`:"# Pr\xF3logo";else if(P===-1)k=L&&L!=="Ep\xEDlogo"?`# Ep\xEDlogo: ${L}`:"# Ep\xEDlogo";else if(P===-2)k=L&&L!=="Nota del Autor"?`# Nota del Autor: ${L}`:"# Nota del Autor";else{let F=L?R(L.replace(/^Captulo\s*\d+\s*:?\s*/i,"").trim()):"";F&&F.toLowerCase()!==`cap\xEDtulo ${P}`.toLowerCase()?k=`# Cap\xEDtulo ${P}: ${F}`:k=`# Cap\xEDtulo ${P}`}if($.split(`
`)[0].trim()===k)return{normalized:$,headerFixed:!1};let Q=[/^#+ *(CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter|PRLOGO|Prlogo|PROLOGUE|Prologue|EPLOGO|Eplogo|EPILOGUE|Epilogue|NOTA DEL AUTOR|Nota del Autor|AUTHOR'?S?\s*NOTE|Author'?s?\s*Note)[^\n]*\n+/gi],te=0;for(;$.length!==te;){te=$.length;for(let F of Q)F.lastIndex=0,$.match(F)&&($=$.replace(F,""),U=!0);$=$.trim()}return $=`${k}

${$}`,U=!0,{normalized:$,headerFixed:U}},w=(N,P)=>{if(!N)return null;let L=[/^#+ *(?:CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter)\s*\d+\s*[:-]\s*([^\n]+)/mi,/^#+ *(?:CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter)\s*\d+[^\n]*?\n+#*\s*([^\n]+)/mi,/^#+ *(?:CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter)[^\n]*\n+\*\*([^*\n]+)\*\*/mi,/^([A-Z][^\n]{3,50})\n/m];for(let j of L){let $=N.match(j);if($&&$[1]){let U=$[1].trim().replace(/^#+\s*/,"").replace(/\*\*/g,"").trim();if(!U.match(/^Captulo\s*\d+$/i)&&!U.match(/^Cap\s*\d+$/i)&&!U.match(/^Chapter\s*\d+$/i)&&U.length>2&&U.length<100)return U}}return null},O=async(N,P)=>{if(!N||N.length<200)return null;try{let L=N.substring(0,2e3),j=await fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.DEEPSEEK_API_KEY}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"Eres un experto en t\xEDtulos de cap\xEDtulos de novelas. Tu tarea es generar un t\xEDtulo corto, evocador y atractivo (m\xE1ximo 5 palabras) bas\xE1ndote en el contenido del cap\xEDtulo. Responde SOLO con el t\xEDtulo, sin explicaciones ni formato."},{role:"user",content:`Genera un t\xEDtulo para este cap\xEDtulo:

${L}`}],temperature:.7,max_tokens:50})});if(!j.ok)return console.error(`[NormalizeTitles] API error: ${j.status}`),null;let U=(await j.json()).choices?.[0]?.message?.content?.trim();if(U&&U.length>2&&U.length<100)return R(U.replace(/["']/g,"").trim())}catch(L){console.error("[NormalizeTitles] Error generating title:",L)}return null},{generateMissing:I=!1}=E.body||{},_=0;for(let N of v){let P=N.title||"",L=P,j=!1;if((!P||P.match(/^Captulo\s*\d+$/i)||P==="Pr\xF3logo"||P==="Ep\xEDlogo"||P==="Nota del Autor")&&N.content){let V=w(N.content,N.chapterNumber);if(V)L=V,console.log(`[NormalizeTitles] Cap ${N.chapterNumber}: Extracted title "${V}"`);else if(I&&N.chapterNumber>0){let Q=await O(N.content,N.chapterNumber);Q&&(L=Q,j=!0,_++,console.log(`[NormalizeTitles] Cap ${N.chapterNumber}: Generated title "${Q}"`))}}N.chapterNumber>0&&L&&!L.match(/^Captulo\s*\d+$/i)&&(L=R(L));let{normalized:U,headerFixed:k}=x(N.content||"",N.chapterNumber,L);(P!==L||k)&&(await b.updateChapter(N.id,{title:L,content:U}),S.push({chapterId:N.id,chapterNumber:N.chapterNumber,oldTitle:P,generated:j,newTitle:L,headerFixed:k}))}d.json({success:!0,projectId:l,projectTitle:h.title,chaptersUpdated:S.length,titlesGenerated:_,totalChapters:v.length,updates:S})}catch(l){console.error("Error normalizing chapter titles:",l),d.status(500).json({error:"Failed to normalize chapter titles"})}}),e.get("/api/extended-guides",async(E,d)=>{try{let l=await b.getAllExtendedGuides();d.json(l)}catch(l){console.error("Error fetching extended guides:",l),d.status(500).json({error:"Failed to fetch extended guides"})}}),e.get("/api/extended-guides/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getExtendedGuide(l);if(!h)return d.status(404).json({error:"Extended guide not found"});d.json(h)}catch(l){console.error("Error fetching extended guide:",l),d.status(500).json({error:"Failed to fetch extended guide"})}}),e.post("/api/extended-guides/upload",Hm.single("file"),async(E,d)=>{try{if(!E.file)return d.status(400).json({error:"No file uploaded"});let h=(await Wu.default.extractRawText({buffer:E.file.buffer})).value.trim();if(!h)return d.status(400).json({error:"El archivo est\xE1 vac\xEDo o no se pudo extraer el texto"});let v=E.body.title||E.file.originalname.replace(/\.docx?$/i,""),S=E.body.description||null,R=await b.createExtendedGuide({title:v,description:S,originalFileName:E.file.originalname,content:h,wordCount:h.split(/\s+/).length});d.status(201).json(R)}catch(l){console.error("Error uploading extended guide:",l),d.status(500).json({error:"Failed to upload extended guide"})}}),e.patch("/api/extended-guides/:id",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getExtendedGuide(l))return d.status(404).json({error:"Extended guide not found"});let v={};E.body.title!==void 0&&(v.title=E.body.title),E.body.description!==void 0&&(v.description=E.body.description);let S=await b.updateExtendedGuide(l,v);d.json(S)}catch(l){console.error("Error updating extended guide:",l),d.status(500).json({error:"Failed to update extended guide"})}}),e.delete("/api/extended-guides/:id",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getExtendedGuide(l))return d.status(404).json({error:"Extended guide not found"});await b.deleteExtendedGuide(l),d.status(204).send()}catch(l){console.error("Error deleting extended guide:",l),d.status(500).json({error:"Failed to delete extended guide"})}}),e.get("/api/queue/state",async(E,d)=>{try{let l=await b.getQueueState();l||(l=await b.updateQueueState({status:"stopped"})),d.json(l)}catch(l){console.error("Error fetching queue state:",l),d.status(500).json({error:"Failed to fetch queue state"})}}),e.patch("/api/queue/state",async(E,d)=>{try{let l=await b.updateQueueState(E.body);d.json(l)}catch(l){console.error("Error updating queue state:",l),d.status(500).json({error:"Failed to update queue state"})}}),e.get("/api/queue",async(E,d)=>{try{let l=await b.getQueueItems(),h=await Promise.all(l.map(async v=>{let S=await b.getProject(v.projectId);return{...v,project:S}}));d.json(h)}catch(l){console.error("Error fetching queue:",l),d.status(500).json({error:"Failed to fetch queue"})}}),e.post("/api/queue",async(E,d)=>{try{let{projectId:l,priority:h}=E.body,v=await b.getProject(l);if(!v)return d.status(404).json({error:"Project not found"});if(await b.getQueueItemByProject(l))return d.status(400).json({error:"Project already in queue"});let R=await b.addToQueue({projectId:l,priority:h||"normal",status:"waiting",position:0});d.status(201).json({...R,project:v})}catch(l){console.error("Error adding to queue:",l),d.status(500).json({error:"Failed to add to queue"})}}),e.delete("/api/queue/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.removeFromQueue(l),d.status(204).send()}catch(l){console.error("Error removing from queue:",l),d.status(500).json({error:"Failed to remove from queue"})}}),e.patch("/api/queue/:id/reorder",async(E,d)=>{try{let l=parseInt(E.params.id),{newPosition:h}=E.body;if(typeof h!="number"||h<1)return d.status(400).json({error:"Invalid position"});await b.reorderQueue(l,h);let v=await b.getQueueItems();d.json(v)}catch(l){console.error("Error reordering queue:",l),d.status(500).json({error:"Failed to reorder queue"})}}),e.patch("/api/queue/:id",async(E,d)=>{try{let l=parseInt(E.params.id),{priority:h,status:v}=E.body,S={};h&&(S.priority=h),v&&(S.status=v);let R=await b.updateQueueItem(l,S);d.json(R)}catch(l){console.error("Error updating queue item:",l),d.status(500).json({error:"Failed to update queue item"})}}),e.post("/api/queue/:id/urgent",async(E,d)=>{try{let l=parseInt(E.params.id);await b.reorderQueue(l,1),await b.updateQueueItem(l,{priority:"urgent"});let h=await b.getQueueItems();d.json(h)}catch(l){console.error("Error making urgent:",l),d.status(500).json({error:"Failed to make urgent"})}}),e.post("/api/queue/skip-current",async(E,d)=>{try{await wa.skipCurrent(),d.json({success:!0})}catch(l){console.error("Error skipping current:",l),d.status(500).json({error:"Failed to skip current"})}}),e.post("/api/queue/start",async(E,d)=>{try{await wa.start();let l=await wa.getState();d.json(l)}catch(l){console.error("Error starting queue:",l),d.status(500).json({error:"Failed to start queue"})}}),e.post("/api/queue/stop",async(E,d)=>{try{await wa.stop();let l=await wa.getState();d.json(l)}catch(l){console.error("Error stopping queue:",l),d.status(500).json({error:"Failed to stop queue"})}}),e.post("/api/queue/pause",async(E,d)=>{try{await wa.pause();let l=await wa.getState();d.json(l)}catch(l){console.error("Error pausing queue:",l),d.status(500).json({error:"Failed to pause queue"})}}),e.post("/api/queue/resume",async(E,d)=>{try{await wa.resume();let l=await wa.getState();d.json(l)}catch(l){console.error("Error resuming queue:",l),d.status(500).json({error:"Failed to resume queue"})}}),e.get("/api/series/:id/milestones",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getMilestonesBySeries(l);d.json(h)}catch(l){console.error("Error fetching milestones:",l),d.status(500).json({error:"Failed to fetch milestones"})}}),e.post("/api/series/:id/milestones",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.createMilestone({...E.body,seriesId:l});d.status(201).json(h)}catch(l){console.error("Error creating milestone:",l),d.status(500).json({error:"Failed to create milestone"})}}),e.patch("/api/milestones/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.updateMilestone(l,E.body);d.json(h)}catch(l){console.error("Error updating milestone:",l),d.status(500).json({error:"Failed to update milestone"})}}),e.delete("/api/milestones/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteMilestone(l),d.status(204).send()}catch(l){console.error("Error deleting milestone:",l),d.status(500).json({error:"Failed to delete milestone"})}}),e.get("/api/series/:id/threads",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getPlotThreadsBySeries(l);d.json(h)}catch(l){console.error("Error fetching plot threads:",l),d.status(500).json({error:"Failed to fetch plot threads"})}}),e.post("/api/series/:id/threads",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.createPlotThread({...E.body,seriesId:l});d.status(201).json(h)}catch(l){console.error("Error creating plot thread:",l),d.status(500).json({error:"Failed to create plot thread"})}}),e.patch("/api/threads/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.updatePlotThread(l,E.body);d.json(h)}catch(l){console.error("Error updating plot thread:",l),d.status(500).json({error:"Failed to update plot thread"})}}),e.delete("/api/threads/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deletePlotThread(l),d.status(204).send()}catch(l){console.error("Error deleting plot thread:",l),d.status(500).json({error:"Failed to delete plot thread"})}}),e.get("/api/series/:id/verifications",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getArcVerificationsBySeries(l);d.json(h)}catch(l){console.error("Error fetching verifications:",l),d.status(500).json({error:"Failed to fetch verifications"})}}),e.post("/api/series/:id/verifications",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.createArcVerification({...E.body,seriesId:l});d.status(201).json(h)}catch(l){console.error("Error creating verification:",l),d.status(500).json({error:"Failed to create verification"})}}),e.patch("/api/verifications/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.updateArcVerification(l,E.body);d.json(h)}catch(l){console.error("Error updating verification:",l),d.status(500).json({error:"Failed to update verification"})}}),e.post("/api/series/:id/verify-project",async(E,d)=>{try{let l=parseInt(E.params.id),{projectId:h}=E.body;if(!h)return d.status(400).json({error:"projectId is required"});let v=await b.getProject(h);if(!v)return d.status(404).json({error:"Project not found"});let S=await b.getSeries(l);if(!S)return d.status(404).json({error:"Series not found"});let R=await b.getChaptersByProject(h),x=await b.getWorldBibleByProject(h),w=await b.getMilestonesBySeries(l),O=await b.getPlotThreadsBySeries(l),I=R.sort((U,k)=>U.chapterNumber-k.chapterNumber),_=I.length,N=I.filter(U=>U.content&&U.content.length>50),P=I.map(U=>{let k=U.chapterNumber===0?"Pr\xF3logo":U.chapterNumber===-1?"Ep\xEDlogo":`Cap\xEDtulo ${U.chapterNumber}`,V=U.title?`: ${U.title}`:"",Q=U.wordCount||U.content?.split(/\s+/).length||0;if(!U.content||U.content.length<50)return`${k}${V}
[Sin contenido - ${U.status||"pending"}]`;let te=U.content.substring(0,8e3),F=U.content.length>8e3;return`${k}${V} (${Q} palabras)
${te}${F?`
[...contenido truncado para verificaci\xF3n...]`:""}`}).join(`

---

`);console.log(`[Arc Verification] Building summary: ${_} chapters, ${N.length} with content`);let{ArcValidatorAgent:L}=await Promise.resolve().then(()=>(iI(),H2)),$=await new L().execute({projectTitle:v.title,seriesTitle:S.title,volumeNumber:v.seriesOrder||1,totalVolumes:S.totalPlannedBooks||10,chaptersSummary:P,milestones:w,plotThreads:O,worldBible:x||{}});if($.result){let U=await b.createArcVerification({seriesId:l,projectId:h,volumeNumber:v.seriesOrder||1,status:$.result.passed?"passed":"needs_attention",overallScore:$.result.overallScore,milestonesChecked:$.result.milestonesChecked,milestonesFulfilled:$.result.milestonesFulfilled,threadsProgressed:$.result.threadsProgressed,threadsResolved:$.result.threadsResolved,findings:JSON.stringify($.result.findings),recommendations:$.result.recommendations});for(let k of $.result.milestoneVerifications)k.isFulfilled&&await b.updateMilestone(k.milestoneId,{isFulfilled:!0,fulfilledInProjectId:h,fulfilledInChapter:k.fulfilledInChapter,verificationNotes:k.verificationNotes});for(let k of $.result.threadProgressions)k.currentStatus!=="active"&&await b.updatePlotThread(k.threadId,{status:k.currentStatus,resolvedVolume:k.resolvedInVolume?v.seriesOrder:void 0,resolvedChapter:k.resolvedInChapter});d.json({verification:U,result:$.result,tokensUsed:{input:$.inputTokens||0,output:$.outputTokens||0}})}else d.status(500).json({error:"Verification failed to produce results"})}catch(l){console.error("Error executing arc verification:",l),d.status(500).json({error:"Failed to execute arc verification"})}}),e.post("/api/series/:id/apply-corrections",async(E,d)=>{try{let l=parseInt(E.params.id),{projectId:h,corrections:v}=E.body;if(!h||!v||!v.length)return d.status(400).json({error:"projectId and corrections array required"});if(!await b.getProject(h))return d.status(404).json({error:"Project not found"});if(!await b.getSeries(l))return d.status(404).json({error:"Series not found"});let x=await b.getMilestonesBySeries(l),{CopyEditorAgent:w}=await Promise.resolve().then(()=>(Cy(),oI)),O=new w,I=[],_=2;for(let L of v){let{chapterNumber:j,instruction:$,milestoneId:U}=L,V=(await b.getChaptersByProject(h)).find(J=>J.chapterNumber===j);if(!V){I.push({chapterNumber:j,success:!1,error:"Chapter not found"});continue}let Q=x.find(J=>J.id===U),te=V.content||"",F=!1,ae=0,D=null;for(;!F&&ae<_;){ae++;let J=Q?`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CORRECCI\xD3N OBLIGATORIA DE ARCO ARGUMENTAL - INTENTO ${ae}/${_}
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

HITO QUE DEBE CUMPLIRSE EN ESTE CAP\xCDTULO:
\u2022 Tipo: ${Q.milestoneType}
\u2022 Descripci\xF3n exacta: "${Q.description}"

INSTRUCCIONES IMPERATIVAS:
1. A\xD1ADE una escena o pasaje NUEVO de 3-5 p\xE1rrafos que CUMPLA EXPL\xCDCITAMENTE el hito
2. La escena debe ser NARRATIVA (mostrar, no decir) - di\xE1logos, acciones, descripciones
3. El hito "${Q.description}" debe ser EVIDENTE para cualquier lector
4. MANT\xC9N TODO el contenido original del cap\xEDtulo intacto
5. INTEGRA la nueva escena de forma natural en el flujo narrativo
6. NO cambies el tono, estilo ni la voz narrativa existente

EJEMPLO DE INTEGRACI\xD3N:
- Si el hito es "El protagonista descubre la traici\xF3n de su aliado"
- A\xF1ade una escena donde el protagonista LITERALMENTE descubre pruebas o presencia la traici\xF3n
- No basta con insinuaciones o sospechas - debe ser un MOMENTO CLARO

${ae>1?`
\u26A0\uFE0F ATENCI\xD3N: El intento anterior NO cumpli\xF3 el hito. Esta vez:
- S\xE9 M\xC1S EXPL\xCDCITO en mostrar el hito
- Usa DI\xC1LOGOS DIRECTOS que evidencien el cumplimiento
- Aseg\xFArate de que el momento sea INEQU\xCDVOCO
`:""}

CRITERIO DE VERIFICACI\xD3N: El texto resultante debe contener un momento narrativo claro donde "${Q.description}" OCURRA de manera expl\xEDcita.
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`:`
CORRECCI\xD3N DE ARCO ARGUMENTAL:
${$}

A\xF1ade contenido narrativo expl\xEDcito que cumpla este requisito, manteniendo todo el contenido original.
`,W=await O.execute({chapterContent:te,chapterNumber:j,chapterTitle:V.title||`Cap\xEDtulo ${j}`,guiaEstilo:J});if(D=W,W.result?.texto_final){let de=W.result.texto_final;if(Q){let ne=de.toLowerCase(),oe=Q.description.toLowerCase().split(/\s+/).filter(Ie=>Ie.length>4),ce=oe.filter(Ie=>ne.includes(Ie)),se=oe.length>0?ce.length/oe.length:0,Y=de.length>te.length*1.02;F=se>=.4&&Y,console.log(`[ArcCorrection] Attempt ${ae}: wordCoverage=${se.toFixed(2)}, contentGrew=${Y}, passed=${F}`)}else F=!0;te=de}else break}D?.result?.texto_final?(await b.updateChapter(V.id,{content:te,status:"completed"}),U&&Q&&await b.updateMilestone(U,{isFulfilled:F,fulfilledInProjectId:h,fulfilledInChapter:j,verificationNotes:F?`Corregido y verificado (${ae} intentos)`:`Corregido pero requiere verificaci\xF3n manual (${ae} intentos)`}),I.push({chapterNumber:j,success:!0,verified:F,attempts:ae,tokensUsed:{input:D.inputTokens||0,output:D.outputTokens||0}})):I.push({chapterNumber:j,success:!1,error:"Editor failed"})}let N=I.filter(L=>L.success&&L.verified).length,P=I.filter(L=>L.success).length;d.json({results:I,totalCorrected:P,verified:N,needsReview:P-N,message:`${P} correcciones aplicadas, ${N} verificadas autom\xE1ticamente`})}catch(l){console.error("Error applying arc corrections:",l),d.status(500).json({error:"Failed to apply arc corrections"})}}),e.post("/api/series/:id/structural-rewrite",async(E,d)=>{try{let l=parseInt(E.params.id),{projectId:h,chapterNumbers:v,structuralInstructions:S}=E.body;if(!h||!v?.length||!S)return d.status(400).json({error:"projectId, chapterNumbers array, and structuralInstructions required"});let R=await b.getProject(h);if(!R)return d.status(404).json({error:"Project not found"});if(!await b.getSeries(l))return d.status(404).json({error:"Series not found"});let w=await b.getWorldBibleByProject(h),O=R.styleGuideId?await b.getStyleGuide(R.styleGuideId):null,{GhostwriterAgent:I}=await Promise.resolve().then(()=>(fm(),Ey)),_=new I,N=[];for(let L of v){let $=(await b.getChaptersByProject(h)).find(te=>te.chapterNumber===L);if(!$){N.push({chapterNumber:L,success:!1,error:"Chapter not found"});continue}let U=L===0?"Pr\xF3logo":L===-1?"Ep\xEDlogo":`Cap\xEDtulo ${L}`,k={numero:L,titulo:$.title||U,cronologia:"Mantener la cronolog\xEDa existente",ubicacion:"Mantener las ubicaciones existentes",elenco_presente:[],objetivo_narrativo:S,beats:[`REESCRITURA ESTRUCTURAL: ${S}`,"Mantener los personajes y sus arcos existentes","Expandir las escenas para MOSTRAR los eventos en lugar de CONTAR","Desarrollar el cl\xEDmax narrativo con tensi\xF3n dram\xE1tica","Asegurar que todos los hitos del arco se cumplan expl\xEDcitamente"],funcion_estructural:"Reescritura para cumplir requisitos estructurales del arco de la serie"},V=O?.content||`
Estilo: Prosa profesional de bestseller internacional
Tono: ${R.tone||"Dram\xE1tico y envolvente"}
G\xE9nero: ${R.genre||"Ficci\xF3n literaria"}

INSTRUCCIONES ESPECIALES DE REESCRITURA:
${S}

CONTENIDO ORIGINAL DEL CAP\xCDTULO (para referencia y expansi\xF3n):
${$.content?.substring(0,15e3)||"Sin contenido previo"}
`;console.log(`[StructuralRewrite] Rewriting ${U} with instructions: ${S.substring(0,100)}...`);let Q=await _.execute({chapterNumber:L,chapterData:k,worldBible:w||{},guiaEstilo:V,isRewrite:!0});if(Q.result?.prose){let te=Q.result.prose;await b.updateChapter($.id,{content:te,status:"completed",wordCount:te.split(/\s+/).length}),N.push({chapterNumber:L,success:!0,wordCount:te.split(/\s+/).length,tokensUsed:{input:Q.inputTokens||0,output:Q.outputTokens||0}}),console.log(`[StructuralRewrite] ${U} rewritten successfully`)}else N.push({chapterNumber:L,success:!1,error:"Ghostwriter failed to produce content"})}let P=N.filter(L=>L.success).length;d.json({results:N,totalRewritten:P,message:`${P} cap\xEDtulos reescritos estructuralmente`})}catch(l){console.error("Error in structural rewrite:",l),d.status(500).json({error:"Failed to perform structural rewrite"})}}),e.post("/api/series/:id/analyze-threads",async(E,d)=>{try{let l=parseInt(E.params.id),{projectId:h,autoApply:v}=E.body;if(!h)return d.status(400).json({error:"projectId is required"});let S=await b.getProject(h);if(!S)return d.status(404).json({error:"Project not found"});let R=await b.getSeries(l);if(!R)return d.status(404).json({error:"Series not found"});let x=await b.getChaptersByProject(h),w=await b.getWorldBibleByProject(h),O=await b.getMilestonesBySeries(l),I=await b.getPlotThreadsBySeries(l),_=x.filter($=>$.content&&$.content.length>100);if(_.length===0)return d.status(400).json({error:"No chapters with content to analyze"});let{SeriesThreadFixerAgent:N}=await Promise.resolve().then(()=>(hm(),U2)),P=new N;console.log(`[ThreadFixer] Analyzing ${_.length} chapters for project ${h}`);let L=await P.execute({projectTitle:S.title,seriesTitle:R.title,volumeNumber:S.seriesOrder||1,totalVolumes:R.totalPlannedBooks||10,chapters:_.map($=>({id:$.id,chapterNumber:$.chapterNumber,title:$.title||"",content:$.content||""})),milestones:O,plotThreads:I,worldBible:w||{}});if(!L.result)return d.status(500).json({error:"Thread analysis failed"});let j=[];if(v&&L.result.autoFixRecommendation==="safe_to_autofix"&&L.result.fixes.length>0){let{CopyEditorAgent:$}=await Promise.resolve().then(()=>(Cy(),oI)),U=new $;for(let k of L.result.fixes.filter(V=>V.priority==="critical"||V.priority==="important")){let V=_.find(te=>te.id===k.chapterId);if(!V)continue;let Q=`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
CORRECCI\xD3N AUTOM\xC1TICA DE HILO/HITO NARRATIVO
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

TIPO DE CORRECCI\xD3N: ${k.fixType}
ELEMENTO: ${k.threadOrMilestoneName}
PRIORIDAD: ${k.priority}
PUNTO DE INSERCI\xD3N: ${k.insertionPoint}

RAZ\xD3N: ${k.rationale}

${k.insertionPoint==="replace"&&k.originalPassage?`
PASAJE ORIGINAL A REEMPLAZAR:
"${k.originalPassage}"
`:""}

TEXTO SUGERIDO A INTEGRAR:
${k.suggestedRevision}

INSTRUCCIONES:
- Integra el texto sugerido de forma org\xE1nica en el flujo narrativo
- Mant\xE9n la voz y estilo del autor
- Si es "replace", sustituye el pasaje original
- Si es "beginning/middle/end", inserta en el punto apropiado
- El resultado debe leerse como prosa fluida, no como un parche

NOTA IMPORTANTE: No extiendas ni modifiques otras partes del cap\xEDtulo. Solo aplica la correcci\xF3n indicada.
`;try{let te=await U.execute({chapterNumber:V.chapterNumber,chapterTitle:V.title||`Cap\xEDtulo ${V.chapterNumber}`,chapterContent:V.content+`

`+Q,guiaEstilo:`G\xE9nero: ${S.genre}, Tono: ${S.tone}`});te.result?.texto_final&&(await b.updateChapter(V.id,{content:te.result.texto_final,status:"completed"}),j.push({chapterId:k.chapterId,chapterNumber:k.chapterNumber,fixType:k.fixType,threadOrMilestoneName:k.threadOrMilestoneName,success:!0}),console.log(`[ThreadFixer] Applied ${k.fixType} for "${k.threadOrMilestoneName}" in chapter ${k.chapterNumber}`))}catch(te){console.error("[ThreadFixer] Failed to apply fix:",te),j.push({chapterId:k.chapterId,chapterNumber:k.chapterNumber,fixType:k.fixType,success:!1,error:String(te)})}}}d.json({analysis:L.result,appliedFixes:j,totalFixesApplied:j.filter($=>$.success).length,tokensUsed:{input:L.inputTokens||0,output:L.outputTokens||0}})}catch(l){console.error("Error analyzing threads:",l),d.status(500).json({error:"Failed to analyze threads"})}}),e.get("/api/data-export",async(E,d)=>{try{let[l,h,v,S,R,x,w,O,I,_,N,P,L]=await Promise.all([b.getAllProjects(),b.getAllChapters(),b.getAllWorldBibles(),b.getAllPseudonyms(),b.getAllStyleGuides(),b.getAllExtendedGuides(),b.getAllSeries(),b.getAllContinuitySnapshots(),b.getAllThoughtLogs(),b.getAllTranslations(),b.getAllReeditProjects(),b.getAllReeditChapters(),b.getAllAiUsageEvents()]);d.json({exportedAt:new Date().toISOString(),version:"2.0",data:{pseudonyms:S,styleGuides:R,extendedGuides:x,series:w,projects:l,chapters:h,worldBibles:v,continuitySnapshots:O,thoughtLogs:I,translations:_,reeditProjects:N,reeditChapters:P,aiUsageEvents:L}})}catch(l){console.error("Error exporting data:",l),d.status(500).json({error:"Failed to export data"})}}),e.post("/api/data-import",async(E,d)=>{try{let{data:l,sourceUrl:h}=E.body,v=l;if(h&&!l){let j=await fetch(h);if(!j.ok)return d.status(400).json({error:"Failed to fetch from source URL"});v=(await j.json()).data}if(!v)return d.status(400).json({error:"No data provided. Send { data: {...} } or { sourceUrl: '...' }"});let S=(j,$=["id","createdAt"])=>{let U={...j};for(let k of $)delete U[k];return U},R=["id","createdAt","status","currentChapter"],x=["id","createdAt","status","currentStage","processedChapters","currentChapter","totalInputTokens","totalOutputTokens","totalThinkingTokens"],w=["id","createdAt","updatedAt"],O=["id","updatedAt"],I={imported:{},errors:[]},_=new Map,N=new Map;if(v.pseudonyms?.length)for(let j of v.pseudonyms)try{let $=j.id,U=await b.createPseudonym(S(j));_.set($,U.id),I.imported.pseudonyms=(I.imported.pseudonyms||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"pseudonyms",error:$.message})}if(v.styleGuides?.length)for(let j of v.styleGuides)try{await b.createStyleGuide(S(j)),I.imported.styleGuides=(I.imported.styleGuides||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"styleGuides",error:$.message})}if(v.extendedGuides?.length)for(let j of v.extendedGuides)try{let $=S(j);await b.createExtendedGuide($),I.imported.extendedGuides=(I.imported.extendedGuides||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"extendedGuides",error:$.message})}if(v.series?.length)for(let j of v.series)try{let $=j.id,U=S(j);U.pseudonymId&&_.has(U.pseudonymId)&&(U.pseudonymId=_.get(U.pseudonymId));let k=await b.createSeries(U);N.set($,k.id),I.imported.series=(I.imported.series||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"series",error:$.message})}let P=new Map;if(v.projects?.length)for(let j of v.projects)try{let $=j.id,U=S(j,R);U.seriesId&&N.has(U.seriesId)&&(U.seriesId=N.get(U.seriesId)),U.pseudonymId&&_.has(U.pseudonymId)&&(U.pseudonymId=_.get(U.pseudonymId));let k=await b.createProject(U);P.set($,k.id),I.imported.projects=(I.imported.projects||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"projects",error:$.message})}if(v.chapters?.length)for(let j of v.chapters)try{let $=S(j);$.projectId&&P.has($.projectId)&&($.projectId=P.get($.projectId)),await b.createChapter($),I.imported.chapters=(I.imported.chapters||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"chapters",error:$.message})}if(v.worldBibles?.length)for(let j of v.worldBibles)try{let $=S(j,O);$.projectId&&P.has($.projectId)&&($.projectId=P.get($.projectId)),await b.createWorldBible($),I.imported.worldBibles=(I.imported.worldBibles||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"worldBibles",error:$.message})}if(v.translations?.length)for(let j of v.translations)try{let $=S(j);$.projectId&&P.has($.projectId)&&($.projectId=P.get($.projectId)),await b.createTranslation($),I.imported.translations=(I.imported.translations||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"translations",error:$.message})}let L=new Map;if(v.reeditProjects?.length)for(let j of v.reeditProjects)try{let $=j.id,U=S(j,x),k=await b.createReeditProject(U);L.set($,k.id),I.imported.reeditProjects=(I.imported.reeditProjects||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"reeditProjects",error:$.message})}if(v.reeditChapters?.length)for(let j of v.reeditChapters)try{let $=S(j);$.projectId&&L.has($.projectId)&&($.projectId=L.get($.projectId)),await b.createReeditChapter($),I.imported.reeditChapters=(I.imported.reeditChapters||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"reeditChapters",error:$.message})}if(v.aiUsageEvents?.length)for(let j of v.aiUsageEvents)try{let $=S(j);$.projectId&&P.has($.projectId)&&($.projectId=P.get($.projectId)),await b.createAiUsageEvent($),I.imported.aiUsageEvents=(I.imported.aiUsageEvents||0)+1}catch($){$.message?.includes("duplicate")||I.errors.push({table:"aiUsageEvents",error:$.message})}d.json({success:!0,message:"Import completed",results:I})}catch(l){console.error("Error importing data:",l),d.status(500).json({error:"Failed to import data"})}}),e.get("/api/projects/:id/export-markdown",async(E,d)=>{try{let l=parseInt(E.params.id),h=E.query.version||"corrected",v=await b.getProject(l);if(!v)return d.status(404).json({error:"Project not found"});let S=await b.getChaptersByProject(l);if(S.length===0)return d.status(400).json({error:"No chapters found in project"});let R=S.some($=>$.originalContent);if(h==="original"&&!R)return d.status(400).json({error:"No hay manuscrito original guardado. El snapshot se crea al ejecutar Detect & Fix."});let x=v.workType==="bookbox"&&v.bookboxStructure?.books?.length>0,w=v.bookboxStructure,O=[...S].sort(($,U)=>{let k=V=>{if(V===0)return-1e3;if(V===-1)return 1e5;if(V===-2)return 100001;if(x&&V<=-1e3&&V>-2e3){let Q=Math.floor((-V-1e3)/10);return(w?.books?.find(F=>F.bookNumber===Q)?.startChapter||0)-.9}if(x&&V<=-2e3){let Q=Math.floor((-V-2e3)/10);return(w?.books?.find(F=>F.bookNumber===Q)?.endChapter||0)+.1}return V};return k($.chapterNumber)-k(U.chapterNumber)}),I=$=>{let U=$.trim(),k="---CONTINUITY_STATE---";U.includes(k)&&(U=U.split(k)[0].trim()),U=U.replace(/\n*```json[\s\S]*?```\n*/g,`
`),U=U.replace(/\n*\{[\s\S]*?"characterStates"[\s\S]*?\}\s*$/g,""),U=U.replace(/^#+ *(CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter|Prlogo|Prologue|Eplogo|Epilogue|Nota del Autor|Author'?s? Note)[^\n]*\n+/i,"");let V=[/CONTEXTO DEL MUNDO \(World Bible\):[\s\S]*?(?=\n\n[A-Z]|\n\n[A-Z])/gi,/GUA DE ESTILO:[\s\S]*?(?=\n\n[A-Z]|\n\n[A-Z])/gi,/{10,}[\s\S]*?{10,}/g,/[^\n]*\n/g,/[^\n]*\n/g,/ESTADO DE CONTINUIDAD[^\n]*:?[\s\S]*?(?=\n\n[A-Z]|\n\n[A-Z]|$)/gi,/TAREA ACTUAL:[\s\S]*?(?=\n\n[A-Z]|\n\n[A-Z])/gi,/DATOS BSICOS:[\s\S]*?(?=\n\n[A-Z]|\n\n[A-Z])/gi,/BEATS NARRATIVOS[\s\S]*?(?=\n\n[A-Z]|\n\n[A-Z])/gi,/INSTRUCCIONES DE REESCRITURA[\s\S]*?(?=\n\n[A-Z]|\n\n[A-Z])/gi];for(let F of V)U=U.replace(F,"");let Q=U.split(`
`);return U=Q.filter(F=>{let ae=F.trim();return ae?!(ae.startsWith("- Cronolog\xEDa:")||ae.startsWith("- Ubicaci\xF3n:")||ae.startsWith("- Elenco:")||ae.match(/^Captulo \d+ -/i)&&Q.indexOf(F)<5||ae.match(/^CAPTULO \d+ -/i)&&Q.indexOf(F)<5):!0}).join(`
`),U=U.replace(/\n{4,}/g,`


`),U.trim()},_=[];_.push(`# ${v.title}`),_.push("");let N=$=>!x||!w?.books?null:w.books.find(U=>$>=U.startChapter&&$<=U.endChapter),P=null;for(let $ of O){let U=h==="original"&&$.originalContent||$.content;if(!U)continue;if(x&&w?.books){let V=null;if($.chapterNumber>0)V=N($.chapterNumber)||null;else if($.chapterNumber<=-1e3&&$.chapterNumber>-2e3){let Q=Math.floor((-$.chapterNumber-1e3)/10);V=w.books.find(te=>te.bookNumber===Q)||null}else if($.chapterNumber<=-2e3){let Q=Math.floor((-$.chapterNumber-2e3)/10);V=w.books.find(te=>te.bookNumber===Q)||null}V&&V.bookNumber!==P&&(P=V.bookNumber,_.push(""),_.push("---"),_.push(""),_.push(`# ${V.title}`),_.push(""))}let k;if($.chapterNumber===0)k=`Pr\xF3logo${$.title?`: ${$.title}`:""}`;else if($.chapterNumber===-1)k=`Ep\xEDlogo${$.title?`: ${$.title}`:""}`;else if($.chapterNumber===-2)k="Nota del Autor";else if($.chapterNumber<=-1e3&&$.chapterNumber>-2e3)k=`Pr\xF3logo${$.title?`: ${$.title}`:""}`;else if($.chapterNumber<=-2e3)k=`Ep\xEDlogo${$.title?`: ${$.title}`:""}`;else if(x){let V=N($.chapterNumber);V?k=`Cap\xEDtulo ${$.chapterNumber-V.startChapter+1}${$.title?`: ${$.title}`:""}`:k=`Cap\xEDtulo ${$.chapterNumber}${$.title?`: ${$.title}`:""}`}else k=`Cap\xEDtulo ${$.chapterNumber}${$.title?`: ${$.title}`:""}`;_.push(`## ${k}`),_.push(""),_.push(I(U)),_.push("")}let L=_.join(`
`),j=O.reduce(($,U)=>{let k=h==="original"&&U.originalContent||U.content;return $+(k?k.split(/\s+/).length:0)},0);d.json({projectId:l,title:v.title,version:h,versionLabel:h==="original"?"Manuscrito Original (Pre-Correcci\xF3n)":"Manuscrito Corregido",chapterCount:O.filter($=>h==="original"&&$.originalContent||$.content).length,totalWords:j,markdown:L})}catch(l){console.error("Error exporting project markdown:",l),d.status(500).json({error:"Failed to export project"})}}),e.get("/api/projects/:id/translate-stream",async(E,d)=>{let l=parseInt(E.params.id),h=E.query.targetLanguage,v=E.query.sourceLanguage||"es";d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.setHeader("X-Accel-Buffering","no");let S=(_,N)=>{d.write(`event: ${_}
data: ${JSON.stringify(N)}

`)},R=setInterval(()=>{try{d.write(`:heartbeat

`)}catch{console.log("[Translation] Heartbeat failed, connection likely closed"),clearInterval(R)}},8e3),x=()=>{clearInterval(R)};E.on("close",x);let w=await b.getProject(l);if(!w){S("error",{error:"Project not found"}),x(),d.end();return}let[O]=await M.select().from(Be).where(q(Be.projectId,l)).limit(1);if(!O||O.status!=="approved"){S("error",{error:"El proyecto debe tener un manuscrito auditado y aprobado antes de poder traducirlo. Por favor, ejecuta primero el auditor y aprueba las correcciones."}),x(),d.end();return}console.log(`[Translation] Project ${l} has approved manuscript, proceeding with translation`);let I=null;try{I=(await b.createTranslation({projectId:l,source:"original",projectTitle:w.title,sourceLanguage:v,targetLanguage:h,status:"translating",chaptersTranslated:0,totalWords:0,markdown:"",inputTokens:0,outputTokens:0})).id,console.log(`[Translation] Initialized repository record ID ${I}`)}catch(_){console.error("Error creating initial translation record:",_)}try{if(console.log(`[Translation] Starting translation for project ${l}: ${v} -> ${h}`),!h){S("error",{error:"targetLanguage is required"}),x(),d.end();return}console.log(`[Translation] Fetching chapters for project ${l}...`);let _=await b.getChaptersByProject(l);if(_.length===0){S("error",{error:"No chapters found in project"}),x(),d.end();return}console.log(`[Translation] Found ${_.length} chapters`);let P=[..._].sort((oe,ce)=>{let se=oe.chapterNumber===0?-1e3:oe.chapterNumber===-1?1e3:oe.chapterNumber===-2?1001:oe.chapterNumber,Y=ce.chapterNumber===0?-1e3:ce.chapterNumber===-1?1e3:ce.chapterNumber===-2?1001:ce.chapterNumber;return se-Y}).filter(oe=>oe.content&&oe.content.trim().length>0),L=P.length;console.log(`[Translation] ${L} chapters with content ready for translation`),S("start",{projectTitle:w.title,totalChapters:L,sourceLanguage:v,targetLanguage:h}),I&&(await b.updateTranslation(I,{heartbeatAt:new Date}),console.log(`[Translation] Initial heartbeat set for record ${I}`)),console.log("[Translation] Initializing TranslatorAgent...");let{TranslatorAgent:j}=await Promise.resolve().then(()=>(Mm(),cb)),$=new j;console.log("[Translation] TranslatorAgent initialized, starting translation loop...");let U=async(oe,ce=3)=>{let se=null;for(let Y=1;Y<=ce;Y++){try{let Ie=await $.execute(oe);if(Ie.result&&Ie.result.translated_text&&Ie.result.translated_text.length>50)return Ie;console.warn(`[Translation] Attempt ${Y}: Empty or short result, retrying...`)}catch(Ie){se=Ie,console.error(`[Translation] Attempt ${Y} failed:`,Ie)}if(Y<ce){let Ie=Math.min(1e3*Math.pow(2,Y),1e4);console.log(`[Translation] Waiting ${Ie}ms before retry...`),await new Promise(Je=>setTimeout(Je,Ie))}}return console.error(`[Translation] All ${ce} attempts failed`),{result:null,error:se?.message||"Translation failed after retries"}},k=[],V=0,Q=0,te=0;for(let oe of P){let ce=oe.chapterNumber===0?"Pr\xF3logo":oe.chapterNumber===-1?"Ep\xEDlogo":oe.chapterNumber===-2?"Nota del Autor":`Cap\xEDtulo ${oe.chapterNumber}`;if(S("progress",{current:te+1,total:L,chapterNumber:oe.chapterNumber,chapterTitle:oe.title||ce,status:"translating"}),I)try{let Y=te+1;await b.updateTranslation(I,{chaptersTranslated:Y,status:"translating"}),console.log(`[Translation] Progress updated for record ID ${I}: ${Y}/${L}`)}catch(Y){console.error("[Translation] Progress DB update failed:",Y)}console.log(`[Translate] Translating ${ce}: ${oe.title}`);let se=await U({content:oe.content||"",sourceLanguage:v,targetLanguage:h,chapterTitle:oe.title||void 0,chapterNumber:oe.chapterNumber,projectId:l});if(se.result&&se.result.translated_text?(k.push({chapterNumber:oe.chapterNumber,title:oe.title||ce,translatedContent:se.result.translated_text,notes:se.result.notes||""}),te++):(console.error(`[Translate] Chapter ${oe.chapterNumber} failed permanently, skipping`),S("chapterError",{chapterNumber:oe.chapterNumber,chapterTitle:oe.title||ce,error:se.error||"Translation failed after multiple retries"})),V+=se.inputTokens||0,Q+=se.outputTokens||0,S("progress",{current:te,total:L,chapterNumber:oe.chapterNumber,chapterTitle:oe.title||ce,status:"completed",inputTokens:V,outputTokens:Q}),I)try{let Y=k.map(Ie=>Ie.translatedContent).join(`

---

`);await b.updateTranslation(I,{chaptersTranslated:te,markdown:Y,status:"translating"}),console.log(`[Translation] Progress updated for record ID ${I}: ${te}/${L} chapters, ${Y.length} chars of markdown saved`)}catch(Y){console.error("[Translation] Progress DB update failed:",Y)}}let F=oe=>{let ce=oe,se=[/^#+ *Literary Style Guide[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|Prologue|Epilogue|Author['']?s? Note)\b|\n---\n|$)/gm,/^#+ *Writing Guide[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|Prologue|Epilogue|Author['']?s? Note)\b|\n---\n|$)/gm,/^#+ *The Master of[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|Prologue|Epilogue|Author['']?s? Note)\b|\n---\n|$)/gm,/^#+ *Gua de Estilo[^\n]*\n[\s\S]*?(?=^#+ *(?:CAPTULO|Captulo|Prlogo|Eplogo|Nota del Autor)\b|\n---\n|$)/gmi,/^#+ *Gua de Escritura[^\n]*\n[\s\S]*?(?=^#+ *(?:CAPTULO|Captulo|Prlogo|Eplogo|Nota del Autor)\b|\n---\n|$)/gmi,/^###+ *Checklist[^\n]*\n[\s\S]*?(?=^#{1,2} *(?:CHAPTER|Chapter|CAPTULO|Captulo|Prologue|Prlogo|Epilogue|Eplogo)\b|\n---\n|$)/gmi,/\n---\n[\s\S]*?(?:Style Guide|Gua de Estilo|Writing Guide|Gua de Escritura)[\s\S]*?\n---\n/gi];for(let Ie of se)ce=ce.replace(Ie,"");let Y=[/^#+ *\d+\. *(?:Narrative Architecture|Character Construction|Central Themes|Language and Stylistic|Tone and Atmosphere)[^\n]*\n[\s\S]*?(?=^#+ *(?:CHAPTER|Chapter|CAPTULO|Captulo|Prologue|Prlogo)\b|$)/gmi];for(let Ie of Y)ce=ce.replace(Ie,"");return ce.trim()},ae=(oe,ce,se)=>{let Y={es:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota del Autor",chapter:"Cap\xEDtulo"},en:{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},"en-US":{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},"en-GB":{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},fr:{prologue:"Prologue",epilogue:"\xC9pilogue",authorNote:"Note de l'Auteur",chapter:"Chapitre"},de:{prologue:"Prolog",epilogue:"Epilog",authorNote:"Anmerkung des Autors",chapter:"Kapitel"},it:{prologue:"Prologo",epilogue:"Epilogo",authorNote:"Nota dell'Autore",chapter:"Capitolo"},pt:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota do Autor",chapter:"Cap\xEDtulo"},ca:{prologue:"Pr\xF2leg",epilogue:"Ep\xEDleg",authorNote:"Nota de l'Autor",chapter:"Cap\xEDtol"}},Ie=Y[se]||Y.en,Je=[/^(CHAPTER|Chapter|CAPTULO|Captulo|CHAPITRE|Chapitre|KAPITEL|Kapitel|CAPITOLO|Capitolo|CAPTOL|Captol)\s*(\d+)\s*[:\-]?\s*/i];for(let xe of Je){let xt=oe.match(xe);if(xt){let Sr=parseInt(xt[2],10),Re=oe.slice(xt[0].length).trim();return`${Ie.chapter} ${Sr}${Re?`: ${Re}`:""}`}}if(/^(PROLOGUE|Prologue|PRLOGO|Prlogo|PROLOG|Prolog|PROLOGO|Prologo|PRLEG|Prleg)\s*[:\-]?\s*/i.test(oe)){let xe=oe.replace(/^(PROLOGUE|Prologue|PRLOGO|Prlogo|PROLOG|Prolog|PROLOGO|Prologo|PRLEG|Prleg)\s*[:\-]?\s*/i,"").trim();return xe?`${Ie.prologue}: ${xe}`:Ie.prologue}if(/^(EPILOGUE|Epilogue|EPLOGO|Eplogo|EPILOG|Epilog|EPILOGO|Epilogo|EPLEG|Epleg)\s*[:\-]?\s*/i.test(oe)){let xe=oe.replace(/^(EPILOGUE|Epilogue|EPLOGO|Eplogo|EPILOG|Epilog|EPILOGO|Epilogo|EPLEG|Epleg)\s*[:\-]?\s*/i,"").trim();return xe?`${Ie.epilogue}: ${xe}`:Ie.epilogue}return/^(AUTHOR'?S?\s*NOTE|Author'?s?\s*Note|NOTA\s*DEL?\s*AUTOR|Nota\s*del?\s*Autor|NOTE\s*DE\s*L'AUTEUR|Note\s*de\s*l'Auteur|ANMERKUNG\s*DES\s*AUTORS|Anmerkung\s*des\s*Autors|NOTA\s*DELL'?AUTORE|Nota\s*dell'?Autore|NOTA\s*DE\s*L'AUTOR|Nota\s*de\s*l'Autor)\s*[:\-]?\s*/i.test(oe)?Ie.authorNote:oe},D=(oe,ce,se)=>{let Y=oe.trim(),Ie=Y.match(/^```(?:json|markdown|md)?\s*([\s\S]*?)```\s*$/);if(Ie&&(Y=Ie[1].trim()),Y=Y.replace(/```(?:json|markdown|md|text)?\n?/g,"").replace(/```\s*$/g,""),Y.startsWith("{")&&Y.includes('"translated_text"'))try{let ht=JSON.parse(Y);ht.translated_text&&(Y=ht.translated_text)}catch{let ht=Y.match(/"translated_text"\s*:\s*"([\s\S]*?)(?:"\s*,\s*"(?:source_|target_|notes)|\s*"\s*})/);ht&&(Y=ht[1].replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\"))}Y=F(Y);let Je=Y.match(/^(#{1,4})\s*(.+?)\n+/),xe=Y,xt=null;if(Je){let ht=Je[2].trim();xt=ae(ht,ce,se);let vt=Y.slice(Je[0].length).trim();vt.length>50?xe=vt:xt=null}let Sr=/^#{1,4}\s*(CHAPTER|Chapter|CAPTULO|Captulo|CHAPITRE|Chapitre|KAPITEL|Kapitel|CAPITOLO|Capitolo|CAPTOL|Captol|Prologue|PROLOGUE|Prlogo|PRLOGO|Prolog|PROLOG|Prologo|PROLOGO|Prleg|PRLEG|Epilogue|EPILOGUE|Eplogo|EPLOGO|Epilog|EPILOG|Epilogo|EPILOGO|Epleg|EPLEG|Author'?s?\s*Note|AUTHOR'?S?\s*NOTE|Nota\s*del?\s*Autor|NOTA\s*DEL?\s*AUTOR|Note\s*de\s*l'Auteur|NOTE\s*DE\s*L'AUTEUR|Anmerkung\s*des\s*Autors|ANMERKUNG\s*DES\s*AUTORS|Nota\s*dell'?Autore|NOTA\s*DELL'?AUTORE|Nota\s*de\s*l'Autor|NOTA\s*DE\s*L'AUTOR)[^\n]*\n+/i;for(let ht=0;ht<3;ht++){let vt=xe,Se=xe.replace(Sr,"");if(Se.trim().length>50&&Se!==vt)xe=Se;else break}let Re=/^#{1,4}\s*\d+\s*[:\-]?\s*[^\n]*\n+/i,ct=xe.replace(Re,"");ct.trim().length>50&&(xe=ct.trim()),xe=xe.replace(/\n*[-*=]{3,}\s*$/,"").trim(),xe=xe.replace(/\n[-*=]{3,}\n/g,`

`).trim(),xe=xe.replace(/^[-*=]{3,}\n+/,"").trim();let rt=/^#{1,4}\s*(Captulo\s*\d+|CAPTULO\s*\d+|Prlogo|PRLOGO|Eplogo|EPLOGO|Nota\s*del\s*Autor|NOTA\s*DEL\s*AUTOR)[^\n]*\n+/gim,Nt=xe.replace(rt,"");return Nt.trim().length>50&&(xe=Nt.trim()),{heading:xt,body:xe}},J=[];J.push(`# ${w.title}`),J.push("");let W={es:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota del Autor",chapter:"Cap\xEDtulo"},en:{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},"en-US":{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},"en-GB":{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},fr:{prologue:"Prologue",epilogue:"\xC9pilogue",authorNote:"Note de l'Auteur",chapter:"Chapitre"},de:{prologue:"Prolog",epilogue:"Epilog",authorNote:"Anmerkung des Autors",chapter:"Kapitel"},it:{prologue:"Prologo",epilogue:"Epilogo",authorNote:"Nota dell'Autore",chapter:"Capitolo"},pt:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota do Autor",chapter:"Cap\xEDtulo"},ca:{prologue:"Pr\xF2leg",epilogue:"Ep\xEDleg",authorNote:"Nota de l'Autor",chapter:"Cap\xEDtol"}},de=W[h]||W.en;for(let oe of k){let ce=D(oe.translatedContent,oe.chapterNumber,h),se;ce.heading?se=ce.heading:oe.chapterNumber===0?se=`${de.prologue}${oe.title?`: ${oe.title}`:""}`:oe.chapterNumber===-1?se=`${de.epilogue}${oe.title?`: ${oe.title}`:""}`:oe.chapterNumber===-2?se=de.authorNote:se=`${de.chapter} ${oe.chapterNumber}${oe.title?`: ${oe.title}`:""}`,J.push(`## ${se}`),J.push(""),J.push(ce.body),J.push("")}let ne=J.join(`
`),le=ne.split(/\s+/).filter(oe=>oe.length>0).length;S("saving",{message:"Guardando traducci\xF3n..."});try{let oe;if(I)oe=await b.updateTranslation(I,{status:"completed",chaptersTranslated:k.length,totalWords:le,markdown:ne,inputTokens:V,outputTokens:Q}),console.log(`[Translation] Finalized repository record ID ${I}`);else{let ce=await b.findExistingTranslation(l,h);ce?oe=await b.updateTranslation(ce.id,{status:"completed",chaptersTranslated:k.length,totalWords:le,markdown:ne,inputTokens:(ce.inputTokens||0)+V,outputTokens:(ce.outputTokens||0)+Q}):oe=await b.createTranslation({projectId:l,source:"original",projectTitle:w.title,sourceLanguage:v,targetLanguage:h,status:"completed",chaptersTranslated:k.length,totalWords:le,markdown:ne,inputTokens:V,outputTokens:Q})}S("complete",{id:oe?.id,projectId:l,title:w.title,sourceLanguage:v,targetLanguage:h,chaptersTranslated:k.length,totalWords:le,markdown:ne,tokensUsed:{input:V,output:Q},updated:!!I})}catch(oe){console.error("Error saving translation to DB:",oe),I&&await b.updateTranslation(I,{status:"error"}).catch(()=>{}),S("complete",{id:null,projectId:l,title:w.title,sourceLanguage:v,targetLanguage:h,chaptersTranslated:k.length,totalWords:le,markdown:ne,tokensUsed:{input:V,output:Q},warning:"Translation completed but could not save to database. Download available."})}x(),d.end()}catch(_){console.error("Error translating project:",_),S("error",{error:"Failed to translate project"}),x(),d.end()}}),e.get("/api/translations",async(E,d)=>{try{let h=(await b.getAllTranslations()).map(v=>({id:v.id,projectId:v.projectId,projectTitle:v.projectTitle,sourceLanguage:v.sourceLanguage,targetLanguage:v.targetLanguage,chaptersTranslated:v.chaptersTranslated||0,totalWords:v.totalWords,inputTokens:v.inputTokens,outputTokens:v.outputTokens,status:v.status||"completed",createdAt:v.createdAt,heartbeatAt:v.heartbeatAt}));d.json(h)}catch(l){console.error("Error fetching translations:",l),d.status(500).json({error:"Failed to fetch translations"})}}),e.get("/api/translations/:id/download",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getTranslation(l);if(!h)return d.status(404).json({error:"Translation not found"});d.json({id:h.id,projectTitle:h.projectTitle,targetLanguage:h.targetLanguage,markdown:h.markdown})}catch(l){console.error("Error downloading translation:",l),d.status(500).json({error:"Failed to download translation"})}}),e.delete("/api/translations/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteTranslation(l),d.json({success:!0})}catch(l){console.error("Error deleting translation:",l),d.status(500).json({error:"Failed to delete translation"})}}),e.get("/api/translations/:id/resume",async(E,d)=>{let l=parseInt(E.params.id);d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.setHeader("X-Accel-Buffering","no");let h=(R,x)=>{d.write(`event: ${R}
data: ${JSON.stringify(x)}

`)},v=setInterval(()=>{try{d.write(`:heartbeat

`)}catch{clearInterval(v)}},15e3),S=()=>{clearInterval(v)};E.on("close",S);try{let R=await b.getTranslation(l);if(!R){h("error",{error:"Translation not found"}),S(),d.end();return}if(R.status==="completed"){h("error",{error:"Translation is already completed"}),S(),d.end();return}let x=R.projectId,w=R.reeditProjectId,O=R.importedManuscriptId,I=R.source==="imported"||!!O;if(!x&&!w&&!I){h("error",{error:"No project associated with this translation"}),S(),d.end();return}let _=null,N=[],P=!!w&&!x&&!I;if(I){let se=null;if(O&&(se=await b.getImportedManuscript(O)),se||(se=(await b.getAllImportedManuscripts()).find(xt=>xt.title===R.projectTitle)),!se){h("error",{error:"Imported manuscript not found"}),S(),d.end();return}_={title:se.title,language:se.detectedLanguage||"es"};let Y=await b.getImportedChaptersByManuscript(se.id),Ie=xe=>xe===0?-1e3:xe===-1?1e3:xe===-2?1001:xe;N=[...Y].sort((xe,xt)=>Ie(xe.chapterNumber)-Ie(xt.chapterNumber)).filter(xe=>(xe.editedContent||xe.originalContent)?.trim().length>0)}else if(P){if(_=await b.getReeditProject(w),!_){h("error",{error:"Original reedit project not found"}),S(),d.end();return}let se=await b.getReeditChaptersByProject(w),Y=Je=>Je===0?-1e3:Je===-1||Je===998?1e3:Je===-2||Je===999?1001:Je;N=[...se].sort((Je,xe)=>Y(Je.chapterNumber)-Y(xe.chapterNumber)).filter(Je=>(Je.editedContent||Je.originalContent)?.trim().length>0)}else{if(_=await b.getProject(x),!_){h("error",{error:"Original project not found"}),S(),d.end();return}N=[...await b.getChaptersByProject(x)].sort((Ie,Je)=>{let xe=Ie.chapterNumber===0?-1e3:Ie.chapterNumber===-1?1e3:Ie.chapterNumber===-2?1001:Ie.chapterNumber,xt=Je.chapterNumber===0?-1e3:Je.chapterNumber===-1?1e3:Je.chapterNumber===-2?1001:Je.chapterNumber;return xe-xt}).filter(Ie=>Ie.content&&Ie.content.trim().length>0)}let L=R.sourceLanguage,j=R.targetLanguage,$=R.markdown||"",U=N.length,k=0;if($.trim().length>0){let se=$.match(/\n\n---\n\n/g);k=se?se.length+1:1}let V=R.chaptersTranslated||0,Q=Math.min(V,k),te=N.slice(Q);if(console.log(`[Resume] DB counter: ${V}, Markdown chapters: ${k}, Using: ${Q}/${U}, ${te.length} remaining`),te.length===0){await b.updateTranslation(l,{status:"completed"}),h("complete",{id:l,projectId:x||w,title:_.title,sourceLanguage:L,targetLanguage:j,chaptersTranslated:Q,totalWords:R.totalWords,markdown:$,tokensUsed:{input:R.inputTokens,output:R.outputTokens},resumed:!0,message:"All chapters were already translated"}),S(),d.end();return}h("start",{projectTitle:_.title,totalChapters:U,alreadyTranslated:Q,remaining:te.length,sourceLanguage:L,targetLanguage:j,resumed:!0});let{TranslatorAgent:F}=await Promise.resolve().then(()=>(Mm(),cb)),ae=new F,D=async(se,Y=3)=>{let Ie=null;for(let Je=1;Je<=Y;Je++){try{let xe=await ae.execute(se);if(xe.result&&xe.result.translated_text&&xe.result.translated_text.length>50)return xe;console.warn(`[Resume] Attempt ${Je}: Empty or short result, retrying...`)}catch(xe){Ie=xe,console.error(`[Resume] Attempt ${Je} failed:`,xe)}if(Je<Y){let xe=Math.min(1e3*Math.pow(2,Je),1e4);console.log(`[Resume] Waiting ${xe}ms before retry...`),await new Promise(xt=>setTimeout(xt,xe))}}return console.error(`[Resume] All ${Y} attempts failed`),{result:null,error:Ie?.message||"Translation failed after retries"}},J=[],W=R.inputTokens||0,de=R.outputTokens||0,ne=Q;for(let se of te){let Y=se.chapterNumber===0?"Pr\xF3logo":se.chapterNumber===-1?"Ep\xEDlogo":se.chapterNumber===-2?"Nota del Autor":`Cap\xEDtulo ${se.chapterNumber}`;h("progress",{current:ne+1,total:U,chapterNumber:se.chapterNumber,chapterTitle:se.title||Y,status:"translating",resumed:!0}),await b.updateTranslation(l,{chaptersTranslated:ne+1,status:"translating"}),console.log(`[Resume] Translating ${Y}: ${se.title}`);let Ie=P?se.editedContent||se.originalContent||"":se.content||"",Je=await D({content:Ie,sourceLanguage:L,targetLanguage:j,chapterTitle:se.title||void 0,chapterNumber:se.chapterNumber,projectId:x||w});Je.result&&Je.result.translated_text?(J.push({chapterNumber:se.chapterNumber,title:se.title||Y,translatedContent:Je.result.translated_text,notes:Je.result.notes||""}),ne++):(console.error(`[Resume] Chapter ${se.chapterNumber} failed permanently, skipping`),h("chapterError",{chapterNumber:se.chapterNumber,chapterTitle:se.title||Y,error:Je.error||"Translation failed after multiple retries",resumed:!0})),W+=Je.inputTokens||0,de+=Je.outputTokens||0,h("progress",{current:ne,total:U,chapterNumber:se.chapterNumber,chapterTitle:se.title||Y,status:"completed",inputTokens:W,outputTokens:de,resumed:!0});let xe=J.map(Sr=>Sr.translatedContent).join(`

---

`),xt=$?$+`

---

`+xe:xe;await b.updateTranslation(l,{chaptersTranslated:ne,markdown:xt,inputTokens:W,outputTokens:de,status:"translating"})}let le=J.map(se=>se.translatedContent).join(`

---

`),oe=$?$+`

---

`+le:le,ce=oe.split(/\s+/).filter(se=>se.length>0).length;await b.updateTranslation(l,{status:"completed",chaptersTranslated:ne,totalWords:ce,markdown:oe,inputTokens:W,outputTokens:de}),h("complete",{id:l,projectId:x||w,title:_.title,sourceLanguage:L,targetLanguage:j,chaptersTranslated:ne,totalWords:ce,markdown:oe,tokensUsed:{input:W,output:de},resumed:!0,newChaptersTranslated:J.length}),S(),d.end()}catch(R){let x=R instanceof Error?R.message:String(R);console.error("Error resuming translation:",R),h("error",{error:`Error al reanudar traducci\xF3n: ${x}`}),S(),d.end()}}),e.post("/api/translations/v2/start",async(E,d)=>{let{projectId:l,reeditProjectId:h,importedManuscriptId:v,targetLanguage:S}=E.body;d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.setHeader("X-Accel-Buffering","no");let R=(O,I)=>{d.write(`event: ${O}
data: ${JSON.stringify(I)}

`)},x=setInterval(()=>{try{d.write(`:heartbeat

`)}catch{clearInterval(x)}},15e3),w=()=>clearInterval(x);E.on("close",w);try{let O=null,I=[],_="en",N=!!h,P=!!v;if(P){let F=await b.getImportedManuscript(v);if(!F)throw new Error("Imported manuscript not found");O={title:F.title,language:F.detectedLanguage||"es"},I=(await b.getImportedChaptersByManuscript(v)).map(D=>({chapterNumber:D.chapterNumber,title:D.title,content:D.editedContent||D.originalContent||""})),_=F.detectedLanguage||"es"}else if(N){if(O=await b.getReeditProject(h),!O)throw new Error("Reedit project not found");I=(await b.getReeditChaptersByProject(h)).map(ae=>({chapterNumber:ae.chapterNumber,title:ae.title,content:ae.editedContent||ae.originalContent||""})),_=O.language||"es"}else if(l){if(O=await b.getProject(l),!O)throw new Error("Project not found");I=(await b.getChaptersByProject(l)).map(ae=>({chapterNumber:ae.chapterNumber,title:ae.title,content:ae.content||""})),_="es"}else throw new Error("Either projectId, reeditProjectId, or importedManuscriptId is required");let L=F=>F===0?-1e3:F===-1?1e3:F===-2?1001:F,$=[...I].sort((F,ae)=>L(F.chapterNumber)-L(ae.chapterNumber)).map(F=>{let ae=F.chapterNumber===0?"Pr\xF3logo":F.chapterNumber===-1?"Ep\xEDlogo":F.chapterNumber===-2?"Nota del Autor":`Cap\xEDtulo ${F.chapterNumber}`;return`# ${F.title||ae}

${F.content}`}).join(`

---

`),U=$.split(/\s+/).length,k=await b.createTranslation({projectId:P||N?null:l,reeditProjectId:N?h:null,importedManuscriptId:P?v:null,source:P?"imported":N?"reedit":"original",projectTitle:O.title,sourceLanguage:_,targetLanguage:S,chaptersTranslated:0,totalWords:U,markdown:"",status:"analyzing"});R("started",{translationId:k.id,totalWords:U,totalChunks:0});let V=new ob({onStatusChange:(F,ae)=>{R("status",{status:F,message:ae})},onChunkComplete:(F,ae)=>{R("progress",{current:F,total:ae,status:"translating"})},onStrategyReady:F=>{R("strategy",F)},onNativeBetaReaderComplete:F=>{R("native_review",{verdict:F.final_verdict,overallScore:F.overall_score,fluencyScore:F.fluency_score,genreAdherenceScore:F.genre_adherence_score,culturalAdaptationScore:F.cultural_adaptation_score,issuesCount:F.issues?.length||0,correctionsApplied:F.corrections?.length||0,genreFeedback:F.genre_feedback})}}),Q=O.genre||"default",te=await V.startTranslation(k.id,$,_,S,Q);R("complete",{translationId:k.id,projectTitle:O.title,targetLanguage:S,totalWords:U,layoutScore:await b.getTranslation(k.id).then(F=>F?.layoutScore||0),naturalnessScore:await b.getTranslation(k.id).then(F=>F?.naturalnessScore||0),tokens:te.tokens,nativeBetaReaderResult:te.nativeBetaReaderResult?{verdict:te.nativeBetaReaderResult.final_verdict,overallScore:te.nativeBetaReaderResult.overall_score,fluencyScore:te.nativeBetaReaderResult.fluency_score,genreAdherenceScore:te.nativeBetaReaderResult.genre_adherence_score,issuesCount:te.nativeBetaReaderResult.issues?.length||0}:void 0}),w(),d.end()}catch(O){let I=O instanceof Error?O.message:String(O);console.error("Error in LitTranslators 2.0:",O),R("error",{error:I}),w(),d.end()}}),e.get("/api/ai-provider",async(E,d)=>{try{let l=Yw(),h=!!process.env.DEEPSEEK_API_KEY,v=!!process.env.AI_INTEGRATIONS_GEMINI_API_KEY;d.json({current:l,available:{gemini:v,deepseek:h},models:{gemini:{creative:"gemini-3-pro-preview",analysis:"gemini-2.5-flash",fast:"gemini-2.0-flash"},deepseek:{creative:"deepseek-chat (V3)",analysis:"deepseek-reasoner (R1)",fast:"deepseek-chat (V3)"}},pricing:{gemini:{description:"Gemini (Google AI)",creative:"$1.25/$10.0/M tokens",analysis:"$0.15/$0.60/M tokens"},deepseek:{description:"DeepSeek (m\xE1s econ\xF3mico)",creative:"$0.55/$2.19/M tokens (R1)",analysis:"$0.27/$1.10/M tokens (V3)"}}})}catch(l){console.error("Error fetching AI provider info:",l),d.status(500).json({error:"Failed to fetch AI provider info"})}}),e.post("/api/ai-provider",async(E,d)=>{try{let{provider:l}=E.body;if(l!=="gemini"&&l!=="deepseek")return d.status(400).json({error:"Invalid provider. Use 'gemini' or 'deepseek'"});if(l==="deepseek"&&!process.env.DEEPSEEK_API_KEY)return d.status(400).json({error:"DeepSeek API key not configured"});if(l==="gemini"&&!process.env.AI_INTEGRATIONS_GEMINI_API_KEY)return d.status(400).json({error:"Gemini API key not configured"});process.env.AI_PROVIDER=l,console.log(`[AI Provider] Switched to ${l}`),d.json({success:!0,provider:l,message:`Switched to ${l}. All new AI requests will use ${l}.`})}catch(l){console.error("Error setting AI provider:",l),d.status(500).json({error:"Failed to set AI provider"})}}),e.get("/api/ai-usage/summary",async(E,d)=>{try{let l=await b.getAiUsageSummary();d.json(l)}catch(l){console.error("Error fetching AI usage summary:",l),d.status(500).json({error:"Failed to fetch AI usage summary"})}}),e.get("/api/ai-usage/by-agent",async(E,d)=>{try{let l=await b.getAiUsageByAgent();d.json(l)}catch(l){console.error("Error fetching AI usage by agent:",l),d.status(500).json({error:"Failed to fetch AI usage by agent"})}}),e.get("/api/ai-usage/by-day",async(E,d)=>{try{let l=await b.getAiUsageByDay();d.json(l)}catch(l){console.error("Error fetching AI usage by day:",l),d.status(500).json({error:"Failed to fetch AI usage by day"})}}),e.get("/api/ai-usage/by-model",async(E,d)=>{try{let l=await b.getAiUsageByModel();d.json(l)}catch(l){console.error("Error fetching AI usage by model:",l),d.status(500).json({error:"Failed to fetch AI usage by model"})}}),e.get("/api/ai-usage/events",async(E,d)=>{try{let l=await b.getAllAiUsageEvents();d.json(l)}catch(l){console.error("Error fetching AI usage events:",l),d.status(500).json({error:"Failed to fetch AI usage events"})}}),e.get("/api/ai-usage/projects-summary",async(E,d)=>{try{let h=(await b.getAllProjects()).map(v=>({id:v.id,title:v.title,status:v.status,totalInputTokens:v.totalInputTokens||0,totalOutputTokens:v.totalOutputTokens||0,totalThinkingTokens:v.totalThinkingTokens||0,estimatedCostUsd:Fce(v.totalInputTokens||0,v.totalOutputTokens||0,v.totalThinkingTokens||0),createdAt:v.createdAt}));d.json(h)}catch(l){console.error("Error fetching projects summary:",l),d.status(500).json({error:"Failed to fetch projects summary"})}}),e.post("/api/projects/:id/duplicate-chapters/purge",async(E,d)=>{try{let l=parseInt(E.params.id),{chapterNumber:h,generationKey:v,keepGeneration:S}=E.body;if(isNaN(l)||h===void 0||!v)return d.status(400).json({error:"Missing required parameters: projectId, chapterNumber, generationKey"});let R=await b.getProject(l);if(!R)return d.status(404).json({error:"Project not found"});if(R.status==="generating")return d.status(409).json({error:"Cannot purge chapters while project is generating"});let w=(await b.getChaptersByProject(l)).filter(P=>P.chapterNumber===h);if(w.length<2)return d.status(400).json({error:"No duplicates found for this chapter number"});let O={};for(let P of w){let L=new Date(P.createdAt).getTime(),j=new Date(Math.floor(L/5e3)*5e3).toISOString();O[j]||(O[j]=[]),O[j].push(P)}let I=[];if(S)for(let[P,L]of Object.entries(O))P!==v&&I.push(...L.map(j=>j.id));else{let P=O[v];P&&(I=P.map(L=>L.id))}let _=w.length-I.length;if(_<1)return d.status(400).json({error:"Cannot delete all chapters. At least one must remain."});let N=0;for(let P of I)await b.deleteChapter(P),N++;await b.createActivityLog({projectId:l,level:"info",message:`Eliminados ${N} cap\xEDtulos duplicados del cap\xEDtulo ${h} (generaci\xF3n: ${v})`,agentRole:"user"}),console.log(`[DuplicatePurge] Deleted ${N} duplicate chapters for project ${l}, chapter ${h}`),d.json({success:!0,deletedCount:N,remainingCount:_,message:`Eliminados ${N} cap\xEDtulos duplicados`})}catch(l){console.error("Error purging duplicate chapters:",l),d.status(500).json({error:"Failed to purge duplicate chapters"})}});let C=new Map,A=new Map;e.get("/api/writing-lessons",async(E,d)=>{try{let l=await b.getAllWritingLessons();d.json(l)}catch(l){console.error("Error fetching writing lessons:",l),d.status(500).json({error:l.message||"Failed to fetch writing lessons"})}}),e.post("/api/writing-lessons/refresh",async(E,d)=>{try{let{WritingLessonsAgent:l}=await Promise.resolve().then(()=>(Oy(),Ty)),h=new l;d.json({status:"started",message:"Analizando auditor\xEDas para extraer lecciones..."}),h.refreshLessons().then(v=>{console.log(`[WritingLessons] Refresh complete: ${v.created} lessons from ${v.projectsAnalyzed} projects`)}).catch(v=>{console.error("[WritingLessons] Refresh failed:",v)})}catch(l){console.error("Error refreshing writing lessons:",l),d.status(500).json({error:l.message||"Failed to refresh writing lessons"})}}),e.get("/api/writing-lessons/diagnose",async(E,d)=>{try{let{manuscriptAudits:l,reeditAuditReports:h}=await Promise.resolve().then(()=>(ms(),wg)),v=await b.getAllProjects(),S=v.map(w=>{let O=w.finalReviewResult;return{id:w.id,title:w.title,status:w.status,hasFinalReviewResult:!!w.finalReviewResult,finalReviewResultKeys:O?Object.keys(O):[],issuesCount:O?.issues?.length||0,debilidadesCount:O?.justificacion_puntuacion?.debilidades_principales?.length||0,recomendacionesCount:O?.justificacion_puntuacion?.recomendaciones_proceso?.length||0,puntuacionGlobal:O?.puntuacion_global||null,veredicto:O?.veredicto||null}}),R=[];try{R=(await M.select().from(l)).map(O=>{let I=O.continuityReport,_=O.characterReport,N=O.styleReport,P=O.finalAudit;return{id:O.id,projectId:O.projectId,projectTitle:v.find(L=>L.id===O.projectId)?.title||"unknown",status:O.status,overallScore:O.overallScore,criticalFlags:O.criticalFlags,hasContinuityReport:!!I,continuityIssuesCount:I?.issues?.length||0,hasCharacterReport:!!_,characterIssuesCount:_?.issues?.length||0,hasStyleReport:!!N,styleIssuesCount:N?.issues?.length||0,hasFinalAudit:!!P,finalAuditReportsCount:P?.reports?.length||0}})}catch(w){R=[{error:w.message}]}let x=[];try{x=(await M.select().from(h)).map(O=>({id:O.id,projectId:O.projectId,auditType:O.auditType,score:O.score,hasFindingsArray:Array.isArray(O.findings),findingsCount:Array.isArray(O.findings)?O.findings.length:O.findings?Object.keys(O.findings).length:0}))}catch(w){x=[{error:w.message}]}d.json({totalProjects:v.length,projectsWithFinalReview:S.filter(w=>w.issuesCount>0||w.debilidadesCount>0).length,manuscriptAuditsCount:R.length,reeditReportsCount:x.length,projects:S,manuscriptAudits:R,reeditAuditReports:x})}catch(l){d.status(500).json({error:l.message})}}),e.post("/api/writing-lessons/refresh-sync",async(E,d)=>{try{let{WritingLessonsAgent:l}=await Promise.resolve().then(()=>(Oy(),Ty)),v=await new l().refreshLessons();d.json({status:"completed",...v})}catch(l){console.error("Error refreshing writing lessons:",l),d.status(500).json({error:l.message||"Failed to refresh writing lessons"})}}),e.patch("/api/writing-lessons/:id",async(E,d)=>{try{let l=parseInt(E.params.id),{isActive:h}=E.body;if(typeof h!="boolean")return d.status(400).json({error:"isActive must be a boolean"});let v=await b.updateWritingLesson(l,{isActive:h});if(!v)return d.status(404).json({error:"Lesson not found"});d.json(v)}catch(l){console.error("Error updating writing lesson:",l),d.status(500).json({error:l.message||"Failed to update writing lesson"})}}),e.delete("/api/writing-lessons/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteWritingLesson(l),d.json({success:!0})}catch(l){console.error("Error deleting writing lesson:",l),d.status(500).json({error:l.message||"Failed to delete writing lesson"})}});async function T(E){let d=`reedit_${E}_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;return await b.updateReeditProject(E,{generationToken:d}),new po(d)}return e.get("/api/reedit-projects",async(E,d)=>{try{let l=await b.getAllReeditProjects();d.json(l)}catch(l){console.error("Error fetching reedit projects:",l),d.status(500).json({error:"Failed to fetch reedit projects"})}}),e.get("/api/reedit-projects/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Reedit project not found"});d.json(h)}catch(l){console.error("Error fetching reedit project:",l),d.status(500).json({error:"Failed to fetch reedit project"})}}),e.get("/api/reedit-projects/:id/chapters",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditChaptersByProject(l);d.json(h)}catch(l){console.error("Error fetching reedit chapters:",l),d.status(500).json({error:"Failed to fetch reedit chapters"})}}),e.get("/api/reedit-projects/:id/audit-report",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditAuditReportsByProject(l);if(!h||h.length===0)return d.status(404).json({error:"Audit report not found"});d.json(h[0])}catch(l){console.error("Error fetching audit report:",l),d.status(500).json({error:"Failed to fetch audit report"})}}),e.get("/api/reedit-projects/:id/audit-reports",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditAuditReportsByProject(l);d.json(h||[])}catch(l){console.error("Error fetching audit reports:",l),d.status(500).json({error:"Failed to fetch audit reports"})}}),e.get("/api/reedit-projects/:id/quality-report",async(E,d)=>{try{let l=parseInt(E.params.id),h=await bx.generateQualityReport(l);d.json(h)}catch(l){console.error("Error generating quality report:",l),d.status(500).json({error:"Failed to generate quality report"})}}),e.get("/api/reedit-projects/:id/world-bible",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditWorldBibleByProject(l);d.json(h||null)}catch(l){console.error("Error fetching world bible:",l),d.status(500).json({error:"Failed to fetch world bible"})}}),e.get("/api/reedit-projects/:id/forensic-audit",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});d.json({forensicAuditResult:h.forensicAuditResult||null,currentStage:h.currentStage})}catch(l){console.error("Error fetching forensic audit:",l),d.status(500).json({error:"Failed to fetch forensic audit results"})}}),e.get("/api/reedit-projects/:id/beta-reader",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});d.json({betaReaderReport:h.betaReaderReport||null,betaReaderScore:h.betaReaderScore||null,commercialViability:h.commercialViability||null,currentStage:h.currentStage})}catch(l){console.error("Error fetching beta reader results:",l),d.status(500).json({error:"Failed to fetch beta reader results"})}}),e.post("/api/reedit-projects",Hm.single("manuscript"),async(E,d)=>{try{if(!E.file)return d.status(400).json({error:"No file uploaded"});let{title:l,language:h="es",expandChapters:v,insertNewChapters:S,targetMinWordsPerChapter:R,instructions:x}=E.body;if(!l)return d.status(400).json({error:"Title is required"});let O=(await Wu.default.extractRawText({buffer:E.file.buffer})).value;if(!O||O.trim().length<100)return d.status(400).json({error:"Document is too short or empty"});let I=O.trim().split(/\s+/).length,_=await b.createReeditProject({title:l,originalFileName:E.file.originalname||"manuscript.docx",detectedLanguage:h,totalWordCount:I,expandChapters:v==="true",insertNewChapters:S==="true",targetMinWordsPerChapter:parseInt(R)||2e3,architectInstructions:x?.trim()||null}),N=/^(Prlogo|Prologue|Prolog|Prologo|Eplogo|Epilogue|Epilog|Epilogo|Nota\s+de(?:l)?\s+Autor(?:a)?|Author'?s?\s+Note|Note\s+de\s+l'Auteur|Nachwort|Nota\s+dell'Autore|Nota\s+de\s+l'Autor|Captulo\s+\d+|Chapter\s+\d+|Chapitre\s+\d+|Kapitel\s+\d+|Capitolo\s+\d+|Captol\s+\d+)(?:\s*[:\-.]?\s*(.*))?$/gim,P=[],L=O.split(`
`),j=null,$=0;for(let U=0;U<L.length;U++){let V=L[U].trim().match(/^(Prlogo|Prologue|Prolog|Prologo|Eplogo|Epilogue|Epilog|Epilogo|Nota\s+de(?:l)?\s+Autor(?:a)?|Author'?s?\s+Note|Note\s+de\s+l'Auteur|Nachwort|Nota\s+dell'Autore|Nota\s+de\s+l'Autor|Captulo\s+\d+|Chapter\s+\d+|Chapitre\s+\d+|Kapitel\s+\d+|Capitolo\s+\d+|Captol\s+\d+)(?:\s*[:\-.]?\s*(.*))?$/i);if(V){j&&P.push({number:j.number,title:j.title,content:j.lines.join(`
`).trim()});let Q=V[1].toLowerCase(),te;if(Q.includes("pr\xF3logo")||Q.includes("prologue")||Q.includes("prolog")||Q.includes("prologo"))te=0;else if(Q.includes("ep\xEDlogo")||Q.includes("epilogue")||Q.includes("epilog")||Q.includes("epilogo"))te=998;else if(Q.includes("nota")||Q.includes("note")||Q.includes("nachwort"))te=999;else{let D=V[1].match(/\d+/);te=D?parseInt(D[0]):++$}let F=V[2]?.trim()||"",ae=F?`${V[1]}${F?": "+F:""}`:V[1];j={number:te,title:ae,lines:[]}}else j&&j.lines.push(L[U])}if(j&&j.lines.length>0&&P.push({number:j.number,title:j.title,content:j.lines.join(`
`).trim()}),P.length===0)await b.createReeditChapter({projectId:_.id,chapterNumber:0,title:"Full Manuscript",originalContent:O,status:"pending"}),console.log("[Reedit] No chapters detected, treating as single manuscript");else{for(let U of P)await b.createReeditChapter({projectId:_.id,chapterNumber:U.number,title:U.title,originalContent:U.content,status:"pending"});console.log(`[Reedit] Detected ${P.length} chapters in manuscript`)}await b.updateReeditProject(_.id,{totalChapters:P.length||1}),d.json({success:!0,projectId:_.id,title:_.title,wordCount:I,chaptersDetected:P.length||1,message:`Manuscript uploaded successfully. ${P.length||1} chapter(s) detected.`})}catch(l){console.error("Error creating reedit project:",l),d.status(500).json({error:"Failed to create reedit project"})}}),e.post("/api/projects/:id/clone-to-reedit",async(E,d)=>{try{let l=parseInt(E.params.id),{instructions:h,styleGuideId:v,pseudonymId:S}=E.body,R=await b.getProject(l);if(!R)return d.status(404).json({error:"Project not found"});let x=await b.getChaptersByProject(l);if(x.length===0)return d.status(400).json({error:"Project has no chapters to edit"});let w=await b.createReeditProject({title:`${R.title} - Re-edici\xF3n`,originalFileName:`Clonado de proyecto #${l}`,sourceProjectId:l,detectedLanguage:"es",totalChapters:x.length,styleGuideId:v||R.styleGuideId,pseudonymId:S||R.pseudonymId});for(let O of x)await b.createReeditChapter({projectId:w.id,chapterNumber:O.chapterNumber,originalChapterNumber:O.chapterNumber,title:O.title,originalContent:O.content||"",status:"pending",wordCount:O.wordCount||0});h&&await b.updateReeditProject(w.id,{pendingUserInstructions:h}),console.log(`[Reedit] Cloned project ${l} -> reedit project ${w.id} with ${x.length} chapters`),d.json({success:!0,reeditProjectId:w.id,title:w.title,chaptersCloned:x.length,message:`Proyecto clonado exitosamente. ${x.length} cap\xEDtulos listos para re-edici\xF3n.`})}catch(l){console.error("Error cloning project to reedit:",l),d.status(500).json({error:l.message||"Failed to clone project"})}}),e.post("/api/reedit-projects/:id/start",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="processing"){let S=h.heartbeatAt?Date.now()-new Date(h.heartbeatAt).getTime():1/0,R=300*1e3;if(S<R)return d.status(400).json({error:"Project is already being processed"});console.log(`[ReeditStart] Project ${l} appears orphaned (heartbeat ${Math.round(S/1e3)}s ago). Auto-unlocking...`),A.delete(l),await b.updateReeditProject(l,{status:"pending",pauseReason:"Proyecto hu\xE9rfano detectado y reiniciado autom\xE1ticamente",cancelRequested:!1})}let v=await T(l);A.set(l,v),d.json({success:!0,message:"Reedit processing started",projectId:l}),v.processProject(l).finally(()=>{A.delete(l)})}catch(l){console.error("Error starting reedit:",l),d.status(500).json({error:"Failed to start reedit processing"})}}),e.patch("/api/reedit-projects/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=E.body;if(!await b.getReeditProject(l))return d.status(404).json({error:"Project not found"});await b.updateReeditProject(l,h);let S=await b.getReeditProject(l);d.json(S)}catch(l){console.error("Error updating reedit project:",l),d.status(500).json({error:l.message||"Failed to update project"})}}),e.post("/api/reedit-projects/:id/analyze-structure",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="processing"){let S=h.heartbeatAt?Date.now()-new Date(h.heartbeatAt).getTime():1/0,R=300*1e3;if(S<R)return d.status(400).json({error:"Project is already being processed"});console.log(`[AnalyzeStructure] Project ${l} appears orphaned. Auto-unlocking...`),A.delete(l)}await Rx.runFullPipeline(l);let v=await b.getReeditProject(l);d.json({success:!0,projectId:l,structuralReport:v?.structuralReport,reconstructionPlan:v?.reconstructionPlan})}catch(l){console.error("Error analyzing structure:",l),d.status(500).json({error:l.message||"Failed to analyze structure"})}}),e.post("/api/reedit-projects/:id/approve-plan",async(E,d)=>{try{let l=parseInt(E.params.id),{modifiedPlan:h}=E.body,v=await b.getReeditProject(l);if(!v)return d.status(404).json({error:"Project not found"});if(v.currentStage!=="plan_ready")return d.status(400).json({error:"No plan ready for approval"});let S={planApproved:!0};h&&(S.reconstructionPlan=h),await b.updateReeditProject(l,S),d.json({success:!0,message:"Plan approved. Ready to execute.",projectId:l})}catch(l){console.error("Error approving plan:",l),d.status(500).json({error:l.message||"Failed to approve plan"})}}),e.post("/api/reedit-projects/:id/execute-plan",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(!h.planApproved)return d.status(400).json({error:"Plan must be approved before execution"});if(h.status==="processing")return d.status(400).json({error:"Project is already being processed"});d.json({success:!0,message:"Plan execution started",projectId:l}),(async()=>{try{await Rx.executeApprovedPlan(l);let v=await T(l);A.set(l,v),v.processProject(l).finally(()=>{A.delete(l)})}catch(v){console.error("Background plan execution error:",v),await b.updateReeditProject(l,{status:"error",errorMessage:v.message||"Plan execution failed"})}})()}catch(l){console.error("Error executing plan:",l),d.status(500).json({error:l.message||"Failed to execute plan"})}}),e.get("/api/reedit-projects/:id/structural-report",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});d.json({structuralReport:h.structuralReport,reconstructionPlan:h.reconstructionPlan,planApproved:h.planApproved,settingContext:h.settingContext,currentStage:h.currentStage})}catch(l){console.error("Error getting structural report:",l),d.status(500).json({error:l.message||"Failed to get structural report"})}}),e.get("/api/reedit-projects/:id/stream",(E,d)=>{let l=parseInt(E.params.id);d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.flushHeaders(),C.has(l)||C.set(l,new Set),C.get(l).add(d),d.write(`data: ${JSON.stringify({type:"connected",projectId:l})}

`),E.on("close",()=>{C.get(l)?.delete(d),C.get(l)?.size===0&&C.delete(l)})}),e.post("/api/reedit-projects/:id/resume",async(E,d)=>{try{let l=parseInt(E.params.id),{instructions:h}=E.body||{},v=await b.getReeditProject(l);if(!v)return d.status(404).json({error:"Project not found"});if(A.has(l))return d.status(400).json({error:"Project is already being processed"});let S={status:"processing",errorMessage:null};h&&typeof h=="string"&&h.trim()&&(S.pendingUserInstructions=h.trim(),console.log(`[ReeditResume] User provided instructions: "${h.substring(0,100)}..."`)),v.status==="awaiting_instructions"&&(S.nonPerfectFinalReviews=0,console.log("[ReeditResume] Resetting non-perfect counter after user instructions")),await b.updateReeditProject(l,S),console.log(`[ReeditResume] Cleared error state for project ${l}, starting orchestrator...`);let R=await T(l);A.set(l,R),d.json({success:!0,message:"Reedit processing resumed",projectId:l}),console.log(`[ReeditResume] Calling processProject for project ${l}`),R.processProject(l).then(()=>{console.log(`[ReeditResume] processProject completed for project ${l}`)}).catch(x=>{console.error("[ReeditResume] processProject error:",x)}).finally(()=>{A.delete(l)})}catch(l){console.error("Error resuming reedit:",l),d.status(500).json({error:"Failed to resume reedit processing"})}}),e.post("/api/reedit-projects/:id/rerun-final-review",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getReeditProject(l))return d.status(404).json({error:"Project not found"});if(A.has(l))return d.status(400).json({error:"Project is already being processed"});let v=await T(l);A.set(l,v),d.json({success:!0,message:"Re-executing final review with 9+ twice consecutive logic",projectId:l}),console.log(`[RerunFinalReview] Starting final review only for project ${l}`),v.runFinalReviewOnly(l).then(()=>{console.log(`[RerunFinalReview] Completed for project ${l}`)}).catch(S=>{console.error("[RerunFinalReview] Error:",S),b.updateReeditProject(l,{status:"error",errorMessage:S instanceof Error?S.message:"Unknown error"})}).finally(()=>{A.delete(l)})}catch(l){console.error("Error rerunning final review:",l),d.status(500).json({error:"Failed to rerun final review"})}}),e.post("/api/reedit-projects/:id/apply-corrections",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(!h.finalReviewResult)return d.status(400).json({error:"No final review result to apply corrections from"});if(A.has(l))return d.status(400).json({error:"Project is already being processed"});let v=await T(l);A.set(l,v),d.json({success:!0,message:"Applying corrections based on final reviewer feedback",projectId:l}),console.log(`[ApplyCorrections] Starting corrections for project ${l}`),v.applyReviewerCorrections(l).then(()=>{console.log(`[ApplyCorrections] Completed for project ${l}`)}).catch(S=>{console.error("[ApplyCorrections] Error:",S),b.updateReeditProject(l,{status:"error",errorMessage:S instanceof Error?S.message:"Unknown error"})}).finally(()=>{A.delete(l)})}catch(l){console.error("Error applying corrections:",l),d.status(500).json({error:"Failed to apply corrections"})}}),e.post("/api/reedit-projects/:id/sync-chapter-headers",async(E,d)=>{try{let l=parseInt(E.params.id);if(!await b.getReeditProject(l))return d.status(404).json({error:"Project not found"});let v=await b.getReeditChaptersByProject(l),S=0,R=[/^(Captulo|Capitulo|CAPTULO|CAPITULO)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Chapter|CHAPTER)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Chapitre|CHAPITRE)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Capitolo|CAPITOLO)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Kapitel|KAPITEL)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im,/^(Captol|Capitol|CAPTOL|CAPITOL)\s+(\d+|[IVXLCDM]+)\s*[:|-]?\s*([^\n]*)/im],x=/^(prlogo|eplogo|preludio|interludio|epilogue|prologue|prelude|interlude)/i;for(let w of v){if(w.title&&x.test(w.title.trim()))continue;let O={},I=w.title||`Cap\xEDtulo ${w.chapterNumber}`;if(w.originalContent)for(let _ of R){let N=w.originalContent.match(_);if(N){let P=w.originalContent.replace(_,I);P!==w.originalContent&&(O.originalContent=P,console.log(`[SyncHeaders] Chapter ${w.chapterNumber} originalContent: "${N[0].substring(0,40)}..." -> "${I}"`));break}}if(w.editedContent)for(let _ of R){let N=w.editedContent.match(_);if(N){let P=w.editedContent.replace(_,I);P!==w.editedContent&&(O.editedContent=P,console.log(`[SyncHeaders] Chapter ${w.chapterNumber} editedContent: "${N[0].substring(0,40)}..." -> "${I}"`));break}}Object.keys(O).length>0&&(await b.updateReeditChapter(w.id,O),S++)}console.log(`[SyncHeaders] Project ${l}: Updated ${S} chapters`),d.json({success:!0,message:`Sincronizados ${S} cap\xEDtulos`,updatedCount:S,totalChapters:v.length})}catch(l){console.error("Error syncing chapter headers:",l),d.status(500).json({error:"Failed to sync chapter headers"})}}),e.post("/api/reedit-projects/:id/normalize-titles",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});let v=await b.getReeditChaptersByProject(l),S=[],R=O=>O.replace(/\w\S*/g,I=>I.charAt(0).toUpperCase()+I.substr(1).toLowerCase()),x=(O,I,_,N="es")=>{if(!O||O.trim()==="")return{normalized:O,headerFixed:!1};let P=O.trim(),L=!1,j=[/^#+ *(CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter|PRLOGO|Prlogo|PROLOGUE|Prologue|EPLOGO|Eplogo|EPILOGUE|Epilogue|NOTA DEL AUTOR|Nota del Autor|AUTHOR'?S?\s*NOTE|Author'?s?\s*Note)[^\n]*\n+/gi,/^---+\s*\n+/gm],$=0;for(;P.length!==$;){$=P.length;for(let k of j)k.lastIndex=0,P.match(k)&&(P=P.replace(k,""),L=!0);P=P.trim()}let U="";if(I===0)U=_&&_!=="Pr\xF3logo"?`# Pr\xF3logo: ${_}`:"# Pr\xF3logo";else if(I===-1||I===998)U=_&&_!=="Ep\xEDlogo"?`# Ep\xEDlogo: ${_}`:"# Ep\xEDlogo";else if(I===-2||I===999)U=_&&_!=="Nota del Autor"?`# Nota del Autor: ${_}`:"# Nota del Autor";else{let k=_?R(_.replace(/^Captulo\s*\d+\s*:?\s*/i,"").trim()):"";k&&k.toLowerCase()!==`cap\xEDtulo ${I}`.toLowerCase()?U=`# Cap\xEDtulo ${I}: ${k}`:U=`# Cap\xEDtulo ${I}`}return P=`${U}

${P}`,{normalized:P,headerFixed:L}},w=O=>{if(!O)return null;let I=O.match(/^#+ *(?:CHAPTER|CAPTULO|CAP\.?|Captulo|Chapter)\s*\d+\s*[:-]\s*([^\n]+)/mi);if(I&&I[1]){let _=I[1].trim();if(!_.match(/^Captulo\s*\d+$/i)&&_.length>0)return _}return null};for(let O of v){let I=O.title||"",_=I,N=!I||I.match(/^Captulo\s*\d+$/i)||I==="Pr\xF3logo"||I==="Ep\xEDlogo"||I==="Nota del Autor",P=O.editedContent||O.originalContent;if(N&&P){let $=w(P);$&&(_=$)}let{normalized:L,headerFixed:j}=x(P||"",O.chapterNumber,_,h.detectedLanguage||"es");(_!==I||j)&&(await b.updateReeditChapter(O.id,{title:_,editedContent:L}),S.push({chapterId:O.id,chapterNumber:O.chapterNumber,oldTitle:I,newTitle:_,headerFixed:j}))}d.json({success:!0,message:`Normalizados ${S.length} de ${v.length} cap\xEDtulos`,chaptersUpdated:S.length,totalChapters:v.length,details:S})}catch(l){console.error("Error normalizing reedit titles:",l),d.status(500).json({error:"Failed to normalize titles"})}}),e.post("/api/reedit-projects/:id/cancel",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});console.log(`[ReeditCancel] Cancel requested for project ${l}, current status: ${h.status}`),A.has(l)&&(A.delete(l),console.log(`[ReeditCancel] Removed project ${l} from active orchestrators`)),await b.updateReeditProject(l,{cancelRequested:!0,status:"awaiting_instructions",pauseReason:"Cancelado por el usuario. Puedes reanudar cuando quieras."}),console.log(`[ReeditCancel] Project ${l} cancelled and paused`),d.json({success:!0,message:"Proceso cancelado. Puedes reanudar cuando quieras."})}catch(l){console.error("Error cancelling reedit:",l),d.status(500).json({error:"Failed to cancel reedit"})}}),e.post("/api/reedit-projects/:id/force-unlock",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});console.log(`[ForceUnlock] Admin requested force unlock for reedit project ${l}`);let v=A.has(l);v?(A.delete(l),console.log(`[ForceUnlock] Removed project ${l} from active orchestrators`)):console.log(`[ForceUnlock] Project ${l} was not in active orchestrators`),h.status==="processing"&&(await b.updateReeditProject(l,{status:"awaiting_instructions",pauseReason:"Desbloqueado forzosamente por el administrador",cancelRequested:!1}),console.log(`[ForceUnlock] Project ${l} status changed to awaiting_instructions`));let S=v?`Proyecto ${l} desbloqueado. Orquestador activo eliminado.`:`Proyecto ${l} desbloqueado. Estado actualizado a awaiting_instructions.`;d.json({success:!0,message:S})}catch(l){console.error("Error force unlocking reedit project:",l),d.status(500).json({error:"Failed to force unlock project"})}}),e.post("/api/reedit-projects/:id/restart",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="processing")return d.status(400).json({error:"Project is currently being processed"});let{expandChapters:v,insertNewChapters:S,targetMinWordsPerChapter:R}=E.body;await b.updateReeditProject(l,{status:"pending",currentStage:"uploaded",processedChapters:0,currentChapter:0,finalReviewResult:null,bestsellerScore:null,structureAnalysis:null,expansionPlan:null,errorMessage:null,cancelRequested:!1,totalInputTokens:0,totalOutputTokens:0,totalThinkingTokens:0,...v!==void 0&&{expandChapters:v},...S!==void 0&&{insertNewChapters:S},...R!==void 0&&{targetMinWordsPerChapter:R}}),await b.deleteReeditWorldBible(l);let x=await b.getReeditChaptersByProject(l);for(let O of x){let I=O.editedContent||O.originalContent;await b.updateReeditChapter(O.id,{status:"pending",originalContent:I,editedContent:null})}let w=["editor_review","architect_analysis","continuity_sentinel","voice_rhythm","semantic_repetition","anachronism_detector","final_review"];for(let O of w)await b.deleteReeditAuditReportsByType(l,O);console.log(`[ReeditRestart] Project ${l} reset to pending state, using edited content as new base`),d.json({success:!0,message:"Proyecto reiniciado con la versi\xF3n editada como base. Puede iniciar la reedici\xF3n nuevamente.",projectId:l})}catch(l){console.error("Error restarting reedit project:",l),d.status(500).json({error:"Failed to restart reedit project"})}}),e.post("/api/reedit-projects/:id/custom-polishing",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status==="processing")return d.status(400).json({error:"Project is currently being processed"});let{chapterRange:v,diagnosis:S,procedure:R,objective:x}=E.body;if(!v||!v.trim())return d.status(400).json({error:"Chapter range is required"});let O=(P=>{let L=[],$=P.replace(/\([^)]*\)/g,"").replace(/[Cc]aptulos?/g,"").trim().split(",").map(U=>U.trim()).filter(U=>U);for(let U of $)if(U.includes("-")){let[k,V]=U.split("-").map(Q=>parseInt(Q.trim()));if(!isNaN(k)&&!isNaN(V))for(let Q=k;Q<=V;Q++)L.push(Q)}else{let k=parseInt(U);isNaN(k)||L.push(k)}return Array.from(new Set(L)).sort((U,k)=>U-k)})(v);if(O.length===0)return d.status(400).json({error:"Could not parse chapter numbers from range. Use format like '18-19' or '5, 7, 12-15'"});let _=(await b.getReeditChaptersByProject(l)).filter(P=>O.includes(P.chapterNumber));if(_.length===0)return d.status(400).json({error:`No chapters found matching numbers: ${O.join(", ")}`});let N=["## INSTRUCCIONES DE PULIDO MANUAL","",`### Cap\xEDtulos afectados: ${v}`,"",S?`### Diagn\xF3stico:
${S}`:"","",R?`### Procedimiento:
${R}`:"","",x?`### Objetivo:
${x}`:""].filter(P=>P!=="").join(`
`);for(let P of _)await b.updateReeditChapter(P.id,{status:"pending",polishingInstructions:N});await b.updateReeditProject(l,{status:"processing",currentStage:"custom_polishing",processedChapters:0,currentChapter:_[0]?.chapterNumber||0,errorMessage:null,cancelRequested:!1}),(async()=>{try{let{ReeditOrchestrator:P}=await Promise.resolve().then(()=>(tb(),Vq));await new P().runCustomPolishing(l,_.map(j=>j.id),N)}catch(P){console.error(`[CustomPolishing] Error processing project ${l}:`,P),await b.updateReeditProject(l,{status:"error",errorMessage:P instanceof Error?P.message:"Unknown error during custom polishing"})}})(),console.log(`[CustomPolishing] Started custom polishing for project ${l}, chapters: ${O.join(", ")}`),d.json({success:!0,message:`Pulido iniciado para cap\xEDtulos: ${O.join(", ")}`,chaptersAffected:O.length,projectId:l})}catch(l){console.error("Error starting custom polishing:",l),d.status(500).json({error:"Failed to start custom polishing"})}}),e.delete("/api/reedit-projects/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteReeditProject(l),d.json({success:!0,message:"Reedit project deleted"})}catch(l){console.error("Error deleting reedit project:",l),d.status(500).json({error:"Failed to delete reedit project"})}}),e.get("/api/reedit-projects/:id/issues",async(E,d)=>{try{let l=parseInt(E.params.id),{status:h,chapter:v}=E.query,S;h&&typeof h=="string"?S=await b.getReeditIssuesByStatus(l,h):v&&typeof v=="string"?S=await b.getReeditIssuesByChapter(l,parseInt(v)):S=await b.getReeditIssuesByProject(l),d.json(S)}catch(l){console.error("Error fetching reedit issues:",l),d.status(500).json({error:"Failed to fetch issues"})}}),e.post("/api/reedit-issues/:id/approve",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.approveReeditIssue(l);if(!h)return d.status(404).json({error:"Issue not found"});d.json(h)}catch(l){console.error("Error approving reedit issue:",l),d.status(500).json({error:"Failed to approve issue"})}}),e.post("/api/reedit-issues/:id/reject",async(E,d)=>{try{let l=parseInt(E.params.id),{reason:h}=E.body,v=await b.rejectReeditIssue(l,h);if(!v)return d.status(404).json({error:"Issue not found"});d.json(v)}catch(l){console.error("Error rejecting reedit issue:",l),d.status(500).json({error:"Failed to reject issue"})}}),e.post("/api/reedit-projects/:id/issues/approve-all",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditIssuesByStatus(l,"pending");for(let v of h)await b.approveReeditIssue(v.id);d.json({success:!0,approved:h.length})}catch(l){console.error("Error bulk approving issues:",l),d.status(500).json({error:"Failed to bulk approve issues"})}}),e.post("/api/reedit-projects/:id/issues/reject-all",async(E,d)=>{try{let l=parseInt(E.params.id),{reason:h}=E.body,v=await b.getReeditIssuesByStatus(l,"pending");for(let S of v)await b.rejectReeditIssue(S.id,h||"Bulk rejected by user");d.json({success:!0,rejected:v.length})}catch(l){console.error("Error bulk rejecting issues:",l),d.status(500).json({error:"Failed to bulk reject issues"})}}),e.get("/api/reedit-projects/:id/issues/summary",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditIssuesByProject(l),v={total:h.length,pending:h.filter(S=>S.status==="pending").length,approved:h.filter(S=>S.status==="approved").length,rejected:h.filter(S=>S.status==="rejected").length,resolved:h.filter(S=>S.status==="resolved").length,bySeverity:{critical:h.filter(S=>S.severity==="critical").length,major:h.filter(S=>S.severity==="major").length,minor:h.filter(S=>S.severity==="minor").length,suggestion:h.filter(S=>S.severity==="suggestion").length},byCategory:{}};for(let S of h){let R=S.category||"unknown";v.byCategory[R]=(v.byCategory[R]||0)+1}d.json(v)}catch(l){console.error("Error fetching issue summary:",l),d.status(500).json({error:"Failed to fetch issue summary"})}}),e.post("/api/reedit-projects/:id/proceed-corrections",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});if(h.status!=="awaiting_issue_approval")return d.status(400).json({error:"Project is not awaiting issue approval",currentStatus:h.status});let v=await b.getReeditIssuesByStatus(l,"pending");if(v.length>0)return d.status(400).json({error:"There are still pending issues that need approval or rejection",pendingCount:v.length});let S=await b.getReeditIssuesByStatus(l,"approved");if(A.has(l))return d.status(400).json({error:"Project is already being processed"});if(S.length===0)return await b.updateReeditProject(l,{status:"completed",pauseReason:null,errorMessage:null}),d.json({success:!0,message:"No corrections approved. Project marked as completed.",approvedCount:0});await b.updateReeditProject(l,{status:"processing",pauseReason:null});let R=await T(l);A.set(l,R),d.json({success:!0,message:`Proceeding with ${S.length} approved corrections`,approvedCount:S.length}),console.log(`[ProceedCorrections] Resuming final review for project ${l} with ${S.length} approved issues`),R.runFinalReviewOnly(l).then(()=>{console.log(`[ProceedCorrections] Completed for project ${l}`)}).catch(x=>{console.error("[ProceedCorrections] Error:",x),b.updateReeditProject(l,{status:"error",errorMessage:x instanceof Error?x.message:"Unknown error"})}).finally(()=>{A.delete(l)})}catch(l){console.error("Error proceeding with corrections:",l),d.status(500).json({error:"Failed to proceed with corrections"})}}),e.get("/api/reedit-projects/:id/export-logs-pdf",async(E,d)=>{try{let l=(await import("pdfkit")).default,h=parseInt(E.params.id),v=await b.getReeditProject(h);if(!v)return d.status(404).json({error:"Proyecto no encontrado"});let S=await b.getActivityLogsByReeditProject(h,5e3),R=new l({size:"A4",margin:50,bufferPages:!0}),x=[];R.on("data",L=>x.push(L));let w=new Promise((L,j)=>{R.on("end",()=>L(Buffer.concat(x))),R.on("error",j)});R.fontSize(18).font("Helvetica-Bold").text("Registro de Actividad",{align:"center"}),R.fontSize(14).font("Helvetica").text(`Proyecto: ${v.title}`,{align:"center"}),R.fontSize(10).text(`Exportado: ${new Date().toLocaleString("es-ES")}`,{align:"center"}),R.moveDown(2);let O={"forensic-auditor":"Auditor Forense","beta-reader":"Lector Beta","narrative-rewriter":"Reescritor Narrativo","smart-editor":"Editor Inteligente","final-reviewer":"Revisor Final",orchestrator:"Orquestador",system:"Sistema"},I={info:"INFO",success:"EXITO",warn:"AVISO",warning:"AVISO",error:"ERROR"};R.fontSize(9);for(let L of S.reverse()){let j=new Date(L.createdAt).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),$=O[L.agentRole||"system"]||L.agentRole||"Sistema",U=I[L.level]||L.level.toUpperCase(),k=`[${j}] [${U}] [${$}] ${L.message}`;R.y>750&&R.addPage(),L.level==="error"?R.fillColor("red"):L.level==="success"?R.fillColor("green"):L.level==="warn"||L.level==="warning"?R.fillColor("orange"):R.fillColor("black"),R.text(k,{width:495,lineGap:2}),R.fillColor("black")}R.end();let _=await w,P=`${v.title.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_")}_logs.pdf`;d.setHeader("Content-Type","application/pdf"),d.setHeader("Content-Disposition",`attachment; filename="${P}"`),d.setHeader("Content-Length",_.length),d.send(_)}catch(l){console.error("Error exporting reedit logs to PDF:",l),d.status(500).json({error:"Error al exportar logs"})}}),e.get("/api/reedit-projects/:id/export-markdown",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});let v=await b.getReeditChaptersByProject(l);if(v.length===0)return d.status(400).json({error:"No chapters to export"});let S=N=>N===0?-1e3:N===-1||N===998?1e3:N===-2||N===999?1001:N,R=[...v].sort((N,P)=>S(N.chapterNumber)-S(P.chapterNumber)),x={es:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota del Autor",chapter:"Cap\xEDtulo"},en:{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},fr:{prologue:"Prologue",epilogue:"\xC9pilogue",authorNote:"Note de l'Auteur",chapter:"Chapitre"},de:{prologue:"Prolog",epilogue:"Epilog",authorNote:"Anmerkung des Autors",chapter:"Kapitel"},it:{prologue:"Prologo",epilogue:"Epilogo",authorNote:"Nota dell'Autore",chapter:"Capitolo"},pt:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota do Autor",chapter:"Cap\xEDtulo"},ca:{prologue:"Pr\xF2leg",epilogue:"Ep\xEDleg",authorNote:"Nota de l'Autor",chapter:"Cap\xEDtol"}},w=x[h.detectedLanguage||"es"]||x.es,O=`# ${h.title}

`,I=0,_=R.filter(N=>N.editedContent||N.originalContent);for(let N=0;N<_.length;N++){let P=_[N],L=P.editedContent||P.originalContent;if(!L)continue;let j=N===_.length-1,$=P.title||`${w.chapter} ${P.chapterNumber}`;P.chapterNumber===0?$=P.title||w.prologue:P.chapterNumber===-1||P.chapterNumber===998?$=P.title||w.epilogue:(P.chapterNumber===-2||P.chapterNumber===999)&&($=P.title||w.authorNote),O+=`## ${$}

`;let U=L.trim().replace(/\n---+\n/g,`

`);O+=U+`

`,I+=L.split(/\s+/).filter(k=>k.length>0).length}d.json({projectId:l,title:h.title,chapterCount:_.length,totalWords:I,markdown:O})}catch(l){console.error("Error exporting reedit manuscript as markdown JSON:",l),d.status(500).json({error:"Failed to export manuscript"})}}),e.get("/api/reedit-projects/:id/export-md",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});let v=await b.getReeditChaptersByProject(l);if(v.length===0)return d.status(400).json({error:"No chapters to export"});let S=P=>P===0?-1e3:P===-1||P===998?1e3:P===-2||P===999?1001:P,R=[...v].sort((P,L)=>S(P.chapterNumber)-S(L.chapterNumber)),x={es:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota del Autor",chapter:"Cap\xEDtulo"},en:{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},fr:{prologue:"Prologue",epilogue:"\xC9pilogue",authorNote:"Note de l'Auteur",chapter:"Chapitre"},de:{prologue:"Prolog",epilogue:"Epilog",authorNote:"Anmerkung des Autors",chapter:"Kapitel"},it:{prologue:"Prologo",epilogue:"Epilogo",authorNote:"Nota dell'Autore",chapter:"Capitolo"},pt:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota do Autor",chapter:"Cap\xEDtulo"},ca:{prologue:"Pr\xF2leg",epilogue:"Ep\xEDleg",authorNote:"Nota de l'Autor",chapter:"Cap\xEDtol"}},w=x[h.detectedLanguage||"es"]||x.es,O=R.filter(P=>P.editedContent||P.originalContent),I=`# ${h.title}

`;for(let P=0;P<O.length;P++){let L=O[P],j=L.editedContent||L.originalContent;if(!j)continue;let $=P===O.length-1,U=L.title||`${w.chapter} ${L.chapterNumber}`;L.chapterNumber===0?U=L.title||w.prologue:L.chapterNumber===-1||L.chapterNumber===998?U=L.title||w.epilogue:(L.chapterNumber===-2||L.chapterNumber===999)&&(U=L.title||w.authorNote),I+=`## ${U}

`;let k=j.trim().replace(/\n---+\n/g,`

`);I+=k+`

`}let N=`${h.title.replace(/[^a-zA-Z0-9\s-]/g,"").trim()}_editado.md`;d.setHeader("Content-Disposition",`attachment; filename="${encodeURIComponent(N)}"`),d.setHeader("Content-Type","text/markdown; charset=utf-8"),d.send(I)}catch(l){console.error("Error exporting reedit manuscript as MD:",l),d.status(500).json({error:"Failed to export manuscript"})}}),e.get("/api/reedit-projects/:id/export",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getReeditProject(l);if(!h)return d.status(404).json({error:"Project not found"});let v=await b.getReeditChaptersByProject(l);if(v.length===0)return d.status(400).json({error:"No chapters to export"});let{Document:S,Packer:R,Paragraph:x,TextRun:w,HeadingLevel:O}=await import("docx"),I={es:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota del Autor",chapter:"Cap\xEDtulo"},en:{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},fr:{prologue:"Prologue",epilogue:"\xC9pilogue",authorNote:"Note de l'Auteur",chapter:"Chapitre"},de:{prologue:"Prolog",epilogue:"Epilog",authorNote:"Anmerkung des Autors",chapter:"Kapitel"},it:{prologue:"Prologo",epilogue:"Epilogo",authorNote:"Nota dell'Autore",chapter:"Capitolo"},pt:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota do Autor",chapter:"Cap\xEDtulo"},ca:{prologue:"Pr\xF2leg",epilogue:"Ep\xEDleg",authorNote:"Nota de l'Autor",chapter:"Cap\xEDtol"}},_=I[h.detectedLanguage||"es"]||I.es,N=[],P=V=>V===0?-1e3:V===-1||V===998?1e3:V===-2||V===999?1001:V,L=[...v].sort((V,Q)=>P(V.chapterNumber)-P(Q.chapterNumber));for(let V of L){let Q=V.editedContent||V.originalContent;if(!Q)continue;let te=V.title||`${_.chapter} ${V.chapterNumber}`;V.chapterNumber===0?te=V.title||_.prologue:V.chapterNumber===-1||V.chapterNumber===998?te=V.title||_.epilogue:(V.chapterNumber===-2||V.chapterNumber===999)&&(te=V.title||_.authorNote),N.push(new x({text:te,heading:O.HEADING_1,spacing:{before:400,after:200}}));let F=Q.split(/\n\n+/);for(let ae of F)ae.trim()&&N.push(new x({children:[new w({text:ae.trim()})],spacing:{after:200}}))}let j=new S({sections:[{properties:{},children:N}]}),$=await R.toBuffer(j),k=`${h.title.replace(/[^a-zA-Z0-9\s-]/g,"").trim()}_editado.docx`;d.setHeader("Content-Disposition",`attachment; filename="${encodeURIComponent(k)}"`),d.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.wordprocessingml.document"),d.send($)}catch(l){console.error("Error exporting reedit manuscript:",l),d.status(500).json({error:"Failed to export manuscript"})}}),e.get("/api/reedit-projects/:id/translate-stream",async(E,d)=>{let l=parseInt(E.params.id),{sourceLanguage:h,targetLanguage:v}=E.query;d.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"});let S=(I,_)=>{d.write(`event: ${I}
`),d.write(`data: ${JSON.stringify(_)}

`)},R=setInterval(()=>{try{d.write(`: heartbeat

`)}catch{console.log("[Translation-Reedit] Heartbeat failed, connection likely closed"),clearInterval(R)}},8e3),x=()=>{clearInterval(R)};E.on("close",x);let w=await b.getReeditProject(l);if(!w){S("error",{error:"Reedit project not found"}),x(),d.end();return}let O=null;try{O=(await b.createTranslation({reeditProjectId:l,source:"reedit",projectTitle:w.title+" (Re-editado)",sourceLanguage:h,targetLanguage:v,status:"translating",chaptersTranslated:0,totalWords:0,markdown:"",inputTokens:0,outputTokens:0})).id,console.log(`[Translation-Reedit] Initialized repository record ID ${O}`)}catch(I){console.error("Error creating initial reedit translation record:",I)}try{if(console.log(`[Translation-Reedit] Starting translation for reedit project ${l}: ${h} -> ${v}`),!v){S("error",{error:"targetLanguage is required"}),x(),d.end();return}console.log(`[Translation-Reedit] Fetching chapters for reedit project ${l}...`);let I=await b.getReeditChaptersByProject(l);if(I.length===0){S("error",{error:"No chapters found in project"}),x(),d.end();return}console.log(`[Translation-Reedit] Found ${I.length} chapters`);let _=W=>W===0?-1e3:W===-1||W===998?1e3:W===-2||W===999?1001:W,P=[...I].sort((W,de)=>_(W.chapterNumber)-_(de.chapterNumber)).filter(W=>(W.editedContent||W.originalContent)?.trim().length>0),L=P.length;console.log(`[Translation-Reedit] ${L} chapters with content ready for translation`),S("start",{projectTitle:w.title,totalChapters:L,sourceLanguage:h,targetLanguage:v}),O&&(await b.updateTranslation(O,{heartbeatAt:new Date}),console.log(`[Translation-Reedit] Initial heartbeat set for record ${O}`)),console.log("[Translation-Reedit] Initializing TranslatorAgent...");let{TranslatorAgent:j}=await Promise.resolve().then(()=>(Mm(),cb)),$=new j;console.log("[Translation-Reedit] TranslatorAgent initialized, starting translation loop...");let U=[],k=0,V=0,Q=0;for(let W of P){let de=W.chapterNumber===0?"Pr\xF3logo":W.chapterNumber===-1||W.chapterNumber===998?"Ep\xEDlogo":W.chapterNumber===-2||W.chapterNumber===999?"Nota del Autor":`Cap\xEDtulo ${W.chapterNumber}`;S("progress",{current:Q+1,total:L,chapterNumber:W.chapterNumber,chapterTitle:W.title||de,status:"translating"});let ne=W.editedContent||W.originalContent||"";console.log(`[Translate-Reedit] Translating ${de}: ${W.title}`);let le=await $.execute({content:ne,sourceLanguage:h,targetLanguage:v,chapterTitle:W.title||void 0,chapterNumber:W.chapterNumber,projectId:-l});if(le.result&&(U.push({chapterNumber:W.chapterNumber,title:W.title||de,translatedContent:le.result.translated_text,notes:le.result.notes}),Q++),k+=le.inputTokens||0,V+=le.outputTokens||0,S("progress",{current:Q,total:L,chapterNumber:W.chapterNumber,chapterTitle:W.title||de,status:"completed",inputTokens:k,outputTokens:V}),O)try{await b.updateTranslation(O,{chaptersTranslated:Q,status:"translating"})}catch(oe){console.error("[Translation] Progress DB update failed:",oe)}}let te=`# ${w.title}

`,F=0,ae={es:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota del Autor",chapter:"Cap\xEDtulo"},en:{prologue:"Prologue",epilogue:"Epilogue",authorNote:"Author's Note",chapter:"Chapter"},fr:{prologue:"Prologue",epilogue:"\xC9pilogue",authorNote:"Note de l'Auteur",chapter:"Chapitre"},de:{prologue:"Prolog",epilogue:"Epilog",authorNote:"Anmerkung des Autors",chapter:"Kapitel"},it:{prologue:"Prologo",epilogue:"Epilogo",authorNote:"Nota dell'Autore",chapter:"Capitolo"},pt:{prologue:"Pr\xF3logo",epilogue:"Ep\xEDlogo",authorNote:"Nota do Autor",chapter:"Cap\xEDtulo"},ca:{prologue:"Pr\xF2leg",epilogue:"Ep\xEDleg",authorNote:"Nota de l'Autor",chapter:"Cap\xEDtol"}},D=ae[v]||ae.en,J=(W,de)=>{let ne=W.trim(),le=ne.match(/^```(?:json|markdown|md|text)?\s*([\s\S]*?)```\s*$/);if(le&&(ne=le[1].trim()),ne=ne.replace(/```(?:json|markdown|md|text)?\n?/g,"").replace(/```\s*$/g,""),ne.startsWith("{")&&ne.includes('"translated_text"'))try{let Y=JSON.parse(ne);Y.translated_text&&(ne=Y.translated_text)}catch{let Y=ne.match(/"translated_text"\s*:\s*"([\s\S]*?)(?:"\s*,\s*"(?:source_|target_|notes)|\s*"\s*})/);Y&&(ne=Y[1].replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\"))}let oe=/^#{1,4}\s*(CHAPTER|Chapter|CAPTULO|Captulo|CHAPITRE|Chapitre|KAPITEL|Kapitel|CAPITOLO|Capitolo|CAPTOL|Captol|Prologue|PROLOGUE|Prlogo|PRLOGO|Prolog|PROLOG|Prologo|PROLOGO|Prleg|PRLEG|Epilogue|EPILOGUE|Eplogo|EPLOGO|Epilog|EPILOG|Epilogo|EPILOGO|Epleg|EPLEG|Author'?s?\s*Note|AUTHOR'?S?\s*NOTE|Nota\s*del?\s*Autor|NOTA\s*DEL?\s*AUTOR|Note\s*de\s*l'Auteur|NOTE\s*DE\s*L'AUTEUR|Anmerkung\s*des\s*Autors|ANMERKUNG\s*DES\s*AUTORS|Nota\s*dell'?Autore|NOTA\s*DELL'?AUTORE|Nota\s*de\s*l'Autor|NOTA\s*DE\s*L'AUTOR)[^\n]*\n+/i;for(let Y=0;Y<3;Y++){let Ie=ne,Je=ne.replace(oe,"");if(Je.trim().length>50&&Je!==Ie)ne=Je;else break}let ce=/^#{1,4}\s*\d+\s*[:\-]?\s*[^\n]*\n+/i,se=ne.replace(ce,"");return se.trim().length>50&&(ne=se.trim()),ne=ne.replace(/\n*[-*]{3,}\s*$/,"").trim(),ne};for(let W=0;W<U.length;W++){let de=U[W],ne=W===U.length-1,le=de.chapterNumber===0?D.prologue:de.chapterNumber===998?D.epilogue:de.chapterNumber===999?D.authorNote:`${D.chapter} ${de.chapterNumber}`,oe=J(de.translatedContent,de.chapterNumber);te+=`## ${de.title||le}

`,te+=oe+`

`,ne||(te+=`---

`),F+=oe.split(/\s+/).filter(ce=>ce.length>0).length}if(O)try{await b.updateTranslation(O,{chaptersTranslated:Q,totalWords:F,markdown:te,inputTokens:k,outputTokens:V,status:"completed"})}catch(W){console.error("[Translation] Final DB update failed:",W)}S("complete",{chaptersTranslated:Q,totalWords:F,inputTokens:k,outputTokens:V,projectTitle:w.title,targetLanguage:v,markdown:te})}catch(I){if(console.error("[Translation-Reedit] Error:",I),S("error",{error:I.message||"Translation failed"}),O)try{await b.updateTranslation(O,{status:"error"})}catch(_){console.error("[Translation] Status update to error failed:",_)}}finally{x(),d.end()}}),e.post("/api/chat/sessions",async(E,d)=>{try{let{projectId:l,reeditProjectId:h,agentType:v,chapterNumber:S,title:R}=E.body;if(!v||!["architect","reeditor"].includes(v))return d.status(400).json({error:"agentType must be 'architect' or 'reeditor'"});if(v==="architect"&&!l)return d.status(400).json({error:"projectId is required for architect chats"});if(v==="reeditor"&&!h)return d.status(400).json({error:"reeditProjectId is required for reeditor chats"});let x=await nb.createSession({projectId:l?parseInt(l):void 0,reeditProjectId:h?parseInt(h):void 0,agentType:v,chapterNumber:S?parseInt(S):void 0,title:R});d.json(x)}catch(l){console.error("Error creating chat session:",l),d.status(500).json({error:l.message||"Failed to create chat session"})}}),e.get("/api/chat/sessions",async(E,d)=>{try{let{projectId:l,reeditProjectId:h,agentType:v}=E.query;if(!v)return d.status(400).json({error:"agentType is required"});let S;if(l)S=await b.getChatSessionsByProject(parseInt(l),v);else if(h)S=await b.getChatSessionsByReeditProject(parseInt(h),v);else return d.status(400).json({error:"projectId or reeditProjectId is required"});d.json(S)}catch(l){console.error("Error fetching chat sessions:",l),d.status(500).json({error:l.message||"Failed to fetch chat sessions"})}}),e.get("/api/chat/sessions/:id",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getChatSession(l);if(!h)return d.status(404).json({error:"Session not found"});d.json(h)}catch(l){console.error("Error fetching chat session:",l),d.status(500).json({error:l.message||"Failed to fetch chat session"})}}),e.patch("/api/chat/sessions/:id",async(E,d)=>{try{let l=parseInt(E.params.id),{chapterNumber:h,title:v,status:S}=E.body,R=await b.updateChatSession(l,{...h!==void 0&&{chapterNumber:h},...v&&{title:v},...S&&{status:S}});if(!R)return d.status(404).json({error:"Session not found"});d.json(R)}catch(l){console.error("Error updating chat session:",l),d.status(500).json({error:l.message||"Failed to update chat session"})}}),e.delete("/api/chat/sessions/:id",async(E,d)=>{try{let l=parseInt(E.params.id);await b.deleteChatSession(l),d.json({success:!0})}catch(l){console.error("Error deleting chat session:",l),d.status(500).json({error:l.message||"Failed to delete chat session"})}}),e.get("/api/chat/sessions/:id/messages",async(E,d)=>{try{let l=parseInt(E.params.id),h=await b.getChatMessagesBySession(l);d.json(h)}catch(l){console.error("Error fetching chat messages:",l),d.status(500).json({error:l.message||"Failed to fetch chat messages"})}}),e.get("/api/chat/sessions/:id/stream",async(E,d)=>{let l=parseInt(E.params.id),h=E.query.message;if(!h)return d.status(400).json({error:"message query parameter is required"});d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.setHeader("X-Accel-Buffering","no");let v=(S,R)=>{d.write(`event: ${S}
data: ${JSON.stringify(R)}

`)};try{v("start",{sessionId:l});let S=await nb.sendMessage(l,h,R=>{v("chunk",{text:R})});v("complete",{message:S.message,inputTokens:S.inputTokens,outputTokens:S.outputTokens})}catch(S){console.error("Error in chat stream:",S),v("error",{error:S.message||"Failed to process message"})}finally{d.end()}}),e.post("/api/chat/sessions/:id/messages",async(E,d)=>{try{let l=parseInt(E.params.id),{content:h}=E.body;if(!h)return d.status(400).json({error:"content is required"});let v=await nb.sendMessage(l,h);d.json({message:v.message,inputTokens:v.inputTokens,outputTokens:v.outputTokens})}catch(l){console.error("Error sending chat message:",l),d.status(500).json({error:l.message||"Failed to send message"})}}),e.post("/api/chat/proposals/apply",async(E,d)=>{try{let{sessionId:l,messageId:h,proposal:v,projectId:S,reeditProjectId:R}=E.body;if(!v||!v.descripcion)return d.status(400).json({error:"proposal with descripcion is required"});if(!h)return d.status(400).json({error:"messageId is required"});let x=v.tipo?.toLowerCase()||"",w=v.capitulo?parseInt(v.capitulo):null,O=v.texto_propuesto||v.contenido_propuesto||"";if(!O)return d.status(400).json({error:"No proposed text found in proposal"});let I={applied:!1,message:""};if(R&&w){let N=(await b.getReeditChaptersByProject(R)).find(P=>P.chapterNumber===w);if(N){let P=N.editedContent||N.originalContent||"";if(x==="restructure")await b.updateReeditChapter(N.id,{editedContent:O}),I={applied:!0,message:`Cap\xEDtulo ${w} reestructurado completamente`};else{let L=(j,$,U)=>{if(j.includes($))return j.replace($,U);let k=F=>F.replace(/\s+/g," ").trim(),V=k($),Q=k(j);if(Q.includes(V)){let F=Q.indexOf(V),D=Q.substring(0,F).split(" ").filter(oe=>oe.length>0),J=j.split(/\s+/).slice(0,D.length).join(" ").length,W=$.split(/\s+/).filter(oe=>oe.length>0),de=0,ne=-1,le=-1;for(let oe=0;oe<W.length;oe++){let ce=j.indexOf(W[oe],de);if(ce===-1)break;oe===0&&(ne=ce),le=ce+W[oe].length,de=le}if(ne>=0&&le>ne){for(;ne>0&&/\s/.test(j[ne-1]);)ne--;for(;le<j.length&&/\s/.test(j[le]);)le++;return j.substring(0,ne)+U+j.substring(le)}}let te=$.substring(0,50).trim();if(te.length>20&&j.includes(te)){let F=j.indexOf(te),ae=[`

`,`
---`,`.
`],D=j.length;for(let J of ae){let W=j.indexOf(J,F+te.length);W!==-1&&W<D&&(D=W+(J===`.
`?1:0))}return j.substring(0,F)+U+j.substring(D)}return null};if(v.texto_original&&v.texto_original.trim().length>10){let j=L(P,v.texto_original,O);j&&j!==P?(await b.updateReeditChapter(N.id,{editedContent:j}),I={applied:!0,message:`Cambio aplicado al cap\xEDtulo ${w}`}):I={applied:!1,message:"No se pudo encontrar el texto original en el cap\xEDtulo. El texto puede haber sido modificado."}}else I={applied:!1,message:"La propuesta no incluye texto original para reemplazar. Usa copiar/pegar para aplicar manualmente.",proposedContent:O}}}else I={applied:!1,message:`Cap\xEDtulo ${w} no encontrado`}}else if(S&&w){let N=(await b.getChaptersByProject(S)).find(P=>P.chapterNumber===w);if(N){let P=N.content||"",L=(j,$,U)=>{if(j.includes($))return j.replace($,U);let k=F=>F.replace(/\s+/g," ").trim(),V=k($);if(k(j).includes(V)){let F=$.split(/\s+/).filter(W=>W.length>0),ae=0,D=-1,J=-1;for(let W=0;W<F.length;W++){let de=j.indexOf(F[W],ae);if(de===-1)break;W===0&&(D=de),J=de+F[W].length,ae=J}if(D>=0&&J>D)return j.substring(0,D)+U+j.substring(J)}let te=$.substring(0,50).trim();if(te.length>20&&j.includes(te)){let F=j.indexOf(te),ae=[`

`,`
---`,`.
`],D=j.length;for(let J of ae){let W=j.indexOf(J,F+te.length);W!==-1&&W<D&&(D=W+(J===`.
`?1:0))}return j.substring(0,F)+U+j.substring(D)}return null};if(v.texto_original&&v.texto_original.trim().length>10){let j=L(P,v.texto_original,O);j&&j!==P?(await b.updateChapter(N.id,{content:j}),I={applied:!0,message:`Cambio aplicado al cap\xEDtulo ${w}`}):I={applied:!1,message:"No se pudo encontrar el texto original en el cap\xEDtulo. El texto puede haber sido modificado."}}else I={applied:!1,message:"La propuesta no incluye texto original para reemplazar. Usa copiar/pegar para aplicar manualmente.",proposedContent:O}}else I={applied:!1,message:`Cap\xEDtulo ${w} no encontrado`}}else I={applied:!1,message:"Informaci\xF3n insuficiente para aplicar el cambio"};l&&h&&await b.createChatProposal({messageId:h,sessionId:l,proposalType:x,targetType:w?"chapter":"unknown",targetId:w||void 0,targetName:v.objetivo,description:v.descripcion,originalContent:v.texto_original,proposedContent:O,status:I.applied?"applied":"pending"}),d.json(I)}catch(l){console.error("Error applying proposal:",l),d.status(500).json({error:l.message||"Failed to apply proposal"})}}),e.post("/api/generate-writing-guide",async(E,d)=>{try{let l=await di();if(l)return d.status(409).json({error:`Ya hay una generaci\xF3n en curso: ${l.type} "${l.title}". Por favor espera a que termine.`,activeGeneration:l});let{guideGeneratorAgent:h}=await Promise.resolve().then(()=>(Nx(),Ox)),S=Z.object({argument:Z.string().min(50,"El argumento debe tener al menos 50 caracteres"),title:Z.string().min(1,"El t\xEDtulo es requerido"),genre:Z.string().default("thriller"),tone:Z.string().default("tenso"),chapterCount:Z.number().min(5).max(50).default(25),hasPrologue:Z.boolean().default(!0),hasEpilogue:Z.boolean().default(!0),hasAuthorNote:Z.boolean().default(!1),pseudonymId:Z.number().optional(),styleGuideId:Z.number().optional(),seriesId:Z.number().optional(),seriesOrder:Z.number().optional(),kindleUnlimited:Z.boolean().default(!0),createProject:Z.boolean().default(!0)}).parse(E.body),R,x;if(S.styleGuideId){let O=await b.getStyleGuide(S.styleGuideId);O&&(R=O.content,x=O.id)}else if(S.pseudonymId){let I=(await b.getStyleGuidesByPseudonym(S.pseudonymId)).find(_=>_.isActive);I&&(R=I.content,x=I.id)}let w;if(S.seriesId){let O=await b.getSeries(S.seriesId);if(O){w=`Serie: ${O.title}
`,w+=`Tipo: ${O.workType}
`,O.description&&(w+=`Descripci\xF3n: ${O.description}
`),O.seriesGuide&&(w+=`
Gu\xEDa de la serie:
${O.seriesGuide}
`);let I=await b.getProjectsBySeries(S.seriesId);if(I.length>0){w+=`
Libros anteriores en la serie:
`;for(let N of I.sort((P,L)=>(P.seriesOrder||0)-(L.seriesOrder||0)))w+=`- Libro ${N.seriesOrder}: ${N.title}
`,N.premise&&(w+=`  Premisa: ${N.premise}
`)}await b.getSeriesWorldBible(S.seriesId)&&(w+=`
World Bible de la serie disponible para continuidad.
`)}}if(console.log(`[GuideGenerator] Generating guide for "${S.title}"...`),!await Vx("writing-guide",S.title)){let O=await di();return d.status(409).json({error:`Ya hay una generaci\xF3n en curso: ${O?.type} "${O?.title}". Por favor espera a que termine.`,activeGeneration:O})}try{let I="",_="";for(let L=1;L<=3;L++){console.log(`[GuideGenerator] Attempt ${L}/3...`);let j=await h.generateWritingGuide({argument:S.argument,title:S.title,genre:S.genre,tone:S.tone,chapterCount:S.chapterCount,hasPrologue:S.hasPrologue,hasEpilogue:S.hasEpilogue,styleGuideContent:R,seriesContext:w,kindleUnlimited:S.kindleUnlimited});if(I=j.content||"",_=j.error||"",I.trim().length>=100){console.log(`[GuideGenerator] Guide generated on attempt ${L} (${I.length} chars)`);break}if(console.warn(`[GuideGenerator] Attempt ${L} returned empty/short content (${I.length} chars). Error: ${_||"none"}`),L<3){let $=L*2e3;console.log(`[GuideGenerator] Retrying in ${$}ms...`),await new Promise(U=>setTimeout(U,$))}}if(!I||I.trim().length<100)throw console.error(`[GuideGenerator] All 3 attempts failed. Last error: ${_}`),new Error(_||"La IA no pudo generar la gu\xEDa despu\xE9s de varios intentos. Verifica que la API key est\xE9 configurada correctamente.");let N=null,P=await b.createExtendedGuide({title:`Gu\xEDa de Escritura: ${S.title}`,description:`Gu\xEDa generada autom\xE1ticamente para "${S.title}"`,originalFileName:`guia_${S.title.toLowerCase().replace(/\s+/g,"_")}.md`,content:I,wordCount:I.split(/\s+/).length});console.log(`[GuideGenerator] Extended guide created (ID: ${P.id})`),S.createProject&&(N=await b.createProject({title:S.title,premise:S.argument.substring(0,500),genre:S.genre,tone:S.tone,chapterCount:S.chapterCount,hasPrologue:S.hasPrologue,hasEpilogue:S.hasEpilogue,hasAuthorNote:S.hasAuthorNote,pseudonymId:S.pseudonymId||null,styleGuideId:x||null,extendedGuideId:P.id,workType:S.seriesId?"series":"standalone",seriesId:S.seriesId||null,seriesOrder:S.seriesOrder||null,kindleUnlimitedOptimized:S.kindleUnlimited,pipelineVersion:"v2"}),console.log(`[GuideGenerator] Project created (ID: ${N.id})`)),d.json({success:!0,guideContent:I,extendedGuideId:P.id,projectId:N?.id,message:N?`Gu\xEDa generada y proyecto "${S.title}" creado exitosamente`:`Gu\xEDa generada exitosamente (ID: ${P.id})`})}finally{await xs()}}catch(l){await xs(),console.error("[GuideGenerator] Error:",l),d.status(500).json({error:l.message||"Error al generar la gu\xEDa",details:l.errors||void 0})}}),e.get("/api/generation-status",async(E,d)=>{let l=await di();d.json({isGenerating:!!l,activeGeneration:l,message:l?`Generacion en curso: ${l.type} "${l.title}" (iniciado: ${l.startedAt.toISOString()})`:"No hay generacion en curso"})}),e.post("/api/cancel-guide-generation",async(E,d)=>{let l=await di();if(!l)return d.status(404).json({error:"No hay generacion de guia en curso"});Mce(),await xs(),console.log(`[GenerationLock] Guide generation cancelled: ${l.type} "${l.title}"`),d.json({success:!0,message:`Generacion de "${l.title}" cancelada`})}),e.post("/api/generate-series-guide",async(E,d)=>{console.log("[SeriesGuideGenerator] Endpoint hit, body:",JSON.stringify(E.body).substring(0,200));let l=await di();if(l)return d.status(409).json({error:`Ya hay una generaci\xF3n en curso: ${l.type} "${l.title}". Por favor espera a que termine.`,activeGeneration:l});try{let v=Z.object({concept:Z.string().min(50,"El concepto debe tener al menos 50 caracteres"),seriesTitle:Z.string().min(1,"El t\xEDtulo de la serie es requerido"),genre:Z.string().default("thriller"),tone:Z.string().default("tenso"),bookCount:Z.number().min(2).max(20).default(3),workType:Z.enum(["series","trilogy"]).default("trilogy"),pseudonymId:Z.number().optional(),createSeries:Z.boolean().default(!0),styleGuideId:Z.number().optional(),predefinedVolumes:Z.array(Z.object({number:Z.number(),title:Z.string().optional(),argument:Z.string().optional()})).optional()}).parse(E.body),S,R;if(v.pseudonymId){let x=await b.getPseudonym(v.pseudonymId);x&&(S=x.name);let O=(await b.getStyleGuidesByPseudonym(v.pseudonymId)).find(I=>I.isActive);O&&(R=O.content)}if(!await Vx("series-guide",v.seriesTitle)){let x=await di();return d.status(409).json({error:`Ya hay una generaci\xF3n en curso: ${x?.type} "${x?.title}". Por favor espera a que termine.`,activeGeneration:x})}console.log(`[SeriesGuideGenerator] Lock acquired for "${v.seriesTitle}", starting background generation...`),d.json({success:!0,started:!0,message:`Generaci\xF3n de la gu\xEDa de serie "${v.seriesTitle}" iniciada. Consulta /api/generation-status para ver el progreso.`,estimatedTime:"2-5 minutos"}),setImmediate(async()=>{try{Bce();let{seriesGuideGeneratorAgent:x}=await Promise.resolve().then(()=>(i4(),o4));console.log(`[SeriesGuideGenerator] Starting phased generation for series "${v.seriesTitle}"...`);let w=await x.generateSeriesGuidePhased({concept:v.concept,seriesTitle:v.seriesTitle,genre:v.genre,tone:v.tone,bookCount:v.bookCount,workType:v.workType,pseudonymName:S,pseudonymStyleGuide:R,predefinedVolumes:v.predefinedVolumes?.filter(_=>_.title?.trim()||_.argument?.trim())},_=>{console.log(`[SeriesGuideGenerator] Progress: phase=${_.phase}, volume=${_.currentVolume||0}/${_.totalVolumes||0}, completed=${_.completedVolumes.length}`)},()=>Uce());if(w.error){console.log(`[SeriesGuideGenerator] Generation stopped: ${w.error}`),await xs();return}let O=w.content;if(console.log(`[SeriesGuideGenerator] Guide generated (${O.length} chars)`),!O||O.length<500){console.error(`[SeriesGuideGenerator] Guide content is empty or too short (${O?.length||0} chars)`),await xs();return}let I=null;v.createSeries?(I=await b.createSeries({title:v.seriesTitle,description:v.concept.substring(0,500),workType:v.workType,totalPlannedBooks:v.bookCount,pseudonymId:v.pseudonymId||null,seriesGuide:O,seriesGuideFileName:`guia_serie_${v.seriesTitle.toLowerCase().replace(/\s+/g,"_")}.md`}),console.log(`[SeriesGuideGenerator] COMPLETED: Series "${v.seriesTitle}" created (ID: ${I.id})`)):console.log(`[SeriesGuideGenerator] COMPLETED: Guide generated for "${v.seriesTitle}" (no series created)`),await xs(),console.log(`[SeriesGuideGenerator] Lock released for "${v.seriesTitle}"`)}catch(x){console.error("[SeriesGuideGenerator] Background generation error:",x.message),await xs()}})}catch(h){await xs(),console.error("[SeriesGuideGenerator] Validation error:",h),d.status(500).json({error:h.message||"Error al validar par\xE1metros de generaci\xF3n",details:h.errors||void 0})}}),e.post("/api/series/:id/continue-generation",async(E,d)=>{let l=await di();if(l)return d.status(409).json({error:`Ya hay una generaci\xF3n en curso: ${l.type} "${l.title}". Por favor espera a que termine.`,activeGeneration:l});try{let h=parseInt(E.params.id),v=await b.getSeries(h);if(!v)return d.status(404).json({error:"Serie no encontrada"});if(!v.seriesGuide||v.seriesGuide.length<500)return d.status(400).json({error:"La serie no tiene una gu\xEDa v\xE1lida. Regenera la gu\xEDa de serie primero."});let{guideGeneratorAgent:S}=await Promise.resolve().then(()=>(Nx(),Ox)),x=Z.object({chapterCountPerBook:Z.number().default(30),hasPrologue:Z.boolean().default(!0),hasEpilogue:Z.boolean().default(!0),styleGuideId:Z.number().optional(),startFromVolume:Z.number().optional()}).parse(E.body),w=await b.getProjectsBySeries(h),O=new Set(w.map(j=>j.seriesOrder).filter(Boolean));console.log(`[ContinueGeneration] Series ${h} has ${w.length} existing projects`),console.log(`[ContinueGeneration] Existing volumes: ${Array.from(O).join(", ")}`);let I=v.seriesGuide,_=[],N=/###\s*Volumen\s*(\d+):\s*(.+?)(?:\n|\r\n)[\s\S]*?-\s*\*\*Argumento:\*\*\s*(.+?)(?=\n-\s*\*\*|\n###|\n##|$)/gi,P;for(;(P=N.exec(I))!==null;)_.push({number:parseInt(P[1]),title:P[2].trim(),argument:P[3].trim().replace(/\n/g," ").substring(0,1e3)});let L=_.filter(j=>x.startFromVolume&&j.number<x.startFromVolume?!1:!O.has(j.number));if(L.length===0)return d.json({success:!0,message:"Todos los vol\xFAmenes ya tienen proyectos generados",generatedBooks:[]});if(console.log(`[ContinueGeneration] Found ${L.length} pending volumes to generate`),!await Vx("continue-series",v.title)){let j=await di();return d.status(409).json({error:`Ya hay una generaci\xF3n en curso: ${j?.type} "${j?.title}". Por favor espera a que termine.`,activeGeneration:j})}try{let j;if(x.styleGuideId){let V=await b.getStyleGuide(x.styleGuideId);V&&(j=V.content)}else if(v.pseudonymId){let Q=(await b.getStyleGuidesByPseudonym(v.pseudonymId)).find(te=>te.isActive);Q&&(j=Q.content)}let $="thriller",U="suspenseful";w.length>0&&($=w[0].genre||$,U=w[0].tone||U);let k=[];for(let V of L)try{console.log(`[ContinueGeneration] Generating guide for Volume ${V.number}: "${V.title}"...`);let Q=`
## Contexto de la Serie: ${v.title}

Este es el **Volumen ${V.number}** de ${v.totalPlannedBooks||_.length} en la serie.

### Informaci\xF3n de la Serie:
${I.substring(0,3e3)}

### Hitos espec\xEDficos de este volumen:
Buscar en la gu\xEDa de serie los hitos correspondientes al Volumen ${V.number}.
          `.trim(),F=(await S.generateWritingGuide({argument:V.argument,title:V.title,genre:$,tone:U,chapterCount:x.chapterCountPerBook,hasPrologue:x.hasPrologue,hasEpilogue:x.hasEpilogue,styleGuideContent:j,seriesContext:Q,kindleUnlimited:!1})).content;if(console.log(`[ContinueGeneration] Book guide generated for "${V.title}" (${F.length} chars)`),!F||F.length<500){console.error(`[ContinueGeneration] Book guide content too short for volume ${V.number} (${F?.length||0} chars)`);continue}let ae=await b.createExtendedGuide({title:`Gu\xEDa de Escritura: ${V.title}`,originalFileName:`guia_${V.title.toLowerCase().replace(/\s+/g,"_")}.md`,description:`Gu\xEDa para Volumen ${V.number} de la serie "${v.title}"`,content:F}),D=await b.createProject({title:V.title,premise:V.argument,genre:$,tone:U,chapterCount:x.chapterCountPerBook,hasPrologue:x.hasPrologue,hasEpilogue:x.hasEpilogue,hasAuthorNote:!1,pseudonymId:v.pseudonymId,extendedGuideId:ae.id,workType:"series",seriesId:v.id,seriesOrder:V.number});k.push({title:V.title,projectId:D.id,volumeNumber:V.number}),console.log(`[ContinueGeneration] Project created for "${V.title}" (ID: ${D.id})`)}catch(Q){console.error(`[ContinueGeneration] Error generating volume ${V.number}:`,Q)}d.json({success:!0,seriesId:v.id,generatedBooks:k,totalVolumes:_.length,pendingVolumes:L.length-k.length,message:`Se generaron ${k.length} libros adicionales para la serie "${v.title}"`})}finally{await xs()}}catch(h){await xs(),console.error("[ContinueGeneration] Error:",h),d.status(500).json({error:h.message||"Error al continuar la generaci\xF3n de la serie",details:h.errors||void 0})}}),e.post("/api/generate-style-guide",async(E,d)=>{try{let{styleGuideGeneratorAgent:l}=await Promise.resolve().then(()=>(l4(),c4)),v=Z.object({referenceAuthor:Z.string().min(1,"El autor de referencia es requerido"),pseudonymName:Z.string().min(1,"El nombre del seud\xF3nimo es requerido"),genre:Z.string().optional(),additionalNotes:Z.string().optional(),pseudonymId:Z.number().optional(),createPseudonym:Z.boolean().default(!1),saveGuide:Z.boolean().default(!0)}).parse(E.body);console.log(`[StyleGuideGenerator] Generating guide based on "${v.referenceAuthor}" for "${v.pseudonymName}"...`);let S=3,R="";for(let O=1;O<=S;O++){if(console.log(`[StyleGuideGenerator] Attempt ${O}/${S}...`),R=await l.generateStyleGuide({referenceAuthor:v.referenceAuthor,pseudonymName:v.pseudonymName,genre:v.genre,additionalNotes:v.additionalNotes}),R&&R.trim().length>=100){console.log(`[StyleGuideGenerator] Guide generated on attempt ${O} (${R.length} chars)`);break}console.warn(`[StyleGuideGenerator] Attempt ${O} returned empty/short content (${R?.length||0} chars)`),O<S&&await new Promise(I=>setTimeout(I,O*2e3))}if(!R||R.trim().length<100)throw new Error("La IA no pudo generar la gu\xEDa de estilo despu\xE9s de varios intentos. Verifica la configuraci\xF3n de la API.");let x=v.pseudonymId,w=null;v.saveGuide&&(v.createPseudonym&&!x&&(x=(await b.createPseudonym({name:v.pseudonymName,bio:`Seud\xF3nimo con estilo inspirado en ${v.referenceAuthor}`})).id,console.log(`[StyleGuideGenerator] Pseudonym created (ID: ${x})`)),x&&(w=await b.createStyleGuide({pseudonymId:x,title:`Estilo ${v.referenceAuthor}`,content:R,isActive:!0}),console.log(`[StyleGuideGenerator] Style guide created (ID: ${w.id})`))),d.json({success:!0,guideContent:R,pseudonymId:x,styleGuideId:w?.id,message:w?"Gu\xEDa de estilo generada y guardada exitosamente":"Gu\xEDa de estilo generada exitosamente"})}catch(l){console.error("[StyleGuideGenerator] Error:",l),d.status(500).json({error:l.message||"Error al generar la gu\xEDa de estilo",details:l.errors||void 0})}}),e.post("/api/projects/:id/start-audit",async(E,d)=>{let l=parseInt(E.params.id);try{if(!await b.getProject(l))return d.status(404).json({error:"Proyecto no encontrado"});let v=await b.getChaptersByProject(l);if(!v||v.length===0)return d.status(400).json({error:"El proyecto no tiene cap\xEDtulos para auditar"});let S=[...v].sort((I,_)=>I.chapterNumber-_.chapterNumber),R="";for(let I of S)if(I.content){let _="";I.chapterNumber===0?_="Pr\xF3logo":I.chapterNumber===998?_="Ep\xEDlogo":I.chapterNumber===999?_="Nota del Autor":_=`Cap\xEDtulo ${I.chapterNumber}`,R+=`

=== ${_}: ${I.title||""} ===

${I.content}`}let x=null,w=await b.getWorldBibleByProject(l);if(w){let I=[];w.content&&I.push(w.content),w.characters&&I.push(`

=== PERSONAJES ===
${JSON.stringify(w.characters,null,2)}`),w.timeline&&I.push(`

=== L\xCDNEA TEMPORAL ===
${JSON.stringify(w.timeline,null,2)}`),w.worldRules&&I.push(`

=== REGLAS DEL MUNDO ===
${JSON.stringify(w.worldRules,null,2)}`),I.length>0&&(x=I.join(`
`))}let[O]=await M.insert(Xe).values({projectId:l,status:"pending",novelContent:R,bibleContent:x}).returning();d.json({success:!0,auditId:O.id,message:"Auditor\xEDa iniciada. Procesando manuscrito...",stats:{chapters:S.length,words:R.split(/\s+/).length,hasWorldBible:!!x}})}catch(h){console.error("[ManuscriptAuditor] Error starting audit:",h),d.status(500).json({error:h.message||"Error al iniciar auditor\xEDa"})}}),e.get("/api/audits/:id/run",async(E,d)=>{let l=parseInt(E.params.id);d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.setHeader("X-Accel-Buffering","no");let h=(v,S)=>{d.write(`event: ${v}
data: ${JSON.stringify(S)}

`)};try{let{initializeNovelContext:v,runAllAgentsWithProgress:S,countCriticalIssues:R,calculateOverallScore:x}=await Promise.resolve().then(()=>(fb(),hb)),[w]=await M.select().from(Xe).where(q(Xe.id,l)).limit(1);if(!w)return h("error",{message:"Auditor\xEDa no encontrada"}),d.end();let I=(await b.getProject(w.projectId))?.title||"Sin t\xEDtulo";h("progress",{phase:"initializing",message:"Preparando contexto para an\xE1lisis con Gemini..."}),await M.update(Xe).set({status:"caching"}).where(q(Xe.id,l));let _=await v(w.novelContent,w.bibleContent,I);if(!_.success)return h("error",{message:`Error inicializando contexto: ${_.error||"Error desconocido"}`}),await M.update(Xe).set({status:"error",errorMessage:_.error||"Error desconocido"}).where(q(Xe.id,l)),d.end();h("progress",{phase:"context_ready",message:"Contexto listo. Iniciando an\xE1lisis paralelo..."}),h("progress",{phase:"analyzing",message:"Ejecutando 3 agentes de an\xE1lisis en paralelo..."}),await M.update(Xe).set({status:"analyzing"}).where(q(Xe.id,l));let N=0,P=await S(async F=>{N++;let ae={};F.agentType==="CONTINUITY"?ae.continuityReport=F:F.agentType==="CHARACTER"?ae.characterReport=F:F.agentType==="STYLE"&&(ae.styleReport=F),await M.update(Xe).set(ae).where(q(Xe.id,l));let D=F.failed?"fall\xF3":`completado (${F.overallScore}/100)`;h("agent_complete",{agentType:F.agentType,status:D,completed:N,total:3,failed:F.failed||!1})}),L=P.find(F=>F.agentType==="CONTINUITY"),j=P.find(F=>F.agentType==="CHARACTER"),$=P.find(F=>F.agentType==="STYLE"),U=P.every(F=>!F.failed),k=P.filter(F=>F.failed).map(F=>F.agentType),V=R(P),Q=x(P),te={timestamp:new Date().toISOString(),novelTitle:I,reports:P,criticalFlags:V};await M.update(Xe).set({status:U?"completed":"partial",continuityReport:L,characterReport:j,styleReport:$,finalAudit:te,criticalFlags:V,overallScore:Q,completedAt:U?new Date:null,errorMessage:U?null:`Agentes fallidos: ${k.join(", ")} - usa "Reanudar" para reintentar`}).where(q(Xe.id,l)),U?h("complete",{overallScore:Q,criticalFlags:V,reports:P.map(F=>({agentType:F.agentType,score:F.overallScore,issueCount:F.issues.length}))}):h("partial",{message:`${3-k.length}/3 agentes completados. Fallaron: ${k.join(", ")}. Usa "Reanudar" para reintentar.`,overallScore:Q,criticalFlags:V,failedAgents:k,reports:P.map(F=>({agentType:F.agentType,score:F.overallScore,issueCount:F.issues.length}))})}catch(v){console.error("[ManuscriptAuditor] Error running audit:",v),h("error",{message:v.message||"Error durante la auditor\xEDa"}),await M.update(Xe).set({status:"error",errorMessage:v.message}).where(q(Xe.id,l))}d.end()}),e.get("/api/audits/:id",async(E,d)=>{let l=parseInt(E.params.id);try{let[h]=await M.select().from(Xe).where(q(Xe.id,l)).limit(1);if(!h)return d.status(404).json({error:"Auditor\xEDa no encontrada"});d.json(h)}catch(h){d.status(500).json({error:h.message})}}),e.get("/api/projects/:id/audits",async(E,d)=>{let l=parseInt(E.params.id);try{let h=await M.select().from(Xe).where(q(Xe.projectId,l)).orderBy(ft(Xe.createdAt));d.json(h)}catch(h){d.status(500).json({error:h.message})}}),e.delete("/api/audits/:id",async(E,d)=>{let l=parseInt(E.params.id);try{await M.delete(Xe).where(q(Xe.id,l)),d.json({success:!0})}catch(h){d.status(500).json({error:h.message})}}),e.post("/api/audits/:id/resume",async(E,d)=>{let l=parseInt(E.params.id);d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.setHeader("X-Accel-Buffering","no");let h=(v,S)=>{d.write(`event: ${v}
data: ${JSON.stringify(S)}

`)};try{let{initializeNovelContext:v,runMissingAgents:S,countCriticalIssues:R,calculateOverallScore:x}=await Promise.resolve().then(()=>(fb(),hb)),[w]=await M.select().from(Xe).where(q(Xe.id,l)).limit(1);if(!w)return h("error",{message:"Auditor\xEDa no encontrada"}),d.end();let O={continuity:w.continuityReport,character:w.characterReport,style:w.styleReport},I=D=>D?D.failed!==void 0?D.failed:D.analysis?.startsWith("Error:")||!1:!0,_=[I(O.continuity)?null:"CONTINUITY",I(O.character)?null:"CHARACTER",I(O.style)?null:"STYLE"].filter(Boolean);if(_.length===3)return h("complete",{message:"Todos los agentes ya est\xE1n completos",overallScore:w.overallScore,criticalFlags:w.criticalFlags}),d.end();let P=(await b.getProject(w.projectId))?.title||"Sin t\xEDtulo";h("progress",{phase:"resuming",message:`Reanudando auditor\xEDa... ${_.length}/3 agentes ya completados`}),await M.update(Xe).set({status:"analyzing"}).where(q(Xe.id,l));let L=await v(w.novelContent,w.bibleContent,P);if(!L.success)return h("error",{message:`Error inicializando contexto: ${L.error}`}),d.end();h("progress",{phase:"analyzing",message:`Ejecutando ${3-_.length} agentes faltantes...`});let j=_.length,$=await S(O,async D=>{j++;let J={};D.agentType==="CONTINUITY"?J.continuityReport=D:D.agentType==="CHARACTER"?J.characterReport=D:D.agentType==="STYLE"&&(J.styleReport=D),await M.update(Xe).set(J).where(q(Xe.id,l));let W=D.failed?"fall\xF3":`completado (${D.overallScore}/100)`;h("agent_complete",{agentType:D.agentType,status:W,completed:j,total:3,failed:D.failed||!1})}),U=$.find(D=>D.agentType==="CONTINUITY"),k=$.find(D=>D.agentType==="CHARACTER"),V=$.find(D=>D.agentType==="STYLE"),Q=$.every(D=>!D.failed),te=R($),F=x($),ae={timestamp:new Date().toISOString(),novelTitle:P,reports:$,criticalFlags:te};if(await M.update(Xe).set({status:Q?"completed":"partial",continuityReport:U,characterReport:k,styleReport:V,finalAudit:ae,criticalFlags:te,overallScore:F,completedAt:Q?new Date:null,errorMessage:Q?null:"Algunos agentes fallaron - usar 'Reanudar' para reintentar"}).where(q(Xe.id,l)),Q)h("complete",{overallScore:F,criticalFlags:te,reports:$.map(D=>({agentType:D.agentType,score:D.overallScore,issueCount:D.issues.length}))});else{let D=$.filter(J=>J.overallScore===0).map(J=>J.agentType);h("partial",{message:`${3-D.length}/3 agentes completados. Fallaron: ${D.join(", ")}`,overallScore:F,criticalFlags:te,failedAgents:D})}}catch(v){console.error("[ManuscriptAuditor] Error resuming audit:",v),h("error",{message:v.message||"Error durante la reanudaci\xF3n"}),await M.update(Xe).set({status:"error",errorMessage:v.message}).where(q(Xe.id,l))}d.end()}),e.get("/api/audits/:id/start-correction",async(E,d)=>{let l=parseInt(E.params.id);console.log(`[DeepSeek Corrector] Starting correction for audit ${l}`),d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.setHeader("X-Accel-Buffering","no");let h=(v,S)=>{console.log(`[DeepSeek Corrector] Sending event: ${v}`,S),d.write(`event: ${v}
data: ${JSON.stringify(S)}

`)};try{console.log("[DeepSeek Corrector] Importing deepseek-corrector module...");let{startCorrectionProcess:v}=await Promise.resolve().then(()=>(ho(),mo));console.log("[DeepSeek Corrector] Module imported, starting process...");let S=await v(l,R=>{h("progress",R)});console.log("[DeepSeek Corrector] Process finished:",S),S.success?h("completed",{manuscriptId:S.manuscriptId}):h("error",{message:S.error})}catch(v){console.error("[DeepSeek Corrector] Error:",v),h("error",{message:v.message||"Error desconocido en correcci\xF3n"})}d.end()}),e.get("/api/corrected-manuscripts",async(E,d)=>{try{let l=await M.select({id:Be.id,auditId:Be.auditId,projectId:Be.projectId,status:Be.status,totalIssues:Be.totalIssues,correctedIssues:Be.correctedIssues,approvedIssues:Be.approvedIssues,rejectedIssues:Be.rejectedIssues,createdAt:Be.createdAt,completedAt:Be.completedAt,projectTitle:lt.title}).from(Be).leftJoin(lt,q(Be.projectId,lt.id)).orderBy(ft(Be.createdAt));d.json(l)}catch(l){d.status(500).json({error:l.message})}}),e.get("/api/corrected-manuscripts/:id",async(E,d)=>{let l=parseInt(E.params.id);try{let[h]=await M.select().from(Be).where(q(Be.id,l)).limit(1);if(!h)return d.status(404).json({error:"Manuscrito no encontrado"});let[v]=await M.select({title:lt.title}).from(lt).where(q(lt.id,h.projectId)).limit(1);d.json({...h,projectTitle:v?.title})}catch(h){d.status(500).json({error:h.message})}}),e.post("/api/corrected-manuscripts/:id/approve/:correctionId",async(E,d)=>{let l=parseInt(E.params.id),h=E.params.correctionId;try{let{approveCorrection:v}=await Promise.resolve().then(()=>(ho(),mo));await v(l,h)?d.json({success:!0}):d.status(400).json({error:"No se pudo aprobar la correcci\xF3n"})}catch(v){d.status(500).json({error:v.message})}}),e.post("/api/corrected-manuscripts/:id/reject/:correctionId",async(E,d)=>{let l=parseInt(E.params.id),h=E.params.correctionId;try{let{rejectCorrection:v}=await Promise.resolve().then(()=>(ho(),mo));await v(l,h)?d.json({success:!0}):d.status(400).json({error:"No se pudo rechazar la correcci\xF3n"})}catch(v){d.status(500).json({error:v.message})}}),e.patch("/api/corrected-manuscripts/:id/update-texts/:correctionId",async(E,d)=>{let l=parseInt(E.params.id),h=E.params.correctionId,{originalText:v,correctedText:S}=E.body;try{let[R]=await M.select().from(Be).where(q(Be.id,l));if(!R)return d.status(404).json({error:"Manuscrito no encontrado"});let x=R.pendingCorrections,w=x.findIndex(_=>_.id===h);if(w===-1)return d.status(404).json({error:"Correcci\xF3n no encontrada"});x[w].originalText=v,x[w].correctedText=S,x[w].instruction=x[w].instruction?.replace("[REQUIERE EDICI\xD3N MANUAL] ","")||x[w].instruction;let O=v.split(/\s+/).length,I=S.split(/\s+/).length;x[w].diffStats={wordsAdded:Math.max(0,I-O),wordsRemoved:Math.max(0,O-I),lengthChange:S.length-v.length},await M.update(Be).set({pendingCorrections:x}).where(q(Be.id,l)),d.json({success:!0})}catch(R){d.status(500).json({error:R.message})}}),e.post("/api/corrected-manuscripts/:id/structural-resolve/:correctionId",async(E,d)=>{let l=parseInt(E.params.id),h=E.params.correctionId,{optionId:v}=E.body;if(!v)return d.status(400).json({error:"Se requiere optionId"});try{let[S]=await M.select().from(Be).where(q(Be.id,l));if(!S)return d.status(404).json({error:"Manuscrito no encontrado"});let x=(S.pendingCorrections||[]).find(N=>N.id===h);if(!x)return d.status(404).json({error:"Correcci\xF3n no encontrada"});if(x.status!=="pending")return d.status(400).json({error:"Solo se pueden resolver correcciones pendientes"});let{getStructuralIssueFromCorrection:w,applyStructuralResolution:O}=await Promise.resolve().then(()=>(ho(),mo));if(!w(x))return d.status(400).json({error:"Esta correcci\xF3n no es un problema estructural"});let _=await O(l,h,v);_.success?d.json({success:!0}):d.status(400).json({error:_.error||"No se pudo aplicar la resoluci\xF3n"})}catch(S){d.status(500).json({error:S.message})}}),e.get("/api/corrected-manuscripts/:id/structural-options/:correctionId",async(E,d)=>{let l=parseInt(E.params.id),h=E.params.correctionId;try{let{getStructuralIssueFromCorrection:v,isNarrativeFlowIssue:S,extractFlowBreakContext:R,generateFlowTransitionOptions:x}=await Promise.resolve().then(()=>(ho(),mo)),[w]=await M.select().from(Be).where(q(Be.id,l));if(!w)return d.status(404).json({error:"Manuscrito no encontrado"});let I=(w.pendingCorrections||[]).find(N=>N.id===h);if(!I)return d.status(404).json({error:"Correcci\xF3n no encontrada"});let _=v(I);if(_)d.json({isStructural:!0,options:_.resolutionOptions,affectedChapters:_.affectedChapters});else{let N={id:I.id,location:I.location||"",description:I.instruction||"",suggestion:I.correctedText||"",severity:I.severity||"HIGH",agent:"structural-resolver"};if(S(N)){let j=w.correctedContent||w.originalContent,$=R(N,j);if($){let U=x($.fromChapter,$.toChapter,I.instruction||"",j);d.json({isStructural:!0,isNarrativeFlow:!0,options:U,affectedChapters:[$.fromChapter,$.toChapter]});return}}[/captulos?\s+(son\s+)?idnticos/i,/repeticin\s+literal/i,/mismo[s]?\s+evento[s]?/i,/contenido\s+duplicado/i,/captulos?\s+duplicados/i].some(j=>j.test(I.instruction||""))?d.json({isStructural:!1,options:[],error:"Este problema parece estructural pero no se pudieron identificar los cap\xEDtulos afectados. La descripci\xF3n debe incluir referencias expl\xEDcitas a los cap\xEDtulos (ej: 'Cap\xEDtulo 9, Cap\xEDtulo 16 y Cap\xEDtulo 17')."}):d.json({isStructural:!1,options:[]})}}catch(v){d.status(500).json({error:v.message})}}),e.post("/api/corrected-manuscripts/:id/finalize",async(E,d)=>{let l=parseInt(E.params.id);try{let{finalizeManuscript:h}=await Promise.resolve().then(()=>(ho(),mo));await h(l)?d.json({success:!0}):d.status(400).json({error:"No se pudo finalizar el manuscrito"})}catch(h){d.status(500).json({error:h.message})}}),e.get("/api/corrected-manuscripts/:id/download",async(E,d)=>{let l=parseInt(E.params.id);try{let[h]=await M.select().from(Be).where(q(Be.id,l)).limit(1);if(!h)return d.status(404).json({error:"Manuscrito no encontrado"});let[v]=await M.select({title:lt.title}).from(lt).where(q(lt.id,h.projectId)).limit(1),S=h.correctedContent||h.originalContent,R=/===\s*(?:CAPTULO|Captulo|Cap\.?)\s*(\d+)(?:\s*[-:]\s*(.+?))?===\s*/gi,x=/===\s*(?:PRLOGO|Prlogo|Prologo)(?:\s*[-:]\s*(.+?))?===\s*/gi,w=/===\s*(?:EPLOGO|Eplogo|Epilogo)(?:\s*[-:]\s*(.+?))?===\s*/gi,O=S;O=O.replace(x,(_,N)=>N?`# Pr\xF3logo: ${N.trim()}

`:`# Pr\xF3logo

`),O=O.replace(w,(_,N)=>N?`# Ep\xEDlogo: ${N.trim()}

`:`# Ep\xEDlogo

`),O=O.replace(R,(_,N,P)=>P?`# Cap\xEDtulo ${N}: ${P.trim()}

`:`# Cap\xEDtulo ${N}

`),O=O.replace(/\n{3,}/g,`


`);let I=`${(v?.title||"manuscrito").replace(/\s+/g,"_")}_corregido.md`;d.setHeader("Content-Type","text/markdown; charset=utf-8"),d.setHeader("Content-Disposition",`attachment; filename="${encodeURIComponent(I)}"`),d.send(O)}catch(h){d.status(500).json({error:h.message})}}),e.delete("/api/corrected-manuscripts/:id",async(E,d)=>{let l=parseInt(E.params.id);try{await M.delete(Be).where(q(Be.id,l)),d.json({success:!0})}catch(h){d.status(500).json({error:h.message})}}),e.post("/api/projects/:id/auto-correct",async(E,d)=>{let l=parseInt(E.params.id),{maxCycles:h,targetScore:v,maxCriticalIssues:S}=E.body||{};try{let{startAutoCorrectionRun:R}=await Promise.resolve().then(()=>(Vm(),Cb)),x=await R(l,{maxCycles:h||3,targetScore:v||85,maxCriticalIssues:S||0});x.success?d.json({success:!0,runId:x.runId}):d.status(400).json({error:x.error})}catch(R){d.status(500).json({error:R.message})}}),e.get("/api/projects/:id/auto-correct/runs",async(E,d)=>{let l=parseInt(E.params.id);try{let h=await M.select().from(bt).where(q(bt.projectId,l)).orderBy(ft(bt.createdAt));d.json(h)}catch(h){d.status(500).json({error:h.message})}}),e.get("/api/auto-correct/runs/:id",async(E,d)=>{let l=parseInt(E.params.id);try{let[h]=await M.select().from(bt).where(q(bt.id,l));if(!h)return d.status(404).json({error:"Run no encontrado"});d.json(h)}catch(h){d.status(500).json({error:h.message})}}),e.get("/api/auto-correct/runs/:id/stream",async(E,d)=>{let l=parseInt(E.params.id);d.setHeader("Content-Type","text/event-stream"),d.setHeader("Cache-Control","no-cache"),d.setHeader("Connection","keep-alive"),d.setHeader("X-Accel-Buffering","no");let h=S=>{d.write(`data: ${JSON.stringify(S)}

`)},v=setInterval(async()=>{try{let[S]=await M.select().from(bt).where(q(bt.id,l));if(!S){h({phase:"error",message:"Run no encontrado"}),clearInterval(v),d.end();return}h({status:S.status,currentCycle:S.currentCycle,maxCycles:S.maxCycles,targetScore:S.targetScore,finalScore:S.finalScore,finalCriticalIssues:S.finalCriticalIssues,totalIssuesFixed:S.totalIssuesFixed,totalStructuralChanges:S.totalStructuralChanges,cycleHistory:S.cycleHistory,progressLog:(S.progressLog||[]).slice(-20),errorMessage:S.errorMessage}),["completed","failed","cancelled"].includes(S.status)&&(clearInterval(v),d.end())}catch(S){console.error("[AutoCorrector SSE] Error:",S)}},3e3);E.on("close",()=>{clearInterval(v)})}),e.post("/api/auto-correct/runs/:id/cancel",async(E,d)=>{let l=parseInt(E.params.id);try{let{cancelAutoCorrectionRun:h}=await Promise.resolve().then(()=>(Vm(),Cb)),v=await h(l);d.json({success:!0,message:"Cancelaci\xF3n solicitada"})}catch(h){d.status(500).json({error:h.message})}}),e.post("/api/auto-correct/runs/:id/retry",async(E,d)=>{let l=parseInt(E.params.id);try{let{retryAutoCorrectionRun:h}=await Promise.resolve().then(()=>(Vm(),Cb)),v=await h(l);d.json(v)}catch(h){d.status(500).json({error:h.message})}}),e.delete("/api/auto-correct/runs/:id",async(E,d)=>{let l=parseInt(E.params.id);try{await M.delete(bt).where(q(bt.id,l)),d.json({success:!0})}catch(h){d.status(500).json({error:h.message})}}),r}function Fce(r,e,t){let s=r/1e6*1.25,o=(e+t)/1e6*10;return Math.round((s+o)*100)/100}var $4=ln(GE(),1),L4=ln(require("fs"),1),Wx=ln(require("path"),1);function j4(r){let e=Wx.default.resolve(__dirname,"public");if(!L4.default.existsSync(e))throw new Error(`Could not find the build directory: ${e}, make sure to build the client first`);r.use($4.default.static(e)),r.use("*",(t,n)=>{n.sendFile(Wx.default.resolve(e,"index.html"))})}var Q4=require("http");vn();tb();var Ts=new Map;function U4(r){return`reedit_${r}_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}var qce=120*1e3,Gce=480*1e3,k4=600*1e3,Ab=3,Ju=new Map;function Vce(r){let e=Ju.get(r);if(!e)return!0;let n=new Date().getTime()-e.lastAttempt.getTime();return n<k4?(console.log(`[ReeditWatchdog] Project ${r} in cooldown (${Math.round((k4-n)/6e4)} min remaining)`),!1):e.count>=Ab?(console.log(`[ReeditWatchdog] Project ${r} exceeded max recovery attempts (${e.count}/${Ab})`),!1):!0}function zce(r){let e=Ju.get(r);e?(e.count++,e.lastAttempt=new Date):Ju.set(r,{count:1,lastAttempt:new Date})}function Hce(r){Ju.delete(r)}var D4=null;async function M4(){try{let e=(await b.getAllReeditProjects()).filter(n=>n.status==="processing");if(e.length===0)return;let t=new Date;for(let n of e){let s=(n.heartbeatAt?new Date(n.heartbeatAt):null)||(n.createdAt?new Date(n.createdAt):null);if(!s)continue;let o=t.getTime()-s.getTime();if(o>Gce){if(Ts.has(n.id)){console.log(`[ReeditWatchdog] Project ${n.id} has stale heartbeat but orchestrator still in memory - skipping recovery`);continue}if(!Vce(n.id)){let m=Ju.get(n.id);m&&m.count>=Ab&&(await b.updateReeditProject(n.id,{status:"error",errorMessage:`Auto-recovery fallido despu\xE9s de ${m.count} intentos. Reanudar manualmente.`}),console.log(`[ReeditWatchdog] Project ${n.id} marked as permanent error after ${m.count} recovery attempts`));continue}console.log(`[ReeditWatchdog] Project ${n.id} frozen - no heartbeat for ${Math.round(o/6e4)} minutes. AUTO-RESTARTING...`),zce(n.id);let i=Ju.get(n.id);console.log(`[ReeditWatchdog] Recovery attempt ${i?.count}/${Ab} for project ${n.id}`);let u=Ts.get(n.id);u&&(console.log(`[ReeditWatchdog] Cancelling existing orchestrator for project ${n.id}`),u.cancel(),Ts.delete(n.id),await new Promise(m=>setTimeout(m,1e3)));let c=U4(n.id);console.log(`[ReeditWatchdog] Generated new token for project ${n.id}: ${c}`),await b.updateReeditProject(n.id,{status:"processing",errorMessage:null,heartbeatAt:new Date,generationToken:c}),console.log(`[ReeditWatchdog] Project ${n.id} - starting auto-recovery orchestrator`);let p=new po(c);Ts.set(n.id,p),p.processProject(n.id).then(()=>{console.log(`[ReeditWatchdog] Project ${n.id} completed successfully after auto-recovery.`),Ts.delete(n.id),Hce(n.id)}).catch(async m=>{console.error(`[ReeditWatchdog] Project ${n.id} failed after auto-recovery:`,m),Ts.delete(n.id);try{await b.updateReeditProject(n.id,{status:"error",errorMessage:m instanceof Error?m.message:"Error durante auto-recovery"})}catch(f){console.error(`[ReeditWatchdog] Failed to update project ${n.id} status:`,f)}}),console.log(`[ReeditWatchdog] Project ${n.id} auto-recovery started in background`);break}}}catch(r){console.error("[ReeditWatchdog] Error during watchdog check:",r)}}function B4(){if(D4){console.log("[ReeditWatchdog] Watchdog already running");return}console.log("[ReeditWatchdog] Starting watchdog (checking every 2 minutes for frozen processes)"),D4=setInterval(M4,qce),M4()}async function F4(){console.log("[ReeditAutoResume] Checking for projects that need to be resumed...");try{let e=(await b.getAllReeditProjects()).filter(t=>t.status==="processing");if(e.length===0){console.log("[ReeditAutoResume] No reedit projects in processing state.");return}console.log(`[ReeditAutoResume] Found ${e.length} project(s) to resume:`,e.map(t=>`${t.id}: ${t.title}`));for(let t of e){if(Ts.has(t.id)){console.log(`[ReeditAutoResume] Project ${t.id} already has an active orchestrator, skipping.`);continue}console.log(`[ReeditAutoResume] Auto-resuming project ${t.id}: "${t.title}"...`);let n=U4(t.id);await b.updateReeditProject(t.id,{generationToken:n});let a=new po(n);Ts.set(t.id,a),a.processProject(t.id).then(()=>{console.log(`[ReeditAutoResume] Project ${t.id} completed successfully.`),Ts.delete(t.id)}).catch(async s=>{console.error(`[ReeditAutoResume] Project ${t.id} failed:`,s),Ts.delete(t.id);try{await b.updateReeditProject(t.id,{status:"error",errorMessage:s instanceof Error?s.message:"Unknown error during auto-resume"})}catch(o){console.error(`[ReeditAutoResume] Failed to update project ${t.id} status:`,o)}}),console.log(`[ReeditAutoResume] Project ${t.id} orchestrator started in background.`)}}catch(r){console.error("[ReeditAutoResume] Error during auto-resume:",r)}}vn();Mm();var Os=new Map,Wce=60*1e3,Qce=300*1e3,q4=null;async function G4(){try{let e=(await b.getAllTranslations()).filter(n=>n.status==="translating");if(e.length===0)return;let t=new Date;for(let n of e){let s=(n.heartbeatAt?new Date(n.heartbeatAt):null)||(n.createdAt?new Date(n.createdAt):null);if(!s)continue;let o=t.getTime()-s.getTime();o>Qce&&(console.log(`[TranslationWatchdog] Translation ${n.id} frozen - no heartbeat for ${Math.round(o/6e4)} minutes`),Os.has(n.id)||(console.log(`[TranslationWatchdog] Auto-resuming frozen translation ${n.id}...`),z4(n)))}}catch(r){console.error("[TranslationWatchdog] Error during watchdog check:",r)}}function V4(){if(q4){console.log("[TranslationWatchdog] Watchdog already running");return}console.log("[TranslationWatchdog] Starting watchdog (checking every 2 minutes for frozen translations)"),q4=setInterval(G4,Wce),G4()}async function z4(r){let e=r.id;if(Os.has(e)){console.log(`[TranslationAutoResume] Translation ${e} already active, skipping.`);return}Os.set(e,!0);try{let t=r.projectId,n=r.reeditProjectId;if(!t&&!n){console.log(`[TranslationAutoResume] Translation ${e} has no project, skipping.`),Os.delete(e);return}let a=[],s=!!n&&!t;if(s){if(!await b.getReeditProject(n)){console.log(`[TranslationAutoResume] Reedit project ${n} not found, skipping.`),Os.delete(e);return}let T=await b.getReeditChaptersByProject(n),E=l=>l===0?-1e3:l===-1||l===998?1e3:l===-2||l===999?1001:l;a=[...T].sort((l,h)=>E(l.chapterNumber)-E(h.chapterNumber)).filter(l=>(l.editedContent||l.originalContent)?.trim().length>0)}else{if(!await b.getProject(t)){console.log(`[TranslationAutoResume] Project ${t} not found, skipping.`),Os.delete(e);return}a=[...await b.getChaptersByProject(t)].sort((d,l)=>{let h=d.chapterNumber===0?-1e3:d.chapterNumber===-1?1e3:d.chapterNumber===-2?1001:d.chapterNumber,v=l.chapterNumber===0?-1e3:l.chapterNumber===-1?1e3:l.chapterNumber===-2?1001:l.chapterNumber;return h-v}).filter(d=>d.content&&d.content.trim().length>0)}let o=r.sourceLanguage,i=r.targetLanguage,u=r.markdown||"",c=a.length,p=0;if(u.trim().length>0){let A=u.match(/\n\n---\n\n/g);p=A?A.length+1:1}let m=Math.max(0,p),f=a.slice(m);if(console.log(`[TranslationAutoResume] Translation ${e}: resuming from chapter ${m+1}/${c} (${f.length} remaining)`),f.length===0){await b.updateTranslation(e,{status:"completed",chaptersTranslated:c}),console.log(`[TranslationAutoResume] Translation ${e} already complete!`),Os.delete(e);return}let g=u,y=m,C=new Dm;for(let A=0;A<f.length;A++){let T=f[A],E=m+A+1;console.log(`[TranslationAutoResume] Translation ${e}: translating chapter ${E}/${c}...`),await b.updateTranslation(e,{heartbeatAt:new Date});let d=s?T.editedContent||T.originalContent:T.content;try{let h=(await C.execute({content:d,sourceLanguage:o,targetLanguage:i,chapterTitle:T.title,chapterNumber:T.chapterNumber})).result;h&&h.translated_text&&(g.length>0&&(g+=`

---

`),g+=h.translated_text,y++,await b.updateTranslation(e,{markdown:g,chaptersTranslated:y,heartbeatAt:new Date}),console.log(`[TranslationAutoResume] Translation ${e}: chapter ${E}/${c} complete`))}catch(l){console.error(`[TranslationAutoResume] Error translating chapter ${E}:`,l),await b.updateTranslation(e,{status:"error"}),Os.delete(e);return}}await b.updateTranslation(e,{status:"completed",chaptersTranslated:c}),console.log(`[TranslationAutoResume] Translation ${e} completed successfully!`),Os.delete(e)}catch(t){console.error(`[TranslationAutoResume] Error resuming translation ${e}:`,t),Os.delete(e)}}async function H4(){console.log("[TranslationAutoResume] Checking for translations that need to be resumed...");try{let e=(await b.getAllTranslations()).filter(t=>t.status==="translating");if(e.length===0){console.log("[TranslationAutoResume] No translations in translating state.");return}console.log(`[TranslationAutoResume] Found ${e.length} translation(s) to resume:`,e.map(t=>`${t.id}: ${t.projectTitle}`));for(let t of e)z4(t)}catch(r){console.error("[TranslationAutoResume] Error checking translations:",r)}}Vm();process.on("SIGTERM",()=>{console.log("[PROCESS] Received SIGTERM signal - server shutting down"),process.exit(0)});process.on("SIGINT",()=>{console.log("[PROCESS] Received SIGINT signal - server shutting down"),process.exit(0)});process.on("uncaughtException",r=>{console.error("[PROCESS] Uncaught Exception:",r)});process.on("unhandledRejection",(r,e)=>{console.error("[PROCESS] Unhandled Rejection at:",e,"reason:",r)});setInterval(()=>{let r=process.memoryUsage(),e=Math.round(r.heapUsed/1024/1024),t=Math.round(r.heapTotal/1024/1024),n=Math.round(r.rss/1024/1024);e>400&&console.log(`[MEMORY] Heap: ${e}MB/${t}MB, RSS: ${n}MB`)},6e4);var mi=(0,Sb.default)();mi.set("trust proxy",1);var W4=(0,Q4.createServer)(mi);mi.use(Sb.default.json({limit:"50mb",verify:(r,e,t)=>{r.rawBody=t}}));mi.use(Sb.default.urlencoded({extended:!1,limit:"50mb"}));function Ta(r,e="express"){let t=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${t} [${e}] ${r}`)}mi.use((r,e,t)=>{let n=Date.now(),a=r.path,s,o=e.json;e.json=function(i,...u){return s=i,o.apply(e,[i,...u])},e.on("finish",()=>{let i=Date.now()-n;if(a.startsWith("/api")){let u=`${r.method} ${a} ${e.statusCode} in ${i}ms`;s&&(u+=` :: ${JSON.stringify(s)}`),Ta(u)}}),t()});(async()=>{await P4(W4,mi),mi.use((e,t,n,a)=>{let s=e.status||e.statusCode||500,o=e.message||"Internal Server Error";throw n.status(s).json({message:o}),e}),j4(mi);let r=parseInt(process.env.PORT||"5000",10);W4.listen({port:r,host:"0.0.0.0",reusePort:!0},async()=>{Ta(`serving on port ${r}`);try{await wa.initialize(),Ta("Queue manager initialized","queue")}catch(e){Ta(`Queue manager initialization error: ${e}`,"queue")}try{let e=await Gx();e>0&&Ta(`Auto-corrector: cleaned ${e} zombie run(s)`,"auto-corrector")}catch(e){Ta(`Auto-corrector zombie cleanup error: ${e}`,"auto-corrector")}try{setTimeout(async()=>{Ta("Checking for reedit projects to auto-resume...","reedit"),await F4(),B4(),Ta("Reedit watchdog started","reedit"),Ta("Checking for translations to auto-resume...","translation"),await H4(),V4(),Ta("Translation watchdog started","translation")},3e3)}catch(e){Ta(`Auto-resume error: ${e}`,"system")}})})();0&&(module.exports={log});
/*! Bundled license information:

depd/index.js:
  (*!
   * depd
   * Copyright(c) 2014-2018 Douglas Christopher Wilson
   * MIT Licensed
   *)

bytes/index.js:
  (*!
   * bytes
   * Copyright(c) 2012-2014 TJ Holowaychuk
   * Copyright(c) 2015 Jed Watson
   * MIT Licensed
   *)

content-type/index.js:
  (*!
   * content-type
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

statuses/index.js:
statuses/index.js:
statuses/index.js:
  (*!
   * statuses
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

toidentifier/index.js:
  (*!
   * toidentifier
   * Copyright(c) 2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

http-errors/index.js:
http-errors/index.js:
http-errors/index.js:
  (*!
   * http-errors
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

destroy/index.js:
  (*!
   * destroy
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

unpipe/index.js:
  (*!
   * unpipe
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

raw-body/index.js:
  (*!
   * raw-body
   * Copyright(c) 2013-2014 Jonathan Ong
   * Copyright(c) 2014-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

ee-first/index.js:
  (*!
   * ee-first
   * Copyright(c) 2014 Jonathan Ong
   * MIT Licensed
   *)

on-finished/index.js:
  (*!
   * on-finished
   * Copyright(c) 2013 Jonathan Ong
   * Copyright(c) 2014 Douglas Christopher Wilson
   * MIT Licensed
   *)

body-parser/lib/read.js:
body-parser/lib/types/raw.js:
body-parser/lib/types/text.js:
body-parser/index.js:
  (*!
   * body-parser
   * Copyright(c) 2014-2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

media-typer/index.js:
  (*!
   * media-typer
   * Copyright(c) 2014 Douglas Christopher Wilson
   * MIT Licensed
   *)

mime-db/index.js:
  (*!
   * mime-db
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

mime-types/index.js:
  (*!
   * mime-types
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

type-is/index.js:
  (*!
   * type-is
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2014-2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

body-parser/lib/types/json.js:
body-parser/lib/types/urlencoded.js:
  (*!
   * body-parser
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2014-2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

merge-descriptors/index.js:
  (*!
   * merge-descriptors
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

encodeurl/index.js:
encodeurl/index.js:
  (*!
   * encodeurl
   * Copyright(c) 2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

escape-html/index.js:
  (*!
   * escape-html
   * Copyright(c) 2012-2013 TJ Holowaychuk
   * Copyright(c) 2015 Andreas Lubbe
   * Copyright(c) 2015 Tiancheng "Timothy" Gu
   * MIT Licensed
   *)

parseurl/index.js:
  (*!
   * parseurl
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2014-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)

finalhandler/index.js:
  (*!
   * finalhandler
   * Copyright(c) 2014-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

express/lib/router/layer.js:
express/lib/router/route.js:
express/lib/router/index.js:
express/lib/middleware/init.js:
express/lib/middleware/query.js:
express/lib/view.js:
express/lib/application.js:
express/lib/request.js:
express/lib/express.js:
express/index.js:
  (*!
   * express
   * Copyright(c) 2009-2013 TJ Holowaychuk
   * Copyright(c) 2013 Roman Shtylman
   * Copyright(c) 2014-2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

methods/index.js:
  (*!
   * methods
   * Copyright(c) 2013-2014 TJ Holowaychuk
   * Copyright(c) 2015-2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

content-disposition/index.js:
  (*!
   * content-disposition
   * Copyright(c) 2014-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)

etag/index.js:
  (*!
   * etag
   * Copyright(c) 2014-2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

fresh/index.js:
  (*!
   * fresh
   * Copyright(c) 2012 TJ Holowaychuk
   * Copyright(c) 2016-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)

range-parser/index.js:
  (*!
   * range-parser
   * Copyright(c) 2012-2014 TJ Holowaychuk
   * Copyright(c) 2015-2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

send/index.js:
  (*!
   * send
   * Copyright(c) 2012 TJ Holowaychuk
   * Copyright(c) 2014-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

forwarded/index.js:
  (*!
   * forwarded
   * Copyright(c) 2014-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)

proxy-addr/index.js:
  (*!
   * proxy-addr
   * Copyright(c) 2014-2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

express/lib/utils.js:
express/lib/response.js:
  (*!
   * express
   * Copyright(c) 2009-2013 TJ Holowaychuk
   * Copyright(c) 2014-2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

negotiator/index.js:
  (*!
   * negotiator
   * Copyright(c) 2012 Federico Romero
   * Copyright(c) 2012-2014 Isaac Z. Schlueter
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

accepts/index.js:
  (*!
   * accepts
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

vary/index.js:
  (*!
   * vary
   * Copyright(c) 2014-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)

serve-static/index.js:
  (*!
   * serve-static
   * Copyright(c) 2010 Sencha Inc.
   * Copyright(c) 2011 TJ Holowaychuk
   * Copyright(c) 2014-2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

object-assign/index.js:
  (*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  *)
*/
